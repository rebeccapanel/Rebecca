var yl=Object.defineProperty;var Sl=(t,n,r)=>n in t?yl(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var V=(t,n,r)=>(Sl(t,typeof n!="symbol"?n+"":n,r),r);import{i as Gn,B as xl,a as kl,b as wl,j as bo,d as We,U as qa,z as vl,r as Cl,f as _l,Q as Dl,e as Al,m as vt,$ as Il,c as Z,X as Ya,R as La,N as qr,I as ye,g as Yr,h as s,F as k,k as e,l as v,n as gr,o as Tl,p as da,q as Lt,s as Pl,t as El,u as Nl,v as zl,w as wr,x as Br,L as Rl,C as ua,y as Fe,A as Qe,M as ra,D as sa,E as ze,G as na,H as Zt,J as z,K as Ul,T as h,S as Ll,P as Ml,O as Ma,V as Mr,W as Oa,Y as yo,Z as So,_ as Ol,a0 as Mt,a1 as os,a2 as Yt,a3 as d,a4 as ci,a5 as R,a6 as aa,a7 as Nt,a8 as ht,a9 as zt,aa as mt,ab as Pt,ac as pt,ad as le,ae as He,af as ke,ag as kr,ah as Y,ai as It,aj as ur,ak as Pe,al as Wl,am as bn,an as Ga,ao as Fl,ap as Xa,aq as vr,ar as Lr,as as Kr,at as hr,au as pr,av as as,aw as ha,ax as Gr,ay as Hl,az as xo,aA as Bl,aB as Vl,aC as $l,aD as Kl,aE as pa,aF as ko,aG as wo,aH as yn,aI as di,aJ as Jl,aK as ql,aL as vo,aM as or,aN as yt,aO as Yl,aP as Gl,aQ as Co,aR as _o,aS as $s,aT as Xl,aU as Ql,aV as ma,aW as wt,aX as Do,aY as Or,aZ as Xr,a_ as Zl,a$ as Qa,b0 as hs,b1 as Ao,b2 as jl,b3 as ec,b4 as qe,b5 as Io,b6 as tc,b7 as rc,b8 as To,b9 as sc,ba as Po,bb as nc,bc as ac,bd as ic,be as Eo,bf as oc,bg as lc,bh as cc,bi as mn,bj as ui,bk as Ks,bl as Js,bm as Vt,bn as qs,bo as $t,bp as dc,bq as uc,br as is,bs as hc,bt as Wt,bu as pc,bv as at,bw as it,bx as ct,by as Ur,bz as Wr,bA as No,bB as zo,bC as Ro,bD as ms,bE as zr,bF as At,bG as Le,bH as Ir,bI as Re,bJ as Uo,bK as Lo,bL as Mo,bM as hi,bN as Vr,bO as mc,bP as gc,bQ as fc,bR as bc,bS as yc,bT as Sc,bU as Sn,bV as xn,bW as Cn,bX as Oo,bY as st,bZ as xc,b_ as Ls,b$ as mr,c0 as _n,c1 as Dn,c2 as kc,c3 as An,c4 as In,c5 as Wo,c6 as Tn,c7 as gn,c8 as wc,c9 as Xn,ca as vc,cb as Fo,cc as Za,cd as Er,ce as Ho,cf as ia,cg as Nr,ch as Pn,ci as Ms,cj as Cc,ck as _c,cl as Dc,cm as Ac,cn as Qn,co as fn,cp as Bo,cq as Vo,cr as Ic,cs as Tc,ct as Pc,cu as Ec,cv as Nc,cw as zc,cx as Rc,cy as Uc,cz as Lc,cA as pi,cB as Mc,cC as Oc,cD as Wc,cE as ja,cF as Fc,cG as ya,cH as Hc,cI as Bc,cJ as Vc,cK as $c,cL as Kc,cM as Jc,cN as qc,cO as Yc,cP as Gc,cQ as Xc}from"./vendor.ace13279.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();Gn.use(xl).use(kl).use(wl).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:bo(["/","statics/locales/{{lng}}.json"])}},function(t,n){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",Gn.language),We.locale(Gn.language)});Gn.on("languageChanged",t=>{console.log("Language changed to:",t),We.locale(t)});qa("zh-cn",vl);qa("ru",Cl);qa("fa",_l);const Zn=new Dl,jn=(t,n)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:n||"#f6f8ff"},o=n||l[t]||l.default;r==null||r.setAttribute("content",o)},Qc=Al({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:vt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:vt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:vt("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:vt("surface.light","surface.dark")(t),borderColor:vt("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:vt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:vt("lg","dark-lg")(t)},item:{_hover:{bg:vt("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:vt("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:vt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:vt("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:vt("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:vt("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:vt("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:vt("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:vt("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:vt("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:vt("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const oa=()=>localStorage.getItem("token"),Zc=t=>{localStorage.setItem("token",t)},jc=()=>{localStorage.removeItem("token")},ed=Il.create({baseURL:"https://bot.mazholl.com:8585/api"}),td=(t,n={})=>(oa()&&(n.headers={...(n==null?void 0:n.headers)||{},Authorization:`Bearer ${oa()}`}),ed(t,n)),_e=td,rd=Z(Ya,{baseStyle:{w:4,h:4}}),sr=La.forwardRef(({disabled:t,step:n,label:r,className:l,startAdornment:o,endAdornment:i,type:a="text",placeholder:c,onChange:u,onBlur:p,name:g,value:f,onClick:_,error:w,clearable:b=!1,...y},C)=>{const E=()=>{u&&u({target:{value:"",name:g}})},{size:O="md"}=y,ee=a=="number"?qr:ye,D=a=="number"?Yr:La.Fragment,F=a=="number"?{keepWithinRange:!0,precision:5,format:A=>isNaN(parseFloat(String(A)))||Number(parseFloat(String(A)).toFixed(5))===0?A:Number(parseFloat(String(A)).toFixed(5)),min:0,step:n,name:g,type:a,placeholder:c,onChange:A=>{u&&u(A)},onBlur:p,value:f,onClick:_,disabled:t,flexGrow:1,size:O}:{};return s(k,{isInvalid:!!w,children:[r&&e(v,{children:r}),s(gr,{size:O,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[o&&e(Tl,{children:o}),s(D,{...F,children:[e(ee,{name:g,ref:C,step:n,className:da(l),type:a,placeholder:c,onChange:u,onBlur:p,value:f,onClick:_,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...y,roundedLeft:o?"0":"md",roundedRight:i?"0":"md"}),a=="number"&&e(Lt,{children:s(Pl,{children:[e(El,{}),e(Nl,{})]})})]}),i&&e(zl,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),b&&f&&f.length&&e(wr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:E,cursor:"pointer",children:e(rd,{})})]}),!!w&&e(Br,{children:w})]})}),sd="/statics/logo.e8dba2f4.svg",nd=Z(Rl,{baseStyle:{w:4,h:4}}),ad=Z(ua,{baseStyle:{w:4,h:4}}),$o=({actions:t})=>{const{i18n:n}=Fe(),r=Qe("surface.light","surface.dark"),l=Qe("blackAlpha.50","whiteAlpha.100"),o=Qe("blackAlpha.200","whiteAlpha.200"),i=Qe("gray.800","gray.100"),a=u=>{n.changeLanguage(u)};return s(ra,{placement:"bottom-end",children:[e(sa,{as:ze,size:"sm",variant:"outline",icon:e(nd,{}),position:"relative"}),e(na,{minW:"160px",zIndex:9999,bg:r,borderColor:o,color:i,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:p,flag:g})=>e(Zt,{fontSize:"sm",onClick:()=>a(u),_hover:{bg:l},children:s(z,{justify:"space-between",w:"full",children:[s(z,{spacing:2,children:[e(Ul,{countryCode:g,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:p})]}),n.language===u&&e(ad,{})]})},u))})]})},mi="rb-theme",gi="rb-custom-themes",id=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],fi=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],bi=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],ar={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},ir={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Sa=.14,xa=.22,yi=Z(ua,{baseStyle:{w:4,h:4}}),od=Z(Ll,{baseStyle:{w:4,h:4}}),ld=Z(Ml,{baseStyle:{w:4,h:4}}),cd=Z(Ma,{baseStyle:{w:4,h:4}}),dd=Z(Mr,{baseStyle:{w:4,h:4}}),Si=Z(Oa,{baseStyle:{w:4,h:4}}),ud=Z(yo,{baseStyle:{w:4,h:4}}),hd=Z(So,{baseStyle:{w:4,h:4}}),pd=Z(Ol,{baseStyle:{w:4,h:4}}),Ko=(t,n=0,r=1)=>Math.min(r,Math.max(n,t)),Wa=t=>{const n=t.replace("#",""),r=parseInt(n,16);if(n.length===3){const l=r>>8&15,o=r>>4&15,i=r&15;return{r:l<<4|l,g:o<<4|o,b:i<<4|i}}return{r:r>>16&255,g:r>>8&255,b:r&255}},Jo=(t,n,r)=>{const l=o=>o.toString(16).padStart(2,"0");return`#${l(t)}${l(n)}${l(r)}`},md=(t,n,r)=>{t/=255,n/=255,r/=255;const l=Math.max(t,n,r),o=Math.min(t,n,r);let i=0,a=0;const c=(l+o)/2;if(l!==o){const u=l-o;switch(a=c>.5?u/(2-l-o):u/(l+o),l){case t:i=(n-r)/u+(n<r?6:0);break;case n:i=(r-t)/u+2;break;default:i=(t-n)/u+4}i/=6}return{h:i,s:a,l:c}},gd=(t,n,r)=>{let l,o,i;if(n===0)l=o=i=r;else{const a=(p,g,f)=>(f<0&&(f+=1),f>1&&(f-=1),f<.16666666666666666?p+(g-p)*6*f:f<.5?g:f<.6666666666666666?p+(g-p)*(.6666666666666666-f)*6:p),c=r<.5?r*(1+n):r+n-r*n,u=2*r-c;l=a(u,c,t+1/3),o=a(u,c,t),i=a(u,c,t-1/3)}return{r:Math.round(l*255),g:Math.round(o*255),b:Math.round(i*255)}},ka=t=>{try{const{r:n,g:r,b:l}=Wa(t),{h:o,s:i,l:a}=md(n,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[p,g])=>{const{r:f,g:_,b:w}=gd(o,i,Ko(a+g));return u[`--primary-${p}`]=Jo(f,_,w),u},{})}catch{return{}}},fd=(t,n,r)=>{const l=Ko(r,0,1),o=Wa(t),i=Wa(n),a=(c,u)=>Math.round(c*(1-l)+u*l);return Jo(a(o.r,i.r),a(o.g,i.g),a(o.b,i.b))},As=(t,n,r,l)=>{try{return fd(t,n,r)}catch{return l}},bd=()=>{const t=document.documentElement;id.forEach(n=>t.style.removeProperty(n)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},yd=(t,n)=>{const r=document.documentElement;Object.entries(t).forEach(([l,o])=>r.style.setProperty(l,o)),r.style.setProperty("--bg-light",n.bgLight),r.style.setProperty("--bg-dark",n.bgDark),r.style.setProperty("--surface-light",n.surfaceLight),r.style.setProperty("--surface-dark",n.surfaceDark)},wa=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},xi=()=>({name:"",light:{...ar},dark:{...ir}}),Ht=(t,n)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:n,qo=({minimal:t=!1})=>{const{t:n}=Fe(),r=Mt(),{colorMode:l,toggleColorMode:o}=os(),i=Yt(),a=Yt(),c=Qe("surface.light","surface.dark"),u=Qe("blackAlpha.50","whiteAlpha.100"),p=Qe("blackAlpha.200","whiteAlpha.200"),g=Qe("gray.800","gray.100"),f=Qe("gray.600","gray.300"),_=Qe("blackAlpha.400","blackAlpha.700"),w=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:f}}),[f]),[b,y]=d.exports.useState(()=>{try{return localStorage.getItem(mi)||"default"}catch{return"default"}}),[C,E]=d.exports.useState(()=>{try{const T=localStorage.getItem(gi);if(!T)return[];const M=JSON.parse(T);return Array.isArray(M)?M.map(ce=>{var pe,Ce,Ge,ae,re,oe;const $=Ht(((pe=ce.light)==null?void 0:pe.primary)||ar.primary,ar.primary),Se=Ht(((Ce=ce.light)==null?void 0:Ce.bg)||ar.bg,ar.bg),Ee=As(Se,$,Sa,ar.surface),we=Ht(((Ge=ce.light)==null?void 0:Ge.surface)||Ee,Ee),Oe=Ht(((ae=ce.dark)==null?void 0:ae.primary)||ir.primary,ir.primary),X=Ht(((re=ce.dark)==null?void 0:re.bg)||ir.bg,ir.bg),xe=As(X,Oe,xa,ir.surface),G=Ht(((oe=ce.dark)==null?void 0:oe.surface)||xe,xe);return{id:ce.id||wa(),name:ce.name||"Custom",light:{primary:$,bg:Se,surface:we},dark:{primary:Oe,bg:X,surface:G}}}):[]}catch{return[]}}),[O,ee]=d.exports.useState(xi),[D,F]=d.exports.useState(null),[A,I]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(gi,JSON.stringify(C))}catch{}},[C]),d.exports.useEffect(()=>{try{localStorage.setItem(mi,b)}catch{}},[b]),d.exports.useEffect(()=>{b.startsWith("custom:")&&(C.some(M=>`custom:${M.id}`===b)||y("default"))},[b,C]),d.exports.useEffect(()=>{const T=document.documentElement;Array.from(T.classList).filter(ce=>ce.startsWith("rb-theme-")).forEach(ce=>T.classList.remove(ce)),bd();const M=fi.find(ce=>ce.key===b);if(M){M.className&&T.classList.add(M.className),jn(M.key);return}if(b.startsWith("custom:")){const ce=C.find(Ee=>`custom:${Ee.id}`===b);if(!ce)return;const $=l==="dark"?ce.dark:ce.light,Se=ka($.primary);yd(Se,{bgLight:ce.light.bg,bgDark:ce.dark.bg,surfaceLight:ce.light.surface,surfaceDark:ce.dark.surface}),jn("custom",l==="dark"?ce.dark.bg:ce.light.bg)}else jn("default")},[b,C,l]);const De=d.exports.useCallback(T=>{T.colorModeTarget&&l!==T.colorModeTarget&&o(),y(T.key)},[l,o]),ge=T=>{y(`custom:${T}`)},te=T=>{F(null),ee(T?{name:n(`theme.presets.${T.key}.name`),light:{...T.light},dark:{...T.dark}}:xi()),i.onOpen()},L=T=>{F(T.id),ee({name:T.name,light:{...T.light},dark:{...T.dark}}),i.onOpen()},Q=()=>{const T=O.name.trim()||n("theme.untitled"),M=Ht(O.light.primary,ar.primary),ce=Ht(O.light.bg,ar.bg),$=As(ce,M,Sa,ar.surface),Se=Ht(O.light.surface,$),Ee=Ht(O.dark.primary,ir.primary),we=Ht(O.dark.bg,ir.bg),Oe=As(we,Ee,xa,ir.surface),X=Ht(O.dark.surface,Oe),xe={id:D||wa(),name:T,light:{primary:M,bg:ce,surface:Se},dark:{primary:Ee,bg:we,surface:X}};E(G=>D?G.map(pe=>pe.id===D?xe:pe):[...G,xe]),y(`custom:${xe.id}`),i.onClose(),F(null),r({status:"success",title:n("theme.customSaved")})},de=T=>{E(M=>M.filter(ce=>ce.id!==T)),b===`custom:${T}`&&y("default"),r({status:"info",title:n("theme.customDeleted")})},ne=()=>{y("default"),r({status:"info",title:n("theme.resetSuccess")})},ie=async()=>{if(!C.length){r({status:"warning",title:n("theme.exportEmpty")});return}const T=C.map(({id:ce,...$})=>$),M=JSON.stringify(T,null,2);try{await navigator.clipboard.writeText(M),r({status:"success",title:n("theme.exportSuccess")})}catch{try{const ce=new Blob([M],{type:"application/json"}),$=URL.createObjectURL(ce),Se=document.createElement("a");Se.href=$,Se.download="rebecca-themes.json",Se.click(),URL.revokeObjectURL($),r({status:"success",title:n("theme.exportSuccessDownload")})}catch{r({status:"error",title:n("theme.exportError")})}}},P=()=>{try{const T=JSON.parse(A),ce=(Array.isArray(T)?T:[T]).map($=>{var Ce,Ge,ae,re,oe,K;const Se=Ht(((Ce=$==null?void 0:$.light)==null?void 0:Ce.primary)||ar.primary,ar.primary),Ee=Ht(((Ge=$==null?void 0:$.light)==null?void 0:Ge.bg)||ar.bg,ar.bg),we=As(Ee,Se,Sa,ar.surface),Oe=Ht(((ae=$==null?void 0:$.light)==null?void 0:ae.surface)||we,we),X=Ht(((re=$==null?void 0:$.dark)==null?void 0:re.primary)||ir.primary,ir.primary),xe=Ht(((oe=$==null?void 0:$.dark)==null?void 0:oe.bg)||ir.bg,ir.bg),G=As(xe,X,xa,ir.surface),pe=Ht(((K=$==null?void 0:$.dark)==null?void 0:K.surface)||G,G);return{id:wa(),name:($==null?void 0:$.name)||"Custom",light:{primary:Se,bg:Ee,surface:Oe},dark:{primary:X,bg:xe,surface:pe}}}).filter($=>$.name);if(!ce.length){r({status:"warning",title:n("theme.importError")});return}E($=>[...$,...ce]),a.onClose(),I(""),r({status:"success",title:n("theme.importSuccess")})}catch{r({status:"error",title:n("theme.importError")})}},ue=d.exports.useCallback((T,M)=>{T.preventDefault(),T.stopPropagation(),M()},[]),Te=d.exports.useMemo(()=>ka(O.light.primary),[O.light.primary]),Ie=d.exports.useMemo(()=>ka(O.dark.primary),[O.dark.primary]),U=T=>{const M=O[T],ce=T==="dark"?Ie:Te,$=ce["--primary-500"]||M.primary,Se=ce["--primary-300"]||ce["--primary-400"]||$,Ee=T==="dark"?"whiteAlpha.900":"gray.800",we=T==="dark"?"whiteAlpha.700":"gray.600",Oe=T==="dark"?"whiteAlpha.200":"blackAlpha.200",X=T==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(R,{borderWidth:"1px",borderRadius:"md",bg:M.bg,p:4,borderColor:Oe,children:s(ke,{spacing:3,children:[e(h,{fontWeight:"semibold",color:Ee,children:n(T==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(R,{borderRadius:"lg",bg:M.surface,p:4,borderWidth:"1px",borderColor:Oe,children:s(ke,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:Ee,children:n("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:we,children:n("theme.previewSampleBody")}),e(Y,{size:"sm",bg:$,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:n("theme.previewSampleAction")}),s(z,{spacing:2,pt:2,children:[e(R,{flex:"1",h:"2",borderRadius:"full",bg:Se,opacity:.8}),e(R,{flex:"1",h:"2",borderRadius:"full",bg:$,opacity:.9})]})]})}),s(z,{spacing:1,pt:1,flexWrap:"wrap",children:[e(R,{w:6,h:6,borderRadius:"sm",bg:M.bg,borderWidth:"1px",borderColor:X}),e(R,{w:6,h:6,borderRadius:"sm",bg:M.surface,borderWidth:"1px",borderColor:X}),Object.entries(ce).map(([xe,G])=>e(R,{w:6,h:6,borderRadius:"sm",bg:G,borderWidth:"1px",borderColor:X,title:xe},xe))]})]})})};return s(Lt,{children:[s(ra,{placement:"bottom-end",children:[e(sa,{as:ze,size:"sm",variant:"outline",icon:e(od,{}),position:"relative"}),s(na,{minW:"260px",zIndex:9999,bg:c,color:g,borderColor:p,children:[e(ci,{title:n("theme.builtIn"),sx:w,children:fi.map(T=>{const M=b===T.key;return e(Zt,{onClick:()=>De(T),_hover:{bg:u},children:s(z,{justify:"space-between",w:"full",children:[s(z,{children:[e(R,{w:"4",h:"3",bg:T.accent,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:n(`theme.${T.key}`)})]}),M&&e(yi,{})]})},T.key)})}),!t&&s(Lt,{children:[e(aa,{borderColor:p}),s(ci,{title:n("theme.customGroup"),sx:w,children:[C.length?C.map(T=>{const M=b===`custom:${T.id}`;return e(Zt,{onClick:()=>ge(T.id),_hover:{bg:u},children:s(z,{justify:"space-between",w:"full",children:[s(z,{children:[e(R,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${T.light.surface}, ${T.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:T.name})]}),s(z,{spacing:1,children:[M&&e(yi,{}),[{icon:e(cd,{}),label:n("theme.edit"),onClick:()=>L(T)},{icon:e(dd,{}),label:n("theme.delete"),onClick:()=>de(T.id)}].map(({icon:ce,label:$,onClick:Se})=>e(R,{as:"span",role:"button",tabIndex:0,"aria-label":$,onClick:Ee=>ue(Ee,Se),onKeyDown:Ee=>{(Ee.key==="Enter"||Ee.key===" ")&&ue(Ee,Se)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:u},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:ce},$))]})]})},T.id)}):e(Zt,{isDisabled:!0,children:n("theme.noCustom")}),e(Zt,{icon:e(ld,{}),onClick:()=>te(),_hover:{bg:u},children:n("theme.createCustom")})]}),e(aa,{borderColor:p}),e(Zt,{icon:e(Si,{}),onClick:()=>te(bi[0]),_hover:{bg:u},children:n("theme.quickPreset")}),e(Zt,{icon:e(ud,{}),onClick:ie,_hover:{bg:u},children:n("theme.export")}),e(Zt,{icon:e(hd,{}),onClick:()=>a.onOpen(),_hover:{bg:u},children:n("theme.import")}),e(Zt,{icon:e(pd,{}),onClick:ne,_hover:{bg:u},children:n("theme.reset")})]})]})]}),s(Nt,{isOpen:i.isOpen,onClose:i.onClose,isCentered:!0,size:"xl",children:[e(ht,{bg:_,backdropFilter:"blur(4px)"}),s(zt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:g,children:[e(mt,{color:g,children:n(D?"theme.editThemeTitle":"theme.customTitle")}),e(Pt,{}),e(pt,{children:s(le,{spacing:6,align:"stretch",children:[s(k,{children:[e(v,{color:f,children:n("theme.customName")}),e(ye,{placeholder:n("theme.customNamePlaceholder")||"",value:O.name,onChange:T=>ee(M=>({...M,name:T.target.value}))})]}),s(He,{columns:{base:1,md:2},spacing:4,children:[U("light"),U("dark")]}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(ke,{spacing:4,children:[s(k,{children:[e(v,{color:f,children:n("theme.lightPrimary")}),e(ye,{type:"color",value:O.light.primary,onChange:T=>ee(M=>({...M,light:{...M.light,primary:T.target.value}}))}),e(kr,{color:f,children:n("theme.lightPrimaryHint")})]}),s(k,{children:[e(v,{color:f,children:n("theme.lightSurface")}),e(ye,{type:"color",value:O.light.surface,onChange:T=>ee(M=>({...M,light:{...M.light,surface:T.target.value}}))}),e(kr,{color:f,children:n("theme.lightSurfaceHint")})]}),s(k,{children:[e(v,{color:f,children:n("theme.lightBackground")}),e(ye,{type:"color",value:O.light.bg,onChange:T=>ee(M=>({...M,light:{...M.light,bg:T.target.value}}))})]})]}),s(ke,{spacing:4,children:[s(k,{children:[e(v,{color:f,children:n("theme.darkPrimary")}),e(ye,{type:"color",value:O.dark.primary,onChange:T=>ee(M=>({...M,dark:{...M.dark,primary:T.target.value}}))}),e(kr,{color:f,children:n("theme.darkPrimaryHint")})]}),s(k,{children:[e(v,{color:f,children:n("theme.darkSurface")}),e(ye,{type:"color",value:O.dark.surface,onChange:T=>ee(M=>({...M,dark:{...M.dark,surface:T.target.value}}))}),e(kr,{color:f,children:n("theme.darkSurfaceHint")})]}),s(k,{children:[e(v,{color:f,children:n("theme.darkBackground")}),e(ye,{type:"color",value:O.dark.bg,onChange:T=>ee(M=>({...M,dark:{...M.dark,bg:T.target.value}}))})]})]})]}),s(R,{children:[s(z,{mb:2,children:[e(Si,{}),e(h,{fontWeight:"semibold",children:n("theme.presets")})]}),e(He,{columns:{base:1,md:3},spacing:3,children:bi.map(T=>e(Y,{size:"sm",variant:"outline",onClick:()=>ee({name:n(`theme.presets.${T.key}.name`),light:{...T.light},dark:{...T.dark}}),children:n(`theme.presets.${T.key}.name`)},T.key))})]})]})}),s(It,{children:[e(Y,{variant:"ghost",mr:3,onClick:i.onClose,children:n("cancel")}),e(Y,{colorScheme:"primary",onClick:Q,children:n(D?"theme.customUpdate":"theme.customSave")})]})]})]}),s(Nt,{isOpen:a.isOpen,onClose:a.onClose,size:"lg",isCentered:!0,children:[e(ht,{bg:_,backdropFilter:"blur(4px)"}),s(zt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:g,children:[e(mt,{color:g,children:n("theme.importTitle")}),e(Pt,{}),e(pt,{children:s(le,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:f,children:n("theme.importDescription")}),e(ur,{rows:8,placeholder:n("theme.importPlaceholder")||"",value:A,onChange:T=>I(T.target.value),bg:"transparent",borderColor:p,color:g})]})}),s(It,{children:[e(Y,{variant:"ghost",mr:3,onClick:a.onClose,children:n("cancel")}),e(Y,{colorScheme:"primary",onClick:P,children:n("theme.importAction")})]})]})]})]})},Sd=Pe.object({username:Pe.string().min(1,"login.fieldRequired"),password:Pe.string().min(1,"login.fieldRequired")}),xd=Z("img",{baseStyle:{w:12,h:12}}),kd=Z(Wl,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),wd=Z(bn,{baseStyle:{w:4,h:4}}),vd=Z(Ga,{baseStyle:{w:4,h:4}}),ki=()=>{var w,b;const[t,n]=d.exports.useState(""),[r,l]=d.exports.useState(!1),[o,i]=d.exports.useState(!1),a=Fl(),{t:c}=Fe();let u=Xa();const{register:p,formState:{errors:g},handleSubmit:f}=vr({resolver:ha(Sd)});d.exports.useEffect(()=>{jc(),u.pathname!=="/login"&&a("/login",{replace:!0})},[]);const _=y=>{n("");const C=new FormData;C.append("username",y.username),C.append("password",y.password),C.append("grant_type","password"),l(!0),_e("/admin/token",{method:"post",body:C}).then(({access_token:E})=>{console.log("Token received:",E),Zc(E),a("/")}).catch(E=>{var O,ee;n(((ee=(O=E.response)==null?void 0:O._data)==null?void 0:ee.detail)||"Login failed")}).finally(()=>l(!1))};return e(le,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(Lr,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:s(Kr,{children:[s(z,{justifyContent:"end",spacing:2,mb:6,children:[e($o,{}),e(qo,{minimal:!0})]}),s(le,{alignItems:"center",w:"full",spacing:4,children:[e(xd,{src:sd,alt:c("appName")||"Rebecca"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(R,{w:"full",pt:"4",children:e("form",{onSubmit:f(_),children:s(le,{spacing:4,children:[e(k,{children:e(sr,{w:"full",placeholder:c("username"),...p("username"),error:c((w=g==null?void 0:g.username)==null?void 0:w.message)})}),s(k,{isInvalid:!!g.password,children:[s(gr,{children:[e(ye,{w:"full",type:o?"text":"password",placeholder:c("password"),...p("password")}),e(wr,{children:e(ze,{"aria-label":o?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>i(!o),icon:o?e(vd,{}):e(wd,{})})})]}),e(Br,{children:(b=g.password)==null?void 0:b.message})]}),t&&s(hr,{status:"error",rounded:"md",children:[e(pr,{}),e(as,{children:t})]}),s(Y,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(kd,{marginRight:1}),c("login")]})]})})})]})})})},Cd=async()=>await _e("/admin"),Ss=()=>{const{data:t,isError:n,isLoading:r,isSuccess:l,error:o}=Gr({queryFn:()=>Cd()});return{userData:t||{is_sudo:!1,telegram_id:"",username:"",users_usage:0},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:n,getUserError:o}},Qr={baseStyle:{w:5,h:5}},_d=Z(Hl,Qr),Dd=Z(xo,Qr),Ad=Z(Bl,Qr),va=Z(Vl,Qr),Id=Z($l,Qr),Td=Z(Kl,Qr),Pd=Z(pa,Qr),Ed=Z(ko,Qr),Nd=Z(wo,Qr),wi=({collapsed:t,inDrawer:n=!1})=>{const{t:r}=Fe(),l=Xa(),{userData:o,getUserIsSuccess:i}=Ss(),a=i&&o.is_sudo,u=[...[{title:r("header.hostSettings"),url:"/hosts",icon:Ad},{title:r("header.nodeSettings"),url:"/node-settings",icon:Id},{title:r("header.integrationSettings","Master Settings"),url:"/integrations",icon:va},{title:r("header.xraySettings"),url:"/xray-settings",icon:va}]];a&&u.unshift({title:r("services.menu","Services"),url:"/services",icon:Ed});const p=u.some(w=>l.pathname===w.url),[g,f]=d.exports.useState(p);d.exports.useEffect(()=>{p&&f(!0)},[p]);const _=[{title:r("dashboard"),url:"/",icon:_d},{title:r("users"),url:"/users",icon:Dd}];return a&&(_.push({title:r("usage.menu","Usage"),url:"/usage",icon:Nd}),_.push({title:r("admins","Admins"),url:"/admins",icon:Td}),_.push({title:r("header.settings"),icon:va,subItems:u})),e(R,{w:n?"full":t?"16":"60",h:n?"100%":"100vh",maxH:n?"100%":"100vh",bg:"surface.light",borderRight:n?void 0:"1px",borderColor:n?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:n?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:n?"relative":"fixed",top:n?void 0:"0",left:n?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:s(le,{spacing:1,p:4,align:"stretch",children:[!t&&e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},px:2,mb:2,children:r("menu")}),_.map(w=>{const b=w.url,y=typeof b=="string"&&l.pathname===b||typeof b=="string"&&b!=="/"&&l.pathname.startsWith(b)||w.subItems&&w.subItems.some(E=>l.pathname===E.url),C=w.icon;return e(R,{children:w.subItems?s(Lt,{children:[s(z,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:y?"primary.50":"transparent",color:y?"primary.600":"gray.700",_dark:{bg:y?"primary.900":"transparent",color:y?"primary.200":"gray.300"},_hover:{bg:y?"primary.50":"gray.50",_dark:{bg:y?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>f(!g),children:[s(z,{children:[e(C,{}),!t&&e(h,{fontSize:"sm",fontWeight:y?"semibold":"normal",children:w.title})]}),!t&&e(Pd,{transform:g?"rotate(180deg)":"rotate(0deg)"})]}),!t&&e(yn,{in:g,animateOpacity:!0,children:e(le,{align:"stretch",pl:6,spacing:1,mt:2,children:w.subItems.map(E=>{const O=l.pathname===E.url,ee=E.icon;return e(di,{to:E.url,children:s(z,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:O?"primary.50":"transparent",color:O?"primary.600":"gray.700",_dark:{bg:O?"primary.900":"transparent",color:O?"primary.200":"gray.300"},_hover:{bg:O?"primary.50":"gray.50",_dark:{bg:O?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(ee,{}),e(h,{fontSize:"sm",fontWeight:O?"semibold":"normal",children:E.title})]})},E.url)})})})]}):w.url?e(di,{to:w.url,children:s(z,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:y?"primary.50":"transparent",color:y?"primary.600":"gray.700",_dark:{bg:y?"primary.900":"transparent",color:y?"primary.200":"gray.300"},_hover:{bg:y?"primary.50":"gray.50",_dark:{bg:y?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(C,{}),!t&&e(h,{fontSize:"sm",fontWeight:y?"semibold":"normal",children:w.title})]})}):null},w.title)})]})})},ea=Jl,zd="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",Yo={base:zd,folder:"apple/64",ext:".png",className:"apple-emoji"},Ca=t=>{var n,r;return typeof t=="string"&&((r=(n=ea.test)==null?void 0:n.call(ea,t))!=null?r:!1)},Rd=t=>t.some(n=>{var r;return n.type==="characterData"?Ca((r=n.target)==null?void 0:r.data):n.type==="childList"?Array.from(n.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return Ca(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const o=l;return o.tagName==="IMG"&&o.classList.contains(Yo.className)?!1:Ca(o.textContent)}return!1}):!1}),Ud=()=>{const t=Xa();d.exports.useEffect(()=>{const n=document.getElementById("root");if(!n)return;const r=()=>{ea.parse(n,Yo)};r();const l=new MutationObserver(o=>{Rd(o)&&requestAnimationFrame(r)});return l.observe(n,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},Go={baseStyle:{w:4,h:4}},Ld=Z(ql,Go),Md=Z(vo,Go);function Od(){const[t,n]=d.exports.useState(!1),r=or({base:!0,md:!1}),l=Yt();return Ud(),s(yt,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(wi,{collapsed:t}),s(yt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[s(R,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(ze,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():n(!t)},icon:e(Md,{})}),s(z,{spacing:2,children:[e($o,{}),e(qo,{}),e(Yl,{to:"/login",children:e(ze,{size:"sm",variant:"outline","aria-label":"logout",icon:e(Ld,{})})})]})]}),e(R,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(Gl,{})})]}),r&&s(Co,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(ht,{}),e(_o,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(pt,{p:0,children:e(wi,{collapsed:!1,inDrawer:!0})})})]})]})}const Xo="marzban-num-users-per-page",vi=10,Wd=()=>{const t=localStorage.getItem(Xo)||vi.toString();return parseInt(t)||vi},Fd=t=>localStorage.setItem(Xo,t),Hd=t=>{for(const n in t)t[n]||delete t[n];return ut.setState({loading:!0}),_e("/users",{query:t}).then(n=>{var i,a;const r=(i=n.users_limit)!=null?i:null,l=(a=n.active_total)!=null?a:null,o=r!=null&&r>0&&l!==null?l>=r:!1;return ut.setState({users:n,isUserLimitReached:o}),n}).finally(()=>{ut.setState({loading:!1})})},kn=()=>_e("/inbounds").then(t=>{ut.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{ut.setState({loading:!1})}),ut=$s(Xl((t,n)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Wd(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{Hd(n().filters)},resetAllUsage:()=>_e("/users/reset",{method:"POST"}).then(()=>{n().onResetAllUsage(!1),n().refetchUsers()}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...n().filters,...r}}),n().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),_e(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),n().refetchUsers(),Zn.invalidateQueries(ta)})),createUser:r=>_e("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(),Zn.invalidateQueries(ta)}),createUserWithService:r=>_e("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(),Zn.invalidateQueries(ta)}),editUser:(r,l)=>_e(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{n().onEditingUser(null),n().refetchUsers()}),fetchUserUsage:(r,l)=>{for(const o in l)l[o]||delete l[o];return _e(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>_e(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),n().refetchUsers()}),revokeSubscription:r=>_e(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),n().refetchUsers()}),onEditingCore:r=>t({isEditingCore:r})})));function Je(t,n=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,o=n<0?0:n,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(l)),c=parseFloat((t/Math.pow(l,a)).toFixed(o));return r?[c,i[a]]:`${c} ${i[a]}`}const Ci=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Bd=Z(xo,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Vd=Z(Ql,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),_i=({title:t,content:n,icon:r})=>s(Lr,{p:6,borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[s(z,{alignItems:"center",columnGap:"4",children:[e(R,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:r}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(R,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:n})]}),ta="statistics-query-key",$d=t=>{var i;const{version:n}=ut(),{userData:r}=Ss(),{data:l}=Gr({queryKey:ta,queryFn:()=>_e("/system"),refetchInterval:6e5,onSuccess:({version:a})=>{n!==a&&ut.setState({version:a})}}),{t:o}=Fe();return s(z,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(_i,{title:o("activeUsers"),content:l&&s(z,{alignItems:"flex-end",children:[e(h,{children:Ci(l.users_active)}),s(h,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Ci(l.total_user)]})]}),icon:e(Bd,{})}),e(_i,{title:o("UsersUsage"),content:Je((i=r.users_usage)!=null?i:0),icon:e(Vd,{})})]})},Kd=()=>{const{t}=Fe();return e(le,{spacing:6,align:"stretch",children:s(R,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e($d,{})]})})},gs=({children:t,color:n})=>e(R,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${n}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${n}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${n}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${n}.400`}},children:e(h,{color:`${n}.500`,_dark:{color:`${n}.900`},position:"relative",zIndex:"2",children:t})}),En=Z(Mr,{baseStyle:{w:5,h:5}}),Jd=()=>{const[t,n]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:o}=ut(),{t:i}=Fe(),a=Mt(),c=()=>{l(null)},u=()=>{r&&(n(!0),o(r).then(()=>{a({title:i("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(n.bind(null,!1)))};return s(Nt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(mt,{pt:6,children:e(gs,{color:"red",children:e(En,{})})}),e(Pt,{mt:3}),s(pt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:r.username})})})]}),s(It,{display:"flex",children:[e(Y,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(wt,{size:"xs"}):void 0,children:i("delete")})]})]})]})},qd={search:"",limit:10,offset:0,sort:"username"},Zr=$s((t,n)=>({admins:[],total:0,loading:!1,filters:qd,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=n(),o={...l,...r},i={};o.search&&(i.username=o.search),o.offset!==void 0&&(i.offset=o.offset),o.limit!==void 0&&(i.limit=o.limit),o.sort&&(o.sort==="data_usage"?i.sort="users_usage":o.sort==="data_limit"?i.sort="data_limit":i.sort=o.sort),t({loading:!0});try{const a=await _e("/admins",{query:i}),{admins:c,total:u}=Array.isArray(a)?{admins:a,total:a.length}:{admins:a.admins||[],total:a.total||0};t(p=>{const g=p.adminInDetails?c.find(f=>{var _;return f.username===((_=p.adminInDetails)==null?void 0:_.username)})||p.adminInDetails:null;return{admins:c,total:u,adminInDetails:g}})}catch(a){console.error("Failed to fetch admins:",a),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),n().fetchAdmins()},async createAdmin(r){await _e("/admin",{method:"POST",body:r}),await n().fetchAdmins()},async updateAdmin(r,l){await _e(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await n().fetchAdmins()},async deleteAdmin(r){await _e(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await n().fetchAdmins()},async resetUsage(r){await _e(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await n().fetchAdmins()},async disableUsers(r){await _e(`/admin/${encodeURIComponent(r)}/users/disable`,{method:"POST"})},async activateUsers(r){await _e(`/admin/${encodeURIComponent(r)}/users/activate`,{method:"POST"})},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),ga={baseStyle:{w:4,h:4}},Yd=Z(Do,ga),Gd=Z(Ya,ga),Qo=Z(Or,ga),Xd=Z(Xr,ga),Qd=Zl((t,n)=>{n==="users"?ut.getState().onFilterChange({...ut.getState().filters,offset:0,search:t}):Zr.getState().onFilterChange({search:t,offset:0})},300),Zo=({for:t="users",...n})=>{var A;const{loading:r,filters:l,onFilterChange:o,refetchUsers:i,onCreateUser:a}=ut(),{loading:c,filters:u,onFilterChange:p,fetchAdmins:g,openAdminDialog:f}=Zr(),{t:_}=Fe(),[w,b]=d.exports.useState(""),y=t==="users"?r:c,C=t==="users"?l:u,E=I=>{b(I.target.value),Qd(I.target.value,t)},O=()=>{b(""),t==="users"?o({...C,offset:0,search:""}):p({search:"",offset:0})},ee=()=>{t==="users"?i():g()},D=()=>{t==="users"?a(!0):f()},F=(A=or({base:!0,sm:!1}))!=null?A:!1;return s(Qa,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...n,children:[e(hs,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:s(z,{spacing:2,align:"center",w:"full",children:[s(gr,{flex:"1",children:[e(Ao,{pointerEvents:"none",children:e(Yd,{})}),e(ye,{placeholder:t==="users"?_("search"):_("admins.searchPlaceholder","Search admins..."),value:w,borderColor:"light-border",w:"full",onChange:E}),s(wr,{children:[y&&e(wt,{size:"xs"}),C.search&&C.search.length>0&&e(ze,{onClick:O,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Gd,{})})]})]}),e(ze,{"aria-label":"refresh",disabled:y,onClick:ee,size:F?"sm":"md",variant:F?"ghost":"outline",borderRadius:"full",minW:F?"36px":"40px",h:F?"36px":void 0,children:e(Qo,{className:da({"animate-spin":y})})})]})}),e(hs,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(ke,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:e(Y,{colorScheme:"primary",size:F?"sm":"md",onClick:D,px:F?3:5,leftIcon:F?void 0:e(Xd,{}),w:"auto",h:F?"36px":void 0,minW:F?"auto":"8.5rem",fontSize:F?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?_("createUser"):_("admins.addAdmin","Add admin")})})})]})},Zd=Z(jl,{baseStyle:{w:4,h:4}}),jd=Z(ec,{baseStyle:{w:4,h:4}}),Di=5;function eu(t,n,r){if(r<Di)throw new Error(`Must allow at least ${Di} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,n-Math.floor(r/2))),o=new Array(r);for(let i=0;i<r;i+=1)o[i]=i+l;return typeof o[0]=="number"&&o[0]>0&&(o[0]=0,o[1]="prev-more"),o[o.length-1]<t-1&&(o[o.length-1]=t-1,o[o.length-2]="next-more"),o}const jo=({for:t="users"})=>{const{filters:n,onFilterChange:r,users:{total:l}}=ut(),{filters:o,onFilterChange:i,total:a}=Zr(),{t:c}=Fe(),{filters:u,total:p,onFilterChange:g}=d.exports.useMemo(()=>t==="admins"?{filters:o,total:a,onFilterChange:i}:{filters:n,total:l,onFilterChange:r},[t,o,a,i,n,l,r]),{limit:f,offset:_}=u,w=Number(f||10),b=Number(_||0),y=Math.floor(b/w),C=Math.ceil(p/w),E=eu(C,y,7),O=A=>{g({...u,offset:A*w})},ee=A=>{const I=parseInt(A.target.value,10);g({...u,limit:I,offset:0}),t==="users"&&Fd(A.target.value)},D=d.exports.useMemo(()=>y>0&&C>0,[y,C]),F=d.exports.useMemo(()=>y+1<C&&C>0,[y,C]);return p<=w&&y===0?null:s(z,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(R,{order:{base:2,md:1},children:s(z,{children:[s(qe,{minW:"60px",value:String(w),onChange:ee,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),s(Io,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(Y,{leftIcon:e(Zd,{}),onClick:()=>O(y-1),isDisabled:!D,children:c("previous")}),E.map(A=>typeof A=="string"?e(Y,{children:"..."},A):e(Y,{variant:A===y?"solid":"outline",onClick:()=>O(A),children:A+1},A)),e(Y,{rightIcon:e(jd,{}),onClick:()=>O(y+1),isDisabled:!F,children:c("next")})]})]})},tu=tc;const Ai=Z(rc),ru=Z(To,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),su=Z(sc,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),nu=Z(Po,{baseStyle:{w:5,h:5}}),au=()=>{const{QRcodeLinks:t,setQRCode:n,setSubLink:r,subscribeUrl:l}=ut(),o=t!==null,[i,a]=d.exports.useState(0),{t:c}=Fe(),u=()=>{n(null),r(null)},p=String(l).startsWith("/")?window.location.origin+l:String(l);return s(Nt,{isOpen:o,onClose:u,children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(mt,{pt:6,children:e(gs,{color:"primary",children:e(nu,{color:"white"})})}),e(Pt,{mt:3}),t&&s(pt,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&s(le,{children:[e(Ai,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),s(R,{w:"300px",children:[e(tu,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:a,onInit:()=>a(0),nextArrow:e(ze,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(ru,{})}),prevArrow:e(ze,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(su,{})}),children:t.map((g,f)=>e(z,{children:e(Ai,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:g,bg:"white"})},f))}),s(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},iu=Z(Or,{baseStyle:{w:5,h:5}}),ou=()=>{const[t,n]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=ut(),{t:o}=Fe(),i=Mt(),a=()=>{ut.setState({resetUsageUser:null})},c=()=>{r&&(n(!0),l(r).then(()=>{i({title:o("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(Nt,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(mt,{pt:6,children:e(gs,{color:"blue",children:e(iu,{})})}),e(Pt,{mt:3}),s(pt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:o("resetUserUsage.prompt",{username:r.username})})})]}),s(It,{display:"flex",children:[e(Y,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(wt,{size:"xs"}):void 0,children:o("reset")})]})]})]})},lu=Z(Or,{baseStyle:{w:5,h:5}}),cu=()=>{const[t,n]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=ut(),{t:o}=Fe(),i=Mt(),a=()=>{ut.setState({revokeSubscriptionUser:null})},c=()=>{r&&(n(!0),l(r).then(()=>{i({title:o("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(Nt,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(mt,{pt:6,children:e(gs,{color:"blue",children:e(lu,{})})}),e(Pt,{mt:3}),s(pt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:o("revokeUserSub.prompt",{username:r.username})})})]}),s(It,{display:"flex",children:[e(Y,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(wt,{size:"xs"}):void 0,children:o("revoke")})]})]})]})},Nn={baseStyle:{strokeWidth:"2px",w:4,h:4}},Ii=Z(nc,Nn),du=Z(ac,Nn),Ti=Z(ic,Nn),Pi=Z(Eo,Nn),uu=Z(Eo,Nn),Fa=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],ps={active:{statusColor:"green",bandWidthColor:"primary",icon:Ii},connected:{statusColor:"green",bandWidthColor:"primary",icon:Ii},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:du},expired:{statusColor:"orange",bandWidthColor:"orange",icon:Pi},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:uu},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:Pi},limited:{statusColor:"red",bandWidthColor:"red",icon:Ti},error:{statusColor:"red",bandWidthColor:"red",icon:Ti}},Os=$s((t,n)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await _e("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await _e(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await _e("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await n().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const o=await _e(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:o}),await n().fetchServices(),o}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await _e(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await n().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await _e(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await n().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),fa=t=>{let n={status:"",time:""};if(t){We(t*1e3).utc().isAfter(We().utc())?n.status="expires":n.status="expired";const r=[],l=We.duration(We(t*1e3).utc().diff(We()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),n.time=r.join(", ")}return n},zn=d.exports.forwardRef((t,n)=>e(oc,{...t,ref:n}));zn.displayName="DatePicker";function hu(t){const n=360/t,r=90,l=47,o=[];for(let i=0;i<t;i++){const a=i*n%360+140,c=pu(a,r,l);o.push(c)}return o}function pu(t,n,r){t/=360,n/=100,r/=100;let l,o,i;if(n===0)l=o=i=r;else{const c=(g,f,_)=>(_<0&&(_+=1),_>1&&(_-=1),_<.16666666666666666?g+(f-g)*6*_:_<.5?f:_<.6666666666666666?g+(f-g)*(.6666666666666666-_)*6:g),u=r<.5?r*(1+n):r+n-r*n,p=2*r-u;l=Math.round(c(p,u,t+1/3)*255),o=Math.round(c(p,u,t)*255),i=Math.round(c(p,u,t-1/3)*255)}const a=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${a(l)}${a(o)}${a(i)}`}const Ei=({border:t,...n})=>{const{getInputProps:r,getRadioProps:l}=dc(n),o=or({base:"xs",md:"sm"});return s(R,{as:"label",children:[e("input",{...r()}),e(R,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:o,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:n.children})]})},mu=({onChange:t,defaultValue:n,...r})=>{const{t:l,i18n:o}=Fe();os();const i=or({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),a={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=or({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:p,setValue:g}=lc({name:"filter",defaultValue:n,onChange:Q=>{if(Q==="custom")return;w(),i.indexOf(Q)>=0?(C(l("userDialog.custom")),O(!1)):(C(l("userDialog.custom")+` (${Q})`),O(!0));const de=Number(Q.substring(0,Q.length-1)),ne=a[Q[Q.length-1]];t(Q,{start:We().utc().subtract(de,ne).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:f,onOpen:_,onClose:w}=Yt(),b=d.exports.useRef(null);cc({ref:b,handler:w});const[y,C]=d.exports.useState(l("userDialog.custom")),[E,O]=d.exports.useState(!1),[ee,D]=d.exports.useState(0),F=or({base:1,md:2}),A=or({base:"xs",md:"sm"}),[I,De]=d.exports.useState(null),[ge,te]=d.exports.useState(null),L=Q=>{const[de,ne]=Q;ge&&!ne?(De(null),te(null)):(De(de),te(ne),de&&ne&&(w(),t("custom",{start:We(de).format("YYYY-MM-DDT00:00:00"),end:We(ne).format("YYYY-MM-DDT23:59:59")})))};return s(le,{...r,children:[ee==0&&s(He,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(Q=>e(Ei,{...p({value:Q}),children:Q},Q)),e(R,{onClick:()=>{De(null),te(null),_()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:A,px:3,py:1,bg:E?"primary.500":"unset",color:E?"white":"unset",borderColor:E?"primary.500":"unset",children:s(z,{children:[e(h,{children:y}),e(mn,{as:ui,boxSize:"18px"})]})})]}),ee==1&&s(z,{onClick:_,cursor:"pointer",fontSize:A,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:I?"unset":"gray.500",children:I?We(I).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(mn,{as:To,boxSize:"18px"}),e(h,{w:"full",color:ge?"unset":"gray.500",children:ge?We(ge).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(mn,{as:ui,boxSize:"18px"})]}),e(le,{ref:b,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:f?"unset":"none",children:s(Ks,{onChange:Q=>D(Q),children:[s(Js,{children:[e(Vt,{fontSize:A,children:l("userDialog.relative")}),e(Vt,{fontSize:A,children:l("userDialog.absolute")})]}),s(qs,{children:[e($t,{children:c.map(Q=>e(le,{alignItems:"start",pl:2,pr:2,children:s(z,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:A,minW:"60px",children:l("userDialog."+Q.title)}),Q.options.map(de=>e(Ei,{border:!0,...p({value:de}),children:de},de+".custom"))]})},Q.title))}),e($t,{className:"datepicker-panel",children:e(le,{children:e(zn,{locale:o.language.toLocaleLowerCase(),selected:I,onChange:L,startDate:I,endDate:ge,selectsRange:!0,maxDate:new Date,monthsShown:F,peekNextMonth:!1,inline:!0})})})]})]})})]})};function la(t,n,r=[],l=[]){const o=Je(r.reduce((i,a)=>i+=a,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${n}${o}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:a,w:c})=>Je(c.config.series[a],1)},tooltip:{custom:({series:i,seriesIndex:a,dataPointIndex:c,w:u})=>{const p=Je(i[a],1),g=Math.max(i.reduce((_,w)=>_+=w),1),f=Math.round(i[a]/g*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[a]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[a]}: <b>${f}, ${p}</b>
            </div>
          `}},colors:hu(r.length)}}}const gu=Z(uc,{baseStyle:{w:5,h:5}}),fu=Z(is,{baseStyle:{w:5,h:5}}),bu=Z(wo,{baseStyle:{w:5,h:5}}),yu=Z(hc,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});Z(ua,{baseStyle:{w:4,h:4}});const Su=t=>{var r,l,o,i,a;const n=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(n),next_plan_data_limit:n!=null&&n.data_limit?Number((n.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(o=n==null?void 0:n.expire)!=null?o:null,next_plan_add_remaining_traffic:(i=n==null?void 0:n.add_remaining_traffic)!=null?i:!1,next_plan_fire_on_either:(a=n==null?void 0:n.fire_on_either)!=null?a:!0}},Ni=()=>({data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),js={username:Pe.string().min(1,{message:"Required"}),note:Pe.string().nullable(),service_id:Pe.union([Pe.string(),Pe.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),proxies:Pe.record(Pe.string(),Pe.record(Pe.string(),Pe.any())).transform(t=>{const n=(r,l)=>{r&&r[l]===""&&delete r[l]};return n(t.vmess,"id"),n(t.vless,"id"),n(t.trojan,"password"),n(t.shadowsocks,"password"),n(t.shadowsocks,"method"),t}),data_limit:Pe.string().min(0).or(Pe.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:Pe.number().nullable(),data_limit_reset_strategy:Pe.string(),inbounds:Pe.record(Pe.string(),Pe.array(Pe.string())).transform(t=>(Object.keys(t).forEach(n=>{var r;Array.isArray(t[n])&&!((r=t[n])!=null&&r.length)&&delete t[n]}),t)),next_plan_enabled:Pe.boolean().default(!1),next_plan_data_limit:Pe.union([Pe.string(),Pe.number(),Pe.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:Math.max(0,n)}),next_plan_expire:Pe.union([Pe.number(),Pe.string(),Pe.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),next_plan_add_remaining_traffic:Pe.boolean().default(!1),next_plan_fire_on_either:Pe.boolean().default(!0)},xu=Pe.discriminatedUnion("status",[Pe.object({status:Pe.literal("active"),...js}),Pe.object({status:Pe.literal("disabled"),...js}),Pe.object({status:Pe.literal("limited"),...js}),Pe.object({status:Pe.literal("expired"),...js}),Pe.object({status:Pe.literal("on_hold"),on_hold_expire_duration:Pe.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...js})]),ku=()=>{var ft,Ct,Rt,Kt,jt,Gt,er,Ft;const{editingUser:t,isCreatingNewUser:n,onCreateUser:r,editUser:l,fetchUserUsage:o,onEditingUser:i,createUserWithService:a,onDeletingUser:c,users:u,isUserLimitReached:p}=ut(),g=!!t,f=n||g,_=(ft=u.users_limit)!=null?ft:null,w=(Ct=u.active_total)!=null?Ct:null,b=p&&!g,[y,C]=d.exports.useState(!1),[E,O]=d.exports.useState(""),ee=Mt(),{t:D}=Fe(),{colorMode:F}=os(),A=vr({defaultValues:Ni(),resolver:ha(xu)}),I=A.getValues("expire"),De=A.getValues("next_plan_expire");function ge(B){if(typeof B!="number"||B<=0)return null;const ve=We.unix(B).utc().local(),Ye=We(),tt=ve.diff(Ye,"day",!0);return Number.isFinite(tt)?Math.max(0,Math.round(tt)):null}function te(B){return We().add(B,"day").endOf("day").utc().unix()}const[L,Q]=d.exports.useState(()=>ge(I)),[de,ne]=d.exports.useState(()=>ge(De)),ie=Os(B=>B.services),P=Os(B=>B.isLoading),{userData:ue,getUserIsSuccess:Te}=Ss(),Ie=Boolean(Te&&ue.is_sudo),[U,T]=d.exports.useState(null),M=ie.length>0,ce=U&&(Rt=ie.find(B=>B.id===U))!=null?Rt:null,$=Boolean(t==null?void 0:t.service_id),[Se,Ee]=d.exports.useState(!1),we=()=>{Ee(B=>!B)};d.exports.useEffect(()=>{f&&Os.getState().fetchServices()},[f]),d.exports.useEffect(()=>{var B,ve;g?t!=null&&t.service_id?T(t.service_id):Ie?T(null):ie.length?T((ve=(B=ie[0])==null?void 0:B.id)!=null?ve:null):T(null):f||T(null)},[g,t,f,Ie,ie]),d.exports.useEffect(()=>{!g&&f&&M&&T(B=>{var ve,Ye;return(Ye=B!=null?B:(ve=ie[0])==null?void 0:ve.id)!=null?Ye:null})},[ie,g,f,M]),d.exports.useEffect(()=>{!g&&f&&!M&&T(null)},[M,g,f]);const[Oe,X]=Wt({control:A.control,name:["data_limit","status"]}),xe=Wt({control:A.control,name:"next_plan_enabled"}),G=Wt({control:A.control,name:"expire"}),pe=Wt({control:A.control,name:"next_plan_data_limit"}),Ce=Wt({control:A.control,name:"next_plan_expire"}),Ge=Wt({control:A.control,name:"next_plan_add_remaining_traffic"}),ae=Wt({control:A.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const B=ge(G);Q(ve=>ve===B?ve:B)},[G]),d.exports.useEffect(()=>{const B=ge(Ce);ne(ve=>ve===B?ve:B)},[Ce]);const re=B=>{A.setValue("next_plan_enabled",B,{shouldDirty:!0}),B?(A.getValues("next_plan_data_limit")===null&&A.setValue("next_plan_data_limit",0,{shouldDirty:!1}),A.getValues("next_plan_add_remaining_traffic")===void 0&&A.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),A.getValues("next_plan_fire_on_either")===void 0&&A.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(A.setValue("next_plan_data_limit",null,{shouldDirty:!0}),A.setValue("next_plan_expire",null,{shouldDirty:!0}),ne(null))},oe=D("userDialog.total"),[K,fe]=d.exports.useState(la(F,oe)),[dt,Ve]=d.exports.useState("1m"),q=B=>{o(t,B).then(ve=>{const Ye=[],tt=[];for(const St in ve.usages)tt.push(ve.usages[St].used_traffic),Ye.push(ve.usages[St].node_name);fe(la(F,oe,tt,Ye))})};d.exports.useEffect(()=>{t&&(A.reset(Su(t)),q({start:We().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[t,g,f]);const x=B=>{if(b)return;C(!0),O(null);const{service_id:ve,next_plan_enabled:Ye,next_plan_data_limit:tt,next_plan_expire:St,next_plan_add_remaining_traffic:H,next_plan_fire_on_either:he,proxies:J,inbounds:Xe,status:nt,data_limit:Ke,data_limit_reset_strategy:ot,on_hold_expire_duration:_t,...Jt}=B,bt=Ye&&tt&&tt>0?Number((Number(tt)*1073741824).toFixed(5)):0,Ot=Ye?{data_limit:bt,expire:St!=null?St:0,add_remaining_traffic:H,fire_on_either:he}:null;if(!g){if(!U){O(D("userDialog.selectService","Please choose a service")),C(!1);return}const xt={username:B.username,service_id:U,note:B.note,status:B.status==="active"||B.status==="disabled"||B.status==="on_hold"?B.status:"active",expire:B.expire,data_limit:B.data_limit,data_limit_reset_strategy:Ke&&Ke>0?ot:"no_reset",on_hold_expire_duration:nt==="on_hold"?_t:null};Ot&&(xt.next_plan=Ot),a(xt).then(()=>{ee({title:D("userDialog.userCreated",{username:B.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),N()}).catch(kt=>{var fr,Et,nr,br,lr;(((fr=kt==null?void 0:kt.response)==null?void 0:fr.status)===409||((Et=kt==null?void 0:kt.response)==null?void 0:Et.status)===400)&&O((br=(nr=kt==null?void 0:kt.response)==null?void 0:nr._data)==null?void 0:br.detail),((lr=kt==null?void 0:kt.response)==null?void 0:lr.status)===422&&Object.keys(kt.response._data.detail).forEach(Cr=>{O(kt==null?void 0:kt.response._data.detail[Cr]),A.setError(Cr,{type:"custom",message:kt.response._data.detail[Cr]})})}).finally(()=>{C(!1)});return}const Ut={...Jt,data_limit:Ke,data_limit_reset_strategy:Ke&&Ke>0?ot:"no_reset",status:nt==="active"||nt==="disabled"||nt==="on_hold"?nt:"active",on_hold_expire_duration:nt==="on_hold"?_t:null};Ot?Ut.next_plan=Ot:!Ye&&(t==null?void 0:t.next_plan)&&(Ut.next_plan=null),t!=null&&t.service_id||(J&&Object.keys(J).length>0&&(Ut.proxies=J),Xe&&Object.keys(Xe).length>0&&(Ut.inbounds=Xe)),typeof U<"u"&&(U===null?Ie&&(Ut.service_id=null):U!==(t==null?void 0:t.service_id)&&(Ut.service_id=U)),l(t.username,Ut).then(()=>{ee({title:D("userDialog.userEdited",{username:B.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),N()}).catch(xt=>{var kt,fr,Et,nr,br;(((kt=xt==null?void 0:xt.response)==null?void 0:kt.status)===409||((fr=xt==null?void 0:xt.response)==null?void 0:fr.status)===400)&&O((nr=(Et=xt==null?void 0:xt.response)==null?void 0:Et._data)==null?void 0:nr.detail),((br=xt==null?void 0:xt.response)==null?void 0:br.status)===422&&Object.keys(xt.response._data.detail).forEach(lr=>{O(xt==null?void 0:xt.response._data.detail[lr]),A.setError(lr,{type:"custom",message:xt.response._data.detail[lr]})})}).finally(()=>{C(!1)})},N=()=>{A.reset(Ni()),r(!1),i(null),O(null),Ee(!1),Ve("1m"),T(null)},j=()=>{ut.setState({resetUsageUser:t})},Ne=()=>{ut.setState({revokeSubscriptionUser:t})},Ae=y||b,je=X==="on_hold",[gt,Tt]=d.exports.useState(!1),Ze=()=>{Tt(!0);let B="";const ve="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ye=ve.length;let tt=0;for(;tt<6;)B+=ve.charAt(Math.floor(Math.random()*Ye)),tt+=1;return B};return s(Nt,{isOpen:f,onClose:N,size:"2xl",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(pc,{...A,children:s(zt,{mx:"3",position:"relative",overflow:"hidden",children:[e(Pt,{mt:3,disabled:y}),e(R,{pointerEvents:b?"none":"auto",filter:b?"blur(6px)":"none",transition:"filter 0.2s ease",children:s("form",{onSubmit:A.handleSubmit(x),children:[e(mt,{pt:6,children:s(z,{gap:2,children:[e(gs,{color:"primary",children:g?e(fu,{color:"white"}):e(gu,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:D(g?"userDialog.editUserTitle":"createNewUser")})]})}),s(pt,{children:[g&&$&&s(hr,{status:"info",mb:4,borderRadius:"md",children:[e(pr,{}),D("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(Kt=t==null?void 0:t.service_name)!=null?Kt:""})]}),s(Qa,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(hs,{children:s(le,{justifyContent:"space-between",children:[s(yt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(yt,{flexDirection:"row",w:"full",gap:2,children:s(k,{mb:"10px",children:[e(v,{children:s(yt,{gap:2,alignItems:"center",children:[D("username"),!g&&e(Qo,{cursor:"pointer",className:da({"animate-spin":gt}),onClick:()=>{const B=Ze();A.setValue("username",B),setTimeout(()=>{Tt(!1)},350)}})]})}),s(z,{children:[e(sr,{size:"sm",type:"text",borderRadius:"6px",error:(jt=A.formState.errors.username)==null?void 0:jt.message,disabled:Ae||g,...A.register("username")}),g&&e(z,{px:1,children:e(at,{name:"status",control:A.control,render:({field:B})=>e(it,{placement:"top",label:"status: "+D(`status.${B.value}`),textTransform:"capitalize",children:e(R,{children:e(ct,{colorScheme:"primary",isChecked:B.value==="active",onChange:ve=>{ve.target.checked?B.onChange("active"):B.onChange("disabled")}})})})})})]})]})}),s(k,{mb:"10px",children:[e(v,{children:D("userDialog.dataLimit")}),e(at,{control:A.control,name:"data_limit",render:({field:B})=>{var ve;return e(sr,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:B.onChange,disabled:Ae,error:(ve=A.formState.errors.data_limit)==null?void 0:ve.message,value:B.value?String(B.value):""})}})]}),e(yn,{in:!!(Oe&&Oe>0),animateOpacity:!0,style:{width:"100%"},children:s(k,{height:"66px",children:[e(v,{children:D("userDialog.periodicUsageReset")}),e(at,{control:A.control,name:"data_limit_reset_strategy",render:({field:B})=>e(qe,{size:"sm",...B,disabled:Ae,bg:Ae?"gray.100":"transparent",_dark:{bg:Ae?"gray.600":"transparent"},sx:{option:{backgroundColor:F==="dark"?"#222C3B":"white"}},children:Fa.map(ve=>e("option",{value:ve.value,children:D("userDialog.resetStrategy"+ve.title)},ve.value))})})]})}),s(R,{mb:"10px",children:[s(z,{justify:"space-between",align:"center",children:[e(v,{mb:0,children:D("userDialog.nextPlanTitle","Next plan")}),e(ct,{colorScheme:"primary",isChecked:xe,onChange:B=>re(B.target.checked),isDisabled:Ae})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:D("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(yn,{in:xe,animateOpacity:!0,style:{width:"100%"},children:s(le,{align:"stretch",spacing:3,mt:3,children:[s(k,{children:[e(v,{fontSize:"sm",children:D("userDialog.nextPlanDataLimit","Next plan data limit")}),e(sr,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",disabled:Ae,value:pe!==null&&typeof pe<"u"?String(pe):"",onChange:B=>{const ve=B.target.value;if(!ve){A.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Ye=Number(ve);Number.isNaN(Ye)||A.setValue("next_plan_data_limit",Math.max(0,Ye),{shouldDirty:!0})}})]}),s(k,{children:[e(v,{fontSize:"sm",children:D("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(at,{control:A.control,name:"next_plan_expire",render:({field:B})=>{const ve=Ye=>{if(!Ye){ne(null),B.onChange(null);return}const tt=Number(Ye);if(Number.isNaN(tt)||tt<0)return;const St=Math.min(Math.round(tt),3650);ne(St);const H=te(St);B.onChange(H)};return s(z,{spacing:3,align:{base:"stretch",md:"flex-end"},flexWrap:"wrap",children:[e(R,{flex:"1",minW:"180px",children:e(Yr,{min:0,clampValueOnBlur:!1,value:typeof de=="number"?de:"",onChange:Ye=>ve(Ye),isDisabled:Ae,children:e(qr,{placeholder:D("userDialog.expiryDaysPlaceholder","e.g. 30")})})}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},whiteSpace:"nowrap",children:D("userDialog.days","Days")})]})}})]}),s(z,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:D("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(ct,{size:"sm",colorScheme:"primary",isChecked:Boolean(Ge),onChange:B=>A.setValue("next_plan_add_remaining_traffic",B.target.checked,{shouldDirty:!0}),isDisabled:Ae})]}),s(z,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:D("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(ct,{size:"sm",colorScheme:"primary",isChecked:Boolean(ae),onChange:B=>A.setValue("next_plan_fire_on_either",B.target.checked,{shouldDirty:!0}),isDisabled:Ae})]})]})})]}),s(k,{mb:"10px",isInvalid:!je&&Boolean(A.formState.errors.expire),children:[s(yt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(v,{mb:0,children:je?D("userDialog.onHoldExpireDuration"):D("userDialog.expiryDaysLabel","Expires in (days)")}),!g&&e(at,{name:"status",control:A.control,render:({field:B})=>s(z,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:D("userDialog.onHold")}),e(ct,{colorScheme:"primary",isChecked:B.value==="on_hold",onChange:ve=>B.onChange(ve.target.checked?"on_hold":"active"),isDisabled:Ae})]})})]}),je?e(at,{control:A.control,name:"on_hold_expire_duration",render:({field:B})=>{var ve;return e(sr,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Ye=>{A.setValue("expire",null),B.onChange({target:{value:Ye}})},disabled:Ae,error:(ve=A.formState.errors.on_hold_expire_duration)==null?void 0:ve.message,value:B.value?String(B.value):""})}}):s(Lt,{children:[e(at,{name:"expire",control:A.control,render:({field:B})=>{const{status:ve,time:Ye}=fa(B.value),tt=St=>{if(!St){Q(null),B.onChange(null);return}const H=Number(St);if(Number.isNaN(H)||H<0)return;const he=Math.min(Math.round(H),3650);Q(he),A.setValue("on_hold_expire_duration",null,{shouldDirty:!1});const J=te(he);B.onChange(J)};return s(z,{spacing:3,align:{base:"stretch",md:"flex-end"},flexWrap:"wrap",children:[s(R,{flex:"1",minW:"180px",children:[e(Yr,{min:0,clampValueOnBlur:!1,value:typeof L=="number"?L:"",onChange:St=>tt(St),isDisabled:Ae,children:e(qr,{placeholder:D("userDialog.expiryDaysPlaceholder","e.g. 30")})}),B.value?e(kr,{children:D(ve,{time:Ye})}):null]}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},whiteSpace:"nowrap",children:D("userDialog.days","Days")})]})}}),e(Br,{children:(Gt=A.formState.errors.expire)==null?void 0:Gt.message})]})]}),s(k,{mb:"10px",isInvalid:!!A.formState.errors.note,children:[e(v,{children:D("userDialog.note")}),e(ur,{...A.register("note")}),e(Br,{children:(Ft=(er=A.formState.errors)==null?void 0:er.note)==null?void 0:Ft.message})]})]}),E&&s(hr,{status:"error",display:{base:"none",md:"flex"},children:[e(pr,{}),E]})]})}),e(hs,{children:s(k,{isRequired:!g,children:[e(v,{children:D("userDialog.selectServiceLabel","Service")}),P?s(z,{spacing:2,py:4,children:[e(wt,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:D("loading")})]}):M?s(le,{align:"stretch",spacing:3,children:[g&&Ie&&s(R,{role:"button",tabIndex:Ae?-1:0,"aria-pressed":U===null,onKeyDown:B=>{Ae||(B.key==="Enter"||B.key===" ")&&(B.preventDefault(),T(null))},onClick:()=>{Ae||T(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:U===null?"primary.500":"gray.200",bg:U===null?"primary.50":"transparent",cursor:Ae?"not-allowed":"pointer",pointerEvents:Ae?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ae?{}:{borderColor:U===null?"primary.500":"gray.300"},_dark:{borderColor:U===null?"primary.400":"gray.700",bg:U===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:D("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:D("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),ie.map(B=>{const ve=U===B.id;return e(R,{role:"button",tabIndex:Ae?-1:0,"aria-pressed":ve,onKeyDown:Ye=>{Ae||(Ye.key==="Enter"||Ye.key===" ")&&(Ye.preventDefault(),T(B.id))},onClick:()=>{Ae||T(B.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:ve?"primary.500":"gray.200",bg:ve?"primary.50":"transparent",cursor:Ae?"not-allowed":"pointer",pointerEvents:Ae?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ae?{}:{borderColor:ve?"primary.500":"gray.300"},_dark:{borderColor:ve?"primary.400":"gray.700",bg:ve?"primary.900":"transparent"},children:s(z,{justify:"space-between",align:"flex-start",children:[s(le,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:B.name}),B.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:B.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:D("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:B.host_count,users:B.user_count})})]})},B.id)})]}):s(hr,{status:"warning",borderRadius:"md",children:[e(pr,{}),D("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),ce&&e(kr,{mt:2,children:D("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:ce.host_count,users:ce.user_count})})]})}),g&&Se&&e(hs,{pt:6,colSpan:{base:1,md:2},children:s(le,{gap:4,children:[e(mu,{defaultValue:dt,onChange:(B,ve)=>{Ve(B),q(ve)}}),e(R,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(Ur,{options:K.options,series:K.series,type:"donut"})})]})})]}),E&&s(hr,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(pr,{}),E]})]}),e(It,{mt:"3",children:s(z,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(z,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:g&&s(Lt,{children:[e(it,{label:D("delete"),placement:"top",children:e(ze,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),N()},children:e(En,{})})}),e(it,{label:D("userDialog.usage"),placement:"top",children:e(ze,{"aria-label":"usage",size:"sm",onClick:we,children:e(bu,{})})}),e(Y,{onClick:j,size:"sm",children:D("userDialog.resetUsage")}),e(Y,{onClick:Ne,size:"sm",children:D("userDialog.revokeSubscription")})]})}),e(z,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(Y,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:y?e(wt,{size:"xs"}):void 0,disabled:Ae,children:D(g?"userDialog.editUser":"createUser")})})]})})]})}),b&&s(yt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(gs,{color:"primary",children:e(yu,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:D("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:_&&_>0?D("userDialog.limitReachedBody",{limit:_,active:w!=null?w:_}):D("userDialog.limitReachedContent")})]})]})})]})},wu=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),vu=t=>{if(!t)return null;const n=new Date(`${t}Z`);return Math.floor(n.getTime()/1e3)},zi=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),r=vu(t);return!t||r===null?e(R,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):n-r<=60?e(R,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(R,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Cu=t=>{if(!t)return null;const n=new Date(t+"Z");return Math.floor(n.getTime()/1e3)},Ri=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),r=Cu(t),l=r?n-r:null,o=r?fa(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${o.time} ago`:o.time})},_a=({expiryDate:t,status:n,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=Fe(),a=fa(t),c=ps[n].icon;return s(Lt,{children:[s(Wr,{colorScheme:ps[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),l&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[n&&i(`status.${n}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},_u=Z(wu),Ys={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Du=Z(No,Ys),Au=Z(pa,Ys),Ui=Z(ua,Ys),Iu=Z(zo,Ys),Tu=Z(Po,Ys),Pu=Z(is,Ys),Eu=Z(pa,{baseStyle:{width:"15px",height:"15px"}}),Nu=t=>{for(var n=0;n<Fa.length;n++){const r=Fa[n];if(r.value==t)return r.title}return"No"},zu=t=>{const{used:n,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o}=t,i=r===0||r===null;return e(z,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:s(h,{children:[Je(n)," /"," ",i?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Je(r)]})})},Li=t=>{const{used:n,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o,...i}=t,a=r===0||r===null,c=!a&&n/r*100>=100;return s(Lt,{children:[e(mc,{orientation:"horizontal",value:a?100:Math.min(n/r*100,100),colorScheme:c?"red":"primary",...i,children:e(gc,{h:"6px",borderRadius:"full",children:e(fc,{borderRadius:"full"})})}),s(z,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[s(h,{children:[Je(n)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Je(r)+(l&&l!=="no_reset"?" "+Vr("userDialog.resetStrategy"+Nu(l)):"")]}),s(h,{children:[Vr("usersTable.total"),": ",Je(o)]})]})]})},en=({sort:t,column:n})=>t.includes(n)?e(Eu,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,Ru=t=>{const{filters:n,users:{users:r,total:l},onEditingUser:o,onFilterChange:i}=ut(),{t:a}=Fe(),[c,u]=d.exports.useState(void 0),p=or({base:!1,md:!0}),g=r.length!==l,f=b=>{let y=n.sort;y.includes(b)?y.startsWith("-")?y="-created_at":y="-"+b:y=b,i({sort:y})},_=b=>{i({status:b.target.value.length>0?b.target.value:void 0})},w=b=>{u(b===c?void 0:b)};return s(R,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(Ro,{allowMultiple:!0,display:{base:"block",md:"none"},index:c,children:s(ms,{orientation:"vertical",zIndex:"docked",...t,children:[e(zr,{zIndex:"docked",position:"relative",children:s(At,{children:[e(Le,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:f.bind(null,"username"),children:s(z,{children:[e("span",{children:a("users")}),e(en,{sort:n.sort,column:"username"})]})}),e(Le,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:s(z,{spacing:0,position:"relative",children:[s(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[a("usersTable.status"),n.status?": "+n.status:""]}),s(qe,{value:n.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Lt,{}),_focusVisible:{border:"0 !important"},onChange:_,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Le,{minW:"100px",cursor:"pointer",pr:0,onClick:f.bind(null,"used_traffic"),children:s(z,{children:[e("span",{children:a("usersTable.dataUsage")}),e(en,{sort:n.sort,column:"used_traffic"})]})}),e(Le,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(Ir,{children:!p&&(r==null?void 0:r.map((b,y)=>{var C;return s(d.exports.Fragment,{children:[s(At,{onClick:w.bind(null,y),cursor:"pointer",children:[e(Re,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:s("div",{className:"flex-status",children:[e(zi,{lastOnline:b.online_at}),e(h,{isTruncated:!0,children:b.username})]})}),e(Re,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(_a,{compact:!0,showDetail:!1,expiryDate:b.expire,status:b.status})}),e(Re,{borderBottom:0,minW:"100px",pr:0,children:e(zu,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:ps[b.status].bandWidthColor})}),e(Re,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Au,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:c===y?"rotate(180deg)":"0deg"})})]}),e(At,{className:"collapsible",onClick:w.bind(null,y),children:e(Re,{p:0,colSpan:4,children:s(Uo,{border:0,children:[e(Lo,{display:"none"}),e(Mo,{border:0,cursor:"pointer",px:6,py:3,children:s(le,{justifyContent:"space-between",spacing:"4",children:[s(le,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:a("usersTable.dataUsage")}),e(R,{width:"full",minW:"230px",children:e(Li,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:ps[b.status].bandWidthColor})})]}),s(le,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:a("usersTable.service","Service")}),e(h,{fontSize:"sm",color:b.service_name?"gray.700":"gray.500",_dark:{color:b.service_name?"gray.200":"gray.500"},children:(C=b.service_name)!=null?C:a("usersTable.defaultService","Default")})]}),s(z,{w:"full",justifyContent:"space-between",children:[s(R,{width:"full",children:[e(_a,{compact:!0,expiryDate:b.expire,status:b.status}),e(Ri,{lastOnline:b.online_at})]}),s(z,{children:[e(Mi,{user:b}),e(it,{label:a("userDialog.editUser"),placement:"top",children:e(ze,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:E=>{E.stopPropagation(),o(b)},children:e(Pu,{})})})]})]})]})})]})})})]},b.username)}))})]})}),s(ms,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(zr,{position:"relative",zIndex:"docked",children:s(At,{children:[e(Le,{minW:"140px",cursor:"pointer",onClick:f.bind(null,"username"),children:s(z,{children:[e("span",{children:a("username")}),e(en,{sort:n.sort,column:"username"})]})}),e(Le,{width:"400px",minW:"150px",cursor:"pointer",children:s(z,{position:"relative",gap:"5px",children:[s(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[a("usersTable.status"),n.status?": "+n.status:""]}),e(h,{children:"/"}),e(en,{sort:n.sort,column:"expire"}),e(z,{onClick:f.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),s(qe,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Lt,{}),_focusVisible:{border:"0 !important"},value:n.sort,onChange:_,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Le,{minW:"150px",children:e("span",{children:a("usersTable.service","Service")})}),e(Le,{width:"350px",minW:"230px",cursor:"pointer",onClick:f.bind(null,"used_traffic"),children:s(z,{children:[e("span",{children:a("usersTable.dataUsage")}),e(en,{sort:n.sort,column:"used_traffic"})]})}),e(Le,{width:"200px",minW:"180px"})]})}),s(Ir,{children:[p&&(r==null?void 0:r.map((b,y)=>{var C;return s(At,{className:da("interactive",{"last-row":y===r.length-1}),onClick:()=>o(b),children:[e(Re,{minW:"140px",children:s("div",{className:"flex-status",children:[e(zi,{lastOnline:b.online_at}),b.username,e(Ri,{lastOnline:b.online_at})]})}),e(Re,{width:"400px",minW:"150px",children:e(_a,{expiryDate:b.expire,status:b.status})}),e(Re,{minW:"150px",children:e(h,{fontSize:"sm",color:b.service_name?"gray.700":"gray.500",_dark:{color:b.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(C=b.service_name)!=null?C:a("usersTable.defaultService","Default")})}),e(Re,{width:"350px",minW:"230px",children:e(Li,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:ps[b.status].bandWidthColor})}),e(Re,{width:"200px",minW:"180px",children:e(Mi,{user:b})})]},b.username)})),r.length==0&&e(At,{children:e(Re,{colSpan:4,children:e(Uu,{isFiltered:g})})})]})]})]})},Mi=({user:t})=>{const{setQRCode:n,setSubLink:r}=ut(),l=t.links.join(`\r
`),[o,i]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{o[1]&&setTimeout(()=>{i([-1,!1])},1e3)},[o]),s(z,{justifyContent:"flex-end",onClick:a=>{a.preventDefault(),a.stopPropagation()},children:[e(hi,{text:t.subscription_url.startsWith("/")?window.location.origin+t.subscription_url:t.subscription_url,onCopy:()=>{i([0,!0])},children:e("div",{children:e(it,{label:o[0]==0&&o[1]?Vr("usersTable.copied"):Vr("usersTable.copyLink"),placement:"top",children:e(ze,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==0&&o[1]?e(Ui,{}):e(Iu,{})})})})}),e(hi,{text:l,onCopy:()=>{i([1,!0])},children:e("div",{children:e(it,{label:o[0]==1&&o[1]?Vr("usersTable.copied"):Vr("usersTable.copyConfigs"),placement:"top",children:e(ze,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==1&&o[1]?e(Ui,{}):e(Du,{})})})})}),e(it,{label:"QR Code",placement:"top",children:e(ze,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{n(t.links),r(t.subscription_url)},children:e(Tu,{})})})]})},Uu=({isFiltered:t})=>{const{onCreateUser:n}=ut();return s(R,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(_u,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Vr("usersTable.noUserMatched"):Vr("usersTable.noUser")}),!t&&e(Y,{size:"sm",colorScheme:"primary",onClick:()=>n(!0),children:Vr("createUser")})]})},Lu=()=>{const{t}=Fe();return d.exports.useEffect(()=>{ut.getState().refetchUsers(),kn()},[]),s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(Zo,{}),e(Ru,{}),e(jo,{}),e(ku,{}),e(Jd,{}),e(au,{}),e(ou,{}),e(cu,{})]})},Qt=(t,n,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return n({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return n({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},qt=(t,n)=>n({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),Mu=()=>{var te,L,Q,de,ne;const{t}=Fe(),n=Mt(),{adminInDialog:r,isAdminDialogOpen:l,closeAdminDialog:o,createAdmin:i,updateAdmin:a}=Zr(),c=d.exports.useMemo(()=>r?"edit":"create",[r]),u=d.exports.useMemo(()=>Pe.object({username:c==="create"?Pe.string().trim().min(3,{message:t("admins.validation.usernameMin")}):Pe.string().optional(),password:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>!P||P.length>=6,t("admins.validation.passwordMin")),telegram_id:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>P===void 0||/^\d+$/.test(P),t("admins.validation.telegramNumeric")),is_sudo:Pe.boolean().optional(),data_limit:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>P===void 0||/^\d+$/.test(P),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>P===void 0||/^\d+$/.test(P),t("admins.validation.usersLimitNumeric","Users limit must be a number"))}).superRefine((P,ue)=>{c==="create"&&!P.password&&ue.addIssue({code:Pe.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[c,t]),p=vr({resolver:ha(u),defaultValues:{username:"",password:"",telegram_id:"",is_sudo:!1,data_limit:"",users_limit:""}}),{register:g,handleSubmit:f,reset:_,formState:w,setValue:b,watch:y,setError:C}=p,E=g("is_sudo"),[O,ee]=d.exports.useState(!1),D=d.exports.useCallback(ie=>{var Te;const P="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",ue=P.length;if(typeof window<"u"&&((Te=window.crypto)==null?void 0:Te.getRandomValues)){const Ie=new Uint32Array(ie);return window.crypto.getRandomValues(Ie),Array.from(Ie,U=>P[U%ue]).join("")}return Array.from({length:ie},()=>{const Ie=Math.floor(Math.random()*ue);return P[Ie]}).join("")},[]),F=d.exports.useCallback(()=>{if(c==="edit")return;const ie=D(8);b("username",ie,{shouldDirty:!0,shouldValidate:!0})},[D,c,b]),A=d.exports.useCallback(()=>{const ie=D(12);b("password",ie,{shouldDirty:!0,shouldValidate:!0})},[D,b]),{errors:I,isSubmitting:De}=w;d.exports.useEffect(()=>{var ie,P;l&&_({username:(ie=r==null?void 0:r.username)!=null?ie:"",password:"",telegram_id:(r==null?void 0:r.telegram_id)!==void 0&&(r==null?void 0:r.telegram_id)!==null?String(r.telegram_id):"",is_sudo:(P=r==null?void 0:r.is_sudo)!=null?P:!1,data_limit:(r==null?void 0:r.data_limit)!==void 0&&(r==null?void 0:r.data_limit)!==null?String(Math.floor(r.data_limit/(1024*1024*1024))):"",users_limit:(r==null?void 0:r.users_limit)!==void 0&&(r==null?void 0:r.users_limit)!==null?String(r.users_limit):""})},[r,l,_]);const ge=f(async ie=>{var P,ue,Te,Ie;if(c==="edit"&&r){const U=(P=r.active_users)!=null?P:0;if(ie.users_limit){const T=Number(ie.users_limit);if(!Number.isNaN(T)&&T>0&&T<U){C("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:U})});return}}}try{if(c==="create"){const U={username:ie.username.trim(),password:(ue=ie.password)!=null?ue:"",is_sudo:(Te=ie.is_sudo)!=null?Te:!1,telegram_id:ie.telegram_id?Number(ie.telegram_id):void 0,data_limit:ie.data_limit?Number(ie.data_limit)*1024*1024*1024:void 0,users_limit:ie.users_limit?Number(ie.users_limit):void 0};await i(U),qt(t("admins.createSuccess","Admin created"),n)}else if(r){const U={is_sudo:(Ie=ie.is_sudo)!=null?Ie:!1,telegram_id:ie.telegram_id?Number(ie.telegram_id):void 0,data_limit:ie.data_limit?Number(ie.data_limit)*1024*1024*1024:void 0,users_limit:ie.users_limit?Number(ie.users_limit):void 0};ie.password&&(U.password=ie.password),await a(r.username,U),qt(t("admins.updateSuccess","Admin updated"),n)}o()}catch(U){Qt(U,n,p)}});return s(Nt,{isOpen:l,onClose:o,size:"lg",children:[e(ht,{}),s(zt,{children:[e(mt,{children:c==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Pt,{}),e(pt,{children:s(le,{spacing:4,align:"stretch",children:[s(k,{isInvalid:!!I.username,children:[e(v,{children:t("username")}),s(gr,{children:[e(ye,{placeholder:t("admins.usernamePlaceholder","Admin username"),...g("username"),isDisabled:c==="edit"}),c==="create"&&e(wr,{children:e(ze,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(Oa,{width:20}),onClick:F})})]}),e(Br,{children:(te=I.username)==null?void 0:te.message})]}),s(k,{isInvalid:!!I.password,children:[e(v,{children:t("password")}),s(z,{spacing:2,children:[s(gr,{children:[e(ye,{placeholder:t("admins.passwordPlaceholder","Password"),type:O?"text":"password",...g("password")}),e(wr,{children:e(ze,{"aria-label":O?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:O?e(Ga,{width:16}):e(bn,{width:16}),onClick:()=>ee(!O)})})]}),e(ze,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(Oa,{width:20}),onClick:A})]}),e(Br,{children:(L=I.password)==null?void 0:L.message}),c==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),e(k,{display:"flex",alignItems:"center",children:s(le,{align:"start",spacing:1,w:"full",children:[s(z,{justify:"space-between",w:"full",children:[e(v,{htmlFor:"is_sudo",mb:"0",children:t("admins.sudoAccess","Sudo access")}),e(ct,{id:"is_sudo",isChecked:y("is_sudo"),onChange:ie=>b("is_sudo",ie.target.checked,{shouldDirty:!0}),onBlur:E.onBlur,ref:E.ref})]}),e(h,{fontSize:"xs",color:"gray.500",children:t("admins.sudoDescription","Sudo admins can manage other admins.")})]})}),s(k,{isInvalid:!!I.telegram_id,children:[e(v,{children:t("admins.telegramId","Telegram ID")}),e(ye,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...g("telegram_id")}),e(Br,{children:(Q=I.telegram_id)==null?void 0:Q.message})]}),s(k,{isInvalid:!!I.data_limit,children:[e(v,{children:t("admins.dataLimit","Data Limit (GB)")}),e(ye,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...g("data_limit")}),e(Br,{children:(de=I.data_limit)==null?void 0:de.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),s(k,{isInvalid:!!I.users_limit,children:[e(v,{children:t("admins.usersLimit","Users Limit")}),e(ye,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...g("users_limit")}),e(Br,{children:(ne=I.users_limit)==null?void 0:ne.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})}),e(It,{children:s(z,{spacing:3,children:[e(Y,{variant:"ghost",onClick:o,children:t("cancel")}),e(Y,{colorScheme:"primary",onClick:ge,isLoading:De,children:c==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]})},Ou=()=>{var ie;const{t}=Fe(),n=Mt(),r=Qe("gray.50","whiteAlpha.100"),l=Qe("primary.50","primary.900"),{admins:o,loading:i,total:a,filters:c,onFilterChange:u,fetchAdmins:p,deleteAdmin:g,resetUsage:f,disableUsers:_,activateUsers:w,openAdminDialog:b,openAdminDetails:y,adminInDetails:C}=Zr(),E=d.exports.useRef(null),{isOpen:O,onOpen:ee,onClose:D}=Yt(),[F,A]=d.exports.useState(null),[I,De]=d.exports.useState(null),ge=P=>{if(P==="data_usage"||P==="data_limit"){const ue=c.sort===P?`-${P}`:P;u({sort:ue,offset:0})}else{const ue=c.sort===P?`-${P}`:c.sort===`-${P}`?void 0:P;u({sort:ue,offset:0})}},te=P=>{A(P),ee()},L=async()=>{if(!!F)try{await g(F.username),qt(t("admins.deleteSuccess","Admin removed"),n),D(),A(null)}catch(P){Qt(P,n)}},Q=async(P,ue)=>{De({type:P,username:ue.username});try{P==="reset"?(await f(ue.username),qt(t("admins.resetUsageSuccess","Usage reset"),n)):P==="disable"?(await _(ue.username),qt(t("admins.disableUsersSuccess","Users disabled"),n)):P==="activate"&&(await w(ue.username),qt(t("admins.activateUsersSuccess","Users activated"),n)),p()}catch(Te){Qt(Te,n)}finally{De(null)}},de=({column:P})=>{var Ie,U,T,M,ce;let ue=!1,Te=!1;return P==="data"?(ue=((Ie=c.sort)==null?void 0:Ie.includes("data_usage"))||((U=c.sort)==null?void 0:U.includes("data_limit")),Te=ue&&((T=c.sort)==null?void 0:T.startsWith("-"))):(ue=(M=c.sort)==null?void 0:M.includes(P),Te=ue&&((ce=c.sort)==null?void 0:ce.startsWith("-"))),e(pa,{style:{width:"1rem",height:"1rem",opacity:ue?1:0,transform:ue&&!Te?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},ne=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return i&&!o.length?e(R,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(wt,{})}):a?s(Lt,{children:[e(R,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:s(ms,{variant:"simple",size:"sm",minW:"640px",children:[e(zr,{children:e(At,{children:ne.map(P=>e(Le,{onClick:()=>P.key==="username"||P.key==="users_count"||P.key==="data"?ge(P.key):void 0,cursor:P.key==="username"||P.key==="users_count"||P.key==="data"?"pointer":"default",textAlign:P.key==="actions"?"right":"left",children:s(z,{justify:P.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:P.label}),P.key==="data"?s(ra,{children:[e(sa,{as:ze,size:"xs",variant:"ghost",icon:e(de,{column:"data"})}),s(na,{children:[e(Zt,{onClick:()=>ge("data_usage"),children:t("admins.sortByUsage")}),e(Zt,{onClick:()=>ge("data_limit"),children:t("admins.sortByLimit")})]})]}):P.key==="username"||P.key==="users_count"?e(de,{column:P.key}):null]})},P.key))})}),e(Ir,{children:o.map(P=>{var U,T;const ue=(C==null?void 0:C.username)===P.username,Te=P.users_limit&&P.users_limit>0?String(P.users_limit):"\u221E",Ie=`${(U=P.active_users)!=null?U:0}/${Te}`;return s(At,{onClick:()=>y(P),cursor:"pointer",bg:ue?l:void 0,_hover:{bg:r},transition:"background-color 0.15s ease-in-out",children:[s(Re,{children:[e(h,{fontWeight:"medium",children:P.username}),P.is_sudo&&e(Wr,{colorScheme:"purple",fontSize:"xs",mt:1,children:t("sudo")})]}),e(Re,{children:s(h,{whiteSpace:"nowrap",children:[Je((T=P.users_usage)!=null?T:0,2)," /"," ",P.data_limit?Je(P.data_limit,2):"-"]})}),e(Re,{children:s(ke,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:Ie})]})}),e(Re,{textAlign:"right",children:s(ra,{children:[e(sa,{as:ze,icon:e(bc,{width:20}),variant:"ghost",onClick:M=>M.stopPropagation()}),s(na,{onClick:M=>M.stopPropagation(),children:[e(Zt,{icon:e(is,{width:20}),onClick:M=>{M.stopPropagation(),b(P)},children:t("edit")}),e(Zt,{icon:e(Or,{width:20}),onClick:M=>{M.stopPropagation(),Q("reset",P)},isDisabled:(I==null?void 0:I.username)===P.username,children:t("admins.resetUsage")}),e(aa,{}),e(Zt,{icon:e(yc,{width:20}),onClick:M=>{M.stopPropagation(),Q("activate",P)},isDisabled:(I==null?void 0:I.username)===P.username,children:t("admins.activateUsers")}),e(Zt,{icon:e(Sc,{width:20}),onClick:M=>{M.stopPropagation(),Q("disable",P)},isDisabled:(I==null?void 0:I.username)===P.username,children:t("admins.disableUsers")}),e(aa,{}),e(Zt,{color:"red.500",icon:e(Mr,{width:20}),onClick:M=>{M.stopPropagation(),te(P)},children:t("delete")})]})]})})]},P.username)})})]})}),e(Sn,{isOpen:O,leastDestructiveRef:E,onClose:D,children:e(ht,{children:s(xn,{children:[e(mt,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(pt,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(ie=F==null?void 0:F.username)!=null?ie:""})}),s(It,{children:[e(Y,{ref:E,onClick:D,children:t("cancel")}),e(Y,{colorScheme:"red",onClick:L,ml:3,children:t("delete")})]})]})})})]}):e(R,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},Wu=(t,n)=>!t||t<=0?n!=null?n:"\u221E":`${t}`,Da=(t,n)=>!t||t<=0?n!=null?n:"\u221E":Je(t,2),Fu=()=>{var E,O,ee,D,F,A,I,De,ge,te;const{t}=Fe(),{isAdminDetailsOpen:n,adminInDetails:r,closeAdminDetails:l}=Zr(L=>({isAdminDetailsOpen:L.isAdminDetailsOpen,adminInDetails:L.adminInDetails,closeAdminDetails:L.closeAdminDetails})),o=Qe("gray.50","whiteAlpha.50"),i=(E=r==null?void 0:r.active_users)!=null?E:0,a=(O=r==null?void 0:r.users_limit)!=null?O:null,c=t("admins.details.unlimited","Unlimited"),u=a&&a>0?String(a):c,p=(ee=r==null?void 0:r.users_count)!=null?ee:0,g=(D=r==null?void 0:r.limited_users)!=null?D:0,f=(F=r==null?void 0:r.expired_users)!=null?F:0,_=(A=r==null?void 0:r.online_users)!=null?A:0,w=(I=r==null?void 0:r.users_usage)!=null?I:0,b=(De=r==null?void 0:r.data_limit)!=null?De:null,y=b&&b>0?Math.max(b-w,0):null,C=(ge=r==null?void 0:r.lifetime_usage)!=null?ge:null;return s(Co,{isOpen:n,placement:"right",size:"md",onClose:l,children:[e(ht,{}),s(_o,{children:[e(Pt,{}),e(mt,{bg:o,children:s(ke,{spacing:1,children:[s(z,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(te=r==null?void 0:r.username)!=null?te:t("admins.details.title","Admin details")}),(r==null?void 0:r.is_sudo)&&e(R,{as:"span",fontSize:"xs",px:2,py:.5,borderRadius:"full",bg:"purple.500",color:"white",children:t("admins.sudoBadge","Sudo")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:i,limit:u})})]})}),e(pt,{children:r?s(ke,{spacing:8,children:[s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),s(He,{columns:{base:2,md:3},spacing:4,children:[e(Pr,{label:t("admins.details.activeLabel","Active"),value:String(i)}),e(Pr,{label:t("admins.details.onlineLabel","Online"),value:String(_)}),e(Pr,{label:t("admins.details.limitedLabel","Limited"),value:String(g)}),e(Pr,{label:t("admins.details.expiredLabel","Expired"),value:String(f)}),e(Pr,{label:t("admins.details.totalUsers","Total users"),value:String(p)}),e(Pr,{label:t("admins.details.usersLimit","Users limit"),value:Wu(a,c)})]})]}),s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),s(He,{columns:{base:2,md:4},spacing:4,children:[e(Pr,{label:t("admins.details.used","Used"),value:Je(w,2)}),e(Pr,{label:t("admins.details.limit","Limit"),value:Da(b,c)}),e(Pr,{label:t("admins.details.remaining","Remaining"),value:Da(y,c)}),e(Pr,{label:t("admins.details.lifetime","Lifetime usage"),value:Da(C,void 0)})]})]})]}):e(R,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(It,{children:e(Y,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},Pr=({label:t,value:n})=>s(R,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:n})]}),Hu=()=>{const{t}=Fe(),n=Zr(i=>i.fetchAdmins),{userData:r,getUserIsSuccess:l}=Ss(),o=l&&r.is_sudo;return d.exports.useEffect(()=>{o&&n()},[n,o]),o?s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(Zo,{for:"admins"}),e(Ou,{}),e(jo,{for:"admins"}),e(Mu,{}),e(Fu,{})]}):s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},el=$s(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),_e("/hosts").then(n=>t({hosts:n})).finally(()=>t({isLoading:!1}))},setHosts:n=>(t({isPostLoading:!0}),_e("/hosts",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})}))})),Bu=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Vu=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],$u=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Ku=Z(is,{baseStyle:{w:4,h:4}}),tl=Z(Xr,{baseStyle:{w:4,h:4}}),rl=Z(vo,{baseStyle:{w:4,h:4}}),Ju=Z(Cn,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),qu=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],Ws=()=>{const{t}=Fe();return s(_n,{isLazy:!0,placement:"right",children:[e(Dn,{children:e(R,{mt:"-1",children:e(Ju,{})})}),e(kc,{children:s(An,{maxW:"xs",fontSize:"xs",children:[e(In,{}),e(Wo,{}),e(Tn,{children:s(R,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),qu.map(({token:n,labelKey:r})=>s(h,{mt:1,children:[e(Wr,{mr:2,children:n}),t(r)]},n))]})})]})})]})},sl=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,xr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,Rr=t=>(t!=null?t:"").trim(),tn=(t,n=!1)=>typeof t=="boolean"?t:n,Yu=(t,n)=>{var r,l,o,i,a,c,u,p;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(o=t.address)!=null?o:"",sort:(i=t.sort)!=null?i:n,port:(a=t.port)!=null?a:null,path:Rr(t.path),sni:Rr(t.sni),host:Rr(t.host),mux_enable:tn(t.mux_enable),allowinsecure:tn(t.allowinsecure),is_disabled:tn(t.is_disabled,!1),fragment_setting:Rr(t.fragment_setting),noise_setting:Rr(t.noise_setting),random_user_agent:tn(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:tn(t.use_sni_as_host)}},Ha=t=>{var n,r;return{id:(n=t.id)!=null?n:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},Oi=t=>{var n,r;return{...t,id:(n=t.id)!=null?n:null,port:(r=t.port)!=null?r:null,path:Rr(t.path),sni:Rr(t.sni),host:Rr(t.host),fragment_setting:Rr(t.fragment_setting),noise_setting:Rr(t.noise_setting)}},nl=t=>{const n=Oi(t.data),r=Oi(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(n)!==JSON.stringify(r)},Gu=t=>{var n;return{id:(n=t.id)!=null?n:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},hn=t=>[...t].sort((n,r)=>{const l=xr(n.data.sort)-xr(r.data.sort);return l!==0?l:n.data.remark.localeCompare(r.data.remark)}),Xu=t=>{const n=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((o,i)=>{const a=Yu(o,i),c=a.id!=null?`host-${a.id}`:sl();n.push({uid:c,inboundTag:r,initialInboundTag:r,data:Ha(a),original:Ha(a)})})}),hn(n)},al=t=>{const n=new Map;t.forEach(l=>{var i;const o=(i=n.get(l.inboundTag))!=null?i:[];o.push(l.data),n.set(l.inboundTag,o)});const r={};return n.forEach((l,o)=>{r[o]=l.map(i=>Gu(i)).sort((i,a)=>xr(i.sort)-xr(a.sort))}),r},Aa=(t,n)=>{const r=al(t),l=Array.from(new Set(n)),o={};return l.forEach(i=>{var a;o[i]=(a=r[i])!=null?a:[]}),o},Qu=({host:t,inboundOptions:n,orderIndex:r,onToggleActive:l,onEdit:o,onDelete:i,saving:a,deleting:c})=>{const{t:u}=Fe(),p=n.find(w=>w.value===t.inboundTag),g=!t.data.is_disabled,f=nl(t),_=t.data.remark||u("hostsPage.untitledHost");return e(Lr,{borderWidth:"1px",borderColor:f?"primary.400":"gray.200",_dark:{borderColor:f?"primary.300":"gray.700",bg:f?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>o(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:s(Kr,{as:ke,spacing:4,children:[s(z,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(le,{align:"flex-start",spacing:1,flex:"1",children:[e(it,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:_})}),s(z,{spacing:2,flexWrap:"wrap",children:[e(st,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),p&&e(st,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(st,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),f&&e(st,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),s(z,{spacing:2,children:[e(ct,{size:"sm",colorScheme:"primary",isChecked:g,onChange:w=>{w.stopPropagation(),l(t.uid,w.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(g?"hostsPage.enabled":"hostsPage.disabled")})]})]}),s(le,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),s(z,{justify:"space-between",children:[e(Y,{size:"sm",variant:"outline",leftIcon:e(Ku,{}),onClick:w=>{w.stopPropagation(),o(t.uid)},isLoading:a,children:u("hostsPage.edit")}),e(ze,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:w=>{w.stopPropagation(),i(t.uid)},icon:e(En,{}),isLoading:c})]})]})})},Zu=({host:t,index:n})=>{const{t:r}=Fe(),l=xc(),o=t.data.remark||r("hostsPage.untitledHost"),i=d.exports.useCallback(a=>{a.pointerType==="mouse"&&a.button!==0||(a.preventDefault(),l.start(a))},[l]);return e(Oo.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:s(z,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(it,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(ze,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(rl,{}),cursor:"grab",onPointerDown:i,style:{touchAction:"none"}})}),e(st,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:n+1})}),s(le,{align:"flex-start",spacing:0,flex:"1",children:[e(it,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:o})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},ju=({host:t,inboundOptions:n,isOpen:r,onClose:l,onChange:o,onChangeInbound:i,onSave:a,onReset:c,onDelete:u,saving:p,deleting:g})=>{var b;const{t:f}=Fe();if(!t)return null;const _=n.find(y=>y.value===t.inboundTag),w=nl(t);return s(Nt,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,children:[e(ht,{}),s(zt,{children:[e(Pt,{}),e(mt,{pb:1,children:s(le,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||f("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||f("hostsPage.noAddress")}),_&&e(st,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${_.value} (${_.protocol.toUpperCase()} - ${_.network})`})]})}),e(pt,{children:s(le,{align:"stretch",spacing:5,children:[s(Lr,{variant:"outline",children:[e(Ls,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.general")})}),e(Kr,{pt:0,children:s(le,{align:"stretch",spacing:4,children:[s(k,{children:[e(v,{children:f("hostsDialog.remark")}),s(gr,{children:[e(ye,{value:t.data.remark,onChange:y=>o(t.uid,"remark",y.target.value)}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:f("hostsPage.inboundLabel")}),e(qe,{value:t.inboundTag,onChange:y=>i(t.uid,y.target.value),children:n.map(y=>e("option",{value:y.value,children:y.label},y.value))})]}),s(k,{children:[e(v,{children:f("hostsDialog.sort")}),e(Yr,{value:t.data.sort,allowMouseWheel:!0,onChange:(y,C)=>o(t.uid,"sort",Number.isNaN(C)?t.data.sort:C),children:e(qr,{})})]})]}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:f("hostsDialog.address")}),s(gr,{children:[e(ye,{value:t.data.address,onChange:y=>o(t.uid,"address",y.target.value)}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(k,{children:[e(v,{children:f("hostsDialog.port")}),e(Yr,{value:(b=t.data.port)!=null?b:"",allowMouseWheel:!0,onChange:(y,C)=>o(t.uid,"port",Number.isNaN(C)?null:C),children:e(qr,{})})]})]}),s(k,{children:[e(v,{children:f("hostsDialog.path")}),e(ye,{value:t.data.path,onChange:y=>o(t.uid,"path",y.target.value),placeholder:"/"})]})]})})]}),s(Lr,{variant:"outline",children:[e(Ls,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.security")})}),e(Kr,{pt:0,children:s(le,{align:"stretch",spacing:4,children:[s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:f("hostsDialog.sni")}),e(ye,{value:t.data.sni,onChange:y=>o(t.uid,"sni",y.target.value)})]}),s(k,{children:[e(v,{children:f("hostsDialog.host")}),s(gr,{children:[e(ye,{value:t.data.host,onChange:y=>o(t.uid,"host",y.target.value)}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]})]}),s(He,{columns:{base:1,md:3},spacing:4,children:[s(k,{children:[e(v,{children:f("hostsDialog.security")}),e(qe,{value:t.data.security,onChange:y=>o(t.uid,"security",y.target.value),children:Bu.map(y=>e("option",{value:y.value,children:y.title},y.value))})]}),s(k,{children:[e(v,{children:f("hostsDialog.alpn")}),e(qe,{value:t.data.alpn,onChange:y=>o(t.uid,"alpn",y.target.value),children:Vu.map(y=>e("option",{value:y.value,children:y.title},y.value))})]}),s(k,{children:[e(v,{children:f("hostsDialog.fingerprint")}),e(qe,{value:t.data.fingerprint,onChange:y=>o(t.uid,"fingerprint",y.target.value),children:$u.map(y=>e("option",{value:y.value,children:y.title},y.value))})]})]})]})})]}),s(Lr,{variant:"outline",children:[e(Ls,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.advanced")})}),e(Kr,{pt:0,children:s(le,{align:"stretch",spacing:4,children:[s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:f("hostsDialog.fragment")}),e(ye,{value:t.data.fragment_setting,onChange:y=>o(t.uid,"fragment_setting",y.target.value)})]}),s(k,{children:[e(v,{children:f("hostsDialog.noise")}),e(ye,{value:t.data.noise_setting,onChange:y=>o(t.uid,"noise_setting",y.target.value)})]})]}),s(ke,{direction:{base:"column",md:"row"},spacing:4,children:[e(mr,{isChecked:t.data.allowinsecure,onChange:y=>o(t.uid,"allowinsecure",y.target.checked),children:f("hostsDialog.allowinsecure")}),e(mr,{isChecked:t.data.mux_enable,onChange:y=>o(t.uid,"mux_enable",y.target.checked),children:f("hostsDialog.muxEnable")}),e(mr,{isChecked:t.data.random_user_agent,onChange:y=>o(t.uid,"random_user_agent",y.target.checked),children:f("hostsDialog.randomUserAgent")}),e(mr,{isChecked:t.data.use_sni_as_host,onChange:y=>o(t.uid,"use_sni_as_host",y.target.checked),children:f("hostsDialog.useSniAsHost")})]})]})})]})]})}),s(It,{justifyContent:"space-between",children:[e(Y,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(En,{}),onClick:()=>u(t.uid),isLoading:g,children:f("hostsPage.delete")}),s(z,{spacing:3,children:[e(Y,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!w||p,children:f("hostsPage.reset")}),e(Y,{size:"sm",colorScheme:"primary",onClick:()=>a(t.uid),isDisabled:!w,isLoading:p,children:f("hostsPage.save")})]})]})]})]})},eh=({isOpen:t,onClose:n,inboundOptions:r,onSubmit:l,isSubmitting:o,defaultSort:i})=>{var f,_,w,b;const{t:a}=Fe(),c=d.exports.useRef(null),[u,p]=d.exports.useState({inboundTag:(_=(f=r[0])==null?void 0:f.value)!=null?_:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var y,C;t&&(p({inboundTag:(C=(y=r[0])==null?void 0:y.value)!=null?C:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var E;return(E=c.current)==null?void 0:E.focus()},150))},[i,r,t]);const g=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return s(Nt,{isOpen:t,onClose:n,size:"lg",initialFocusRef:c,children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(zt,{children:[e(mt,{children:s(z,{spacing:3,children:[e(tl,{}),e(h,{fontWeight:"semibold",children:a("hostsPage.create.title")})]})}),e(Pt,{mt:2}),s(pt,{as:le,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:a("hostsPage.create.description")}),s(k,{children:[e(v,{children:a("hostsPage.inboundLabel")}),e(qe,{value:u.inboundTag,onChange:y=>p(C=>({...C,inboundTag:y.target.value})),children:r.map(y=>e("option",{value:y.value,children:y.label},y.value))})]}),s(k,{isRequired:!0,children:[e(v,{children:a("hostsDialog.remark")}),s(gr,{children:[e(ye,{ref:c,value:u.remark,onChange:y=>p(C=>({...C,remark:y.target.value}))}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{isRequired:!0,children:[e(v,{children:a("hostsDialog.address")}),s(gr,{children:[e(ye,{value:u.address,onChange:y=>p(C=>({...C,address:y.target.value}))}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(k,{children:[e(v,{children:a("hostsDialog.port")}),e(Yr,{value:(w=u.port)!=null?w:"",onChange:(y,C)=>p(E=>({...E,port:Number.isNaN(C)?null:C})),children:e(qr,{})})]})]}),s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("hostsDialog.path")}),e(ye,{value:u.path,onChange:y=>p(C=>({...C,path:y.target.value}))})]}),s(k,{children:[e(v,{children:a("hostsDialog.sni")}),e(ye,{value:u.sni,onChange:y=>p(C=>({...C,sni:y.target.value}))})]})]}),s(k,{children:[e(v,{children:a("hostsDialog.host")}),s(gr,{children:[e(ye,{value:u.host,onChange:y=>p(C=>({...C,host:y.target.value}))}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(k,{children:[e(v,{children:a("hostsDialog.sort")}),e(Yr,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(y,C)=>p(E=>({...E,sort:Number.isNaN(C)?E.sort:C})),children:e(qr,{})})]}),e(R,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:a("hostsPage.create.sortHint",{value:(b=u.sort)!=null?b:i})})]}),s(It,{gap:2,children:[e(Y,{variant:"ghost",onClick:n,children:a("hostsPage.cancel")}),e(Y,{colorScheme:"primary",onClick:g,isLoading:o,children:a("hostsPage.create.submit")})]})]})]})},th=()=>{var Ve;const{t}=Fe(),n=Mt(),{hosts:r,fetchHosts:l,isLoading:o,isPostLoading:i,setHosts:a}=el(),{inbounds:c}=ut(),[u,p]=d.exports.useState([]),g=d.exports.useRef([]),f=d.exports.useCallback(q=>{typeof q=="function"?p(x=>{const N=q(x);return g.current=N,N}):(g.current=q,p(q))},[]),[_,w]=d.exports.useState(null),[b,y]=d.exports.useState(!1),[C,E]=d.exports.useState(!1),[O,ee]=d.exports.useState(null),[D,F]=d.exports.useState(null),[A,I]=d.exports.useState(null),[De,ge]=d.exports.useState(null),te=d.exports.useRef(null),[L,Q]=d.exports.useState(!1),de=d.exports.useRef(!1),[ne,ie]=d.exports.useState(!1),[P,ue]=d.exports.useState(!1),[Te,Ie]=d.exports.useState(null);d.exports.useEffect(()=>{l()},[l]),d.exports.useEffect(()=>{c.size||kn()},[c]),d.exports.useEffect(()=>{const q=Xu(r);f(q)},[r,f]),d.exports.useEffect(()=>{if(De){const q=g.current.find(x=>x.inboundTag===De.inboundTag&&x.data.remark.trim()===De.remark&&x.data.address.trim()===De.address);q&&(w(q.uid),ge(null))}},[u,De]),d.exports.useEffect(()=>{_&&!g.current.some(q=>q.uid===_)&&!De&&w(null)},[u,_,De]);const U=d.exports.useCallback(q=>{de.current=q,Q(q)},[]);d.exports.useEffect(()=>{P||(Ie(null),U(!1))},[b,P,U]),d.exports.useEffect(()=>{if(!P||!Te)return;const q=new Set(g.current.map(N=>N.uid));Te.every(N=>q.has(N.uid))||(Ie(null),U(!1))},[u,P,U,Te]);const T=d.exports.useMemo(()=>{const q=[];return c.forEach(x=>{x.forEach(N=>{q.push({label:`${N.tag} (${N.protocol.toUpperCase()} - ${N.network})`,value:N.tag,protocol:N.protocol,network:N.network})})}),q.sort((x,N)=>x.label.localeCompare(N.label))},[c]),M=d.exports.useMemo(()=>g.current.filter(q=>!q.data.is_disabled).sort((q,x)=>xr(q.data.sort)-xr(x.data.sort)),[u]),ce=d.exports.useMemo(()=>[...g.current].sort((q,x)=>xr(q.data.sort)-xr(x.data.sort)),[u]),$=d.exports.useMemo(()=>b?ce:M,[M,ce,b]);d.exports.useEffect(()=>{P&&Ie(q=>q!=null?q:[...M])},[M,P]);const Se=P?Te!=null?Te:M:$,Ee=d.exports.useMemo(()=>{const q=new Map;return Se.forEach((x,N)=>q.set(x.uid,N)),q},[Se]),we=_&&(Ve=g.current.find(q=>q.uid===_))!=null?Ve:null,Oe=(q,x,N)=>{f(j=>hn(j.map(Ne=>Ne.uid===q?{...Ne,data:{...Ne.data,[x]:N}}:Ne)))},X=(q,x)=>{f(N=>hn(N.map(j=>j.uid===q?{...j,inboundTag:x}:j)))},xe=d.exports.useCallback(async()=>{if(!P||ne)return!1;const q=M,x=Te!=null?Te:q;if(!(x.length!==q.length||x.some((Ze,ft)=>{var Ct;return Ze.uid!==((Ct=q[ft])==null?void 0:Ct.uid)}))||!Te||x.length===0)return ue(!1),Ie(null),U(!1),!0;const j=x.map(Ze=>Ze.uid),Ne=new Map;j.forEach((Ze,ft)=>Ne.set(Ze,ft));const Ae=g.current,je=g.current.filter(Ze=>Ne.has(Ze.uid)).sort((Ze,ft)=>{var Ct,Rt;return((Ct=Ne.get(Ze.uid))!=null?Ct:Number.MAX_SAFE_INTEGER)-((Rt=Ne.get(ft.uid))!=null?Rt:Number.MAX_SAFE_INTEGER)}),gt=g.current.filter(Ze=>!Ne.has(Ze.uid)).sort((Ze,ft)=>xr(Ze.data.sort)-xr(ft.data.sort)),Tt=[...je,...gt].map((Ze,ft)=>({...Ze,data:{...Ze.data,sort:ft},original:{...Ze.original,sort:ft}}));f(Tt),Ie(Tt.filter(Ze=>!Ze.data.is_disabled)),ie(!0);try{const Ze=al(Tt);return await a(Ze),await l(),U(!1),ue(!1),Ie(null),n({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{f(Ae);const ft=Ae.filter(Ct=>!Ct.data.is_disabled).sort((Ct,Rt)=>xr(Ct.data.sort)-xr(Rt.data.sort));return Ie(ft),U(!0),n({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{ie(!1)}},[f,M,l,P,ne,a,U,t,n,Te]),G=d.exports.useCallback(q=>{if(!P||!q.length)return;const x=Te!=null?Te:M;!(q.length!==x.length||q.some((j,Ne)=>{var Ae;return j.uid!==((Ae=x[Ne])==null?void 0:Ae.uid)}))||(Ie(q),de.current||U(!0))},[M,P,U,Te]),pe=d.exports.useCallback(()=>{Ie([...M]),U(!1),ue(!0)},[M,U]),Ce=d.exports.useCallback(()=>{ue(!1),Ie(null),U(!1)},[U]),Ge=d.exports.useCallback(()=>{xe()},[xe]),ae=async q=>{const x=g.current.find(N=>N.uid===q);if(!!x){ee(q),ge({inboundTag:x.inboundTag,remark:x.data.remark.trim(),address:x.data.address.trim()});try{const N=Aa(g.current,[x.inboundTag,x.initialInboundTag]);await a(N),await l(),n({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"})}catch{n({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{ee(null)}}},re=q=>{f(x=>hn(x.map(N=>N.uid===q?{...N,inboundTag:N.initialInboundTag,data:Ha(N.original)}:N)))},oe=(q,x)=>{Oe(q,"is_disabled",!x),x||y(!0)},K=q=>{I(q)},fe=async()=>{if(!A)return;const q=g.current.find(x=>x.uid===A);if(!!q){F(A);try{const x=g.current.filter(j=>j.uid!==A);f(x);const N=Aa(x,[q.inboundTag,q.initialInboundTag]);await a(N),await l(),n({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),_===A&&w(null)}catch{n({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{F(null),I(null)}}},dt=async q=>{const x=g.current.length?Math.max(...g.current.map(N=>N.data.sort))+1:0;ee("create"),ge({inboundTag:q.inboundTag,remark:q.remark.trim(),address:q.address.trim()});try{const N={uid:sl(),inboundTag:q.inboundTag,initialInboundTag:q.inboundTag,data:{id:null,remark:q.remark,address:q.address,sort:Number.isFinite(q.sort)?q.sort:x,port:q.port,path:q.path,sni:q.sni,host:q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:q.remark,address:q.address,sort:Number.isFinite(q.sort)?q.sort:x,port:q.port,path:q.path,sni:q.sni,host:q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},j=hn([...g.current,N]);f(j);const Ne=Aa(j,[q.inboundTag]);await a(Ne),await l(),n({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),E(!1)}catch{n({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{ee(null)}};return s(le,{align:"stretch",spacing:4,children:[P?s(le,{align:"stretch",spacing:2,children:[s(z,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),s(z,{spacing:2,children:[e(Y,{variant:"ghost",onClick:Ce,isDisabled:ne,children:t("hostsPage.cancel")}),e(Y,{colorScheme:"primary",onClick:Ge,isLoading:ne,isDisabled:!L&&!ne,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),ne?s(z,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(wt,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):L?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):s(z,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(z,{spacing:3,children:[e(Y,{colorScheme:"primary",size:"sm",onClick:()=>E(!0),leftIcon:e(tl,{}),isDisabled:!T.length,children:t("hostsPage.addHost")}),e(ct,{isChecked:b,onChange:q=>y(q.target.checked),children:t("hostsPage.showDisabled")})]}),e(Y,{size:"sm",variant:"outline",leftIcon:e(rl,{}),onClick:pe,isDisabled:o||!M.length,children:t("hostsPage.enterSort")})]}),o?e(z,{justify:"center",py:10,children:e(wt,{})}):Se.length===0?e(R,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t("hostsPage.emptyState")})}):P?e(Oo.Group,{axis:"y",values:Se,onReorder:G,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:Se.map((q,x)=>e(Zu,{host:q,index:x},q.uid))}):e(He,{columns:{base:1,md:2,xl:3},spacing:4,children:$.map((q,x)=>{var N;return e(Qu,{host:q,inboundOptions:T,orderIndex:(N=Ee.get(q.uid))!=null?N:x,onToggleActive:oe,onEdit:w,onDelete:K,saving:O===q.uid&&i,deleting:D===q.uid&&i},q.uid)})}),e(eh,{isOpen:C,onClose:()=>E(!1),inboundOptions:T,onSubmit:dt,isSubmitting:O==="create"&&i,defaultSort:g.current.length?Math.max(...g.current.map(q=>q.data.sort))+1:0}),e(ju,{host:we,inboundOptions:T,isOpen:Boolean(we),onClose:()=>w(null),onChange:Oe,onChangeInbound:X,onSave:ae,onReset:re,onDelete:K,saving:!!we&&O===we.uid&&i,deleting:!!we&&D===we.uid&&i}),e(Sn,{isOpen:Boolean(A),leastDestructiveRef:te,onClose:()=>I(null),children:e(ht,{children:s(xn,{children:[e(mt,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(pt,{children:t("hostsPage.deleteConfirmation")}),s(It,{children:[e(Y,{ref:te,onClick:()=>I(null),children:t("hostsPage.cancel")}),e(Y,{colorScheme:"red",onClick:fe,ml:3,isLoading:Boolean(D),children:t("hostsPage.delete")})]})]})})})]})},rh=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),Wi=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(rh(t))}catch{}return""},sh=t=>{if(typeof t!="string"||t.length===0)return"";const n=globalThis.Wireguard;if(n!=null&&n.generateKeypair)try{const r=n.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class cr{static isEmpty(n){return n==null?!0:typeof n=="string"?n.trim().length===0:Array.isArray(n)?n.length===0:typeof n=="object"?Object.keys(n).length===0:!1}static isArrEmpty(n){return!Array.isArray(n)||n.length===0}}const se=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),il=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const nh=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),ah=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const ih=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Ia=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class lt{static toJsonArray(n){return n.map(r=>r.toJson())}static fromJson(n){return new lt}toJson(){return{}}toString(n=!0){const r=this.toJson();return n?JSON.stringify(r,null,2):JSON.stringify(r)}}class Jr extends lt{constructor(r="none",l="",o=""){super();V(this,"type");V(this,"host");V(this,"path");this.type=r,this.host=l,this.path=o}static fromJson(r={}){var o,i,a,c,u,p,g,f,_,w;const l=r==null?void 0:r.header;if(!l)return new Jr;if(l.type==="http"&&l.request){const b=((i=(o=l.request)==null?void 0:o.headers)==null?void 0:i.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(c=(a=l.request)==null?void 0:a.headers)==null?void 0:c.Host)!=null?u:"",y=((p=l.request)==null?void 0:p.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(f=(g=l.request)==null?void 0:g.path)!=null?f:"";return new Jr((_=l.type)!=null?_:"http",b,y)}return new Jr((w=l.type)!=null?w:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:cr.isEmpty(this.host)?[]:this.host.split(",")},path:cr.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class Fs extends lt{constructor(r=1350,l=50,o=5,i=20,a=!1,c=2,u=2,p="none",g=""){super();V(this,"mtu");V(this,"tti");V(this,"upCap");V(this,"downCap");V(this,"congestion");V(this,"readBuffer");V(this,"writeBuffer");V(this,"type");V(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=o!=null?o:5,this.downCap=i!=null?i:20,this.congestion=Boolean(a),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=p!=null?p:"none",this.seed=g!=null?g:""}static fromJson(r={}){var l,o,i;return new Fs(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(o=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?o:"none",(i=r==null?void 0:r.seed)!=null?i:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class fs extends lt{constructor(r="/",l="",o=0){super();V(this,"path");V(this,"host");V(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=o!=null?o:0}static fromJson(r={}){var l,o,i;return new fs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.heartbeatPeriod)!=null?i:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class bs extends lt{constructor(r="",l="",o=!1){super();V(this,"serviceName");V(this,"authority");V(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(o)}static fromJson(r={}){var l,o;return new bs((l=r==null?void 0:r.serviceName)!=null?l:"",(o=r==null?void 0:r.authority)!=null?o:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class Hs extends lt{constructor(r="/",l=""){super();V(this,"path");V(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,o;return new Hs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"")}toJson(){return{path:this.path,host:this.host}}}class Bs extends lt{constructor(r="/",l="",o="",i=!1,a="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,p,g,f,_,w;super();V(this,"path");V(this,"host");V(this,"mode");V(this,"noGRPCHeader");V(this,"scMinPostsIntervalMs");V(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=o!=null?o:"",this.noGRPCHeader=Boolean(i),this.scMinPostsIntervalMs=a!=null?a:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(g=c==null?void 0:c.cMaxReuseTimes)!=null?g:0,hMaxRequestTimes:(f=c==null?void 0:c.hMaxRequestTimes)!=null?f:"600-900",hMaxReusableSecs:(_=c==null?void 0:c.hMaxReusableSecs)!=null?_:"1800-3000",hKeepAlivePeriod:(w=c==null?void 0:c.hKeepAlivePeriod)!=null?w:0}}static fromJson(r={}){var l,o,i,a;return new Bs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.mode)!=null?i:"",Boolean(r==null?void 0:r.noGRPCHeader),(a=r==null?void 0:r.scMinPostsIntervalMs)!=null?a:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class ys extends lt{constructor(r="",l=[],o="",i=!1,a=""){super();V(this,"serverName");V(this,"alpn");V(this,"fingerprint");V(this,"allowInsecure");V(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=o!=null?o:"",this.allowInsecure=Boolean(i),this.echConfigList=a!=null?a:""}static fromJson(r={}){var l,o,i;return new ys((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(o=r==null?void 0:r.fingerprint)!=null?o:"",Boolean(r==null?void 0:r.allowInsecure),(i=r==null?void 0:r.echConfigList)!=null?i:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class Vs extends lt{constructor(r="",l="",o="",i="",a="",c=""){super();V(this,"publicKey");V(this,"fingerprint");V(this,"serverName");V(this,"shortId");V(this,"spiderX");V(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=o!=null?o:"",this.shortId=i!=null?i:"",this.spiderX=a!=null?a:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var l,o,i,a,c,u;return new Vs((l=r==null?void 0:r.publicKey)!=null?l:"",(o=r==null?void 0:r.fingerprint)!=null?o:"",(i=r==null?void 0:r.serverName)!=null?i:"",(a=r==null?void 0:r.shortId)!=null?a:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class wn extends lt{constructor(r="",l=!1,o=0,i=!1,a=!1,c=Ia.NONE){super();V(this,"dialerProxy");V(this,"tcpFastOpen");V(this,"tcpKeepAliveInterval");V(this,"tcpMptcp");V(this,"penetrate");V(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=o!=null?o:0,this.tcpMptcp=Boolean(i),this.penetrate=Boolean(a),this.addressPortStrategy=c!=null?c:Ia.NONE}static fromJson(r={}){var l,o,i;return!r||Object.keys(r).length===0?new wn:new wn((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(o=r==null?void 0:r.tcpKeepAliveInterval)!=null?o:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(i=r==null?void 0:r.addressPortStrategy)!=null?i:Ia.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class ns extends lt{constructor(r="tcp",l="none",o=new ys,i=new Vs,a=new Jr,c=new Fs,u=new fs,p=new bs,g=new Hs,f=new Bs,_){super();V(this,"network");V(this,"security");V(this,"tls");V(this,"reality");V(this,"tcp");V(this,"kcp");V(this,"ws");V(this,"grpc");V(this,"httpupgrade");V(this,"xhttp");V(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=o,this.reality=i,this.tcp=a,this.kcp=c,this.ws=u,this.grpc=p,this.httpupgrade=g,this.xhttp=f,this.sockopt=_}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new wn:void 0}static fromJson(r={}){var l,o;return new ns((l=r==null?void 0:r.network)!=null?l:"tcp",(o=r==null?void 0:r.security)!=null?o:"none",ys.fromJson(r==null?void 0:r.tlsSettings),Vs.fromJson(r==null?void 0:r.realitySettings),Jr.fromJson(r==null?void 0:r.tcpSettings),Fs.fromJson(r==null?void 0:r.kcpSettings),fs.fromJson(r==null?void 0:r.wsSettings),bs.fromJson(r==null?void 0:r.grpcSettings),Hs.fromJson(r==null?void 0:r.httpupgradeSettings),Bs.fromJson(r==null?void 0:r.xhttpSettings),wn.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class vn extends lt{constructor(r=!1,l=8,o=16,i="reject"){super();V(this,"enabled");V(this,"concurrency");V(this,"xudpConcurrency");V(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=o!=null?o:16,this.xudpProxyUDP443=i!=null?i:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new vn:new vn(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var $r,Ar;const $e=class extends lt{constructor(r="",l=se.VLESS,o=$e.Settings.getSettings(se.VLESS),i=new ns,a,c=new vn){super();V(this,"tag");V(this,"_protocol");V(this,"settings");V(this,"stream");V(this,"sendThrough");V(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:se.VLESS,this.settings=o!=null?o:$e.Settings.getSettings(this._protocol),this.stream=i,this.sendThrough=a,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=$e.Settings.getSettings(r),this.stream=new ns}canEnableTls(){return[se.VMess,se.VLESS,se.Trojan,se.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===se.VLESS:!1}canEnableReality(){return[se.VLESS,se.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[se.VMess,se.VLESS,se.Trojan,se.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[se.VMess,se.VLESS,se.Trojan,se.Shadowsocks,se.HTTP,se.Socks].includes(this.protocol)}hasVnext(){return[se.VMess,se.VLESS].includes(this.protocol)}hasServers(){return[se.Trojan,se.Shadowsocks,se.Socks,se.HTTP].includes(this.protocol)}hasAddressPort(){return[se.DNS,se.VMess,se.VLESS,se.Trojan,se.Shadowsocks,se.Socks,se.HTTP].includes(this.protocol)}hasUsername(){return[se.Socks,se.HTTP].includes(this.protocol)}static fromJson(r={}){var l,o,i,a;return new $e((l=r==null?void 0:r.tag)!=null?l:"",(o=r==null?void 0:r.protocol)!=null?o:se.VLESS,$e.Settings.fromProtocol((i=r==null?void 0:r.protocol)!=null?i:se.VLESS,r==null?void 0:r.settings),ns.fromJson(r==null?void 0:r.streamSettings),(a=r==null?void 0:r.sendThrough)!=null?a:"",vn.fromJson(r==null?void 0:r.mux))}toJson(){var l,o;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof lt?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(o=this.mux)!=null&&o.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const o=l[0].toLowerCase();try{switch(o){case se.VMess:return $e.fromVmessLink(JSON.parse(Wi(l[1])));case se.VLESS:case se.Trojan:case"ss":return $e.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var a,c,u,p,g,f,_,w,b,y,C,E,O,ee,D,F,A,I,De,ge,te,L,Q;if(!r)return null;const l=new ns((a=r==null?void 0:r.net)!=null?a:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),o=r==null?void 0:r.net;o==="tcp"?l.tcp=new Jr((u=r==null?void 0:r.type)!=null?u:"none",(p=r==null?void 0:r.host)!=null?p:"",(g=r==null?void 0:r.path)!=null?g:""):o==="kcp"?(l.kcp=new Fs,l.kcp.type=(f=r==null?void 0:r.type)!=null?f:"none",l.kcp.seed=(_=r==null?void 0:r.path)!=null?_:""):o==="ws"?l.ws=new fs((w=r==null?void 0:r.path)!=null?w:"/",(b=r==null?void 0:r.host)!=null?b:""):o==="grpc"?l.grpc=new bs((y=r==null?void 0:r.path)!=null?y:"",(C=r==null?void 0:r.authority)!=null?C:"",(r==null?void 0:r.type)==="multi"):o==="httpupgrade"?l.httpupgrade=new Hs((E=r==null?void 0:r.path)!=null?E:"/",(O=r==null?void 0:r.host)!=null?O:""):o==="xhttp"&&(l.xhttp=new Bs((ee=r==null?void 0:r.path)!=null?ee:"/",(D=r==null?void 0:r.host)!=null?D:"",(F=r==null?void 0:r.mode)!=null?F:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new ys((A=r==null?void 0:r.sni)!=null?A:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(I=r==null?void 0:r.fp)!=null?I:"",Boolean(r==null?void 0:r.allowInsecure)));const i=Number((De=r==null?void 0:r.port)!=null?De:0);return Number.isNaN(i)?null:new $e((ge=r==null?void 0:r.ps)!=null?ge:"",se.VMess,new $e.VmessSettings((te=r==null?void 0:r.add)!=null?te:"",i,(L=r==null?void 0:r.id)!=null?L:"",(Q=r==null?void 0:r.scy)!=null?Q:""),l)}static fromParamLink(r){var F,A,I,De,ge,te,L,Q,de,ne,ie,P,ue,Te,Ie,U,T,M,ce,$,Se;let l;try{l=new URL(r)}catch{return null}const o=(F=l.searchParams.get("type"))!=null?F:"tcp",i=(A=l.searchParams.get("security"))!=null?A:"none",a=new ns(o,i),c=(I=l.searchParams.get("headerType"))!=null?I:void 0,u=(De=l.searchParams.get("host"))!=null?De:void 0,p=(ge=l.searchParams.get("path"))!=null?ge:void 0,g=(te=l.searchParams.get("mode"))!=null?te:void 0;if(o==="tcp"||o==="none"?a.tcp=new Jr(c!=null?c:"none",u!=null?u:"",p!=null?p:""):o==="kcp"?(a.kcp=new Fs,a.kcp.type=c!=null?c:"none",a.kcp.seed=p!=null?p:""):o==="ws"?a.ws=new fs(p!=null?p:"/",u!=null?u:""):o==="grpc"?a.grpc=new bs((L=l.searchParams.get("serviceName"))!=null?L:"",(Q=l.searchParams.get("authority"))!=null?Q:"",l.searchParams.get("mode")==="multi"):o==="httpupgrade"?a.httpupgrade=new Hs(p!=null?p:"/",u!=null?u:""):o==="xhttp"&&(a.xhttp=new Bs(p!=null?p:"/",u!=null?u:"",g!=null?g:"")),i==="tls"){const Ee=(de=l.searchParams.get("fp"))!=null?de:"none",we=l.searchParams.get("alpn"),Oe=l.searchParams.get("allowInsecure"),X=(ne=l.searchParams.get("sni"))!=null?ne:"",xe=(ie=l.searchParams.get("ech"))!=null?ie:"";a.tls=new ys(X,we?we.split(","):[],Ee,Oe==="1",xe)}if(i==="reality"){const Ee=(P=l.searchParams.get("pbk"))!=null?P:"",we=(ue=l.searchParams.get("fp"))!=null?ue:"",Oe=(Te=l.searchParams.get("sni"))!=null?Te:"",X=(Ie=l.searchParams.get("sid"))!=null?Ie:"",xe=(U=l.searchParams.get("spx"))!=null?U:"",G=(T=l.searchParams.get("pqv"))!=null?T:"";a.reality=new Vs(Ee,we,Oe,X,xe,G)}const f=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,_=r.match(f);if(!_)return null;let[,w,b,y,C]=_,E=Number(C);Number.isNaN(E)&&(E=0),w==="ss"&&(w=se.Shadowsocks,b=Wi(b));let O=null;switch(w){case se.VLESS:{const Ee=(M=l.searchParams.get("encryption"))!=null?M:"none";O=new $e.VLESSSettings(y,E,b,(ce=l.searchParams.get("flow"))!=null?ce:"",Ee);break}case se.Trojan:O=new $e.TrojanSettings(y,E,b);break;case se.Shadowsocks:{const Ee=b.split(":"),we=($=Ee.shift())!=null?$:"";O=new $e.ShadowsocksSettings(y,E,Ee.join(":"),we,!0);break}default:return null}const ee=decodeURIComponent((Se=l.hash)!=null?Se:""),D=ee.length>1?ee.substring(1):`out-${w}-${E}`;return new $e(D,w,O,a)}};let Bt=$e;V(Bt,"Settings",class extends lt{constructor(o){super();V(this,"protocol");this.protocol=o}static getSettings(o){switch(o){case se.Freedom:return new $e.FreedomSettings;case se.Blackhole:return new $e.BlackholeSettings;case se.DNS:return new $e.DNSSettings;case se.VMess:return new $e.VmessSettings;case se.VLESS:return new $e.VLESSSettings;case se.Trojan:return new $e.TrojanSettings;case se.Shadowsocks:return new $e.ShadowsocksSettings;case se.Socks:return new $e.SocksSettings;case se.HTTP:return new $e.HttpSettings;case se.Wireguard:return new $e.WireguardSettings;default:return null}}static fromProtocol(o,i){switch(o){case se.Freedom:return $e.FreedomSettings.fromJson(i);case se.Blackhole:return $e.BlackholeSettings.fromJson(i);case se.DNS:return $e.DNSSettings.fromJson(i);case se.VMess:return $e.VmessSettings.fromJson(i);case se.VLESS:return $e.VLESSSettings.fromJson(i);case se.Trojan:return $e.TrojanSettings.fromJson(i);case se.Shadowsocks:return $e.ShadowsocksSettings.fromJson(i);case se.Socks:return $e.SocksSettings.fromJson(i);case se.HTTP:return $e.HttpSettings.fromJson(i);case se.Wireguard:return $e.WireguardSettings.fromJson(i);default:return null}}toJson(){return{}}}),V(Bt,"FreedomSettings",($r=class extends lt{constructor(o="",i="",a={},c=[]){super();V(this,"domainStrategy");V(this,"redirect");V(this,"fragment");V(this,"noises");this.domainStrategy=o!=null?o:"",this.redirect=i!=null?i:"",this.fragment=a!=null?a:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new $e.FreedomSettings.Noise)}delNoise(o){this.noises.splice(o,1)}static fromJson(o={}){var i,a;return new $r((i=o==null?void 0:o.domainStrategy)!=null?i:"",(a=o==null?void 0:o.redirect)!=null?a:"",o!=null&&o.fragment?$r.Fragment.fromJson(o.fragment):{},Array.isArray(o==null?void 0:o.noises)?o.noises.map(c=>$r.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:cr.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:cr.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:lt.toJsonArray(this.noises)}}},V($r,"Fragment",class ol extends lt{constructor(a="1-3",c="",u="",p=""){super();V(this,"packets");V(this,"length");V(this,"interval");V(this,"maxSplit");this.packets=a!=null?a:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=p!=null?p:""}static fromJson(a={}){var c,u,p,g;return new ol((c=a==null?void 0:a.packets)!=null?c:"1-3",(u=a==null?void 0:a.length)!=null?u:"",(p=a==null?void 0:a.interval)!=null?p:"",(g=a==null?void 0:a.maxSplit)!=null?g:"")}}),V($r,"Noise",class ll extends lt{constructor(a="rand",c="10-20",u="10-16",p="ip"){super();V(this,"type");V(this,"packet");V(this,"delay");V(this,"applyTo");this.type=a!=null?a:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(a={}){var c,u,p,g;return new ll((c=a==null?void 0:a.type)!=null?c:"rand",(u=a==null?void 0:a.packet)!=null?u:"10-20",(p=a==null?void 0:a.delay)!=null?p:"10-16",(g=a==null?void 0:a.applyTo)!=null?g:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),$r)),V(Bt,"BlackholeSettings",class cl extends lt{constructor(o){super();V(this,"type");this.type=o}static fromJson(o={}){var i;return new cl((i=o==null?void 0:o.response)==null?void 0:i.type)}toJson(){return{response:cr.isEmpty(this.type)?void 0:{type:this.type}}}}),V(Bt,"DNSSettings",class dl extends lt{constructor(o="udp",i="",a=53,c="reject",u=[]){super();V(this,"network");V(this,"address");V(this,"port");V(this,"nonIPQuery");V(this,"blockTypes");this.network=o!=null?o:"udp",this.address=i!=null?i:"",this.port=a!=null?a:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(o={}){var i,a,c,u;return new dl((i=o==null?void 0:o.network)!=null?i:"udp",(a=o==null?void 0:o.address)!=null?a:"",(c=o==null?void 0:o.port)!=null?c:53,(u=o==null?void 0:o.nonIPQuery)!=null?u:"reject",Array.isArray(o==null?void 0:o.blockTypes)?o.blockTypes:[])}}),V(Bt,"VmessSettings",class extends lt{constructor(o="",i=0,a="",c=""){super();V(this,"address");V(this,"port");V(this,"id");V(this,"security");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.security=c!=null?c:""}static fromJson(o={}){var c,u,p,g;if(cr.isArrEmpty(o==null?void 0:o.vnext))return new $e.VmessSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new $e.VmessSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=a==null?void 0:a.id)!=null?p:"",(g=a==null?void 0:a.security)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),V(Bt,"VLESSSettings",class extends lt{constructor(o="",i=0,a="",c="",u=""){super();V(this,"address");V(this,"port");V(this,"id");V(this,"flow");V(this,"encryption");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(o={}){var c,u,p,g,f;if(cr.isArrEmpty(o==null?void 0:o.vnext))return new $e.VLESSSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new $e.VLESSSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=a==null?void 0:a.id)!=null?p:"",(g=a==null?void 0:a.flow)!=null?g:"",(f=a==null?void 0:a.encryption)!=null?f:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),V(Bt,"TrojanSettings",class extends lt{constructor(o="",i=0,a=""){super();V(this,"address");V(this,"port");V(this,"password");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:""}static fromJson(o={}){var a,c,u;if(cr.isArrEmpty(o==null?void 0:o.servers))return new $e.TrojanSettings;const i=o.servers[0];return new $e.TrojanSettings((a=i==null?void 0:i.address)!=null?a:"",(c=i==null?void 0:i.port)!=null?c:0,(u=i==null?void 0:i.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),V(Bt,"ShadowsocksSettings",class extends lt{constructor(o="",i=0,a="",c="",u,p){super();V(this,"address");V(this,"port");V(this,"password");V(this,"method");V(this,"uot");V(this,"UoTVersion");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=p}static fromJson(o={}){var c,u,p,g;let i=o==null?void 0:o.servers;cr.isArrEmpty(i)&&(i=[{}]);const a=i[0];return new $e.ShadowsocksSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=a==null?void 0:a.password)!=null?p:"",(g=a==null?void 0:a.method)!=null?g:"",a==null?void 0:a.uot,a==null?void 0:a.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),V(Bt,"SocksSettings",class extends lt{constructor(o="",i=0,a="",c=""){super();V(this,"address");V(this,"port");V(this,"user");V(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,g,f;let i=o==null?void 0:o.servers;cr.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new $e.SocksSettings((u=a==null?void 0:a.address)!=null?u:"",(p=a==null?void 0:a.port)!=null?p:0,(g=c==null?void 0:c.user)!=null?g:"",(f=c==null?void 0:c.pass)!=null?f:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:cr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),V(Bt,"HttpSettings",class extends lt{constructor(o="",i=0,a="",c=""){super();V(this,"address");V(this,"port");V(this,"user");V(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,g,f;let i=o==null?void 0:o.servers;cr.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new $e.HttpSettings((u=a==null?void 0:a.address)!=null?u:"",(p=a==null?void 0:a.port)!=null?p:0,(g=c==null?void 0:c.user)!=null?g:"",(f=c==null?void 0:c.pass)!=null?f:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:cr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),V(Bt,"WireguardSettings",(Ar=class extends lt{constructor(o=1420,i="",a=[""],c=2,u="",p="",g=[new Ar.Peer],f=!1){super();V(this,"mtu");V(this,"secretKey");V(this,"pubKey");V(this,"address");V(this,"workers");V(this,"domainStrategy");V(this,"reserved");V(this,"peers");V(this,"noKernelTun");this.mtu=o!=null?o:1420,this.secretKey=i!=null?i:"",this.pubKey=this.secretKey.length>0?sh(this.secretKey):"",this.address=Array.isArray(a)?a.join(","):a!=null?a:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=g!=null?g:[new Ar.Peer],this.noKernelTun=Boolean(f)}addPeer(){this.peers.push(new Ar.Peer)}delPeer(o){this.peers.splice(o,1)}static fromJson(o={}){var i,a,c,u,p,g,f;return new Ar((i=o==null?void 0:o.mtu)!=null?i:1420,(a=o==null?void 0:o.secretKey)!=null?a:"",(c=o==null?void 0:o.address)!=null?c:[""],(u=o==null?void 0:o.workers)!=null?u:2,(p=o==null?void 0:o.domainStrategy)!=null?p:"",(g=o==null?void 0:o.reserved)!=null?g:"",Array.isArray(o==null?void 0:o.peers)?o.peers.map(_=>Ar.Peer.fromJson(_)):[new Ar.Peer],(f=o==null?void 0:o.noKernelTun)!=null?f:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:ih.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(o=>Number(o)).filter(o=>!Number.isNaN(o)):void 0,peers:lt.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},V(Ar,"Peer",class extends lt{constructor(a="",c="",u=["0.0.0.0/0","::/0"],p="",g=0){super();V(this,"publicKey");V(this,"psk");V(this,"allowedIPs");V(this,"endpoint");V(this,"keepAlive");this.publicKey=a!=null?a:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=g!=null?g:0}static fromJson(a={}){var c,u,p,g;return new $e.WireguardSettings.Peer((c=a==null?void 0:a.publicKey)!=null?c:"",(u=a==null?void 0:a.preSharedKey)!=null?u:"",Array.isArray(a==null?void 0:a.allowedIPs)?a.allowedIPs:["0.0.0.0/0","::/0"],(p=a==null?void 0:a.endpoint)!=null?p:"",(g=a==null?void 0:a.keepAlive)!=null?g:0)}toJson(){var a;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(a=this.allowedIPs)!=null&&a.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),Ar));class us{static sizeFormat(n){if(n<=0||Number.isNaN(n))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,o=n;for(;o>=1024&&l<r.length-1;)o/=1024,l++;return`${o.toFixed(2)} ${r[l]}`}}const oh=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(ah);const lh=Object.values(nh),ei=["vmess","vless","trojan","shadowsocks","http","socks"],ch=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp"],dh=["none","tls","reality"],Ta=t=>t.split(/[\n,]/).map(n=>n.trim()).filter(Boolean),Pa=t=>t&&t.length?t.join(`
`):"",Is=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",ul=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),uh=t=>{if(!t)return 0;const n=Number(t);return!Number.isNaN(n)&&n>0?n:t.trim()},dr=t=>(Object.keys(t).forEach(n=>{const r=t[n];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[n]}),t),Fi=()=>({user:"",pass:""}),Hi=t=>{var n,r;return{user:(n=t==null?void 0:t.user)!=null?n:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},Bi=t=>{var n,r;return dr({user:(n=t.user)==null?void 0:n.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},Ts=t=>{if(t===""||t===null||typeof t>"u")return;const n=Number(t);return Number.isFinite(n)?n:void 0},hh=t=>{if(!t.sockoptEnabled)return;const n=t.sockopt,r={acceptProxyProtocol:n.acceptProxyProtocol,tcpFastOpen:n.tcpFastOpen,mark:Ts(n.mark),tproxy:n.tproxy||void 0,tcpMptcp:n.tcpMptcp,penetrate:n.penetrate,domainStrategy:n.domainStrategy||void 0,tcpMaxSeg:Ts(n.tcpMaxSeg),dialerProxy:n.dialerProxy||void 0,tcpKeepAliveInterval:Ts(n.tcpKeepAliveInterval),tcpKeepAliveIdle:Ts(n.tcpKeepAliveIdle),tcpUserTimeout:Ts(n.tcpUserTimeout),tcpcongestion:n.tcpcongestion||void 0,V6Only:n.V6Only,tcpWindowClamp:Ts(n.tcpWindowClamp),interface:n.interfaceName||void 0};return dr(r)},Ba=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:ul(),httpAccounts:[Fi()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[Fi()],socksUdpEnabled:!1,socksUdpIp:""}),ph=t=>{var n,r,l,o,i,a,c;return{dest:(r=(n=t==null?void 0:t.dest)==null?void 0:n.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(o=t==null?void 0:t.type)!=null?o:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(i=t==null?void 0:t.alpn)!=null?i:"",xver:(c=(a=t==null?void 0:t.xver)==null?void 0:a.toString())!=null?c:""}},Vi=t=>{var r,l,o;const n={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(o=t.type)==null?void 0:o.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(n.alpn=t.alpn.split(",").map(i=>i.trim()).filter(Boolean)),dr(n)},mh=t=>{var u,p,g,f,_,w,b,y,C,E,O,ee,D,F,A,I,De,ge,te,L,Q,de,ne,ie,P,ue,Te,Ie,U,T,M,ce,$,Se,Ee,we,Oe,X,xe,G,pe,Ce,Ge,ae,re,oe,K,fe,dt,Ve,q,x,N,j,Ne,Ae,je,gt,Tt,Ze,ft,Ct,Rt,Kt,jt,Gt,er,Ft;const n=ei.includes(t.protocol)?t.protocol:"vless",r=Ba(n),l=(u=t.settings)!=null?u:{},o=(p=t.sniffing)!=null?p:{},i=(g=t.streamSettings)!=null?g:{},a=(f=i.tlsSettings)!=null?f:{},c=(_=i.realitySettings)!=null?_:{};return{...r,tag:(w=t.tag)!=null?w:"",listen:(b=t.listen)!=null?b:"",port:(C=(y=t.port)==null?void 0:y.toString())!=null?C:"",disableInsecureEncryption:Boolean((E=l.disableInsecureEncryption)!=null?E:r.disableInsecureEncryption),vlessDecryption:(O=l.decryption)!=null?O:r.vlessDecryption,vlessEncryption:(ee=l.encryption)!=null?ee:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map(B=>ph(B)):r.fallbacks,shadowsocksNetwork:(D=l.network)!=null?D:r.shadowsocksNetwork,sniffingEnabled:Boolean((F=o.enabled)!=null?F:r.sniffingEnabled),sniffingDestinations:Array.isArray(o.destOverride)&&o.destOverride.length?o.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((A=o.routeOnly)!=null?A:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((I=o.metadataOnly)!=null?I:r.sniffingMetadataOnly),streamNetwork:(De=i.network)!=null?De:r.streamNetwork,streamSecurity:(ge=i.security)!=null?ge:r.streamSecurity,tlsServerName:(te=a.serverName)!=null?te:r.tlsServerName,tlsAlpn:Array.isArray(a.alpn)?a.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((L=a.allowInsecure)!=null?L:r.tlsAllowInsecure),tlsFingerprint:(Q=a.fingerprint)!=null?Q:r.tlsFingerprint,realityPrivateKey:(de=c.privateKey)!=null?de:r.realityPrivateKey,realityServerNames:Pa(c.serverNames),realityShortIds:Pa(c.shortIds),realityDest:(ne=c.dest)!=null?ne:r.realityDest,realitySpiderX:(ie=c.spiderX)!=null?ie:r.realitySpiderX,realityXver:(ue=(P=c.xver)==null?void 0:P.toString())!=null?ue:r.realityXver,wsPath:(Ie=(Te=i==null?void 0:i.wsSettings)==null?void 0:Te.path)!=null?Ie:r.wsPath,wsHost:(M=(T=(U=i==null?void 0:i.wsSettings)==null?void 0:U.headers)==null?void 0:T.Host)!=null?M:r.wsHost,tcpHeaderType:(Se=($=(ce=i==null?void 0:i.tcpSettings)==null?void 0:ce.header)==null?void 0:$.type)!=null?Se:r.tcpHeaderType,tcpHttpHosts:Pa((X=(Oe=(we=(Ee=i==null?void 0:i.tcpSettings)==null?void 0:Ee.header)==null?void 0:we.request)==null?void 0:Oe.headers)==null?void 0:X.Host),tcpHttpPath:Array.isArray((pe=(G=(xe=i==null?void 0:i.tcpSettings)==null?void 0:xe.header)==null?void 0:G.request)==null?void 0:pe.path)?i.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(Ge=(Ce=i==null?void 0:i.grpcSettings)==null?void 0:Ce.serviceName)!=null?Ge:r.grpcServiceName,grpcAuthority:(re=(ae=i==null?void 0:i.grpcSettings)==null?void 0:ae.authority)!=null?re:r.grpcAuthority,grpcMultiMode:Boolean((K=(oe=i==null?void 0:i.grpcSettings)==null?void 0:oe.multiMode)!=null?K:r.grpcMultiMode),kcpHeaderType:(Ve=(dt=(fe=i==null?void 0:i.kcpSettings)==null?void 0:fe.header)==null?void 0:dt.type)!=null?Ve:r.kcpHeaderType,kcpSeed:(x=(q=i==null?void 0:i.kcpSettings)==null?void 0:q.seed)!=null?x:r.kcpSeed,quicSecurity:(j=(N=i==null?void 0:i.quicSettings)==null?void 0:N.security)!=null?j:r.quicSecurity,quicKey:(Ae=(Ne=i==null?void 0:i.quicSettings)==null?void 0:Ne.key)!=null?Ae:r.quicKey,quicHeaderType:(Tt=(gt=(je=i==null?void 0:i.quicSettings)==null?void 0:je.header)==null?void 0:gt.type)!=null?Tt:r.quicHeaderType,httpupgradePath:(ft=(Ze=i==null?void 0:i.httpupgradeSettings)==null?void 0:Ze.path)!=null?ft:r.httpupgradePath,httpupgradeHost:(Rt=(Ct=i==null?void 0:i.httpupgradeSettings)==null?void 0:Ct.host)!=null?Rt:r.httpupgradeHost,splithttpPath:(jt=(Kt=i==null?void 0:i.splithttpSettings)==null?void 0:Kt.path)!=null?jt:r.splithttpPath,splithttpHost:(er=(Gt=i==null?void 0:i.splithttpSettings)==null?void 0:Gt.host)!=null?er:r.splithttpHost,vlessSelectedAuth:(Ft=l.selectedAuth)!=null?Ft:r.vlessSelectedAuth,sockoptEnabled:Boolean(i==null?void 0:i.sockopt),sockopt:(()=>{var Ye,tt,St,H,he,J;const B=ul(),ve=(Ye=i==null?void 0:i.sockopt)!=null?Ye:{};return B.acceptProxyProtocol=Boolean(ve.acceptProxyProtocol),B.tcpFastOpen=Boolean(ve.tcpFastOpen),B.mark=Is(ve.mark),B.tproxy=(tt=ve.tproxy)!=null?tt:B.tproxy,B.tcpMptcp=Boolean(ve.tcpMptcp),B.penetrate=Boolean(ve.penetrate),B.domainStrategy=(St=ve.domainStrategy)!=null?St:B.domainStrategy,B.tcpMaxSeg=Is(ve.tcpMaxSeg),B.dialerProxy=(H=ve.dialerProxy)!=null?H:B.dialerProxy,B.tcpKeepAliveInterval=Is(ve.tcpKeepAliveInterval),B.tcpKeepAliveIdle=Is(ve.tcpKeepAliveIdle),B.tcpUserTimeout=Is(ve.tcpUserTimeout),B.tcpcongestion=(he=ve.tcpcongestion)!=null?he:B.tcpcongestion,B.V6Only=Boolean(ve.V6Only),B.tcpWindowClamp=Is(ve.tcpWindowClamp),B.interfaceName=(J=ve.interface)!=null?J:B.interfaceName,B})(),httpAccounts:n==="http"&&Array.isArray(l.accounts)?l.accounts.map(B=>Hi(B)):r.httpAccounts,httpAllowTransparent:n==="http"&&typeof l.allowTransparent=="boolean"?l.allowTransparent:r.httpAllowTransparent,socksAuth:n==="socks"&&l.auth==="password"?"password":r.socksAuth,socksAccounts:n==="socks"&&Array.isArray(l.accounts)?l.accounts.map(B=>Hi(B)):r.socksAccounts,socksUdpEnabled:n==="socks"&&typeof l.udp=="boolean"?l.udp:r.socksUdpEnabled,socksUdpIp:n==="socks"&&l.ip!==void 0&&l.ip!==null?String(l.ip):r.socksUdpIp}},gh=t=>{var l;const n={network:t.streamNetwork,security:t.streamSecurity};t.streamNetwork==="ws"&&(n.wsSettings=dr({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?n.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:Ta(t.tcpHttpHosts)}:{}}}}:n.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(n.grpcSettings=dr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(n.kcpSettings=dr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(n.quicSettings=dr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(n.httpupgradeSettings=dr({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(n.splithttpSettings=dr({path:t.splithttpPath,host:t.splithttpHost})),t.streamSecurity==="tls"&&(n.tlsSettings=dr({serverName:t.tlsServerName||void 0,alpn:(l=t.tlsAlpn)!=null&&l.length?t.tlsAlpn:void 0,allowInsecure:t.tlsAllowInsecure||void 0,fingerprint:t.tlsFingerprint||void 0})),t.streamSecurity==="reality"&&(n.realitySettings=dr({privateKey:t.realityPrivateKey||void 0,serverNames:Ta(t.realityServerNames),shortIds:Ta(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=hh(t);return r&&(n.sockopt=r),dr(n)},fh=t=>{const n={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(n.clients=[]),t.protocol){case"vmess":n.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":n.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(n.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(n.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(Vi).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(Vi).filter(r=>Object.keys(r).length));break;case"shadowsocks":n.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(Bi).filter(l=>Object.keys(l).length);r.length&&(n.accounts=r),t.httpAllowTransparent&&(n.allowTransparent=!0);break}case"socks":{if(n.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(Bi).filter(l=>Object.keys(l).length);r.length&&(n.accounts=r)}n.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(n.ip=t.socksUdpIp.trim());break}}return n},bh=t=>{const n={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:uh(t.port),protocol:t.protocol,settings:fh(t),streamSettings:gh(t)};return t.sniffingEnabled&&(n.sniffing=dr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly})),n};class Va{static gf(n){const r=new Float64Array(16);if(n)for(let l=0;l<n.length;++l)r[l]=n[l];return r}static pack(n,r){let l;const o=this.gf(),i=this.gf();for(let a=0;a<16;++a)i[a]=r[a];this.carry(i),this.carry(i),this.carry(i);for(let a=0;a<2;++a){o[0]=i[0]-65517;for(let c=1;c<15;++c)o[c]=i[c]-65535-(o[c-1]>>16&1),o[c-1]&=65535;o[15]=i[15]-32767-(o[14]>>16&1),l=o[15]>>16&1,o[14]&=65535,this.cswap(i,o,1-l)}for(let a=0;a<16;++a)n[2*a]=i[a]&255,n[2*a+1]=i[a]>>8}static carry(n){for(let r=0;r<16;++r)n[(r+1)%16]+=(r<15?1:38)*Math.floor(n[r]/65536),n[r]&=65535}static cswap(n,r,l){const o=~(l-1);for(let i=0;i<16;++i){const a=o&(n[i]^r[i]);n[i]^=a,r[i]^=a}}static add(n,r,l){for(let o=0;o<16;++o)n[o]=r[o]+l[o]|0}static subtract(n,r,l){for(let o=0;o<16;++o)n[o]=r[o]-l[o]|0}static multmod(n,r,l){const o=new Float64Array(31);for(let i=0;i<16;++i)for(let a=0;a<16;++a)o[i+a]+=r[i]*l[a];for(let i=0;i<15;++i)o[i]+=38*o[i+16];for(let i=0;i<16;++i)n[i]=o[i];this.carry(n),this.carry(n)}static invert(n,r){const l=this.gf();for(let o=0;o<16;++o)l[o]=r[o];for(let o=253;o>=0;--o)this.multmod(l,l,l),o!==2&&o!==4&&this.multmod(l,l,r);for(let o=0;o<16;++o)n[o]=l[o]}static clamp(n){n[31]=n[31]&127|64,n[0]&=248}static generatePublicKey(n){let r;const l=new Uint8Array(32),o=this.gf([1]),i=this.gf([9]),a=this.gf(),c=this.gf([1]),u=this.gf(),p=this.gf(),g=this.gf([56129,1]),f=this.gf([9]);for(let _=0;_<32;++_)l[_]=n[_];this.clamp(l);for(let _=254;_>=0;--_)r=l[_>>>3]>>>(_&7)&1,this.cswap(o,i,r),this.cswap(a,c,r),this.add(u,o,a),this.subtract(o,o,a),this.add(a,i,c),this.subtract(i,i,c),this.multmod(c,u,u),this.multmod(p,o,o),this.multmod(o,a,o),this.multmod(a,i,u),this.add(u,o,a),this.subtract(o,o,a),this.multmod(i,o,o),this.subtract(a,c,p),this.multmod(o,a,g),this.add(o,o,c),this.multmod(a,a,o),this.multmod(o,c,p),this.multmod(c,i,f),this.multmod(i,u,u),this.cswap(o,i,r),this.cswap(a,c,r);return this.invert(a,a),this.multmod(o,o,a),this.pack(l,o),l}static generatePresharedKey(){const n=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(n),n}static generatePrivateKey(){const n=this.generatePresharedKey();return this.clamp(n),n}static encodeBase64(n,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let o=0;o<4;++o)n[o]=l[o]+65+(25-l[o]>>8&6)-(51-l[o]>>8&75)-(61-l[o]>>8&15)+(62-l[o]>>8&3)}static keyToBase64(n){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),n.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([n[r*3+0],n[r*3+1],0])),l[43]=61,Array.from(l).map(o=>String.fromCharCode(o)).join("")}static keyFromBase64(n){const r=globalThis.atob(n),l=new Uint8Array(r.length);for(let o=0;o<r.length;o++)l[o]=r.charCodeAt(o);return l}static generateKeypair(n=""){const r=n.length>0?this.keyFromBase64(n):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:n.length>0?n:this.keyToBase64(r)}}}const ca=t=>Va.generateKeypair(t!=null?t:""),yh=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:Va.generateKeypair.bind(Va)})},Sh=async()=>_e("/xray/vlessenc"),rt=d.exports.forwardRef((t,n)=>e(ye,{size:"sm",ref:n,...t}));rt.displayName="InboundFormInput";const Us=d.exports.forwardRef((t,n)=>e(qe,{size:"sm",ref:n,...t}));Us.displayName="InboundFormSelect";const pn=d.exports.forwardRef((t,n)=>e(ur,{size:"sm",resize:"vertical",ref:n,...t}));pn.displayName="InboundFormTextarea";const $i=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),xh=t=>{const n=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!n)return"";const r=n.length%4;return r===0?n:`${n}${"=".repeat(4-r)}`},kh=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],wh=["bbr","cubic","reno"],vh=["off","redirect","tproxy"],Ch=({isOpen:t,mode:n,initialValue:r,isSubmitting:l,onClose:o,onSubmit:i})=>{var fe,dt,Ve,q;const{t:a}=Fe(),c=Mt(),[u,p]=d.exports.useState([]),[g,f]=d.exports.useState(!1),_=vr({defaultValues:Ba()}),{control:w,register:b,handleSubmit:y,reset:C,watch:E}=_,{fields:O,append:ee,remove:D}=gn({control:w,name:"fallbacks"}),{fields:F,append:A,remove:I}=gn({control:w,name:"httpAccounts"}),{fields:De,append:ge,remove:te}=gn({control:w,name:"socksAccounts"}),L=Wt({control:w,name:"protocol"})||E("protocol"),Q=Wt({control:w,name:"streamNetwork"})||E("streamNetwork"),de=Wt({control:w,name:"streamSecurity"})||E("streamSecurity"),ne=(fe=Wt({control:w,name:"sniffingEnabled"}))!=null?fe:E("sniffingEnabled"),ie=Wt({control:w,name:"realityPrivateKey"})||E("realityPrivateKey"),P=Wt({control:w,name:"tcpHeaderType"})||E("tcpHeaderType"),ue=(dt=Wt({control:w,name:"sockoptEnabled"}))!=null?dt:!1,Te=Wt({control:w,name:"vlessSelectedAuth"})||"",Ie=Wt({control:w,name:"socksAuth"})||E("socksAuth")||"noauth",U=(q=(Ve=Wt({control:w,name:"socksUdpEnabled"}))!=null?Ve:E("socksUdpEnabled"))!=null?q:!1,T=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),M=d.exports.useMemo(()=>{const x=[...T,...u.map(j=>j.label)].filter(Boolean);return Array.from(new Set(x)).map(j=>({label:j,value:j}))},[T,u]);d.exports.useEffect(()=>{if(t)if(r){const x=mh(r);C(x)}else C(Ba())},[r,C,t]);const ce=d.exports.useCallback((x,N)=>s(k,{children:[e(v,{children:N}),e(at,{control:w,name:`sockopt.${x}`,render:({field:j})=>{const Ne=typeof j.value=="number"||typeof j.value=="string"?j.value:void 0;return e(Yr,{min:0,value:Ne!=null?Ne:"",onChange:Ae=>j.onChange(Ae),children:e(qr,{})})}})]}),[w]),$=d.exports.useCallback((x,N)=>s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:N}),e(at,{control:w,name:`sockopt.${x}`,render:({field:j})=>e(ct,{isChecked:typeof j.value=="boolean"?j.value:Boolean(j.value),onChange:Ne=>j.onChange(Ne.target.checked)})})]}),[w]),Se=d.exports.useCallback((x,N,j)=>s(k,{children:[e(v,{children:N}),e(rt,{...b(`sockopt.${x}`),placeholder:j})]}),[b]),Ee=L==="vless"||L==="trojan",we=Qe("gray.200","gray.700"),Oe=async x=>{await i(x)},X=d.exports.useCallback(()=>{try{const{privateKey:x}=ca();_.setValue("realityPrivateKey",$i(x),{shouldDirty:!0})}catch(x){c({status:"error",title:a("inbounds.reality.generateError","Unable to generate key pair"),description:x instanceof Error?x.message:void 0})}},[_,c,a]),xe=d.exports.useCallback(()=>{try{const x=typeof window>"u"?void 0:window.crypto;if(!(x!=null&&x.getRandomValues))throw new Error("Crypto API is not available in this environment.");const N=new Uint8Array(4);x.getRandomValues(N);const j=Array.from(N).map(je=>je.toString(16).padStart(2,"0")).join(""),Ae=(_.getValues("realityShortIds")||"").split(/[\s,]+/).map(je=>je.trim()).filter(Boolean);Ae.push(j),_.setValue("realityShortIds",Ae.join(`
`),{shouldDirty:!0})}catch(x){c({status:"error",title:a("inbounds.reality.shortIdError","Unable to generate short ID"),description:x instanceof Error?x.message:void 0})}},[_,c,a]),G=d.exports.useMemo(()=>{const x=xh(ie);if(!x)return"";try{const{publicKey:N}=ca(x);return $i(N)}catch{return""}},[ie]),pe=()=>ee({dest:"",path:"",type:"",alpn:"",xver:""}),Ce=d.exports.useCallback(async()=>{var x;f(!0);try{const N=await Sh(),j=(x=N==null?void 0:N.auths)!=null?x:[];return p(j),j}catch(N){return console.error(N),c({status:"error",title:a("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{f(!1)}},[c,a]),Ge=d.exports.useCallback(async()=>u.length?u:Ce(),[Ce,u]),ae=d.exports.useCallback((x,N)=>{var Ne,Ae;const j=N.find(je=>je.label===x);if(!j){c({status:"warning",title:a("inbounds.vless.authNotFound","Authentication block not available")});return}_.setValue("vlessDecryption",(Ne=j.decryption)!=null?Ne:"",{shouldDirty:!0}),_.setValue("vlessEncryption",(Ae=j.encryption)!=null?Ae:"",{shouldDirty:!0})},[_,a,c]),re=d.exports.useCallback(async x=>{if(!x){_.setValue("vlessDecryption","",{shouldDirty:!0}),_.setValue("vlessEncryption","",{shouldDirty:!0});return}const N=await Ge();N.length&&ae(x,N)},[ae,Ge,_]),oe=d.exports.useCallback(async()=>{const x=_.getValues("vlessSelectedAuth");if(!x){c({status:"info",title:a("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const N=await Ce();N.length&&ae(x,N)},[ae,Ce,_,a,c]),K=d.exports.useCallback(()=>{_.setValue("vlessSelectedAuth","",{shouldDirty:!0}),_.setValue("vlessDecryption","",{shouldDirty:!0}),_.setValue("vlessEncryption","",{shouldDirty:!0})},[_]);return d.exports.useEffect(()=>{t&&L==="vless"&&Ge()},[L,Ge,t]),s(Nt,{isOpen:t,onClose:o,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(ht,{}),s(zt,{maxW:{base:"95vw",md:"4xl"},children:[e(mt,{children:n==="create"?a("inbounds.add","Add inbound"):a("inbounds.edit","Edit inbound")}),e(Pt,{}),e(pt,{children:s(le,{align:"stretch",spacing:6,children:[s(ke,{spacing:4,borderWidth:"1px",borderColor:we,borderRadius:"lg",p:4,children:[s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{isRequired:!0,children:[e(v,{children:a("inbounds.tag","Tag")}),e(rt,{...b("tag",{required:!0}),isDisabled:n==="edit"})]}),s(k,{children:[e(v,{children:a("inbounds.listen","Listen address")}),e(rt,{placeholder:"0.0.0.0",...b("listen")})]})]}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{isRequired:!0,children:[e(v,{children:a("inbounds.port","Port")}),e(rt,{placeholder:"443",...b("port",{required:!0})})]}),s(k,{isRequired:!0,children:[e(v,{children:a("inbounds.protocol","Protocol")}),e(Us,{...b("protocol",{required:!0}),isDisabled:n==="edit",children:ei.map(x=>e("option",{value:x,children:x.toUpperCase()},x))})]})]}),L==="vmess"&&s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(ct,{...b("disableInsecureEncryption")})]}),L==="shadowsocks"&&s(k,{children:[e(v,{children:a("inbounds.shadowsocks.network","Allowed networks")}),e(rt,{...b("shadowsocksNetwork")})]}),L==="vless"&&s(ke,{spacing:3,children:[e(at,{control:w,name:"vlessSelectedAuth",render:({field:x})=>s(k,{children:[e(v,{children:a("inbounds.vless.authentication","Authentication")}),s(qe,{placeholder:a("inbounds.vless.authPlaceholder","Select authentication"),value:x.value||"",onChange:async N=>{const j=N.target.value;x.onChange(j),await re(j)},children:[e("option",{value:"",children:a("common.none","None")}),M.map(N=>e("option",{value:N.value,children:N.label},N.value))]})]})}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:a("inbounds.vless.decryption","Decryption")}),e(rt,{...b("vlessDecryption")})]}),s(k,{children:[e(v,{children:a("inbounds.vless.encryption","Encryption")}),e(rt,{...b("vlessEncryption")})]})]}),s(z,{spacing:3,children:[e(Y,{size:"sm",onClick:oe,isLoading:g,isDisabled:!Te,children:a("inbounds.vless.getKeys","Get new keys")}),e(Y,{size:"sm",variant:"ghost",onClick:K,children:a("inbounds.vless.clearKeys","Clear")})]})]}),L==="http"&&s(ke,{spacing:3,children:[s(yt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("inbounds.http.accounts","HTTP accounts")}),e(Y,{size:"xs",onClick:()=>A({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),s(ke,{spacing:3,children:[F.map((x,N)=>s(R,{borderWidth:"1px",borderRadius:"md",borderColor:we,p:3,children:[s(yt,{justify:"space-between",align:"center",mb:3,children:[s(h,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",N+1]}),e(Y,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>I(N),children:a("hostsPage.delete","Delete")})]}),s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("username","Username")}),e(rt,{...b(`httpAccounts.${N}.user`)})]}),s(k,{children:[e(v,{children:a("password","Password")}),e(rt,{...b(`httpAccounts.${N}.pass`)})]})]})]},x.id)),!F.length&&e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.http.allowTransparent","Allow transparent proxy")}),e(ct,{...b("httpAllowTransparent")})]})]}),L==="socks"&&s(ke,{spacing:3,children:[s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.socks.udp","Enable UDP")}),e(ct,{...b("socksUdpEnabled")})]}),U&&s(k,{children:[e(v,{children:a("inbounds.socks.udpIp","UDP bind IP")}),e(rt,{...b("socksUdpIp"),placeholder:"127.0.0.1"})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.socks.auth","Require authentication")}),e(at,{control:w,name:"socksAuth",render:({field:x})=>e(ct,{isChecked:x.value==="password",onChange:N=>x.onChange(N.target.checked?"password":"noauth")})})]}),Ie==="password"&&s(ke,{spacing:3,children:[s(yt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("inbounds.socks.accounts","SOCKS accounts")}),e(Y,{size:"xs",onClick:()=>ge({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),De.map((x,N)=>s(R,{borderWidth:"1px",borderRadius:"md",borderColor:we,p:3,children:[s(yt,{justify:"space-between",align:"center",mb:3,children:[s(h,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",N+1]}),e(Y,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>te(N),children:a("hostsPage.delete","Delete")})]}),s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("username","Username")}),e(rt,{...b(`socksAccounts.${N}.user`)})]}),s(k,{children:[e(v,{children:a("password","Password")}),e(rt,{...b(`socksAccounts.${N}.pass`)})]})]})]},x.id)),!De.length&&e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),s(ke,{spacing:4,borderWidth:"1px",borderColor:we,borderRadius:"lg",p:4,children:[s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:a("inbounds.network","Network")}),e(Us,{...b("streamNetwork"),children:ch.map(x=>e("option",{value:x,children:x},x))})]}),s(k,{children:[e(v,{children:a("inbounds.security","Security")}),e(Us,{...b("streamSecurity"),children:dh.map(x=>e("option",{value:x,children:x},x))})]})]}),Q==="ws"&&s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:a("inbounds.ws.path","WebSocket path")}),e(rt,{...b("wsPath"),placeholder:"/ws"})]}),s(k,{children:[e(v,{children:a("inbounds.ws.host","WebSocket host header")}),e(rt,{...b("wsHost")})]})]}),Q==="tcp"&&s(ke,{spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.tcp.headerType","TCP header type")}),s(Us,{...b("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),P==="http"&&s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.tcp.host","HTTP host list")}),e(pn,{...b("tcpHttpHosts"),placeholder:"example.com"})]}),s(k,{children:[e(v,{children:a("inbounds.tcp.path","HTTP path")}),e(rt,{...b("tcpHttpPath")})]})]})]}),Q==="grpc"&&s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.grpc.serviceName","Service name")}),e(rt,{...b("grpcServiceName")})]}),s(k,{children:[e(v,{children:a("inbounds.grpc.authority","Authority")}),e(rt,{...b("grpcAuthority")})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.grpc.multiMode","Multi mode")}),e(ct,{...b("grpcMultiMode")})]})]}),Q==="kcp"&&s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.kcp.headerType","mKCP header")}),e(rt,{...b("kcpHeaderType")})]}),s(k,{children:[e(v,{children:a("inbounds.kcp.seed","mKCP seed")}),e(rt,{...b("kcpSeed")})]})]}),Q==="quic"&&s(He,{columns:{base:1,md:3},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.quic.security","QUIC security")}),e(rt,{...b("quicSecurity")})]}),s(k,{children:[e(v,{children:a("inbounds.quic.key","QUIC key")}),e(rt,{...b("quicKey")})]}),s(k,{children:[e(v,{children:a("inbounds.quic.headerType","QUIC header type")}),e(rt,{...b("quicHeaderType")})]})]}),Q==="httpupgrade"&&s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.httpUpgrade.path","Path")}),e(rt,{...b("httpupgradePath")})]}),s(k,{children:[e(v,{children:a("inbounds.httpUpgrade.host","Host")}),e(rt,{...b("httpupgradeHost")})]})]}),Q==="splithttp"&&s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.splitHttp.path","Path")}),e(rt,{...b("splithttpPath")})]}),s(k,{children:[e(v,{children:a("inbounds.splitHttp.host","Host")}),e(rt,{...b("splithttpHost")})]})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.sockopt.enable","Enable sockopt")}),e(at,{control:w,name:"sockoptEnabled",render:({field:x})=>e(ct,{isChecked:Boolean(x.value),onChange:N=>x.onChange(N.target.checked)})})]}),e(yn,{in:Boolean(ue),animateOpacity:!0,children:s(ke,{spacing:4,borderWidth:"1px",borderColor:we,borderRadius:"md",p:4,mt:2,children:[s(He,{columns:{base:1,md:2},spacing:3,children:[ce("mark",a("inbounds.sockopt.routeMark","Route mark")),ce("tcpKeepAliveInterval",a("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),ce("tcpKeepAliveIdle",a("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),ce("tcpMaxSeg",a("inbounds.sockopt.tcpMaxSeg","TCP max segment")),ce("tcpUserTimeout",a("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),ce("tcpWindowClamp",a("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),s(He,{columns:{base:1,md:2},spacing:3,children:[Se("dialerProxy",a("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),Se("interfaceName",a("inbounds.sockopt.interfaceName","Interface name"))]}),s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.sockopt.domainStrategy","Domain strategy")}),e(at,{control:w,name:"sockopt.domainStrategy",render:({field:x})=>s(qe,{...x,children:[e("option",{value:"",children:a("common.none","None")}),kh.map(N=>e("option",{value:N,children:N},N))]})})]}),s(k,{children:[e(v,{children:a("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(at,{control:w,name:"sockopt.tcpcongestion",render:({field:x})=>s(qe,{...x,children:[e("option",{value:"",children:a("common.none","None")}),wh.map(N=>e("option",{value:N,children:N},N))]})})]}),s(k,{children:[e(v,{children:a("inbounds.sockopt.tproxy","TProxy")}),e(at,{control:w,name:"sockopt.tproxy",render:({field:x})=>e(qe,{...x,children:vh.map(N=>e("option",{value:N,children:N},N))})})]})]}),s(He,{columns:{base:1,md:2},spacing:3,children:[$("acceptProxyProtocol",a("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),$("tcpFastOpen",a("inbounds.sockopt.tcpFastOpen","TCP fast open")),$("tcpMptcp",a("inbounds.sockopt.tcpMptcp","Multipath TCP")),$("penetrate",a("inbounds.sockopt.penetrate","Penetrate")),$("V6Only",a("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),de==="tls"&&s(ke,{spacing:4,borderWidth:"1px",borderColor:we,borderRadius:"lg",p:4,children:[s(k,{children:[e(v,{children:a("inbounds.tls.serverName","Server name (SNI)")}),e(rt,{...b("tlsServerName"),placeholder:"example.com"})]}),s(k,{children:[e(v,{children:a("inbounds.tls.fingerprint","uTLS fingerprint")}),s(Us,{...b("tlsFingerprint"),children:[e("option",{value:"",children:a("common.none","None")}),lh.map(x=>e("option",{value:x,children:x},x))]})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.tls.allowInsecure","Allow insecure")}),e(ct,{...b("tlsAllowInsecure")})]})]}),de==="reality"&&s(ke,{spacing:4,borderWidth:"1px",borderColor:we,borderRadius:"lg",p:4,children:[s(k,{isRequired:!0,children:[e(v,{children:a("inbounds.reality.privateKey","Reality private key")}),e(pn,{rows:3,...b("realityPrivateKey",{required:!0})}),e(Y,{size:"xs",mt:2,variant:"outline",onClick:X,alignSelf:"flex-start",children:a("inbounds.reality.generateKeys","Generate key pair")})]}),s(k,{children:[e(v,{children:a("inbounds.reality.publicKey","Reality public key")}),e(rt,{value:G,isReadOnly:!0,placeholder:a("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:a("inbounds.reality.serverNames","Server names")}),e(pn,{rows:2,...b("realityServerNames"),placeholder:"domain.com"}),e(R,{fontSize:"sm",color:"gray.500",children:a("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),s(k,{children:[e(v,{children:a("inbounds.reality.dest","Destination (host:port)")}),e(rt,{...b("realityDest"),placeholder:"example.com:443"})]})]}),s(k,{children:[e(v,{children:a("inbounds.reality.shortIds","Short IDs")}),e(pn,{rows:2,...b("realityShortIds")}),e(Y,{size:"xs",mt:2,variant:"outline",onClick:xe,alignSelf:"flex-start",children:a("inbounds.reality.generateShortId","Generate short ID")}),e(R,{fontSize:"sm",color:"gray.500",children:a("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:a("inbounds.reality.spiderX","SpiderX")}),e(rt,{...b("realitySpiderX")})]}),s(k,{children:[e(v,{children:a("inbounds.reality.xver","Xver")}),e(rt,{...b("realityXver")})]})]})]}),Ee&&s(ke,{spacing:3,borderWidth:"1px",borderColor:we,borderRadius:"lg",p:4,children:[s(yt,{align:"center",justify:"space-between",children:[e(R,{fontWeight:"medium",children:a("inbounds.fallbacks","Fallbacks")}),e(Y,{size:"xs",onClick:pe,children:a("inbounds.fallbacks.add","Add fallback")})]}),O.length===0?e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.fallbacks.empty","No fallbacks configured yet.")}):O.map((x,N)=>s(R,{borderWidth:"1px",borderRadius:"md",borderColor:we,p:3,children:[s(yt,{justify:"space-between",align:"center",mb:3,children:[s(h,{fontWeight:"semibold",children:[a("inbounds.fallbacks.type","Fallback")," #",N+1]}),e(Y,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>D(N),children:a("hostsPage.delete","Delete")})]}),s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.fallbacks.dest","Destination (host:port)")}),e(rt,{placeholder:"example.com:443",...b(`fallbacks.${N}.dest`)})]}),s(k,{children:[e(v,{children:a("inbounds.fallbacks.path","Path")}),e(rt,{...b(`fallbacks.${N}.path`),placeholder:"/"})]}),s(k,{children:[e(v,{children:a("inbounds.fallbacks.type","Type")}),e(rt,{...b(`fallbacks.${N}.type`),placeholder:"none"})]}),s(k,{children:[e(v,{children:a("inbounds.fallbacks.alpn","ALPN")}),e(rt,{...b(`fallbacks.${N}.alpn`),placeholder:"h2,http/1.1"})]}),s(k,{children:[e(v,{children:"Xver"}),e(rt,{...b(`fallbacks.${N}.xver`),placeholder:"0"})]})]})]},x.id))]}),s(ke,{spacing:4,borderWidth:"1px",borderColor:we,borderRadius:"lg",p:4,children:[s(yt,{align:"center",justify:"space-between",children:[s(z,{spacing:2,children:[e(R,{fontWeight:"medium",children:a("inbounds.sniffing","Sniffing")}),e(it,{label:a("inbounds.sniffingHint","It is recommended to keep the default."),children:e(wc,{width:16,height:16})})]}),e(ct,{...b("sniffingEnabled")})]}),ne&&s(ke,{spacing:3,children:[s(k,{children:[e(v,{children:a("inbounds.sniffingDestinations","Protocols to sniff")}),e(at,{control:w,name:"sniffingDestinations",render:({field:x})=>{var N;return e(Xn,{value:(N=x.value)!=null?N:[],onChange:x.onChange,children:e(z,{spacing:4,children:oh.map(j=>e(mr,{value:j.value,children:j.label},j.value))})})}})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.sniffingRouteOnly","Route only")}),e(ct,{...b("sniffingRouteOnly")})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:0,children:a("inbounds.sniffingMetadataOnly","Metadata only")}),e(ct,{...b("sniffingMetadataOnly")})]})]})]})]})}),s(It,{children:[e(Y,{variant:"ghost",mr:3,onClick:o,children:a("hostsPage.cancel","Cancel")}),e(Y,{colorScheme:"primary",isLoading:l,onClick:y(Oe),children:n==="create"?a("common.create","Create"):a("common.save","Save")})]})]})]})},_h=()=>{const{t}=Fe(),n=Mt(),[r,l]=d.exports.useState([]),[o,i]=d.exports.useState(!0),[a,c]=d.exports.useState(!1),[u,p]=d.exports.useState(null),[g,f]=d.exports.useState({protocol:"all",search:""}),[_,w]=d.exports.useState(null),{isOpen:b,onOpen:y,onClose:C}=Yt(),[E,O]=d.exports.useState("create"),ee=or({base:!1,md:!0}),D=d.exports.useCallback(()=>{i(!0),p(null),_e("/inbounds/full").then(te=>{l(te||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>i(!1))},[t]);d.exports.useEffect(()=>{D()},[D]);const F=d.exports.useMemo(()=>{const te=g.search.trim().toLowerCase();return r.filter(L=>{var Q;return g.protocol!=="all"&&L.protocol!==g.protocol?!1:te?L.tag.toLowerCase().includes(te)||((Q=L.port)==null?void 0:Q.toString().includes(te)):!0})},[r,g]),A=()=>{O("create"),w(null),y()},I=te=>{O("edit"),w(te),y()},De=async te=>{var L;c(!0);try{const Q=bh(te),de=E==="create"?"/inbounds":`/inbounds/${encodeURIComponent(Q.tag)}`;await _e(de,{method:E==="create"?"POST":"PUT",body:Q}),n({status:"success",title:E==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),kn(),await D(),C()}catch(Q){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((L=Q==null?void 0:Q.data)==null?void 0:L.detail)||(Q==null?void 0:Q.message)})}finally{c(!1)}},ge=async te=>{var Q;const L=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:te.tag});if(!!window.confirm(L)){c(!0);try{await _e(`/inbounds/${encodeURIComponent(te.tag)}`,{method:"DELETE"}),n({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),kn(),await D()}catch(de){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((Q=de==null?void 0:de.data)==null?void 0:Q.detail)||(de==null?void 0:de.message)})}finally{c(!1)}}};return s(ke,{spacing:4,children:[s(yt,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(ye,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:g.search,onChange:te=>f(L=>({...L,search:te.target.value}))}),s(z,{spacing:3,children:[s(qe,{width:"180px",value:g.protocol,onChange:te=>f(L=>({...L,protocol:te.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),ei.map(te=>e("option",{value:te,children:te.toUpperCase()},te))]}),e(Y,{leftIcon:e(Xr,{width:18,height:18}),onClick:A,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&s(hr,{status:"error",children:[e(pr,{}),u]}),o?e(yt,{justify:"center",py:10,children:e(wt,{})}):F.length===0?e(R,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):ee?e(R,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:s(ms,{variant:"simple",size:"sm",children:[e(zr,{bg:"gray.50",_dark:{bg:"gray.900"},children:s(At,{children:[e(Le,{children:t("inbounds.tag","Tag")}),e(Le,{children:t("inbounds.protocol","Protocol")}),e(Le,{children:t("inbounds.portLabel","Port")}),e(Le,{children:t("inbounds.network","Network")}),e(Le,{children:t("inbounds.security","Security")}),e(Le,{children:t("inbounds.sniffing","Sniffing")}),e(Le,{width:"120px",children:t("actions","Actions")})]})}),e(Ir,{children:F.map(te=>{var Q;const L=te.streamSettings||{};return s(At,{children:[s(Re,{children:[e(h,{fontWeight:"semibold",children:te.tag}),te.listen&&e(h,{fontSize:"sm",color:"gray.500",children:te.listen})]}),e(Re,{children:e(st,{colorScheme:"purple",children:te.protocol})}),e(Re,{children:te.port}),e(Re,{children:L.network||"\u2014"}),e(Re,{children:L.security&&L.security!=="none"?e(st,{colorScheme:"blue",children:L.security}):"\u2014"}),e(Re,{children:(Q=te.sniffing)!=null&&Q.enabled?e(st,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(st,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Re,{children:s(z,{spacing:2,children:[e(ze,{"aria-label":t("common.edit","Edit"),icon:e(is,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>I(te)}),e(ze,{"aria-label":t("common.delete","Delete"),icon:e(Mr,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ge(te),isLoading:a})]})})]},te.tag)})})]})}):e(ke,{spacing:3,children:F.map(te=>{var Q;const L=te.streamSettings||{};return s(R,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(yt,{justify:"space-between",align:"center",mb:2,children:[s(R,{children:[e(h,{fontWeight:"semibold",children:te.tag}),s(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",te.port]})]}),s(z,{spacing:2,children:[e(ze,{"aria-label":t("common.edit","Edit"),icon:e(is,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>I(te)}),e(ze,{"aria-label":t("common.delete","Delete"),icon:e(Mr,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ge(te),isLoading:a})]})]}),s(ke,{spacing:2,children:[s(z,{spacing:2,wrap:"wrap",children:[e(st,{colorScheme:"purple",children:te.protocol}),L.network&&e(st,{children:L.network}),L.security&&L.security!=="none"&&e(st,{colorScheme:"blue",children:L.security})]}),s(z,{spacing:2,wrap:"wrap",children:[(Q=te.sniffing)!=null&&Q.enabled?e(st,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(st,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),te.listen&&e(st,{size:"sm",colorScheme:"gray",children:te.listen})]})]})]},te.tag)})}),e(Ch,{isOpen:b,mode:E,initialValue:_,isSubmitting:a,onClose:C,onSubmit:De})]})},Dh=()=>{const{t}=Fe();return s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),s(Ks,{colorScheme:"primary",isLazy:!0,children:[s(Js,{children:[e(Vt,{children:s(z,{spacing:2,children:[e(mn,{as:zo,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(Vt,{children:s(z,{spacing:2,children:[e(mn,{as:ko,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),s(qs,{children:[e($t,{px:0,children:s(le,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(_h,{})]})}),e($t,{px:0,children:s(le,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(th,{})]})})]})]})]})},Ah=Pe.object({name:Pe.string().min(1),address:Pe.string().min(1),port:Pe.number().min(1).or(Pe.string().transform(t=>parseFloat(t))),api_port:Pe.number().min(1).or(Pe.string().transform(t=>parseFloat(t))),xray_version:Pe.string().nullable().optional(),id:Pe.number().nullable().optional(),status:Pe.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:Pe.string().nullable().optional(),add_as_new_host:Pe.boolean().optional(),usage_coefficient:Pe.number().or(Pe.string().transform(t=>parseFloat(t))),data_limit:Pe.number().nullable().optional(),uplink:Pe.number().nullable().optional(),downlink:Pe.number().nullable().optional()}),Vn=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0}),Sr="fetch-nodes-query-key",ti=()=>{const{isEditingNodes:t}=ut();return Gr({queryKey:Sr,queryFn:Rn.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Rn=$s((t,n)=>({nodes:[],addNode(r){return _e("/node",{method:"POST",body:r})},fetchNodes(){return _e("/nodes")},fetchNodesUsage(r){return _e("/nodes/usage",{query:r})},updateNode(r){return _e(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return _e(`/node/${r.id}/reconnect`,{method:"POST"})},resetNodeUsage(r){return _e(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return _e("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return _e("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return _e(`/node/${(r=n().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),Ki=({expiryDate:t,status:n,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=Fe(),a=fa(t),c=ps[n].icon;return s(Lt,{children:[s(Wr,{colorScheme:ps[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),l&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[n&&i(`nodeModal.status.${n}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},Ih=Z(bn,{baseStyle:{w:4,h:4}}),Th=Z(Ga,{baseStyle:{w:4,h:4}}),Ph=Z(vc,{baseStyle:{w:4,h:4}}),Eh=Z(So,{baseStyle:{w:4,h:4}}),Ji=1024*1024*1024,Ps=t=>{if(t&&typeof t=="object"&&"message"in t){const n=t.message;return typeof n=="string"?n:void 0}},qi=({isOpen:t,onClose:n,node:r,mutate:l,isLoading:o,isAddMode:i=!1})=>{var te,L,Q,de,ne,ie,P,ue,Te,Ie,U,T,M,ce;const{t:a}=Fe(),c=Mt(),[u,p]=d.exports.useState(i),{fetchNodesUsage:g}=Rn(),[f,_]=d.exports.useState(null),{data:w,isLoading:b}=Gr({queryKey:"node-settings",queryFn:()=>_e("/node/settings")}),y=$=>{if($==null)return null;const Se=$/Ji;return Number.isFinite(Se)?Math.round(Se*100)/100:null},C=$=>$==null?null:Math.round($*Ji),E=i?{...Vn(),add_as_new_host:!1}:{...Vn(),...r,add_as_new_host:!1},O=vr({resolver:ha(Ah),defaultValues:{...E,data_limit:y((te=E.data_limit)!=null?te:null)}}),ee=(L=w==null?void 0:w.certificate)!=null?L:"",{onCopy:D,hasCopied:F}=Fo(ee);d.exports.useEffect(()=>{var $;if(t){const Se=i?{...Vn(),add_as_new_host:!1}:{...Vn(),...r,add_as_new_host:!1};O.reset({...Se,data_limit:y(($=Se.data_limit)!=null?$:null)}),p(i&&!!ee)}},[t,i,r,O,ee]),d.exports.useEffect(()=>{!i&&r&&t?g({start:We().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then($=>{const Se=$.usages[r.id];Se&&_({uplink:Se.uplink,downlink:Se.downlink})}):_(null)},[r,i,t,g]);const A=O.handleSubmit($=>{var Ee;const Se={...$,data_limit:C((Ee=$.data_limit)!=null?Ee:null)};l(Se)}),I=()=>{!ee||(D(),c({title:a("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},De=()=>{if(!ee)return;const $=new Blob([ee],{type:"text/plain"}),Se=URL.createObjectURL($),Ee=document.createElement("a");Ee.href=Se,Ee.download="ssl_client_cert.pem",Ee.click(),URL.revokeObjectURL(Se)},ge=()=>{p(!1),_(null),n()};return s(Nt,{isOpen:t,onClose:ge,size:"lg",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",as:"form",onSubmit:A,children:[e(mt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i?"nodes.addNewMarzbanNode":"nodes.editNode")})}),e(Pt,{mt:3}),e(pt,{children:s(ke,{spacing:6,children:[!i&&f&&s(ke,{spacing:2,children:[e(h,{fontWeight:"medium",children:a("nodes.usage")}),s(z,{children:[s(st,{colorScheme:"green",children:[a("nodes.uplink"),": ",us.sizeFormat(f.uplink)]}),s(st,{colorScheme:"blue",children:[a("nodes.downlink"),": ",us.sizeFormat(f.downlink)]})]})]}),i&&s(ke,{spacing:3,children:[s(z,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("nodes.certificate")}),s(z,{spacing:2,children:[e(Y,{size:"xs",variant:"outline",leftIcon:e(Ph,{}),onClick:I,isDisabled:!ee,children:a(F?"copied":"copy")}),e(Y,{size:"xs",variant:"outline",leftIcon:e(Eh,{}),onClick:De,isDisabled:!ee,children:a("nodes.download-certificate")}),e(it,{placement:"top",label:a(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(ze,{"aria-label":a(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p($=>!$),size:"xs",variant:"ghost",children:u?e(Th,{}):e(Ih,{})})})]})]}),e(yn,{in:u&&!!ee,animateOpacity:!0,children:e(R,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:ee||(b?a("loading"):"")})}),!ee&&!b&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:a("nodes.certificateUnavailable","Certificate not available.")})]}),s(ke,{spacing:4,children:[s(He,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(sr,{label:a("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...O.register("name"),error:Ps((de=(Q=O.formState)==null?void 0:Q.errors)==null?void 0:de.name)})}),e(k,{children:e(sr,{label:a("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...O.register("address"),error:Ps((ie=(ne=O.formState)==null?void 0:ne.errors)==null?void 0:ie.address)})})]}),s(He,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(sr,{label:a("nodes.nodePort"),size:"sm",placeholder:"62050",...O.register("port"),error:Ps((ue=(P=O.formState)==null?void 0:P.errors)==null?void 0:ue.port)})}),e(k,{children:e(sr,{label:a("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...O.register("api_port"),error:Ps((Ie=(Te=O.formState)==null?void 0:Te.errors)==null?void 0:Ie.api_port)})})]}),e(k,{children:e(sr,{label:a("nodes.usageCoefficient"),size:"sm",placeholder:"1",...O.register("usage_coefficient"),error:Ps((T=(U=O.formState)==null?void 0:U.errors)==null?void 0:T.usage_coefficient)})}),s(k,{children:[e(sr,{label:a("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:a("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...O.register("data_limit",{setValueAs:$=>{if($===""||$===null||$===void 0)return null;const Se=Number($);return Number.isFinite(Se)?Se:Number.NaN},validate:$=>$==null?!0:Number.isNaN($)?a("nodes.dataLimitValidation","Data limit must be a valid number"):$>=0||a("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:Ps((ce=(M=O.formState)==null?void 0:M.errors)==null?void 0:ce.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:a("nodes.dataLimitHint","Leave empty for unlimited data.")})]})]}),i&&e(R,{children:e(mr,{...O.register("add_as_new_host"),children:a("nodes.addHostForEveryInbound")})})]})}),s(It,{gap:3,children:[e(Y,{variant:"outline",onClick:ge,children:a("cancel")}),e(Y,{type:"submit",colorScheme:"primary",isLoading:o,children:a(i?"nodes.addNode":"nodes.editNode")})]})]})]})},Nh=({deleteCallback:t})=>{const{deleteNode:n,deletingNode:r,setDeletingNode:l}=Rn(),{t:o}=Fe(),i=Mt(),a=Za(),c=()=>{l(null)},{isLoading:u,mutate:p}=Er(n,{onSuccess:()=>{qt(o("deleteNode.deleteSuccess",{name:r&&r.name}),i),l(null),a.invalidateQueries(Sr),t&&t()},onError:g=>{Qt(g,i)}});return s(Nt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(mt,{pt:6,children:e(gs,{color:"red",children:e(En,{})})}),e(Pt,{mt:3}),s(pt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:o("deleteNode.prompt",{name:r.name})})})]}),s(It,{display:"flex",children:[e(Y,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(Y,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:u?e(wt,{size:"xs"}):void 0,children:o("delete")})]})]})]})},zh=10,Rh=({isOpen:t,title:n,description:r,currentVersion:l,allowPersist:o=!1,isSubmitting:i,onSubmit:a,onClose:c})=>{const{t:u}=Fe(),[p,g]=d.exports.useState(""),[f,_]=d.exports.useState(!1),[w,b]=d.exports.useState(null),y=Gr(["core-xray-releases"],()=>_e("/core/xray/releases",{query:{limit:zh}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(g(l||""),_(!1),b(null))},[t,l]);const C=d.exports.useMemo(()=>{var F,A;return(A=(F=y.data)==null?void 0:F.tags)!=null?A:[]},[y.data]),E=F=>{g(F.target.value)},O=F=>{g(F.target.value)},ee=async()=>{if(!p){b(u("validation.required"));return}try{b(null),await a({version:p,persist:o?f:void 0})}catch(F){F instanceof Error?b(F.message):b(u("core.generalErrorMessage"))}},D=y.isLoading;return s(Nt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(ht,{}),s(zt,{children:[e(mt,{children:n}),e(Pt,{}),e(pt,{children:s(ke,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),s(k,{children:[e(v,{children:u("nodes.coreVersionDialog.latestReleases")}),e(qe,{placeholder:u(D?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&C.includes(p)?p:"",onChange:E,isDisabled:D||C.length===0,size:"sm",children:C.map(F=>e("option",{value:F,children:F},F))}),D&&s(ke,{direction:"row",align:"center",spacing:2,mt:2,children:[e(wt,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),y.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),s(k,{isRequired:!0,children:[e(v,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(ye,{value:p,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:O,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),o&&e(mr,{isChecked:f,onChange:F=>_(F.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),w&&s(hr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(pr,{}),e(as,{children:w})]})]})}),s(It,{children:[e(Y,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(Y,{colorScheme:"primary",onClick:ee,isLoading:i,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},Yi="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",Uh=Z(Ho,{baseStyle:{w:3.5,h:3.5}}),Lh=Z(Xr,{baseStyle:{w:3.5,h:3.5}}),Mh=Z(Or,{baseStyle:{w:4,h:4}}),Oh=({isOpen:t,title:n,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:o,onSubmit:i,onClose:a})=>{const{t:c}=Fe(),[u,p]=d.exports.useState("template"),[g,f]=d.exports.useState(Yi),[_,w]=d.exports.useState(""),[b,y]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[C,E]=d.exports.useState(!0),[O,ee]=d.exports.useState(!1),[D,F]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),f(o||Yi),w(""),y([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),E(!0),ee(!1),F(null))},[t,o]);const A=Gr(["geo-templates",g],()=>_e("/core/geo/templates",{query:g?{index_url:g}:void 0}),{enabled:t&&u==="template"&&Boolean(g),staleTime:10*60*1e3}),I=d.exports.useMemo(()=>{var ne,ie;return(ie=(ne=A.data)==null?void 0:ne.templates)!=null?ie:[]},[A.data]);d.exports.useEffect(()=>{I.length>0&&w(ne=>ne||I[0].name)},[I]);const De=Qe("gray.50","whiteAlpha.50"),ge=()=>{y(ne=>[...ne,{name:"",url:""}])},te=(ne,ie,P)=>{y(ue=>ue.map((Te,Ie)=>Ie===ne?{...Te,[ie]:P}:Te))},L=ne=>{y(ie=>ie.filter((P,ue)=>ue!==ne))},Q=async()=>{const ne=u==="manual"?b.filter(P=>P.name.trim()&&P.url.trim()):[];if(u==="template"){if(!g.trim()){F(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!_){F(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(ne.length===0){F(c("nodes.geoDialog.errors.missingFiles"));return}if(ne.find(ue=>!ue.name.trim()||!ue.url.trim())){F(c("nodes.geoDialog.errors.invalidFile"));return}}F(null);const ie=u==="manual"?ne:[];try{await i({mode:u,templateIndexUrl:g.trim(),templateName:_,files:ie,persistEnv:C,applyToNodes:O})}catch(P){const ue=P instanceof Error?P.message:c("nodes.geoDialog.genericError");F(ue)}},de=()=>s(ke,{spacing:3,bg:De,p:4,borderRadius:"md",children:[b.map((ne,ie)=>s(R,{borderWidth:"1px",borderRadius:"md",p:3,children:[s(He,{columns:{base:1,md:2},spacing:3,children:[s(k,{isRequired:!0,children:[e(v,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(ye,{size:"sm",value:ne.name,placeholder:"geosite.dat",onChange:P=>te(ie,"name",P.target.value)})]}),s(k,{isRequired:!0,children:[e(v,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(ye,{size:"sm",value:ne.url,placeholder:"https://example.com/geosite.dat",onChange:P=>te(ie,"url",P.target.value)})]})]}),e(z,{justify:"flex-end",mt:3,children:e(it,{label:c("nodes.geoDialog.removeFile"),children:e(ze,{"aria-label":"remove file",icon:e(Uh,{}),variant:"ghost",size:"sm",onClick:()=>L(ie),isDisabled:b.length<=1})})})]},`manual-file-${ie}`)),e(Y,{onClick:ge,leftIcon:e(Lh,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return s(Nt,{isOpen:t,onClose:a,size:"xl",isCentered:!0,children:[e(ht,{}),s(zt,{children:[e(mt,{children:n}),e(Pt,{}),e(pt,{children:s(ke,{spacing:4,children:[s(k,{as:"fieldset",children:[e(v,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(ia,{value:u,onChange:ne=>p(ne),children:s(z,{spacing:4,children:[e(Nr,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Nr,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?s(ke,{spacing:3,children:[s(k,{isRequired:!0,children:[e(v,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(ye,{size:"sm",value:g,onChange:ne=>f(ne.target.value)})]}),s(k,{isRequired:!0,children:[e(v,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),s(z,{align:"center",spacing:2,children:[e(qe,{size:"sm",flex:1,value:_,onChange:ne=>w(ne.target.value),isDisabled:A.isLoading||!I.length,placeholder:A.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:I.map(ne=>e("option",{value:ne.name,children:ne.name},ne.name))}),e(it,{label:c("nodes.geoDialog.refreshTemplates"),children:e(ze,{"aria-label":"refresh templates",icon:e(Mh,{}),size:"sm",variant:"outline",onClick:()=>A.refetch(),isLoading:A.isFetching,isDisabled:!g.trim()})})]})]}),A.isError&&s(hr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(pr,{}),e(as,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):de(),l&&s(ke,{spacing:2,children:[e(mr,{isChecked:C,onChange:ne=>E(ne.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(mr,{isChecked:O,onChange:ne=>ee(ne.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),D&&s(hr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(pr,{}),e(as,{children:D})]})]})}),s(It,{children:[e(Y,{variant:"ghost",mr:3,onClick:a,children:c("cancel")}),e(Y,{colorScheme:"primary",onClick:Q,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};We.extend(Pn);const Wh=Z(Xr,{baseStyle:{w:4,h:4}}),Fh=Z(Mr,{baseStyle:{w:4,h:4}}),Hh=Z(is,{baseStyle:{w:4,h:4}}),Gi=Z(Or,{baseStyle:{w:4,h:4}}),Bh=Z(Do,{baseStyle:{w:4,h:4}}),hl=1024**3,Vh=t=>{if(t==null)return"";const n=t/hl;return Number.isFinite(n)?(Math.round(n*100)/100).toString():""},Xi=t=>{const n=t.trim();if(!n)return null;const r=Number(n);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*hl)},$h=()=>{var Gs,Un,Ln,Mn,On,Wn,Tr,cs,Fn,Hn,Bn,Xs,Qs;const{t}=Fe(),{onEditingNodes:n}=ut(),r=ut(be=>be.isEditingNodes),{data:l,isLoading:o,error:i,refetch:a,isFetching:c}=ti(),{addNode:u,updateNode:p,reconnectNode:g,resetNodeUsage:f,updateMasterNode:_,resetMasterUsage:w,setDeletingNode:b}=Rn(),y=Za(),C=Mt(),[E,O]=d.exports.useState(null),[ee,D]=d.exports.useState(!1),[F,A]=d.exports.useState(""),[I,De]=d.exports.useState(null),[ge,te]=d.exports.useState(null),[L,Q]=d.exports.useState(null),[de,ne]=d.exports.useState(null),[ie,P]=d.exports.useState(!1),[ue,Te]=d.exports.useState(!1),[Ie,U]=d.exports.useState(!1),[T,M]=d.exports.useState(null),[ce,$]=d.exports.useState({}),[Se,Ee]=d.exports.useState(null),[we,Oe]=d.exports.useState(null),{isOpen:X,onOpen:xe,onClose:G}=Yt(),pe=d.exports.useRef(null),[Ce,Ge]=d.exports.useState(""),[ae,re]=d.exports.useState(!1),{isOpen:oe,onOpen:K,onClose:fe}=Yt(),dt=d.exports.useRef(null),{data:Ve,isLoading:q,refetch:x,error:N}=Gr(["core-stats"],()=>_e("/core"),{refetchOnWindowFocus:!1}),{data:j,isLoading:Ne,error:Ae,refetch:je}=Gr(["master-node-state"],()=>_e("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(n(!0),()=>{n(!1)}),[n]),d.exports.useEffect(()=>{var Dt,m;if(!j)return;if(ae){const S=Xi(Ce),W=(Dt=j.data_limit)!=null?Dt:null;if(S!==W)return}const be=Vh((m=j.data_limit)!=null?m:null);Ge(be),ae&&re(!1)},[j,ae,Ce]);const{isLoading:gt,mutate:Tt}=Er(u,{onSuccess:()=>{qt(t("nodes.addNodeSuccess"),C),y.invalidateQueries(Sr),D(!1)},onError:be=>{Qt(be,C)}}),{isLoading:Ze,mutate:ft}=Er(p,{onSuccess:()=>{qt(t("nodes.nodeUpdated"),C),y.invalidateQueries(Sr),O(null)},onError:be=>{Qt(be,C)}}),{isLoading:Ct,mutate:Rt}=Er(g,{onSuccess:()=>{y.invalidateQueries(Sr)}}),{mutate:Kt,isLoading:jt}=Er(p,{onSuccess:()=>{y.invalidateQueries(Sr)},onError:be=>{Qt(be,C)},onSettled:(be,Dt,m)=>{(m==null?void 0:m.id)!=null&&$(S=>{const W={...S};return delete W[m.id],W}),M(null)}}),{isLoading:Gt,mutate:er}=Er(f,{onSuccess:()=>{qt(t("nodes.resetUsageSuccess","Node usage reset"),C),y.invalidateQueries(Sr)},onError:be=>{Qt(be,C)},onSettled:()=>{Ee(null),Oe(null),G()}}),{isLoading:Ft,mutate:B}=Er(_,{onSuccess:()=>{qt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),C),je(),re(!1)},onError:be=>{Qt(be,C)}}),{isLoading:ve,mutate:Ye}=Er(w,{onSuccess:()=>{qt(t("nodes.resetMasterUsageSuccess","Master usage reset"),C),je(),fe()},onError:be=>{Qt(be,C)}}),tt=d.exports.useMemo(()=>Xi(Ce),[Ce]),St=(Gs=j==null?void 0:j.data_limit)!=null?Gs:null,H=tt===void 0,he=tt!==void 0&&tt!==St,J=q||Ne,Xe=d.exports.useMemo(()=>{if(N instanceof Error)return N.message;if(typeof N=="string")return N;if(Ae instanceof Error)return Ae.message;if(typeof Ae=="string")return Ae},[N,Ae]),nt=(Un=j==null?void 0:j.total_usage)!=null?Un:0,Ke=(Ln=j==null?void 0:j.data_limit)!=null?Ln:null,ot=(Mn=j==null?void 0:j.remaining_data)!=null?Mn:null,_t=j!=null&&j.updated_at?We(j.updated_at).local().format("YYYY-MM-DD HH:mm"):null,Jt=(On=j==null?void 0:j.status)!=null?On:"error",bt=Je(nt,2),Ot=Ke!==null&&Ke>0?Je(Ke,2):t("nodes.unlimited","Unlimited"),Ut=ot!=null?Je(ot,2):null,xt=be=>{re(!0),Ge(be)},kt=()=>{if(H||tt===void 0){Qt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),C);return}B({data_limit:tt!=null?tt:null})},fr=()=>{re(!0),Ge(""),B({data_limit:null})},Et=()=>{K()},nr=be=>{if(!(be!=null&&be.id))return;const Dt=be.status!=="disabled",m=Dt?"disabled":"connecting",S=be.id;M(S),$(W=>({...W,[S]:!Dt})),Kt({...be,status:m})},br=be=>{!(be!=null&&be.id)||(Oe(be),xe())},lr=()=>{!(we!=null&&we.id)||(Ee(we.id),er(we))},Cr=()=>{Oe(null),G()},yr=()=>De(null),jr=()=>te(null),xs=async({version:be,persist:Dt})=>{var m;if(!!I){if(I.type==="master"){P(!0);try{await _e("/core/xray/update",{method:"POST",body:{version:be,persist_env:Boolean(Dt)}}),qt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:be}),C),await Promise.all([x(),y.invalidateQueries(Sr)]),yr()}catch(S){Qt(S,C)}finally{P(!1)}return}if(I.type==="bulk"){const S=(l!=null?l:[]).filter(W=>W.id!=null&&W.status==="connected");if(S.length===0){C({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}Te(!0);try{const W=[];for(const et of S)try{await _e(`/node/${et.id}/xray/update`,{method:"POST",body:{version:be}}),W.push({status:"fulfilled",node:et})}catch(Xt){W.push({status:"rejected",node:et}),Qt(Xt,C)}const Ue=W.filter(et=>et.status==="fulfilled").length,Be=W.length-Ue,Me=W.length;Ue>0&&qt(t("nodes.coreVersionDialog.bulkSuccess",{success:Ue,total:Me}),C),Be>0&&C({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:Be,total:Me}),status:"error",isClosable:!0,position:"top",duration:4e3}),y.invalidateQueries(Sr),yr()}finally{Te(!1)}return}if(I.type==="node"){const S=I.node;if(!(S!=null&&S.id))return;Q(S.id);try{await _e(`/node/${S.id}/xray/update`,{method:"POST",body:{version:be}}),qt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(m=S.name)!=null?m:t("nodes.unnamedNode","Unnamed node"),version:be}),C),y.invalidateQueries(Sr),yr()}catch(W){Qt(W,C)}finally{Q(null)}}}},ks=async be=>{var m;if(!ge)return;const Dt={mode:be.mode,template_index_url:be.templateIndexUrl,template_name:be.templateName,files:be.files,persist_env:be.persistEnv};if(ge.type==="master"){U(!0);try{await _e("/core/geo/update",{method:"POST",body:Dt}),qt(t("nodes.geoDialog.masterUpdateSuccess"),C),jr()}catch(S){Qt(S,C)}finally{U(!1)}return}if(ge.type==="node"){const S=ge.node;if(!(S!=null&&S.id))return;ne(S.id);try{await _e(`/node/${S.id}/geo/update`,{method:"POST",body:Dt}),qt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(m=S.name)!=null?m:t("nodes.unnamedNode","Unnamed node")}),C),y.invalidateQueries(Sr),jr()}catch(W){Qt(W,C)}finally{ne(null)}}},ws=d.exports.useMemo(()=>{if(!l)return[];const be=F.trim().toLowerCase();return be?l.filter(Dt=>{var Ue,Be,Me;const m=((Ue=Dt.name)!=null?Ue:"").toLowerCase(),S=((Be=Dt.address)!=null?Be:"").toLowerCase(),W=((Me=Dt.xray_version)!=null?Me:"").toLowerCase();return m.includes(be)||S.includes(be)||W.includes(be)}):l},[l,F]),ls=d.exports.useMemo(()=>(l!=null?l:[]).some(be=>be.id!=null&&be.status==="connected"),[l]),_r=d.exports.useMemo(()=>{if(!!i){if(i instanceof Error)return i.message;if(typeof i=="string")return i;if(typeof i=="object"&&"message"in i){const be=i.message;if(typeof be=="string")return be}return t("errorOccurred")}},[i,t]),es=Boolean(_r),Fr=t("nodes.masterNode","Master"),ts=F.trim().toLowerCase(),me=!ts||Fr.toLowerCase().includes(ts)||((Wn=Ve==null?void 0:Ve.version)!=null?Wn:"").toLowerCase().includes(ts),vs=(I==null?void 0:I.type)==="master"?ie:(I==null?void 0:I.type)==="node"?I.node.id!=null&&L===I.node.id:(I==null?void 0:I.type)==="bulk"?ue:!1,Hr=(ge==null?void 0:ge.type)==="master"?Ie:(ge==null?void 0:ge.type)==="node"?ge.node.id!=null&&de===ge.node.id:!1,Cs=(I==null?void 0:I.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(I==null?void 0:I.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(I==null?void 0:I.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Tr=I.node.name)!=null?Tr:t("nodes.unnamedNode","Unnamed node")}):"",_s=(I==null?void 0:I.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(I==null?void 0:I.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(I==null?void 0:I.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(cs=I.node.name)!=null?cs:t("nodes.unnamedNode","Unnamed node")}):"",Ds=(I==null?void 0:I.type)==="master"?(Fn=Ve==null?void 0:Ve.version)!=null?Fn:"":(I==null?void 0:I.type)==="node"&&(Hn=I.node.xray_version)!=null?Hn:"",ba=(ge==null?void 0:ge.type)==="master"?t("nodes.geoDialog.masterTitle"):(ge==null?void 0:ge.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(Bn=ge.node.name)!=null?Bn:t("nodes.unnamedNode","Unnamed node")}):"";return s(le,{spacing:6,align:"stretch",children:[s(ke,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),es&&s(hr,{status:"error",borderRadius:"md",children:[e(pr,{}),e(as,{children:_r})]}),s(ke,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),s(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[s(z,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[s(gr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(Ao,{pointerEvents:"none",children:e(Bh,{color:"gray.400"})}),e(ye,{value:F,onChange:be=>A(be.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(it,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(ze,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(Gi,{}),variant:"ghost",size:"sm",onClick:()=>a(),isLoading:c})})]}),s(ke,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(Y,{variant:"outline",size:"sm",onClick:()=>De({type:"bulk"}),isDisabled:!ls,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(Y,{leftIcon:e(Wh,{}),colorScheme:"primary",size:"sm",onClick:()=>D(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),o?e(He,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((be,Dt)=>e(R,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:s(le,{spacing:3,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${Dt}`))}):s(He,{columns:{base:1,md:2,xl:3},spacing:4,children:[me&&e(R,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:J?s(le,{spacing:3,align:"center",justify:"center",children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Xe?s(le,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Xe}),e(Y,{size:"sm",variant:"outline",onClick:()=>{x(),je()},children:t("refresh","Refresh")})]}):j?s(le,{align:"stretch",spacing:4,children:[s(ke,{spacing:2,children:[s(z,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:Fr}),e(st,{colorScheme:"purple",size:"sm",children:Ve!=null&&Ve.version?`Xray ${Ve.version}`:t("nodes.versionUnknown","Version unknown")})]}),s(z,{spacing:2,align:"center",children:[e(Ki,{status:Jt,compact:!0}),j.limit_exceeded&&e(st,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Ve!=null&&Ve.started?t("nodes.masterStartedAt",{date:We(Ve.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),j.message&&s(hr,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(pr,{}),e(as,{fontSize:"sm",children:j.message})]}),e(Ms,{}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:bt})]}),s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:Ot})]}),Ut&&s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:Ut})]}),_t&&s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:_t})]})]}),s(ke,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[s(gr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(ye,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:Ce,onChange:be=>xt(be.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(wr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(Y,{colorScheme:"primary",size:"sm",onClick:kt,isDisabled:!he||H||Ft,isLoading:Ft,children:t("save","Save")}),e(Y,{variant:"ghost",size:"sm",onClick:fr,isDisabled:Ke===null||Ft,isLoading:Ft&&Ke===null,children:t("nodes.clearDataLimit","Clear limit")})]}),H&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),s(ke,{direction:{base:"column",sm:"row"},spacing:2,children:[e(Y,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>De({type:"master"}),isLoading:ie,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(Y,{size:"sm",variant:"outline",onClick:()=>te({type:"master"}),isLoading:Ie,children:t("nodes.geoDialog.updateMasterButton")}),e(Y,{size:"sm",variant:"outline",colorScheme:"red",onClick:Et,isLoading:ve,children:t("nodes.resetUsage","Reset usage")})]})]}):s(le,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(Y,{size:"sm",variant:"outline",onClick:()=>{x(),je()},children:t("refresh","Refresh")})]})},"master-node"),ws.length>0?ws.map(be=>{var Xt,ds,rs,Zs;const Dt=be.status||"error",m=be==null?void 0:be.id,S=Dt!=="disabled"&&Dt!=="limited",W=m!=null?ce[m]:void 0,Ue=W!=null?W:S,Be=m!=null&&T===m&&jt,Me=m!=null&&L===m,et=m!=null&&de===m;return e(R,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:s(le,{align:"stretch",spacing:4,children:[s(ke,{spacing:2,children:[s(z,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:be.name||t("nodes.unnamedNode","Unnamed node")}),e(ct,{size:"sm",colorScheme:"primary",isChecked:Ue,onChange:()=>nr(be),isDisabled:Be,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),be.status==="error"&&e(Y,{size:"sm",variant:"outline",leftIcon:e(Gi,{}),onClick:()=>Rt(be),isLoading:Ct,children:t("nodes.reconnect")})]}),s(z,{spacing:2,flexWrap:"wrap",children:[e(Ki,{status:Dt,compact:!0}),s(z,{spacing:1,align:"center",children:[e(st,{colorScheme:"blue",size:"sm",children:be.xray_version?`Xray ${be.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(Y,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>m&&De({type:"node",node:be}),isLoading:Me,isDisabled:!m,children:t("nodes.updateCoreAction")})]}),e(Y,{size:"xs",variant:"ghost",onClick:()=>m&&te({type:"node",node:be}),isLoading:et,isDisabled:!m,children:t("nodes.updateGeoAction","Update geo")}),e(Y,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>br(be),isLoading:Gt&&m!=null&&Se===m,isDisabled:!m,children:t("nodes.resetUsage","Reset usage")})]}),Dt==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(Ms,{}),s(He,{columns:{base:1,sm:2},spacingY:2,children:[s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:be.address})]}),s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:be.port})]}),s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:be.api_port})]}),s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:be.usage_coefficient})]}),s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Je(((Xt=be.uplink)!=null?Xt:0)+((ds=be.downlink)!=null?ds:0),2)})]}),s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:be.data_limit!=null&&be.data_limit>0?Je(be.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(Ms,{}),s(z,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[s(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(rs=be.id)!=null?rs:"-"]}),s(Io,{size:"sm",variant:"ghost",children:[e(ze,{"aria-label":t("edit"),icon:e(Hh,{}),onClick:()=>O(be)}),e(ze,{"aria-label":t("delete"),icon:e(Fh,{}),colorScheme:"red",onClick:()=>b(be)})]})]})]})},(Zs=be.id)!=null?Zs:be.name)}):e(R,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(Rh,{isOpen:Boolean(I),onClose:yr,onSubmit:xs,currentVersion:Ds,title:Cs,description:_s,allowPersist:(I==null?void 0:I.type)==="master",isSubmitting:vs}),e(Oh,{isOpen:Boolean(ge),onClose:jr,onSubmit:ks,title:ba,showMasterOptions:(ge==null?void 0:ge.type)==="master",isSubmitting:Hr}),e(Sn,{isOpen:X,leastDestructiveRef:pe,onClose:Cr,children:e(ht,{children:s(xn,{children:[e(mt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(pt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(Qs=(Xs=we==null?void 0:we.name)!=null?Xs:we==null?void 0:we.address)!=null?Qs:t("nodes.thisNode","this node")})}),s(It,{children:[e(Y,{ref:pe,onClick:Cr,children:t("cancel","Cancel")}),e(Y,{colorScheme:"red",onClick:lr,ml:3,isLoading:Gt,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Sn,{isOpen:oe,leastDestructiveRef:dt,onClose:fe,children:e(ht,{children:s(xn,{children:[e(mt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(pt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:Fr})}),s(It,{children:[e(Y,{ref:dt,onClick:fe,children:t("cancel","Cancel")}),e(Y,{colorScheme:"red",onClick:()=>Ye(),ml:3,isLoading:ve,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(qi,{isOpen:ee,onClose:()=>D(!1),mutate:Tt,isLoading:gt,isAddMode:!0}),e(qi,{isOpen:!!E,onClose:()=>O(null),node:E||void 0,mutate:ft,isLoading:Ze}),e(Nh,{deleteCallback:()=>y.invalidateQueries(Sr)})]})},Kh=$s(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([_e("/core").then(({version:n,started:r,logs_websocket:l})=>{t({version:n,started:r,logs_websocket:l})}).catch(n=>{throw console.error("Error fetching /core:",n),n}),_e("/core/config").then(n=>{t({config:n})}).catch(n=>{throw console.error("Error fetching /core/config:",n),n})])}finally{t({isLoading:!1})}},updateConfig:n=>(t({isPostLoading:!0}),_e("/core/config",{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>_e("/core/restart",{method:"POST"})}));const $a=d.exports.forwardRef(({json:t,onChange:n,mode:r="code"},l)=>{const{colorMode:o}=os(),i=d.exports.useRef(null),a=d.exports.useRef(null),c=d.exports.useRef(n),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=n},[n]);const p=d.exports.useCallback(w=>{u.current=w,c.current(w)},[]);d.exports.useEffect(()=>{if(!i.current)return;const w=new Cc(i.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:o==="dark"?"ace/theme/one_dark":"ace/theme/github"});a.current=w;const b=w.aceEditor;b&&(b.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),b.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?w.setText(t):t!==void 0&&w.set(t)}catch{typeof t=="string"&&w.updateText(t)}return()=>{w.destroy(),a.current=null}},[]),d.exports.useEffect(()=>{const w=a.current;if(!w)return;const y=(E=>{if(E==null)return"";if(typeof E=="string")return E;try{return JSON.stringify(E,null,2)}catch{return""}})(t);if(y===null)return;if(u.current!==null){let E=u.current;try{E=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,E===y)return}let C=null;try{C=w.getText()}catch{C=null}if(C!==y)if(typeof t=="string")try{w.updateText(y)}catch{w.setText(y)}else{const E=t==null?{}:t;try{w.update(E)}catch{w.set(E)}}},[t]),d.exports.useEffect(()=>{const w=a.current;if(!!w)try{w.getMode&&w.getMode()!==r?w.setMode(r):w.getMode||w.setMode(r)}catch{w.setMode(r)}},[r]),d.exports.useEffect(()=>{var b;const w=(b=a.current)==null?void 0:b.aceEditor;!w||w.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github")},[o]);const g=Qe("gray.300","whiteAlpha.300"),f=Qe("surface.light","surface.dark"),_=Qe("sm","none");return e(R,{ref:l,border:"1px solid",borderColor:g,bg:f,borderRadius:"lg",h:"full",boxShadow:_,overflow:"hidden",children:e(R,{height:"full",ref:i})})}),Jh=Z(Cn,{baseStyle:{w:4,h:4}}),qh=Z(No,{baseStyle:{w:4,h:4}}),pl=({triggerLabel:t,title:n,children:r})=>{const l=or({base:!0,md:!1});return s(_n,{placement:l?"bottom":"right",isLazy:!0,children:[e(Dn,{children:e(Y,{size:"xs",variant:"outline",children:t!=null?t:e(Jh,{})})}),s(An,{children:[e(In,{}),e(Wo,{}),n&&e(_c,{fontWeight:"semibold",children:n}),e(Tn,{children:r})]})]})},Yh=({chips:t,color:n="blue"})=>{const r=t[0],l=t.slice(1);return s(z,{spacing:2,align:"center",children:[r?e(st,{size:"sm",colorScheme:n,children:r}):e(h,{color:"gray.400",children:"-"}),l.length>0&&e(pl,{triggerLabel:s(st,{size:"sm",children:["+",l.length]}),title:"Details",children:e(le,{align:"stretch",children:t.map((o,i)=>e(z,{justify:"space-between",children:e(h,{children:o})},i))})})]})},Gh=({text:t,label:n})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:o}=Fo(t!=null?t:"");return e(z,{spacing:2,align:"center",children:e(pl,{triggerLabel:r,title:n,children:s(le,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),s(z,{children:[e(ze,{"aria-label":"copy",size:"sm",icon:e(qh,{}),onClick:o}),e(h,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},Qi=500,Xh=t=>{try{let n=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(n.protocol==="https:"?"wss://":"ws://")+bo([n.host+n.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+oa()}catch(n){return console.error("Unable to generate websocket url"),console.error(n),null}},ml=({showTitle:t=!0})=>{const{t:n}=Fe(),{data:r}=ti(),[l,o]=d.exports.useState(""),[i,a]=d.exports.useState([]),c=d.exports.useRef(null),[u,p]=d.exports.useState(!0),{colorMode:g}=os(),f=D=>{if(D!==l){if(!D){o(""),a([]);return}o(D),a([])}},_=d.exports.useCallback(Dc.exports.debounce(D=>{a(F=>F.length>=Qi?[...F.slice(F.length-Qi+1),D]:[...F,D])},50),[]);d.exports.useEffect(()=>()=>{_.cancel()},[_]);const{readyState:w}=Ac(Xh(l),{onMessage:D=>{var F;_((F=D.data)!=null?F:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const D=c.current;if(!D)return;const F=()=>{const I=D.scrollHeight-D.scrollTop-D.clientHeight<=32;p(I)};return D.addEventListener("scroll",F),F(),()=>{D.removeEventListener("scroll",F)}},[]),d.exports.useEffect(()=>{u&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[i,u]);const b=d.exports.useMemo(()=>{const D=g==="dark";return{error:{bg:D?"rgba(248, 113, 113, 0.16)":"red.50",color:D?"#fed7d7":"#c53030",border:D?"#f87171":"#feb2b2"},warn:{bg:D?"rgba(251, 191, 36, 0.18)":"orange.50",color:D?"#fefcbf":"#975a16",border:D?"#fbbf24":"#f6ad55"},info:{bg:D?"rgba(96, 165, 250, 0.18)":"blue.50",color:D?"#bfdbfe":"#1a56db",border:D?"#60a5fa":"#63b3ed"},debug:{bg:D?"rgba(148, 163, 184, 0.16)":"gray.100",color:D?"#e2e8f0":"#1f2933",border:D?"#94a3b8":"#cbd5e1"},default:{bg:D?"rgba(30, 64, 175, 0.1)":"gray.50",color:D?"#e2e8f0":"#1f2933",border:D?"#475569":"#e2e8f0"}}},[g]),y=Qe("#f5f7fb","#1f2329"),C=Qe("gray.200","gray.600"),E=Qe("gray.500","gray.400"),O=Qe("white","gray.700"),ee=D=>/error|failed|exception/i.test(D)?"error":/warn/i.test(D)?"warn":/info/i.test(D)?"info":/debug/i.test(D)?"debug":"default";return s(le,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:n("header.xrayLogs")}),s(ke,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[s(ke,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(r==null?void 0:r[0])&&s(qe,{size:"sm",w:{base:"full",sm:"auto"},bg:O,onChange:D=>f(D.target.value),value:l,children:[e("option",{value:"",children:n("core.master")}),r.map(D=>e("option",{value:String(D.id),children:n(D.name)},D.address))]}),e(h,{fontSize:"sm",color:E,children:n(`core.socket.${w}`)})]}),e(h,{fontSize:"xs",color:E,children:u?n("core.autoScrollOn","Auto-scroll: On"):n("core.autoScrollOff","Auto-scroll: Off")})]}),e(R,{border:"1px solid",borderColor:C,bg:y,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:c,fontFamily:"mono",fontSize:"sm",children:e(le,{align:"stretch",spacing:2,children:i.map((D,F)=>{var De;const A=ee(D),I=(De=b[A])!=null?De:b.default;return e(R,{bg:I.bg,color:I.color,borderLeftWidth:3,borderLeftColor:I.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(Z.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:D})},`${D}-${F}`)})})})]})},Qh=Z(Xr),Zh=Z(Ho),tr={tag:"",protocol:se.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:il.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},Es=t=>{const n={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case se.VMess:n.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case se.VLESS:n.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case se.Trojan:n.servers=[{address:r,port:l,password:t.password||void 0}];break;case se.Shadowsocks:n.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case se.Socks:case se.HTTP:n.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case se.Freedom:n.domainStrategy=t.freedomStrategy||void 0;break;case se.Blackhole:n.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case se.DNS:n.network=t.dnsNetwork,n.address=t.dnsAddress||void 0,n.port=Number(t.dnsPort)||void 0;break;case se.Wireguard:n.secretKey=t.wireguardSecret||void 0,n.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,n.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const o=new ns;o.network=t.network,o.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?o.tcp=new Jr(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?o.ws=new fs(t.wsPath,t.wsHost,0):t.network==="grpc"&&(o.grpc=new bs(t.grpcServiceName,"",!1)),t.tlsEnabled&&(o.tls=new ys(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(o.reality=new Vs(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const a=new Bt(t.tag,t.protocol,n,o,void 0).toJson();return a.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(a.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),a},jh=({isOpen:t,onClose:n,mode:r,initialOutbound:l,onSubmitOutbound:o})=>{const{t:i}=Fe(),a=Mt(),c=Qe("gray.50","whiteAlpha.100"),{control:u,register:p,reset:g,handleSubmit:f,watch:_,getValues:w,setValue:b,formState:{isValid:y}}=vr({defaultValues:tr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:C,append:E,remove:O}=gn({control:u,name:"wireguardPeers"}),ee=_("protocol"),D=_("network"),F=_("tlsEnabled"),A=_("realityEnabled"),I=_("tcpType"),De=_("muxEnabled"),ge=i("validation.required",{defaultValue:"Required"}),te=i("validation.invalidPort",{defaultValue:"Invalid port"}),L=ee||se.VLESS,Q=![se.Freedom,se.Blackhole,se.DNS,se.Wireguard].includes(L),de=[se.VMess,se.VLESS].includes(L),ne=[se.Trojan,se.Shadowsocks].includes(L),ie=L===se.Shadowsocks,P=L===se.DNS,ue=Wt({control:u}),[Te,Ie]=d.exports.useState(0),[U,T]=d.exports.useState(()=>Es(tr)),[M,ce]=d.exports.useState(()=>JSON.stringify(Es(tr),null,2)),[$,Se]=d.exports.useState(null),[Ee,we]=d.exports.useState(""),Oe=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;Ie(0),Se(null),we("");const re=l?xe(l):tr;Oe.current=!0,g(re);const oe=Es(re);T(oe),ce(JSON.stringify(oe,null,2))},[l,t,g]),d.exports.useEffect(()=>{if(!ue)return;if(Oe.current){Oe.current=!1;return}const re=Es(ue);T(re);const oe=JSON.stringify(re,null,2);ce(K=>K===oe?K:oe),Se(null)},[ue]);const X=d.exports.useMemo(()=>[se.VLESS,se.VMess,se.Trojan,se.Shadowsocks,se.Socks,se.HTTP,se.Freedom,se.Blackhole,se.DNS,se.Wireguard],[]),xe=re=>{var dt,Ve,q,x,N,j,Ne,Ae,je,gt,Tt,Ze,ft,Ct,Rt,Kt,jt,Gt,er,Ft,B,ve,Ye,tt,St,H,he,J,Xe,nt,Ke,ot,_t,Jt,bt,Ot,Ut,xt,kt,fr,Et,nr,br,lr,Cr,yr,jr,xs,ks,ws,ls,_r,es,Fr,ts;const oe=Bt.fromJson(re),K={...tr,tag:(dt=re==null?void 0:re.tag)!=null?dt:"",protocol:(oe==null?void 0:oe.protocol)||tr.protocol,sendThrough:(Ve=re==null?void 0:re.sendThrough)!=null?Ve:"",muxEnabled:Boolean((q=re==null?void 0:re.mux)==null?void 0:q.enabled),muxConcurrency:Number((N=(x=re==null?void 0:re.mux)==null?void 0:x.concurrency)!=null?N:tr.muxConcurrency)},fe=oe==null?void 0:oe.stream;switch(K.network=(j=fe==null?void 0:fe.network)!=null?j:tr.network,K.tlsEnabled=(fe==null?void 0:fe.security)==="tls",K.realityEnabled=(fe==null?void 0:fe.security)==="reality",K.tlsServerName=(Ae=(Ne=fe==null?void 0:fe.tls)==null?void 0:Ne.serverName)!=null?Ae:"",K.realityPublicKey=(gt=(je=fe==null?void 0:fe.reality)==null?void 0:je.publicKey)!=null?gt:"",K.realityShortId=(Ze=(Tt=fe==null?void 0:fe.reality)==null?void 0:Tt.shortId)!=null?Ze:"",(fe==null?void 0:fe.network)==="tcp"&&fe.tcp&&(K.tcpType=fe.tcp.type,K.tcpHost=(ft=fe.tcp.host)!=null?ft:"",K.tcpPath=(Ct=fe.tcp.path)!=null?Ct:""),(fe==null?void 0:fe.network)==="ws"&&fe.ws&&(K.wsHost=(Rt=fe.ws.host)!=null?Rt:"",K.wsPath=(Kt=fe.ws.path)!=null?Kt:""),(fe==null?void 0:fe.network)==="grpc"&&fe.grpc&&(K.grpcServiceName=(jt=fe.grpc.serviceName)!=null?jt:""),oe!=null&&oe.hasAddressPort()&&(K.address=(B=(Ft=(Gt=oe.settings)==null?void 0:Gt.address)!=null?Ft:(er=re==null?void 0:re.settings)==null?void 0:er.address)!=null?B:"",K.port=Number((St=(tt=(ve=oe.settings)==null?void 0:ve.port)!=null?tt:(Ye=re==null?void 0:re.settings)==null?void 0:Ye.port)!=null?St:tr.port)),K.protocol){case se.VMess:{const me=oe.settings;K.id=(H=me==null?void 0:me.id)!=null?H:"",K.vnextEncryption=(he=me==null?void 0:me.security)!=null?he:tr.vnextEncryption,K.address=(J=me==null?void 0:me.address)!=null?J:K.address,K.port=Number((Xe=me==null?void 0:me.port)!=null?Xe:K.port);break}case se.VLESS:{const me=oe.settings;K.id=(nt=me==null?void 0:me.id)!=null?nt:"",K.flow=(Ke=me==null?void 0:me.flow)!=null?Ke:"",K.encryption=(ot=me==null?void 0:me.encryption)!=null?ot:K.encryption,K.address=(_t=me==null?void 0:me.address)!=null?_t:K.address,K.port=Number((Jt=me==null?void 0:me.port)!=null?Jt:K.port);break}case se.Trojan:{const me=oe.settings;K.password=(bt=me==null?void 0:me.password)!=null?bt:"",K.address=(Ot=me==null?void 0:me.address)!=null?Ot:K.address,K.port=Number((Ut=me==null?void 0:me.port)!=null?Ut:K.port);break}case se.Shadowsocks:{const me=oe.settings;K.password=(xt=me==null?void 0:me.password)!=null?xt:"",K.method=(kt=me==null?void 0:me.method)!=null?kt:tr.method,K.address=(fr=me==null?void 0:me.address)!=null?fr:K.address,K.port=Number((Et=me==null?void 0:me.port)!=null?Et:K.port);break}case se.Socks:case se.HTTP:{const me=(K.protocol===se.Socks,oe.settings);K.user=(nr=me==null?void 0:me.user)!=null?nr:"",K.pass=(br=me==null?void 0:me.pass)!=null?br:"",K.address=(lr=me==null?void 0:me.address)!=null?lr:K.address,K.port=Number((Cr=me==null?void 0:me.port)!=null?Cr:K.port);break}case se.DNS:{const me=oe.settings;K.dnsNetwork=(yr=me==null?void 0:me.network)!=null?yr:tr.dnsNetwork,K.dnsAddress=(jr=me==null?void 0:me.address)!=null?jr:"",K.dnsPort=Number((xs=me==null?void 0:me.port)!=null?xs:tr.dnsPort);break}case se.Freedom:{const me=oe.settings;K.freedomStrategy=(ks=me==null?void 0:me.domainStrategy)!=null?ks:"";break}case se.Blackhole:{const me=oe.settings;K.blackholeResponse=(ws=me==null?void 0:me.type)!=null?ws:"";break}case se.Wireguard:{const me=oe.settings;K.wireguardSecret=(ls=me==null?void 0:me.secretKey)!=null?ls:"",K.wireguardAddress=(_r=me==null?void 0:me.address)!=null?_r:"";const vs=(Fr=(es=me==null?void 0:me.peers)==null?void 0:es.map(Hr=>{var Cs,_s,Ds;return{publicKey:(Cs=Hr.publicKey)!=null?Cs:"",allowedIPs:Array.isArray(Hr.allowedIPs)?Hr.allowedIPs.join(","):"",endpoint:(_s=Hr.endpoint)!=null?_s:"",keepAlive:Number((Ds=Hr.keepAlive)!=null?Ds:0)}}))!=null?Fr:[];K.wireguardPeers=vs.length>0?vs:tr.wireguardPeers;break}}return((ts=re==null?void 0:re.mux)==null?void 0:ts.concurrency)!=null&&(K.muxConcurrency=Number(re.mux.concurrency)),(!K.wireguardPeers||K.wireguardPeers.length===0)&&(K.wireguardPeers=tr.wireguardPeers),K},G=re=>{ce(re);try{const oe=JSON.parse(re);Se(null),T(oe),Oe.current=!0;const K=xe(oe);g(K)}catch(oe){Se(oe.message)}},pe=()=>{const re=Ee.trim();if(!re){Se(i("pages.outbound.configEmpty","Please paste a config link"));return}const oe=Bt.fromLink(re);if(!oe){Se(i("pages.outbound.invalidConfig","Unsupported or invalid config link")),a({status:"error",duration:2500,position:"top",title:i("pages.outbound.configParseFailedTitle","Conversion failed"),description:i("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const K=oe.toJson(),fe=JSON.stringify(K,null,2);we(""),G(fe),a({status:"success",duration:2e3,position:"top",title:i("pages.outbound.configConvertedTitle","Config converted"),description:i("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},Ce=f(async re=>{var K;const oe=Es(re);try{await o(oe),a({title:r==="edit"?i("pages.xray.outbound.updated","Outbound updated"):i("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),n()}catch(fe){a({title:((K=fe==null?void 0:fe.data)==null?void 0:K.detail)||(fe==null?void 0:fe.message)||i("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),Ge=()=>{n()},ae=re=>{if(Ie(re),re===1){const oe=Es(w());T(oe);const K=JSON.stringify(oe,null,2);ce(fe=>fe===K?fe:K),Se(null)}};return s(Nt,{size:"4xl",isOpen:t,onClose:Ge,scrollBehavior:"inside",children:[e(ht,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),s(zt,{as:"form",onSubmit:Ce,children:[e(mt,{children:r==="edit"?i("pages.xray.outbound.editOutbound","Edit Outbound"):i("pages.xray.outbound.addOutbound")}),e(Pt,{}),e(pt,{children:s(Ks,{variant:"enclosed",colorScheme:"primary",index:Te,onChange:ae,children:[s(Js,{children:[e(Vt,{children:i("form")}),e(Vt,{children:i("json")})]}),s(qs,{children:[e($t,{children:s(le,{spacing:6,align:"stretch",children:[s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.basicSettings","Basic settings")}),s(le,{spacing:3,align:"stretch",children:[s(k,{isRequired:!0,children:[e(v,{children:i("pages.xray.outbound.tag")}),e(ye,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:ge})})]}),s(z,{children:[s(k,{isRequired:!0,children:[e(v,{children:i("protocol")}),e(qe,{size:"sm",...p("protocol"),children:X.map(re=>e("option",{value:re,children:re},re))})]}),s(k,{children:[e(v,{children:i("pages.xray.outbound.sendThrough")}),e(ye,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),Q&&s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.endpoint","Endpoint")}),s(le,{spacing:3,align:"stretch",children:[s(k,{isRequired:Q,children:[e(v,{children:i("pages.outbound.address","Address")}),e(ye,{size:"sm",placeholder:"example.com",...p("address",{required:Q?ge:!1})})]}),s(z,{children:[s(k,{isRequired:Q,children:[e(v,{children:i("pages.outbound.port","Port")}),e(ye,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:Q?ge:!1,valueAsNumber:!0,min:{value:1,message:te},max:{value:65535,message:te}})})]}),de?s(k,{isRequired:de,children:[e(v,{children:"ID"}),e(ye,{size:"sm",placeholder:"UUID",...p("id",{required:de?ge:!1})})]}):ne?s(k,{isRequired:ne,children:[e(v,{children:i("password")}),e(ye,{size:"sm",placeholder:"password",...p("password",{required:ne?ge:!1})})]}):s(k,{children:[e(v,{children:i("username")}),e(ye,{size:"sm",placeholder:"username",...p("user")})]})]}),L===se.Shadowsocks&&s(k,{isRequired:ie,children:[e(v,{children:i("pages.outbound.method","Method")}),e(qe,{size:"sm",...p("method",{required:ie?ge:!1}),children:Object.values(il).map(re=>e("option",{value:re,children:re},re))})]}),L===se.VLESS&&s(z,{children:[s(k,{children:[e(v,{children:i("pages.outbound.encryption","Encryption")}),e(ye,{size:"sm",placeholder:"none",...p("encryption")})]}),s(k,{children:[e(v,{children:"Flow"}),e(ye,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),L===se.VMess&&s(k,{children:[e(v,{children:i("pages.outbound.security","User security")}),e(ye,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),L===se.DNS&&s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.dnsSettings","DNS settings")}),s(z,{children:[s(k,{children:[e(v,{children:i("pages.outbound.network")}),s(qe,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),s(k,{isRequired:P,children:[e(v,{children:i("pages.outbound.port")}),e(ye,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:P?ge:!1,valueAsNumber:!0,min:{value:1,message:te},max:{value:65535,message:te}})})]})]}),s(k,{mt:3,isRequired:P,children:[e(v,{children:i("pages.outbound.address")}),e(ye,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:P?ge:!1})})]})]}),L===se.Freedom&&s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.freedom","Freedom options")}),s(k,{children:[e(v,{children:i("pages.outbound.strategy","Strategy")}),e(ye,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),L===se.Blackhole&&s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.blackhole","Blackhole options")}),s(k,{children:[e(v,{children:i("pages.outbound.response")}),e(ye,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),L===se.Wireguard&&s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.wireguard","Wireguard")}),s(le,{spacing:3,align:"stretch",children:[s(k,{children:[e(v,{children:i("pages.outbound.secretKey","Secret key")}),e(ye,{size:"sm",...p("wireguardSecret")})]}),s(k,{children:[e(v,{children:i("pages.outbound.address")}),e(ye,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),s(le,{spacing:3,align:"stretch",children:[s(z,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:i("pages.outbound.peer","Peers")}),e(ze,{size:"sm","aria-label":i("add"),icon:e(Qh,{boxSize:3}),onClick:()=>E({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),C.map((re,oe)=>s(R,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[s(z,{children:[s(k,{children:[e(v,{children:i("pages.outbound.publicKey","Public key")}),e(ye,{size:"sm",...p(`wireguardPeers.${oe}.publicKey`)})]}),C.length>1&&e(ze,{mt:6,size:"sm","aria-label":i("delete"),icon:e(Zh,{boxSize:3}),onClick:()=>O(oe)})]}),s(z,{mt:2,children:[s(k,{children:[e(v,{children:i("pages.outbound.allowedIPs","Allowed IPs")}),e(ye,{size:"sm",...p(`wireguardPeers.${oe}.allowedIPs`)})]}),s(k,{children:[e(v,{children:i("pages.outbound.endpoint","Endpoint")}),e(ye,{size:"sm",...p(`wireguardPeers.${oe}.endpoint`)})]})]}),s(k,{mt:2,children:[e(v,{children:i("pages.outbound.keepAlive","Keep alive")}),e(ye,{size:"sm",type:"number",...p(`wireguardPeers.${oe}.keepAlive`,{valueAsNumber:!0})})]})]},re.id))]})]})]}),s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.transport","Transport")}),s(le,{spacing:3,align:"stretch",children:[s(k,{children:[e(v,{children:i("pages.outbound.network")}),s(qe,{size:"sm",...p("network"),onChange:re=>{p("network").onChange(re)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),D==="tcp"&&s(z,{children:[s(k,{children:[e(v,{children:i("pages.outbound.tcpHeader","Header")}),s(qe,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),I==="http"&&s(Lt,{children:[s(k,{children:[e(v,{children:i("host")}),e(ye,{size:"sm",...p("tcpHost")})]}),s(k,{children:[e(v,{children:i("path")}),e(ye,{size:"sm",...p("tcpPath")})]})]})]}),D==="ws"&&s(z,{children:[s(k,{children:[e(v,{children:i("host")}),e(ye,{size:"sm",...p("wsHost")})]}),s(k,{children:[e(v,{children:i("path")}),e(ye,{size:"sm",...p("wsPath")})]})]}),D==="grpc"&&s(k,{children:[e(v,{children:i("serviceName")}),e(ye,{size:"sm",...p("grpcServiceName")})]})]})]}),s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.security")}),s(z,{children:[s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:"0",children:"TLS"}),e(ct,{size:"sm",isChecked:F,onChange:re=>{const oe=re.target.checked;b("tlsEnabled",oe),oe&&b("realityEnabled",!1)}})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:"0",children:"Reality"}),e(ct,{size:"sm",isChecked:A,onChange:re=>{const oe=re.target.checked;b("realityEnabled",oe),oe&&b("tlsEnabled",!1)}})]})]}),F&&s(k,{mt:3,children:[e(v,{children:"SNI"}),e(ye,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),A&&s(le,{spacing:3,align:"stretch",mt:3,children:[s(k,{children:[e(v,{children:"SNI"}),e(ye,{size:"sm",...p("tlsServerName")})]}),s(k,{children:[e(v,{children:i("pages.outbound.publicKey")}),e(ye,{size:"sm",...p("realityPublicKey")})]}),s(k,{children:[e(v,{children:i("pages.outbound.shortId")}),e(ye,{size:"sm",...p("realityShortId")})]})]})]}),s(R,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.mux")}),s(k,{display:"flex",alignItems:"center",children:[e(v,{mb:"0",children:i("pages.outbound.enableMux")}),e(ct,{size:"sm",...p("muxEnabled")})]}),De&&s(k,{mt:3,children:[e(v,{children:i("pages.outbound.concurrency")}),e(ye,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e($t,{children:s(le,{align:"stretch",spacing:3,children:[s(k,{children:[e(v,{children:i("pages.outbound.configToJson","Config to JSON")}),s(z,{align:"start",spacing:3,children:[e(ur,{value:Ee,onChange:re=>we(re.target.value),placeholder:i("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(Y,{size:"sm",colorScheme:"primary",onClick:pe,children:i("pages.outbound.convertConfig","Convert")})]})]}),e(R,{height:"420px",children:e($a,{json:U,onChange:G})}),$&&e(h,{fontSize:"sm",color:"red.500",children:$})]})})]})]})}),s(It,{gap:3,children:[e(Y,{variant:"outline",onClick:Ge,children:i("cancel")}),e(Y,{colorScheme:"primary",type:"submit",isDisabled:!y,children:i(r==="edit"?"save":"add")})]})]})]})},ep=["tcp","udp","http","quic","grpc"],tp=["http","tls","bittorrent","quic"],rp=["field","chained"],sp=["","hybrid","linear"],gl={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},Ns=t=>Array.isArray(t)?t.join(", "):"",zs=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(Boolean),np=t=>{var r,l,o,i;if(!t)return{...gl};const n=t.attrs?Object.entries(t.attrs).map(([a,c])=>({key:a,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(o=t.outboundTag)!=null?o:"",balancerTag:(i=t.balancerTag)!=null?i:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:Ns(t.source),sourcePort:Ns(t.sourcePort),domain:Ns(t.domain),ip:Ns(t.ip),user:Ns(t.user),port:Ns(t.port),attrs:n}},ap=t=>{const n={};t.type&&(n.type=t.type),t.domainMatcher&&(n.domainMatcher=t.domainMatcher),t.outboundTag&&(n.outboundTag=t.outboundTag),t.balancerTag&&(n.balancerTag=t.balancerTag),t.inboundTags.length&&(n.inboundTag=t.inboundTags),t.networks.length&&(n.network=t.networks),t.protocols.length&&(n.protocol=t.protocols);const r=zs(t.sourceIps);r.length&&(n.source=r);const l=zs(t.sourcePort);l.length&&(n.sourcePort=l);const o=zs(t.domain);o.length&&(n.domain=o);const i=zs(t.ip);i.length&&(n.ip=i);const a=zs(t.user);a.length&&(n.user=a);const c=zs(t.port);if(c.length&&(n.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:p,value:g})=>{!p.trim()||(u[p.trim()]=g)}),Object.keys(u).length&&(n.attrs=u)}return n.type||(n.type="field"),n},ip=({isOpen:t,mode:n,initialRule:r,availableInboundTags:l,availableOutboundTags:o,availableBalancerTags:i,onSubmit:a,onClose:c})=>{const{t:u}=Fe(),p=Qe("white","gray.900"),{control:g,register:f,handleSubmit:_,reset:w,formState:{isSubmitting:b}}=vr({defaultValues:gl}),{fields:y,append:C,remove:E}=gn({control:g,name:"attrs"});d.exports.useEffect(()=>{t&&w(np(r))},[t,r,w]);const O=()=>C({key:"",value:""}),ee=()=>{c()},D=_(A=>{const I=ap(A);a(I),ee()}),F=d.exports.useMemo(()=>n==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[n,u]);return s(Nt,{isOpen:t,onClose:ee,size:"xl",scrollBehavior:"inside",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{as:"form",onSubmit:D,bg:p,children:[e(mt,{children:F}),e(Pt,{}),e(pt,{children:s(ke,{spacing:5,children:[s(k,{children:[e(v,{children:u("pages.xray.rules.type","Rule Type")}),e(qe,{...f("type"),size:"sm",children:rp.map(A=>e("option",{value:A,children:A||u("core.none","None")},A))})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(qe,{...f("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:o.map(A=>e("option",{value:A,children:A},A))})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(qe,{...f("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:i.map(A=>e("option",{value:A,children:A},A))})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(at,{control:g,name:"inboundTags",render:({field:A})=>e(Xn,{...A,children:e(Qn,{spacing:3,children:l.map(I=>e(fn,{children:e(mr,{value:I,children:I})},I))})})})]}),e(Ms,{}),s(k,{children:[e(v,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(qe,{...f("domainMatcher"),size:"sm",children:sp.map(A=>e("option",{value:A,children:A||u("core.default","Default")},A||"empty"))})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.network","Network")}),e(at,{control:g,name:"networks",render:({field:A})=>e(Xn,{...A,children:e(Qn,{spacing:3,children:ep.map(I=>e(fn,{children:e(mr,{value:I,children:I})},I))})})})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.protocol","Protocol")}),e(at,{control:g,name:"protocols",render:({field:A})=>e(Xn,{...A,children:e(Qn,{spacing:3,children:tp.map(I=>e(fn,{children:e(mr,{value:I,children:I})},I))})})})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.source","Source IPs")}),e(ur,{...f("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(ur,{...f("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.ip","Destination IPs")}),e(ur,{...f("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.domain","Domains")}),e(ur,{...f("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.user","Users")}),e(ur,{...f("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(v,{children:u("pages.xray.rules.port","Ports")}),e(ur,{...f("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(Ms,{}),s(R,{children:[s(k,{children:[e(v,{children:u("pages.xray.rules.attrs","Attributes")}),e(Y,{onClick:O,size:"xs",leftIcon:e(Xr,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),s(ke,{spacing:2,mt:3,children:[y.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),y.map((A,I)=>s(z,{spacing:2,align:"flex-start",children:[e(ye,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...f(`attrs.${I}.key`)}),e(ye,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...f(`attrs.${I}.value`)}),e(ze,{"aria-label":"Remove attribute",icon:e(Ya,{width:16}),size:"sm",variant:"ghost",onClick:()=>E(I)})]},A.id))]})]})]})}),s(It,{gap:3,children:[e(Y,{variant:"outline",onClick:ee,children:u("cancel")}),e(Y,{colorScheme:"primary",type:"submit",isLoading:b,children:n==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},op=({isOpen:t,onClose:n,form:r,setBalancersData:l,balancerIndex:o})=>{const{t:i}=Fe(),a=vr({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=a.handleSubmit(u=>{const p={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},g=r.getValues("config.routing.balancers")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.routing.balancers",g,{shouldDirty:!0}),l(g.map((f,_)=>{var w;return{key:_,tag:f.tag||"",strategy:((w=f.strategy)==null?void 0:w.type)||"random",selector:f.selector||[],fallbackTag:f.fallbackTag||""}})),n()});return s(Nt,{isOpen:t,onClose:n,size:"sm",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(mt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Pt,{mt:3}),e(pt,{children:e("form",{onSubmit:c,children:s(le,{spacing:4,children:[s(k,{children:[e(v,{children:i("pages.xray.balancer.tag")}),e(ye,{...a.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),s(k,{children:[e(v,{children:i("pages.xray.balancer.balancerStrategy")}),e(qe,{...a.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),s(k,{children:[e(v,{children:i("pages.xray.balancer.balancerSelectors")}),e(ye,{...a.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),s(k,{children:[e(v,{children:i("pages.xray.balancer.fallbackTag")}),e(ye,{...a.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(Y,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},lp=({isOpen:t,onClose:n,form:r,setDnsServers:l,dnsIndex:o})=>{const{t:i}=Fe(),a=vr({defaultValues:{address:"",domains:"",expectIPs:""}}),c=a.handleSubmit(u=>{const p={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},g=r.getValues("config.dns.servers")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.dns.servers",g,{shouldDirty:!0}),l(g),n()});return s(Nt,{isOpen:t,onClose:n,size:"sm",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(mt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Pt,{mt:3}),e(pt,{children:e("form",{onSubmit:c,children:s(le,{spacing:4,children:[s(k,{children:[e(v,{children:i("pages.xray.dns.address")}),e(ye,{...a.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),s(k,{children:[e(v,{children:i("pages.xray.dns.domains")}),e(ye,{...a.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),s(k,{children:[e(v,{children:i("pages.xray.dns.expectIPs")}),e(ye,{...a.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(Y,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},cp=({isOpen:t,onClose:n,form:r,setFakeDns:l,fakeDnsIndex:o})=>{const{t:i}=Fe(),a=vr({defaultValues:{ipPool:"",poolSize:""}}),c=a.handleSubmit(u=>{const p={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},g=r.getValues("config.fakedns")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.fakedns",g.length>0?g:null,{shouldDirty:!0}),l(g),n()});return s(Nt,{isOpen:t,onClose:n,size:"sm",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(mt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Pt,{mt:3}),e(pt,{children:e("form",{onSubmit:c,children:s(le,{spacing:4,children:[s(k,{children:[e(v,{children:i("pages.xray.fakedns.ipPool")}),e(ye,{...a.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),s(k,{children:[e(v,{children:i("pages.xray.fakedns.poolSize")}),e(ye,{...a.register("poolSize"),size:"sm",placeholder:"100"})]}),e(Y,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},Ka={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Zi=t=>{var u,p,g,f,_,w,b,y,C,E,O,ee,D;if(!t)return{...Ka};const n=(u=t.settings)!=null?u:{},l=(p=(Array.isArray(n.peers)?n.peers:[])[0])!=null?p:{},o=Array.isArray(n.address)?n.address:[],i=(f=(g=o.find(F=>typeof F=="string"&&F.endsWith("/32")))==null?void 0:g.replace("/32",""))!=null?f:"",a=(w=(_=o.find(F=>typeof F=="string"&&F.endsWith("/128")))==null?void 0:_.replace("/128",""))!=null?w:"",c=Array.isArray(n.reserved)?n.reserved.filter(F=>Number.isFinite(Number(F))).join(","):"";return{tag:(b=t.tag)!=null?b:"warp",privateKey:(C=(y=n.secretKey)!=null?y:n.privateKey)!=null?C:"",publicKey:(E=l.publicKey)!=null?E:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:i,addressV6:a,reserved:c,mtu:(O=n.mtu)!=null?O:1420,domainStrategy:(ee=n.domainStrategy)!=null?ee:"ForceIP",notes:typeof t.notes=="string"?t.notes:(D=n.notes)!=null?D:""}},dp=t=>{const n=[];t.addressV4.trim()&&n.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&n.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(i=>Number(i.trim())).filter(i=>Number.isFinite(i)),o=Bt.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:n,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?o.notes=t.notes.trim():delete o.notes,o},up=t=>{if(!t)return[];try{const n=atob(t);return Array.from(n).map(r=>r.charCodeAt(0))}catch{return[]}},hp=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const n=t;return n.host?n.port?`${n.host}:${n.port}`:n.host:""}return""},pp=(t,n)=>{var p,g,f,_,w,b,y,C,E,O,ee;if(!t||!(n!=null&&n.config))return null;const r=n.config,l=[],o=(g=(p=r.interface)==null?void 0:p.addresses)!=null?g:{};o.v4&&l.push(`${o.v4}/32`),o.v6&&l.push(`${o.v6}/128`);const a=(f=(Array.isArray(r.peers)?r.peers:[])[0])!=null?f:{},c=(w=(_=a.allowed_ips)!=null?_:a.allowedIPs)!=null?w:["0.0.0.0/0","::/0"];return Bt.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(y=(b=r.interface)==null?void 0:b.mtu)!=null?y:1420,secretKey:t.private_key,address:l,reserved:up(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(E=(C=a.public_key)!=null?C:t.public_key)!=null?E:"",endpoint:hp(a.endpoint),allowedIPs:c,keepAlive:(ee=(O=a.keep_alive)!=null?O:a.keepAlive)!=null?ee:0}]}})},ji=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},Ea=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":us.sizeFormat(t),rr=({label:t,value:n})=>{const r=Qe("gray.500","gray.400");return s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:n||"-"})]})},mp=({isOpen:t,onClose:n,initialOutbound:r,onSave:l,onDelete:o})=>{var Ee,we,Oe,X,xe;const{t:i}=Fe(),a=Mt(),[c,u]=d.exports.useState({...Ka}),[p,g]=d.exports.useState(null),[f,_]=d.exports.useState(null),[w,b]=d.exports.useState(null),[y,C]=d.exports.useState(""),[E,O]=d.exports.useState(!1),[ee,D]=d.exports.useState(!1),[F,A]=d.exports.useState(!1),[I,De]=d.exports.useState(!1),[ge,te]=d.exports.useState(!1);d.exports.useEffect(()=>{yh()},[]);const L=d.exports.useCallback(async()=>{var G,pe;O(!0);try{const Ce=await _e("/core/warp",{method:"GET"});g((G=Ce.account)!=null?G:null),_(null),b(null)}catch(Ce){a({title:i("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((pe=Ce==null?void 0:Ce.data)==null?void 0:pe.detail)||(Ce==null?void 0:Ce.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{O(!1)}},[a,i]);d.exports.useEffect(()=>{t&&L().catch(()=>{})},[t,L]),d.exports.useEffect(()=>{t&&u(Zi(r))},[r,t]),d.exports.useEffect(()=>{var G;C((G=p==null?void 0:p.license_key)!=null?G:"")},[p]);const Q=(G,pe)=>{u(Ce=>({...Ce,[G]:pe}))},de=Qe("gray.600","gray.300"),ne=Qe("gray.200","whiteAlpha.200"),ie=()=>{const G=ca();Q("privateKey",G.privateKey),Q("publicKey",G.publicKey),a({title:i("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},P=()=>{const G=Array.from({length:3},()=>Math.floor(Math.random()*256));Q("reserved",G.join(","))},ue=d.exports.useCallback((G,pe)=>{if(!G||!pe){b(null);return}const Ce=pp(G,pe);Ce&&(b(Ce),u(Zi(Ce.toJson())))},[]),Te=async()=>{var G;D(!0);try{const pe=ca(),Ce=await _e("/core/warp/register",{method:"POST",body:{private_key:pe.privateKey,public_key:pe.publicKey}});g(Ce.account),_(Ce.config),ue(Ce.account,Ce.config),a({title:i("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(pe){a({title:i("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((G=pe==null?void 0:pe.data)==null?void 0:G.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{D(!1)}},Ie=async()=>{var G;if(!p){a({title:i("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}De(!0);try{const pe=await _e("/core/warp/config",{method:"GET"});_(pe.config),ue(p,pe.config),a({title:i("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(pe){a({title:i("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((G=pe==null?void 0:pe.data)==null?void 0:G.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{De(!1)}},U=async()=>{var G;if(!!y.trim()){A(!0);try{const pe=await _e("/core/warp/license",{method:"POST",body:{license_key:y.trim()}});g(pe.account),a({title:i("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(pe){a({title:i("pages.xray.warp.licenseFailed","Failed to update license."),description:((G=pe==null?void 0:pe.data)==null?void 0:G.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{A(!1)}}},T=async()=>{var G;te(!0);try{await _e("/core/warp",{method:"DELETE"}),g(null),_(null),b(null),o(),a({title:i("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(pe){a({title:i("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((G=pe==null?void 0:pe.data)==null?void 0:G.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{te(!1)}},M=()=>{if(!w)return;const G=w.toJson();l(G),a({title:i("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},ce=()=>{o(),u({...Ka}),a({title:i("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},$=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){a({title:i("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const G=dp(c);l(G),n()},Se=d.exports.useMemo(()=>Boolean(r),[r]);return s(Nt,{isOpen:t,onClose:n,size:"xl",scrollBehavior:"inside",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),s(zt,{children:[e(mt,{children:i("pages.xray.warp.manage","Manage WARP")}),e(Pt,{}),e(pt,{children:s(le,{spacing:5,align:"stretch",children:[s(hr,{status:"info",borderRadius:"md",children:[e(pr,{}),e(as,{children:i("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(R,{borderWidth:"1px",borderColor:ne,borderRadius:"lg",p:4,children:p?s(le,{spacing:4,align:"stretch",children:[s(He,{columns:{base:1,md:2},spacing:4,children:[e(rr,{label:i("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(rr,{label:i("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(rr,{label:i("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(rr,{label:i("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(rr,{label:i("pages.xray.warp.registeredAt","Registered at"),value:ji(p.created_at)}),e(rr,{label:i("pages.xray.warp.updatedAt","Updated at"),value:ji(p.updated_at)})]}),s(z,{spacing:3,flexWrap:"wrap",children:[e(Y,{variant:"outline",onClick:Ie,isLoading:I,children:i("pages.xray.warp.fetchInfo","Refresh info")}),e(Y,{variant:"ghost",colorScheme:"red",onClick:T,isLoading:ge,children:i("pages.xray.warp.removeAccount","Remove account")})]})]}):s(le,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:de,children:i("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(Y,{colorScheme:"primary",onClick:Te,isLoading:ee||E,children:i("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&s(R,{borderWidth:"1px",borderColor:ne,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.licenseSection","WARP+/License key")}),s(z,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(ye,{value:y,onChange:G=>C(G.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(Y,{colorScheme:"primary",onClick:U,isLoading:F,isDisabled:!y.trim(),children:i("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:de,mt:2,children:i("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),s(R,{borderWidth:"1px",borderColor:ne,borderRadius:"lg",p:4,children:[s(z,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:i("pages.xray.warp.remoteConfig","Remote configuration")}),f?e(Wr,{colorScheme:f.enabled?"green":"yellow",children:f.enabled?i("core.active","Active"):i("core.pending","Pending")}):e(Wr,{colorScheme:"gray",children:i("core.empty","Empty")})]}),f?s(ke,{spacing:4,children:[s(He,{columns:{base:1,md:2},spacing:4,children:[e(rr,{label:i("core.name","Name"),value:(Ee=f.name)!=null?Ee:"-"}),e(rr,{label:i("core.model","Model"),value:(we=f.model)!=null?we:"-"}),e(rr,{label:i("core.status","Status"),value:f.enabled?i("core.enabled","Enabled"):i("core.disabled","Disabled")}),e(rr,{label:i("core.id","ID"),value:(Oe=f.id)!=null?Oe:"-"})]}),f.account&&s(Lt,{children:[e(Ms,{}),s(He,{columns:{base:1,md:3},spacing:4,children:[e(rr,{label:i("core.type","Type"),value:(X=f.account.account_type)!=null?X:"-"}),e(rr,{label:i("core.role","Role"),value:(xe=f.account.role)!=null?xe:"-"}),e(rr,{label:i("pages.xray.warp.premiumData","WARP+ data"),value:Ea(f.account.premium_data)}),e(rr,{label:i("core.quota","Quota"),value:Ea(f.account.quota)}),e(rr,{label:i("core.usage","Usage"),value:Ea(f.account.usage)})]})]}),s(z,{spacing:3,flexWrap:"wrap",children:[e(Y,{colorScheme:"primary",onClick:M,isDisabled:!w,children:i("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(Y,{variant:"ghost",onClick:()=>_(null),children:i("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:de,children:i("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),s(R,{borderWidth:"1px",borderColor:ne,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.manualTitle","Manual outbound")}),s(ke,{spacing:4,children:[s(k,{isRequired:!0,children:[e(v,{children:i("pages.xray.outbound.tag","Tag")}),e(ye,{size:"sm",value:c.tag,onChange:G=>Q("tag",G.target.value),placeholder:"warp"})]}),s(k,{isRequired:!0,children:[e(v,{children:i("pages.xray.warp.privateKey")}),e(ur,{size:"sm",value:c.privateKey,onChange:G=>Q("privateKey",G.target.value),rows:2})]}),s(k,{isRequired:!0,children:[e(v,{children:i("pages.xray.warp.publicKey")}),e(ur,{size:"sm",value:c.publicKey,onChange:G=>Q("publicKey",G.target.value),rows:2})]}),s(k,{children:[e(Y,{size:"sm",colorScheme:"primary",onClick:ie,children:i("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:de,mt:1,children:i("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),s(k,{isRequired:!0,children:[e(v,{children:i("pages.xray.warp.endpoint")}),e(ye,{size:"sm",value:c.endpoint,onChange:G=>Q("endpoint",G.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),s(k,{children:[e(v,{children:i("pages.xray.warp.addressV4","Client IPv4")}),e(ye,{size:"sm",value:c.addressV4,onChange:G=>Q("addressV4",G.target.value),placeholder:"172.16.0.2"}),e(kr,{children:i("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),s(k,{children:[e(v,{children:i("pages.xray.warp.addressV6","Client IPv6")}),e(ye,{size:"sm",value:c.addressV6,onChange:G=>Q("addressV6",G.target.value),placeholder:"2606:4700:****:****::****"})]}),s(k,{children:[e(v,{children:i("pages.xray.warp.reserved")}),e(ye,{size:"sm",value:c.reserved,onChange:G=>Q("reserved",G.target.value),placeholder:"0,0,0"}),e(kr,{children:i("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(Y,{size:"xs",mt:2,variant:"ghost",onClick:P,children:i("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),s(k,{children:[e(v,{children:i("pages.xray.warp.mtu","MTU")}),e(Yr,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(G,pe)=>Q("mtu",pe||1420),children:e(qr,{})})]}),s(k,{children:[e(v,{children:i("pages.xray.warp.notes","Notes (optional)")}),e(ur,{size:"sm",rows:2,value:c.notes,onChange:G=>Q("notes",G.target.value)})]})]})]})]})}),s(It,{display:"flex",justifyContent:"space-between",children:[Se?e(Y,{colorScheme:"red",variant:"outline",onClick:ce,children:i("delete")}):e("span",{}),s(z,{spacing:3,children:[e(Y,{variant:"ghost",onClick:n,children:i("cancel")}),e(Y,{colorScheme:"primary",onClick:$,children:i(Se?"save":"add")})]})]})]})]})},rn=Z(Xr,{baseStyle:{w:3.5,h:3.5}}),sn=Z(Mr,{baseStyle:{w:4,h:4}}),nn=Z(is,{baseStyle:{w:4,h:4}}),eo=Z(Bo,{baseStyle:{w:4,h:4}}),to=Z(Vo,{baseStyle:{w:4,h:4}}),ro=Z(Or,{baseStyle:{w:4,h:4}}),gp=Z(Ic,{baseStyle:{w:4,h:4}}),fp=Z(Tc,{baseStyle:{w:4,h:4}}),bp=Z(Pc,{baseStyle:{w:4,h:4}}),yp=Z(Ec,{baseStyle:{w:4,h:4}}),Sp=Z(yo,{baseStyle:{w:4,h:4}}),xp=Z(Nc,{baseStyle:{w:4,h:4}}),kp=Z(zc,{baseStyle:{w:4,h:4}}),wp=Z(Rc,{baseStyle:{w:4,h:4}}),vp=Z(Uc,{baseStyle:{w:4,h:4}}),so=Z(Lc,{baseStyle:{w:4,h:4}}),an={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},$n=t=>JSON.stringify(t!=null?t:{}),no=t=>Array.isArray(t)?t.join(","):t!=null?t:"",Cp=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],Na=({title:t,children:n})=>{const r=Qe("gray.50","whiteAlpha.100"),l=Qe("gray.200","whiteAlpha.300");return s(R,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(R,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(R,{overflowX:"auto",children:e(ms,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(Ir,{children:n})})})]})},Dr=({label:t,controlId:n,children:r})=>{const l=Qe("gray.700","whiteAlpha.800");return s(At,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Re,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(v,{htmlFor:n,mb:{base:2,md:0},color:l,children:t})}),e(Re,{py:3,display:{base:"block",md:"table-cell"},children:e(k,{id:n,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(n)})})]})},on=({children:t})=>{const n=Qe("gray.200","whiteAlpha.200"),r=Qe("white","blackAlpha.400"),l=Qe("sm","none");return e(R,{borderWidth:"1px",borderColor:n,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(R,{overflowX:"auto",children:t})})},ln=({children:t,...n})=>{const r=Qe("gray.50","whiteAlpha.100"),l=Qe("gray.200","whiteAlpha.300"),o=Qe("gray.300","whiteAlpha.300"),i=Qe("gray.100","whiteAlpha.200"),a=Qe("gray.50","whiteAlpha.100");return e(ms,{size:"sm",w:"full",...n,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:o,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:i,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:a}},children:t})},_p=()=>{var Xs,Qs,be,Dt;const{t}=Fe(),{fetchCoreSettings:n,updateConfig:r,isLoading:l,config:o,isPostLoading:i,restartCore:a}=Kh(),{onEditingCore:c}=ut(),u=Mt(),{isOpen:p,onOpen:g,onClose:f}=Yt(),{isOpen:_,onOpen:w,onClose:b}=Yt(),{isOpen:y,onOpen:C,onClose:E}=Yt(),{isOpen:O,onOpen:ee,onClose:D}=Yt(),{isOpen:F,onOpen:A,onClose:I}=Yt(),{isOpen:De,onOpen:ge,onClose:te}=Yt(),L=vr({defaultValues:{config:o||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),Q=d.exports.useRef($n(L.getValues("config"))),de=Wt({control:L.control,name:"config"}),ne=d.exports.useMemo(()=>$n(de)!==Q.current,[de]),[ie,P]=d.exports.useState([]),[ue,Te]=d.exports.useState([]),[Ie,U]=d.exports.useState([]),[T,M]=d.exports.useState([]),[ce,$]=d.exports.useState([]),[Se,Ee]=d.exports.useState([]),[we,Oe]=d.exports.useState(null),[X,xe]=d.exports.useState(null),[G,pe]=d.exports.useState(!1),[Ce,Ge]=d.exports.useState("xraySetting"),[ae,re]=d.exports.useState(""),oe=or({base:!0,md:!1}),[K,fe]=d.exports.useState(0),[dt,Ve]=d.exports.useState(""),[q,x]=d.exports.useState(""),N=d.exports.useCallback(m=>m.map((S,W)=>{var Ue,Be;return{key:`${W}-${(Be=(Ue=S.tag)!=null?Ue:S.protocol)!=null?Be:"outbound"}`,...S}}),[]),j=d.exports.useCallback(m=>{P(N(m))},[N]),Ne=d.exports.useCallback(()=>{const m=L.getValues("config.outbounds");return Array.isArray(m)?JSON.parse(JSON.stringify(m)):[]},[L]),Ae=d.exports.useCallback(m=>{L.setValue("config.outbounds",m,{shouldDirty:!0}),j(m),fe(S=>S+1)},[L,j]),je=d.exports.useCallback(m=>m.map((S,W)=>{var Ue,Be,Me,et,Xt,ds,rs,Zs,ri,si,ni,ai,ii,oi,li;return{key:`${W}-${(Be=(Ue=S.outboundTag)!=null?Ue:S.balancerTag)!=null?Be:"rule"}`,source:(Me=S.source)!=null?Me:[],sourcePort:(et=S.sourcePort)!=null?et:[],network:(Xt=S.network)!=null?Xt:[],protocol:(ds=S.protocol)!=null?ds:[],attrs:S.attrs?JSON.stringify(S.attrs,null,2):"",ip:(rs=S.ip)!=null?rs:[],domain:(Zs=S.domain)!=null?Zs:[],port:(ri=S.port)!=null?ri:[],inboundTag:(si=S.inboundTag)!=null?si:[],user:(ni=S.user)!=null?ni:[],outboundTag:(ai=S.outboundTag)!=null?ai:"",balancerTag:(ii=S.balancerTag)!=null?ii:"",type:(oi=S.type)!=null?oi:"field",domainMatcher:(li=S.domainMatcher)!=null?li:""}}),[]),gt=d.exports.useCallback(m=>{Te(je(m))},[je]),Tt=d.exports.useCallback(m=>{L.setValue("config.routing.rules",m,{shouldDirty:!0}),gt(m),fe(S=>S+1)},[L,gt]),Ze=d.exports.useCallback(()=>{const m=L.getValues("config.routing.rules");return Array.isArray(m)?JSON.parse(JSON.stringify(m)):[]},[L]);d.exports.useEffect(()=>{const m=()=>{pe(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",m),()=>{document.removeEventListener("fullscreenchange",m)}},[]),d.exports.useEffect(()=>(c(!0),n().then(()=>{console.log("Core settings fetched successfully")}).catch(m=>{u({title:t("core.errorFetchingConfig"),description:m.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>c(!1)),[n,c,u,t]),d.exports.useEffect(()=>{var m,S,W,Ue;o&&(L.reset({config:o}),Q.current=$n(o),j((o==null?void 0:o.outbounds)||[]),gt(((m=o==null?void 0:o.routing)==null?void 0:m.rules)||[]),U(((W=(S=o==null?void 0:o.routing)==null?void 0:S.balancers)==null?void 0:W.map((Be,Me)=>{var et;return{key:Me,tag:Be.tag||"",strategy:((et=Be.strategy)==null?void 0:et.type)||"random",selector:Be.selector||[],fallbackTag:Be.fallbackTag||""}}))||[]),M(((Ue=o==null?void 0:o.dns)==null?void 0:Ue.servers)||[]),$((o==null?void 0:o.fakedns)||[]),re(o!=null&&o.observatory?"observatory":o!=null&&o.burstObservatory?"burstObservatory":""),fe(Be=>Be+1))},[o,L,j,gt]);const{mutate:ft,isLoading:Ct}=Er(a,{onSuccess:()=>{u({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:m=>{var S,W;u({title:t("core.generalErrorMessage"),description:((W=(S=m.response)==null?void 0:S.data)==null?void 0:W.detail)||m.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Rt=L.handleSubmit(({config:m})=>{r(m).then(()=>{L.reset({config:m}),Q.current=$n(m),u({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(S=>{let W=t("core.generalErrorMessage");typeof S.response._data.detail=="object"&&(W=S.response._data.detail[Object.keys(S.response._data.detail)[0]]),typeof S.response._data.detail=="string"&&(W=S.response._data.detail),u({title:W,status:"error",isClosable:!0,position:"top",duration:3e3})})}),Kt=async()=>{const m=await _e("/panel/xray/getOutboundsTraffic");m!=null&&m.success&&Ee(m.obj)},jt=()=>{xe(null),f()},Gt=()=>{xe(null),g()},er=m=>{xe(m),g()},Ft=m=>{const S=Ne();m<0||m>=S.length||(S.splice(m,1),Ae(S))},B=(m,S)=>{const W=Ne();if(m<0||m>=W.length||S<0||S>=W.length)return;const[Ue]=W.splice(m,1);W.splice(S,0,Ue),Ae(W)},ve=m=>{B(m,m-1)},Ye=m=>{B(m,m+1)},tt=()=>{Oe(null),w()},St=m=>{Oe(m),w()},H=m=>{const S=Ze();S.splice(m,1),Tt(S)},he=(m,S)=>{const W=Ze();if(m<0||m>=W.length||S<0||S>=W.length)return;const[Ue]=W.splice(m,1);W.splice(S,0,Ue),Tt(W)},J=m=>{const S=Ze();we!==null&&we>=0&&we<S.length?S[we]=m:S.push(m),Tt(S),Oe(null)},Xe=()=>{Oe(null),b()},nt=()=>{C()},Ke=m=>{C()},ot=m=>{const S=[...Ie],W=S.splice(m,1)[0];L.setValue("config.routing.balancers",S,{shouldDirty:!0}),U(S);const Ue={...L.getValues("config")};Ue.observatory&&(Ue.observatory.subjectSelector=Ue.observatory.subjectSelector.filter(Be=>Be!==W.tag)),Ue.burstObservatory&&(Ue.burstObservatory.subjectSelector=Ue.burstObservatory.subjectSelector.filter(Be=>Be!==W.tag)),L.setValue("config",Ue,{shouldDirty:!0})},_t=()=>{ee()},Jt=m=>{ee()},bt=m=>{const S=[...T];S.splice(m,1),L.setValue("config.dns.servers",S,{shouldDirty:!0}),M(S)},Ot=()=>{A()},Ut=m=>{A()},xt=m=>{const S=[...ce];S.splice(m,1),L.setValue("config.fakedns",S.length>0?S:null,{shouldDirty:!0}),$(S)},kt=m=>{var S,W,Ue,Be,Me;switch(m.protocol){case"vmess":case"vless":return((S=m.settings.vnext)==null?void 0:S.map(et=>`${et.address}:${et.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((W=m.settings.servers)==null?void 0:W.map(et=>`${et.address}:${et.port}`))||[];case"dns":return[`${(Ue=m.settings)==null?void 0:Ue.address}:${(Be=m.settings)==null?void 0:Be.port}`];case"wireguard":return((Me=m.settings.peers)==null?void 0:Me.map(et=>et.endpoint))||[];default:return[]}},fr=m=>{const S=Se.find(W=>W.tag===m.tag);return S?`${us.sizeFormat(S.up)} / ${us.sizeFormat(S.down)}`:`${us.sizeFormat(0)} / ${us.sizeFormat(0)}`},Et=d.exports.useMemo(()=>Array.isArray(de==null?void 0:de.outbounds)?de.outbounds:[],[de]),nr=d.exports.useMemo(()=>{var m;return Array.isArray((m=de==null?void 0:de.routing)==null?void 0:m.rules)?de.routing.rules:[]},[de]),br=d.exports.useMemo(()=>{var m;return Array.from(new Set(((m=de==null?void 0:de.inbounds)!=null?m:[]).map(S=>S==null?void 0:S.tag).filter(S=>Boolean(S))))},[de]),lr=d.exports.useMemo(()=>Array.from(new Set(Et.map(m=>m==null?void 0:m.tag).filter(m=>Boolean(m)))),[Et]),Cr=d.exports.useMemo(()=>{var m,S;return Array.from(new Set(((S=(m=de==null?void 0:de.routing)==null?void 0:m.balancers)!=null?S:[]).map(W=>W==null?void 0:W.tag).filter(W=>Boolean(W))))},[de]),yr=d.exports.useMemo(()=>Et.length===0?-1:Et.findIndex(m=>(m==null?void 0:m.protocol)==="freedom"),[Et]),jr=d.exports.useMemo(()=>{var S,W;if(yr<0)return"";const m=Et[yr];return(W=(S=m==null?void 0:m.settings)==null?void 0:S.domainStrategy)!=null?W:""},[yr,Et]),xs=m=>{const S=L.getValues("config")||{},W=Array.isArray(S.outbounds)?JSON.parse(JSON.stringify(S.outbounds)):[],Ue=W.findIndex(et=>(et==null?void 0:et.protocol)==="freedom");if(Ue===-1)return;const Be={...W[Ue]},Me={...Be.settings||{}};m?Me.domainStrategy=m:delete Me.domainStrategy,Be.settings=Me,W[Ue]=Be,L.setValue("config.outbounds",W,{shouldDirty:!0}),P(W.map((et,Xt)=>({key:Xt,...et}))),fe(et=>et+1)},ks=d.exports.useMemo(()=>{var m;return(m=Et.find(S=>(S==null?void 0:S.tag)==="warp"))!=null?m:null},[Et]),ls=d.exports.useMemo(()=>Et.findIndex(m=>(m==null?void 0:m.tag)==="warp"),[Et])!==-1,_r=d.exports.useMemo(()=>{const m=nr.find(S=>S.outboundTag==="warp");return Array.isArray(m==null?void 0:m.domain)?m.domain:[]},[nr]),es=m=>{const S=m.map(Me=>Me.trim()).filter((Me,et,Xt)=>Me.length>0&&Xt.indexOf(Me)===et),W=Ze(),Ue=W.findIndex(Me=>Me.outboundTag==="warp");if(S.length===0){Ue!==-1&&(W.splice(Ue,1),Tt(W));return}const Be={type:"field",outboundTag:"warp",domain:S};Ue!==-1?W[Ue]={...W[Ue],...Be}:W.push(Be),Tt(W)},Fr=m=>{const S=m.trim();!S||_r.includes(S)||es([..._r,S])},ts=m=>{es(_r.filter(S=>S!==m))},me=Qe("white","blackAlpha.400"),vs=Qe("gray.200","whiteAlpha.200"),Hr=Qe("gray.600","gray.300"),Cs=m=>{var Be;const S=Ne(),W=(Be=m.tag)!=null?Be:"warp",Ue=S.findIndex(Me=>(Me==null?void 0:Me.tag)===W);Ue>=0?S[Ue]=m:S.push(m),Ae(S)},_s=()=>{const m=Ne(),S=m.findIndex(W=>(W==null?void 0:W.tag)==="warp");S!==-1&&(m.splice(S,1),Ae(m),es([]),Ve(""),x(""))},Ds=m=>{const S=Ne();X!==null&&X>=0&&X<S.length?S[X]=m:S.push(m),Ae(S),xe(null)},ba=()=>{te()},Gs=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{pe(!1)}).catch(m=>{console.error("Error exiting fullscreen:",m)}):document.documentElement.requestFullscreen().then(()=>{pe(!0)}).catch(m=>{console.error("Error entering fullscreen:",m)})},Un=()=>{var S,W,Ue,Be;const m=L.getValues("config")||{};switch(Ce){case"inboundSettings":return JSON.stringify((S=m.inbounds)!=null?S:[],null,2);case"outboundSettings":return JSON.stringify((W=m.outbounds)!=null?W:[],null,2);case"routingRuleSettings":return JSON.stringify((Be=(Ue=m.routing)==null?void 0:Ue.rules)!=null?Be:[],null,2);case"xraySetting":default:return JSON.stringify(m!=null?m:{},null,2)}},Ln=m=>{var S,W,Ue,Be;try{const Me=JSON.parse(m),et={...L.getValues("config")||{}};switch(Ce){case"inboundSettings":et.inbounds=Me;break;case"outboundSettings":et.outbounds=Me,j(Me);break;case"routingRuleSettings":et.routing||(et.routing={}),et.routing.rules=Me,gt(Me);break;case"xraySetting":default:L.setValue("config",Me,{shouldDirty:!0}),j((Me==null?void 0:Me.outbounds)||[]),gt(((S=Me==null?void 0:Me.routing)==null?void 0:S.rules)||[]),U(((Ue=(W=Me==null?void 0:Me.routing)==null?void 0:W.balancers)==null?void 0:Ue.map((Xt,ds)=>{var rs;return{key:ds,tag:Xt.tag||"",strategy:((rs=Xt.strategy)==null?void 0:rs.type)||"random",selector:Xt.selector||[],fallbackTag:Xt.fallbackTag||""}}))||[]),M(((Be=Me==null?void 0:Me.dns)==null?void 0:Be.servers)||[]),$((Me==null?void 0:Me.fakedns)||[]);return}L.setValue("config",et,{shouldDirty:!0})}catch{}},Mn=()=>{var S,W;const m=L.getValues("config")||{};return ae==="observatory"?JSON.stringify((S=m.observatory)!=null?S:{},null,2):ae==="burstObservatory"?JSON.stringify((W=m.burstObservatory)!=null?W:{},null,2):""},On=m=>{try{const S=JSON.parse(m),W={...L.getValues("config")||{}};ae==="observatory"&&(W.observatory=S),ae==="burstObservatory"&&(W.burstObservatory=S),L.setValue("config",W,{shouldDirty:!0})}catch{}},Wn=m=>!m&&m!==0?[]:Array.isArray(m)?m.map(S=>typeof S=="string"?S.trim():String(S)).filter(Boolean):typeof m=="string"?m.split(",").map(S=>S.trim()).filter(Boolean):[String(m)],Tr=(m,S="blue")=>{const W=Wn(m);return W.length?e(Yh,{chips:W,color:S}):e(h,{color:"gray.400",children:"-"})},cs=m=>{if(m==null||m===""||typeof m=="string"&&!m.trim())return e(h,{color:"gray.400",children:"-"});const S=typeof m=="string"?m:String(m);return S.length>30?e(Gh,{text:S,label:t("details")}):e(h,{children:S})},Fn=m=>{if(!m)return e(h,{color:"gray.400",children:"-"});try{const S=JSON.parse(m);if(S&&typeof S=="object"&&!Array.isArray(S)){const W=Object.entries(S);return W.length?e(R,{display:"flex",flexWrap:"wrap",gap:"1",children:W.map(([Ue,Be])=>e(st,{colorScheme:"purple",size:"sm",children:`${Ue}: ${String(Be)}`},Ue))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:m})},Hn=Mn(),Bn=Un();return s(le,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(ke,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:s(ke,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(Y,{size:"sm",colorScheme:"primary",isLoading:i,isDisabled:!ne||i,onClick:Rt,w:{base:"full",sm:"auto"},children:t("core.save")}),e(Y,{size:"sm",leftIcon:e(ro,{}),isLoading:Ct,onClick:()=>ft(),variant:"outline",w:{base:"full",sm:"auto"},children:t(Ct?"core.restarting":"core.restartCore")})]})}),s(Ks,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[s(Js,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(Vt,{children:s(z,{spacing:2,align:"center",children:[e(bp,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(Vt,{children:s(z,{spacing:2,align:"center",children:[e(yp,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(Vt,{children:s(z,{spacing:2,align:"center",children:[e(Sp,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(Vt,{children:s(z,{spacing:2,align:"center",children:[e(xp,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(Vt,{children:s(z,{spacing:2,align:"center",children:[e(kp,{}),e(h,{as:"span",children:t("DNS")})]})}),e(Vt,{children:s(z,{spacing:2,align:"center",children:[e(wp,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(Vt,{children:s(z,{spacing:2,align:"center",children:[e(vp,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),s(qs,{children:[e($t,{children:s(le,{spacing:4,align:"stretch",children:[s(Na,{title:t("pages.xray.generalConfigs"),children:[e(Dr,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:m=>s(qe,{id:m,size:"sm",maxW:"220px",value:jr,onChange:S=>xs(S.target.value),isDisabled:yr===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(S=>e("option",{value:S,children:S},S))]})}),e(Dr,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:m=>e(at,{name:"config.routing.domainStrategy",control:L.control,render:({field:S})=>e(qe,{...S,id:m,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(W=>e("option",{value:W,children:W},W))})})})]}),e(R,{borderWidth:"1px",borderColor:vs,borderRadius:"lg",bg:me,p:{base:3,md:4},children:s(le,{align:"stretch",spacing:3,children:[s(z,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(Y,{variant:"outline",size:"sm",leftIcon:e(so,{}),onClick:ge,children:ls?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:Hr,children:t("pages.xray.warpRoutingDesc")}),s(Qn,{children:[_r.length===0&&e(fn,{children:e(st,{colorScheme:"gray",variant:"subtle",children:e(pi,{children:t("core.empty","Empty")})})}),_r.map(m=>e(fn,{children:s(st,{colorScheme:"primary",borderRadius:"full",children:[e(pi,{children:m}),e(Mc,{"aria-label":t("core.remove"),onClick:()=>ts(m)})]})},m))]}),s(z,{spacing:3,flexWrap:"wrap",children:[e(qe,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:dt,onChange:m=>{const{value:S}=m.target;S&&Fr(S),Ve("")},children:Cp.map(m=>e("option",{value:m.value,children:m.label},m.value))}),s(z,{spacing:2,maxW:"320px",flex:"1",children:[e(ye,{size:"sm",value:q,onChange:m=>x(m.target.value),placeholder:"geosite:google"}),e(Y,{size:"sm",colorScheme:"primary",onClick:()=>{Fr(q),x("")},isDisabled:!q.trim(),children:t("core.add")})]})]})]})}),s(Na,{title:t("pages.xray.statistics"),children:[e(Dr,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:m=>e(at,{name:"config.policy.system.statsInboundUplink",control:L.control,render:({field:S})=>e(ct,{id:m,isChecked:!!S.value,onChange:W=>S.onChange(W.target.checked)})})}),e(Dr,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:m=>e(at,{name:"config.policy.system.statsInboundDownlink",control:L.control,render:({field:S})=>e(ct,{id:m,isChecked:!!S.value,onChange:W=>S.onChange(W.target.checked)})})}),e(Dr,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:m=>e(at,{name:"config.policy.system.statsOutboundUplink",control:L.control,render:({field:S})=>e(ct,{id:m,isChecked:!!S.value,onChange:W=>S.onChange(W.target.checked)})})}),e(Dr,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:m=>e(at,{name:"config.policy.system.statsOutboundDownlink",control:L.control,render:({field:S})=>e(ct,{id:m,isChecked:!!S.value,onChange:W=>S.onChange(W.target.checked)})})})]}),s(Na,{title:t("pages.xray.logConfigs"),children:[e(Dr,{label:t("pages.xray.logLevel"),controlId:"log-level",children:m=>e(at,{name:"config.log.loglevel",control:L.control,render:({field:S})=>e(qe,{...S,id:m,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(W=>e("option",{value:W,children:W},W))})})}),e(Dr,{label:t("pages.xray.accessLog"),controlId:"access-log",children:m=>e(at,{name:"config.log.access",control:L.control,render:({field:S})=>s(qe,{...S,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(W=>e("option",{value:W,children:W},W))]})})}),e(Dr,{label:t("pages.xray.errorLog"),controlId:"error-log",children:m=>e(at,{name:"config.log.error",control:L.control,render:({field:S})=>s(qe,{...S,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(W=>e("option",{value:W,children:W},W))]})})}),e(Dr,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:m=>e(at,{name:"config.log.maskAddress",control:L.control,render:({field:S})=>s(qe,{...S,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(W=>e("option",{value:W,children:W},W))]})})}),e(Dr,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:m=>e(at,{name:"config.log.dnsLog",control:L.control,render:({field:S})=>e(ct,{id:m,isChecked:!!S.value,onChange:W=>S.onChange(W.target.checked)})})})]})]})}),e($t,{children:s(le,{spacing:4,align:"stretch",children:[e(Y,{leftIcon:e(rn,{}),...an,onClick:tt,children:t("pages.xray.rules.add")}),e(on,{children:s(ln,{minW:"1100px",children:[s(zr,{children:[s(At,{children:[e(Le,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(Le,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(Le,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(Le,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(Le,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(Le,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(Le,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(Le,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),s(At,{children:[e(Le,{children:t("IP",{defaultValue:"IP"})}),e(Le,{children:t("port",{defaultValue:"Port"})}),e(Le,{children:t("network",{defaultValue:"Network"})}),e(Le,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(Le,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(Le,{children:t("IP",{defaultValue:"IP"})}),e(Le,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(Le,{children:t("port",{defaultValue:"Port"})}),e(Le,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(Le,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),s(Ir,{children:[ue.length===0&&e(At,{children:e(Re,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),ue.map((m,S)=>s(At,{children:[e(Re,{children:s(le,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:S+1}),s(z,{spacing:1,children:[e(ze,{"aria-label":"move up",icon:e(eo,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>he(S,S-1)}),e(ze,{"aria-label":"move down",icon:e(to,{}),size:"xs",variant:"ghost",isDisabled:S===ue.length-1,onClick:()=>he(S,S+1)})]})]})}),e(Re,{children:Tr(m.source,"blue")}),e(Re,{children:cs(m.sourcePort)}),e(Re,{children:Tr(m.network,"purple")}),e(Re,{children:Tr(m.protocol,"green")}),e(Re,{children:Fn(m.attrs)}),e(Re,{children:Tr(m.ip,"blue")}),e(Re,{children:Tr(m.domain,"blue")}),e(Re,{children:cs(m.port)}),e(Re,{children:Tr(m.inboundTag,"teal")}),e(Re,{children:Tr(m.user,"cyan")}),e(Re,{children:cs(m.outboundTag)}),e(Re,{children:cs(m.balancerTag)}),e(Re,{children:s(z,{spacing:1,children:[e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>St(S)}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>H(S)})]})})]},m.key))]})]})})]})}),e($t,{children:s(le,{spacing:4,align:"stretch",children:[s(z,{children:[e(Y,{leftIcon:e(rn,{}),...an,onClick:Gt,children:t("pages.xray.outbound.addOutbound")}),e(Y,{leftIcon:e(so,{}),size:"xs",variant:"ghost",onClick:ge,children:ls?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(Y,{leftIcon:e(ro,{}),size:"xs",variant:"ghost",onClick:Kt,children:t("refresh")})]}),e(on,{children:s(ln,{minW:"880px",children:[e(zr,{children:s(At,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.outbound.tag")}),e(Le,{children:t("protocol")}),e(Le,{children:t("pages.xray.outbound.address")}),e(Le,{children:t("pages.inbounds.traffic")})]})}),e(Ir,{children:ie.map((m,S)=>{var W,Ue,Be;return s(At,{children:[e(Re,{children:s(z,{children:[e(h,{children:S+1}),e(ze,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(eo,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>ve(S)}),e(ze,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(to,{}),size:"xs",variant:"ghost",isDisabled:S===ie.length-1,onClick:()=>Ye(S)}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>er(S)}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Ft(S)})]})}),e(Re,{children:m.tag}),s(Re,{children:[e(st,{colorScheme:"purple",children:m.protocol}),["vmess","vless","trojan","shadowsocks"].includes(m.protocol)&&s(Lt,{children:[e(st,{colorScheme:"blue",children:(W=m.streamSettings)==null?void 0:W.network}),((Ue=m.streamSettings)==null?void 0:Ue.security)==="tls"&&e(st,{colorScheme:"green",children:"tls"}),((Be=m.streamSettings)==null?void 0:Be.security)==="reality"&&e(st,{colorScheme:"green",children:"reality"})]})]}),e(Re,{children:kt(m).map(Me=>e(h,{children:Me},Me))}),e(Re,{children:e(st,{colorScheme:"green",children:fr(m)})})]},m.key)})})]})})]})}),e($t,{children:s(le,{spacing:4,align:"stretch",children:[e(Y,{leftIcon:e(rn,{}),...an,onClick:nt,children:t("pages.xray.balancer.addBalancer")}),e(on,{children:s(ln,{minW:"680px",children:[e(zr,{children:s(At,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.balancer.tag")}),e(Le,{children:t("pages.xray.balancer.balancerStrategy")}),e(Le,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(Ir,{children:Ie.map((m,S)=>s(At,{children:[e(Re,{children:s(z,{children:[e(h,{children:S+1}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>Ke()}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ot(S)})]})}),e(Re,{children:m.tag}),e(Re,{children:e(st,{colorScheme:m.strategy==="random"?"purple":"green",children:m.strategy==="random"?"Random":m.strategy==="roundRobin"?"Round Robin":m.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Re,{children:m.selector.map(W=>e(st,{colorScheme:"blue",m:1,children:W},W))})]},m.key))})]})}),(((Xs=L.getValues("config"))==null?void 0:Xs.observatory)||((Qs=L.getValues("config"))==null?void 0:Qs.burstObservatory))&&s(le,{spacing:3,align:"stretch",children:[e(ia,{onChange:m=>{re(m),fe(S=>S+1)},value:ae,children:s(z,{spacing:3,children:[((be=L.getValues("config"))==null?void 0:be.observatory)&&e(Nr,{value:"observatory",children:"Observatory"}),((Dt=L.getValues("config"))==null?void 0:Dt.burstObservatory)&&e(Nr,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(R,{h:"300px",children:e($a,{json:Hn,onChange:m=>On(m)},`obs-${ae}-${K}`)})]})]})}),e($t,{children:s(le,{spacing:4,align:"stretch",children:[s(k,{display:"flex",alignItems:"center",children:[e(v,{children:t("pages.xray.dns.enable")}),e(at,{name:"config.dns",control:L.control,render:({field:m})=>e(ct,{isChecked:!!m.value,onChange:S=>{const W={...L.getValues("config")};S.target.checked?W.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete W.dns,delete W.fakedns),L.setValue("config",W,{shouldDirty:!0}),M([]),$([])}})})]}),T.length>0&&s(Lt,{children:[e(Y,{leftIcon:e(rn,{}),...an,onClick:_t,children:t("pages.xray.dns.add")}),e(on,{children:s(ln,{minW:"720px",children:[e(zr,{children:s(At,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.outbound.address")}),e(Le,{children:t("pages.xray.dns.domains")}),e(Le,{children:t("pages.xray.dns.expectIPs")})]})}),e(Ir,{children:T.map((m,S)=>s(At,{children:[e(Re,{children:s(z,{children:[e(h,{children:S+1}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>Jt()}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>bt(S)})]})}),e(Re,{children:typeof m=="object"?m.address:m}),e(Re,{children:typeof m=="object"?no(m.domains):""}),e(Re,{children:typeof m=="object"?no(m.expectIPs):""})]},S))})]})})]}),ce.length>0&&s(Lt,{children:[e(Y,{leftIcon:e(rn,{}),...an,onClick:Ot,children:t("pages.xray.fakedns.add")}),e(on,{children:s(ln,{minW:"520px",children:[e(zr,{children:s(At,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.fakedns.ipPool")}),e(Le,{children:t("pages.xray.fakedns.poolSize")})]})}),e(Ir,{children:ce.map((m,S)=>s(At,{children:[e(Re,{children:s(z,{children:[e(h,{children:S+1}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>Ut()}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>xt(S)})]})}),e(Re,{children:m.ipPool}),e(Re,{children:m.poolSize})]},S))})]})})]})]})}),e($t,{children:s(le,{spacing:4,align:"stretch",children:[s(R,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(R,{px:2,children:e(ia,{onChange:m=>{Ge(m),fe(S=>S+1)},value:Ce,children:s(z,{spacing:3,wrap:"wrap",children:[e(Nr,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Nr,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Nr,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Nr,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),s(R,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(ze,{position:G?"fixed":"absolute",top:2,right:2,"aria-label":G?"Exit Full Screen":"Full Screen",icon:G?e(fp,{}):e(gp,{}),onClick:Gs,zIndex:G?1101:10}),e(R,{w:G?"100vw":"100%",h:G?"100vh":"100%",position:G?"fixed":"relative",top:G?0:"auto",left:G?0:"auto",zIndex:G?1e3:"auto",children:e($a,{json:Bn,onChange:m=>{Ln(m)}},`advanced-${Ce}-${K}`)}),G&&oe&&e(Y,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:Gs,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e($t,{children:e(R,{children:e(ml,{showTitle:!1})})})]})]}),e(jh,{isOpen:p,onClose:jt,mode:X!==null?"edit":"create",initialOutbound:X!==null?Et[X]:null,onSubmitOutbound:Ds}),e(ip,{isOpen:_,mode:we!==null?"edit":"create",initialRule:we!==null&&nr[we]||null,availableInboundTags:br,availableOutboundTags:lr,availableBalancerTags:Cr,onSubmit:J,onClose:Xe}),e(mp,{isOpen:De,onClose:ba,initialOutbound:ks,onSave:Cs,onDelete:_s}),e(op,{isOpen:y,onClose:E,form:L,setBalancersData:U}),e(lp,{isOpen:O,onClose:D,form:L,setDnsServers:M}),e(cp,{isOpen:F,onClose:I,form:L,setFakeDns:$})]})},Dp=({isOpen:t,onClose:n,onSubmit:r,isSaving:l,allHosts:o,allAdmins:i,initialService:a})=>{var P,ue,Te,Ie;const{t:c}=Fe(),[u,p]=d.exports.useState((P=a==null?void 0:a.name)!=null?P:""),[g,f]=d.exports.useState((ue=a==null?void 0:a.description)!=null?ue:""),[_,w]=d.exports.useState((Te=a==null?void 0:a.admin_ids)!=null?Te:[]),[b,y]=d.exports.useState((Ie=a==null?void 0:a.hosts.map(U=>U.id))!=null?Ie:[]),[C,E]=d.exports.useState(""),[O,ee]=d.exports.useState(""),[D,F]=d.exports.useState(null),A=Mt();d.exports.useEffect(()=>{var U,T,M,ce;t&&(p((U=a==null?void 0:a.name)!=null?U:""),f((T=a==null?void 0:a.description)!=null?T:""),w((M=a==null?void 0:a.admin_ids)!=null?M:[]),y((ce=a==null?void 0:a.hosts.map($=>$.id))!=null?ce:[]),E(""),ee(""))},[t,a]);const I=d.exports.useMemo(()=>new Map(o.map(U=>[U.id,U])),[o]),De=d.exports.useMemo(()=>o.filter(U=>!b.includes(U.id)&&!U.isDisabled),[o,b]),ge=d.exports.useMemo(()=>{const U=O.trim().toLowerCase();return U?De.filter(T=>{const M=T.label.toLowerCase(),ce=T.inboundTag.toLowerCase(),$=T.protocol.toLowerCase();return M.includes(U)||ce.includes(U)||$.includes(U)}):De},[De,O]),te=d.exports.useMemo(()=>{const U=C.trim().toLowerCase();return U?i.filter(T=>T.username.toLowerCase().includes(U)):i},[C,i]),L=d.exports.useMemo(()=>new Set(_),[_]),Q=U=>{w(T=>T.includes(U)?T.filter(M=>M!==U):[...T,U])},de=U=>{y(T=>T.includes(U)?T.filter(M=>M!==U):[...T,U])},ne=(U,T)=>{y(M=>{const ce=M.indexOf(U);if(ce===-1)return M;const $=T==="up"?ce-1:ce+1;if($<0||$>=M.length)return M;const Se=[...M];return[Se[ce],Se[$]]=[Se[$],Se[ce]],Se})},ie=async()=>{if(!u.trim()){A({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!b.length){A({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const U=b.map((T,M)=>({host_id:T,sort:M}));await r({name:u.trim(),description:(g==null?void 0:g.trim())||null,admin_ids:_,hosts:U},a==null?void 0:a.id)};return s(Nt,{isOpen:t,onClose:n,size:"5xl",children:[e(ht,{}),s(zt,{children:[e(mt,{children:a?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Pt,{}),e(pt,{children:s(ke,{spacing:6,children:[s(z,{spacing:4,children:[e(sr,{label:c("services.fields.name","Name"),value:u,onChange:U=>p(U.target.value),maxLength:128,isRequired:!0}),e(sr,{label:c("services.fields.description","Description"),value:g!=null?g:"",onChange:U=>f(U.target.value),maxLength:256})]}),s(R,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),s(ke,{spacing:3,children:[e(sr,{value:C,onChange:U=>E(U.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(le,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:i.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):te.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):te.map(U=>{const T=L.has(U.id);return e(R,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:T?"primary.400":"gray.200",bg:T?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:T?"primary.300":"gray.600",bg:T?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>Q(U.id),onKeyDown:M=>{(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),Q(U.id))},role:"button",tabIndex:0,children:s(yt,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:U.username}),T&&e(Wr,{colorScheme:"primary",children:c("services.selected","Selected")})]})},U.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),s(Qa,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(hs,{children:s(Lr,{variant:"outline",h:"full",children:[e(Ls,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(Kr,{children:s(ke,{spacing:3,children:[e(sr,{value:O,onChange:U=>ee(U.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(le,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:De.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):ge.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):ge.map(U=>s(R,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:D===U.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>F(U.id),onMouseLeave:()=>F(null),onClick:()=>de(U.id),children:[e(h,{fontWeight:"medium",children:U.label}),s(h,{fontSize:"sm",color:"gray.500",children:[U.protocol.toUpperCase()," - ",U.inboundTag]})]},U.id))})]})})]})}),e(hs,{children:s(Lr,{variant:"outline",h:"full",children:[e(Ls,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(Kr,{children:s(le,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[b.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),b.map((U,T)=>{const M=I.get(U);return M?e(Oc.div,{layout:!0,children:s(yt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[s(R,{children:[s(z,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:M.label}),M.isDisabled&&e(Wr,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),s(h,{fontSize:"sm",color:"gray.500",children:[M.protocol.toUpperCase()," - ",M.inboundTag]})]}),s(z,{spacing:1,children:[e(it,{label:c("services.moveUp","Move up"),children:e(ze,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(Bo,{width:16}),onClick:()=>ne(U,"up"),isDisabled:T===0})}),e(it,{label:c("services.moveDown","Move down"),children:e(ze,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(Vo,{width:16}),onClick:()=>ne(U,"down"),isDisabled:T===b.length-1})}),e(it,{label:c("services.removeHost","Remove host"),children:e(ze,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(Mr,{width:16}),onClick:()=>de(U)})})]})]})},U):null})]})})]})})]})]})}),e(It,{children:s(z,{justify:"flex-end",w:"full",children:[e(Y,{onClick:n,children:c("cancel")}),e(Y,{colorScheme:"primary",onClick:ie,isLoading:l,children:c(a?"saveChanges":"create")})]})})]})]})},Ap=()=>{var Ge;const{t}=Fe(),n=Mt(),{userData:r,getUserIsSuccess:l}=Ss(),o=l&&r.is_sudo,i=Os(),a=Zr(),c=el(),{inbounds:u,refetchUsers:p}=ut(),g=Yt(),[f,_]=d.exports.useState(null);d.exports.useEffect(()=>{!l||!o||(i.fetchServices(),a.fetchAdmins({limit:500,offset:0}),kn(),c.fetchHosts())},[l,o]);const w=d.exports.useMemo(()=>a.admins.slice().sort((ae,re)=>ae.username.localeCompare(re.username)).map(ae=>({id:ae.id,username:ae.username})),[a.admins]),b=d.exports.useMemo(()=>{var re,oe;const ae=[];for(const[K,fe]of Object.entries(c.hosts)){const dt=(re=Array.from(u.values()).flat().find(q=>q.tag===K))!=null?re:null,Ve=(oe=dt==null?void 0:dt.protocol)!=null?oe:"unknown";fe.forEach(q=>{q.id!=null&&ae.push({id:q.id,label:q.remark,inboundTag:K,protocol:Ve,isDisabled:Boolean(q.is_disabled)})})}return ae},[c.hosts,u]),y=()=>{_(null),g.onOpen()},C=async ae=>{try{const re=await i.fetchServiceDetail(ae);_(re),g.onOpen()}catch{n({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},E=async(ae,re)=>{var oe,K;try{re?(await i.updateService(re,ae),n({status:"success",title:t("services.updated","Service updated")})):(await i.createService(ae),n({status:"success",title:t("services.created","Service created")})),p(),g.onClose()}catch(fe){n({status:"error",title:(K=(oe=fe==null?void 0:fe.data)==null?void 0:oe.detail)!=null?K:t("services.saveFailed","Failed to save service")})}},O=async ae=>{var re,oe;try{const K=await i.fetchServiceDetail(ae);Te(K),Oe()}catch(K){n({status:"error",title:(oe=(re=K==null?void 0:K.data)==null?void 0:re.detail)!=null?oe:t("services.deleteFailed","Unable to delete service")})}},ee=async ae=>{var re,oe;try{await i.resetServiceUsage(ae),n({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(K){n({status:"error",title:(oe=(re=K==null?void 0:K.data)==null?void 0:re.detail)!=null?oe:t("services.resetFailed","Failed to reset usage")})}},[D,F]=d.exports.useState(null),[A,I]=d.exports.useState(!1),{isOpen:De,onOpen:ge,onClose:te}=Yt(),L=d.exports.useRef(null),Q=ae=>{F(ae),ge()},de=async()=>{if(D!=null){I(!0);try{await ee(D)}finally{I(!1),te()}}},ne=D!=null?(Ge=i.services.find(ae=>ae.id===D))==null?void 0:Ge.name:void 0,ie=()=>{Te(null),X()},P=async()=>{var re,oe;if(!ue)return;const ae={mode:ue.user_count?Ie:"delete_users",unlink_admins:T};if(ae.mode==="transfer_users"){if(!ce){n({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}ae.target_service_id=ce}Ee(!0);try{await i.deleteService(ue.id,ae),n({status:"success",title:t("services.deleted","Service removed")}),p(),ie()}catch(K){n({status:"error",title:(oe=(re=K==null?void 0:K.data)==null?void 0:re.detail)!=null?oe:t("services.deleteFailed","Unable to delete service")})}finally{Ee(!1)}},[ue,Te]=d.exports.useState(null),[Ie,U]=d.exports.useState("delete_users"),[T,M]=d.exports.useState(!1),[ce,$]=d.exports.useState(null),[Se,Ee]=d.exports.useState(!1),{isOpen:we,onOpen:Oe,onClose:X}=Yt(),xe=d.exports.useMemo(()=>ue?i.services.filter(ae=>ae.id!==ue.id):i.services,[ue,i.services]);d.exports.useEffect(()=>{ue&&(U("delete_users"),M(ue.admin_ids.length>0),$(null))},[ue]),d.exports.useEffect(()=>{Ie==="delete_users"&&$(null)},[Ie]);const G=ae=>e(Uo,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:re})=>s(Lt,{children:[s(Lo,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[s(R,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:ae.name}),ae.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:re?3:1,mt:1,children:ae.description})]}),s(le,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[s(z,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:ae.host_count})]}),s(z,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:ae.user_count})]})]}),e(Wc,{})]}),e(Mo,{pt:0,pb:4,children:s(ke,{spacing:4,children:[s(He,{columns:2,spacing:3,children:[s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:Je(ae.used_traffic)})]}),s(R,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:Je(ae.lifetime_used_traffic)})]})]}),s(ke,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),s(z,{spacing:2,flexWrap:"wrap",children:[e(it,{label:t("services.view","View"),children:e(ze,{"aria-label":"View",icon:e(bn,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),i.fetchServiceDetail(ae.id)}})}),e(it,{label:t("services.edit","Edit"),children:e(ze,{"aria-label":"Edit",icon:e(Ma,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),C(ae.id)},isDisabled:!o})}),e(it,{label:t("services.resetUsage","Reset usage"),children:e(ze,{"aria-label":"Reset usage",icon:e(Or,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),Q(ae.id)},isDisabled:!o})}),e(it,{label:t("services.delete","Delete"),children:e(ze,{"aria-label":"Delete",icon:e(Mr,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:oe=>{oe.stopPropagation(),O(ae.id)},isDisabled:!o})})]})]})]})})]})},`service-accordion-${ae.id}`),pe=ae=>s(At,{children:[e(Re,{children:s(le,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:ae.name}),ae.description&&e(h,{fontSize:"sm",color:"gray.500",children:ae.description})]})}),e(Re,{children:ae.host_count}),e(Re,{children:ae.user_count}),e(Re,{children:Je(ae.used_traffic)}),e(Re,{children:Je(ae.lifetime_used_traffic)}),e(Re,{children:s(z,{spacing:2,children:[e(it,{label:t("services.view","View"),children:e(ze,{"aria-label":"View",icon:e(bn,{width:18}),size:"sm",variant:"ghost",onClick:()=>i.fetchServiceDetail(ae.id)})}),o&&s(Lt,{children:[e(it,{label:t("services.edit","Edit"),children:e(ze,{"aria-label":"Edit",icon:e(Ma,{width:18}),size:"sm",variant:"ghost",onClick:()=>C(ae.id)})}),e(it,{label:t("services.resetUsage","Reset usage"),children:e(ze,{"aria-label":"Reset usage",icon:e(Or,{width:18}),size:"sm",variant:"ghost",onClick:()=>Q(ae.id)})}),e(it,{label:t("services.delete","Delete"),children:e(ze,{"aria-label":"Delete",icon:e(Mr,{width:18}),size:"sm",variant:"ghost",onClick:()=>O(ae.id)})})]})]})})]},ae.id),Ce=i.serviceDetail;return l?o?s(le,{spacing:4,align:"stretch",children:[s(yt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[s(R,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),o&&e(Y,{leftIcon:e(Xr,{width:18}),colorScheme:"primary",onClick:y,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(Lr,{variant:"outline",children:e(Kr,{children:i.isLoading?e(yt,{justify:"center",py:10,children:e(wt,{})}):s(Lt,{children:[e(Ro,{allowToggle:!0,display:{base:"block",md:"none"},children:i.services.map(G)}),e(R,{display:{base:"none",md:"block"},overflowX:"auto",children:s(ms,{variant:"simple",children:[e(zr,{children:s(At,{children:[e(Le,{children:t("services.columns.name","Name")}),e(Le,{children:t("services.columns.hosts","Hosts")}),e(Le,{children:t("services.columns.users","Users")}),e(Le,{children:t("services.columns.usage","Usage")}),e(Le,{children:t("services.columns.lifetime","Lifetime")}),e(Le,{children:t("services.columns.actions","Actions")})]})}),e(Ir,{children:i.services.map(pe)})]})})]})})}),Ce&&s(Lr,{variant:"outline",children:[e(Ls,{children:s(yt,{justify:"space-between",align:"center",children:[s(R,{children:[e(h,{fontWeight:"semibold",children:Ce.name}),Ce.description&&e(h,{fontSize:"sm",color:"gray.500",children:Ce.description})]}),e(Wr,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:Ce.user_count})})]})}),e(Kr,{children:s(He,{columns:{base:1,md:2},spacing:6,children:[s(R,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(ke,{spacing:2,children:Ce.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):Ce.admins.map(ae=>s(yt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:ae.username}),s(h,{fontSize:"sm",color:"gray.500",children:[Je(ae.used_traffic)," /"," ",Je(ae.lifetime_used_traffic)]})]},ae.id))})]}),s(R,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(ke,{spacing:2,children:Ce.hosts.map(ae=>s(yt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[s(R,{children:[e(h,{fontWeight:"medium",children:ae.remark}),s(h,{fontSize:"sm",color:"gray.500",children:[ae.inbound_protocol.toUpperCase()," - ",ae.inbound_tag]})]}),s(Wr,{colorScheme:"gray",children:["#",ae.sort+1]})]},ae.id))})]})]})})]}),e(Sn,{isOpen:De,leastDestructiveRef:L,onClose:te,isCentered:!0,motionPreset:"slideInBottom",children:e(ht,{children:s(xn,{mx:{base:4,sm:0},children:[e(mt,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(pt,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:ne!=null?ne:t("services.thisService","this service")})}),s(It,{children:[e(Y,{ref:L,onClick:te,children:t("cancel","Cancel")}),e(Y,{colorScheme:"primary",ml:3,onClick:de,isLoading:A,children:t("services.resetUsage","Reset usage")})]})]})})}),s(Nt,{isOpen:we,onClose:ie,size:"lg",children:[e(ht,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(zt,{children:[s(mt,{children:[t("services.deleteDialogTitle","Delete Service"),ue?` \u2013 ${ue.name}`:""]}),e(Pt,{}),e(pt,{children:ue?s(le,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:ue.name})}),ue.admin_ids.length>0?e(mr,{isChecked:T,onChange:ae=>M(ae.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),ue.user_count>0?s(le,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:ue.user_count})}),e(ia,{value:Ie,onChange:ae=>U(ae),children:s(ke,{align:"flex-start",spacing:2,children:[e(Nr,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Nr,{value:"transfer_users",isDisabled:xe.length===0,children:xe.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),Ie==="transfer_users"&&xe.length>0&&s(k,{isRequired:!0,children:[e(v,{children:t("services.selectTargetService","Target service")}),e(qe,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:ce!=null?ce:"",onChange:ae=>$(ae.target.value?Number(ae.target.value):null),children:xe.map(ae=>e("option",{value:ae.id,children:ae.name},ae.id))}),e(kr,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):s(hr,{status:"info",borderRadius:"md",children:[e(pr,{}),e(as,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),s(It,{gap:3,children:[e(Y,{variant:"ghost",onClick:ie,children:t("cancel","Cancel")}),e(Y,{colorScheme:"red",onClick:P,isLoading:Se,isDisabled:Boolean((ue==null?void 0:ue.user_count)&&Ie==="transfer_users"&&xe.length>0&&!ce),children:t("services.delete","Delete")})]})]})]}),e(Dp,{isOpen:g.isOpen,onClose:g.onClose,onSubmit:E,isSaving:i.isSaving,allHosts:b,allAdmins:w,initialService:f!=null?f:void 0})]}):s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(yt,{justify:"center",align:"center",h:"full",py:10,children:e(wt,{})})};We.extend(Pn);const ao=Z(Cn,{baseStyle:{w:4,h:4}}),Ip=Z(ja,{baseStyle:{w:4,h:4}}),Tp={key:"30d",label:"30d",amount:30,unit:"day"},Pp=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,l=We.utc(r);return l.isValid()?n?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},io=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",oo=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Kn=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return We.utc(r).valueOf()},lo=t=>{const n=t.unit==="hour"?"hour":"day",r=We().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},Ep=(t,n)=>{const r=We(t),l=We(n),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Np=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Je(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Je(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},zp=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Je(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Rp=()=>{var Se,Ee,we,Oe;const{t}=Fe(),{colorMode:n}=os(),{admins:r}=Zr(),l="auto-end",o=(Se=or({base:"bottom",md:"auto-end"}))!=null?Se:l,[i,a]=d.exports.useState([]),[c,u]=d.exports.useState([]),[p,g]=d.exports.useState(null),[f,_]=d.exports.useState([]),[w,b]=d.exports.useState(!1),y=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),C=(Ee=y.find(X=>X.key==="30d"))!=null?Ee:Tp,[E,O]=d.exports.useState(()=>lo(C)),[ee,D]=d.exports.useState(C.key),[F,A]=d.exports.useState(null),[I,De]=d.exports.useState([]),[ge,te]=d.exports.useState(!1),[L,Q]=d.exports.useState(!1),[de,ne]=d.exports.useState([E.start,E.end]);d.exports.useMemo(()=>{var X;return(X=c.find(xe=>xe.id===p))!=null?X:null},[c,p]);const ie=d.exports.useMemo(()=>{if(!p)return i;const X=new Set(f.map(G=>G.username).filter(G=>Boolean(G))),xe=i.filter(G=>X.has(G.username));return xe.length?xe:i},[i,p,f]),P=d.exports.useMemo(()=>f.reduce((X,xe)=>X+(xe.used_traffic||0),0),[f]),ue=d.exports.useMemo(()=>f.map(X=>X.used_traffic||0),[f]),Te=d.exports.useMemo(()=>f.map(X=>X.username||t("services.unassignedAdmin","Unassigned")),[f,t]),Ie=d.exports.useMemo(()=>zp(n,Te),[n,Te]);d.exports.useEffect(()=>{L||ne([E.start,E.end])},[L,E.start,E.end]),d.exports.useEffect(()=>{let X=!1;return(async()=>{var G;try{const pe=await _e("/v2/services",{query:{limit:500}});if(X||!pe)return;const Ce=(G=pe.services)!=null?G:[];u(Ce),g(Ge=>Ge!==null?Ge:Ce.length?Ce[0].id:null)}catch{X||u([])}})(),()=>{X=!0}},[]),d.exports.useEffect(()=>{if(!p){_([]);return}let X=!1;return b(!0),_e(`/v2/services/${p}/usage/admins`,{query:{start:io(E.start),end:oo(E.end)}}).then(xe=>{var G;X||!xe||_((G=xe.admins)!=null?G:[])}).catch(()=>{X||_([])}).finally(()=>{X||b(!1)}),()=>{X=!0}},[p,E.start,E.end,E.unit]),d.exports.useEffect(()=>{let X=!1;return(async()=>{try{const G=await _e("/admins");if(X)return;Array.isArray(G)?a(G):a(G.admins||[])}catch(G){console.error("Failed to load all admins:",G),a(r||[])}})(),()=>{X=!0}},[r]),d.exports.useEffect(()=>{if(!F)return;let X=!1;te(!0);const xe=E.unit==="hour",G={start:io(E.start),end:oo(E.end)};xe&&(G.granularity="hour");const pe=xe?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:F,endpoint:pe,query:G}),_e(`/admin/${encodeURIComponent(F)}/usage/${pe}`,{query:G}).then(Ce=>{if(X)return;const Ge=Array.isArray(Ce==null?void 0:Ce.usages)?Ce.usages:[];console.debug("AdminsUsage: response usages",{length:Ge.length,endpoint:pe});let ae;if(xe){const re=new Map;Ge.forEach(K=>{var Ve,q;const fe=typeof(K==null?void 0:K.date)=="string"?K.date:"";if(!fe)return;const dt=(Ve=re.get(fe))!=null?Ve:0;re.set(fe,dt+Number((q=K==null?void 0:K.used_traffic)!=null?q:0))});const oe=Array.from(re.entries());oe.sort((K,fe)=>{const[dt]=K,[Ve]=fe;return Kn(dt)-Kn(Ve)}),ae=oe.map(([K,fe])=>({date:K,used_traffic:fe}))}else{const re=Ge.map(oe=>{var K,fe;return{date:(K=oe==null?void 0:oe.date)!=null?K:"",used_traffic:Number((fe=oe==null?void 0:oe.used_traffic)!=null?fe:0)}});re.sort((oe,K)=>Kn(oe.date)-Kn(K.date)),ae=re}De(ae)}).catch(Ce=>{X||(console.error("Error fetching admin usage:",Ce),De([]))}).finally(()=>{X||te(!1)}),()=>{X=!0}},[F,E]),d.exports.useEffect(()=>{if(!ie||ie.length===0)return;ie.some(xe=>xe.username===F)||A(ie[0].username)},[ie,F]),d.exports.useEffect(()=>{const X=y.find(xe=>xe.key===E.key);D(X?X.key:"custom")},[E,y]);const U=d.exports.useMemo(()=>I.map(X=>Pp(X.date)),[I]),T=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:I.map(X=>X.used_traffic)}],[I,t]),M=d.exports.useMemo(()=>({options:Np(n,U),series:T}),[n,U,T]),ce=d.exports.useMemo(()=>I.reduce((X,xe)=>X+Number(xe.used_traffic||0),0),[I]),$=d.exports.useMemo(()=>{const X=We(E.start).format("YYYY-MM-DD"),xe=We(E.end).format("YYYY-MM-DD");return X===xe?X:`${X} - ${xe}`},[E.start,E.end]);return s(le,{spacing:4,align:"stretch",children:[s(R,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(ke,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[s(le,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),s(ke,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(qe,{value:p!=null?p:"",onChange:X=>{const xe=Number(X.target.value);g(Number.isNaN(xe)?null:xe)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(X=>e("option",{value:X.id,children:X.name},X.id))}),s(z,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(ao,{}),s(h,{children:[t("services.totalUsage","Total"),":"," ",e(Z.span,{fontWeight:"medium",children:Je(P,2)})]})]})]})]}),s(ke,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(R,{flex:"1",children:w?s(le,{spacing:3,py:8,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):f.length&&P>0?e(Ur,{type:"donut",height:320,options:Ie,series:ue}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(le,{flex:"1",align:"stretch",spacing:2,children:f.length?f.map(X=>{var Ce;const xe=X.username||t("services.unassignedAdmin","Unassigned"),G=Boolean(X.username),pe=F===X.username&&G;return e(Y,{size:"sm",variant:pe?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{G&&X.username&&A(X.username)},isDisabled:!G,children:s(z,{justify:"space-between",w:"full",children:[e(h,{children:xe}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:Je(X.used_traffic||0,2)})]})},`${(Ce=X.admin_id)!=null?Ce:"na"}-${xe}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),s(R,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[s(z,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(it,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(ao,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(Z.span,{fontWeight:"medium",children:F!=null?F:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(Z.span,{fontWeight:"medium",children:Je(ce||0,2)})]})]}),s(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ke,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:y.map(X=>e(Y,{size:"sm",onClick:()=>{D(X.key),O(lo(X))},variant:ee===X.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:X.label},X.key))}),s(ke,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[s(_n,{placement:o,isOpen:L,onClose:()=>{Q(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Dn,{children:e(Y,{size:"sm",variant:"outline",leftIcon:e(Ip,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(L){Q(!1);return}ne([E.start,E.end]),Q(!0)},children:$})}),s(An,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(In,{}),s(Tn,{px:3,py:3,children:[e(R,{overflowX:"auto",maxW:"full",children:e(zn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(we=de[0])!=null?we:void 0,endDate:(Oe=de[1])!=null?Oe:void 0,calendarClassName:"usage-range-datepicker",onChange:X=>{const[xe,G]=X!=null?X:[null,null];if(ne([xe,G]),xe&&G){const pe=Ep(xe,G);D("custom"),O(pe),Q(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(qe,{value:F!=null?F:"",onChange:X=>A(X.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!ie.length,children:ie.map(X=>e("option",{value:X.username,children:X.username},X.username))})]})]})]}),e(R,{mt:6,children:ge?s(le,{spacing:3,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):M.series&&M.series.length?e(Ur,{options:M.options,series:M.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};We.extend(Pn);const Up=Z(ja,{baseStyle:{w:4,h:4}}),za=Z(Cn,{baseStyle:{w:4,h:4}}),Ra=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],co=t=>{const n=t.unit==="hour"?"hour":"day",r=We().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},Lp=(t,n)=>{const r=We(t),l=We(n),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},uo=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),ho=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),po=(t,n)=>{if(!t)return t;const r=We.utc(t);return r.isValid()?n==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},mo=(t,n,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Je(Number(o)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Je(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Mp=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Je(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Op=({services:t,selectedServiceId:n})=>{var oe,K,fe,dt,Ve,q;const{t:r}=Fe(),{colorMode:l}=os(),o="auto-end",i=(oe=or({base:"bottom",md:"auto-end"}))!=null?oe:o,a=d.exports.useMemo(()=>t.map(x=>({id:x.id,name:x.name})),[t]),c=d.exports.useMemo(()=>n||(a.length?a[0].id:null),[n,a]),u=(K=Ra.find(x=>x.key==="30d"))!=null?K:Ra[0],[p,g]=d.exports.useState(c),[f,_]=d.exports.useState(()=>co(u)),[w,b]=d.exports.useState(u.key),[y,C]=d.exports.useState([null,null]),[E,O]=d.exports.useState(!1),[ee,D]=d.exports.useState([]),[F,A]=d.exports.useState("day"),[I,De]=d.exports.useState([]),[ge,te]=d.exports.useState(!1),[L,Q]=d.exports.useState(!1),[de,ne]=d.exports.useState(null),[ie,P]=d.exports.useState([]),[ue,Te]=d.exports.useState("day"),[Ie,U]=d.exports.useState(""),[T,M]=d.exports.useState(!1);d.exports.useEffect(()=>{g(c)},[c]),d.exports.useEffect(()=>{if(!p){D([]),De([]),P([]),ne(null),U("");return}const x={start:uo(f.start),end:ho(f.end)},N=f.unit==="hour"?"hour":"day";let j=!1;return te(!0),_e(`/v2/services/${p}/usage/timeseries`,{query:{...x,granularity:N}}).then(Ne=>{var Ae,je;j||!Ne||(D((Ae=Ne.points)!=null?Ae:[]),A((je=Ne.granularity)!=null?je:N))}).catch(()=>{j||(D([]),A(N))}).finally(()=>{j||te(!1)}),Q(!0),_e(`/v2/services/${p}/usage/admins`,{query:x}).then(Ne=>{var Ae;j||!Ne||De((Ae=Ne.admins)!=null?Ae:[])}).catch(()=>{j||De([])}).finally(()=>{j||Q(!1)}),()=>{j=!0}},[p,f.start,f.end,f.unit]),d.exports.useEffect(()=>{if(!p){ne(null),P([]),U("");return}if(!I.length){ne(null);return}ne(x=>{var Ae,je;const N=I.map(gt=>gt.admin_id);if(x===null){if(N.includes(null))return x}else if(N.includes(x))return x;const j=I.find(gt=>(gt.used_traffic||0)>0);if(j)return(Ae=j.admin_id)!=null?Ae:null;const Ne=I[0];return(je=Ne==null?void 0:Ne.admin_id)!=null?je:null})},[I,p]),d.exports.useEffect(()=>{if(!p){P([]),U(""),Te("day");return}if(de===void 0)return;if(!I.length&&de===null){P([]),U("");return}const x=f.unit==="hour"?"hour":"day",N=de===null?"null":Number.isFinite(de)?String(de):"null";let j=!1;return M(!0),_e(`/v2/services/${p}/usage/admin-timeseries`,{query:{start:uo(f.start),end:ho(f.end),granularity:x,admin_id:N}}).then(Ne=>{var Ae,je,gt;j||!Ne||(P((Ae=Ne.points)!=null?Ae:[]),Te((je=Ne.granularity)!=null?je:x),U((gt=Ne.username)!=null?gt:""))}).catch(()=>{j||(P([]),U(""),Te(x))}).finally(()=>{j||M(!1)}),()=>{j=!0}},[I,f.end,f.start,f.unit,de,p]);const ce=d.exports.useMemo(()=>{const x=We(f.start).format("YYYY-MM-DD"),N=We(f.end).format("YYYY-MM-DD");return`${x} \u2013 ${N}`},[f.start,f.end]),$=d.exports.useMemo(()=>ee.map(x=>po(x.timestamp,F)),[ee,F]),Se=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ee.map(x=>x.used_traffic)}],[ee,r]),Ee=d.exports.useMemo(()=>mo(l,$,r("services.usageYAxis","Usage")),[$,l,r]),we=d.exports.useMemo(()=>I.map(x=>({value:x.admin_id===null?"null":String(x.admin_id),label:x.username||r("services.unassignedAdmin","Unassigned")})),[I,r]),Oe=d.exports.useMemo(()=>{var N,j;const x=de===null?"null":String(de);return(j=(N=we.find(Ne=>Ne.value===x))==null?void 0:N.label)!=null?j:de===null?r("services.unassignedAdmin","Unassigned"):""},[we,de,r]),X=d.exports.useMemo(()=>ie.map(x=>po(x.timestamp,ue)),[ie,ue]),xe=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ie.map(x=>x.used_traffic)}],[ie,r]),G=d.exports.useMemo(()=>mo(l,X,r("services.usageYAxis","Usage")),[X,l,r]),pe=d.exports.useMemo(()=>ie.reduce((x,N)=>x+(N.used_traffic||0),0),[ie]),Ce=d.exports.useMemo(()=>I.map(x=>x.used_traffic),[I]),Ge=d.exports.useMemo(()=>I.map(x=>x.username||r("services.unassignedAdmin","Unassigned")),[I,r]),ae=d.exports.useMemo(()=>Mp(l,Ge),[l,Ge]),re=d.exports.useMemo(()=>I.reduce((x,N)=>x+(N.used_traffic||0),0),[I]);return a.length===0?s(le,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(R,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):s(le,{spacing:4,align:"stretch",children:[s(z,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),s(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(qe,{value:p!=null?p:"",onChange:x=>g(Number(x.target.value)||null),minW:{md:"220px"},children:a.map(x=>e("option",{value:x.id,children:x.name},x.id))}),e(ke,{direction:{base:"column",sm:"row"},spacing:2,children:Ra.map(x=>e(Y,{size:"sm",variant:w===x.key?"solid":"outline",colorScheme:"primary",onClick:()=>{b(x.key),_(co(x))},children:x.label},x.key))}),s(_n,{placement:i,isOpen:E,onClose:()=>O(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Dn,{children:e(Y,{size:"sm",variant:"outline",leftIcon:e(Up,{}),onClick:()=>{C([f.start,f.end]),O(x=>!x)},children:ce})}),s(An,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(In,{}),s(Tn,{px:3,py:3,children:[e(R,{overflowX:"auto",maxW:"full",children:e(zn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(fe=y[0])!=null?fe:void 0,endDate:(dt=y[1])!=null?dt:void 0,calendarClassName:"usage-range-datepicker",onChange:x=>{const[N,j]=x!=null?x:[null,null];if(C([N,j]),N&&j){const Ne=Lp(N,j);b("custom"),_(Ne),O(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),s(R,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(z,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),s(z,{fontSize:"sm",color:"gray.500",children:[e(za,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(Z.span,{fontWeight:"medium",children:Je(ee.reduce((x,N)=>x+(N.used_traffic||0),0),2)})]})]})]}),e(R,{mt:4,children:ge?s(le,{spacing:3,py:10,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):ee.length?e(Ur,{type:"area",height:360,options:Ee,series:Se}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(R,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(it,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:s(z,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(za,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(Z.span,{fontWeight:"medium",children:Oe||Ie||"-"})," ",r("services.totalUsage","Total"),":"," ",e(Z.span,{fontWeight:"medium",children:Je(pe||0,2)})]})]}),e(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(qe,{size:"sm",minW:{md:"200px"},value:de===null?"null":String(de),onChange:x=>{const N=x.target.value;if(N==="null"){ne(null);return}const j=Number(N);ne(Number.isNaN(j)?null:j)},isDisabled:we.length===0,children:we.map(x=>e("option",{value:x.value,children:x.label},x.value))})})]}),e(R,{mt:4,children:T?s(le,{spacing:3,py:10,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(q=(Ve=xe[0])==null?void 0:Ve.data)!=null&&q.length?e(Ur,{type:"area",height:360,options:G,series:xe}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(R,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(z,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),s(z,{fontSize:"sm",color:"gray.500",children:[e(za,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(Z.span,{fontWeight:"medium",children:Je(re,2)})]})]})]}),s(ke,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(R,{flex:"1",children:L?s(le,{spacing:3,py:8,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):I.length&&re>0?e(Ur,{type:"donut",height:320,options:ae,series:Ce}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(le,{flex:"1",align:"stretch",spacing:2,children:I.length?I.map(x=>{var N;return s(z,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:x.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:Je(x.used_traffic||0,2)})]},`${(N=x.admin_id)!=null?N:"na"}-${x.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};We.extend(Pn);const Wp=Z(ja,{baseStyle:{w:4,h:4}}),Jn=Z(Cn,{baseStyle:{w:4,h:4}}),cn={key:"30d",label:"30d",amount:30,unit:"day"},go=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,l=We.utc(r);return l.isValid()?n?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},dn=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss"),un=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss"),ss=t=>{const n=t.unit==="hour"?"hour":"day",r=We().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},qn=(t,n)=>{const r=We(t),l=We(n),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},fo=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Je(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Je(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Yn=({presets:t,range:n,onPresetChange:r,onCustomChange:l})=>{var b,y,C;const{t:o}=Fe(),i="auto-end",a=(b=or({base:"bottom",md:"auto-end"}))!=null?b:i,c=We(n.start).format("YYYY-MM-DD"),u=We(n.end).format("YYYY-MM-DD"),p=c===u?c:`${c} - ${u}`,[g,f]=d.exports.useState(!1),[_,w]=d.exports.useState([n.start,n.end]);return d.exports.useEffect(()=>{g||w([n.start,n.end])},[g,n.start,n.end]),s(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ke,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(E=>e(Y,{size:"sm",onClick:()=>r(E.key),colorScheme:"primary",variant:n.key===E.key?"solid":"outline",w:{base:"full",sm:"auto"},children:E.label},E.key))}),s(_n,{placement:a,isOpen:g,onClose:()=>{f(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Dn,{children:e(Y,{size:"sm",variant:"outline",leftIcon:e(Wp,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(g){f(!1);return}w([n.start,n.end]),f(!0)},children:p})}),s(An,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(In,{}),s(Tn,{px:3,py:3,children:[e(R,{overflowX:"auto",maxW:"full",children:e(zn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(y=_[0])!=null?y:void 0,endDate:(C=_[1])!=null?C:void 0,calendarClassName:"usage-range-datepicker",onChange:E=>{const[O,ee]=E!=null?E:[null,null];w([O,ee]),O&&ee&&(l(O,ee),f(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},Fp=()=>{var Gt,er,Ft,B,ve,Ye,tt,St;const{t}=Fe(),n=Mt(),{colorMode:r}=os(),{data:l}=ti(),{fetchNodesUsage:o}=Rn(),{userData:i}=Ss(),a=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(er=(Gt=a.find(H=>H.key==="30d"))!=null?Gt:a[0])!=null?er:cn,[u,p]=d.exports.useState(()=>ss(c)),[g,f]=d.exports.useState([]),[_,w]=d.exports.useState(!1),[b,y]=d.exports.useState(()=>ss(c)),[C,E]=d.exports.useState(null),[O,ee]=d.exports.useState(!1),[D,F]=d.exports.useState([]),[A,I]=d.exports.useState(null),[De,ge]=d.exports.useState(()=>ss(c)),[te,L]=d.exports.useState(()=>ss(c)),[Q,de]=d.exports.useState([]),[ne,ie]=d.exports.useState(null),[P,ue]=d.exports.useState(null),[Te,Ie]=d.exports.useState([]),[U,T]=d.exports.useState([]),[M,ce]=d.exports.useState(!1),[$,Se]=d.exports.useState(null),[Ee,we]=d.exports.useState(!1),[Oe,X]=d.exports.useState([]),[xe,G]=d.exports.useState(null),pe=d.exports.useCallback(H=>H?(Array.isArray(H)?H:Object.values(H)).map(J=>{var Xe,nt,Ke,ot;return{nodeId:Number((Xe=J==null?void 0:J.node_id)!=null?Xe:0),nodeName:(nt=J==null?void 0:J.node_name)!=null?nt:t("nodes.unknownNode","Unknown"),total:Number((Ke=J==null?void 0:J.uplink)!=null?Ke:0)+Number((ot=J==null?void 0:J.downlink)!=null?ot:0)}}):[],[t]),Ce=d.exports.useCallback(H=>{var J;const he=(J=a.find(Xe=>Xe.key===H))!=null?J:cn;p(ss(he))},[a]),Ge=d.exports.useCallback((H,he)=>{const J=qn(H,he);p(J)},[]),ae=d.exports.useCallback(H=>{var J;const he=(J=a.find(Xe=>Xe.key===H))!=null?J:cn;y(ss(he))},[a]),re=d.exports.useCallback((H,he)=>{const J=qn(H,he);y(J)},[]),oe=d.exports.useCallback(H=>{var J;const he=(J=a.find(Xe=>Xe.key===H))!=null?J:cn;L(ss(he))},[a]),K=d.exports.useCallback((H,he)=>{const J=qn(H,he);L(J)},[]),fe=d.exports.useCallback(H=>{var J;const he=(J=a.find(Xe=>Xe.key===H))!=null?J:cn;ge(ss(he))},[a]),dt=d.exports.useCallback((H,he)=>{const J=qn(H,he);ge(J)},[]),Ve=d.exports.useMemo(()=>g.reduce((H,he)=>H+he.total,0),[g]),q=d.exports.useMemo(()=>{const H=g.map(J=>J.total),he=g.map(J=>J.nodeName);return la(r,`${t("userDialog.total")} ${Je(Ve||0,2)}`,H,he)},[r,g,t,Ve]),x=d.exports.useMemo(()=>D.map(H=>go(H.date)),[D]),N=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:D.map(H=>H.used_traffic)}],[D,t]),j=d.exports.useMemo(()=>D.reduce((H,he)=>H+he.used_traffic,0),[D]),Ne=d.exports.useMemo(()=>({options:fo(r,x),series:N}),[r,x,N]),Ae=d.exports.useMemo(()=>U.reduce((H,he)=>H+he.total,0),[U]),je=d.exports.useMemo(()=>{const H=U.map(J=>J.total),he=U.map(J=>J.nodeName);return la(r,`${t("userDialog.total")} ${Je(Ae||0,2)}`,H,he)},[U,r,t,Ae]),gt=d.exports.useMemo(()=>Oe.map(H=>go(H.date)),[Oe]),Tt=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:Oe.map(H=>H.used_traffic)}],[Oe,t]),Ze=d.exports.useMemo(()=>Oe.reduce((H,he)=>H+he.used_traffic,0),[Oe]),ft=d.exports.useMemo(()=>({options:fo(r,gt),series:Tt}),[r,gt,Tt]),Ct=d.exports.useMemo(()=>{const H=[],he=new Set;return g.forEach(J=>{J.nodeId>0&&!he.has(J.nodeId)&&(he.add(J.nodeId),H.push({value:J.nodeId,label:J.nodeName}))}),Array.isArray(l)&&l.forEach(J=>{(J==null?void 0:J.id)&&!he.has(J.id)&&(he.add(J.id),H.push({value:J.id,label:J.name}))}),H.sort((J,Xe)=>J.label.localeCompare(Xe.label))},[g,l]),Rt=d.exports.useMemo(()=>{const H=[],he=new Set;return Te.forEach(J=>{he.has(J.nodeId)||(he.add(J.nodeId),H.push({value:J.nodeId,label:J.nodeName}))}),he.has(0)||H.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(J=>{(J==null?void 0:J.id)&&!he.has(J.id)&&(he.add(J.id),H.push({value:J.id,label:J.name}))}),H.sort((J,Xe)=>J.label.localeCompare(Xe.label))},[Te,l,t]),Kt=d.exports.useMemo(()=>Q.map(H=>({value:H,label:H})),[Q]),jt=d.exports.useMemo(()=>{const H=new Map;return Array.isArray(l)&&l.forEach(he=>{(he==null?void 0:he.id)!=null&&H.set(he.id,he.name)}),H},[l]);return d.exports.useEffect(()=>{let H=!1;return w(!0),o({start:dn(u.start),end:un(u.end)}).then(he=>{if(H)return;const J=pe(he==null?void 0:he.usages);f(J)}).catch(he=>{H||(console.error("Error fetching usage data:",he),f([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||w(!1)}),()=>{H=!0}},[o,u,pe,n,t]),d.exports.useEffect(()=>{!(i!=null&&i.username)||(ie(H=>H!=null?H:i.username),ue(H=>H!=null?H:i.username),i.is_sudo||de([i.username]))},[i]),d.exports.useEffect(()=>{if(!(i!=null&&i.is_sudo))return;let H=!1;return _e("/admins").then(he=>{if(H)return;const Xe=(Array.isArray(he)?he:Array.isArray(he==null?void 0:he.admins)?he.admins:[]).map(Ke=>Ke==null?void 0:Ke.username).filter(Ke=>typeof Ke=="string"),nt=Array.from(new Set(Xe)).sort((Ke,ot)=>Ke.localeCompare(ot));if(!nt.length&&(i==null?void 0:i.username)){de([i.username]);return}de(nt),ie(Ke=>{var ot,_t;return Ke&&nt.includes(Ke)?Ke:(_t=(ot=nt[0])!=null?ot:Ke)!=null?_t:null}),ue(Ke=>{var ot,_t;return Ke&&nt.includes(Ke)?Ke:(_t=(ot=nt[0])!=null?ot:Ke)!=null?_t:null})}).catch(he=>{console.error("Error fetching admins:",he)}),()=>{H=!0}},[i==null?void 0:i.is_sudo,i==null?void 0:i.username]),d.exports.useEffect(()=>{var he,J;if(C!==null)return;const H=(he=g.filter(Xe=>Xe.nodeId>0).sort((Xe,nt)=>nt.total-Xe.total)[0])==null?void 0:he.nodeId;if(H&&H>0){E(H);return}if(Array.isArray(l)&&l.length){const Xe=(J=l[0])==null?void 0:J.id;Xe&&E(Xe)}},[C,g,l]),d.exports.useEffect(()=>{Se(null)},[ne]),d.exports.useEffect(()=>{if(!ne){Ie([]),Se(null);return}let H=!1;const he={start:dn(te.start),end:un(te.end)};return _e(`/admin/${encodeURIComponent(ne)}/usage/nodes`,{query:he}).then(J=>{if(H)return;const Xe=pe(J==null?void 0:J.usages);Ie(Xe),Se(nt=>{var ot,_t,Jt;if(nt!==null)return nt;const Ke=(ot=Xe.filter(bt=>bt.nodeId!==0).sort((bt,Ot)=>Ot.total-bt.total)[0])==null?void 0:ot.nodeId;return typeof Ke=="number"?Ke:(Jt=(_t=Xe[0])==null?void 0:_t.nodeId)!=null?Jt:0})}).catch(J=>{H||(console.error("Error fetching daily admin nodes:",J),Ie([]),Se(null),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{H=!0}},[ne,te,pe,n,t]),d.exports.useEffect(()=>{if(!P){T([]),ce(!1);return}let H=!1;return ce(!0),_e(`/admin/${encodeURIComponent(P)}/usage/nodes`,{query:{start:dn(De.start),end:un(De.end)}}).then(he=>{if(H)return;const J=pe(he==null?void 0:he.usages);T(J)}).catch(he=>{H||(console.error("Error fetching admin totals nodes:",he),T([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||ce(!1)}),()=>{H=!0}},[P,De,pe,n,t]),d.exports.useEffect(()=>{if(C===null){F([]),I(null);return}let H=!1;ee(!0);const he={start:dn(b.start),end:un(b.end)};return b.unit==="hour"&&(he.granularity="hour"),_e(`/node/${C}/usage/daily`,{query:he}).then(J=>{var ot,_t,Jt;if(H)return;const nt=(Array.isArray(J==null?void 0:J.usages)?J.usages:[]).map(bt=>{var Ot,Ut;return{date:(Ot=bt==null?void 0:bt.date)!=null?Ot:"",used_traffic:Number((Ut=bt==null?void 0:bt.used_traffic)!=null?Ut:0)}});F(nt);const Ke=(_t=(ot=J==null?void 0:J.node_name)!=null?ot:jt.get(C))!=null?_t:t("nodes.unknownNode","Unknown");I({nodeName:Ke,nodeId:(Jt=J==null?void 0:J.node_id)!=null?Jt:C})}).catch(J=>{H||(console.error("Error fetching node daily usage:",J),F([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||ee(!1)}),()=>{H=!0}},[C,b,jt,n,t]),d.exports.useEffect(()=>{if(!ne){X([]),G(null);return}if($===null){X([]),G(null);return}let H=!1;we(!0);const he={start:dn(te.start),end:un(te.end)};return $!=null&&(he.node_id=$),te.unit==="hour"&&(he.granularity="hour"),_e(`/admin/${encodeURIComponent(ne)}/usage/chart`,{query:he}).then(J=>{var Ke,ot,_t,Jt;if(H)return;const nt=(Array.isArray(J==null?void 0:J.usages)?J.usages:[]).map(bt=>{var Ot,Ut;return{date:(Ot=bt==null?void 0:bt.date)!=null?Ot:"",used_traffic:Number((Ut=bt==null?void 0:bt.used_traffic)!=null?Ut:0)}});X(nt),G({nodeName:(_t=(ot=J==null?void 0:J.node_name)!=null?ot:(Ke=Rt.find(bt=>bt.value===$))==null?void 0:Ke.label)!=null?_t:null,nodeId:(Jt=J==null?void 0:J.node_id)!=null?Jt:$})}).catch(J=>{H||(console.error("Error fetching admin usage chart:",J),X([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||we(!1)}),()=>{H=!0}},[ne,$,te,Rt,t,n]),s(le,{spacing:6,align:"stretch",children:[s(R,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(it,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:s(z,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:Je(Ve||0,2)})]})]}),e(Yn,{presets:a,range:u,onPresetChange:Ce,onCustomChange:Ge})]}),e(R,{mt:6,children:_?s(le,{spacing:3,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):q.series.length?e(Ur,{options:q.options,series:q.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(R,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(it,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:s(z,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(Z.span,{fontWeight:"medium",children:(Ft=A==null?void 0:A.nodeName)!=null?Ft:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:Je(j||0,2)})]})]}),s(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(qe,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:C!=null?C:"",onChange:H=>{const he=H.target.value;if(!he){E(null);return}const J=Number(he);E(Number.isFinite(J)&&J>0?J:null)},placeholder:t("nodes.selectNode","Select node"),children:Ct.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(Yn,{presets:a,range:b,onPresetChange:ae,onCustomChange:re})]})]}),e(R,{mt:6,children:O?s(le,{spacing:3,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(ve=(B=N[0])==null?void 0:B.data)!=null&&ve.length?e(Ur,{options:Ne.options,series:Ne.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(R,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(it,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:s(z,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(Z.span,{fontWeight:"medium",children:ne!=null?ne:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(Z.span,{fontWeight:"medium",children:(Ye=xe==null?void 0:xe.nodeName)!=null?Ye:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:Je(Ze||0,2)})]})]}),s(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(qe,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:ne!=null?ne:"",onChange:H=>ie(H.target.value||null),isDisabled:Kt.length===0,children:Kt.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(qe,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:$!=null?$:"",onChange:H=>{const he=H.target.value;if(he===""){Se(null);return}const J=Number(he);Se(Number.isNaN(J)?null:J)},placeholder:t("nodes.selectNode","Select node"),children:Rt.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(Yn,{presets:a,range:te,onPresetChange:oe,onCustomChange:K})]})]}),e(R,{mt:6,children:Ee?s(le,{spacing:3,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(St=(tt=Tt[0])==null?void 0:tt.data)!=null&&St.length?e(Ur,{options:ft.options,series:ft.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(R,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(ke,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(it,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:s(z,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(Z.span,{fontWeight:"medium",children:P!=null?P:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:Je(Ae||0,2)})]})]}),s(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(qe,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:P!=null?P:"",onChange:H=>ue(H.target.value||null),isDisabled:Kt.length===0,children:Kt.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(Yn,{presets:a,range:De,onPresetChange:fe,onCustomChange:dt})]})]}),e(R,{mt:6,children:M?s(le,{spacing:3,children:[e(wt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):je.series.length?e(Ur,{options:je.options,series:je.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},Hp=()=>{const{t}=Fe(),{userData:n,getUserIsSuccess:r}=Ss(),l=r&&n.is_sudo,o=Os(a=>a.services),i=Os(a=>a.fetchServices);return d.exports.useEffect(()=>{l&&i({limit:500})},[i,l]),r?l?s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),s(Ks,{variant:"enclosed",colorScheme:"primary",children:[s(Js,{children:[e(Vt,{children:t("usage.tabs.services","Services")}),e(Vt,{children:t("usage.tabs.admins","Admins")}),e(Vt,{children:t("usage.tabs.nodes","Nodes")})]}),s(qs,{children:[e($t,{px:0,children:e(Op,{services:o})}),e($t,{px:0,children:e(Rp,{})}),e($t,{px:0,children:e(Fp,{})})]})]})]}):s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(yt,{justify:"center",align:"center",py:10,children:e(wt,{})})},Bp=async()=>_e("/settings/telegram"),Vp=async t=>_e("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),fl="__dot__",Ja=t=>t.replace(/\./g,fl),Rs=t=>t.replace(new RegExp(fl,"g"),"."),$p=t=>{const n={},r=(l,o)=>{if(o!==void 0){if(typeof o=="boolean"){n[Rs(l)]=o;return}if(typeof o=="string"){if(o==="")return;o==="true"||o==="false"?n[Rs(l)]=o==="true":n[Rs(l)]=Boolean(o);return}if(typeof o=="number"){n[Rs(l)]=o!==0;return}if(Array.isArray(o)){n[Rs(l)]=o.length>0;return}if(o&&typeof o=="object"){Object.entries(o).forEach(([i,a])=>{const c=l?`${l}.${i}`:i;r(c,a)});return}n[Rs(l)]=Boolean(o)}};return Object.entries(t).forEach(([l,o])=>{r(l,o)}),n},bl=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],Kp=bl.flatMap(t=>t.events.map(n=>n.key)),Jp=Z(Or,{baseStyle:{w:4,h:4}}),qp=Z(Fc,{baseStyle:{w:4,h:4}}),Ua=t=>{var l,o,i;const n={};Object.entries(t.forum_topics||{}).forEach(([a,c])=>{var u;n[a]={title:(u=c.title)!=null?u:"",topic_id:c.topic_id!=null?String(c.topic_id):""}});const r={};return Kp.forEach(a=>{var p;const c=Ja(a),u=(p=t.event_toggles)==null?void 0:p[a];r[c]=u===void 0?!0:Boolean(u)}),Object.entries(t.event_toggles||{}).forEach(([a,c])=>{const u=Ja(a);u in r||(r[u]=Boolean(c))}),{api_token:(l=t.api_token)!=null?l:"",proxy_url:(o=t.proxy_url)!=null?o:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(i=t.default_vless_flow)!=null?i:"",forum_topics:n,event_toggles:r}},Yp=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(n=>n.length>0).map(n=>Number(n)).filter(n=>Number.isFinite(n)),Gp=()=>{const{t}=Fe(),n=Mt(),r=Za(),{data:l,isLoading:o,refetch:i}=Gr("telegram-settings",Bp,{refetchOnWindowFocus:!1}),{register:a,control:c,handleSubmit:u,reset:p,watch:g,formState:{isDirty:f}}=vr({defaultValues:Ua(l!=null?l:{api_token:null,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{l&&p(Ua(l))},[l,p]);const _=Er(Vp,{onSuccess:y=>{p(Ua(y)),r.setQueryData("telegram-settings",y),n({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{n({title:t("errors.generic","Something went wrong"),status:"error"})}}),w=y=>{const C=$p(y.event_toggles||{}),E={api_token:y.api_token.trim()||null,proxy_url:y.proxy_url.trim()||null,admin_chat_ids:Yp(y.admin_chat_ids),logs_chat_id:y.logs_chat_id.trim()?Number(y.logs_chat_id.trim()):null,logs_chat_is_forum:y.logs_chat_is_forum,default_vless_flow:y.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(y.forum_topics||{}).map(([O,ee])=>[O,{title:ee.title,topic_id:ee.topic_id.trim()?Number(ee.topic_id.trim()):void 0}])),event_toggles:C};_.mutate(E)},b=g("forum_topics");return s(R,{px:{base:4,md:8},py:{base:6,md:8},children:[e(ya,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),s(Ks,{colorScheme:"primary",children:[s(Js,{children:[e(Vt,{children:t("settings.telegram","Telegram")}),e(Vt,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),s(qs,{children:[e($t,{px:{base:0,md:2},children:o&&!l?e(yt,{align:"center",justify:"center",py:12,children:e(wt,{size:"lg"})}):e("form",{onSubmit:u(w),children:s(le,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),s(He,{columns:{base:1,md:2},spacing:6,children:[s(k,{children:[e(v,{children:t("settings.telegram.apiToken","Bot API Token")}),e(ye,{placeholder:"123456:ABC",...a("api_token")})]}),s(k,{children:[e(v,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(ye,{placeholder:"socks5://user:pass@host:port",...a("proxy_url")})]}),s(k,{children:[e(v,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(ye,{placeholder:"12345, 67890",...a("admin_chat_ids")}),e(kr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),s(k,{children:[e(v,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(ye,{placeholder:"-100123456789",...a("logs_chat_id")}),e(kr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),s(k,{display:"flex",alignItems:"center",children:[e(v,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(at,{control:c,name:"logs_chat_is_forum",render:({field:y})=>e(ct,{id:"logs_chat_is_forum",isChecked:y.value,onChange:y.onChange})})]}),s(k,{children:[e(v,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(ye,{placeholder:"xtls-rprx-vision",...a("default_vless_flow")})]})]}),s(R,{children:[e(ya,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),b&&Object.keys(b).length>0?e(ke,{spacing:4,children:Object.entries(b).map(([y])=>s(R,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",y]}),s(He,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(v,{children:t("settings.telegram.topicTitle","Topic Title")}),e(ye,{...a(`forum_topics.${y}.title`)})]}),s(k,{children:[e(v,{children:t("settings.telegram.topicId","Topic ID")}),e(ye,{type:"number",...a(`forum_topics.${y}.topic_id`)}),e(kr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},y))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]}),s(R,{children:[e(ya,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(ke,{spacing:4,children:bl.map(y=>s(R,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(y.titleKey,y.defaultTitle)}),e(He,{columns:{base:1,md:2},spacing:4,children:y.events.map(C=>s(k,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[s(R,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(C.labelKey,C.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(C.hintKey,C.defaultHint)})]}),e(at,{control:c,name:`event_toggles.${Ja(C.key)}`,render:({field:E})=>e(ct,{isChecked:Boolean(E.value),onChange:O=>E.onChange(O.target.checked)})})]},C.key))})]},y.key))})]}),s(yt,{gap:3,justify:"flex-end",children:[e(Y,{variant:"outline",leftIcon:e(Jp,{}),onClick:()=>i(),isDisabled:_.isLoading,children:t("actions.refresh","Refresh")}),e(Y,{colorScheme:"primary",leftIcon:e(qp,{}),type:"submit",isLoading:_.isLoading,isDisabled:!f&&!_.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e($t,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},Xp=async()=>{try{const t=oa();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const n=await _e("/admin",{headers:{Authorization:`Bearer ${t}`}});if(n&&typeof n=="object"&&"error"in n)throw new Error(`API error: ${n.error||"Unknown error"}`);return n}catch(t){throw console.error("Loader error:",t),t}},Qp=Hc([{path:"/",element:e(Od,{}),errorElement:e(ki,{}),loader:Xp,children:[{index:!0,element:e(Kd,{})},{path:"users",element:e(Lu,{})},{path:"admins",element:e(Hu,{})},{path:"usage",element:e(Hp,{})},{path:"services",element:e(Ap,{})},{path:"hosts",element:e(Dh,{})},{path:"node-settings",element:e($h,{})},{path:"integrations",element:e(Gp,{})},{path:"xray-settings",element:e(_p,{})},{path:"xray-logs",element:e(ml,{})}]},{path:"/login/",element:e(ki,{})}]);function Zp(){return e(Bc,{router:Qp})}We.extend(Vc);We.extend($c);We.extend(Pn);We.extend(Kc);We.extend(Jc);jn(qc.get()||"light");Yc.createRoot(document.getElementById("root")).render(e(La.StrictMode,{children:e(Gc,{theme:Qc,children:e(Xc,{client:Zn,children:e(Zp,{})})})}));
