var yl=Object.defineProperty;var Sl=(t,n,r)=>n in t?yl(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var V=(t,n,r)=>(Sl(t,typeof n!="symbol"?n+"":n,r),r);import{i as Gn,B as xl,a as kl,b as wl,j as bo,d as We,U as qa,z as vl,r as Cl,f as _l,Q as Dl,e as Al,m as wt,$ as Il,c as Z,X as Ya,R as Ma,N as fs,I as be,g as bs,h as s,F as w,k as e,l as C,n as hr,o as Tl,p as Ga,q as Rt,s as Pl,t as El,u as Nl,v as zl,w as xr,x as Or,L as Rl,C as ua,y as He,A as Qe,M as ra,D as sa,E as Ne,G as na,H as jt,J as O,K as Ul,T as h,S as Ll,P as Ml,O as Oa,V as Vr,W as aa,Y as yo,Z as So,_ as Ol,a0 as Ut,a1 as cs,a2 as Yt,a3 as d,a4 as di,a5 as L,a6 as ia,a7 as It,a8 as pt,a9 as Tt,aa as gt,ab as Dt,ac as mt,ad as le,ae as Ve,af as xe,ag as Cr,ah as G,ai as _t,aj as fr,ak as Ie,al as Wl,am as yn,an as Xa,ao as Fl,ap as Qa,aq as _r,ar as Br,as as Zr,at as br,au as yr,av as os,aw as ha,ax as es,ay as Hl,az as xo,aA as Bl,aB as Vl,aC as $l,aD as Kl,aE as pa,aF as ko,aG as wo,aH as Fs,aI as ui,aJ as Jl,aK as ql,aL as vo,aM as ur,aN as St,aO as Yl,aP as Gl,aQ as Co,aR as _o,aS as Ks,aT as Xl,aU as Ql,aV as ma,aW as xt,aX as Do,aY as $r,aZ as ts,a_ as Zl,a$ as Za,b0 as ms,b1 as Ao,b2 as jl,b3 as ec,b4 as Ye,b5 as Io,b6 as tc,b7 as rc,b8 as To,b9 as sc,ba as Po,bb as nc,bc as ac,bd as ic,be as Eo,bf as oc,bg as lc,bh as cc,bi as gn,bj as hi,bk as Js,bl as qs,bm as Bt,bn as Ys,bo as Vt,bp as dc,bq as uc,br as ls,bs as hc,bt as Ot,bu as pc,bv as st,bw as at,bx as ot,by as No,bz as Hr,bA as Kr,bB as zo,bC as Ro,bD as Uo,bE as ys,bF as Wr,bG as Ct,bH as Le,bI as Nr,bJ as ze,bK as Lo,bL as Mo,bM as Oo,bN as pi,bO as Xr,bP as mc,bQ as gc,bR as fc,bS as bc,bT as yc,bU as Sc,bV as Sn,bW as xn,bX as Cn,bY as Wo,bZ as nt,b_ as xc,b$ as Ls,c0 as Sr,c1 as _n,c2 as Dn,c3 as kc,c4 as An,c5 as In,c6 as Fo,c7 as Tn,c8 as fn,c9 as Xn,ca as wc,cb as Ho,cc as ja,cd as Lr,ce as Bo,cf as oa,cg as Mr,ch as Pn,ci as Ms,cj as vc,ck as Cc,cl as _c,cm as Dc,cn as Qn,co as bn,cp as Vo,cq as $o,cr as Ac,cs as Ic,ct as Tc,cu as Pc,cv as Ec,cw as Nc,cx as zc,cy as Rc,cz as Uc,cA as mi,cB as Lc,cC as Mc,cD as Oc,cE as ei,cF as Wc,cG as ya,cH as Fc,cI as Hc,cJ as Bc,cK as Vc,cL as $c,cM as Kc,cN as Jc,cO as qc,cP as Yc,cQ as Gc}from"./vendor.c7d21a43.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();Gn.use(xl).use(kl).use(wl).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:bo(["/","statics/locales/{{lng}}.json"])}},function(t,n){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",Gn.language),We.locale(Gn.language)});Gn.on("languageChanged",t=>{console.log("Language changed to:",t),We.locale(t)});qa("zh-cn",vl);qa("ru",Cl);qa("fa",_l);const Zn=new Dl,jn=(t,n)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:n||"#f6f8ff"},o=n||l[t]||l.default;r==null||r.setAttribute("content",o)},Xc=Al({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:wt("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:wt("surface.light","surface.dark")(t),borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:wt("lg","dark-lg")(t)},item:{_hover:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:wt("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:wt("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:wt("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:wt("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const la=()=>localStorage.getItem("token"),Qc=t=>{localStorage.setItem("token",t)},Zc=()=>{localStorage.removeItem("token")},jc=Il.create({baseURL:"https://bot.mazholl.com:8585/api"}),ed=(t,n={})=>(la()&&(n.headers={...(n==null?void 0:n.headers)||{},Authorization:`Bearer ${la()}`}),jc(t,n)),Ce=ed,td=Z(Ya,{baseStyle:{w:4,h:4}}),$t=Ma.forwardRef(({disabled:t,step:n,label:r,className:l,startAdornment:o,endAdornment:i,type:a="text",placeholder:c,onChange:u,onBlur:p,name:g,value:f,onClick:A,error:v,clearable:b=!1,...y},_)=>{const z=()=>{u&&u({target:{value:"",name:g}})},{size:U="md"}=y,re=a=="number"?fs:be,D=a=="number"?bs:Ma.Fragment,B=a=="number"?{keepWithinRange:!0,precision:5,format:I=>isNaN(parseFloat(String(I)))||Number(parseFloat(String(I)).toFixed(5))===0?I:Number(parseFloat(String(I)).toFixed(5)),min:0,step:n,name:g,type:a,placeholder:c,value:f!=null?f:"",onBlur:p,onClick:A,disabled:t,flexGrow:1,size:U,onChange:(I,P)=>{!u||u({target:{value:I,valueAsNumber:P,name:g}})}}:{};return s(w,{isInvalid:!!v,children:[r&&e(C,{children:r}),s(hr,{size:U,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[o&&e(Tl,{children:o}),s(D,{...B,children:[e(re,{name:g,ref:_,step:n,className:Ga(l),type:a,placeholder:c,onChange:a==="number"?void 0:u,onBlur:p,value:a==="number"?void 0:f,onClick:A,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...y,roundedLeft:o?"0":"md",roundedRight:i?"0":"md"}),a=="number"&&e(Rt,{children:s(Pl,{children:[e(El,{}),e(Nl,{})]})})]}),i&&e(zl,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),b&&f&&f.length&&e(xr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:z,cursor:"pointer",children:e(td,{})})]}),!!v&&e(Or,{children:v})]})}),rd="/statics/logo.e8dba2f4.svg",sd=Z(Rl,{baseStyle:{w:4,h:4}}),nd=Z(ua,{baseStyle:{w:4,h:4}}),Ko=({actions:t})=>{const{i18n:n}=He(),r=Qe("surface.light","surface.dark"),l=Qe("blackAlpha.50","whiteAlpha.100"),o=Qe("blackAlpha.200","whiteAlpha.200"),i=Qe("gray.800","gray.100"),a=u=>{n.changeLanguage(u)};return s(ra,{placement:"bottom-end",children:[e(sa,{as:Ne,size:"sm",variant:"outline",icon:e(sd,{}),position:"relative"}),e(na,{minW:"160px",zIndex:9999,bg:r,borderColor:o,color:i,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:p,flag:g})=>e(jt,{fontSize:"sm",onClick:()=>a(u),_hover:{bg:l},children:s(O,{justify:"space-between",w:"full",children:[s(O,{spacing:2,children:[e(Ul,{countryCode:g,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:p})]}),n.language===u&&e(nd,{})]})},u))})]})},gi="rb-theme",fi="rb-custom-themes",ad=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],bi=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],yi=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],cr={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},dr={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Sa=.14,xa=.22,Si=Z(ua,{baseStyle:{w:4,h:4}}),id=Z(Ll,{baseStyle:{w:4,h:4}}),od=Z(Ml,{baseStyle:{w:4,h:4}}),ld=Z(Oa,{baseStyle:{w:4,h:4}}),cd=Z(Vr,{baseStyle:{w:4,h:4}}),xi=Z(aa,{baseStyle:{w:4,h:4}}),dd=Z(yo,{baseStyle:{w:4,h:4}}),ud=Z(So,{baseStyle:{w:4,h:4}}),hd=Z(Ol,{baseStyle:{w:4,h:4}}),Jo=(t,n=0,r=1)=>Math.min(r,Math.max(n,t)),Wa=t=>{const n=t.replace("#",""),r=parseInt(n,16);if(n.length===3){const l=r>>8&15,o=r>>4&15,i=r&15;return{r:l<<4|l,g:o<<4|o,b:i<<4|i}}return{r:r>>16&255,g:r>>8&255,b:r&255}},qo=(t,n,r)=>{const l=o=>o.toString(16).padStart(2,"0");return`#${l(t)}${l(n)}${l(r)}`},pd=(t,n,r)=>{t/=255,n/=255,r/=255;const l=Math.max(t,n,r),o=Math.min(t,n,r);let i=0,a=0;const c=(l+o)/2;if(l!==o){const u=l-o;switch(a=c>.5?u/(2-l-o):u/(l+o),l){case t:i=(n-r)/u+(n<r?6:0);break;case n:i=(r-t)/u+2;break;default:i=(t-n)/u+4}i/=6}return{h:i,s:a,l:c}},md=(t,n,r)=>{let l,o,i;if(n===0)l=o=i=r;else{const a=(p,g,f)=>(f<0&&(f+=1),f>1&&(f-=1),f<.16666666666666666?p+(g-p)*6*f:f<.5?g:f<.6666666666666666?p+(g-p)*(.6666666666666666-f)*6:p),c=r<.5?r*(1+n):r+n-r*n,u=2*r-c;l=a(u,c,t+1/3),o=a(u,c,t),i=a(u,c,t-1/3)}return{r:Math.round(l*255),g:Math.round(o*255),b:Math.round(i*255)}},ka=t=>{try{const{r:n,g:r,b:l}=Wa(t),{h:o,s:i,l:a}=pd(n,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[p,g])=>{const{r:f,g:A,b:v}=md(o,i,Jo(a+g));return u[`--primary-${p}`]=qo(f,A,v),u},{})}catch{return{}}},gd=(t,n,r)=>{const l=Jo(r,0,1),o=Wa(t),i=Wa(n),a=(c,u)=>Math.round(c*(1-l)+u*l);return qo(a(o.r,i.r),a(o.g,i.g),a(o.b,i.b))},Is=(t,n,r,l)=>{try{return gd(t,n,r)}catch{return l}},fd=()=>{const t=document.documentElement;ad.forEach(n=>t.style.removeProperty(n)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},bd=(t,n)=>{const r=document.documentElement;Object.entries(t).forEach(([l,o])=>r.style.setProperty(l,o)),r.style.setProperty("--bg-light",n.bgLight),r.style.setProperty("--bg-dark",n.bgDark),r.style.setProperty("--surface-light",n.surfaceLight),r.style.setProperty("--surface-dark",n.surfaceDark)},wa=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},ki=()=>({name:"",light:{...cr},dark:{...dr}}),Ft=(t,n)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:n,Yo=({minimal:t=!1})=>{const{t:n}=He(),r=Ut(),{colorMode:l,toggleColorMode:o}=cs(),i=Yt(),a=Yt(),c=Qe("surface.light","surface.dark"),u=Qe("blackAlpha.50","whiteAlpha.100"),p=Qe("blackAlpha.200","whiteAlpha.200"),g=Qe("gray.800","gray.100"),f=Qe("gray.600","gray.300"),A=Qe("blackAlpha.400","blackAlpha.700"),v=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:f}}),[f]),[b,y]=d.exports.useState(()=>{try{return localStorage.getItem(gi)||"default"}catch{return"default"}}),[_,z]=d.exports.useState(()=>{try{const E=localStorage.getItem(fi);if(!E)return[];const F=JSON.parse(E);return Array.isArray(F)?F.map(ce=>{var ge,ke,Xe,ie,ne,oe;const de=Ft(((ge=ce.light)==null?void 0:ge.primary)||cr.primary,cr.primary),De=Ft(((ke=ce.light)==null?void 0:ke.bg)||cr.bg,cr.bg),Ee=Is(De,de,Sa,cr.surface),Y=Ft(((Xe=ce.light)==null?void 0:Xe.surface)||Ee,Ee),we=Ft(((ie=ce.dark)==null?void 0:ie.primary)||dr.primary,dr.primary),J=Ft(((ne=ce.dark)==null?void 0:ne.bg)||dr.bg,dr.bg),Se=Is(J,we,xa,dr.surface),X=Ft(((oe=ce.dark)==null?void 0:oe.surface)||Se,Se);return{id:ce.id||wa(),name:ce.name||"Custom",light:{primary:de,bg:De,surface:Y},dark:{primary:we,bg:J,surface:X}}}):[]}catch{return[]}}),[U,re]=d.exports.useState(ki),[D,B]=d.exports.useState(null),[I,P]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(fi,JSON.stringify(_))}catch{}},[_]),d.exports.useEffect(()=>{try{localStorage.setItem(gi,b)}catch{}},[b]),d.exports.useEffect(()=>{b.startsWith("custom:")&&(_.some(F=>`custom:${F.id}`===b)||y("default"))},[b,_]),d.exports.useEffect(()=>{const E=document.documentElement;Array.from(E.classList).filter(ce=>ce.startsWith("rb-theme-")).forEach(ce=>E.classList.remove(ce)),fd();const F=bi.find(ce=>ce.key===b);if(F){F.className&&E.classList.add(F.className),jn(F.key);return}if(b.startsWith("custom:")){const ce=_.find(Ee=>`custom:${Ee.id}`===b);if(!ce)return;const de=l==="dark"?ce.dark:ce.light,De=ka(de.primary);bd(De,{bgLight:ce.light.bg,bgDark:ce.dark.bg,surfaceLight:ce.light.surface,surfaceDark:ce.dark.surface}),jn("custom",l==="dark"?ce.dark.bg:ce.light.bg)}else jn("default")},[b,_,l]);const _e=d.exports.useCallback(E=>{E.colorModeTarget&&l!==E.colorModeTarget&&o(),y(E.key)},[l,o]),me=E=>{y(`custom:${E}`)},se=E=>{B(null),re(E?{name:n(`theme.presets.${E.key}.name`),light:{...E.light},dark:{...E.dark}}:ki()),i.onOpen()},W=E=>{B(E.id),re({name:E.name,light:{...E.light},dark:{...E.dark}}),i.onOpen()},Q=()=>{const E=U.name.trim()||n("theme.untitled"),F=Ft(U.light.primary,cr.primary),ce=Ft(U.light.bg,cr.bg),de=Is(ce,F,Sa,cr.surface),De=Ft(U.light.surface,de),Ee=Ft(U.dark.primary,dr.primary),Y=Ft(U.dark.bg,dr.bg),we=Is(Y,Ee,xa,dr.surface),J=Ft(U.dark.surface,we),Se={id:D||wa(),name:E,light:{primary:F,bg:ce,surface:De},dark:{primary:Ee,bg:Y,surface:J}};z(X=>D?X.map(ge=>ge.id===D?Se:ge):[...X,Se]),y(`custom:${Se.id}`),i.onClose(),B(null),r({status:"success",title:n("theme.customSaved")})},ue=E=>{z(F=>F.filter(ce=>ce.id!==E)),b===`custom:${E}`&&y("default"),r({status:"info",title:n("theme.customDeleted")})},te=()=>{y("default"),r({status:"info",title:n("theme.resetSuccess")})},j=async()=>{if(!_.length){r({status:"warning",title:n("theme.exportEmpty")});return}const E=_.map(({id:ce,...de})=>de),F=JSON.stringify(E,null,2);try{await navigator.clipboard.writeText(F),r({status:"success",title:n("theme.exportSuccess")})}catch{try{const ce=new Blob([F],{type:"application/json"}),de=URL.createObjectURL(ce),De=document.createElement("a");De.href=de,De.download="rebecca-themes.json",De.click(),URL.revokeObjectURL(de),r({status:"success",title:n("theme.exportSuccessDownload")})}catch{r({status:"error",title:n("theme.exportError")})}}},N=()=>{try{const E=JSON.parse(I),ce=(Array.isArray(E)?E:[E]).map(de=>{var ke,Xe,ie,ne,oe,K;const De=Ft(((ke=de==null?void 0:de.light)==null?void 0:ke.primary)||cr.primary,cr.primary),Ee=Ft(((Xe=de==null?void 0:de.light)==null?void 0:Xe.bg)||cr.bg,cr.bg),Y=Is(Ee,De,Sa,cr.surface),we=Ft(((ie=de==null?void 0:de.light)==null?void 0:ie.surface)||Y,Y),J=Ft(((ne=de==null?void 0:de.dark)==null?void 0:ne.primary)||dr.primary,dr.primary),Se=Ft(((oe=de==null?void 0:de.dark)==null?void 0:oe.bg)||dr.bg,dr.bg),X=Is(Se,J,xa,dr.surface),ge=Ft(((K=de==null?void 0:de.dark)==null?void 0:K.surface)||X,X);return{id:wa(),name:(de==null?void 0:de.name)||"Custom",light:{primary:De,bg:Ee,surface:we},dark:{primary:J,bg:Se,surface:ge}}}).filter(de=>de.name);if(!ce.length){r({status:"warning",title:n("theme.importError")});return}z(de=>[...de,...ce]),a.onClose(),P(""),r({status:"success",title:n("theme.importSuccess")})}catch{r({status:"error",title:n("theme.importError")})}},he=d.exports.useCallback((E,F)=>{E.preventDefault(),E.stopPropagation(),F()},[]),Ae=d.exports.useMemo(()=>ka(U.light.primary),[U.light.primary]),ve=d.exports.useMemo(()=>ka(U.dark.primary),[U.dark.primary]),M=E=>{const F=U[E],ce=E==="dark"?ve:Ae,de=ce["--primary-500"]||F.primary,De=ce["--primary-300"]||ce["--primary-400"]||de,Ee=E==="dark"?"whiteAlpha.900":"gray.800",Y=E==="dark"?"whiteAlpha.700":"gray.600",we=E==="dark"?"whiteAlpha.200":"blackAlpha.200",J=E==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(L,{borderWidth:"1px",borderRadius:"md",bg:F.bg,p:4,borderColor:we,children:s(xe,{spacing:3,children:[e(h,{fontWeight:"semibold",color:Ee,children:n(E==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(L,{borderRadius:"lg",bg:F.surface,p:4,borderWidth:"1px",borderColor:we,children:s(xe,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:Ee,children:n("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:Y,children:n("theme.previewSampleBody")}),e(G,{size:"sm",bg:de,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:n("theme.previewSampleAction")}),s(O,{spacing:2,pt:2,children:[e(L,{flex:"1",h:"2",borderRadius:"full",bg:De,opacity:.8}),e(L,{flex:"1",h:"2",borderRadius:"full",bg:de,opacity:.9})]})]})}),s(O,{spacing:1,pt:1,flexWrap:"wrap",children:[e(L,{w:6,h:6,borderRadius:"sm",bg:F.bg,borderWidth:"1px",borderColor:J}),e(L,{w:6,h:6,borderRadius:"sm",bg:F.surface,borderWidth:"1px",borderColor:J}),Object.entries(ce).map(([Se,X])=>e(L,{w:6,h:6,borderRadius:"sm",bg:X,borderWidth:"1px",borderColor:J,title:Se},Se))]})]})})};return s(Rt,{children:[s(ra,{placement:"bottom-end",children:[e(sa,{as:Ne,size:"sm",variant:"outline",icon:e(id,{}),position:"relative"}),s(na,{minW:"260px",zIndex:9999,bg:c,color:g,borderColor:p,children:[e(di,{title:n("theme.builtIn"),sx:v,children:bi.map(E=>{const F=b===E.key;return e(jt,{onClick:()=>_e(E),_hover:{bg:u},children:s(O,{justify:"space-between",w:"full",children:[s(O,{children:[e(L,{w:"4",h:"3",bg:E.accent,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:n(`theme.${E.key}`)})]}),F&&e(Si,{})]})},E.key)})}),!t&&s(Rt,{children:[e(ia,{borderColor:p}),s(di,{title:n("theme.customGroup"),sx:v,children:[_.length?_.map(E=>{const F=b===`custom:${E.id}`;return e(jt,{onClick:()=>me(E.id),_hover:{bg:u},children:s(O,{justify:"space-between",w:"full",children:[s(O,{children:[e(L,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${E.light.surface}, ${E.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:E.name})]}),s(O,{spacing:1,children:[F&&e(Si,{}),[{icon:e(ld,{}),label:n("theme.edit"),onClick:()=>W(E)},{icon:e(cd,{}),label:n("theme.delete"),onClick:()=>ue(E.id)}].map(({icon:ce,label:de,onClick:De})=>e(L,{as:"span",role:"button",tabIndex:0,"aria-label":de,onClick:Ee=>he(Ee,De),onKeyDown:Ee=>{(Ee.key==="Enter"||Ee.key===" ")&&he(Ee,De)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:u},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:ce},de))]})]})},E.id)}):e(jt,{isDisabled:!0,children:n("theme.noCustom")}),e(jt,{icon:e(od,{}),onClick:()=>se(),_hover:{bg:u},children:n("theme.createCustom")})]}),e(ia,{borderColor:p}),e(jt,{icon:e(xi,{}),onClick:()=>se(yi[0]),_hover:{bg:u},children:n("theme.quickPreset")}),e(jt,{icon:e(dd,{}),onClick:j,_hover:{bg:u},children:n("theme.export")}),e(jt,{icon:e(ud,{}),onClick:()=>a.onOpen(),_hover:{bg:u},children:n("theme.import")}),e(jt,{icon:e(hd,{}),onClick:te,_hover:{bg:u},children:n("theme.reset")})]})]})]}),s(It,{isOpen:i.isOpen,onClose:i.onClose,isCentered:!0,size:"xl",children:[e(pt,{bg:A,backdropFilter:"blur(4px)"}),s(Tt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:g,children:[e(gt,{color:g,children:n(D?"theme.editThemeTitle":"theme.customTitle")}),e(Dt,{}),e(mt,{children:s(le,{spacing:6,align:"stretch",children:[s(w,{children:[e(C,{color:f,children:n("theme.customName")}),e(be,{placeholder:n("theme.customNamePlaceholder")||"",value:U.name,onChange:E=>re(F=>({...F,name:E.target.value}))})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[M("light"),M("dark")]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(xe,{spacing:4,children:[s(w,{children:[e(C,{color:f,children:n("theme.lightPrimary")}),e(be,{type:"color",value:U.light.primary,onChange:E=>re(F=>({...F,light:{...F.light,primary:E.target.value}}))}),e(Cr,{color:f,children:n("theme.lightPrimaryHint")})]}),s(w,{children:[e(C,{color:f,children:n("theme.lightSurface")}),e(be,{type:"color",value:U.light.surface,onChange:E=>re(F=>({...F,light:{...F.light,surface:E.target.value}}))}),e(Cr,{color:f,children:n("theme.lightSurfaceHint")})]}),s(w,{children:[e(C,{color:f,children:n("theme.lightBackground")}),e(be,{type:"color",value:U.light.bg,onChange:E=>re(F=>({...F,light:{...F.light,bg:E.target.value}}))})]})]}),s(xe,{spacing:4,children:[s(w,{children:[e(C,{color:f,children:n("theme.darkPrimary")}),e(be,{type:"color",value:U.dark.primary,onChange:E=>re(F=>({...F,dark:{...F.dark,primary:E.target.value}}))}),e(Cr,{color:f,children:n("theme.darkPrimaryHint")})]}),s(w,{children:[e(C,{color:f,children:n("theme.darkSurface")}),e(be,{type:"color",value:U.dark.surface,onChange:E=>re(F=>({...F,dark:{...F.dark,surface:E.target.value}}))}),e(Cr,{color:f,children:n("theme.darkSurfaceHint")})]}),s(w,{children:[e(C,{color:f,children:n("theme.darkBackground")}),e(be,{type:"color",value:U.dark.bg,onChange:E=>re(F=>({...F,dark:{...F.dark,bg:E.target.value}}))})]})]})]}),s(L,{children:[s(O,{mb:2,children:[e(xi,{}),e(h,{fontWeight:"semibold",children:n("theme.presets")})]}),e(Ve,{columns:{base:1,md:3},spacing:3,children:yi.map(E=>e(G,{size:"sm",variant:"outline",onClick:()=>re({name:n(`theme.presets.${E.key}.name`),light:{...E.light},dark:{...E.dark}}),children:n(`theme.presets.${E.key}.name`)},E.key))})]})]})}),s(_t,{children:[e(G,{variant:"ghost",mr:3,onClick:i.onClose,children:n("cancel")}),e(G,{colorScheme:"primary",onClick:Q,children:n(D?"theme.customUpdate":"theme.customSave")})]})]})]}),s(It,{isOpen:a.isOpen,onClose:a.onClose,size:"lg",isCentered:!0,children:[e(pt,{bg:A,backdropFilter:"blur(4px)"}),s(Tt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:g,children:[e(gt,{color:g,children:n("theme.importTitle")}),e(Dt,{}),e(mt,{children:s(le,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:f,children:n("theme.importDescription")}),e(fr,{rows:8,placeholder:n("theme.importPlaceholder")||"",value:I,onChange:E=>P(E.target.value),bg:"transparent",borderColor:p,color:g})]})}),s(_t,{children:[e(G,{variant:"ghost",mr:3,onClick:a.onClose,children:n("cancel")}),e(G,{colorScheme:"primary",onClick:N,children:n("theme.importAction")})]})]})]})]})},yd=Ie.object({username:Ie.string().min(1,"login.fieldRequired"),password:Ie.string().min(1,"login.fieldRequired")}),Sd=Z("img",{baseStyle:{w:12,h:12}}),xd=Z(Wl,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),kd=Z(yn,{baseStyle:{w:4,h:4}}),wd=Z(Xa,{baseStyle:{w:4,h:4}}),wi=()=>{var v,b;const[t,n]=d.exports.useState(""),[r,l]=d.exports.useState(!1),[o,i]=d.exports.useState(!1),a=Fl(),{t:c}=He();let u=Qa();const{register:p,formState:{errors:g},handleSubmit:f}=_r({resolver:ha(yd)});d.exports.useEffect(()=>{Zc(),u.pathname!=="/login"&&a("/login",{replace:!0})},[]);const A=y=>{n("");const _=new FormData;_.append("username",y.username),_.append("password",y.password),_.append("grant_type","password"),l(!0),Ce("/admin/token",{method:"post",body:_}).then(({access_token:z})=>{console.log("Token received:",z),Qc(z),a("/")}).catch(z=>{var U,re;n(((re=(U=z.response)==null?void 0:U._data)==null?void 0:re.detail)||"Login failed")}).finally(()=>l(!1))};return e(le,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(Br,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:s(Zr,{children:[s(O,{justifyContent:"end",spacing:2,mb:6,children:[e(Ko,{}),e(Yo,{minimal:!0})]}),s(le,{alignItems:"center",w:"full",spacing:4,children:[e(Sd,{src:rd,alt:c("appName")||"Rebecca"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(L,{w:"full",pt:"4",children:e("form",{onSubmit:f(A),children:s(le,{spacing:4,children:[e(w,{children:e($t,{w:"full",placeholder:c("username"),...p("username"),error:c((v=g==null?void 0:g.username)==null?void 0:v.message)})}),s(w,{isInvalid:!!g.password,children:[s(hr,{children:[e(be,{w:"full",type:o?"text":"password",placeholder:c("password"),...p("password")}),e(xr,{children:e(Ne,{"aria-label":o?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>i(!o),icon:o?e(wd,{}):e(kd,{})})})]}),e(Or,{children:(b=g.password)==null?void 0:b.message})]}),t&&s(br,{status:"error",rounded:"md",children:[e(yr,{}),e(os,{children:t})]}),s(G,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(xd,{marginRight:1}),c("login")]})]})})})]})})})},vd=async()=>await Ce("/admin"),vs=()=>{const{data:t,isError:n,isLoading:r,isSuccess:l,error:o}=es({queryFn:()=>vd()});return{userData:t||{is_sudo:!1,telegram_id:"",username:"",users_usage:0},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:n,getUserError:o}},rs={baseStyle:{w:5,h:5}},Cd=Z(Hl,rs),_d=Z(xo,rs),Dd=Z(Bl,rs),va=Z(Vl,rs),Ad=Z($l,rs),Id=Z(Kl,rs),Td=Z(pa,rs),Pd=Z(ko,rs),Ed=Z(wo,rs),vi=({collapsed:t,inDrawer:n=!1})=>{const{t:r}=He(),l=Qa(),{userData:o,getUserIsSuccess:i}=vs(),a=i&&o.is_sudo,u=[...[{title:r("header.hostSettings"),url:"/hosts",icon:Dd},{title:r("header.nodeSettings"),url:"/node-settings",icon:Ad},{title:r("header.integrationSettings","Master Settings"),url:"/integrations",icon:va},{title:r("header.xraySettings"),url:"/xray-settings",icon:va}]];a&&u.unshift({title:r("services.menu","Services"),url:"/services",icon:Pd});const p=u.some(v=>l.pathname===v.url),[g,f]=d.exports.useState(p);d.exports.useEffect(()=>{p&&f(!0)},[p]);const A=[{title:r("dashboard"),url:"/",icon:Cd},{title:r("users"),url:"/users",icon:_d}];return a&&(A.push({title:r("usage.menu","Usage"),url:"/usage",icon:Ed}),A.push({title:r("admins","Admins"),url:"/admins",icon:Id}),A.push({title:r("header.settings"),icon:va,subItems:u})),e(L,{w:n?"full":t?"16":"60",h:n?"100%":"100vh",maxH:n?"100%":"100vh",bg:"surface.light",borderRight:n?void 0:"1px",borderColor:n?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:n?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:n?"relative":"fixed",top:n?void 0:"0",left:n?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:s(le,{spacing:1,p:4,align:"stretch",children:[!t&&e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},px:2,mb:2,children:r("menu")}),A.map(v=>{const b=v.url,y=typeof b=="string"&&l.pathname===b||typeof b=="string"&&b!=="/"&&l.pathname.startsWith(b)||v.subItems&&v.subItems.some(z=>l.pathname===z.url),_=v.icon;return e(L,{children:v.subItems?s(Rt,{children:[s(O,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:y?"primary.50":"transparent",color:y?"primary.600":"gray.700",_dark:{bg:y?"primary.900":"transparent",color:y?"primary.200":"gray.300"},_hover:{bg:y?"primary.50":"gray.50",_dark:{bg:y?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>f(!g),children:[s(O,{children:[e(_,{}),!t&&e(h,{fontSize:"sm",fontWeight:y?"semibold":"normal",children:v.title})]}),!t&&e(Td,{transform:g?"rotate(180deg)":"rotate(0deg)"})]}),!t&&e(Fs,{in:g,animateOpacity:!0,children:e(le,{align:"stretch",pl:6,spacing:1,mt:2,children:v.subItems.map(z=>{const U=l.pathname===z.url,re=z.icon;return e(ui,{to:z.url,children:s(O,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:U?"primary.50":"transparent",color:U?"primary.600":"gray.700",_dark:{bg:U?"primary.900":"transparent",color:U?"primary.200":"gray.300"},_hover:{bg:U?"primary.50":"gray.50",_dark:{bg:U?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(re,{}),e(h,{fontSize:"sm",fontWeight:U?"semibold":"normal",children:z.title})]})},z.url)})})})]}):v.url?e(ui,{to:v.url,children:s(O,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:y?"primary.50":"transparent",color:y?"primary.600":"gray.700",_dark:{bg:y?"primary.900":"transparent",color:y?"primary.200":"gray.300"},_hover:{bg:y?"primary.50":"gray.50",_dark:{bg:y?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(_,{}),!t&&e(h,{fontSize:"sm",fontWeight:y?"semibold":"normal",children:v.title})]})}):null},v.title)})]})})},ea=Jl,Nd="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",Go={base:Nd,folder:"apple/64",ext:".png",className:"apple-emoji"},Ca=t=>{var n,r;return typeof t=="string"&&((r=(n=ea.test)==null?void 0:n.call(ea,t))!=null?r:!1)},zd=t=>t.some(n=>{var r;return n.type==="characterData"?Ca((r=n.target)==null?void 0:r.data):n.type==="childList"?Array.from(n.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return Ca(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const o=l;return o.tagName==="IMG"&&o.classList.contains(Go.className)?!1:Ca(o.textContent)}return!1}):!1}),Rd=()=>{const t=Qa();d.exports.useEffect(()=>{const n=document.getElementById("root");if(!n)return;const r=()=>{ea.parse(n,Go)};r();const l=new MutationObserver(o=>{zd(o)&&requestAnimationFrame(r)});return l.observe(n,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},Xo={baseStyle:{w:4,h:4}},Ud=Z(ql,Xo),Ld=Z(vo,Xo);function Md(){const[t,n]=d.exports.useState(!1),r=ur({base:!0,md:!1}),l=Yt();return Rd(),s(St,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(vi,{collapsed:t}),s(St,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[s(L,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(Ne,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():n(!t)},icon:e(Ld,{})}),s(O,{spacing:2,children:[e(Ko,{}),e(Yo,{}),e(Yl,{to:"/login",children:e(Ne,{size:"sm",variant:"outline","aria-label":"logout",icon:e(Ud,{})})})]})]}),e(L,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(Gl,{})})]}),r&&s(Co,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(pt,{}),e(_o,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(mt,{p:0,children:e(vi,{collapsed:!1,inDrawer:!0})})})]})]})}const Qo="marzban-num-users-per-page",Ci=10,Od=()=>{const t=localStorage.getItem(Qo)||Ci.toString();return parseInt(t)||Ci},Wd=t=>localStorage.setItem(Qo,t),Fd=t=>{for(const n in t)t[n]||delete t[n];return ht.setState({loading:!0}),Ce("/users",{query:t}).then(n=>{var i,a;const r=(i=n.users_limit)!=null?i:null,l=(a=n.active_total)!=null?a:null,o=r!=null&&r>0&&l!==null?l>=r:!1;return ht.setState({users:n,isUserLimitReached:o}),n}).finally(()=>{ht.setState({loading:!1})})},kn=()=>Ce("/inbounds").then(t=>{ht.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{ht.setState({loading:!1})}),ht=Ks(Xl((t,n)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Od(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{Fd(n().filters)},resetAllUsage:()=>Ce("/users/reset",{method:"POST"}).then(()=>{n().onResetAllUsage(!1),n().refetchUsers()}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...n().filters,...r}}),n().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),Ce(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),n().refetchUsers(),Zn.invalidateQueries(ta)})),createUser:r=>Ce("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(),Zn.invalidateQueries(ta)}),createUserWithService:r=>Ce("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(),Zn.invalidateQueries(ta)}),editUser:(r,l)=>Ce(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{n().onEditingUser(null),n().refetchUsers()}),fetchUserUsage:(r,l)=>{for(const o in l)l[o]||delete l[o];return Ce(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>Ce(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),n().refetchUsers()}),revokeSubscription:r=>Ce(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),n().refetchUsers()}),onEditingCore:r=>t({isEditingCore:r})})));function qe(t,n=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,o=n<0?0:n,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(l)),c=parseFloat((t/Math.pow(l,a)).toFixed(o));return r?[c,i[a]]:`${c} ${i[a]}`}const _i=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Hd=Z(xo,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Bd=Z(Ql,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Di=({title:t,content:n,icon:r})=>s(Br,{p:6,borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[s(O,{alignItems:"center",columnGap:"4",children:[e(L,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:r}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(L,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:n})]}),ta="statistics-query-key",Vd=t=>{var i;const{version:n}=ht(),{userData:r}=vs(),{data:l}=es({queryKey:ta,queryFn:()=>Ce("/system"),refetchInterval:6e5,onSuccess:({version:a})=>{n!==a&&ht.setState({version:a})}}),{t:o}=He();return s(O,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(Di,{title:o("activeUsers"),content:l&&s(O,{alignItems:"flex-end",children:[e(h,{children:_i(l.users_active)}),s(h,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",_i(l.total_user)]})]}),icon:e(Hd,{})}),e(Di,{title:o("UsersUsage"),content:qe((i=r.users_usage)!=null?i:0),icon:e(Bd,{})})]})},$d=()=>{const{t}=He();return e(le,{spacing:6,align:"stretch",children:s(L,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(Vd,{})]})})},Ss=({children:t,color:n})=>e(L,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${n}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${n}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${n}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${n}.400`}},children:e(h,{color:`${n}.500`,_dark:{color:`${n}.900`},position:"relative",zIndex:"2",children:t})}),En=Z(Vr,{baseStyle:{w:5,h:5}}),Kd=()=>{const[t,n]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:o}=ht(),{t:i}=He(),a=Ut(),c=()=>{l(null)},u=()=>{r&&(n(!0),o(r).then(()=>{a({title:i("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(n.bind(null,!1)))};return s(It,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",children:[e(gt,{pt:6,children:e(Ss,{color:"red",children:e(En,{})})}),e(Dt,{mt:3}),s(mt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:r.username})})})]}),s(_t,{display:"flex",children:[e(G,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(G,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(xt,{size:"xs"}):void 0,children:i("delete")})]})]})]})},Jd={search:"",limit:10,offset:0,sort:"username"},ss=Ks((t,n)=>({admins:[],total:0,loading:!1,filters:Jd,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=n(),o={...l,...r},i={};o.search&&(i.username=o.search),o.offset!==void 0&&(i.offset=o.offset),o.limit!==void 0&&(i.limit=o.limit),o.sort&&(o.sort==="data_usage"?i.sort="users_usage":o.sort==="data_limit"?i.sort="data_limit":i.sort=o.sort),t({loading:!0});try{const a=await Ce("/admins",{query:i}),{admins:c,total:u}=Array.isArray(a)?{admins:a,total:a.length}:{admins:a.admins||[],total:a.total||0};t(p=>{const g=p.adminInDetails?c.find(f=>{var A;return f.username===((A=p.adminInDetails)==null?void 0:A.username)})||p.adminInDetails:null;return{admins:c,total:u,adminInDetails:g}})}catch(a){console.error("Failed to fetch admins:",a),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),n().fetchAdmins()},async createAdmin(r){await Ce("/admin",{method:"POST",body:r}),await n().fetchAdmins()},async updateAdmin(r,l){await Ce(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await n().fetchAdmins()},async deleteAdmin(r){await Ce(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await n().fetchAdmins()},async resetUsage(r){await Ce(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await n().fetchAdmins()},async disableUsers(r){await Ce(`/admin/${encodeURIComponent(r)}/users/disable`,{method:"POST"})},async activateUsers(r){await Ce(`/admin/${encodeURIComponent(r)}/users/activate`,{method:"POST"})},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),ga={baseStyle:{w:4,h:4}},qd=Z(Do,ga),Yd=Z(Ya,ga),Gd=Z($r,ga),Xd=Z(ts,ga),Qd=Zl((t,n)=>{n==="users"?ht.getState().onFilterChange({...ht.getState().filters,offset:0,search:t}):ss.getState().onFilterChange({search:t,offset:0})},300),Zo=({for:t="users",...n})=>{var I;const{loading:r,filters:l,onFilterChange:o,refetchUsers:i,onCreateUser:a}=ht(),{loading:c,filters:u,onFilterChange:p,fetchAdmins:g,openAdminDialog:f}=ss(),{t:A}=He(),[v,b]=d.exports.useState(""),y=t==="users"?r:c,_=t==="users"?l:u,z=P=>{b(P.target.value),Qd(P.target.value,t)},U=()=>{b(""),t==="users"?o({..._,offset:0,search:""}):p({search:"",offset:0})},re=()=>{t==="users"?i():g()},D=()=>{t==="users"?a(!0):f()},B=(I=ur({base:!0,sm:!1}))!=null?I:!1;return s(Za,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...n,children:[e(ms,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:s(O,{spacing:2,align:"center",w:"full",children:[s(hr,{flex:"1",children:[e(Ao,{pointerEvents:"none",children:e(qd,{})}),e(be,{placeholder:t==="users"?A("search"):A("admins.searchPlaceholder","Search admins..."),value:v,borderColor:"light-border",w:"full",onChange:z}),s(xr,{children:[y&&e(xt,{size:"xs"}),_.search&&_.search.length>0&&e(Ne,{onClick:U,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Yd,{})})]})]}),e(Ne,{"aria-label":"refresh",disabled:y,onClick:re,size:B?"sm":"md",variant:B?"ghost":"outline",borderRadius:"full",minW:B?"36px":"40px",h:B?"36px":void 0,children:e(Gd,{className:Ga({"animate-spin":y})})})]})}),e(ms,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(xe,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:e(G,{colorScheme:"primary",size:B?"sm":"md",onClick:D,px:B?3:5,leftIcon:B?void 0:e(Xd,{}),w:"auto",h:B?"36px":void 0,minW:B?"auto":"8.5rem",fontSize:B?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?A("createUser"):A("admins.addAdmin","Add admin")})})})]})},Zd=Z(jl,{baseStyle:{w:4,h:4}}),jd=Z(ec,{baseStyle:{w:4,h:4}}),Ai=5;function eu(t,n,r){if(r<Ai)throw new Error(`Must allow at least ${Ai} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,n-Math.floor(r/2))),o=new Array(r);for(let i=0;i<r;i+=1)o[i]=i+l;return typeof o[0]=="number"&&o[0]>0&&(o[0]=0,o[1]="prev-more"),o[o.length-1]<t-1&&(o[o.length-1]=t-1,o[o.length-2]="next-more"),o}const jo=({for:t="users"})=>{const{filters:n,onFilterChange:r,users:{total:l}}=ht(),{filters:o,onFilterChange:i,total:a}=ss(),{t:c}=He(),{filters:u,total:p,onFilterChange:g}=d.exports.useMemo(()=>t==="admins"?{filters:o,total:a,onFilterChange:i}:{filters:n,total:l,onFilterChange:r},[t,o,a,i,n,l,r]),{limit:f,offset:A}=u,v=Number(f||10),b=Number(A||0),y=Math.floor(b/v),_=Math.ceil(p/v),z=eu(_,y,7),U=I=>{g({...u,offset:I*v})},re=I=>{const P=parseInt(I.target.value,10);g({...u,limit:P,offset:0}),t==="users"&&Wd(I.target.value)},D=d.exports.useMemo(()=>y>0&&_>0,[y,_]),B=d.exports.useMemo(()=>y+1<_&&_>0,[y,_]);return p<=v&&y===0?null:s(O,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(L,{order:{base:2,md:1},children:s(O,{children:[s(Ye,{minW:"60px",value:String(v),onChange:re,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),s(Io,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(G,{leftIcon:e(Zd,{}),onClick:()=>U(y-1),isDisabled:!D,children:c("previous")}),z.map(I=>typeof I=="string"?e(G,{children:"..."},I):e(G,{variant:I===y?"solid":"outline",onClick:()=>U(I),children:I+1},I)),e(G,{rightIcon:e(jd,{}),onClick:()=>U(y+1),isDisabled:!B,children:c("next")})]})]})},tu=tc;const Ii=Z(rc),ru=Z(To,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),su=Z(sc,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),nu=Z(Po,{baseStyle:{w:5,h:5}}),au=()=>{const{QRcodeLinks:t,setQRCode:n,setSubLink:r,subscribeUrl:l}=ht(),o=t!==null,[i,a]=d.exports.useState(0),{t:c}=He(),u=()=>{n(null),r(null)},p=String(l).startsWith("/")?window.location.origin+l:String(l);return s(It,{isOpen:o,onClose:u,children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(gt,{pt:6,children:e(Ss,{color:"primary",children:e(nu,{color:"white"})})}),e(Dt,{mt:3}),t&&s(mt,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&s(le,{children:[e(Ii,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),s(L,{w:"300px",children:[e(tu,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:a,onInit:()=>a(0),nextArrow:e(Ne,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(ru,{})}),prevArrow:e(Ne,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(su,{})}),children:t.map((g,f)=>e(O,{children:e(Ii,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:g,bg:"white"})},f))}),s(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},iu=Z($r,{baseStyle:{w:5,h:5}}),ou=()=>{const[t,n]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=ht(),{t:o}=He(),i=Ut(),a=()=>{ht.setState({resetUsageUser:null})},c=()=>{r&&(n(!0),l(r).then(()=>{i({title:o("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(It,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",children:[e(gt,{pt:6,children:e(Ss,{color:"blue",children:e(iu,{})})}),e(Dt,{mt:3}),s(mt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:o("resetUserUsage.prompt",{username:r.username})})})]}),s(_t,{display:"flex",children:[e(G,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(G,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(xt,{size:"xs"}):void 0,children:o("reset")})]})]})]})},lu=Z($r,{baseStyle:{w:5,h:5}}),cu=()=>{const[t,n]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=ht(),{t:o}=He(),i=Ut(),a=()=>{ht.setState({revokeSubscriptionUser:null})},c=()=>{r&&(n(!0),l(r).then(()=>{i({title:o("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(It,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",children:[e(gt,{pt:6,children:e(Ss,{color:"blue",children:e(lu,{})})}),e(Dt,{mt:3}),s(mt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:o("revokeUserSub.prompt",{username:r.username})})})]}),s(_t,{display:"flex",children:[e(G,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(G,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(xt,{size:"xs"}):void 0,children:o("revoke")})]})]})]})},Nn={baseStyle:{strokeWidth:"2px",w:4,h:4}},Ti=Z(nc,Nn),du=Z(ac,Nn),Pi=Z(ic,Nn),Ei=Z(Eo,Nn),uu=Z(Eo,Nn),Fa=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],gs={active:{statusColor:"green",bandWidthColor:"primary",icon:Ti},connected:{statusColor:"green",bandWidthColor:"primary",icon:Ti},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:du},expired:{statusColor:"orange",bandWidthColor:"orange",icon:Ei},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:uu},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:Ei},limited:{statusColor:"red",bandWidthColor:"red",icon:Pi},error:{statusColor:"red",bandWidthColor:"red",icon:Pi}},Os=Ks((t,n)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await Ce("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await Ce(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await Ce("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await n().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const o=await Ce(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:o}),await n().fetchServices(),o}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await Ce(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await n().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await Ce(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await n().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),fa=t=>{let n={status:"",time:""};if(t){We(t*1e3).utc().isAfter(We().utc())?n.status="expires":n.status="expired";const r=[],l=We.duration(We(t*1e3).utc().diff(We()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),n.time=r.join(", ")}return n},zn=d.exports.forwardRef((t,n)=>e(oc,{...t,ref:n}));zn.displayName="DatePicker";function hu(t){const n=360/t,r=90,l=47,o=[];for(let i=0;i<t;i++){const a=i*n%360+140,c=pu(a,r,l);o.push(c)}return o}function pu(t,n,r){t/=360,n/=100,r/=100;let l,o,i;if(n===0)l=o=i=r;else{const c=(g,f,A)=>(A<0&&(A+=1),A>1&&(A-=1),A<.16666666666666666?g+(f-g)*6*A:A<.5?f:A<.6666666666666666?g+(f-g)*(.6666666666666666-A)*6:g),u=r<.5?r*(1+n):r+n-r*n,p=2*r-u;l=Math.round(c(p,u,t+1/3)*255),o=Math.round(c(p,u,t)*255),i=Math.round(c(p,u,t-1/3)*255)}const a=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${a(l)}${a(o)}${a(i)}`}const Ni=({border:t,...n})=>{const{getInputProps:r,getRadioProps:l}=dc(n),o=ur({base:"xs",md:"sm"});return s(L,{as:"label",children:[e("input",{...r()}),e(L,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:o,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:n.children})]})},mu=({onChange:t,defaultValue:n,...r})=>{const{t:l,i18n:o}=He();cs();const i=ur({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),a={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=ur({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:p,setValue:g}=lc({name:"filter",defaultValue:n,onChange:Q=>{if(Q==="custom")return;v(),i.indexOf(Q)>=0?(_(l("userDialog.custom")),U(!1)):(_(l("userDialog.custom")+` (${Q})`),U(!0));const ue=Number(Q.substring(0,Q.length-1)),te=a[Q[Q.length-1]];t(Q,{start:We().utc().subtract(ue,te).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:f,onOpen:A,onClose:v}=Yt(),b=d.exports.useRef(null);cc({ref:b,handler:v});const[y,_]=d.exports.useState(l("userDialog.custom")),[z,U]=d.exports.useState(!1),[re,D]=d.exports.useState(0),B=ur({base:1,md:2}),I=ur({base:"xs",md:"sm"}),[P,_e]=d.exports.useState(null),[me,se]=d.exports.useState(null),W=Q=>{const[ue,te]=Q;me&&!te?(_e(null),se(null)):(_e(ue),se(te),ue&&te&&(v(),t("custom",{start:We(ue).format("YYYY-MM-DDT00:00:00"),end:We(te).format("YYYY-MM-DDT23:59:59")})))};return s(le,{...r,children:[re==0&&s(Ve,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(Q=>e(Ni,{...p({value:Q}),children:Q},Q)),e(L,{onClick:()=>{_e(null),se(null),A()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:I,px:3,py:1,bg:z?"primary.500":"unset",color:z?"white":"unset",borderColor:z?"primary.500":"unset",children:s(O,{children:[e(h,{children:y}),e(gn,{as:hi,boxSize:"18px"})]})})]}),re==1&&s(O,{onClick:A,cursor:"pointer",fontSize:I,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:P?"unset":"gray.500",children:P?We(P).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(gn,{as:To,boxSize:"18px"}),e(h,{w:"full",color:me?"unset":"gray.500",children:me?We(me).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(gn,{as:hi,boxSize:"18px"})]}),e(le,{ref:b,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:f?"unset":"none",children:s(Js,{onChange:Q=>D(Q),children:[s(qs,{children:[e(Bt,{fontSize:I,children:l("userDialog.relative")}),e(Bt,{fontSize:I,children:l("userDialog.absolute")})]}),s(Ys,{children:[e(Vt,{children:c.map(Q=>e(le,{alignItems:"start",pl:2,pr:2,children:s(O,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:I,minW:"60px",children:l("userDialog."+Q.title)}),Q.options.map(ue=>e(Ni,{border:!0,...p({value:ue}),children:ue},ue+".custom"))]})},Q.title))}),e(Vt,{className:"datepicker-panel",children:e(le,{children:e(zn,{locale:o.language.toLocaleLowerCase(),selected:P,onChange:W,startDate:P,endDate:me,selectsRange:!0,maxDate:new Date,monthsShown:B,peekNextMonth:!1,inline:!0})})})]})]})})]})};function ca(t,n,r=[],l=[]){const o=qe(r.reduce((i,a)=>i+=a,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${n}${o}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:a,w:c})=>qe(c.config.series[a],1)},tooltip:{custom:({series:i,seriesIndex:a,dataPointIndex:c,w:u})=>{const p=qe(i[a],1),g=Math.max(i.reduce((A,v)=>A+=v),1),f=Math.round(i[a]/g*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[a]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[a]}: <b>${f}, ${p}</b>
            </div>
          `}},colors:hu(r.length)}}}const gu=Z(uc,{baseStyle:{w:5,h:5}}),fu=Z(ls,{baseStyle:{w:5,h:5}}),bu=Z(wo,{baseStyle:{w:5,h:5}}),yu=Z(hc,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});Z(ua,{baseStyle:{w:4,h:4}});const Su=t=>{var r,l,o,i,a;const n=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(n),next_plan_data_limit:n!=null&&n.data_limit?Number((n.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(o=n==null?void 0:n.expire)!=null?o:null,next_plan_add_remaining_traffic:(i=n==null?void 0:n.add_remaining_traffic)!=null?i:!1,next_plan_fire_on_either:(a=n==null?void 0:n.fire_on_either)!=null?a:!0}},_a=()=>({data_limit:null,ip_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),en={username:Ie.string().min(1,{message:"Required"}),note:Ie.string().nullable(),service_id:Ie.union([Ie.string(),Ie.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),proxies:Ie.record(Ie.string(),Ie.record(Ie.string(),Ie.any())).transform(t=>{const n=(r,l)=>{r&&r[l]===""&&delete r[l]};return n(t.vmess,"id"),n(t.vless,"id"),n(t.trojan,"password"),n(t.shadowsocks,"password"),n(t.shadowsocks,"method"),t}),data_limit:Ie.string().min(0).or(Ie.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:Ie.number().nullable(),data_limit_reset_strategy:Ie.string(),inbounds:Ie.record(Ie.string(),Ie.array(Ie.string())).transform(t=>(Object.keys(t).forEach(n=>{var r;Array.isArray(t[n])&&!((r=t[n])!=null&&r.length)&&delete t[n]}),t)),next_plan_enabled:Ie.boolean().default(!1),next_plan_data_limit:Ie.union([Ie.string(),Ie.number(),Ie.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:Math.max(0,n)}),next_plan_expire:Ie.union([Ie.number(),Ie.string(),Ie.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),next_plan_add_remaining_traffic:Ie.boolean().default(!1),next_plan_fire_on_either:Ie.boolean().default(!0)},xu=Ie.discriminatedUnion("status",[Ie.object({status:Ie.literal("active"),...en}),Ie.object({status:Ie.literal("disabled"),...en}),Ie.object({status:Ie.literal("limited"),...en}),Ie.object({status:Ie.literal("expired"),...en}),Ie.object({status:Ie.literal("on_hold"),on_hold_expire_duration:Ie.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...en})]),ku=()=>{var Gt,er,Wt,Ge,ut,tr,Et,rr,$;const{editingUser:t,isCreatingNewUser:n,onCreateUser:r,editUser:l,fetchUserUsage:o,onEditingUser:i,createUserWithService:a,onDeletingUser:c,users:u,isUserLimitReached:p}=ht(),g=!!t,f=n||g,A=(Gt=u.users_limit)!=null?Gt:null,v=(er=u.active_total)!=null?er:null,b=p&&!g,[y,_]=d.exports.useState(!1),[z,U]=d.exports.useState(""),re=Ut(),{t:D}=He(),{colorMode:B}=cs(),I=_r({defaultValues:_a(),resolver:ha(xu)}),P=I.getValues("expire"),_e=I.getValues("next_plan_expire");function me(k){if(typeof k!="number"||k<=0)return null;const T=We.unix(k).utc().local(),Te=We(),Fe=T.diff(Te,"day",!0);return Number.isFinite(Fe)?Math.max(0,Math.round(Fe)):null}function se(k){return We().add(k,"day").endOf("day").utc().unix()}const[W,Q]=d.exports.useState(()=>me(P)),[ue,te]=d.exports.useState(()=>me(_e)),j=Os(k=>k.services),N=Os(k=>k.isLoading),{userData:he,getUserIsSuccess:Ae}=vs(),ve=Boolean(Ae&&he.is_sudo),[M,E]=d.exports.useState(null),F=j.length>0,ce=M&&(Wt=j.find(k=>k.id===M))!=null?Wt:null,de=Boolean(t==null?void 0:t.service_id),De=!ve&&j.length===1,Ee=ve||j.length!==1,Y=Ee&&j.length>0,we=!Y,J=!ve&&j.length===0,[Se,X]=d.exports.useState(!1),ge=()=>{X(k=>!k)};d.exports.useEffect(()=>{f&&Os.getState().fetchServices()},[f]),d.exports.useEffect(()=>{var k,T;g?t!=null&&t.service_id?E(t.service_id):ve?E(null):j.length?E((T=(k=j[0])==null?void 0:k.id)!=null?T:null):E(null):f||E(null)},[g,t,f,ve,j]),d.exports.useEffect(()=>{!g&&f&&F&&E(k=>{var T,Te;return(Te=k!=null?k:(T=j[0])==null?void 0:T.id)!=null?Te:null})},[j,g,f,F]),d.exports.useEffect(()=>{!g&&f&&!F&&E(null)},[F,g,f]),d.exports.useEffect(()=>{De&&j[0]&&E(k=>k!=null?k:j[0].id)},[De,j]);const[ke,Xe]=Ot({control:I.control,name:["data_limit","status"]}),ie=Ot({control:I.control,name:"next_plan_enabled"}),ne=Ot({control:I.control,name:"expire"}),oe=Ot({control:I.control,name:"next_plan_data_limit"}),K=Ot({control:I.control,name:"next_plan_expire"}),fe=Ot({control:I.control,name:"next_plan_add_remaining_traffic"}),dt=Ot({control:I.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const k=me(ne);Q(T=>T===k?T:k)},[ne]),d.exports.useEffect(()=>{const k=me(K);te(T=>T===k?T:k)},[K]);const Je=k=>{I.setValue("next_plan_enabled",k,{shouldDirty:!0}),k?(I.getValues("next_plan_data_limit")===null&&I.setValue("next_plan_data_limit",0,{shouldDirty:!1}),I.getValues("next_plan_add_remaining_traffic")===void 0&&I.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),I.getValues("next_plan_fire_on_either")===void 0&&I.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(I.setValue("next_plan_data_limit",null,{shouldDirty:!0}),I.setValue("next_plan_expire",null,{shouldDirty:!0}),te(null))},q=D("userDialog.total"),[x,R]=d.exports.useState(ca(B,q)),[ee,Pe]=d.exports.useState("1m"),Be=k=>{o(t,k).then(T=>{const Te=[],Fe=[];for(const Re in T.usages)Fe.push(T.usages[Re].used_traffic),Te.push(T.usages[Re].node_name);R(ca(B,q,Fe,Te))})};d.exports.useEffect(()=>{if(t){const k=Su(t);I.reset(k),Q(me(k.expire)),te(me(k.next_plan_expire)),Be({start:We().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const k=_a();I.reset(k),Q(me(k.expire)),te(me(k.next_plan_expire))}},[t,g,f]);const rt=k=>{var nr,Ir;if(b)return;_(!0),U(null);const{service_id:T,next_plan_enabled:Te,next_plan_data_limit:Fe,next_plan_expire:Re,next_plan_add_remaining_traffic:et,next_plan_fire_on_either:ft,proxies:Pt,inbounds:it,status:Nt,data_limit:Lt,data_limit_reset_strategy:Jr,on_hold_expire_duration:qr,ip_limit:Dr,...Mt}=k,zr=Te&&Fe&&Fe>0?Number((Number(Fe)*1073741824).toFixed(5)):0,Ar=Te?{data_limit:zr,expire:Re!=null?Re:0,add_remaining_traffic:et,fire_on_either:ft}:null,Yr=typeof Dr=="number"&&Number.isFinite(Dr)&&Dr>0?Math.floor(Dr):0;if(!g){const bt=M!=null?M:De&&(Ir=(nr=j[0])==null?void 0:nr.id)!=null?Ir:null;if(!bt){U(D("userDialog.selectService","Please choose a service")),_(!1);return}const kr={username:k.username,service_id:bt,note:k.note,status:k.status==="active"||k.status==="disabled"||k.status==="on_hold"?k.status:"active",expire:k.expire,data_limit:k.data_limit,ip_limit:Yr,data_limit_reset_strategy:Lt&&Lt>0?Jr:"no_reset",on_hold_expire_duration:Nt==="on_hold"?qr:null};Ar&&(kr.next_plan=Ar),a(kr).then(()=>{re({title:D("userDialog.userCreated",{username:k.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),lt()}).catch(yt=>{var pr,Jt,lr,Xt,Tr;(((pr=yt==null?void 0:yt.response)==null?void 0:pr.status)===409||((Jt=yt==null?void 0:yt.response)==null?void 0:Jt.status)===400)&&U((Xt=(lr=yt==null?void 0:yt.response)==null?void 0:lr._data)==null?void 0:Xt.detail),((Tr=yt==null?void 0:yt.response)==null?void 0:Tr.status)===422&&Object.keys(yt.response._data.detail).forEach(pe=>{U(yt==null?void 0:yt.response._data.detail[pe]),I.setError(pe,{type:"custom",message:yt.response._data.detail[pe]})})}).finally(()=>{_(!1)});return}const sr={...Mt,data_limit:Lt,ip_limit:Yr,data_limit_reset_strategy:Lt&&Lt>0?Jr:"no_reset",status:Nt==="active"||Nt==="disabled"||Nt==="on_hold"?Nt:"active",on_hold_expire_duration:Nt==="on_hold"?qr:null};Ar?sr.next_plan=Ar:!Te&&(t==null?void 0:t.next_plan)&&(sr.next_plan=null),t!=null&&t.service_id||(Pt&&Object.keys(Pt).length>0&&(sr.proxies=Pt),it&&Object.keys(it).length>0&&(sr.inbounds=it)),typeof M<"u"&&(M===null?ve&&(sr.service_id=null):M!==(t==null?void 0:t.service_id)&&(sr.service_id=M)),l(t.username,sr).then(()=>{re({title:D("userDialog.userEdited",{username:k.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),lt()}).catch(bt=>{var kr,yt,pr,Jt,lr;(((kr=bt==null?void 0:bt.response)==null?void 0:kr.status)===409||((yt=bt==null?void 0:bt.response)==null?void 0:yt.status)===400)&&U((Jt=(pr=bt==null?void 0:bt.response)==null?void 0:pr._data)==null?void 0:Jt.detail),((lr=bt==null?void 0:bt.response)==null?void 0:lr.status)===422&&Object.keys(bt.response._data.detail).forEach(Xt=>{U(bt==null?void 0:bt.response._data.detail[Xt]),I.setError(Xt,{type:"custom",message:bt.response._data.detail[Xt]})})}).finally(()=>{_(!1)})},lt=()=>{I.reset(_a()),Q(null),te(null),r(!1),i(null),U(null),X(!1),Pe("1m"),E(null)},At=()=>{ht.setState({resetUsageUser:t})},Ze=()=>{ht.setState({revokeSubscriptionUser:t})},Oe=y||b,kt=Xe==="on_hold",[zt,Kt]=d.exports.useState(!1),or=()=>{Kt(!0);let k="";const T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Te=T.length;let Fe=0;for(;Fe<6;)k+=T.charAt(Math.floor(Math.random()*Te)),Fe+=1;return k};return s(It,{isOpen:f,onClose:lt,size:J?"lg":"2xl",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(pc,{...I,children:s(Tt,{mx:"3",position:"relative",overflow:"hidden",children:[e(Dt,{mt:3,disabled:y}),e(L,{pointerEvents:b?"none":"auto",filter:b?"blur(6px)":"none",transition:"filter 0.2s ease",children:s("form",{onSubmit:I.handleSubmit(rt),children:[e(gt,{pt:6,children:s(O,{gap:2,children:[e(Ss,{color:"primary",children:g?e(fu,{color:"white"}):e(gu,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:D(g?"userDialog.editUserTitle":"createNewUser")})]})}),s(mt,{children:[g&&de&&s(br,{status:"info",mb:4,borderRadius:"md",children:[e(yr,{}),D("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(Ge=t==null?void 0:t.service_name)!=null?Ge:""})]}),s(Za,{templateColumns:{base:"repeat(1, 1fr)",md:Y?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...we?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(ms,{children:s(le,{justifyContent:"space-between",children:[s(St,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(St,{flexDirection:"row",w:"full",gap:2,children:s(w,{mb:"10px",isInvalid:!!((ut=I.formState.errors.username)!=null&&ut.message),children:[e(C,{children:D("username")}),s(O,{align:"flex-end",children:[e(L,{flex:"1",minW:"0",children:s(hr,{size:"sm",children:[e(be,{type:"text",borderRadius:"6px",placeholder:D("username"),isDisabled:Oe||g,...I.register("username")}),!g&&e(xr,{width:"auto",pr:1,children:e(Ne,{"aria-label":D("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(aa,{width:18}),onClick:()=>{const k=or();I.setValue("username",k,{shouldDirty:!0}),setTimeout(()=>{Kt(!1)},350)},isLoading:zt,isDisabled:Oe})})]})}),g&&e(O,{px:1,children:e(st,{name:"status",control:I.control,render:({field:k})=>e(at,{placement:"top",label:"status: "+D(`status.${k.value}`),textTransform:"capitalize",children:e(L,{children:e(ot,{colorScheme:"primary",isChecked:k.value==="active",onChange:T=>{T.target.checked?k.onChange("active"):k.onChange("disabled")}})})})})})]}),e(Or,{children:(tr=I.formState.errors.username)==null?void 0:tr.message})]})}),s(xe,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[s(w,{flex:"1",children:[e(C,{children:D("userDialog.dataLimit")}),e(st,{control:I.control,name:"data_limit",render:({field:k})=>{var T;return e($t,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:k.onChange,disabled:Oe,error:(T=I.formState.errors.data_limit)==null?void 0:T.message,value:k.value?String(k.value):""})}})]}),s(w,{flex:"1",children:[s(C,{display:"flex",alignItems:"center",gap:2,children:[D("userDialog.ipLimitLabel","IP limit"),e(at,{hasArrow:!0,placement:"top",label:D("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(Z.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(No,{width:16,height:16})})})]}),e(st,{control:I.control,name:"ip_limit",rules:{validate:k=>k==null?!0:typeof k!="number"||Number.isNaN(k)?D("userDialog.ipLimitValidation","Enter a valid non-negative number"):k>=0?!0:D("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:k})=>{var T;return e($t,{size:"sm",borderRadius:"6px",placeholder:D("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof k.value=="number"&&k.value>0?String(k.value):"",onChange:Te=>{const Fe=Te.target.value;if(!Fe.trim()||Fe.trim()==="-"){k.onChange(null);return}const Re=Number(Fe);Number.isNaN(Re)||k.onChange(Re<0?0:Math.floor(Re))},disabled:Oe,error:(T=I.formState.errors.ip_limit)==null?void 0:T.message})}})]})]}),e(Fs,{in:!!(ke&&ke>0),animateOpacity:!0,style:{width:"100%"},children:s(w,{height:"66px",children:[e(C,{children:D("userDialog.periodicUsageReset")}),e(st,{control:I.control,name:"data_limit_reset_strategy",render:({field:k})=>e(Ye,{size:"sm",...k,disabled:Oe,bg:Oe?"gray.100":"transparent",_dark:{bg:Oe?"gray.600":"transparent"},sx:{option:{backgroundColor:B==="dark"?"#222C3B":"white"}},children:Fa.map(T=>e("option",{value:T.value,children:D("userDialog.resetStrategy"+T.title)},T.value))})})]})}),s(w,{mb:"10px",isInvalid:!kt&&Boolean(I.formState.errors.expire),children:[s(St,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(C,{mb:0,children:kt?D("userDialog.onHoldExpireDuration"):D("userDialog.expiryDaysLabel","Expires in (days)")}),!g&&e(st,{name:"status",control:I.control,render:({field:k})=>{const T=k.value==="on_hold";return s(O,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:D("userDialog.onHold")}),e(ot,{colorScheme:"primary",isChecked:T,onChange:Te=>{Te.target.checked?k.onChange("on_hold"):(k.onChange("active"),I.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:Oe})]})}})]}),kt?e(st,{control:I.control,name:"on_hold_expire_duration",render:({field:k})=>{var T;return e($t,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Te=>{I.setValue("expire",null);const Fe=Te.target.value;if(!Fe){k.onChange(null);return}const Re=Number(Fe);Number.isNaN(Re)||Re<0||k.onChange(Math.round(Re))},disabled:Oe,error:(T=I.formState.errors.on_hold_expire_duration)==null?void 0:T.message,value:k.value?String(k.value):""})}}):s(Rt,{children:[e(st,{name:"expire",control:I.control,render:({field:k})=>{var Re;const{status:T,time:Te}=fa(k.value),Fe=et=>{if(!et){Q(null),k.onChange(null);return}const ft=Number(et);if(Number.isNaN(ft)||ft<0)return;const Pt=Math.min(Math.round(ft),3650);Q(Pt),I.setValue("on_hold_expire_duration",null,{shouldDirty:!1});const it=se(Pt);k.onChange(it)};return s(L,{flex:"1",minW:"180px",children:[e($t,{endAdornment:D("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof W=="number"?String(W):"",onChange:et=>Fe(et.target.value),disabled:Oe,error:(Re=I.formState.errors.expire)==null?void 0:Re.message}),k.value?e(Cr,{children:D(T,{time:Te})}):null]})}}),e(Or,{children:(Et=I.formState.errors.expire)==null?void 0:Et.message})]})]}),s(L,{mb:"10px",children:[s(O,{justify:"space-between",align:"center",children:[e(C,{mb:0,children:D("userDialog.nextPlanTitle","Next plan")}),e(ot,{colorScheme:"primary",isChecked:ie,onChange:k=>Je(k.target.checked),isDisabled:Oe})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:D("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(Fs,{in:ie,animateOpacity:!0,style:{width:"100%"},children:s(le,{align:"stretch",spacing:3,mt:3,children:[s(w,{children:[e(C,{fontSize:"sm",children:D("userDialog.nextPlanDataLimit","Next plan data limit")}),e($t,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",disabled:Oe,value:oe!==null&&typeof oe<"u"?String(oe):"",onChange:k=>{const T=k.target.value;if(!T){I.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Te=Number(T);Number.isNaN(Te)||I.setValue("next_plan_data_limit",Math.max(0,Te),{shouldDirty:!0})}})]}),s(w,{children:[e(C,{fontSize:"sm",children:D("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(st,{control:I.control,name:"next_plan_expire",render:({field:k})=>{const T=Te=>{if(!Te){te(null),k.onChange(null);return}const Fe=Number(Te);if(Number.isNaN(Fe)||Fe<0)return;const Re=Math.min(Math.round(Fe),3650);te(Re);const et=se(Re);k.onChange(et)};return e($t,{endAdornment:D("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof ue=="number"?String(ue):"",onChange:Te=>T(Te.target.value),disabled:Oe})}})]}),s(O,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:D("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(ot,{size:"sm",colorScheme:"primary",isChecked:Boolean(fe),onChange:k=>I.setValue("next_plan_add_remaining_traffic",k.target.checked,{shouldDirty:!0}),isDisabled:Oe})]}),s(O,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:D("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(ot,{size:"sm",colorScheme:"primary",isChecked:Boolean(dt),onChange:k=>I.setValue("next_plan_fire_on_either",k.target.checked,{shouldDirty:!0}),isDisabled:Oe})]})]})})]}),s(w,{mb:"10px",isInvalid:!!I.formState.errors.note,children:[e(C,{children:D("userDialog.note")}),e(fr,{...I.register("note")}),e(Or,{children:($=(rr=I.formState.errors)==null?void 0:rr.note)==null?void 0:$.message})]})]}),z&&s(br,{status:"error",display:{base:"none",md:"flex"},children:[e(yr,{}),z]})]})}),Ee&&e(ms,{mt:Y?0:4,children:s(w,{isRequired:!g,children:[e(C,{children:D("userDialog.selectServiceLabel","Service")}),N?s(O,{spacing:2,py:4,children:[e(xt,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:D("loading")})]}):F?s(le,{align:"stretch",spacing:3,children:[g&&ve&&s(L,{role:"button",tabIndex:Oe?-1:0,"aria-pressed":M===null,onKeyDown:k=>{Oe||(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),E(null))},onClick:()=>{Oe||E(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:M===null?"primary.500":"gray.200",bg:M===null?"primary.50":"transparent",cursor:Oe?"not-allowed":"pointer",pointerEvents:Oe?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Oe?{}:{borderColor:M===null?"primary.500":"gray.300"},_dark:{borderColor:M===null?"primary.400":"gray.700",bg:M===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:D("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:D("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),j.map(k=>{const T=M===k.id;return e(L,{role:"button",tabIndex:Oe?-1:0,"aria-pressed":T,onKeyDown:Te=>{Oe||(Te.key==="Enter"||Te.key===" ")&&(Te.preventDefault(),E(k.id))},onClick:()=>{Oe||E(k.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:T?"primary.500":"gray.200",bg:T?"primary.50":"transparent",cursor:Oe?"not-allowed":"pointer",pointerEvents:Oe?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Oe?{}:{borderColor:T?"primary.500":"gray.300"},_dark:{borderColor:T?"primary.400":"gray.700",bg:T?"primary.900":"transparent"},children:s(O,{justify:"space-between",align:"flex-start",children:[s(le,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:k.name}),k.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:k.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:D("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:k.host_count,users:k.user_count})})]})},k.id)})]}):s(br,{status:"warning",borderRadius:"md",children:[e(yr,{}),D("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),ce&&e(Cr,{mt:2,children:D("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:ce.host_count,users:ce.user_count})})]})}),g&&Se&&e(ms,{pt:6,colSpan:{base:1,md:Ee?2:1},children:s(le,{gap:4,children:[e(mu,{defaultValue:ee,onChange:(k,T)=>{Pe(k),Be(T)}}),e(L,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(Hr,{options:x.options,series:x.series,type:"donut"})})]})})]}),z&&s(br,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(yr,{}),z]})]}),e(_t,{mt:"3",children:s(O,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(O,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:g&&s(Rt,{children:[e(at,{label:D("delete"),placement:"top",children:e(Ne,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),lt()},children:e(En,{})})}),e(at,{label:D("userDialog.usage"),placement:"top",children:e(Ne,{"aria-label":"usage",size:"sm",onClick:ge,children:e(bu,{})})}),e(G,{onClick:At,size:"sm",children:D("userDialog.resetUsage")}),e(G,{onClick:Ze,size:"sm",children:D("userDialog.revokeSubscription")})]})}),e(O,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(G,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:y?e(xt,{size:"xs"}):void 0,disabled:Oe,children:D(g?"userDialog.editUser":"createUser")})})]})})]})}),b&&s(St,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(Ss,{color:"primary",children:e(yu,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:D("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:A&&A>0?D("userDialog.limitReachedBody",{limit:A,active:v!=null?v:A}):D("userDialog.limitReachedContent")})]})]})})]})},wu=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),vu=t=>{if(!t)return null;const n=new Date(`${t}Z`);return Math.floor(n.getTime()/1e3)},zi=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),r=vu(t);return!t||r===null?e(L,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):n-r<=60?e(L,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(L,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Cu=t=>{if(!t)return null;const n=new Date(t+"Z");return Math.floor(n.getTime()/1e3)},Ri=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),r=Cu(t),l=r?n-r:null,o=r?fa(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${o.time} ago`:o.time})},Da=({expiryDate:t,status:n,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=He(),a=fa(t),c=gs[n].icon;return s(Rt,{children:[s(Kr,{colorScheme:gs[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),l&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[n&&i(`status.${n}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},_u=Z(wu),Gs={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Du=Z(zo,Gs),Au=Z(pa,Gs),Ui=Z(ua,Gs),Iu=Z(Ro,Gs),Tu=Z(Po,Gs),Pu=Z(ls,Gs),Eu=Z(pa,{baseStyle:{width:"15px",height:"15px"}}),Nu=t=>{for(var n=0;n<Fa.length;n++){const r=Fa[n];if(r.value==t)return r.title}return"No"},zu=t=>{const{used:n,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o}=t,i=r===0||r===null;return e(O,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:s(h,{children:[qe(n)," /"," ",i?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):qe(r)]})})},Li=t=>{const{used:n,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o,...i}=t,a=r===0||r===null,c=!a&&n/r*100>=100;return s(Rt,{children:[e(mc,{orientation:"horizontal",value:a?100:Math.min(n/r*100,100),colorScheme:c?"red":"primary",...i,children:e(gc,{h:"6px",borderRadius:"full",children:e(fc,{borderRadius:"full"})})}),s(O,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[s(h,{children:[qe(n)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):qe(r)+(l&&l!=="no_reset"?" "+Xr("userDialog.resetStrategy"+Nu(l)):"")]}),s(h,{children:[Xr("usersTable.total"),": ",qe(o)]})]})]})},tn=({sort:t,column:n})=>t.includes(n)?e(Eu,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,Ru=t=>{const{filters:n,users:{users:r,total:l},onEditingUser:o,onFilterChange:i}=ht(),{t:a}=He(),[c,u]=d.exports.useState(void 0),p=ur({base:!1,md:!0}),g=r.length!==l,f=b=>{let y=n.sort;y.includes(b)?y.startsWith("-")?y="-created_at":y="-"+b:y=b,i({sort:y})},A=b=>{i({status:b.target.value.length>0?b.target.value:void 0})},v=b=>{u(b===c?void 0:b)};return s(L,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(Uo,{allowMultiple:!0,display:{base:"block",md:"none"},index:c,children:s(ys,{orientation:"vertical",zIndex:"docked",...t,children:[e(Wr,{zIndex:"docked",position:"relative",children:s(Ct,{children:[e(Le,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:f.bind(null,"username"),children:s(O,{children:[e("span",{children:a("users")}),e(tn,{sort:n.sort,column:"username"})]})}),e(Le,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:s(O,{spacing:0,position:"relative",children:[s(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[a("usersTable.status"),n.status?": "+n.status:""]}),s(Ye,{value:n.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Rt,{}),_focusVisible:{border:"0 !important"},onChange:A,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Le,{minW:"100px",cursor:"pointer",pr:0,onClick:f.bind(null,"used_traffic"),children:s(O,{children:[e("span",{children:a("usersTable.dataUsage")}),e(tn,{sort:n.sort,column:"used_traffic"})]})}),e(Le,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(Nr,{children:!p&&(r==null?void 0:r.map((b,y)=>{var _;return s(d.exports.Fragment,{children:[s(Ct,{onClick:v.bind(null,y),cursor:"pointer",children:[e(ze,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:s("div",{className:"flex-status",children:[e(zi,{lastOnline:b.online_at}),e(h,{isTruncated:!0,children:b.username})]})}),e(ze,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Da,{compact:!0,showDetail:!1,expiryDate:b.expire,status:b.status})}),e(ze,{borderBottom:0,minW:"100px",pr:0,children:e(zu,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:gs[b.status].bandWidthColor})}),e(ze,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Au,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:c===y?"rotate(180deg)":"0deg"})})]}),e(Ct,{className:"collapsible",onClick:v.bind(null,y),children:e(ze,{p:0,colSpan:4,children:s(Lo,{border:0,children:[e(Mo,{display:"none"}),e(Oo,{border:0,cursor:"pointer",px:6,py:3,children:s(le,{justifyContent:"space-between",spacing:"4",children:[s(le,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:a("usersTable.dataUsage")}),e(L,{width:"full",minW:"230px",children:e(Li,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:gs[b.status].bandWidthColor})})]}),s(le,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:a("usersTable.service","Service")}),e(h,{fontSize:"sm",color:b.service_name?"gray.700":"gray.500",_dark:{color:b.service_name?"gray.200":"gray.500"},children:(_=b.service_name)!=null?_:a("usersTable.defaultService","Default")})]}),s(O,{w:"full",justifyContent:"space-between",children:[s(L,{width:"full",children:[e(Da,{compact:!0,expiryDate:b.expire,status:b.status}),e(Ri,{lastOnline:b.online_at})]}),s(O,{children:[e(Mi,{user:b}),e(at,{label:a("userDialog.editUser"),placement:"top",children:e(Ne,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:z=>{z.stopPropagation(),o(b)},children:e(Pu,{})})})]})]})]})})]})})})]},b.username)}))})]})}),s(ys,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(Wr,{position:"relative",zIndex:"docked",children:s(Ct,{children:[e(Le,{minW:"140px",cursor:"pointer",onClick:f.bind(null,"username"),children:s(O,{children:[e("span",{children:a("username")}),e(tn,{sort:n.sort,column:"username"})]})}),e(Le,{width:"400px",minW:"150px",cursor:"pointer",children:s(O,{position:"relative",gap:"5px",children:[s(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[a("usersTable.status"),n.status?": "+n.status:""]}),e(h,{children:"/"}),e(tn,{sort:n.sort,column:"expire"}),e(O,{onClick:f.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),s(Ye,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Rt,{}),_focusVisible:{border:"0 !important"},value:n.sort,onChange:A,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Le,{minW:"150px",children:e("span",{children:a("usersTable.service","Service")})}),e(Le,{width:"350px",minW:"230px",cursor:"pointer",onClick:f.bind(null,"used_traffic"),children:s(O,{children:[e("span",{children:a("usersTable.dataUsage")}),e(tn,{sort:n.sort,column:"used_traffic"})]})}),e(Le,{width:"200px",minW:"180px"})]})}),s(Nr,{children:[p&&(r==null?void 0:r.map((b,y)=>{var _;return s(Ct,{className:Ga("interactive",{"last-row":y===r.length-1}),onClick:()=>o(b),children:[e(ze,{minW:"140px",children:s("div",{className:"flex-status",children:[e(zi,{lastOnline:b.online_at}),b.username,e(Ri,{lastOnline:b.online_at})]})}),e(ze,{width:"400px",minW:"150px",children:e(Da,{expiryDate:b.expire,status:b.status})}),e(ze,{minW:"150px",children:e(h,{fontSize:"sm",color:b.service_name?"gray.700":"gray.500",_dark:{color:b.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(_=b.service_name)!=null?_:a("usersTable.defaultService","Default")})}),e(ze,{width:"350px",minW:"230px",children:e(Li,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:gs[b.status].bandWidthColor})}),e(ze,{width:"200px",minW:"180px",children:e(Mi,{user:b})})]},b.username)})),r.length==0&&e(Ct,{children:e(ze,{colSpan:4,children:e(Uu,{isFiltered:g})})})]})]})]})},Mi=({user:t})=>{const{setQRCode:n,setSubLink:r}=ht(),l=t.links.join(`\r
`),[o,i]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{o[1]&&setTimeout(()=>{i([-1,!1])},1e3)},[o]),s(O,{justifyContent:"flex-end",onClick:a=>{a.preventDefault(),a.stopPropagation()},children:[e(pi,{text:t.subscription_url.startsWith("/")?window.location.origin+t.subscription_url:t.subscription_url,onCopy:()=>{i([0,!0])},children:e("div",{children:e(at,{label:o[0]==0&&o[1]?Xr("usersTable.copied"):Xr("usersTable.copyLink"),placement:"top",children:e(Ne,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==0&&o[1]?e(Ui,{}):e(Iu,{})})})})}),e(pi,{text:l,onCopy:()=>{i([1,!0])},children:e("div",{children:e(at,{label:o[0]==1&&o[1]?Xr("usersTable.copied"):Xr("usersTable.copyConfigs"),placement:"top",children:e(Ne,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==1&&o[1]?e(Ui,{}):e(Du,{})})})})}),e(at,{label:"QR Code",placement:"top",children:e(Ne,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{n(t.links),r(t.subscription_url)},children:e(Tu,{})})})]})},Uu=({isFiltered:t})=>{const{onCreateUser:n}=ht();return s(L,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(_u,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Xr("usersTable.noUserMatched"):Xr("usersTable.noUser")}),!t&&e(G,{size:"sm",colorScheme:"primary",onClick:()=>n(!0),children:Xr("createUser")})]})},Lu=()=>{const{t}=He();return d.exports.useEffect(()=>{ht.getState().refetchUsers(),kn()},[]),s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(Zo,{}),e(Ru,{}),e(jo,{}),e(ku,{}),e(Kd,{}),e(au,{}),e(ou,{}),e(cu,{})]})},Zt=(t,n,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return n({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return n({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},qt=(t,n)=>n({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),Mu=()=>{var se,W,Q,ue,te;const{t}=He(),n=Ut(),{adminInDialog:r,isAdminDialogOpen:l,closeAdminDialog:o,createAdmin:i,updateAdmin:a}=ss(),c=d.exports.useMemo(()=>r?"edit":"create",[r]),u=d.exports.useMemo(()=>Ie.object({username:c==="create"?Ie.string().trim().min(3,{message:t("admins.validation.usernameMin")}):Ie.string().optional(),password:Ie.string().trim().optional().transform(N=>N===""?void 0:N).refine(N=>!N||N.length>=6,t("admins.validation.passwordMin")),telegram_id:Ie.string().trim().optional().transform(N=>N===""?void 0:N).refine(N=>N===void 0||/^\d+$/.test(N),t("admins.validation.telegramNumeric")),is_sudo:Ie.boolean().optional(),data_limit:Ie.string().trim().optional().transform(N=>N===""?void 0:N).refine(N=>N===void 0||/^\d+$/.test(N),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:Ie.string().trim().optional().transform(N=>N===""?void 0:N).refine(N=>N===void 0||/^\d+$/.test(N),t("admins.validation.usersLimitNumeric","Users limit must be a number"))}).superRefine((N,he)=>{c==="create"&&!N.password&&he.addIssue({code:Ie.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[c,t]),p=_r({resolver:ha(u),defaultValues:{username:"",password:"",telegram_id:"",is_sudo:!1,data_limit:"",users_limit:""}}),{register:g,handleSubmit:f,reset:A,formState:v,setValue:b,watch:y,setError:_}=p,z=g("is_sudo"),[U,re]=d.exports.useState(!1),D=d.exports.useCallback(j=>{var Ae;const N="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",he=N.length;if(typeof window<"u"&&((Ae=window.crypto)==null?void 0:Ae.getRandomValues)){const ve=new Uint32Array(j);return window.crypto.getRandomValues(ve),Array.from(ve,M=>N[M%he]).join("")}return Array.from({length:j},()=>{const ve=Math.floor(Math.random()*he);return N[ve]}).join("")},[]),B=d.exports.useCallback(()=>{if(c==="edit")return;const j=D(8);b("username",j,{shouldDirty:!0,shouldValidate:!0})},[D,c,b]),I=d.exports.useCallback(()=>{const j=D(12);b("password",j,{shouldDirty:!0,shouldValidate:!0})},[D,b]),{errors:P,isSubmitting:_e}=v;d.exports.useEffect(()=>{var j,N;l&&A({username:(j=r==null?void 0:r.username)!=null?j:"",password:"",telegram_id:(r==null?void 0:r.telegram_id)!==void 0&&(r==null?void 0:r.telegram_id)!==null?String(r.telegram_id):"",is_sudo:(N=r==null?void 0:r.is_sudo)!=null?N:!1,data_limit:(r==null?void 0:r.data_limit)!==void 0&&(r==null?void 0:r.data_limit)!==null?String(Math.floor(r.data_limit/(1024*1024*1024))):"",users_limit:(r==null?void 0:r.users_limit)!==void 0&&(r==null?void 0:r.users_limit)!==null?String(r.users_limit):""})},[r,l,A]);const me=f(async j=>{var N,he,Ae,ve;if(c==="edit"&&r){const M=(N=r.active_users)!=null?N:0;if(j.users_limit){const E=Number(j.users_limit);if(!Number.isNaN(E)&&E>0&&E<M){_("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:M})});return}}}try{if(c==="create"){const M={username:j.username.trim(),password:(he=j.password)!=null?he:"",is_sudo:(Ae=j.is_sudo)!=null?Ae:!1,telegram_id:j.telegram_id?Number(j.telegram_id):void 0,data_limit:j.data_limit?Number(j.data_limit)*1024*1024*1024:void 0,users_limit:j.users_limit?Number(j.users_limit):void 0};await i(M),qt(t("admins.createSuccess","Admin created"),n)}else if(r){const M={is_sudo:(ve=j.is_sudo)!=null?ve:!1,telegram_id:j.telegram_id?Number(j.telegram_id):void 0,data_limit:j.data_limit?Number(j.data_limit)*1024*1024*1024:void 0,users_limit:j.users_limit?Number(j.users_limit):void 0};j.password&&(M.password=j.password),await a(r.username,M),qt(t("admins.updateSuccess","Admin updated"),n)}o()}catch(M){Zt(M,n,p)}});return s(It,{isOpen:l,onClose:o,size:"lg",children:[e(pt,{}),s(Tt,{children:[e(gt,{children:c==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Dt,{}),e(mt,{children:s(le,{spacing:4,align:"stretch",children:[s(w,{isInvalid:!!P.username,children:[e(C,{children:t("username")}),s(hr,{children:[e(be,{placeholder:t("admins.usernamePlaceholder","Admin username"),...g("username"),isDisabled:c==="edit"}),c==="create"&&e(xr,{children:e(Ne,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(aa,{width:20}),onClick:B})})]}),e(Or,{children:(se=P.username)==null?void 0:se.message})]}),s(w,{isInvalid:!!P.password,children:[e(C,{children:t("password")}),s(O,{spacing:2,children:[s(hr,{children:[e(be,{placeholder:t("admins.passwordPlaceholder","Password"),type:U?"text":"password",...g("password")}),e(xr,{children:e(Ne,{"aria-label":U?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:U?e(Xa,{width:16}):e(yn,{width:16}),onClick:()=>re(!U)})})]}),e(Ne,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(aa,{width:20}),onClick:I})]}),e(Or,{children:(W=P.password)==null?void 0:W.message}),c==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),e(w,{display:"flex",alignItems:"center",children:s(le,{align:"start",spacing:1,w:"full",children:[s(O,{justify:"space-between",w:"full",children:[e(C,{htmlFor:"is_sudo",mb:"0",children:t("admins.sudoAccess","Sudo access")}),e(ot,{id:"is_sudo",isChecked:y("is_sudo"),onChange:j=>b("is_sudo",j.target.checked,{shouldDirty:!0}),onBlur:z.onBlur,ref:z.ref})]}),e(h,{fontSize:"xs",color:"gray.500",children:t("admins.sudoDescription","Sudo admins can manage other admins.")})]})}),s(w,{isInvalid:!!P.telegram_id,children:[e(C,{children:t("admins.telegramId","Telegram ID")}),e(be,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...g("telegram_id")}),e(Or,{children:(Q=P.telegram_id)==null?void 0:Q.message})]}),s(w,{isInvalid:!!P.data_limit,children:[e(C,{children:t("admins.dataLimit","Data Limit (GB)")}),e(be,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...g("data_limit")}),e(Or,{children:(ue=P.data_limit)==null?void 0:ue.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),s(w,{isInvalid:!!P.users_limit,children:[e(C,{children:t("admins.usersLimit","Users Limit")}),e(be,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...g("users_limit")}),e(Or,{children:(te=P.users_limit)==null?void 0:te.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})}),e(_t,{children:s(O,{spacing:3,children:[e(G,{variant:"ghost",onClick:o,children:t("cancel")}),e(G,{colorScheme:"primary",onClick:me,isLoading:_e,children:c==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]})},Ou=()=>{var j;const{t}=He(),n=Ut(),r=Qe("gray.50","whiteAlpha.100"),l=Qe("primary.50","primary.900"),{admins:o,loading:i,total:a,filters:c,onFilterChange:u,fetchAdmins:p,deleteAdmin:g,resetUsage:f,disableUsers:A,activateUsers:v,openAdminDialog:b,openAdminDetails:y,adminInDetails:_}=ss(),z=d.exports.useRef(null),{isOpen:U,onOpen:re,onClose:D}=Yt(),[B,I]=d.exports.useState(null),[P,_e]=d.exports.useState(null),me=N=>{if(N==="data_usage"||N==="data_limit"){const he=c.sort===N?`-${N}`:N;u({sort:he,offset:0})}else{const he=c.sort===N?`-${N}`:c.sort===`-${N}`?void 0:N;u({sort:he,offset:0})}},se=N=>{I(N),re()},W=async()=>{if(!!B)try{await g(B.username),qt(t("admins.deleteSuccess","Admin removed"),n),D(),I(null)}catch(N){Zt(N,n)}},Q=async(N,he)=>{_e({type:N,username:he.username});try{N==="reset"?(await f(he.username),qt(t("admins.resetUsageSuccess","Usage reset"),n)):N==="disable"?(await A(he.username),qt(t("admins.disableUsersSuccess","Users disabled"),n)):N==="activate"&&(await v(he.username),qt(t("admins.activateUsersSuccess","Users activated"),n)),p()}catch(Ae){Zt(Ae,n)}finally{_e(null)}},ue=({column:N})=>{var ve,M,E,F,ce;let he=!1,Ae=!1;return N==="data"?(he=((ve=c.sort)==null?void 0:ve.includes("data_usage"))||((M=c.sort)==null?void 0:M.includes("data_limit")),Ae=he&&((E=c.sort)==null?void 0:E.startsWith("-"))):(he=(F=c.sort)==null?void 0:F.includes(N),Ae=he&&((ce=c.sort)==null?void 0:ce.startsWith("-"))),e(pa,{style:{width:"1rem",height:"1rem",opacity:he?1:0,transform:he&&!Ae?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},te=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return i&&!o.length?e(L,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(xt,{})}):a?s(Rt,{children:[e(L,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:s(ys,{variant:"simple",size:"sm",minW:"640px",children:[e(Wr,{children:e(Ct,{children:te.map(N=>e(Le,{onClick:()=>N.key==="username"||N.key==="users_count"||N.key==="data"?me(N.key):void 0,cursor:N.key==="username"||N.key==="users_count"||N.key==="data"?"pointer":"default",textAlign:N.key==="actions"?"right":"left",children:s(O,{justify:N.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:N.label}),N.key==="data"?s(ra,{children:[e(sa,{as:Ne,size:"xs",variant:"ghost",icon:e(ue,{column:"data"})}),s(na,{children:[e(jt,{onClick:()=>me("data_usage"),children:t("admins.sortByUsage")}),e(jt,{onClick:()=>me("data_limit"),children:t("admins.sortByLimit")})]})]}):N.key==="username"||N.key==="users_count"?e(ue,{column:N.key}):null]})},N.key))})}),e(Nr,{children:o.map(N=>{var M,E;const he=(_==null?void 0:_.username)===N.username,Ae=N.users_limit&&N.users_limit>0?String(N.users_limit):"\u221E",ve=`${(M=N.active_users)!=null?M:0}/${Ae}`;return s(Ct,{onClick:()=>y(N),cursor:"pointer",bg:he?l:void 0,_hover:{bg:r},transition:"background-color 0.15s ease-in-out",children:[s(ze,{children:[e(h,{fontWeight:"medium",children:N.username}),N.is_sudo&&e(Kr,{colorScheme:"purple",fontSize:"xs",mt:1,children:t("sudo")})]}),e(ze,{children:s(h,{whiteSpace:"nowrap",children:[qe((E=N.users_usage)!=null?E:0,2)," /"," ",N.data_limit?qe(N.data_limit,2):"-"]})}),e(ze,{children:s(xe,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:ve})]})}),e(ze,{textAlign:"right",children:s(ra,{children:[e(sa,{as:Ne,icon:e(bc,{width:20}),variant:"ghost",onClick:F=>F.stopPropagation()}),s(na,{onClick:F=>F.stopPropagation(),children:[e(jt,{icon:e(ls,{width:20}),onClick:F=>{F.stopPropagation(),b(N)},children:t("edit")}),e(jt,{icon:e($r,{width:20}),onClick:F=>{F.stopPropagation(),Q("reset",N)},isDisabled:(P==null?void 0:P.username)===N.username,children:t("admins.resetUsage")}),e(ia,{}),e(jt,{icon:e(yc,{width:20}),onClick:F=>{F.stopPropagation(),Q("activate",N)},isDisabled:(P==null?void 0:P.username)===N.username,children:t("admins.activateUsers")}),e(jt,{icon:e(Sc,{width:20}),onClick:F=>{F.stopPropagation(),Q("disable",N)},isDisabled:(P==null?void 0:P.username)===N.username,children:t("admins.disableUsers")}),e(ia,{}),e(jt,{color:"red.500",icon:e(Vr,{width:20}),onClick:F=>{F.stopPropagation(),se(N)},children:t("delete")})]})]})})]},N.username)})})]})}),e(Sn,{isOpen:U,leastDestructiveRef:z,onClose:D,children:e(pt,{children:s(xn,{children:[e(gt,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(mt,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(j=B==null?void 0:B.username)!=null?j:""})}),s(_t,{children:[e(G,{ref:z,onClick:D,children:t("cancel")}),e(G,{colorScheme:"red",onClick:W,ml:3,children:t("delete")})]})]})})})]}):e(L,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},Wu=(t,n)=>!t||t<=0?n!=null?n:"\u221E":`${t}`,Aa=(t,n)=>!t||t<=0?n!=null?n:"\u221E":qe(t,2),Fu=()=>{var z,U,re,D,B,I,P,_e,me,se;const{t}=He(),{isAdminDetailsOpen:n,adminInDetails:r,closeAdminDetails:l}=ss(W=>({isAdminDetailsOpen:W.isAdminDetailsOpen,adminInDetails:W.adminInDetails,closeAdminDetails:W.closeAdminDetails})),o=Qe("gray.50","whiteAlpha.50"),i=(z=r==null?void 0:r.active_users)!=null?z:0,a=(U=r==null?void 0:r.users_limit)!=null?U:null,c=t("admins.details.unlimited","Unlimited"),u=a&&a>0?String(a):c,p=(re=r==null?void 0:r.users_count)!=null?re:0,g=(D=r==null?void 0:r.limited_users)!=null?D:0,f=(B=r==null?void 0:r.expired_users)!=null?B:0,A=(I=r==null?void 0:r.online_users)!=null?I:0,v=(P=r==null?void 0:r.users_usage)!=null?P:0,b=(_e=r==null?void 0:r.data_limit)!=null?_e:null,y=b&&b>0?Math.max(b-v,0):null,_=(me=r==null?void 0:r.lifetime_usage)!=null?me:null;return s(Co,{isOpen:n,placement:"right",size:"md",onClose:l,children:[e(pt,{}),s(_o,{children:[e(Dt,{}),e(gt,{bg:o,children:s(xe,{spacing:1,children:[s(O,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(se=r==null?void 0:r.username)!=null?se:t("admins.details.title","Admin details")}),(r==null?void 0:r.is_sudo)&&e(L,{as:"span",fontSize:"xs",px:2,py:.5,borderRadius:"full",bg:"purple.500",color:"white",children:t("admins.sudoBadge","Sudo")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:i,limit:u})})]})}),e(mt,{children:r?s(xe,{spacing:8,children:[s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),s(Ve,{columns:{base:2,md:3},spacing:4,children:[e(Ur,{label:t("admins.details.activeLabel","Active"),value:String(i)}),e(Ur,{label:t("admins.details.onlineLabel","Online"),value:String(A)}),e(Ur,{label:t("admins.details.limitedLabel","Limited"),value:String(g)}),e(Ur,{label:t("admins.details.expiredLabel","Expired"),value:String(f)}),e(Ur,{label:t("admins.details.totalUsers","Total users"),value:String(p)}),e(Ur,{label:t("admins.details.usersLimit","Users limit"),value:Wu(a,c)})]})]}),s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),s(Ve,{columns:{base:2,md:4},spacing:4,children:[e(Ur,{label:t("admins.details.used","Used"),value:qe(v,2)}),e(Ur,{label:t("admins.details.limit","Limit"),value:Aa(b,c)}),e(Ur,{label:t("admins.details.remaining","Remaining"),value:Aa(y,c)}),e(Ur,{label:t("admins.details.lifetime","Lifetime usage"),value:Aa(_,void 0)})]})]})]}):e(L,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(_t,{children:e(G,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},Ur=({label:t,value:n})=>s(L,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:n})]}),Hu=()=>{const{t}=He(),n=ss(i=>i.fetchAdmins),{userData:r,getUserIsSuccess:l}=vs(),o=l&&r.is_sudo;return d.exports.useEffect(()=>{o&&n()},[n,o]),o?s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(Zo,{for:"admins"}),e(Ou,{}),e(jo,{for:"admins"}),e(Mu,{}),e(Fu,{})]}):s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},el=Ks(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),Ce("/hosts").then(n=>t({hosts:n})).finally(()=>t({isLoading:!1}))},setHosts:n=>(t({isPostLoading:!0}),Ce("/hosts",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})}))})),Bu=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Vu=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],$u=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Ku=Z(ls,{baseStyle:{w:4,h:4}}),tl=Z(ts,{baseStyle:{w:4,h:4}}),rl=Z(vo,{baseStyle:{w:4,h:4}}),Ju=Z(Cn,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),qu=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],Ws=()=>{const{t}=He();return s(_n,{isLazy:!0,placement:"right",children:[e(Dn,{children:e(L,{mt:"-1",children:e(Ju,{})})}),e(kc,{children:s(An,{maxW:"xs",fontSize:"xs",children:[e(In,{}),e(Fo,{}),e(Tn,{children:s(L,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),qu.map(({token:n,labelKey:r})=>s(h,{mt:1,children:[e(Kr,{mr:2,children:n}),t(r)]},n))]})})]})})]})},sl=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,vr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,Fr=t=>(t!=null?t:"").trim(),rn=(t,n=!1)=>typeof t=="boolean"?t:n,Yu=(t,n)=>{var r,l,o,i,a,c,u,p;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(o=t.address)!=null?o:"",sort:(i=t.sort)!=null?i:n,port:(a=t.port)!=null?a:null,path:Fr(t.path),sni:Fr(t.sni),host:Fr(t.host),mux_enable:rn(t.mux_enable),allowinsecure:rn(t.allowinsecure),is_disabled:rn(t.is_disabled,!1),fragment_setting:Fr(t.fragment_setting),noise_setting:Fr(t.noise_setting),random_user_agent:rn(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:rn(t.use_sni_as_host)}},Ha=t=>{var n,r;return{id:(n=t.id)!=null?n:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},Oi=t=>{var n,r;return{...t,id:(n=t.id)!=null?n:null,port:(r=t.port)!=null?r:null,path:Fr(t.path),sni:Fr(t.sni),host:Fr(t.host),fragment_setting:Fr(t.fragment_setting),noise_setting:Fr(t.noise_setting)}},nl=t=>{const n=Oi(t.data),r=Oi(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(n)!==JSON.stringify(r)},Gu=t=>{var n;return{id:(n=t.id)!=null?n:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},pn=t=>[...t].sort((n,r)=>{const l=vr(n.data.sort)-vr(r.data.sort);return l!==0?l:n.data.remark.localeCompare(r.data.remark)}),Xu=t=>{const n=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((o,i)=>{const a=Yu(o,i),c=a.id!=null?`host-${a.id}`:sl();n.push({uid:c,inboundTag:r,initialInboundTag:r,data:Ha(a),original:Ha(a)})})}),pn(n)},al=t=>{const n=new Map;t.forEach(l=>{var i;const o=(i=n.get(l.inboundTag))!=null?i:[];o.push(l.data),n.set(l.inboundTag,o)});const r={};return n.forEach((l,o)=>{r[o]=l.map(i=>Gu(i)).sort((i,a)=>vr(i.sort)-vr(a.sort))}),r},Ia=(t,n)=>{const r=al(t),l=Array.from(new Set(n)),o={};return l.forEach(i=>{var a;o[i]=(a=r[i])!=null?a:[]}),o},Qu=({host:t,inboundOptions:n,orderIndex:r,onToggleActive:l,onEdit:o,onDelete:i,saving:a,deleting:c})=>{const{t:u}=He(),p=n.find(v=>v.value===t.inboundTag),g=!t.data.is_disabled,f=nl(t),A=t.data.remark||u("hostsPage.untitledHost");return e(Br,{borderWidth:"1px",borderColor:f?"primary.400":"gray.200",_dark:{borderColor:f?"primary.300":"gray.700",bg:f?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>o(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:s(Zr,{as:xe,spacing:4,children:[s(O,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(le,{align:"flex-start",spacing:1,flex:"1",children:[e(at,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:A})}),s(O,{spacing:2,flexWrap:"wrap",children:[e(nt,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),p&&e(nt,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(nt,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),f&&e(nt,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),s(O,{spacing:2,children:[e(ot,{size:"sm",colorScheme:"primary",isChecked:g,onChange:v=>{v.stopPropagation(),l(t.uid,v.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(g?"hostsPage.enabled":"hostsPage.disabled")})]})]}),s(le,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),s(O,{justify:"space-between",children:[e(G,{size:"sm",variant:"outline",leftIcon:e(Ku,{}),onClick:v=>{v.stopPropagation(),o(t.uid)},isLoading:a,children:u("hostsPage.edit")}),e(Ne,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:v=>{v.stopPropagation(),i(t.uid)},icon:e(En,{}),isLoading:c})]})]})})},Zu=({host:t,index:n})=>{const{t:r}=He(),l=xc(),o=t.data.remark||r("hostsPage.untitledHost"),i=d.exports.useCallback(a=>{a.pointerType==="mouse"&&a.button!==0||(a.preventDefault(),l.start(a))},[l]);return e(Wo.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:s(O,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(at,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(Ne,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(rl,{}),cursor:"grab",onPointerDown:i,style:{touchAction:"none"}})}),e(nt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:n+1})}),s(le,{align:"flex-start",spacing:0,flex:"1",children:[e(at,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:o})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},ju=({host:t,inboundOptions:n,isOpen:r,onClose:l,onChange:o,onChangeInbound:i,onSave:a,onReset:c,onDelete:u,saving:p,deleting:g})=>{var b;const{t:f}=He();if(!t)return null;const A=n.find(y=>y.value===t.inboundTag),v=nl(t);return s(It,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,children:[e(pt,{}),s(Tt,{children:[e(Dt,{}),e(gt,{pb:1,children:s(le,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||f("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||f("hostsPage.noAddress")}),A&&e(nt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${A.value} (${A.protocol.toUpperCase()} - ${A.network})`})]})}),e(mt,{children:s(le,{align:"stretch",spacing:5,children:[s(Br,{variant:"outline",children:[e(Ls,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.general")})}),e(Zr,{pt:0,children:s(le,{align:"stretch",spacing:4,children:[s(w,{children:[e(C,{children:f("hostsDialog.remark")}),s(hr,{children:[e(be,{value:t.data.remark,onChange:y=>o(t.uid,"remark",y.target.value)}),e(xr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:f("hostsPage.inboundLabel")}),e(Ye,{value:t.inboundTag,onChange:y=>i(t.uid,y.target.value),children:n.map(y=>e("option",{value:y.value,children:y.label},y.value))})]}),s(w,{children:[e(C,{children:f("hostsDialog.sort")}),e(bs,{value:t.data.sort,allowMouseWheel:!0,onChange:(y,_)=>o(t.uid,"sort",Number.isNaN(_)?t.data.sort:_),children:e(fs,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:f("hostsDialog.address")}),s(hr,{children:[e(be,{value:t.data.address,onChange:y=>o(t.uid,"address",y.target.value)}),e(xr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(w,{children:[e(C,{children:f("hostsDialog.port")}),e(bs,{value:(b=t.data.port)!=null?b:"",allowMouseWheel:!0,onChange:(y,_)=>o(t.uid,"port",Number.isNaN(_)?null:_),children:e(fs,{})})]})]}),s(w,{children:[e(C,{children:f("hostsDialog.path")}),e(be,{value:t.data.path,onChange:y=>o(t.uid,"path",y.target.value),placeholder:"/"})]})]})})]}),s(Br,{variant:"outline",children:[e(Ls,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.security")})}),e(Zr,{pt:0,children:s(le,{align:"stretch",spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:f("hostsDialog.sni")}),e(be,{value:t.data.sni,onChange:y=>o(t.uid,"sni",y.target.value)})]}),s(w,{children:[e(C,{children:f("hostsDialog.host")}),s(hr,{children:[e(be,{value:t.data.host,onChange:y=>o(t.uid,"host",y.target.value)}),e(xr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]})]}),s(Ve,{columns:{base:1,md:3},spacing:4,children:[s(w,{children:[e(C,{children:f("hostsDialog.security")}),e(Ye,{value:t.data.security,onChange:y=>o(t.uid,"security",y.target.value),children:Bu.map(y=>e("option",{value:y.value,children:y.title},y.value))})]}),s(w,{children:[e(C,{children:f("hostsDialog.alpn")}),e(Ye,{value:t.data.alpn,onChange:y=>o(t.uid,"alpn",y.target.value),children:Vu.map(y=>e("option",{value:y.value,children:y.title},y.value))})]}),s(w,{children:[e(C,{children:f("hostsDialog.fingerprint")}),e(Ye,{value:t.data.fingerprint,onChange:y=>o(t.uid,"fingerprint",y.target.value),children:$u.map(y=>e("option",{value:y.value,children:y.title},y.value))})]})]})]})})]}),s(Br,{variant:"outline",children:[e(Ls,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.advanced")})}),e(Zr,{pt:0,children:s(le,{align:"stretch",spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:f("hostsDialog.fragment")}),e(be,{value:t.data.fragment_setting,onChange:y=>o(t.uid,"fragment_setting",y.target.value)})]}),s(w,{children:[e(C,{children:f("hostsDialog.noise")}),e(be,{value:t.data.noise_setting,onChange:y=>o(t.uid,"noise_setting",y.target.value)})]})]}),s(xe,{direction:{base:"column",md:"row"},spacing:4,children:[e(Sr,{isChecked:t.data.allowinsecure,onChange:y=>o(t.uid,"allowinsecure",y.target.checked),children:f("hostsDialog.allowinsecure")}),e(Sr,{isChecked:t.data.mux_enable,onChange:y=>o(t.uid,"mux_enable",y.target.checked),children:f("hostsDialog.muxEnable")}),e(Sr,{isChecked:t.data.random_user_agent,onChange:y=>o(t.uid,"random_user_agent",y.target.checked),children:f("hostsDialog.randomUserAgent")}),e(Sr,{isChecked:t.data.use_sni_as_host,onChange:y=>o(t.uid,"use_sni_as_host",y.target.checked),children:f("hostsDialog.useSniAsHost")})]})]})})]})]})}),s(_t,{justifyContent:"space-between",children:[e(G,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(En,{}),onClick:()=>u(t.uid),isLoading:g,children:f("hostsPage.delete")}),s(O,{spacing:3,children:[e(G,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!v||p,children:f("hostsPage.reset")}),e(G,{size:"sm",colorScheme:"primary",onClick:()=>a(t.uid),isDisabled:!v,isLoading:p,children:f("hostsPage.save")})]})]})]})]})},eh=({isOpen:t,onClose:n,inboundOptions:r,onSubmit:l,isSubmitting:o,defaultSort:i})=>{var f,A,v,b;const{t:a}=He(),c=d.exports.useRef(null),[u,p]=d.exports.useState({inboundTag:(A=(f=r[0])==null?void 0:f.value)!=null?A:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var y,_;t&&(p({inboundTag:(_=(y=r[0])==null?void 0:y.value)!=null?_:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var z;return(z=c.current)==null?void 0:z.focus()},150))},[i,r,t]);const g=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return s(It,{isOpen:t,onClose:n,size:"lg",initialFocusRef:c,children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(Tt,{children:[e(gt,{children:s(O,{spacing:3,children:[e(tl,{}),e(h,{fontWeight:"semibold",children:a("hostsPage.create.title")})]})}),e(Dt,{mt:2}),s(mt,{as:le,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:a("hostsPage.create.description")}),s(w,{children:[e(C,{children:a("hostsPage.inboundLabel")}),e(Ye,{value:u.inboundTag,onChange:y=>p(_=>({..._,inboundTag:y.target.value})),children:r.map(y=>e("option",{value:y.value,children:y.label},y.value))})]}),s(w,{isRequired:!0,children:[e(C,{children:a("hostsDialog.remark")}),s(hr,{children:[e(be,{ref:c,value:u.remark,onChange:y=>p(_=>({..._,remark:y.target.value}))}),e(xr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{isRequired:!0,children:[e(C,{children:a("hostsDialog.address")}),s(hr,{children:[e(be,{value:u.address,onChange:y=>p(_=>({..._,address:y.target.value}))}),e(xr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(w,{children:[e(C,{children:a("hostsDialog.port")}),e(bs,{value:(v=u.port)!=null?v:"",onChange:(y,_)=>p(z=>({...z,port:Number.isNaN(_)?null:_})),children:e(fs,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("hostsDialog.path")}),e(be,{value:u.path,onChange:y=>p(_=>({..._,path:y.target.value}))})]}),s(w,{children:[e(C,{children:a("hostsDialog.sni")}),e(be,{value:u.sni,onChange:y=>p(_=>({..._,sni:y.target.value}))})]})]}),s(w,{children:[e(C,{children:a("hostsDialog.host")}),s(hr,{children:[e(be,{value:u.host,onChange:y=>p(_=>({..._,host:y.target.value}))}),e(xr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(w,{children:[e(C,{children:a("hostsDialog.sort")}),e(bs,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(y,_)=>p(z=>({...z,sort:Number.isNaN(_)?z.sort:_})),children:e(fs,{})})]}),e(L,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:a("hostsPage.create.sortHint",{value:(b=u.sort)!=null?b:i})})]}),s(_t,{gap:2,children:[e(G,{variant:"ghost",onClick:n,children:a("hostsPage.cancel")}),e(G,{colorScheme:"primary",onClick:g,isLoading:o,children:a("hostsPage.create.submit")})]})]})]})},th=()=>{var Je;const{t}=He(),n=Ut(),{hosts:r,fetchHosts:l,isLoading:o,isPostLoading:i,setHosts:a}=el(),{inbounds:c}=ht(),[u,p]=d.exports.useState([]),g=d.exports.useRef([]),f=d.exports.useCallback(q=>{typeof q=="function"?p(x=>{const R=q(x);return g.current=R,R}):(g.current=q,p(q))},[]),[A,v]=d.exports.useState(null),[b,y]=d.exports.useState(!1),[_,z]=d.exports.useState(!1),[U,re]=d.exports.useState(null),[D,B]=d.exports.useState(null),[I,P]=d.exports.useState(null),[_e,me]=d.exports.useState(null),se=d.exports.useRef(null),[W,Q]=d.exports.useState(!1),ue=d.exports.useRef(!1),[te,j]=d.exports.useState(!1),[N,he]=d.exports.useState(!1),[Ae,ve]=d.exports.useState(null);d.exports.useEffect(()=>{l()},[l]),d.exports.useEffect(()=>{c.size||kn()},[c]),d.exports.useEffect(()=>{const q=Xu(r);f(q)},[r,f]),d.exports.useEffect(()=>{if(_e){const q=g.current.find(x=>x.inboundTag===_e.inboundTag&&x.data.remark.trim()===_e.remark&&x.data.address.trim()===_e.address);q&&(v(q.uid),me(null))}},[u,_e]),d.exports.useEffect(()=>{A&&!g.current.some(q=>q.uid===A)&&!_e&&v(null)},[u,A,_e]);const M=d.exports.useCallback(q=>{ue.current=q,Q(q)},[]);d.exports.useEffect(()=>{N||(ve(null),M(!1))},[b,N,M]),d.exports.useEffect(()=>{if(!N||!Ae)return;const q=new Set(g.current.map(R=>R.uid));Ae.every(R=>q.has(R.uid))||(ve(null),M(!1))},[u,N,M,Ae]);const E=d.exports.useMemo(()=>{const q=[];return c.forEach(x=>{x.forEach(R=>{q.push({label:`${R.tag} (${R.protocol.toUpperCase()} - ${R.network})`,value:R.tag,protocol:R.protocol,network:R.network})})}),q.sort((x,R)=>x.label.localeCompare(R.label))},[c]),F=d.exports.useMemo(()=>g.current.filter(q=>!q.data.is_disabled).sort((q,x)=>vr(q.data.sort)-vr(x.data.sort)),[u]),ce=d.exports.useMemo(()=>[...g.current].sort((q,x)=>vr(q.data.sort)-vr(x.data.sort)),[u]),de=d.exports.useMemo(()=>b?ce:F,[F,ce,b]);d.exports.useEffect(()=>{N&&ve(q=>q!=null?q:[...F])},[F,N]);const De=N?Ae!=null?Ae:F:de,Ee=d.exports.useMemo(()=>{const q=new Map;return De.forEach((x,R)=>q.set(x.uid,R)),q},[De]),Y=A&&(Je=g.current.find(q=>q.uid===A))!=null?Je:null,we=(q,x,R)=>{f(ee=>pn(ee.map(Pe=>Pe.uid===q?{...Pe,data:{...Pe.data,[x]:R}}:Pe)))},J=(q,x)=>{f(R=>pn(R.map(ee=>ee.uid===q?{...ee,inboundTag:x}:ee)))},Se=d.exports.useCallback(async()=>{if(!N||te)return!1;const q=F,x=Ae!=null?Ae:q;if(!(x.length!==q.length||x.some((Ze,Oe)=>{var kt;return Ze.uid!==((kt=q[Oe])==null?void 0:kt.uid)}))||!Ae||x.length===0)return he(!1),ve(null),M(!1),!0;const ee=x.map(Ze=>Ze.uid),Pe=new Map;ee.forEach((Ze,Oe)=>Pe.set(Ze,Oe));const Be=g.current,rt=g.current.filter(Ze=>Pe.has(Ze.uid)).sort((Ze,Oe)=>{var kt,zt;return((kt=Pe.get(Ze.uid))!=null?kt:Number.MAX_SAFE_INTEGER)-((zt=Pe.get(Oe.uid))!=null?zt:Number.MAX_SAFE_INTEGER)}),lt=g.current.filter(Ze=>!Pe.has(Ze.uid)).sort((Ze,Oe)=>vr(Ze.data.sort)-vr(Oe.data.sort)),At=[...rt,...lt].map((Ze,Oe)=>({...Ze,data:{...Ze.data,sort:Oe},original:{...Ze.original,sort:Oe}}));f(At),ve(At.filter(Ze=>!Ze.data.is_disabled)),j(!0);try{const Ze=al(At);return await a(Ze),await l(),M(!1),he(!1),ve(null),n({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{f(Be);const Oe=Be.filter(kt=>!kt.data.is_disabled).sort((kt,zt)=>vr(kt.data.sort)-vr(zt.data.sort));return ve(Oe),M(!0),n({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{j(!1)}},[f,F,l,N,te,a,M,t,n,Ae]),X=d.exports.useCallback(q=>{if(!N||!q.length)return;const x=Ae!=null?Ae:F;!(q.length!==x.length||q.some((ee,Pe)=>{var Be;return ee.uid!==((Be=x[Pe])==null?void 0:Be.uid)}))||(ve(q),ue.current||M(!0))},[F,N,M,Ae]),ge=d.exports.useCallback(()=>{ve([...F]),M(!1),he(!0)},[F,M]),ke=d.exports.useCallback(()=>{he(!1),ve(null),M(!1)},[M]),Xe=d.exports.useCallback(()=>{Se()},[Se]),ie=async q=>{const x=g.current.find(R=>R.uid===q);if(!!x){re(q),me({inboundTag:x.inboundTag,remark:x.data.remark.trim(),address:x.data.address.trim()});try{const R=Ia(g.current,[x.inboundTag,x.initialInboundTag]);await a(R),await l(),n({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"})}catch{n({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{re(null)}}},ne=q=>{f(x=>pn(x.map(R=>R.uid===q?{...R,inboundTag:R.initialInboundTag,data:Ha(R.original)}:R)))},oe=(q,x)=>{we(q,"is_disabled",!x),x||y(!0)},K=q=>{P(q)},fe=async()=>{if(!I)return;const q=g.current.find(x=>x.uid===I);if(!!q){B(I);try{const x=g.current.filter(ee=>ee.uid!==I);f(x);const R=Ia(x,[q.inboundTag,q.initialInboundTag]);await a(R),await l(),n({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),A===I&&v(null)}catch{n({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{B(null),P(null)}}},dt=async q=>{const x=g.current.length?Math.max(...g.current.map(R=>R.data.sort))+1:0;re("create"),me({inboundTag:q.inboundTag,remark:q.remark.trim(),address:q.address.trim()});try{const R={uid:sl(),inboundTag:q.inboundTag,initialInboundTag:q.inboundTag,data:{id:null,remark:q.remark,address:q.address,sort:Number.isFinite(q.sort)?q.sort:x,port:q.port,path:q.path,sni:q.sni,host:q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:q.remark,address:q.address,sort:Number.isFinite(q.sort)?q.sort:x,port:q.port,path:q.path,sni:q.sni,host:q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},ee=pn([...g.current,R]);f(ee);const Pe=Ia(ee,[q.inboundTag]);await a(Pe),await l(),n({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),z(!1)}catch{n({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{re(null)}};return s(le,{align:"stretch",spacing:4,children:[N?s(le,{align:"stretch",spacing:2,children:[s(O,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),s(O,{spacing:2,children:[e(G,{variant:"ghost",onClick:ke,isDisabled:te,children:t("hostsPage.cancel")}),e(G,{colorScheme:"primary",onClick:Xe,isLoading:te,isDisabled:!W&&!te,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),te?s(O,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(xt,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):W?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):s(O,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(O,{spacing:3,children:[e(G,{colorScheme:"primary",size:"sm",onClick:()=>z(!0),leftIcon:e(tl,{}),isDisabled:!E.length,children:t("hostsPage.addHost")}),e(ot,{isChecked:b,onChange:q=>y(q.target.checked),children:t("hostsPage.showDisabled")})]}),e(G,{size:"sm",variant:"outline",leftIcon:e(rl,{}),onClick:ge,isDisabled:o||!F.length,children:t("hostsPage.enterSort")})]}),o?e(O,{justify:"center",py:10,children:e(xt,{})}):De.length===0?e(L,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t("hostsPage.emptyState")})}):N?e(Wo.Group,{axis:"y",values:De,onReorder:X,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:De.map((q,x)=>e(Zu,{host:q,index:x},q.uid))}):e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:de.map((q,x)=>{var R;return e(Qu,{host:q,inboundOptions:E,orderIndex:(R=Ee.get(q.uid))!=null?R:x,onToggleActive:oe,onEdit:v,onDelete:K,saving:U===q.uid&&i,deleting:D===q.uid&&i},q.uid)})}),e(eh,{isOpen:_,onClose:()=>z(!1),inboundOptions:E,onSubmit:dt,isSubmitting:U==="create"&&i,defaultSort:g.current.length?Math.max(...g.current.map(q=>q.data.sort))+1:0}),e(ju,{host:Y,inboundOptions:E,isOpen:Boolean(Y),onClose:()=>v(null),onChange:we,onChangeInbound:J,onSave:ie,onReset:ne,onDelete:K,saving:!!Y&&U===Y.uid&&i,deleting:!!Y&&D===Y.uid&&i}),e(Sn,{isOpen:Boolean(I),leastDestructiveRef:se,onClose:()=>P(null),children:e(pt,{children:s(xn,{children:[e(gt,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(mt,{children:t("hostsPage.deleteConfirmation")}),s(_t,{children:[e(G,{ref:se,onClick:()=>P(null),children:t("hostsPage.cancel")}),e(G,{colorScheme:"red",onClick:fe,ml:3,isLoading:Boolean(D),children:t("hostsPage.delete")})]})]})})})]})},rh=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),Wi=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(rh(t))}catch{}return""},sh=t=>{if(typeof t!="string"||t.length===0)return"";const n=globalThis.Wireguard;if(n!=null&&n.generateKeypair)try{const r=n.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class mr{static isEmpty(n){return n==null?!0:typeof n=="string"?n.trim().length===0:Array.isArray(n)?n.length===0:typeof n=="object"?Object.keys(n).length===0:!1}static isArrEmpty(n){return!Array.isArray(n)||n.length===0}}const ae=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),il=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const nh=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),ah=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const ih=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Ta=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class ct{static toJsonArray(n){return n.map(r=>r.toJson())}static fromJson(n){return new ct}toJson(){return{}}toString(n=!0){const r=this.toJson();return n?JSON.stringify(r,null,2):JSON.stringify(r)}}class jr extends ct{constructor(r="none",l="",o=""){super();V(this,"type");V(this,"host");V(this,"path");this.type=r,this.host=l,this.path=o}static fromJson(r={}){var o,i,a,c,u,p,g,f,A,v;const l=r==null?void 0:r.header;if(!l)return new jr;if(l.type==="http"&&l.request){const b=((i=(o=l.request)==null?void 0:o.headers)==null?void 0:i.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(c=(a=l.request)==null?void 0:a.headers)==null?void 0:c.Host)!=null?u:"",y=((p=l.request)==null?void 0:p.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(f=(g=l.request)==null?void 0:g.path)!=null?f:"";return new jr((A=l.type)!=null?A:"http",b,y)}return new jr((v=l.type)!=null?v:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:mr.isEmpty(this.host)?[]:this.host.split(",")},path:mr.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class Hs extends ct{constructor(r=1350,l=50,o=5,i=20,a=!1,c=2,u=2,p="none",g=""){super();V(this,"mtu");V(this,"tti");V(this,"upCap");V(this,"downCap");V(this,"congestion");V(this,"readBuffer");V(this,"writeBuffer");V(this,"type");V(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=o!=null?o:5,this.downCap=i!=null?i:20,this.congestion=Boolean(a),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=p!=null?p:"none",this.seed=g!=null?g:""}static fromJson(r={}){var l,o,i;return new Hs(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(o=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?o:"none",(i=r==null?void 0:r.seed)!=null?i:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class xs extends ct{constructor(r="/",l="",o=0){super();V(this,"path");V(this,"host");V(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=o!=null?o:0}static fromJson(r={}){var l,o,i;return new xs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.heartbeatPeriod)!=null?i:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class ks extends ct{constructor(r="",l="",o=!1){super();V(this,"serviceName");V(this,"authority");V(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(o)}static fromJson(r={}){var l,o;return new ks((l=r==null?void 0:r.serviceName)!=null?l:"",(o=r==null?void 0:r.authority)!=null?o:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class Bs extends ct{constructor(r="/",l=""){super();V(this,"path");V(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,o;return new Bs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"")}toJson(){return{path:this.path,host:this.host}}}class Vs extends ct{constructor(r="/",l="",o="",i=!1,a="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,p,g,f,A,v;super();V(this,"path");V(this,"host");V(this,"mode");V(this,"noGRPCHeader");V(this,"scMinPostsIntervalMs");V(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=o!=null?o:"",this.noGRPCHeader=Boolean(i),this.scMinPostsIntervalMs=a!=null?a:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(g=c==null?void 0:c.cMaxReuseTimes)!=null?g:0,hMaxRequestTimes:(f=c==null?void 0:c.hMaxRequestTimes)!=null?f:"600-900",hMaxReusableSecs:(A=c==null?void 0:c.hMaxReusableSecs)!=null?A:"1800-3000",hKeepAlivePeriod:(v=c==null?void 0:c.hKeepAlivePeriod)!=null?v:0}}static fromJson(r={}){var l,o,i,a;return new Vs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.mode)!=null?i:"",Boolean(r==null?void 0:r.noGRPCHeader),(a=r==null?void 0:r.scMinPostsIntervalMs)!=null?a:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class ws extends ct{constructor(r="",l=[],o="",i=!1,a=""){super();V(this,"serverName");V(this,"alpn");V(this,"fingerprint");V(this,"allowInsecure");V(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=o!=null?o:"",this.allowInsecure=Boolean(i),this.echConfigList=a!=null?a:""}static fromJson(r={}){var l,o,i;return new ws((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(o=r==null?void 0:r.fingerprint)!=null?o:"",Boolean(r==null?void 0:r.allowInsecure),(i=r==null?void 0:r.echConfigList)!=null?i:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class $s extends ct{constructor(r="",l="",o="",i="",a="",c=""){super();V(this,"publicKey");V(this,"fingerprint");V(this,"serverName");V(this,"shortId");V(this,"spiderX");V(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=o!=null?o:"",this.shortId=i!=null?i:"",this.spiderX=a!=null?a:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var l,o,i,a,c,u;return new $s((l=r==null?void 0:r.publicKey)!=null?l:"",(o=r==null?void 0:r.fingerprint)!=null?o:"",(i=r==null?void 0:r.serverName)!=null?i:"",(a=r==null?void 0:r.shortId)!=null?a:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class wn extends ct{constructor(r="",l=!1,o=0,i=!1,a=!1,c=Ta.NONE){super();V(this,"dialerProxy");V(this,"tcpFastOpen");V(this,"tcpKeepAliveInterval");V(this,"tcpMptcp");V(this,"penetrate");V(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=o!=null?o:0,this.tcpMptcp=Boolean(i),this.penetrate=Boolean(a),this.addressPortStrategy=c!=null?c:Ta.NONE}static fromJson(r={}){var l,o,i;return!r||Object.keys(r).length===0?new wn:new wn((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(o=r==null?void 0:r.tcpKeepAliveInterval)!=null?o:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(i=r==null?void 0:r.addressPortStrategy)!=null?i:Ta.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class is extends ct{constructor(r="tcp",l="none",o=new ws,i=new $s,a=new jr,c=new Hs,u=new xs,p=new ks,g=new Bs,f=new Vs,A){super();V(this,"network");V(this,"security");V(this,"tls");V(this,"reality");V(this,"tcp");V(this,"kcp");V(this,"ws");V(this,"grpc");V(this,"httpupgrade");V(this,"xhttp");V(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=o,this.reality=i,this.tcp=a,this.kcp=c,this.ws=u,this.grpc=p,this.httpupgrade=g,this.xhttp=f,this.sockopt=A}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new wn:void 0}static fromJson(r={}){var l,o;return new is((l=r==null?void 0:r.network)!=null?l:"tcp",(o=r==null?void 0:r.security)!=null?o:"none",ws.fromJson(r==null?void 0:r.tlsSettings),$s.fromJson(r==null?void 0:r.realitySettings),jr.fromJson(r==null?void 0:r.tcpSettings),Hs.fromJson(r==null?void 0:r.kcpSettings),xs.fromJson(r==null?void 0:r.wsSettings),ks.fromJson(r==null?void 0:r.grpcSettings),Bs.fromJson(r==null?void 0:r.httpupgradeSettings),Vs.fromJson(r==null?void 0:r.xhttpSettings),wn.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class vn extends ct{constructor(r=!1,l=8,o=16,i="reject"){super();V(this,"enabled");V(this,"concurrency");V(this,"xudpConcurrency");V(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=o!=null?o:16,this.xudpProxyUDP443=i!=null?i:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new vn:new vn(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var Qr,Er;const Ke=class extends ct{constructor(r="",l=ae.VLESS,o=Ke.Settings.getSettings(ae.VLESS),i=new is,a,c=new vn){super();V(this,"tag");V(this,"_protocol");V(this,"settings");V(this,"stream");V(this,"sendThrough");V(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:ae.VLESS,this.settings=o!=null?o:Ke.Settings.getSettings(this._protocol),this.stream=i,this.sendThrough=a,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=Ke.Settings.getSettings(r),this.stream=new is}canEnableTls(){return[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===ae.VLESS:!1}canEnableReality(){return[ae.VLESS,ae.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks,ae.HTTP,ae.Socks].includes(this.protocol)}hasVnext(){return[ae.VMess,ae.VLESS].includes(this.protocol)}hasServers(){return[ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP].includes(this.protocol)}hasAddressPort(){return[ae.DNS,ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP].includes(this.protocol)}hasUsername(){return[ae.Socks,ae.HTTP].includes(this.protocol)}static fromJson(r={}){var l,o,i,a;return new Ke((l=r==null?void 0:r.tag)!=null?l:"",(o=r==null?void 0:r.protocol)!=null?o:ae.VLESS,Ke.Settings.fromProtocol((i=r==null?void 0:r.protocol)!=null?i:ae.VLESS,r==null?void 0:r.settings),is.fromJson(r==null?void 0:r.streamSettings),(a=r==null?void 0:r.sendThrough)!=null?a:"",vn.fromJson(r==null?void 0:r.mux))}toJson(){var l,o;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof ct?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(o=this.mux)!=null&&o.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const o=l[0].toLowerCase();try{switch(o){case ae.VMess:return Ke.fromVmessLink(JSON.parse(Wi(l[1])));case ae.VLESS:case ae.Trojan:case"ss":return Ke.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var a,c,u,p,g,f,A,v,b,y,_,z,U,re,D,B,I,P,_e,me,se,W,Q;if(!r)return null;const l=new is((a=r==null?void 0:r.net)!=null?a:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),o=r==null?void 0:r.net;o==="tcp"?l.tcp=new jr((u=r==null?void 0:r.type)!=null?u:"none",(p=r==null?void 0:r.host)!=null?p:"",(g=r==null?void 0:r.path)!=null?g:""):o==="kcp"?(l.kcp=new Hs,l.kcp.type=(f=r==null?void 0:r.type)!=null?f:"none",l.kcp.seed=(A=r==null?void 0:r.path)!=null?A:""):o==="ws"?l.ws=new xs((v=r==null?void 0:r.path)!=null?v:"/",(b=r==null?void 0:r.host)!=null?b:""):o==="grpc"?l.grpc=new ks((y=r==null?void 0:r.path)!=null?y:"",(_=r==null?void 0:r.authority)!=null?_:"",(r==null?void 0:r.type)==="multi"):o==="httpupgrade"?l.httpupgrade=new Bs((z=r==null?void 0:r.path)!=null?z:"/",(U=r==null?void 0:r.host)!=null?U:""):o==="xhttp"&&(l.xhttp=new Vs((re=r==null?void 0:r.path)!=null?re:"/",(D=r==null?void 0:r.host)!=null?D:"",(B=r==null?void 0:r.mode)!=null?B:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new ws((I=r==null?void 0:r.sni)!=null?I:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(P=r==null?void 0:r.fp)!=null?P:"",Boolean(r==null?void 0:r.allowInsecure)));const i=Number((_e=r==null?void 0:r.port)!=null?_e:0);return Number.isNaN(i)?null:new Ke((me=r==null?void 0:r.ps)!=null?me:"",ae.VMess,new Ke.VmessSettings((se=r==null?void 0:r.add)!=null?se:"",i,(W=r==null?void 0:r.id)!=null?W:"",(Q=r==null?void 0:r.scy)!=null?Q:""),l)}static fromParamLink(r){var B,I,P,_e,me,se,W,Q,ue,te,j,N,he,Ae,ve,M,E,F,ce,de,De;let l;try{l=new URL(r)}catch{return null}const o=(B=l.searchParams.get("type"))!=null?B:"tcp",i=(I=l.searchParams.get("security"))!=null?I:"none",a=new is(o,i),c=(P=l.searchParams.get("headerType"))!=null?P:void 0,u=(_e=l.searchParams.get("host"))!=null?_e:void 0,p=(me=l.searchParams.get("path"))!=null?me:void 0,g=(se=l.searchParams.get("mode"))!=null?se:void 0;if(o==="tcp"||o==="none"?a.tcp=new jr(c!=null?c:"none",u!=null?u:"",p!=null?p:""):o==="kcp"?(a.kcp=new Hs,a.kcp.type=c!=null?c:"none",a.kcp.seed=p!=null?p:""):o==="ws"?a.ws=new xs(p!=null?p:"/",u!=null?u:""):o==="grpc"?a.grpc=new ks((W=l.searchParams.get("serviceName"))!=null?W:"",(Q=l.searchParams.get("authority"))!=null?Q:"",l.searchParams.get("mode")==="multi"):o==="httpupgrade"?a.httpupgrade=new Bs(p!=null?p:"/",u!=null?u:""):o==="xhttp"&&(a.xhttp=new Vs(p!=null?p:"/",u!=null?u:"",g!=null?g:"")),i==="tls"){const Ee=(ue=l.searchParams.get("fp"))!=null?ue:"none",Y=l.searchParams.get("alpn"),we=l.searchParams.get("allowInsecure"),J=(te=l.searchParams.get("sni"))!=null?te:"",Se=(j=l.searchParams.get("ech"))!=null?j:"";a.tls=new ws(J,Y?Y.split(","):[],Ee,we==="1",Se)}if(i==="reality"){const Ee=(N=l.searchParams.get("pbk"))!=null?N:"",Y=(he=l.searchParams.get("fp"))!=null?he:"",we=(Ae=l.searchParams.get("sni"))!=null?Ae:"",J=(ve=l.searchParams.get("sid"))!=null?ve:"",Se=(M=l.searchParams.get("spx"))!=null?M:"",X=(E=l.searchParams.get("pqv"))!=null?E:"";a.reality=new $s(Ee,Y,we,J,Se,X)}const f=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,A=r.match(f);if(!A)return null;let[,v,b,y,_]=A,z=Number(_);Number.isNaN(z)&&(z=0),v==="ss"&&(v=ae.Shadowsocks,b=Wi(b));let U=null;switch(v){case ae.VLESS:{const Ee=(F=l.searchParams.get("encryption"))!=null?F:"none";U=new Ke.VLESSSettings(y,z,b,(ce=l.searchParams.get("flow"))!=null?ce:"",Ee);break}case ae.Trojan:U=new Ke.TrojanSettings(y,z,b);break;case ae.Shadowsocks:{const Ee=b.split(":"),Y=(de=Ee.shift())!=null?de:"";U=new Ke.ShadowsocksSettings(y,z,Ee.join(":"),Y,!0);break}default:return null}const re=decodeURIComponent((De=l.hash)!=null?De:""),D=re.length>1?re.substring(1):`out-${v}-${z}`;return new Ke(D,v,U,a)}};let Ht=Ke;V(Ht,"Settings",class extends ct{constructor(o){super();V(this,"protocol");this.protocol=o}static getSettings(o){switch(o){case ae.Freedom:return new Ke.FreedomSettings;case ae.Blackhole:return new Ke.BlackholeSettings;case ae.DNS:return new Ke.DNSSettings;case ae.VMess:return new Ke.VmessSettings;case ae.VLESS:return new Ke.VLESSSettings;case ae.Trojan:return new Ke.TrojanSettings;case ae.Shadowsocks:return new Ke.ShadowsocksSettings;case ae.Socks:return new Ke.SocksSettings;case ae.HTTP:return new Ke.HttpSettings;case ae.Wireguard:return new Ke.WireguardSettings;default:return null}}static fromProtocol(o,i){switch(o){case ae.Freedom:return Ke.FreedomSettings.fromJson(i);case ae.Blackhole:return Ke.BlackholeSettings.fromJson(i);case ae.DNS:return Ke.DNSSettings.fromJson(i);case ae.VMess:return Ke.VmessSettings.fromJson(i);case ae.VLESS:return Ke.VLESSSettings.fromJson(i);case ae.Trojan:return Ke.TrojanSettings.fromJson(i);case ae.Shadowsocks:return Ke.ShadowsocksSettings.fromJson(i);case ae.Socks:return Ke.SocksSettings.fromJson(i);case ae.HTTP:return Ke.HttpSettings.fromJson(i);case ae.Wireguard:return Ke.WireguardSettings.fromJson(i);default:return null}}toJson(){return{}}}),V(Ht,"FreedomSettings",(Qr=class extends ct{constructor(o="",i="",a={},c=[]){super();V(this,"domainStrategy");V(this,"redirect");V(this,"fragment");V(this,"noises");this.domainStrategy=o!=null?o:"",this.redirect=i!=null?i:"",this.fragment=a!=null?a:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new Ke.FreedomSettings.Noise)}delNoise(o){this.noises.splice(o,1)}static fromJson(o={}){var i,a;return new Qr((i=o==null?void 0:o.domainStrategy)!=null?i:"",(a=o==null?void 0:o.redirect)!=null?a:"",o!=null&&o.fragment?Qr.Fragment.fromJson(o.fragment):{},Array.isArray(o==null?void 0:o.noises)?o.noises.map(c=>Qr.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:mr.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:mr.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:ct.toJsonArray(this.noises)}}},V(Qr,"Fragment",class ol extends ct{constructor(a="1-3",c="",u="",p=""){super();V(this,"packets");V(this,"length");V(this,"interval");V(this,"maxSplit");this.packets=a!=null?a:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=p!=null?p:""}static fromJson(a={}){var c,u,p,g;return new ol((c=a==null?void 0:a.packets)!=null?c:"1-3",(u=a==null?void 0:a.length)!=null?u:"",(p=a==null?void 0:a.interval)!=null?p:"",(g=a==null?void 0:a.maxSplit)!=null?g:"")}}),V(Qr,"Noise",class ll extends ct{constructor(a="rand",c="10-20",u="10-16",p="ip"){super();V(this,"type");V(this,"packet");V(this,"delay");V(this,"applyTo");this.type=a!=null?a:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(a={}){var c,u,p,g;return new ll((c=a==null?void 0:a.type)!=null?c:"rand",(u=a==null?void 0:a.packet)!=null?u:"10-20",(p=a==null?void 0:a.delay)!=null?p:"10-16",(g=a==null?void 0:a.applyTo)!=null?g:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),Qr)),V(Ht,"BlackholeSettings",class cl extends ct{constructor(o){super();V(this,"type");this.type=o}static fromJson(o={}){var i;return new cl((i=o==null?void 0:o.response)==null?void 0:i.type)}toJson(){return{response:mr.isEmpty(this.type)?void 0:{type:this.type}}}}),V(Ht,"DNSSettings",class dl extends ct{constructor(o="udp",i="",a=53,c="reject",u=[]){super();V(this,"network");V(this,"address");V(this,"port");V(this,"nonIPQuery");V(this,"blockTypes");this.network=o!=null?o:"udp",this.address=i!=null?i:"",this.port=a!=null?a:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(o={}){var i,a,c,u;return new dl((i=o==null?void 0:o.network)!=null?i:"udp",(a=o==null?void 0:o.address)!=null?a:"",(c=o==null?void 0:o.port)!=null?c:53,(u=o==null?void 0:o.nonIPQuery)!=null?u:"reject",Array.isArray(o==null?void 0:o.blockTypes)?o.blockTypes:[])}}),V(Ht,"VmessSettings",class extends ct{constructor(o="",i=0,a="",c=""){super();V(this,"address");V(this,"port");V(this,"id");V(this,"security");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.security=c!=null?c:""}static fromJson(o={}){var c,u,p,g;if(mr.isArrEmpty(o==null?void 0:o.vnext))return new Ke.VmessSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Ke.VmessSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=a==null?void 0:a.id)!=null?p:"",(g=a==null?void 0:a.security)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),V(Ht,"VLESSSettings",class extends ct{constructor(o="",i=0,a="",c="",u=""){super();V(this,"address");V(this,"port");V(this,"id");V(this,"flow");V(this,"encryption");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(o={}){var c,u,p,g,f;if(mr.isArrEmpty(o==null?void 0:o.vnext))return new Ke.VLESSSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Ke.VLESSSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=a==null?void 0:a.id)!=null?p:"",(g=a==null?void 0:a.flow)!=null?g:"",(f=a==null?void 0:a.encryption)!=null?f:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),V(Ht,"TrojanSettings",class extends ct{constructor(o="",i=0,a=""){super();V(this,"address");V(this,"port");V(this,"password");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:""}static fromJson(o={}){var a,c,u;if(mr.isArrEmpty(o==null?void 0:o.servers))return new Ke.TrojanSettings;const i=o.servers[0];return new Ke.TrojanSettings((a=i==null?void 0:i.address)!=null?a:"",(c=i==null?void 0:i.port)!=null?c:0,(u=i==null?void 0:i.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),V(Ht,"ShadowsocksSettings",class extends ct{constructor(o="",i=0,a="",c="",u,p){super();V(this,"address");V(this,"port");V(this,"password");V(this,"method");V(this,"uot");V(this,"UoTVersion");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=p}static fromJson(o={}){var c,u,p,g;let i=o==null?void 0:o.servers;mr.isArrEmpty(i)&&(i=[{}]);const a=i[0];return new Ke.ShadowsocksSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=a==null?void 0:a.password)!=null?p:"",(g=a==null?void 0:a.method)!=null?g:"",a==null?void 0:a.uot,a==null?void 0:a.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),V(Ht,"SocksSettings",class extends ct{constructor(o="",i=0,a="",c=""){super();V(this,"address");V(this,"port");V(this,"user");V(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,g,f;let i=o==null?void 0:o.servers;mr.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Ke.SocksSettings((u=a==null?void 0:a.address)!=null?u:"",(p=a==null?void 0:a.port)!=null?p:0,(g=c==null?void 0:c.user)!=null?g:"",(f=c==null?void 0:c.pass)!=null?f:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:mr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),V(Ht,"HttpSettings",class extends ct{constructor(o="",i=0,a="",c=""){super();V(this,"address");V(this,"port");V(this,"user");V(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,g,f;let i=o==null?void 0:o.servers;mr.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Ke.HttpSettings((u=a==null?void 0:a.address)!=null?u:"",(p=a==null?void 0:a.port)!=null?p:0,(g=c==null?void 0:c.user)!=null?g:"",(f=c==null?void 0:c.pass)!=null?f:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:mr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),V(Ht,"WireguardSettings",(Er=class extends ct{constructor(o=1420,i="",a=[""],c=2,u="",p="",g=[new Er.Peer],f=!1){super();V(this,"mtu");V(this,"secretKey");V(this,"pubKey");V(this,"address");V(this,"workers");V(this,"domainStrategy");V(this,"reserved");V(this,"peers");V(this,"noKernelTun");this.mtu=o!=null?o:1420,this.secretKey=i!=null?i:"",this.pubKey=this.secretKey.length>0?sh(this.secretKey):"",this.address=Array.isArray(a)?a.join(","):a!=null?a:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=g!=null?g:[new Er.Peer],this.noKernelTun=Boolean(f)}addPeer(){this.peers.push(new Er.Peer)}delPeer(o){this.peers.splice(o,1)}static fromJson(o={}){var i,a,c,u,p,g,f;return new Er((i=o==null?void 0:o.mtu)!=null?i:1420,(a=o==null?void 0:o.secretKey)!=null?a:"",(c=o==null?void 0:o.address)!=null?c:[""],(u=o==null?void 0:o.workers)!=null?u:2,(p=o==null?void 0:o.domainStrategy)!=null?p:"",(g=o==null?void 0:o.reserved)!=null?g:"",Array.isArray(o==null?void 0:o.peers)?o.peers.map(A=>Er.Peer.fromJson(A)):[new Er.Peer],(f=o==null?void 0:o.noKernelTun)!=null?f:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:ih.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(o=>Number(o)).filter(o=>!Number.isNaN(o)):void 0,peers:ct.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},V(Er,"Peer",class extends ct{constructor(a="",c="",u=["0.0.0.0/0","::/0"],p="",g=0){super();V(this,"publicKey");V(this,"psk");V(this,"allowedIPs");V(this,"endpoint");V(this,"keepAlive");this.publicKey=a!=null?a:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=g!=null?g:0}static fromJson(a={}){var c,u,p,g;return new Ke.WireguardSettings.Peer((c=a==null?void 0:a.publicKey)!=null?c:"",(u=a==null?void 0:a.preSharedKey)!=null?u:"",Array.isArray(a==null?void 0:a.allowedIPs)?a.allowedIPs:["0.0.0.0/0","::/0"],(p=a==null?void 0:a.endpoint)!=null?p:"",(g=a==null?void 0:a.keepAlive)!=null?g:0)}toJson(){var a;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(a=this.allowedIPs)!=null&&a.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),Er));class ps{static sizeFormat(n){if(n<=0||Number.isNaN(n))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,o=n;for(;o>=1024&&l<r.length-1;)o/=1024,l++;return`${o.toFixed(2)} ${r[l]}`}}const oh=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(ah);const lh=Object.values(nh),ti=["vmess","vless","trojan","shadowsocks","http","socks"],ch=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp"],dh=["none","tls","reality"],Pa=t=>t.split(/[\n,]/).map(n=>n.trim()).filter(Boolean),Ea=t=>t&&t.length?t.join(`
`):"",Ts=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",ul=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),uh=t=>{if(!t)return 0;const n=Number(t);return!Number.isNaN(n)&&n>0?n:t.trim()},gr=t=>(Object.keys(t).forEach(n=>{const r=t[n];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[n]}),t),Fi=()=>({user:"",pass:""}),Hi=t=>{var n,r;return{user:(n=t==null?void 0:t.user)!=null?n:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},Bi=t=>{var n,r;return gr({user:(n=t.user)==null?void 0:n.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},Ps=t=>{if(t===""||t===null||typeof t>"u")return;const n=Number(t);return Number.isFinite(n)?n:void 0},hh=t=>{if(!t.sockoptEnabled)return;const n=t.sockopt,r={acceptProxyProtocol:n.acceptProxyProtocol,tcpFastOpen:n.tcpFastOpen,mark:Ps(n.mark),tproxy:n.tproxy||void 0,tcpMptcp:n.tcpMptcp,penetrate:n.penetrate,domainStrategy:n.domainStrategy||void 0,tcpMaxSeg:Ps(n.tcpMaxSeg),dialerProxy:n.dialerProxy||void 0,tcpKeepAliveInterval:Ps(n.tcpKeepAliveInterval),tcpKeepAliveIdle:Ps(n.tcpKeepAliveIdle),tcpUserTimeout:Ps(n.tcpUserTimeout),tcpcongestion:n.tcpcongestion||void 0,V6Only:n.V6Only,tcpWindowClamp:Ps(n.tcpWindowClamp),interface:n.interfaceName||void 0};return gr(r)},Ba=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:ul(),httpAccounts:[Fi()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[Fi()],socksUdpEnabled:!1,socksUdpIp:""}),ph=t=>{var n,r,l,o,i,a,c;return{dest:(r=(n=t==null?void 0:t.dest)==null?void 0:n.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(o=t==null?void 0:t.type)!=null?o:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(i=t==null?void 0:t.alpn)!=null?i:"",xver:(c=(a=t==null?void 0:t.xver)==null?void 0:a.toString())!=null?c:""}},Vi=t=>{var r,l,o;const n={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(o=t.type)==null?void 0:o.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(n.alpn=t.alpn.split(",").map(i=>i.trim()).filter(Boolean)),gr(n)},mh=t=>{var u,p,g,f,A,v,b,y,_,z,U,re,D,B,I,P,_e,me,se,W,Q,ue,te,j,N,he,Ae,ve,M,E,F,ce,de,De,Ee,Y,we,J,Se,X,ge,ke,Xe,ie,ne,oe,K,fe,dt,Je,q,x,R,ee,Pe,Be,rt,lt,At,Ze,Oe,kt,zt,Kt,or,Gt,er,Wt;const n=ti.includes(t.protocol)?t.protocol:"vless",r=Ba(n),l=(u=t.settings)!=null?u:{},o=(p=t.sniffing)!=null?p:{},i=(g=t.streamSettings)!=null?g:{},a=(f=i.tlsSettings)!=null?f:{},c=(A=i.realitySettings)!=null?A:{};return{...r,tag:(v=t.tag)!=null?v:"",listen:(b=t.listen)!=null?b:"",port:(_=(y=t.port)==null?void 0:y.toString())!=null?_:"",disableInsecureEncryption:Boolean((z=l.disableInsecureEncryption)!=null?z:r.disableInsecureEncryption),vlessDecryption:(U=l.decryption)!=null?U:r.vlessDecryption,vlessEncryption:(re=l.encryption)!=null?re:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map(Ge=>ph(Ge)):r.fallbacks,shadowsocksNetwork:(D=l.network)!=null?D:r.shadowsocksNetwork,sniffingEnabled:Boolean((B=o.enabled)!=null?B:r.sniffingEnabled),sniffingDestinations:Array.isArray(o.destOverride)&&o.destOverride.length?o.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((I=o.routeOnly)!=null?I:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((P=o.metadataOnly)!=null?P:r.sniffingMetadataOnly),streamNetwork:(_e=i.network)!=null?_e:r.streamNetwork,streamSecurity:(me=i.security)!=null?me:r.streamSecurity,tlsServerName:(se=a.serverName)!=null?se:r.tlsServerName,tlsAlpn:Array.isArray(a.alpn)?a.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((W=a.allowInsecure)!=null?W:r.tlsAllowInsecure),tlsFingerprint:(Q=a.fingerprint)!=null?Q:r.tlsFingerprint,realityPrivateKey:(ue=c.privateKey)!=null?ue:r.realityPrivateKey,realityServerNames:Ea(c.serverNames),realityShortIds:Ea(c.shortIds),realityDest:(te=c.dest)!=null?te:r.realityDest,realitySpiderX:(j=c.spiderX)!=null?j:r.realitySpiderX,realityXver:(he=(N=c.xver)==null?void 0:N.toString())!=null?he:r.realityXver,wsPath:(ve=(Ae=i==null?void 0:i.wsSettings)==null?void 0:Ae.path)!=null?ve:r.wsPath,wsHost:(F=(E=(M=i==null?void 0:i.wsSettings)==null?void 0:M.headers)==null?void 0:E.Host)!=null?F:r.wsHost,tcpHeaderType:(De=(de=(ce=i==null?void 0:i.tcpSettings)==null?void 0:ce.header)==null?void 0:de.type)!=null?De:r.tcpHeaderType,tcpHttpHosts:Ea((J=(we=(Y=(Ee=i==null?void 0:i.tcpSettings)==null?void 0:Ee.header)==null?void 0:Y.request)==null?void 0:we.headers)==null?void 0:J.Host),tcpHttpPath:Array.isArray((ge=(X=(Se=i==null?void 0:i.tcpSettings)==null?void 0:Se.header)==null?void 0:X.request)==null?void 0:ge.path)?i.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(Xe=(ke=i==null?void 0:i.grpcSettings)==null?void 0:ke.serviceName)!=null?Xe:r.grpcServiceName,grpcAuthority:(ne=(ie=i==null?void 0:i.grpcSettings)==null?void 0:ie.authority)!=null?ne:r.grpcAuthority,grpcMultiMode:Boolean((K=(oe=i==null?void 0:i.grpcSettings)==null?void 0:oe.multiMode)!=null?K:r.grpcMultiMode),kcpHeaderType:(Je=(dt=(fe=i==null?void 0:i.kcpSettings)==null?void 0:fe.header)==null?void 0:dt.type)!=null?Je:r.kcpHeaderType,kcpSeed:(x=(q=i==null?void 0:i.kcpSettings)==null?void 0:q.seed)!=null?x:r.kcpSeed,quicSecurity:(ee=(R=i==null?void 0:i.quicSettings)==null?void 0:R.security)!=null?ee:r.quicSecurity,quicKey:(Be=(Pe=i==null?void 0:i.quicSettings)==null?void 0:Pe.key)!=null?Be:r.quicKey,quicHeaderType:(At=(lt=(rt=i==null?void 0:i.quicSettings)==null?void 0:rt.header)==null?void 0:lt.type)!=null?At:r.quicHeaderType,httpupgradePath:(Oe=(Ze=i==null?void 0:i.httpupgradeSettings)==null?void 0:Ze.path)!=null?Oe:r.httpupgradePath,httpupgradeHost:(zt=(kt=i==null?void 0:i.httpupgradeSettings)==null?void 0:kt.host)!=null?zt:r.httpupgradeHost,splithttpPath:(or=(Kt=i==null?void 0:i.splithttpSettings)==null?void 0:Kt.path)!=null?or:r.splithttpPath,splithttpHost:(er=(Gt=i==null?void 0:i.splithttpSettings)==null?void 0:Gt.host)!=null?er:r.splithttpHost,vlessSelectedAuth:(Wt=l.selectedAuth)!=null?Wt:r.vlessSelectedAuth,sockoptEnabled:Boolean(i==null?void 0:i.sockopt),sockopt:(()=>{var tr,Et,rr,$,k,T;const Ge=ul(),ut=(tr=i==null?void 0:i.sockopt)!=null?tr:{};return Ge.acceptProxyProtocol=Boolean(ut.acceptProxyProtocol),Ge.tcpFastOpen=Boolean(ut.tcpFastOpen),Ge.mark=Ts(ut.mark),Ge.tproxy=(Et=ut.tproxy)!=null?Et:Ge.tproxy,Ge.tcpMptcp=Boolean(ut.tcpMptcp),Ge.penetrate=Boolean(ut.penetrate),Ge.domainStrategy=(rr=ut.domainStrategy)!=null?rr:Ge.domainStrategy,Ge.tcpMaxSeg=Ts(ut.tcpMaxSeg),Ge.dialerProxy=($=ut.dialerProxy)!=null?$:Ge.dialerProxy,Ge.tcpKeepAliveInterval=Ts(ut.tcpKeepAliveInterval),Ge.tcpKeepAliveIdle=Ts(ut.tcpKeepAliveIdle),Ge.tcpUserTimeout=Ts(ut.tcpUserTimeout),Ge.tcpcongestion=(k=ut.tcpcongestion)!=null?k:Ge.tcpcongestion,Ge.V6Only=Boolean(ut.V6Only),Ge.tcpWindowClamp=Ts(ut.tcpWindowClamp),Ge.interfaceName=(T=ut.interface)!=null?T:Ge.interfaceName,Ge})(),httpAccounts:n==="http"&&Array.isArray(l.accounts)?l.accounts.map(Ge=>Hi(Ge)):r.httpAccounts,httpAllowTransparent:n==="http"&&typeof l.allowTransparent=="boolean"?l.allowTransparent:r.httpAllowTransparent,socksAuth:n==="socks"&&l.auth==="password"?"password":r.socksAuth,socksAccounts:n==="socks"&&Array.isArray(l.accounts)?l.accounts.map(Ge=>Hi(Ge)):r.socksAccounts,socksUdpEnabled:n==="socks"&&typeof l.udp=="boolean"?l.udp:r.socksUdpEnabled,socksUdpIp:n==="socks"&&l.ip!==void 0&&l.ip!==null?String(l.ip):r.socksUdpIp}},gh=t=>{var l;const n={network:t.streamNetwork,security:t.streamSecurity};t.streamNetwork==="ws"&&(n.wsSettings=gr({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?n.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:Pa(t.tcpHttpHosts)}:{}}}}:n.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(n.grpcSettings=gr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(n.kcpSettings=gr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(n.quicSettings=gr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(n.httpupgradeSettings=gr({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(n.splithttpSettings=gr({path:t.splithttpPath,host:t.splithttpHost})),t.streamSecurity==="tls"&&(n.tlsSettings=gr({serverName:t.tlsServerName||void 0,alpn:(l=t.tlsAlpn)!=null&&l.length?t.tlsAlpn:void 0,allowInsecure:t.tlsAllowInsecure||void 0,fingerprint:t.tlsFingerprint||void 0})),t.streamSecurity==="reality"&&(n.realitySettings=gr({privateKey:t.realityPrivateKey||void 0,serverNames:Pa(t.realityServerNames),shortIds:Pa(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=hh(t);return r&&(n.sockopt=r),gr(n)},fh=t=>{const n={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(n.clients=[]),t.protocol){case"vmess":n.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":n.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(n.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(n.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(Vi).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(Vi).filter(r=>Object.keys(r).length));break;case"shadowsocks":n.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(Bi).filter(l=>Object.keys(l).length);r.length&&(n.accounts=r),t.httpAllowTransparent&&(n.allowTransparent=!0);break}case"socks":{if(n.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(Bi).filter(l=>Object.keys(l).length);r.length&&(n.accounts=r)}n.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(n.ip=t.socksUdpIp.trim());break}}return n},bh=t=>{const n={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:uh(t.port),protocol:t.protocol,settings:fh(t),streamSettings:gh(t)};return t.sniffingEnabled&&(n.sniffing=gr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly})),n};class Va{static gf(n){const r=new Float64Array(16);if(n)for(let l=0;l<n.length;++l)r[l]=n[l];return r}static pack(n,r){let l;const o=this.gf(),i=this.gf();for(let a=0;a<16;++a)i[a]=r[a];this.carry(i),this.carry(i),this.carry(i);for(let a=0;a<2;++a){o[0]=i[0]-65517;for(let c=1;c<15;++c)o[c]=i[c]-65535-(o[c-1]>>16&1),o[c-1]&=65535;o[15]=i[15]-32767-(o[14]>>16&1),l=o[15]>>16&1,o[14]&=65535,this.cswap(i,o,1-l)}for(let a=0;a<16;++a)n[2*a]=i[a]&255,n[2*a+1]=i[a]>>8}static carry(n){for(let r=0;r<16;++r)n[(r+1)%16]+=(r<15?1:38)*Math.floor(n[r]/65536),n[r]&=65535}static cswap(n,r,l){const o=~(l-1);for(let i=0;i<16;++i){const a=o&(n[i]^r[i]);n[i]^=a,r[i]^=a}}static add(n,r,l){for(let o=0;o<16;++o)n[o]=r[o]+l[o]|0}static subtract(n,r,l){for(let o=0;o<16;++o)n[o]=r[o]-l[o]|0}static multmod(n,r,l){const o=new Float64Array(31);for(let i=0;i<16;++i)for(let a=0;a<16;++a)o[i+a]+=r[i]*l[a];for(let i=0;i<15;++i)o[i]+=38*o[i+16];for(let i=0;i<16;++i)n[i]=o[i];this.carry(n),this.carry(n)}static invert(n,r){const l=this.gf();for(let o=0;o<16;++o)l[o]=r[o];for(let o=253;o>=0;--o)this.multmod(l,l,l),o!==2&&o!==4&&this.multmod(l,l,r);for(let o=0;o<16;++o)n[o]=l[o]}static clamp(n){n[31]=n[31]&127|64,n[0]&=248}static generatePublicKey(n){let r;const l=new Uint8Array(32),o=this.gf([1]),i=this.gf([9]),a=this.gf(),c=this.gf([1]),u=this.gf(),p=this.gf(),g=this.gf([56129,1]),f=this.gf([9]);for(let A=0;A<32;++A)l[A]=n[A];this.clamp(l);for(let A=254;A>=0;--A)r=l[A>>>3]>>>(A&7)&1,this.cswap(o,i,r),this.cswap(a,c,r),this.add(u,o,a),this.subtract(o,o,a),this.add(a,i,c),this.subtract(i,i,c),this.multmod(c,u,u),this.multmod(p,o,o),this.multmod(o,a,o),this.multmod(a,i,u),this.add(u,o,a),this.subtract(o,o,a),this.multmod(i,o,o),this.subtract(a,c,p),this.multmod(o,a,g),this.add(o,o,c),this.multmod(a,a,o),this.multmod(o,c,p),this.multmod(c,i,f),this.multmod(i,u,u),this.cswap(o,i,r),this.cswap(a,c,r);return this.invert(a,a),this.multmod(o,o,a),this.pack(l,o),l}static generatePresharedKey(){const n=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(n),n}static generatePrivateKey(){const n=this.generatePresharedKey();return this.clamp(n),n}static encodeBase64(n,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let o=0;o<4;++o)n[o]=l[o]+65+(25-l[o]>>8&6)-(51-l[o]>>8&75)-(61-l[o]>>8&15)+(62-l[o]>>8&3)}static keyToBase64(n){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),n.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([n[r*3+0],n[r*3+1],0])),l[43]=61,Array.from(l).map(o=>String.fromCharCode(o)).join("")}static keyFromBase64(n){const r=globalThis.atob(n),l=new Uint8Array(r.length);for(let o=0;o<r.length;o++)l[o]=r.charCodeAt(o);return l}static generateKeypair(n=""){const r=n.length>0?this.keyFromBase64(n):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:n.length>0?n:this.keyToBase64(r)}}}const da=t=>Va.generateKeypair(t!=null?t:""),yh=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:Va.generateKeypair.bind(Va)})},Sh=async()=>Ce("/xray/vlessenc"),tt=d.exports.forwardRef((t,n)=>e(be,{size:"sm",ref:n,...t}));tt.displayName="InboundFormInput";const Us=d.exports.forwardRef((t,n)=>e(Ye,{size:"sm",ref:n,...t}));Us.displayName="InboundFormSelect";const mn=d.exports.forwardRef((t,n)=>e(fr,{size:"sm",resize:"vertical",ref:n,...t}));mn.displayName="InboundFormTextarea";const $i=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),xh=t=>{const n=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!n)return"";const r=n.length%4;return r===0?n:`${n}${"=".repeat(4-r)}`},kh=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],wh=["bbr","cubic","reno"],vh=["off","redirect","tproxy"],Ch=({isOpen:t,mode:n,initialValue:r,isSubmitting:l,onClose:o,onSubmit:i})=>{var fe,dt,Je,q;const{t:a}=He(),c=Ut(),[u,p]=d.exports.useState([]),[g,f]=d.exports.useState(!1),A=_r({defaultValues:Ba()}),{control:v,register:b,handleSubmit:y,reset:_,watch:z}=A,{fields:U,append:re,remove:D}=fn({control:v,name:"fallbacks"}),{fields:B,append:I,remove:P}=fn({control:v,name:"httpAccounts"}),{fields:_e,append:me,remove:se}=fn({control:v,name:"socksAccounts"}),W=Ot({control:v,name:"protocol"})||z("protocol"),Q=Ot({control:v,name:"streamNetwork"})||z("streamNetwork"),ue=Ot({control:v,name:"streamSecurity"})||z("streamSecurity"),te=(fe=Ot({control:v,name:"sniffingEnabled"}))!=null?fe:z("sniffingEnabled"),j=Ot({control:v,name:"realityPrivateKey"})||z("realityPrivateKey"),N=Ot({control:v,name:"tcpHeaderType"})||z("tcpHeaderType"),he=(dt=Ot({control:v,name:"sockoptEnabled"}))!=null?dt:!1,Ae=Ot({control:v,name:"vlessSelectedAuth"})||"",ve=Ot({control:v,name:"socksAuth"})||z("socksAuth")||"noauth",M=(q=(Je=Ot({control:v,name:"socksUdpEnabled"}))!=null?Je:z("socksUdpEnabled"))!=null?q:!1,E=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),F=d.exports.useMemo(()=>{const x=[...E,...u.map(ee=>ee.label)].filter(Boolean);return Array.from(new Set(x)).map(ee=>({label:ee,value:ee}))},[E,u]);d.exports.useEffect(()=>{if(t)if(r){const x=mh(r);_(x)}else _(Ba())},[r,_,t]);const ce=d.exports.useCallback((x,R)=>s(w,{children:[e(C,{children:R}),e(st,{control:v,name:`sockopt.${x}`,render:({field:ee})=>{const Pe=typeof ee.value=="number"||typeof ee.value=="string"?ee.value:void 0;return e(bs,{min:0,value:Pe!=null?Pe:"",onChange:Be=>ee.onChange(Be),children:e(fs,{})})}})]}),[v]),de=d.exports.useCallback((x,R)=>s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:R}),e(st,{control:v,name:`sockopt.${x}`,render:({field:ee})=>e(ot,{isChecked:typeof ee.value=="boolean"?ee.value:Boolean(ee.value),onChange:Pe=>ee.onChange(Pe.target.checked)})})]}),[v]),De=d.exports.useCallback((x,R,ee)=>s(w,{children:[e(C,{children:R}),e(tt,{...b(`sockopt.${x}`),placeholder:ee})]}),[b]),Ee=W==="vless"||W==="trojan",Y=Qe("gray.200","gray.700"),we=async x=>{await i(x)},J=d.exports.useCallback(()=>{try{const{privateKey:x}=da();A.setValue("realityPrivateKey",$i(x),{shouldDirty:!0})}catch(x){c({status:"error",title:a("inbounds.reality.generateError","Unable to generate key pair"),description:x instanceof Error?x.message:void 0})}},[A,c,a]),Se=d.exports.useCallback(()=>{try{const x=typeof window>"u"?void 0:window.crypto;if(!(x!=null&&x.getRandomValues))throw new Error("Crypto API is not available in this environment.");const R=new Uint8Array(4);x.getRandomValues(R);const ee=Array.from(R).map(rt=>rt.toString(16).padStart(2,"0")).join(""),Be=(A.getValues("realityShortIds")||"").split(/[\s,]+/).map(rt=>rt.trim()).filter(Boolean);Be.push(ee),A.setValue("realityShortIds",Be.join(`
`),{shouldDirty:!0})}catch(x){c({status:"error",title:a("inbounds.reality.shortIdError","Unable to generate short ID"),description:x instanceof Error?x.message:void 0})}},[A,c,a]),X=d.exports.useMemo(()=>{const x=xh(j);if(!x)return"";try{const{publicKey:R}=da(x);return $i(R)}catch{return""}},[j]),ge=()=>re({dest:"",path:"",type:"",alpn:"",xver:""}),ke=d.exports.useCallback(async()=>{var x;f(!0);try{const R=await Sh(),ee=(x=R==null?void 0:R.auths)!=null?x:[];return p(ee),ee}catch(R){return console.error(R),c({status:"error",title:a("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{f(!1)}},[c,a]),Xe=d.exports.useCallback(async()=>u.length?u:ke(),[ke,u]),ie=d.exports.useCallback((x,R)=>{var Pe,Be;const ee=R.find(rt=>rt.label===x);if(!ee){c({status:"warning",title:a("inbounds.vless.authNotFound","Authentication block not available")});return}A.setValue("vlessDecryption",(Pe=ee.decryption)!=null?Pe:"",{shouldDirty:!0}),A.setValue("vlessEncryption",(Be=ee.encryption)!=null?Be:"",{shouldDirty:!0})},[A,a,c]),ne=d.exports.useCallback(async x=>{if(!x){A.setValue("vlessDecryption","",{shouldDirty:!0}),A.setValue("vlessEncryption","",{shouldDirty:!0});return}const R=await Xe();R.length&&ie(x,R)},[ie,Xe,A]),oe=d.exports.useCallback(async()=>{const x=A.getValues("vlessSelectedAuth");if(!x){c({status:"info",title:a("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const R=await ke();R.length&&ie(x,R)},[ie,ke,A,a,c]),K=d.exports.useCallback(()=>{A.setValue("vlessSelectedAuth","",{shouldDirty:!0}),A.setValue("vlessDecryption","",{shouldDirty:!0}),A.setValue("vlessEncryption","",{shouldDirty:!0})},[A]);return d.exports.useEffect(()=>{t&&W==="vless"&&Xe()},[W,Xe,t]),s(It,{isOpen:t,onClose:o,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(pt,{}),s(Tt,{maxW:{base:"95vw",md:"4xl"},children:[e(gt,{children:n==="create"?a("inbounds.add","Add inbound"):a("inbounds.edit","Edit inbound")}),e(Dt,{}),e(mt,{children:s(le,{align:"stretch",spacing:6,children:[s(xe,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{isRequired:!0,children:[e(C,{children:a("inbounds.tag","Tag")}),e(tt,{...b("tag",{required:!0}),isDisabled:n==="edit"})]}),s(w,{children:[e(C,{children:a("inbounds.listen","Listen address")}),e(tt,{placeholder:"0.0.0.0",...b("listen")})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{isRequired:!0,children:[e(C,{children:a("inbounds.port","Port")}),e(tt,{placeholder:"443",...b("port",{required:!0})})]}),s(w,{isRequired:!0,children:[e(C,{children:a("inbounds.protocol","Protocol")}),e(Us,{...b("protocol",{required:!0}),isDisabled:n==="edit",children:ti.map(x=>e("option",{value:x,children:x.toUpperCase()},x))})]})]}),W==="vmess"&&s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(ot,{...b("disableInsecureEncryption")})]}),W==="shadowsocks"&&s(w,{children:[e(C,{children:a("inbounds.shadowsocks.network","Allowed networks")}),e(tt,{...b("shadowsocksNetwork")})]}),W==="vless"&&s(xe,{spacing:3,children:[e(st,{control:v,name:"vlessSelectedAuth",render:({field:x})=>s(w,{children:[e(C,{children:a("inbounds.vless.authentication","Authentication")}),s(Ye,{placeholder:a("inbounds.vless.authPlaceholder","Select authentication"),value:x.value||"",onChange:async R=>{const ee=R.target.value;x.onChange(ee),await ne(ee)},children:[e("option",{value:"",children:a("common.none","None")}),F.map(R=>e("option",{value:R.value,children:R.label},R.value))]})]})}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:a("inbounds.vless.decryption","Decryption")}),e(tt,{...b("vlessDecryption")})]}),s(w,{children:[e(C,{children:a("inbounds.vless.encryption","Encryption")}),e(tt,{...b("vlessEncryption")})]})]}),s(O,{spacing:3,children:[e(G,{size:"sm",onClick:oe,isLoading:g,isDisabled:!Ae,children:a("inbounds.vless.getKeys","Get new keys")}),e(G,{size:"sm",variant:"ghost",onClick:K,children:a("inbounds.vless.clearKeys","Clear")})]})]}),W==="http"&&s(xe,{spacing:3,children:[s(St,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("inbounds.http.accounts","HTTP accounts")}),e(G,{size:"xs",onClick:()=>I({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),s(xe,{spacing:3,children:[B.map((x,R)=>s(L,{borderWidth:"1px",borderRadius:"md",borderColor:Y,p:3,children:[s(St,{justify:"space-between",align:"center",mb:3,children:[s(h,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",R+1]}),e(G,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>P(R),children:a("hostsPage.delete","Delete")})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("username","Username")}),e(tt,{...b(`httpAccounts.${R}.user`)})]}),s(w,{children:[e(C,{children:a("password","Password")}),e(tt,{...b(`httpAccounts.${R}.pass`)})]})]})]},x.id)),!B.length&&e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.http.allowTransparent","Allow transparent proxy")}),e(ot,{...b("httpAllowTransparent")})]})]}),W==="socks"&&s(xe,{spacing:3,children:[s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.socks.udp","Enable UDP")}),e(ot,{...b("socksUdpEnabled")})]}),M&&s(w,{children:[e(C,{children:a("inbounds.socks.udpIp","UDP bind IP")}),e(tt,{...b("socksUdpIp"),placeholder:"127.0.0.1"})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.socks.auth","Require authentication")}),e(st,{control:v,name:"socksAuth",render:({field:x})=>e(ot,{isChecked:x.value==="password",onChange:R=>x.onChange(R.target.checked?"password":"noauth")})})]}),ve==="password"&&s(xe,{spacing:3,children:[s(St,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("inbounds.socks.accounts","SOCKS accounts")}),e(G,{size:"xs",onClick:()=>me({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),_e.map((x,R)=>s(L,{borderWidth:"1px",borderRadius:"md",borderColor:Y,p:3,children:[s(St,{justify:"space-between",align:"center",mb:3,children:[s(h,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",R+1]}),e(G,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>se(R),children:a("hostsPage.delete","Delete")})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("username","Username")}),e(tt,{...b(`socksAccounts.${R}.user`)})]}),s(w,{children:[e(C,{children:a("password","Password")}),e(tt,{...b(`socksAccounts.${R}.pass`)})]})]})]},x.id)),!_e.length&&e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),s(xe,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:a("inbounds.network","Network")}),e(Us,{...b("streamNetwork"),children:ch.map(x=>e("option",{value:x,children:x},x))})]}),s(w,{children:[e(C,{children:a("inbounds.security","Security")}),e(Us,{...b("streamSecurity"),children:dh.map(x=>e("option",{value:x,children:x},x))})]})]}),Q==="ws"&&s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:a("inbounds.ws.path","WebSocket path")}),e(tt,{...b("wsPath"),placeholder:"/ws"})]}),s(w,{children:[e(C,{children:a("inbounds.ws.host","WebSocket host header")}),e(tt,{...b("wsHost")})]})]}),Q==="tcp"&&s(xe,{spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.tcp.headerType","TCP header type")}),s(Us,{...b("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),N==="http"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.tcp.host","HTTP host list")}),e(mn,{...b("tcpHttpHosts"),placeholder:"example.com"})]}),s(w,{children:[e(C,{children:a("inbounds.tcp.path","HTTP path")}),e(tt,{...b("tcpHttpPath")})]})]})]}),Q==="grpc"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.grpc.serviceName","Service name")}),e(tt,{...b("grpcServiceName")})]}),s(w,{children:[e(C,{children:a("inbounds.grpc.authority","Authority")}),e(tt,{...b("grpcAuthority")})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.grpc.multiMode","Multi mode")}),e(ot,{...b("grpcMultiMode")})]})]}),Q==="kcp"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.kcp.headerType","mKCP header")}),e(tt,{...b("kcpHeaderType")})]}),s(w,{children:[e(C,{children:a("inbounds.kcp.seed","mKCP seed")}),e(tt,{...b("kcpSeed")})]})]}),Q==="quic"&&s(Ve,{columns:{base:1,md:3},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.quic.security","QUIC security")}),e(tt,{...b("quicSecurity")})]}),s(w,{children:[e(C,{children:a("inbounds.quic.key","QUIC key")}),e(tt,{...b("quicKey")})]}),s(w,{children:[e(C,{children:a("inbounds.quic.headerType","QUIC header type")}),e(tt,{...b("quicHeaderType")})]})]}),Q==="httpupgrade"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.httpUpgrade.path","Path")}),e(tt,{...b("httpupgradePath")})]}),s(w,{children:[e(C,{children:a("inbounds.httpUpgrade.host","Host")}),e(tt,{...b("httpupgradeHost")})]})]}),Q==="splithttp"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.splitHttp.path","Path")}),e(tt,{...b("splithttpPath")})]}),s(w,{children:[e(C,{children:a("inbounds.splitHttp.host","Host")}),e(tt,{...b("splithttpHost")})]})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.sockopt.enable","Enable sockopt")}),e(st,{control:v,name:"sockoptEnabled",render:({field:x})=>e(ot,{isChecked:Boolean(x.value),onChange:R=>x.onChange(R.target.checked)})})]}),e(Fs,{in:Boolean(he),animateOpacity:!0,children:s(xe,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"md",p:4,mt:2,children:[s(Ve,{columns:{base:1,md:2},spacing:3,children:[ce("mark",a("inbounds.sockopt.routeMark","Route mark")),ce("tcpKeepAliveInterval",a("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),ce("tcpKeepAliveIdle",a("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),ce("tcpMaxSeg",a("inbounds.sockopt.tcpMaxSeg","TCP max segment")),ce("tcpUserTimeout",a("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),ce("tcpWindowClamp",a("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[De("dialerProxy",a("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),De("interfaceName",a("inbounds.sockopt.interfaceName","Interface name"))]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.sockopt.domainStrategy","Domain strategy")}),e(st,{control:v,name:"sockopt.domainStrategy",render:({field:x})=>s(Ye,{...x,children:[e("option",{value:"",children:a("common.none","None")}),kh.map(R=>e("option",{value:R,children:R},R))]})})]}),s(w,{children:[e(C,{children:a("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(st,{control:v,name:"sockopt.tcpcongestion",render:({field:x})=>s(Ye,{...x,children:[e("option",{value:"",children:a("common.none","None")}),wh.map(R=>e("option",{value:R,children:R},R))]})})]}),s(w,{children:[e(C,{children:a("inbounds.sockopt.tproxy","TProxy")}),e(st,{control:v,name:"sockopt.tproxy",render:({field:x})=>e(Ye,{...x,children:vh.map(R=>e("option",{value:R,children:R},R))})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[de("acceptProxyProtocol",a("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),de("tcpFastOpen",a("inbounds.sockopt.tcpFastOpen","TCP fast open")),de("tcpMptcp",a("inbounds.sockopt.tcpMptcp","Multipath TCP")),de("penetrate",a("inbounds.sockopt.penetrate","Penetrate")),de("V6Only",a("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),ue==="tls"&&s(xe,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[s(w,{children:[e(C,{children:a("inbounds.tls.serverName","Server name (SNI)")}),e(tt,{...b("tlsServerName"),placeholder:"example.com"})]}),s(w,{children:[e(C,{children:a("inbounds.tls.fingerprint","uTLS fingerprint")}),s(Us,{...b("tlsFingerprint"),children:[e("option",{value:"",children:a("common.none","None")}),lh.map(x=>e("option",{value:x,children:x},x))]})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.tls.allowInsecure","Allow insecure")}),e(ot,{...b("tlsAllowInsecure")})]})]}),ue==="reality"&&s(xe,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[s(w,{isRequired:!0,children:[e(C,{children:a("inbounds.reality.privateKey","Reality private key")}),e(mn,{rows:3,...b("realityPrivateKey",{required:!0})}),e(G,{size:"xs",mt:2,variant:"outline",onClick:J,alignSelf:"flex-start",children:a("inbounds.reality.generateKeys","Generate key pair")})]}),s(w,{children:[e(C,{children:a("inbounds.reality.publicKey","Reality public key")}),e(tt,{value:X,isReadOnly:!0,placeholder:a("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:a("inbounds.reality.serverNames","Server names")}),e(mn,{rows:2,...b("realityServerNames"),placeholder:"domain.com"}),e(L,{fontSize:"sm",color:"gray.500",children:a("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),s(w,{children:[e(C,{children:a("inbounds.reality.dest","Destination (host:port)")}),e(tt,{...b("realityDest"),placeholder:"example.com:443"})]})]}),s(w,{children:[e(C,{children:a("inbounds.reality.shortIds","Short IDs")}),e(mn,{rows:2,...b("realityShortIds")}),e(G,{size:"xs",mt:2,variant:"outline",onClick:Se,alignSelf:"flex-start",children:a("inbounds.reality.generateShortId","Generate short ID")}),e(L,{fontSize:"sm",color:"gray.500",children:a("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:a("inbounds.reality.spiderX","SpiderX")}),e(tt,{...b("realitySpiderX")})]}),s(w,{children:[e(C,{children:a("inbounds.reality.xver","Xver")}),e(tt,{...b("realityXver")})]})]})]}),Ee&&s(xe,{spacing:3,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[s(St,{align:"center",justify:"space-between",children:[e(L,{fontWeight:"medium",children:a("inbounds.fallbacks","Fallbacks")}),e(G,{size:"xs",onClick:ge,children:a("inbounds.fallbacks.add","Add fallback")})]}),U.length===0?e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.fallbacks.empty","No fallbacks configured yet.")}):U.map((x,R)=>s(L,{borderWidth:"1px",borderRadius:"md",borderColor:Y,p:3,children:[s(St,{justify:"space-between",align:"center",mb:3,children:[s(h,{fontWeight:"semibold",children:[a("inbounds.fallbacks.type","Fallback")," #",R+1]}),e(G,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>D(R),children:a("hostsPage.delete","Delete")})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.fallbacks.dest","Destination (host:port)")}),e(tt,{placeholder:"example.com:443",...b(`fallbacks.${R}.dest`)})]}),s(w,{children:[e(C,{children:a("inbounds.fallbacks.path","Path")}),e(tt,{...b(`fallbacks.${R}.path`),placeholder:"/"})]}),s(w,{children:[e(C,{children:a("inbounds.fallbacks.type","Type")}),e(tt,{...b(`fallbacks.${R}.type`),placeholder:"none"})]}),s(w,{children:[e(C,{children:a("inbounds.fallbacks.alpn","ALPN")}),e(tt,{...b(`fallbacks.${R}.alpn`),placeholder:"h2,http/1.1"})]}),s(w,{children:[e(C,{children:"Xver"}),e(tt,{...b(`fallbacks.${R}.xver`),placeholder:"0"})]})]})]},x.id))]}),s(xe,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[s(St,{align:"center",justify:"space-between",children:[s(O,{spacing:2,children:[e(L,{fontWeight:"medium",children:a("inbounds.sniffing","Sniffing")}),e(at,{label:a("inbounds.sniffingHint","It is recommended to keep the default."),children:e(No,{width:16,height:16})})]}),e(ot,{...b("sniffingEnabled")})]}),te&&s(xe,{spacing:3,children:[s(w,{children:[e(C,{children:a("inbounds.sniffingDestinations","Protocols to sniff")}),e(st,{control:v,name:"sniffingDestinations",render:({field:x})=>{var R;return e(Xn,{value:(R=x.value)!=null?R:[],onChange:x.onChange,children:e(O,{spacing:4,children:oh.map(ee=>e(Sr,{value:ee.value,children:ee.label},ee.value))})})}})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.sniffingRouteOnly","Route only")}),e(ot,{...b("sniffingRouteOnly")})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("inbounds.sniffingMetadataOnly","Metadata only")}),e(ot,{...b("sniffingMetadataOnly")})]})]})]})]})}),s(_t,{children:[e(G,{variant:"ghost",mr:3,onClick:o,children:a("hostsPage.cancel","Cancel")}),e(G,{colorScheme:"primary",isLoading:l,onClick:y(we),children:n==="create"?a("common.create","Create"):a("common.save","Save")})]})]})]})},_h=()=>{const{t}=He(),n=Ut(),[r,l]=d.exports.useState([]),[o,i]=d.exports.useState(!0),[a,c]=d.exports.useState(!1),[u,p]=d.exports.useState(null),[g,f]=d.exports.useState({protocol:"all",search:""}),[A,v]=d.exports.useState(null),{isOpen:b,onOpen:y,onClose:_}=Yt(),[z,U]=d.exports.useState("create"),re=ur({base:!1,md:!0}),D=d.exports.useCallback(()=>{i(!0),p(null),Ce("/inbounds/full").then(se=>{l(se||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>i(!1))},[t]);d.exports.useEffect(()=>{D()},[D]);const B=d.exports.useMemo(()=>{const se=g.search.trim().toLowerCase();return r.filter(W=>{var Q;return g.protocol!=="all"&&W.protocol!==g.protocol?!1:se?W.tag.toLowerCase().includes(se)||((Q=W.port)==null?void 0:Q.toString().includes(se)):!0})},[r,g]),I=()=>{U("create"),v(null),y()},P=se=>{U("edit"),v(se),y()},_e=async se=>{var W;c(!0);try{const Q=bh(se),ue=z==="create"?"/inbounds":`/inbounds/${encodeURIComponent(Q.tag)}`;await Ce(ue,{method:z==="create"?"POST":"PUT",body:Q}),n({status:"success",title:z==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),kn(),await D(),_()}catch(Q){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((W=Q==null?void 0:Q.data)==null?void 0:W.detail)||(Q==null?void 0:Q.message)})}finally{c(!1)}},me=async se=>{var Q;const W=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:se.tag});if(!!window.confirm(W)){c(!0);try{await Ce(`/inbounds/${encodeURIComponent(se.tag)}`,{method:"DELETE"}),n({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),kn(),await D()}catch(ue){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((Q=ue==null?void 0:ue.data)==null?void 0:Q.detail)||(ue==null?void 0:ue.message)})}finally{c(!1)}}};return s(xe,{spacing:4,children:[s(St,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(be,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:g.search,onChange:se=>f(W=>({...W,search:se.target.value}))}),s(O,{spacing:3,children:[s(Ye,{width:"180px",value:g.protocol,onChange:se=>f(W=>({...W,protocol:se.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),ti.map(se=>e("option",{value:se,children:se.toUpperCase()},se))]}),e(G,{leftIcon:e(ts,{width:18,height:18}),onClick:I,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&s(br,{status:"error",children:[e(yr,{}),u]}),o?e(St,{justify:"center",py:10,children:e(xt,{})}):B.length===0?e(L,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):re?e(L,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:s(ys,{variant:"simple",size:"sm",children:[e(Wr,{bg:"gray.50",_dark:{bg:"gray.900"},children:s(Ct,{children:[e(Le,{children:t("inbounds.tag","Tag")}),e(Le,{children:t("inbounds.protocol","Protocol")}),e(Le,{children:t("inbounds.portLabel","Port")}),e(Le,{children:t("inbounds.network","Network")}),e(Le,{children:t("inbounds.security","Security")}),e(Le,{children:t("inbounds.sniffing","Sniffing")}),e(Le,{width:"120px",children:t("actions","Actions")})]})}),e(Nr,{children:B.map(se=>{var Q;const W=se.streamSettings||{};return s(Ct,{children:[s(ze,{children:[e(h,{fontWeight:"semibold",children:se.tag}),se.listen&&e(h,{fontSize:"sm",color:"gray.500",children:se.listen})]}),e(ze,{children:e(nt,{colorScheme:"purple",children:se.protocol})}),e(ze,{children:se.port}),e(ze,{children:W.network||"\u2014"}),e(ze,{children:W.security&&W.security!=="none"?e(nt,{colorScheme:"blue",children:W.security}):"\u2014"}),e(ze,{children:(Q=se.sniffing)!=null&&Q.enabled?e(nt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(nt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(ze,{children:s(O,{spacing:2,children:[e(Ne,{"aria-label":t("common.edit","Edit"),icon:e(ls,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>P(se)}),e(Ne,{"aria-label":t("common.delete","Delete"),icon:e(Vr,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>me(se),isLoading:a})]})})]},se.tag)})})]})}):e(xe,{spacing:3,children:B.map(se=>{var Q;const W=se.streamSettings||{};return s(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(St,{justify:"space-between",align:"center",mb:2,children:[s(L,{children:[e(h,{fontWeight:"semibold",children:se.tag}),s(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",se.port]})]}),s(O,{spacing:2,children:[e(Ne,{"aria-label":t("common.edit","Edit"),icon:e(ls,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>P(se)}),e(Ne,{"aria-label":t("common.delete","Delete"),icon:e(Vr,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>me(se),isLoading:a})]})]}),s(xe,{spacing:2,children:[s(O,{spacing:2,wrap:"wrap",children:[e(nt,{colorScheme:"purple",children:se.protocol}),W.network&&e(nt,{children:W.network}),W.security&&W.security!=="none"&&e(nt,{colorScheme:"blue",children:W.security})]}),s(O,{spacing:2,wrap:"wrap",children:[(Q=se.sniffing)!=null&&Q.enabled?e(nt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(nt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),se.listen&&e(nt,{size:"sm",colorScheme:"gray",children:se.listen})]})]})]},se.tag)})}),e(Ch,{isOpen:b,mode:z,initialValue:A,isSubmitting:a,onClose:_,onSubmit:_e})]})},Dh=()=>{const{t}=He();return s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),s(Js,{colorScheme:"primary",isLazy:!0,children:[s(qs,{children:[e(Bt,{children:s(O,{spacing:2,children:[e(gn,{as:Ro,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(Bt,{children:s(O,{spacing:2,children:[e(gn,{as:ko,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),s(Ys,{children:[e(Vt,{px:0,children:s(le,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(_h,{})]})}),e(Vt,{px:0,children:s(le,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(th,{})]})})]})]})]})},Ah=Ie.object({name:Ie.string().min(1),address:Ie.string().min(1),port:Ie.number().min(1).or(Ie.string().transform(t=>parseFloat(t))),api_port:Ie.number().min(1).or(Ie.string().transform(t=>parseFloat(t))),xray_version:Ie.string().nullable().optional(),id:Ie.number().nullable().optional(),status:Ie.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:Ie.string().nullable().optional(),add_as_new_host:Ie.boolean().optional(),usage_coefficient:Ie.number().or(Ie.string().transform(t=>parseFloat(t))),data_limit:Ie.number().nullable().optional(),uplink:Ie.number().nullable().optional(),downlink:Ie.number().nullable().optional(),use_nobetci:Ie.boolean().optional(),nobetci_port:Ie.number().nullable().optional()}),Vn=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,nobetci_port:null}),wr="fetch-nodes-query-key",ri=()=>{const{isEditingNodes:t}=ht();return es({queryKey:wr,queryFn:Rn.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Rn=Ks((t,n)=>({nodes:[],addNode(r){return Ce("/node",{method:"POST",body:r})},fetchNodes(){return Ce("/nodes")},fetchNodesUsage(r){return Ce("/nodes/usage",{query:r})},updateNode(r){return Ce(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return Ce(`/node/${r.id}/reconnect`,{method:"POST"})},resetNodeUsage(r){return Ce(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return Ce("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return Ce("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return Ce(`/node/${(r=n().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),Ki=({expiryDate:t,status:n,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=He(),a=fa(t),c=gs[n].icon;return s(Rt,{children:[s(Kr,{colorScheme:gs[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),l&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[n&&i(`nodeModal.status.${n}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},Ih=Z(yn,{baseStyle:{w:4,h:4}}),Th=Z(Xa,{baseStyle:{w:4,h:4}}),Ph=Z(wc,{baseStyle:{w:4,h:4}}),Eh=Z(So,{baseStyle:{w:4,h:4}}),Ji=1024*1024*1024,Nh=51031,hs=t=>{if(t&&typeof t=="object"&&"message"in t){const n=t.message;return typeof n=="string"?n:void 0}},qi=({isOpen:t,onClose:n,node:r,mutate:l,isLoading:o,isAddMode:i=!1})=>{var W,Q,ue,te,j,N,he,Ae,ve,M,E,F,ce,de,De,Ee;const{t:a}=He(),c=Ut(),[u,p]=d.exports.useState(i),{fetchNodesUsage:g}=Rn(),[f,A]=d.exports.useState(null),{data:v,isLoading:b}=es({queryKey:"node-settings",queryFn:()=>Ce("/node/settings")}),y=Y=>{if(Y==null)return null;const we=Y/Ji;return Number.isFinite(we)?Math.round(we*100)/100:null},_=Y=>Y==null?null:Math.round(Y*Ji),z=i?{...Vn(),add_as_new_host:!1}:{...Vn(),...r,add_as_new_host:!1},U=_r({resolver:ha(Ah),defaultValues:{...z,data_limit:y((W=z.data_limit)!=null?W:null)}}),re=(Q=v==null?void 0:v.certificate)!=null?Q:"",{onCopy:D,hasCopied:B}=Ho(re),I=U.watch("use_nobetci");d.exports.useEffect(()=>{if(!I){U.setValue("nobetci_port",null);return}const Y=U.getValues("nobetci_port");(Y==null||Y==="")&&U.setValue("nobetci_port",Nh)},[I,U]),d.exports.useEffect(()=>{var Y;if(t){const we=i?{...Vn(),add_as_new_host:!1}:{...Vn(),...r,add_as_new_host:!1};U.reset({...we,data_limit:y((Y=we.data_limit)!=null?Y:null)}),p(i&&!!re)}},[t,i,r,U,re]),d.exports.useEffect(()=>{!i&&r&&t?g({start:We().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(Y=>{const we=Y.usages[r.id];we&&A({uplink:we.uplink,downlink:we.downlink})}):A(null)},[r,i,t,g]);const P=U.handleSubmit(Y=>{var J;const we={...Y,data_limit:_((J=Y.data_limit)!=null?J:null)};l(we)}),_e=()=>{!re||(D(),c({title:a("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},me=()=>{if(!re)return;const Y=new Blob([re],{type:"text/plain"}),we=URL.createObjectURL(Y),J=document.createElement("a");J.href=we,J.download="ssl_client_cert.pem",J.click(),URL.revokeObjectURL(we)},se=()=>{p(!1),A(null),n()};return s(It,{isOpen:t,onClose:se,size:"lg",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",as:"form",onSubmit:P,children:[e(gt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i?"nodes.addNewMarzbanNode":"nodes.editNode")})}),e(Dt,{mt:3}),e(mt,{children:s(xe,{spacing:6,children:[!i&&f&&s(xe,{spacing:2,children:[e(h,{fontWeight:"medium",children:a("nodes.usage")}),s(O,{children:[s(nt,{colorScheme:"green",children:[a("nodes.uplink"),": ",ps.sizeFormat(f.uplink)]}),s(nt,{colorScheme:"blue",children:[a("nodes.downlink"),": ",ps.sizeFormat(f.downlink)]})]})]}),i&&s(xe,{spacing:3,children:[s(O,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("nodes.certificate")}),s(O,{spacing:2,children:[e(G,{size:"xs",variant:"outline",leftIcon:e(Ph,{}),onClick:_e,isDisabled:!re,children:a(B?"copied":"copy")}),e(G,{size:"xs",variant:"outline",leftIcon:e(Eh,{}),onClick:me,isDisabled:!re,children:a("nodes.download-certificate")}),e(at,{placement:"top",label:a(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(Ne,{"aria-label":a(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p(Y=>!Y),size:"xs",variant:"ghost",children:u?e(Th,{}):e(Ih,{})})})]})]}),e(Fs,{in:u&&!!re,animateOpacity:!0,children:e(L,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:re||(b?a("loading"):"")})}),!re&&!b&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:a("nodes.certificateUnavailable","Certificate not available.")})]}),s(xe,{spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(w,{children:e($t,{label:a("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...U.register("name"),error:hs((te=(ue=U.formState)==null?void 0:ue.errors)==null?void 0:te.name)})}),e(w,{children:e($t,{label:a("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...U.register("address"),error:hs((N=(j=U.formState)==null?void 0:j.errors)==null?void 0:N.address)})})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(w,{children:e($t,{label:a("nodes.nodePort"),size:"sm",placeholder:"62050",...U.register("port"),error:hs((Ae=(he=U.formState)==null?void 0:he.errors)==null?void 0:Ae.port)})}),e(w,{children:e($t,{label:a("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...U.register("api_port"),error:hs((M=(ve=U.formState)==null?void 0:ve.errors)==null?void 0:M.api_port)})})]}),e(w,{children:e($t,{label:a("nodes.usageCoefficient"),size:"sm",placeholder:"1",...U.register("usage_coefficient"),error:hs((F=(E=U.formState)==null?void 0:E.errors)==null?void 0:F.usage_coefficient)})}),s(w,{children:[e($t,{label:a("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:a("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...U.register("data_limit",{setValueAs:Y=>{if(Y===""||Y===null||Y===void 0)return null;const we=Number(Y);return Number.isFinite(we)?we:Number.NaN},validate:Y=>Y==null?!0:Number.isNaN(Y)?a("nodes.dataLimitValidation","Data limit must be a valid number"):Y>=0||a("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:hs((de=(ce=U.formState)==null?void 0:ce.errors)==null?void 0:de.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:a("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:a("nodes.useNobetci","Enable Nobetci integration")}),e(st,{control:U.control,name:"use_nobetci",render:({field:Y})=>e(ot,{isChecked:Boolean(Y.value),onChange:we=>Y.onChange(we.target.checked)})})]}),e(Fs,{in:Boolean(I),animateOpacity:!0,children:s(w,{mt:I?2:0,children:[e($t,{label:a("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...U.register("nobetci_port",{setValueAs:Y=>{if(Y===""||Y===null||Y===void 0)return null;const we=Number(Y);return Number.isFinite(we)?we:Number.NaN},validate:Y=>I?Y==null?a("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(Y)?a("nodes.nobetciPortInvalid","Enter a valid port number"):Y>=1&&Y<=65535?!0:a("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:hs((Ee=(De=U.formState)==null?void 0:De.errors)==null?void 0:Ee.nobetci_port)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:a("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]}),i&&e(L,{children:e(Sr,{...U.register("add_as_new_host"),children:a("nodes.addHostForEveryInbound")})})]})}),s(_t,{gap:3,children:[e(G,{variant:"outline",onClick:se,children:a("cancel")}),e(G,{type:"submit",colorScheme:"primary",isLoading:o,children:a(i?"nodes.addNode":"nodes.editNode")})]})]})]})},zh=({deleteCallback:t})=>{const{deleteNode:n,deletingNode:r,setDeletingNode:l}=Rn(),{t:o}=He(),i=Ut(),a=ja(),c=()=>{l(null)},{isLoading:u,mutate:p}=Lr(n,{onSuccess:()=>{qt(o("deleteNode.deleteSuccess",{name:r&&r.name}),i),l(null),a.invalidateQueries(wr),t&&t()},onError:g=>{Zt(g,i)}});return s(It,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",children:[e(gt,{pt:6,children:e(Ss,{color:"red",children:e(En,{})})}),e(Dt,{mt:3}),s(mt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ma,{components:{b:e("b",{})},children:o("deleteNode.prompt",{name:r.name})})})]}),s(_t,{display:"flex",children:[e(G,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(G,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:u?e(xt,{size:"xs"}):void 0,children:o("delete")})]})]})]})},Rh=10,Uh=({isOpen:t,title:n,description:r,currentVersion:l,allowPersist:o=!1,isSubmitting:i,onSubmit:a,onClose:c})=>{const{t:u}=He(),[p,g]=d.exports.useState(""),[f,A]=d.exports.useState(!1),[v,b]=d.exports.useState(null),y=es(["core-xray-releases"],()=>Ce("/core/xray/releases",{query:{limit:Rh}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(g(l||""),A(!1),b(null))},[t,l]);const _=d.exports.useMemo(()=>{var B,I;return(I=(B=y.data)==null?void 0:B.tags)!=null?I:[]},[y.data]),z=B=>{g(B.target.value)},U=B=>{g(B.target.value)},re=async()=>{if(!p){b(u("validation.required"));return}try{b(null),await a({version:p,persist:o?f:void 0})}catch(B){B instanceof Error?b(B.message):b(u("core.generalErrorMessage"))}},D=y.isLoading;return s(It,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(pt,{}),s(Tt,{children:[e(gt,{children:n}),e(Dt,{}),e(mt,{children:s(xe,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),s(w,{children:[e(C,{children:u("nodes.coreVersionDialog.latestReleases")}),e(Ye,{placeholder:u(D?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&_.includes(p)?p:"",onChange:z,isDisabled:D||_.length===0,size:"sm",children:_.map(B=>e("option",{value:B,children:B},B))}),D&&s(xe,{direction:"row",align:"center",spacing:2,mt:2,children:[e(xt,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),y.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),s(w,{isRequired:!0,children:[e(C,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(be,{value:p,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:U,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),o&&e(Sr,{isChecked:f,onChange:B=>A(B.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),v&&s(br,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(yr,{}),e(os,{children:v})]})]})}),s(_t,{children:[e(G,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(G,{colorScheme:"primary",onClick:re,isLoading:i,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},Yi="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",Lh=Z(Bo,{baseStyle:{w:3.5,h:3.5}}),Mh=Z(ts,{baseStyle:{w:3.5,h:3.5}}),Oh=Z($r,{baseStyle:{w:4,h:4}}),Wh=({isOpen:t,title:n,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:o,onSubmit:i,onClose:a})=>{const{t:c}=He(),[u,p]=d.exports.useState("template"),[g,f]=d.exports.useState(Yi),[A,v]=d.exports.useState(""),[b,y]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[_,z]=d.exports.useState(!0),[U,re]=d.exports.useState(!1),[D,B]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),f(o||Yi),v(""),y([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),z(!0),re(!1),B(null))},[t,o]);const I=es(["geo-templates",g],()=>Ce("/core/geo/templates",{query:g?{index_url:g}:void 0}),{enabled:t&&u==="template"&&Boolean(g),staleTime:10*60*1e3}),P=d.exports.useMemo(()=>{var te,j;return(j=(te=I.data)==null?void 0:te.templates)!=null?j:[]},[I.data]);d.exports.useEffect(()=>{P.length>0&&v(te=>te||P[0].name)},[P]);const _e=Qe("gray.50","whiteAlpha.50"),me=()=>{y(te=>[...te,{name:"",url:""}])},se=(te,j,N)=>{y(he=>he.map((Ae,ve)=>ve===te?{...Ae,[j]:N}:Ae))},W=te=>{y(j=>j.filter((N,he)=>he!==te))},Q=async()=>{const te=u==="manual"?b.filter(N=>N.name.trim()&&N.url.trim()):[];if(u==="template"){if(!g.trim()){B(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!A){B(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(te.length===0){B(c("nodes.geoDialog.errors.missingFiles"));return}if(te.find(he=>!he.name.trim()||!he.url.trim())){B(c("nodes.geoDialog.errors.invalidFile"));return}}B(null);const j=u==="manual"?te:[];try{await i({mode:u,templateIndexUrl:g.trim(),templateName:A,files:j,persistEnv:_,applyToNodes:U})}catch(N){const he=N instanceof Error?N.message:c("nodes.geoDialog.genericError");B(he)}},ue=()=>s(xe,{spacing:3,bg:_e,p:4,borderRadius:"md",children:[b.map((te,j)=>s(L,{borderWidth:"1px",borderRadius:"md",p:3,children:[s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(w,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(be,{size:"sm",value:te.name,placeholder:"geosite.dat",onChange:N=>se(j,"name",N.target.value)})]}),s(w,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(be,{size:"sm",value:te.url,placeholder:"https://example.com/geosite.dat",onChange:N=>se(j,"url",N.target.value)})]})]}),e(O,{justify:"flex-end",mt:3,children:e(at,{label:c("nodes.geoDialog.removeFile"),children:e(Ne,{"aria-label":"remove file",icon:e(Lh,{}),variant:"ghost",size:"sm",onClick:()=>W(j),isDisabled:b.length<=1})})})]},`manual-file-${j}`)),e(G,{onClick:me,leftIcon:e(Mh,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return s(It,{isOpen:t,onClose:a,size:"xl",isCentered:!0,children:[e(pt,{}),s(Tt,{children:[e(gt,{children:n}),e(Dt,{}),e(mt,{children:s(xe,{spacing:4,children:[s(w,{as:"fieldset",children:[e(C,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(oa,{value:u,onChange:te=>p(te),children:s(O,{spacing:4,children:[e(Mr,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Mr,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?s(xe,{spacing:3,children:[s(w,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(be,{size:"sm",value:g,onChange:te=>f(te.target.value)})]}),s(w,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),s(O,{align:"center",spacing:2,children:[e(Ye,{size:"sm",flex:1,value:A,onChange:te=>v(te.target.value),isDisabled:I.isLoading||!P.length,placeholder:I.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:P.map(te=>e("option",{value:te.name,children:te.name},te.name))}),e(at,{label:c("nodes.geoDialog.refreshTemplates"),children:e(Ne,{"aria-label":"refresh templates",icon:e(Oh,{}),size:"sm",variant:"outline",onClick:()=>I.refetch(),isLoading:I.isFetching,isDisabled:!g.trim()})})]})]}),I.isError&&s(br,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(yr,{}),e(os,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):ue(),l&&s(xe,{spacing:2,children:[e(Sr,{isChecked:_,onChange:te=>z(te.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(Sr,{isChecked:U,onChange:te=>re(te.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),D&&s(br,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(yr,{}),e(os,{children:D})]})]})}),s(_t,{children:[e(G,{variant:"ghost",mr:3,onClick:a,children:c("cancel")}),e(G,{colorScheme:"primary",onClick:Q,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};We.extend(Pn);const Fh=Z(ts,{baseStyle:{w:4,h:4}}),Hh=Z(Vr,{baseStyle:{w:4,h:4}}),Bh=Z(ls,{baseStyle:{w:4,h:4}}),Gi=Z($r,{baseStyle:{w:4,h:4}}),Vh=Z(Do,{baseStyle:{w:4,h:4}}),hl=1024**3,$h=t=>{if(t==null)return"";const n=t/hl;return Number.isFinite(n)?(Math.round(n*100)/100).toString():""},Xi=t=>{const n=t.trim();if(!n)return null;const r=Number(n);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*hl)},Kh=()=>{var Xs,Un,Ln,Mn,On,Wn,Rr,ds,Fn,Hn,Bn,Qs,Zs;const{t}=He(),{onEditingNodes:n}=ht(),r=ht(ye=>ye.isEditingNodes),{data:l,isLoading:o,error:i,refetch:a,isFetching:c}=ri(),{addNode:u,updateNode:p,reconnectNode:g,resetNodeUsage:f,updateMasterNode:A,resetMasterUsage:v,setDeletingNode:b}=Rn(),y=ja(),_=Ut(),[z,U]=d.exports.useState(null),[re,D]=d.exports.useState(!1),[B,I]=d.exports.useState(""),[P,_e]=d.exports.useState(null),[me,se]=d.exports.useState(null),[W,Q]=d.exports.useState(null),[ue,te]=d.exports.useState(null),[j,N]=d.exports.useState(!1),[he,Ae]=d.exports.useState(!1),[ve,M]=d.exports.useState(!1),[E,F]=d.exports.useState(null),[ce,de]=d.exports.useState({}),[De,Ee]=d.exports.useState(null),[Y,we]=d.exports.useState(null),{isOpen:J,onOpen:Se,onClose:X}=Yt(),ge=d.exports.useRef(null),[ke,Xe]=d.exports.useState(""),[ie,ne]=d.exports.useState(!1),{isOpen:oe,onOpen:K,onClose:fe}=Yt(),dt=d.exports.useRef(null),{data:Je,isLoading:q,refetch:x,error:R}=es(["core-stats"],()=>Ce("/core"),{refetchOnWindowFocus:!1}),{data:ee,isLoading:Pe,error:Be,refetch:rt}=es(["master-node-state"],()=>Ce("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(n(!0),()=>{n(!1)}),[n]),d.exports.useEffect(()=>{var vt,m;if(!ee)return;if(ie){const S=Xi(ke),H=(vt=ee.data_limit)!=null?vt:null;if(S!==H)return}const ye=$h((m=ee.data_limit)!=null?m:null);Xe(ye),ie&&ne(!1)},[ee,ie,ke]);const{isLoading:lt,mutate:At}=Lr(u,{onSuccess:()=>{qt(t("nodes.addNodeSuccess"),_),y.invalidateQueries(wr),D(!1)},onError:ye=>{Zt(ye,_)}}),{isLoading:Ze,mutate:Oe}=Lr(p,{onSuccess:()=>{qt(t("nodes.nodeUpdated"),_),y.invalidateQueries(wr),U(null)},onError:ye=>{Zt(ye,_)}}),{isLoading:kt,mutate:zt}=Lr(g,{onSuccess:()=>{y.invalidateQueries(wr)}}),{mutate:Kt,isLoading:or}=Lr(p,{onSuccess:()=>{y.invalidateQueries(wr)},onError:ye=>{Zt(ye,_)},onSettled:(ye,vt,m)=>{(m==null?void 0:m.id)!=null&&de(S=>{const H={...S};return delete H[m.id],H}),F(null)}}),{isLoading:Gt,mutate:er}=Lr(f,{onSuccess:()=>{qt(t("nodes.resetUsageSuccess","Node usage reset"),_),y.invalidateQueries(wr)},onError:ye=>{Zt(ye,_)},onSettled:()=>{Ee(null),we(null),X()}}),{isLoading:Wt,mutate:Ge}=Lr(A,{onSuccess:()=>{qt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),_),rt(),ne(!1)},onError:ye=>{Zt(ye,_)}}),{isLoading:ut,mutate:tr}=Lr(v,{onSuccess:()=>{qt(t("nodes.resetMasterUsageSuccess","Master usage reset"),_),rt(),fe()},onError:ye=>{Zt(ye,_)}}),Et=d.exports.useMemo(()=>Xi(ke),[ke]),rr=(Xs=ee==null?void 0:ee.data_limit)!=null?Xs:null,$=Et===void 0,k=Et!==void 0&&Et!==rr,T=q||Pe,Te=d.exports.useMemo(()=>{if(R instanceof Error)return R.message;if(typeof R=="string")return R;if(Be instanceof Error)return Be.message;if(typeof Be=="string")return Be},[R,Be]),Fe=(Un=ee==null?void 0:ee.total_usage)!=null?Un:0,Re=(Ln=ee==null?void 0:ee.data_limit)!=null?Ln:null,et=(Mn=ee==null?void 0:ee.remaining_data)!=null?Mn:null,ft=ee!=null&&ee.updated_at?We(ee.updated_at).local().format("YYYY-MM-DD HH:mm"):null,Pt=(On=ee==null?void 0:ee.status)!=null?On:"error",it=qe(Fe,2),Nt=Re!==null&&Re>0?qe(Re,2):t("nodes.unlimited","Unlimited"),Lt=et!=null?qe(et,2):null,Jr=ye=>{ne(!0),Xe(ye)},qr=()=>{if($||Et===void 0){Zt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),_);return}Ge({data_limit:Et!=null?Et:null})},Dr=()=>{ne(!0),Xe(""),Ge({data_limit:null})},Mt=()=>{K()},zr=ye=>{if(!(ye!=null&&ye.id))return;const vt=ye.status!=="disabled",m=vt?"disabled":"connecting",S=ye.id;F(S),de(H=>({...H,[S]:!vt})),Kt({...ye,status:m})},Ar=ye=>{!(ye!=null&&ye.id)||(we(ye),Se())},Yr=()=>{!(Y!=null&&Y.id)||(Ee(Y.id),er(Y))},sr=()=>{we(null),X()},nr=()=>_e(null),Ir=()=>se(null),bt=async({version:ye,persist:vt})=>{var m;if(!!P){if(P.type==="master"){N(!0);try{await Ce("/core/xray/update",{method:"POST",body:{version:ye,persist_env:Boolean(vt)}}),qt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:ye}),_),await Promise.all([x(),y.invalidateQueries(wr)]),nr()}catch(S){Zt(S,_)}finally{N(!1)}return}if(P.type==="bulk"){const S=(l!=null?l:[]).filter(H=>H.id!=null&&H.status==="connected");if(S.length===0){_({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}Ae(!0);try{const H=[];for(const je of S)try{await Ce(`/node/${je.id}/xray/update`,{method:"POST",body:{version:ye}}),H.push({status:"fulfilled",node:je})}catch(Qt){H.push({status:"rejected",node:je}),Zt(Qt,_)}const Ue=H.filter(je=>je.status==="fulfilled").length,$e=H.length-Ue,Me=H.length;Ue>0&&qt(t("nodes.coreVersionDialog.bulkSuccess",{success:Ue,total:Me}),_),$e>0&&_({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:$e,total:Me}),status:"error",isClosable:!0,position:"top",duration:4e3}),y.invalidateQueries(wr),nr()}finally{Ae(!1)}return}if(P.type==="node"){const S=P.node;if(!(S!=null&&S.id))return;Q(S.id);try{await Ce(`/node/${S.id}/xray/update`,{method:"POST",body:{version:ye}}),qt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(m=S.name)!=null?m:t("nodes.unnamedNode","Unnamed node"),version:ye}),_),y.invalidateQueries(wr),nr()}catch(H){Zt(H,_)}finally{Q(null)}}}},kr=async ye=>{var m;if(!me)return;const vt={mode:ye.mode,template_index_url:ye.templateIndexUrl,template_name:ye.templateName,files:ye.files,persist_env:ye.persistEnv};if(me.type==="master"){M(!0);try{await Ce("/core/geo/update",{method:"POST",body:vt}),qt(t("nodes.geoDialog.masterUpdateSuccess"),_),Ir()}catch(S){Zt(S,_)}finally{M(!1)}return}if(me.type==="node"){const S=me.node;if(!(S!=null&&S.id))return;te(S.id);try{await Ce(`/node/${S.id}/geo/update`,{method:"POST",body:vt}),qt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(m=S.name)!=null?m:t("nodes.unnamedNode","Unnamed node")}),_),y.invalidateQueries(wr),Ir()}catch(H){Zt(H,_)}finally{te(null)}}},yt=d.exports.useMemo(()=>{if(!l)return[];const ye=B.trim().toLowerCase();return ye?l.filter(vt=>{var Ue,$e,Me;const m=((Ue=vt.name)!=null?Ue:"").toLowerCase(),S=(($e=vt.address)!=null?$e:"").toLowerCase(),H=((Me=vt.xray_version)!=null?Me:"").toLowerCase();return m.includes(ye)||S.includes(ye)||H.includes(ye)}):l},[l,B]),pr=d.exports.useMemo(()=>(l!=null?l:[]).some(ye=>ye.id!=null&&ye.status==="connected"),[l]),Jt=d.exports.useMemo(()=>{if(!!i){if(i instanceof Error)return i.message;if(typeof i=="string")return i;if(typeof i=="object"&&"message"in i){const ye=i.message;if(typeof ye=="string")return ye}return t("errorOccurred")}},[i,t]),lr=Boolean(Jt),Xt=t("nodes.masterNode","Master"),Tr=B.trim().toLowerCase(),pe=!Tr||Xt.toLowerCase().includes(Tr)||((Wn=Je==null?void 0:Je.version)!=null?Wn:"").toLowerCase().includes(Tr),Cs=(P==null?void 0:P.type)==="master"?j:(P==null?void 0:P.type)==="node"?P.node.id!=null&&W===P.node.id:(P==null?void 0:P.type)==="bulk"?he:!1,Gr=(me==null?void 0:me.type)==="master"?ve:(me==null?void 0:me.type)==="node"?me.node.id!=null&&ue===me.node.id:!1,_s=(P==null?void 0:P.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(P==null?void 0:P.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(P==null?void 0:P.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Rr=P.node.name)!=null?Rr:t("nodes.unnamedNode","Unnamed node")}):"",Ds=(P==null?void 0:P.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(P==null?void 0:P.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(P==null?void 0:P.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(ds=P.node.name)!=null?ds:t("nodes.unnamedNode","Unnamed node")}):"",As=(P==null?void 0:P.type)==="master"?(Fn=Je==null?void 0:Je.version)!=null?Fn:"":(P==null?void 0:P.type)==="node"&&(Hn=P.node.xray_version)!=null?Hn:"",ba=(me==null?void 0:me.type)==="master"?t("nodes.geoDialog.masterTitle"):(me==null?void 0:me.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(Bn=me.node.name)!=null?Bn:t("nodes.unnamedNode","Unnamed node")}):"";return s(le,{spacing:6,align:"stretch",children:[s(xe,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),lr&&s(br,{status:"error",borderRadius:"md",children:[e(yr,{}),e(os,{children:Jt})]}),s(xe,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),s(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[s(O,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[s(hr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(Ao,{pointerEvents:"none",children:e(Vh,{color:"gray.400"})}),e(be,{value:B,onChange:ye=>I(ye.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(at,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(Ne,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(Gi,{}),variant:"ghost",size:"sm",onClick:()=>a(),isLoading:c})})]}),s(xe,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(G,{variant:"outline",size:"sm",onClick:()=>_e({type:"bulk"}),isDisabled:!pr,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(G,{leftIcon:e(Fh,{}),colorScheme:"primary",size:"sm",onClick:()=>D(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),o?e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((ye,vt)=>e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:s(le,{spacing:3,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${vt}`))}):s(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:[pe&&e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:T?s(le,{spacing:3,align:"center",justify:"center",children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Te?s(le,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Te}),e(G,{size:"sm",variant:"outline",onClick:()=>{x(),rt()},children:t("refresh","Refresh")})]}):ee?s(le,{align:"stretch",spacing:4,children:[s(xe,{spacing:2,children:[s(O,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:Xt}),e(nt,{colorScheme:"purple",size:"sm",children:Je!=null&&Je.version?`Xray ${Je.version}`:t("nodes.versionUnknown","Version unknown")})]}),s(O,{spacing:2,align:"center",children:[e(Ki,{status:Pt,compact:!0}),ee.limit_exceeded&&e(nt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Je!=null&&Je.started?t("nodes.masterStartedAt",{date:We(Je.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),ee.message&&s(br,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(yr,{}),e(os,{fontSize:"sm",children:ee.message})]}),e(Ms,{}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:it})]}),s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:Nt})]}),Lt&&s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:Lt})]}),ft&&s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:ft})]})]}),s(xe,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[s(hr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(be,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:ke,onChange:ye=>Jr(ye.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(xr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(G,{colorScheme:"primary",size:"sm",onClick:qr,isDisabled:!k||$||Wt,isLoading:Wt,children:t("save","Save")}),e(G,{variant:"ghost",size:"sm",onClick:Dr,isDisabled:Re===null||Wt,isLoading:Wt&&Re===null,children:t("nodes.clearDataLimit","Clear limit")})]}),$&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),s(xe,{direction:{base:"column",sm:"row"},spacing:2,children:[e(G,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>_e({type:"master"}),isLoading:j,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(G,{size:"sm",variant:"outline",onClick:()=>se({type:"master"}),isLoading:ve,children:t("nodes.geoDialog.updateMasterButton")}),e(G,{size:"sm",variant:"outline",colorScheme:"red",onClick:Mt,isLoading:ut,children:t("nodes.resetUsage","Reset usage")})]})]}):s(le,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(G,{size:"sm",variant:"outline",onClick:()=>{x(),rt()},children:t("refresh","Refresh")})]})},"master-node"),yt.length>0?yt.map(ye=>{var Qt,us,ns,js;const vt=ye.status||"error",m=ye==null?void 0:ye.id,S=vt!=="disabled"&&vt!=="limited",H=m!=null?ce[m]:void 0,Ue=H!=null?H:S,$e=m!=null&&E===m&&or,Me=m!=null&&W===m,je=m!=null&&ue===m;return e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:s(le,{align:"stretch",spacing:4,children:[s(xe,{spacing:2,children:[s(O,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:ye.name||t("nodes.unnamedNode","Unnamed node")}),e(ot,{size:"sm",colorScheme:"primary",isChecked:Ue,onChange:()=>zr(ye),isDisabled:$e,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),ye.status==="error"&&e(G,{size:"sm",variant:"outline",leftIcon:e(Gi,{}),onClick:()=>zt(ye),isLoading:kt,children:t("nodes.reconnect")})]}),s(O,{spacing:2,flexWrap:"wrap",children:[e(Ki,{status:vt,compact:!0}),s(O,{spacing:1,align:"center",children:[e(nt,{colorScheme:"blue",size:"sm",children:ye.xray_version?`Xray ${ye.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(G,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>m&&_e({type:"node",node:ye}),isLoading:Me,isDisabled:!m,children:t("nodes.updateCoreAction")})]}),e(G,{size:"xs",variant:"ghost",onClick:()=>m&&se({type:"node",node:ye}),isLoading:je,isDisabled:!m,children:t("nodes.updateGeoAction","Update geo")}),e(G,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Ar(ye),isLoading:Gt&&m!=null&&De===m,isDisabled:!m,children:t("nodes.resetUsage","Reset usage")})]}),vt==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(Ms,{}),s(Ve,{columns:{base:1,sm:2},spacingY:2,children:[s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:ye.address})]}),s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:ye.port})]}),s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:ye.api_port})]}),s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:ye.usage_coefficient})]}),s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:qe(((Qt=ye.uplink)!=null?Qt:0)+((us=ye.downlink)!=null?us:0),2)})]}),s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:ye.data_limit!=null&&ye.data_limit>0?qe(ye.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(Ms,{}),s(O,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[s(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(ns=ye.id)!=null?ns:"-"]}),s(Io,{size:"sm",variant:"ghost",children:[e(Ne,{"aria-label":t("edit"),icon:e(Bh,{}),onClick:()=>U(ye)}),e(Ne,{"aria-label":t("delete"),icon:e(Hh,{}),colorScheme:"red",onClick:()=>b(ye)})]})]})]})},(js=ye.id)!=null?js:ye.name)}):e(L,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(Uh,{isOpen:Boolean(P),onClose:nr,onSubmit:bt,currentVersion:As,title:_s,description:Ds,allowPersist:(P==null?void 0:P.type)==="master",isSubmitting:Cs}),e(Wh,{isOpen:Boolean(me),onClose:Ir,onSubmit:kr,title:ba,showMasterOptions:(me==null?void 0:me.type)==="master",isSubmitting:Gr}),e(Sn,{isOpen:J,leastDestructiveRef:ge,onClose:sr,children:e(pt,{children:s(xn,{children:[e(gt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(mt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(Zs=(Qs=Y==null?void 0:Y.name)!=null?Qs:Y==null?void 0:Y.address)!=null?Zs:t("nodes.thisNode","this node")})}),s(_t,{children:[e(G,{ref:ge,onClick:sr,children:t("cancel","Cancel")}),e(G,{colorScheme:"red",onClick:Yr,ml:3,isLoading:Gt,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Sn,{isOpen:oe,leastDestructiveRef:dt,onClose:fe,children:e(pt,{children:s(xn,{children:[e(gt,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(mt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:Xt})}),s(_t,{children:[e(G,{ref:dt,onClick:fe,children:t("cancel","Cancel")}),e(G,{colorScheme:"red",onClick:()=>tr(),ml:3,isLoading:ut,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(qi,{isOpen:re,onClose:()=>D(!1),mutate:At,isLoading:lt,isAddMode:!0}),e(qi,{isOpen:!!z,onClose:()=>U(null),node:z||void 0,mutate:Oe,isLoading:Ze}),e(zh,{deleteCallback:()=>y.invalidateQueries(wr)})]})},Jh=Ks(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([Ce("/core").then(({version:n,started:r,logs_websocket:l})=>{t({version:n,started:r,logs_websocket:l})}).catch(n=>{throw console.error("Error fetching /core:",n),n}),Ce("/core/config").then(n=>{t({config:n})}).catch(n=>{throw console.error("Error fetching /core/config:",n),n})])}finally{t({isLoading:!1})}},updateConfig:n=>(t({isPostLoading:!0}),Ce("/core/config",{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>Ce("/core/restart",{method:"POST"})}));const $a=d.exports.forwardRef(({json:t,onChange:n,mode:r="code"},l)=>{const{colorMode:o}=cs(),i=d.exports.useRef(null),a=d.exports.useRef(null),c=d.exports.useRef(n),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=n},[n]);const p=d.exports.useCallback(v=>{u.current=v,c.current(v)},[]);d.exports.useEffect(()=>{if(!i.current)return;const v=new vc(i.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:o==="dark"?"ace/theme/one_dark":"ace/theme/github"});a.current=v;const b=v.aceEditor;b&&(b.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),b.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?v.setText(t):t!==void 0&&v.set(t)}catch{typeof t=="string"&&v.updateText(t)}return()=>{v.destroy(),a.current=null}},[]),d.exports.useEffect(()=>{const v=a.current;if(!v)return;const y=(z=>{if(z==null)return"";if(typeof z=="string")return z;try{return JSON.stringify(z,null,2)}catch{return""}})(t);if(y===null)return;if(u.current!==null){let z=u.current;try{z=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,z===y)return}let _=null;try{_=v.getText()}catch{_=null}if(_!==y)if(typeof t=="string")try{v.updateText(y)}catch{v.setText(y)}else{const z=t==null?{}:t;try{v.update(z)}catch{v.set(z)}}},[t]),d.exports.useEffect(()=>{const v=a.current;if(!!v)try{v.getMode&&v.getMode()!==r?v.setMode(r):v.getMode||v.setMode(r)}catch{v.setMode(r)}},[r]),d.exports.useEffect(()=>{var b;const v=(b=a.current)==null?void 0:b.aceEditor;!v||v.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github")},[o]);const g=Qe("gray.300","whiteAlpha.300"),f=Qe("surface.light","surface.dark"),A=Qe("sm","none");return e(L,{ref:l,border:"1px solid",borderColor:g,bg:f,borderRadius:"lg",h:"full",boxShadow:A,overflow:"hidden",children:e(L,{height:"full",ref:i})})}),qh=Z(Cn,{baseStyle:{w:4,h:4}}),Yh=Z(zo,{baseStyle:{w:4,h:4}}),pl=({triggerLabel:t,title:n,children:r})=>{const l=ur({base:!0,md:!1});return s(_n,{placement:l?"bottom":"right",isLazy:!0,children:[e(Dn,{children:e(G,{size:"xs",variant:"outline",children:t!=null?t:e(qh,{})})}),s(An,{children:[e(In,{}),e(Fo,{}),n&&e(Cc,{fontWeight:"semibold",children:n}),e(Tn,{children:r})]})]})},Gh=({chips:t,color:n="blue"})=>{const r=t[0],l=t.slice(1);return s(O,{spacing:2,align:"center",children:[r?e(nt,{size:"sm",colorScheme:n,children:r}):e(h,{color:"gray.400",children:"-"}),l.length>0&&e(pl,{triggerLabel:s(nt,{size:"sm",children:["+",l.length]}),title:"Details",children:e(le,{align:"stretch",children:t.map((o,i)=>e(O,{justify:"space-between",children:e(h,{children:o})},i))})})]})},Xh=({text:t,label:n})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:o}=Ho(t!=null?t:"");return e(O,{spacing:2,align:"center",children:e(pl,{triggerLabel:r,title:n,children:s(le,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),s(O,{children:[e(Ne,{"aria-label":"copy",size:"sm",icon:e(Yh,{}),onClick:o}),e(h,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},Qi=500,Qh=t=>{try{let n=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(n.protocol==="https:"?"wss://":"ws://")+bo([n.host+n.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+la()}catch(n){return console.error("Unable to generate websocket url"),console.error(n),null}},ml=({showTitle:t=!0})=>{const{t:n}=He(),{data:r}=ri(),[l,o]=d.exports.useState(""),[i,a]=d.exports.useState([]),c=d.exports.useRef(null),[u,p]=d.exports.useState(!0),{colorMode:g}=cs(),f=D=>{if(D!==l){if(!D){o(""),a([]);return}o(D),a([])}},A=d.exports.useCallback(_c.exports.debounce(D=>{a(B=>B.length>=Qi?[...B.slice(B.length-Qi+1),D]:[...B,D])},50),[]);d.exports.useEffect(()=>()=>{A.cancel()},[A]);const{readyState:v}=Dc(Qh(l),{onMessage:D=>{var B;A((B=D.data)!=null?B:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const D=c.current;if(!D)return;const B=()=>{const P=D.scrollHeight-D.scrollTop-D.clientHeight<=32;p(P)};return D.addEventListener("scroll",B),B(),()=>{D.removeEventListener("scroll",B)}},[]),d.exports.useEffect(()=>{u&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[i,u]);const b=d.exports.useMemo(()=>{const D=g==="dark";return{error:{bg:D?"rgba(248, 113, 113, 0.16)":"red.50",color:D?"#fed7d7":"#c53030",border:D?"#f87171":"#feb2b2"},warn:{bg:D?"rgba(251, 191, 36, 0.18)":"orange.50",color:D?"#fefcbf":"#975a16",border:D?"#fbbf24":"#f6ad55"},info:{bg:D?"rgba(96, 165, 250, 0.18)":"blue.50",color:D?"#bfdbfe":"#1a56db",border:D?"#60a5fa":"#63b3ed"},debug:{bg:D?"rgba(148, 163, 184, 0.16)":"gray.100",color:D?"#e2e8f0":"#1f2933",border:D?"#94a3b8":"#cbd5e1"},default:{bg:D?"rgba(30, 64, 175, 0.1)":"gray.50",color:D?"#e2e8f0":"#1f2933",border:D?"#475569":"#e2e8f0"}}},[g]),y=Qe("#f5f7fb","#1f2329"),_=Qe("gray.200","gray.600"),z=Qe("gray.500","gray.400"),U=Qe("white","gray.700"),re=D=>/error|failed|exception/i.test(D)?"error":/warn/i.test(D)?"warn":/info/i.test(D)?"info":/debug/i.test(D)?"debug":"default";return s(le,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:n("header.xrayLogs")}),s(xe,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[s(xe,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(r==null?void 0:r[0])&&s(Ye,{size:"sm",w:{base:"full",sm:"auto"},bg:U,onChange:D=>f(D.target.value),value:l,children:[e("option",{value:"",children:n("core.master")}),r.map(D=>e("option",{value:String(D.id),children:n(D.name)},D.address))]}),e(h,{fontSize:"sm",color:z,children:n(`core.socket.${v}`)})]}),e(h,{fontSize:"xs",color:z,children:u?n("core.autoScrollOn","Auto-scroll: On"):n("core.autoScrollOff","Auto-scroll: Off")})]}),e(L,{border:"1px solid",borderColor:_,bg:y,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:c,fontFamily:"mono",fontSize:"sm",children:e(le,{align:"stretch",spacing:2,children:i.map((D,B)=>{var _e;const I=re(D),P=(_e=b[I])!=null?_e:b.default;return e(L,{bg:P.bg,color:P.color,borderLeftWidth:3,borderLeftColor:P.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(Z.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:D})},`${D}-${B}`)})})})]})},Zh=Z(ts),jh=Z(Bo),ar={tag:"",protocol:ae.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:il.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},Es=t=>{const n={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case ae.VMess:n.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case ae.VLESS:n.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case ae.Trojan:n.servers=[{address:r,port:l,password:t.password||void 0}];break;case ae.Shadowsocks:n.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case ae.Socks:case ae.HTTP:n.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case ae.Freedom:n.domainStrategy=t.freedomStrategy||void 0;break;case ae.Blackhole:n.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case ae.DNS:n.network=t.dnsNetwork,n.address=t.dnsAddress||void 0,n.port=Number(t.dnsPort)||void 0;break;case ae.Wireguard:n.secretKey=t.wireguardSecret||void 0,n.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,n.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const o=new is;o.network=t.network,o.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?o.tcp=new jr(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?o.ws=new xs(t.wsPath,t.wsHost,0):t.network==="grpc"&&(o.grpc=new ks(t.grpcServiceName,"",!1)),t.tlsEnabled&&(o.tls=new ws(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(o.reality=new $s(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const a=new Ht(t.tag,t.protocol,n,o,void 0).toJson();return a.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(a.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),a},ep=({isOpen:t,onClose:n,mode:r,initialOutbound:l,onSubmitOutbound:o})=>{const{t:i}=He(),a=Ut(),c=Qe("gray.50","whiteAlpha.100"),{control:u,register:p,reset:g,handleSubmit:f,watch:A,getValues:v,setValue:b,formState:{isValid:y}}=_r({defaultValues:ar,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:_,append:z,remove:U}=fn({control:u,name:"wireguardPeers"}),re=A("protocol"),D=A("network"),B=A("tlsEnabled"),I=A("realityEnabled"),P=A("tcpType"),_e=A("muxEnabled"),me=i("validation.required",{defaultValue:"Required"}),se=i("validation.invalidPort",{defaultValue:"Invalid port"}),W=re||ae.VLESS,Q=![ae.Freedom,ae.Blackhole,ae.DNS,ae.Wireguard].includes(W),ue=[ae.VMess,ae.VLESS].includes(W),te=[ae.Trojan,ae.Shadowsocks].includes(W),j=W===ae.Shadowsocks,N=W===ae.DNS,he=Ot({control:u}),[Ae,ve]=d.exports.useState(0),[M,E]=d.exports.useState(()=>Es(ar)),[F,ce]=d.exports.useState(()=>JSON.stringify(Es(ar),null,2)),[de,De]=d.exports.useState(null),[Ee,Y]=d.exports.useState(""),we=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;ve(0),De(null),Y("");const ne=l?Se(l):ar;we.current=!0,g(ne);const oe=Es(ne);E(oe),ce(JSON.stringify(oe,null,2))},[l,t,g]),d.exports.useEffect(()=>{if(!he)return;if(we.current){we.current=!1;return}const ne=Es(he);E(ne);const oe=JSON.stringify(ne,null,2);ce(K=>K===oe?K:oe),De(null)},[he]);const J=d.exports.useMemo(()=>[ae.VLESS,ae.VMess,ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP,ae.Freedom,ae.Blackhole,ae.DNS,ae.Wireguard],[]),Se=ne=>{var dt,Je,q,x,R,ee,Pe,Be,rt,lt,At,Ze,Oe,kt,zt,Kt,or,Gt,er,Wt,Ge,ut,tr,Et,rr,$,k,T,Te,Fe,Re,et,ft,Pt,it,Nt,Lt,Jr,qr,Dr,Mt,zr,Ar,Yr,sr,nr,Ir,bt,kr,yt,pr,Jt,lr,Xt,Tr;const oe=Ht.fromJson(ne),K={...ar,tag:(dt=ne==null?void 0:ne.tag)!=null?dt:"",protocol:(oe==null?void 0:oe.protocol)||ar.protocol,sendThrough:(Je=ne==null?void 0:ne.sendThrough)!=null?Je:"",muxEnabled:Boolean((q=ne==null?void 0:ne.mux)==null?void 0:q.enabled),muxConcurrency:Number((R=(x=ne==null?void 0:ne.mux)==null?void 0:x.concurrency)!=null?R:ar.muxConcurrency)},fe=oe==null?void 0:oe.stream;switch(K.network=(ee=fe==null?void 0:fe.network)!=null?ee:ar.network,K.tlsEnabled=(fe==null?void 0:fe.security)==="tls",K.realityEnabled=(fe==null?void 0:fe.security)==="reality",K.tlsServerName=(Be=(Pe=fe==null?void 0:fe.tls)==null?void 0:Pe.serverName)!=null?Be:"",K.realityPublicKey=(lt=(rt=fe==null?void 0:fe.reality)==null?void 0:rt.publicKey)!=null?lt:"",K.realityShortId=(Ze=(At=fe==null?void 0:fe.reality)==null?void 0:At.shortId)!=null?Ze:"",(fe==null?void 0:fe.network)==="tcp"&&fe.tcp&&(K.tcpType=fe.tcp.type,K.tcpHost=(Oe=fe.tcp.host)!=null?Oe:"",K.tcpPath=(kt=fe.tcp.path)!=null?kt:""),(fe==null?void 0:fe.network)==="ws"&&fe.ws&&(K.wsHost=(zt=fe.ws.host)!=null?zt:"",K.wsPath=(Kt=fe.ws.path)!=null?Kt:""),(fe==null?void 0:fe.network)==="grpc"&&fe.grpc&&(K.grpcServiceName=(or=fe.grpc.serviceName)!=null?or:""),oe!=null&&oe.hasAddressPort()&&(K.address=(Ge=(Wt=(Gt=oe.settings)==null?void 0:Gt.address)!=null?Wt:(er=ne==null?void 0:ne.settings)==null?void 0:er.address)!=null?Ge:"",K.port=Number((rr=(Et=(ut=oe.settings)==null?void 0:ut.port)!=null?Et:(tr=ne==null?void 0:ne.settings)==null?void 0:tr.port)!=null?rr:ar.port)),K.protocol){case ae.VMess:{const pe=oe.settings;K.id=($=pe==null?void 0:pe.id)!=null?$:"",K.vnextEncryption=(k=pe==null?void 0:pe.security)!=null?k:ar.vnextEncryption,K.address=(T=pe==null?void 0:pe.address)!=null?T:K.address,K.port=Number((Te=pe==null?void 0:pe.port)!=null?Te:K.port);break}case ae.VLESS:{const pe=oe.settings;K.id=(Fe=pe==null?void 0:pe.id)!=null?Fe:"",K.flow=(Re=pe==null?void 0:pe.flow)!=null?Re:"",K.encryption=(et=pe==null?void 0:pe.encryption)!=null?et:K.encryption,K.address=(ft=pe==null?void 0:pe.address)!=null?ft:K.address,K.port=Number((Pt=pe==null?void 0:pe.port)!=null?Pt:K.port);break}case ae.Trojan:{const pe=oe.settings;K.password=(it=pe==null?void 0:pe.password)!=null?it:"",K.address=(Nt=pe==null?void 0:pe.address)!=null?Nt:K.address,K.port=Number((Lt=pe==null?void 0:pe.port)!=null?Lt:K.port);break}case ae.Shadowsocks:{const pe=oe.settings;K.password=(Jr=pe==null?void 0:pe.password)!=null?Jr:"",K.method=(qr=pe==null?void 0:pe.method)!=null?qr:ar.method,K.address=(Dr=pe==null?void 0:pe.address)!=null?Dr:K.address,K.port=Number((Mt=pe==null?void 0:pe.port)!=null?Mt:K.port);break}case ae.Socks:case ae.HTTP:{const pe=(K.protocol===ae.Socks,oe.settings);K.user=(zr=pe==null?void 0:pe.user)!=null?zr:"",K.pass=(Ar=pe==null?void 0:pe.pass)!=null?Ar:"",K.address=(Yr=pe==null?void 0:pe.address)!=null?Yr:K.address,K.port=Number((sr=pe==null?void 0:pe.port)!=null?sr:K.port);break}case ae.DNS:{const pe=oe.settings;K.dnsNetwork=(nr=pe==null?void 0:pe.network)!=null?nr:ar.dnsNetwork,K.dnsAddress=(Ir=pe==null?void 0:pe.address)!=null?Ir:"",K.dnsPort=Number((bt=pe==null?void 0:pe.port)!=null?bt:ar.dnsPort);break}case ae.Freedom:{const pe=oe.settings;K.freedomStrategy=(kr=pe==null?void 0:pe.domainStrategy)!=null?kr:"";break}case ae.Blackhole:{const pe=oe.settings;K.blackholeResponse=(yt=pe==null?void 0:pe.type)!=null?yt:"";break}case ae.Wireguard:{const pe=oe.settings;K.wireguardSecret=(pr=pe==null?void 0:pe.secretKey)!=null?pr:"",K.wireguardAddress=(Jt=pe==null?void 0:pe.address)!=null?Jt:"";const Cs=(Xt=(lr=pe==null?void 0:pe.peers)==null?void 0:lr.map(Gr=>{var _s,Ds,As;return{publicKey:(_s=Gr.publicKey)!=null?_s:"",allowedIPs:Array.isArray(Gr.allowedIPs)?Gr.allowedIPs.join(","):"",endpoint:(Ds=Gr.endpoint)!=null?Ds:"",keepAlive:Number((As=Gr.keepAlive)!=null?As:0)}}))!=null?Xt:[];K.wireguardPeers=Cs.length>0?Cs:ar.wireguardPeers;break}}return((Tr=ne==null?void 0:ne.mux)==null?void 0:Tr.concurrency)!=null&&(K.muxConcurrency=Number(ne.mux.concurrency)),(!K.wireguardPeers||K.wireguardPeers.length===0)&&(K.wireguardPeers=ar.wireguardPeers),K},X=ne=>{ce(ne);try{const oe=JSON.parse(ne);De(null),E(oe),we.current=!0;const K=Se(oe);g(K)}catch(oe){De(oe.message)}},ge=()=>{const ne=Ee.trim();if(!ne){De(i("pages.outbound.configEmpty","Please paste a config link"));return}const oe=Ht.fromLink(ne);if(!oe){De(i("pages.outbound.invalidConfig","Unsupported or invalid config link")),a({status:"error",duration:2500,position:"top",title:i("pages.outbound.configParseFailedTitle","Conversion failed"),description:i("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const K=oe.toJson(),fe=JSON.stringify(K,null,2);Y(""),X(fe),a({status:"success",duration:2e3,position:"top",title:i("pages.outbound.configConvertedTitle","Config converted"),description:i("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},ke=f(async ne=>{var K;const oe=Es(ne);try{await o(oe),a({title:r==="edit"?i("pages.xray.outbound.updated","Outbound updated"):i("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),n()}catch(fe){a({title:((K=fe==null?void 0:fe.data)==null?void 0:K.detail)||(fe==null?void 0:fe.message)||i("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),Xe=()=>{n()},ie=ne=>{if(ve(ne),ne===1){const oe=Es(v());E(oe);const K=JSON.stringify(oe,null,2);ce(fe=>fe===K?fe:K),De(null)}};return s(It,{size:"4xl",isOpen:t,onClose:Xe,scrollBehavior:"inside",children:[e(pt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),s(Tt,{as:"form",onSubmit:ke,children:[e(gt,{children:r==="edit"?i("pages.xray.outbound.editOutbound","Edit Outbound"):i("pages.xray.outbound.addOutbound")}),e(Dt,{}),e(mt,{children:s(Js,{variant:"enclosed",colorScheme:"primary",index:Ae,onChange:ie,children:[s(qs,{children:[e(Bt,{children:i("form")}),e(Bt,{children:i("json")})]}),s(Ys,{children:[e(Vt,{children:s(le,{spacing:6,align:"stretch",children:[s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.basicSettings","Basic settings")}),s(le,{spacing:3,align:"stretch",children:[s(w,{isRequired:!0,children:[e(C,{children:i("pages.xray.outbound.tag")}),e(be,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:me})})]}),s(O,{children:[s(w,{isRequired:!0,children:[e(C,{children:i("protocol")}),e(Ye,{size:"sm",...p("protocol"),children:J.map(ne=>e("option",{value:ne,children:ne},ne))})]}),s(w,{children:[e(C,{children:i("pages.xray.outbound.sendThrough")}),e(be,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),Q&&s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.endpoint","Endpoint")}),s(le,{spacing:3,align:"stretch",children:[s(w,{isRequired:Q,children:[e(C,{children:i("pages.outbound.address","Address")}),e(be,{size:"sm",placeholder:"example.com",...p("address",{required:Q?me:!1})})]}),s(O,{children:[s(w,{isRequired:Q,children:[e(C,{children:i("pages.outbound.port","Port")}),e(be,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:Q?me:!1,valueAsNumber:!0,min:{value:1,message:se},max:{value:65535,message:se}})})]}),ue?s(w,{isRequired:ue,children:[e(C,{children:"ID"}),e(be,{size:"sm",placeholder:"UUID",...p("id",{required:ue?me:!1})})]}):te?s(w,{isRequired:te,children:[e(C,{children:i("password")}),e(be,{size:"sm",placeholder:"password",...p("password",{required:te?me:!1})})]}):s(w,{children:[e(C,{children:i("username")}),e(be,{size:"sm",placeholder:"username",...p("user")})]})]}),W===ae.Shadowsocks&&s(w,{isRequired:j,children:[e(C,{children:i("pages.outbound.method","Method")}),e(Ye,{size:"sm",...p("method",{required:j?me:!1}),children:Object.values(il).map(ne=>e("option",{value:ne,children:ne},ne))})]}),W===ae.VLESS&&s(O,{children:[s(w,{children:[e(C,{children:i("pages.outbound.encryption","Encryption")}),e(be,{size:"sm",placeholder:"none",...p("encryption")})]}),s(w,{children:[e(C,{children:"Flow"}),e(be,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),W===ae.VMess&&s(w,{children:[e(C,{children:i("pages.outbound.security","User security")}),e(be,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),W===ae.DNS&&s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.dnsSettings","DNS settings")}),s(O,{children:[s(w,{children:[e(C,{children:i("pages.outbound.network")}),s(Ye,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),s(w,{isRequired:N,children:[e(C,{children:i("pages.outbound.port")}),e(be,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:N?me:!1,valueAsNumber:!0,min:{value:1,message:se},max:{value:65535,message:se}})})]})]}),s(w,{mt:3,isRequired:N,children:[e(C,{children:i("pages.outbound.address")}),e(be,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:N?me:!1})})]})]}),W===ae.Freedom&&s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.freedom","Freedom options")}),s(w,{children:[e(C,{children:i("pages.outbound.strategy","Strategy")}),e(be,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),W===ae.Blackhole&&s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.blackhole","Blackhole options")}),s(w,{children:[e(C,{children:i("pages.outbound.response")}),e(be,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),W===ae.Wireguard&&s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.wireguard","Wireguard")}),s(le,{spacing:3,align:"stretch",children:[s(w,{children:[e(C,{children:i("pages.outbound.secretKey","Secret key")}),e(be,{size:"sm",...p("wireguardSecret")})]}),s(w,{children:[e(C,{children:i("pages.outbound.address")}),e(be,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),s(le,{spacing:3,align:"stretch",children:[s(O,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:i("pages.outbound.peer","Peers")}),e(Ne,{size:"sm","aria-label":i("add"),icon:e(Zh,{boxSize:3}),onClick:()=>z({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),_.map((ne,oe)=>s(L,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[s(O,{children:[s(w,{children:[e(C,{children:i("pages.outbound.publicKey","Public key")}),e(be,{size:"sm",...p(`wireguardPeers.${oe}.publicKey`)})]}),_.length>1&&e(Ne,{mt:6,size:"sm","aria-label":i("delete"),icon:e(jh,{boxSize:3}),onClick:()=>U(oe)})]}),s(O,{mt:2,children:[s(w,{children:[e(C,{children:i("pages.outbound.allowedIPs","Allowed IPs")}),e(be,{size:"sm",...p(`wireguardPeers.${oe}.allowedIPs`)})]}),s(w,{children:[e(C,{children:i("pages.outbound.endpoint","Endpoint")}),e(be,{size:"sm",...p(`wireguardPeers.${oe}.endpoint`)})]})]}),s(w,{mt:2,children:[e(C,{children:i("pages.outbound.keepAlive","Keep alive")}),e(be,{size:"sm",type:"number",...p(`wireguardPeers.${oe}.keepAlive`,{valueAsNumber:!0})})]})]},ne.id))]})]})]}),s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.transport","Transport")}),s(le,{spacing:3,align:"stretch",children:[s(w,{children:[e(C,{children:i("pages.outbound.network")}),s(Ye,{size:"sm",...p("network"),onChange:ne=>{p("network").onChange(ne)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),D==="tcp"&&s(O,{children:[s(w,{children:[e(C,{children:i("pages.outbound.tcpHeader","Header")}),s(Ye,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),P==="http"&&s(Rt,{children:[s(w,{children:[e(C,{children:i("host")}),e(be,{size:"sm",...p("tcpHost")})]}),s(w,{children:[e(C,{children:i("path")}),e(be,{size:"sm",...p("tcpPath")})]})]})]}),D==="ws"&&s(O,{children:[s(w,{children:[e(C,{children:i("host")}),e(be,{size:"sm",...p("wsHost")})]}),s(w,{children:[e(C,{children:i("path")}),e(be,{size:"sm",...p("wsPath")})]})]}),D==="grpc"&&s(w,{children:[e(C,{children:i("serviceName")}),e(be,{size:"sm",...p("grpcServiceName")})]})]})]}),s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.security")}),s(O,{children:[s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:"0",children:"TLS"}),e(ot,{size:"sm",isChecked:B,onChange:ne=>{const oe=ne.target.checked;b("tlsEnabled",oe),oe&&b("realityEnabled",!1)}})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:"0",children:"Reality"}),e(ot,{size:"sm",isChecked:I,onChange:ne=>{const oe=ne.target.checked;b("realityEnabled",oe),oe&&b("tlsEnabled",!1)}})]})]}),B&&s(w,{mt:3,children:[e(C,{children:"SNI"}),e(be,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),I&&s(le,{spacing:3,align:"stretch",mt:3,children:[s(w,{children:[e(C,{children:"SNI"}),e(be,{size:"sm",...p("tlsServerName")})]}),s(w,{children:[e(C,{children:i("pages.outbound.publicKey")}),e(be,{size:"sm",...p("realityPublicKey")})]}),s(w,{children:[e(C,{children:i("pages.outbound.shortId")}),e(be,{size:"sm",...p("realityShortId")})]})]})]}),s(L,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.mux")}),s(w,{display:"flex",alignItems:"center",children:[e(C,{mb:"0",children:i("pages.outbound.enableMux")}),e(ot,{size:"sm",...p("muxEnabled")})]}),_e&&s(w,{mt:3,children:[e(C,{children:i("pages.outbound.concurrency")}),e(be,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(Vt,{children:s(le,{align:"stretch",spacing:3,children:[s(w,{children:[e(C,{children:i("pages.outbound.configToJson","Config to JSON")}),s(O,{align:"start",spacing:3,children:[e(fr,{value:Ee,onChange:ne=>Y(ne.target.value),placeholder:i("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(G,{size:"sm",colorScheme:"primary",onClick:ge,children:i("pages.outbound.convertConfig","Convert")})]})]}),e(L,{height:"420px",children:e($a,{json:M,onChange:X})}),de&&e(h,{fontSize:"sm",color:"red.500",children:de})]})})]})]})}),s(_t,{gap:3,children:[e(G,{variant:"outline",onClick:Xe,children:i("cancel")}),e(G,{colorScheme:"primary",type:"submit",isDisabled:!y,children:i(r==="edit"?"save":"add")})]})]})]})},tp=["tcp","udp","http","quic","grpc"],rp=["http","tls","bittorrent","quic"],sp=["field","chained"],np=["","hybrid","linear"],gl={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},Ns=t=>Array.isArray(t)?t.join(", "):"",zs=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(Boolean),ap=t=>{var r,l,o,i;if(!t)return{...gl};const n=t.attrs?Object.entries(t.attrs).map(([a,c])=>({key:a,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(o=t.outboundTag)!=null?o:"",balancerTag:(i=t.balancerTag)!=null?i:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:Ns(t.source),sourcePort:Ns(t.sourcePort),domain:Ns(t.domain),ip:Ns(t.ip),user:Ns(t.user),port:Ns(t.port),attrs:n}},ip=t=>{const n={};t.type&&(n.type=t.type),t.domainMatcher&&(n.domainMatcher=t.domainMatcher),t.outboundTag&&(n.outboundTag=t.outboundTag),t.balancerTag&&(n.balancerTag=t.balancerTag),t.inboundTags.length&&(n.inboundTag=t.inboundTags),t.networks.length&&(n.network=t.networks),t.protocols.length&&(n.protocol=t.protocols);const r=zs(t.sourceIps);r.length&&(n.source=r);const l=zs(t.sourcePort);l.length&&(n.sourcePort=l);const o=zs(t.domain);o.length&&(n.domain=o);const i=zs(t.ip);i.length&&(n.ip=i);const a=zs(t.user);a.length&&(n.user=a);const c=zs(t.port);if(c.length&&(n.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:p,value:g})=>{!p.trim()||(u[p.trim()]=g)}),Object.keys(u).length&&(n.attrs=u)}return n.type||(n.type="field"),n},op=({isOpen:t,mode:n,initialRule:r,availableInboundTags:l,availableOutboundTags:o,availableBalancerTags:i,onSubmit:a,onClose:c})=>{const{t:u}=He(),p=Qe("white","gray.900"),{control:g,register:f,handleSubmit:A,reset:v,formState:{isSubmitting:b}}=_r({defaultValues:gl}),{fields:y,append:_,remove:z}=fn({control:g,name:"attrs"});d.exports.useEffect(()=>{t&&v(ap(r))},[t,r,v]);const U=()=>_({key:"",value:""}),re=()=>{c()},D=A(I=>{const P=ip(I);a(P),re()}),B=d.exports.useMemo(()=>n==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[n,u]);return s(It,{isOpen:t,onClose:re,size:"xl",scrollBehavior:"inside",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{as:"form",onSubmit:D,bg:p,children:[e(gt,{children:B}),e(Dt,{}),e(mt,{children:s(xe,{spacing:5,children:[s(w,{children:[e(C,{children:u("pages.xray.rules.type","Rule Type")}),e(Ye,{...f("type"),size:"sm",children:sp.map(I=>e("option",{value:I,children:I||u("core.none","None")},I))})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(Ye,{...f("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:o.map(I=>e("option",{value:I,children:I},I))})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(Ye,{...f("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:i.map(I=>e("option",{value:I,children:I},I))})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(st,{control:g,name:"inboundTags",render:({field:I})=>e(Xn,{...I,children:e(Qn,{spacing:3,children:l.map(P=>e(bn,{children:e(Sr,{value:P,children:P})},P))})})})]}),e(Ms,{}),s(w,{children:[e(C,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(Ye,{...f("domainMatcher"),size:"sm",children:np.map(I=>e("option",{value:I,children:I||u("core.default","Default")},I||"empty"))})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.network","Network")}),e(st,{control:g,name:"networks",render:({field:I})=>e(Xn,{...I,children:e(Qn,{spacing:3,children:tp.map(P=>e(bn,{children:e(Sr,{value:P,children:P})},P))})})})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.protocol","Protocol")}),e(st,{control:g,name:"protocols",render:({field:I})=>e(Xn,{...I,children:e(Qn,{spacing:3,children:rp.map(P=>e(bn,{children:e(Sr,{value:P,children:P})},P))})})})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.source","Source IPs")}),e(fr,{...f("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(fr,{...f("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.ip","Destination IPs")}),e(fr,{...f("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.domain","Domains")}),e(fr,{...f("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.user","Users")}),e(fr,{...f("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(w,{children:[e(C,{children:u("pages.xray.rules.port","Ports")}),e(fr,{...f("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(Ms,{}),s(L,{children:[s(w,{children:[e(C,{children:u("pages.xray.rules.attrs","Attributes")}),e(G,{onClick:U,size:"xs",leftIcon:e(ts,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),s(xe,{spacing:2,mt:3,children:[y.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),y.map((I,P)=>s(O,{spacing:2,align:"flex-start",children:[e(be,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...f(`attrs.${P}.key`)}),e(be,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...f(`attrs.${P}.value`)}),e(Ne,{"aria-label":"Remove attribute",icon:e(Ya,{width:16}),size:"sm",variant:"ghost",onClick:()=>z(P)})]},I.id))]})]})]})}),s(_t,{gap:3,children:[e(G,{variant:"outline",onClick:re,children:u("cancel")}),e(G,{colorScheme:"primary",type:"submit",isLoading:b,children:n==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},lp=({isOpen:t,onClose:n,form:r,setBalancersData:l,balancerIndex:o})=>{const{t:i}=He(),a=_r({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=a.handleSubmit(u=>{const p={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},g=r.getValues("config.routing.balancers")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.routing.balancers",g,{shouldDirty:!0}),l(g.map((f,A)=>{var v;return{key:A,tag:f.tag||"",strategy:((v=f.strategy)==null?void 0:v.type)||"random",selector:f.selector||[],fallbackTag:f.fallbackTag||""}})),n()});return s(It,{isOpen:t,onClose:n,size:"sm",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",children:[e(gt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Dt,{mt:3}),e(mt,{children:e("form",{onSubmit:c,children:s(le,{spacing:4,children:[s(w,{children:[e(C,{children:i("pages.xray.balancer.tag")}),e(be,{...a.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),s(w,{children:[e(C,{children:i("pages.xray.balancer.balancerStrategy")}),e(Ye,{...a.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),s(w,{children:[e(C,{children:i("pages.xray.balancer.balancerSelectors")}),e(be,{...a.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),s(w,{children:[e(C,{children:i("pages.xray.balancer.fallbackTag")}),e(be,{...a.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(G,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},cp=({isOpen:t,onClose:n,form:r,setDnsServers:l,dnsIndex:o})=>{const{t:i}=He(),a=_r({defaultValues:{address:"",domains:"",expectIPs:""}}),c=a.handleSubmit(u=>{const p={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},g=r.getValues("config.dns.servers")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.dns.servers",g,{shouldDirty:!0}),l(g),n()});return s(It,{isOpen:t,onClose:n,size:"sm",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",children:[e(gt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Dt,{mt:3}),e(mt,{children:e("form",{onSubmit:c,children:s(le,{spacing:4,children:[s(w,{children:[e(C,{children:i("pages.xray.dns.address")}),e(be,{...a.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),s(w,{children:[e(C,{children:i("pages.xray.dns.domains")}),e(be,{...a.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),s(w,{children:[e(C,{children:i("pages.xray.dns.expectIPs")}),e(be,{...a.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(G,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},dp=({isOpen:t,onClose:n,form:r,setFakeDns:l,fakeDnsIndex:o})=>{const{t:i}=He(),a=_r({defaultValues:{ipPool:"",poolSize:""}}),c=a.handleSubmit(u=>{const p={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},g=r.getValues("config.fakedns")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.fakedns",g.length>0?g:null,{shouldDirty:!0}),l(g),n()});return s(It,{isOpen:t,onClose:n,size:"sm",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(Tt,{mx:"3",children:[e(gt,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Dt,{mt:3}),e(mt,{children:e("form",{onSubmit:c,children:s(le,{spacing:4,children:[s(w,{children:[e(C,{children:i("pages.xray.fakedns.ipPool")}),e(be,{...a.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),s(w,{children:[e(C,{children:i("pages.xray.fakedns.poolSize")}),e(be,{...a.register("poolSize"),size:"sm",placeholder:"100"})]}),e(G,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},Ka={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Zi=t=>{var u,p,g,f,A,v,b,y,_,z,U,re,D;if(!t)return{...Ka};const n=(u=t.settings)!=null?u:{},l=(p=(Array.isArray(n.peers)?n.peers:[])[0])!=null?p:{},o=Array.isArray(n.address)?n.address:[],i=(f=(g=o.find(B=>typeof B=="string"&&B.endsWith("/32")))==null?void 0:g.replace("/32",""))!=null?f:"",a=(v=(A=o.find(B=>typeof B=="string"&&B.endsWith("/128")))==null?void 0:A.replace("/128",""))!=null?v:"",c=Array.isArray(n.reserved)?n.reserved.filter(B=>Number.isFinite(Number(B))).join(","):"";return{tag:(b=t.tag)!=null?b:"warp",privateKey:(_=(y=n.secretKey)!=null?y:n.privateKey)!=null?_:"",publicKey:(z=l.publicKey)!=null?z:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:i,addressV6:a,reserved:c,mtu:(U=n.mtu)!=null?U:1420,domainStrategy:(re=n.domainStrategy)!=null?re:"ForceIP",notes:typeof t.notes=="string"?t.notes:(D=n.notes)!=null?D:""}},up=t=>{const n=[];t.addressV4.trim()&&n.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&n.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(i=>Number(i.trim())).filter(i=>Number.isFinite(i)),o=Ht.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:n,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?o.notes=t.notes.trim():delete o.notes,o},hp=t=>{if(!t)return[];try{const n=atob(t);return Array.from(n).map(r=>r.charCodeAt(0))}catch{return[]}},pp=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const n=t;return n.host?n.port?`${n.host}:${n.port}`:n.host:""}return""},mp=(t,n)=>{var p,g,f,A,v,b,y,_,z,U,re;if(!t||!(n!=null&&n.config))return null;const r=n.config,l=[],o=(g=(p=r.interface)==null?void 0:p.addresses)!=null?g:{};o.v4&&l.push(`${o.v4}/32`),o.v6&&l.push(`${o.v6}/128`);const a=(f=(Array.isArray(r.peers)?r.peers:[])[0])!=null?f:{},c=(v=(A=a.allowed_ips)!=null?A:a.allowedIPs)!=null?v:["0.0.0.0/0","::/0"];return Ht.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(y=(b=r.interface)==null?void 0:b.mtu)!=null?y:1420,secretKey:t.private_key,address:l,reserved:hp(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(z=(_=a.public_key)!=null?_:t.public_key)!=null?z:"",endpoint:pp(a.endpoint),allowedIPs:c,keepAlive:(re=(U=a.keep_alive)!=null?U:a.keepAlive)!=null?re:0}]}})},ji=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},Na=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":ps.sizeFormat(t),ir=({label:t,value:n})=>{const r=Qe("gray.500","gray.400");return s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:n||"-"})]})},gp=({isOpen:t,onClose:n,initialOutbound:r,onSave:l,onDelete:o})=>{var Ee,Y,we,J,Se;const{t:i}=He(),a=Ut(),[c,u]=d.exports.useState({...Ka}),[p,g]=d.exports.useState(null),[f,A]=d.exports.useState(null),[v,b]=d.exports.useState(null),[y,_]=d.exports.useState(""),[z,U]=d.exports.useState(!1),[re,D]=d.exports.useState(!1),[B,I]=d.exports.useState(!1),[P,_e]=d.exports.useState(!1),[me,se]=d.exports.useState(!1);d.exports.useEffect(()=>{yh()},[]);const W=d.exports.useCallback(async()=>{var X,ge;U(!0);try{const ke=await Ce("/core/warp",{method:"GET"});g((X=ke.account)!=null?X:null),A(null),b(null)}catch(ke){a({title:i("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((ge=ke==null?void 0:ke.data)==null?void 0:ge.detail)||(ke==null?void 0:ke.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{U(!1)}},[a,i]);d.exports.useEffect(()=>{t&&W().catch(()=>{})},[t,W]),d.exports.useEffect(()=>{t&&u(Zi(r))},[r,t]),d.exports.useEffect(()=>{var X;_((X=p==null?void 0:p.license_key)!=null?X:"")},[p]);const Q=(X,ge)=>{u(ke=>({...ke,[X]:ge}))},ue=Qe("gray.600","gray.300"),te=Qe("gray.200","whiteAlpha.200"),j=()=>{const X=da();Q("privateKey",X.privateKey),Q("publicKey",X.publicKey),a({title:i("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},N=()=>{const X=Array.from({length:3},()=>Math.floor(Math.random()*256));Q("reserved",X.join(","))},he=d.exports.useCallback((X,ge)=>{if(!X||!ge){b(null);return}const ke=mp(X,ge);ke&&(b(ke),u(Zi(ke.toJson())))},[]),Ae=async()=>{var X;D(!0);try{const ge=da(),ke=await Ce("/core/warp/register",{method:"POST",body:{private_key:ge.privateKey,public_key:ge.publicKey}});g(ke.account),A(ke.config),he(ke.account,ke.config),a({title:i("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(ge){a({title:i("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((X=ge==null?void 0:ge.data)==null?void 0:X.detail)||(ge==null?void 0:ge.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{D(!1)}},ve=async()=>{var X;if(!p){a({title:i("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}_e(!0);try{const ge=await Ce("/core/warp/config",{method:"GET"});A(ge.config),he(p,ge.config),a({title:i("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(ge){a({title:i("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((X=ge==null?void 0:ge.data)==null?void 0:X.detail)||(ge==null?void 0:ge.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{_e(!1)}},M=async()=>{var X;if(!!y.trim()){I(!0);try{const ge=await Ce("/core/warp/license",{method:"POST",body:{license_key:y.trim()}});g(ge.account),a({title:i("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(ge){a({title:i("pages.xray.warp.licenseFailed","Failed to update license."),description:((X=ge==null?void 0:ge.data)==null?void 0:X.detail)||(ge==null?void 0:ge.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{I(!1)}}},E=async()=>{var X;se(!0);try{await Ce("/core/warp",{method:"DELETE"}),g(null),A(null),b(null),o(),a({title:i("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(ge){a({title:i("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((X=ge==null?void 0:ge.data)==null?void 0:X.detail)||(ge==null?void 0:ge.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{se(!1)}},F=()=>{if(!v)return;const X=v.toJson();l(X),a({title:i("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},ce=()=>{o(),u({...Ka}),a({title:i("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},de=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){a({title:i("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const X=up(c);l(X),n()},De=d.exports.useMemo(()=>Boolean(r),[r]);return s(It,{isOpen:t,onClose:n,size:"xl",scrollBehavior:"inside",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),s(Tt,{children:[e(gt,{children:i("pages.xray.warp.manage","Manage WARP")}),e(Dt,{}),e(mt,{children:s(le,{spacing:5,align:"stretch",children:[s(br,{status:"info",borderRadius:"md",children:[e(yr,{}),e(os,{children:i("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(L,{borderWidth:"1px",borderColor:te,borderRadius:"lg",p:4,children:p?s(le,{spacing:4,align:"stretch",children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(ir,{label:i("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(ir,{label:i("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(ir,{label:i("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(ir,{label:i("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(ir,{label:i("pages.xray.warp.registeredAt","Registered at"),value:ji(p.created_at)}),e(ir,{label:i("pages.xray.warp.updatedAt","Updated at"),value:ji(p.updated_at)})]}),s(O,{spacing:3,flexWrap:"wrap",children:[e(G,{variant:"outline",onClick:ve,isLoading:P,children:i("pages.xray.warp.fetchInfo","Refresh info")}),e(G,{variant:"ghost",colorScheme:"red",onClick:E,isLoading:me,children:i("pages.xray.warp.removeAccount","Remove account")})]})]}):s(le,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:ue,children:i("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(G,{colorScheme:"primary",onClick:Ae,isLoading:re||z,children:i("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&s(L,{borderWidth:"1px",borderColor:te,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.licenseSection","WARP+/License key")}),s(O,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(be,{value:y,onChange:X=>_(X.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(G,{colorScheme:"primary",onClick:M,isLoading:B,isDisabled:!y.trim(),children:i("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:ue,mt:2,children:i("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),s(L,{borderWidth:"1px",borderColor:te,borderRadius:"lg",p:4,children:[s(O,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:i("pages.xray.warp.remoteConfig","Remote configuration")}),f?e(Kr,{colorScheme:f.enabled?"green":"yellow",children:f.enabled?i("core.active","Active"):i("core.pending","Pending")}):e(Kr,{colorScheme:"gray",children:i("core.empty","Empty")})]}),f?s(xe,{spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(ir,{label:i("core.name","Name"),value:(Ee=f.name)!=null?Ee:"-"}),e(ir,{label:i("core.model","Model"),value:(Y=f.model)!=null?Y:"-"}),e(ir,{label:i("core.status","Status"),value:f.enabled?i("core.enabled","Enabled"):i("core.disabled","Disabled")}),e(ir,{label:i("core.id","ID"),value:(we=f.id)!=null?we:"-"})]}),f.account&&s(Rt,{children:[e(Ms,{}),s(Ve,{columns:{base:1,md:3},spacing:4,children:[e(ir,{label:i("core.type","Type"),value:(J=f.account.account_type)!=null?J:"-"}),e(ir,{label:i("core.role","Role"),value:(Se=f.account.role)!=null?Se:"-"}),e(ir,{label:i("pages.xray.warp.premiumData","WARP+ data"),value:Na(f.account.premium_data)}),e(ir,{label:i("core.quota","Quota"),value:Na(f.account.quota)}),e(ir,{label:i("core.usage","Usage"),value:Na(f.account.usage)})]})]}),s(O,{spacing:3,flexWrap:"wrap",children:[e(G,{colorScheme:"primary",onClick:F,isDisabled:!v,children:i("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(G,{variant:"ghost",onClick:()=>A(null),children:i("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:ue,children:i("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),s(L,{borderWidth:"1px",borderColor:te,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.manualTitle","Manual outbound")}),s(xe,{spacing:4,children:[s(w,{isRequired:!0,children:[e(C,{children:i("pages.xray.outbound.tag","Tag")}),e(be,{size:"sm",value:c.tag,onChange:X=>Q("tag",X.target.value),placeholder:"warp"})]}),s(w,{isRequired:!0,children:[e(C,{children:i("pages.xray.warp.privateKey")}),e(fr,{size:"sm",value:c.privateKey,onChange:X=>Q("privateKey",X.target.value),rows:2})]}),s(w,{isRequired:!0,children:[e(C,{children:i("pages.xray.warp.publicKey")}),e(fr,{size:"sm",value:c.publicKey,onChange:X=>Q("publicKey",X.target.value),rows:2})]}),s(w,{children:[e(G,{size:"sm",colorScheme:"primary",onClick:j,children:i("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:ue,mt:1,children:i("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),s(w,{isRequired:!0,children:[e(C,{children:i("pages.xray.warp.endpoint")}),e(be,{size:"sm",value:c.endpoint,onChange:X=>Q("endpoint",X.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),s(w,{children:[e(C,{children:i("pages.xray.warp.addressV4","Client IPv4")}),e(be,{size:"sm",value:c.addressV4,onChange:X=>Q("addressV4",X.target.value),placeholder:"172.16.0.2"}),e(Cr,{children:i("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),s(w,{children:[e(C,{children:i("pages.xray.warp.addressV6","Client IPv6")}),e(be,{size:"sm",value:c.addressV6,onChange:X=>Q("addressV6",X.target.value),placeholder:"2606:4700:****:****::****"})]}),s(w,{children:[e(C,{children:i("pages.xray.warp.reserved")}),e(be,{size:"sm",value:c.reserved,onChange:X=>Q("reserved",X.target.value),placeholder:"0,0,0"}),e(Cr,{children:i("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(G,{size:"xs",mt:2,variant:"ghost",onClick:N,children:i("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),s(w,{children:[e(C,{children:i("pages.xray.warp.mtu","MTU")}),e(bs,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(X,ge)=>Q("mtu",ge||1420),children:e(fs,{})})]}),s(w,{children:[e(C,{children:i("pages.xray.warp.notes","Notes (optional)")}),e(fr,{size:"sm",rows:2,value:c.notes,onChange:X=>Q("notes",X.target.value)})]})]})]})]})}),s(_t,{display:"flex",justifyContent:"space-between",children:[De?e(G,{colorScheme:"red",variant:"outline",onClick:ce,children:i("delete")}):e("span",{}),s(O,{spacing:3,children:[e(G,{variant:"ghost",onClick:n,children:i("cancel")}),e(G,{colorScheme:"primary",onClick:de,children:i(De?"save":"add")})]})]})]})]})},sn=Z(ts,{baseStyle:{w:3.5,h:3.5}}),nn=Z(Vr,{baseStyle:{w:4,h:4}}),an=Z(ls,{baseStyle:{w:4,h:4}}),eo=Z(Vo,{baseStyle:{w:4,h:4}}),to=Z($o,{baseStyle:{w:4,h:4}}),ro=Z($r,{baseStyle:{w:4,h:4}}),fp=Z(Ac,{baseStyle:{w:4,h:4}}),bp=Z(Ic,{baseStyle:{w:4,h:4}}),yp=Z(Tc,{baseStyle:{w:4,h:4}}),Sp=Z(Pc,{baseStyle:{w:4,h:4}}),xp=Z(yo,{baseStyle:{w:4,h:4}}),kp=Z(Ec,{baseStyle:{w:4,h:4}}),wp=Z(Nc,{baseStyle:{w:4,h:4}}),vp=Z(zc,{baseStyle:{w:4,h:4}}),Cp=Z(Rc,{baseStyle:{w:4,h:4}}),so=Z(Uc,{baseStyle:{w:4,h:4}}),on={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},$n=t=>JSON.stringify(t!=null?t:{}),no=t=>Array.isArray(t)?t.join(","):t!=null?t:"",_p=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],za=({title:t,children:n})=>{const r=Qe("gray.50","whiteAlpha.100"),l=Qe("gray.200","whiteAlpha.300");return s(L,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(L,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(L,{overflowX:"auto",children:e(ys,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(Nr,{children:n})})})]})},Pr=({label:t,controlId:n,children:r})=>{const l=Qe("gray.700","whiteAlpha.800");return s(Ct,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(ze,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(C,{htmlFor:n,mb:{base:2,md:0},color:l,children:t})}),e(ze,{py:3,display:{base:"block",md:"table-cell"},children:e(w,{id:n,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(n)})})]})},ln=({children:t})=>{const n=Qe("gray.200","whiteAlpha.200"),r=Qe("white","blackAlpha.400"),l=Qe("sm","none");return e(L,{borderWidth:"1px",borderColor:n,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(L,{overflowX:"auto",children:t})})},cn=({children:t,...n})=>{const r=Qe("gray.50","whiteAlpha.100"),l=Qe("gray.200","whiteAlpha.300"),o=Qe("gray.300","whiteAlpha.300"),i=Qe("gray.100","whiteAlpha.200"),a=Qe("gray.50","whiteAlpha.100");return e(ys,{size:"sm",w:"full",...n,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:o,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:i,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:a}},children:t})},Dp=()=>{var Qs,Zs,ye,vt;const{t}=He(),{fetchCoreSettings:n,updateConfig:r,isLoading:l,config:o,isPostLoading:i,restartCore:a}=Jh(),{onEditingCore:c}=ht(),u=Ut(),{isOpen:p,onOpen:g,onClose:f}=Yt(),{isOpen:A,onOpen:v,onClose:b}=Yt(),{isOpen:y,onOpen:_,onClose:z}=Yt(),{isOpen:U,onOpen:re,onClose:D}=Yt(),{isOpen:B,onOpen:I,onClose:P}=Yt(),{isOpen:_e,onOpen:me,onClose:se}=Yt(),W=_r({defaultValues:{config:o||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),Q=d.exports.useRef($n(W.getValues("config"))),ue=Ot({control:W.control,name:"config"}),te=d.exports.useMemo(()=>$n(ue)!==Q.current,[ue]),[j,N]=d.exports.useState([]),[he,Ae]=d.exports.useState([]),[ve,M]=d.exports.useState([]),[E,F]=d.exports.useState([]),[ce,de]=d.exports.useState([]),[De,Ee]=d.exports.useState([]),[Y,we]=d.exports.useState(null),[J,Se]=d.exports.useState(null),[X,ge]=d.exports.useState(!1),[ke,Xe]=d.exports.useState("xraySetting"),[ie,ne]=d.exports.useState(""),oe=ur({base:!0,md:!1}),[K,fe]=d.exports.useState(0),[dt,Je]=d.exports.useState(""),[q,x]=d.exports.useState(""),R=d.exports.useCallback(m=>m.map((S,H)=>{var Ue,$e;return{key:`${H}-${($e=(Ue=S.tag)!=null?Ue:S.protocol)!=null?$e:"outbound"}`,...S}}),[]),ee=d.exports.useCallback(m=>{N(R(m))},[R]),Pe=d.exports.useCallback(()=>{const m=W.getValues("config.outbounds");return Array.isArray(m)?JSON.parse(JSON.stringify(m)):[]},[W]),Be=d.exports.useCallback(m=>{W.setValue("config.outbounds",m,{shouldDirty:!0}),ee(m),fe(S=>S+1)},[W,ee]),rt=d.exports.useCallback(m=>m.map((S,H)=>{var Ue,$e,Me,je,Qt,us,ns,js,si,ni,ai,ii,oi,li,ci;return{key:`${H}-${($e=(Ue=S.outboundTag)!=null?Ue:S.balancerTag)!=null?$e:"rule"}`,source:(Me=S.source)!=null?Me:[],sourcePort:(je=S.sourcePort)!=null?je:[],network:(Qt=S.network)!=null?Qt:[],protocol:(us=S.protocol)!=null?us:[],attrs:S.attrs?JSON.stringify(S.attrs,null,2):"",ip:(ns=S.ip)!=null?ns:[],domain:(js=S.domain)!=null?js:[],port:(si=S.port)!=null?si:[],inboundTag:(ni=S.inboundTag)!=null?ni:[],user:(ai=S.user)!=null?ai:[],outboundTag:(ii=S.outboundTag)!=null?ii:"",balancerTag:(oi=S.balancerTag)!=null?oi:"",type:(li=S.type)!=null?li:"field",domainMatcher:(ci=S.domainMatcher)!=null?ci:""}}),[]),lt=d.exports.useCallback(m=>{Ae(rt(m))},[rt]),At=d.exports.useCallback(m=>{W.setValue("config.routing.rules",m,{shouldDirty:!0}),lt(m),fe(S=>S+1)},[W,lt]),Ze=d.exports.useCallback(()=>{const m=W.getValues("config.routing.rules");return Array.isArray(m)?JSON.parse(JSON.stringify(m)):[]},[W]);d.exports.useEffect(()=>{const m=()=>{ge(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",m),()=>{document.removeEventListener("fullscreenchange",m)}},[]),d.exports.useEffect(()=>(c(!0),n().then(()=>{console.log("Core settings fetched successfully")}).catch(m=>{u({title:t("core.errorFetchingConfig"),description:m.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>c(!1)),[n,c,u,t]),d.exports.useEffect(()=>{var m,S,H,Ue;o&&(W.reset({config:o}),Q.current=$n(o),ee((o==null?void 0:o.outbounds)||[]),lt(((m=o==null?void 0:o.routing)==null?void 0:m.rules)||[]),M(((H=(S=o==null?void 0:o.routing)==null?void 0:S.balancers)==null?void 0:H.map(($e,Me)=>{var je;return{key:Me,tag:$e.tag||"",strategy:((je=$e.strategy)==null?void 0:je.type)||"random",selector:$e.selector||[],fallbackTag:$e.fallbackTag||""}}))||[]),F(((Ue=o==null?void 0:o.dns)==null?void 0:Ue.servers)||[]),de((o==null?void 0:o.fakedns)||[]),ne(o!=null&&o.observatory?"observatory":o!=null&&o.burstObservatory?"burstObservatory":""),fe($e=>$e+1))},[o,W,ee,lt]);const{mutate:Oe,isLoading:kt}=Lr(a,{onSuccess:()=>{u({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:m=>{var S,H;u({title:t("core.generalErrorMessage"),description:((H=(S=m.response)==null?void 0:S.data)==null?void 0:H.detail)||m.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),zt=W.handleSubmit(({config:m})=>{r(m).then(()=>{W.reset({config:m}),Q.current=$n(m),u({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(S=>{let H=t("core.generalErrorMessage");typeof S.response._data.detail=="object"&&(H=S.response._data.detail[Object.keys(S.response._data.detail)[0]]),typeof S.response._data.detail=="string"&&(H=S.response._data.detail),u({title:H,status:"error",isClosable:!0,position:"top",duration:3e3})})}),Kt=async()=>{const m=await Ce("/panel/xray/getOutboundsTraffic");m!=null&&m.success&&Ee(m.obj)},or=()=>{Se(null),f()},Gt=()=>{Se(null),g()},er=m=>{Se(m),g()},Wt=m=>{const S=Pe();m<0||m>=S.length||(S.splice(m,1),Be(S))},Ge=(m,S)=>{const H=Pe();if(m<0||m>=H.length||S<0||S>=H.length)return;const[Ue]=H.splice(m,1);H.splice(S,0,Ue),Be(H)},ut=m=>{Ge(m,m-1)},tr=m=>{Ge(m,m+1)},Et=()=>{we(null),v()},rr=m=>{we(m),v()},$=m=>{const S=Ze();S.splice(m,1),At(S)},k=(m,S)=>{const H=Ze();if(m<0||m>=H.length||S<0||S>=H.length)return;const[Ue]=H.splice(m,1);H.splice(S,0,Ue),At(H)},T=m=>{const S=Ze();Y!==null&&Y>=0&&Y<S.length?S[Y]=m:S.push(m),At(S),we(null)},Te=()=>{we(null),b()},Fe=()=>{_()},Re=m=>{_()},et=m=>{const S=[...ve],H=S.splice(m,1)[0];W.setValue("config.routing.balancers",S,{shouldDirty:!0}),M(S);const Ue={...W.getValues("config")};Ue.observatory&&(Ue.observatory.subjectSelector=Ue.observatory.subjectSelector.filter($e=>$e!==H.tag)),Ue.burstObservatory&&(Ue.burstObservatory.subjectSelector=Ue.burstObservatory.subjectSelector.filter($e=>$e!==H.tag)),W.setValue("config",Ue,{shouldDirty:!0})},ft=()=>{re()},Pt=m=>{re()},it=m=>{const S=[...E];S.splice(m,1),W.setValue("config.dns.servers",S,{shouldDirty:!0}),F(S)},Nt=()=>{I()},Lt=m=>{I()},Jr=m=>{const S=[...ce];S.splice(m,1),W.setValue("config.fakedns",S.length>0?S:null,{shouldDirty:!0}),de(S)},qr=m=>{var S,H,Ue,$e,Me;switch(m.protocol){case"vmess":case"vless":return((S=m.settings.vnext)==null?void 0:S.map(je=>`${je.address}:${je.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((H=m.settings.servers)==null?void 0:H.map(je=>`${je.address}:${je.port}`))||[];case"dns":return[`${(Ue=m.settings)==null?void 0:Ue.address}:${($e=m.settings)==null?void 0:$e.port}`];case"wireguard":return((Me=m.settings.peers)==null?void 0:Me.map(je=>je.endpoint))||[];default:return[]}},Dr=m=>{const S=De.find(H=>H.tag===m.tag);return S?`${ps.sizeFormat(S.up)} / ${ps.sizeFormat(S.down)}`:`${ps.sizeFormat(0)} / ${ps.sizeFormat(0)}`},Mt=d.exports.useMemo(()=>Array.isArray(ue==null?void 0:ue.outbounds)?ue.outbounds:[],[ue]),zr=d.exports.useMemo(()=>{var m;return Array.isArray((m=ue==null?void 0:ue.routing)==null?void 0:m.rules)?ue.routing.rules:[]},[ue]),Ar=d.exports.useMemo(()=>{var m;return Array.from(new Set(((m=ue==null?void 0:ue.inbounds)!=null?m:[]).map(S=>S==null?void 0:S.tag).filter(S=>Boolean(S))))},[ue]),Yr=d.exports.useMemo(()=>Array.from(new Set(Mt.map(m=>m==null?void 0:m.tag).filter(m=>Boolean(m)))),[Mt]),sr=d.exports.useMemo(()=>{var m,S;return Array.from(new Set(((S=(m=ue==null?void 0:ue.routing)==null?void 0:m.balancers)!=null?S:[]).map(H=>H==null?void 0:H.tag).filter(H=>Boolean(H))))},[ue]),nr=d.exports.useMemo(()=>Mt.length===0?-1:Mt.findIndex(m=>(m==null?void 0:m.protocol)==="freedom"),[Mt]),Ir=d.exports.useMemo(()=>{var S,H;if(nr<0)return"";const m=Mt[nr];return(H=(S=m==null?void 0:m.settings)==null?void 0:S.domainStrategy)!=null?H:""},[nr,Mt]),bt=m=>{const S=W.getValues("config")||{},H=Array.isArray(S.outbounds)?JSON.parse(JSON.stringify(S.outbounds)):[],Ue=H.findIndex(je=>(je==null?void 0:je.protocol)==="freedom");if(Ue===-1)return;const $e={...H[Ue]},Me={...$e.settings||{}};m?Me.domainStrategy=m:delete Me.domainStrategy,$e.settings=Me,H[Ue]=$e,W.setValue("config.outbounds",H,{shouldDirty:!0}),N(H.map((je,Qt)=>({key:Qt,...je}))),fe(je=>je+1)},kr=d.exports.useMemo(()=>{var m;return(m=Mt.find(S=>(S==null?void 0:S.tag)==="warp"))!=null?m:null},[Mt]),pr=d.exports.useMemo(()=>Mt.findIndex(m=>(m==null?void 0:m.tag)==="warp"),[Mt])!==-1,Jt=d.exports.useMemo(()=>{const m=zr.find(S=>S.outboundTag==="warp");return Array.isArray(m==null?void 0:m.domain)?m.domain:[]},[zr]),lr=m=>{const S=m.map(Me=>Me.trim()).filter((Me,je,Qt)=>Me.length>0&&Qt.indexOf(Me)===je),H=Ze(),Ue=H.findIndex(Me=>Me.outboundTag==="warp");if(S.length===0){Ue!==-1&&(H.splice(Ue,1),At(H));return}const $e={type:"field",outboundTag:"warp",domain:S};Ue!==-1?H[Ue]={...H[Ue],...$e}:H.push($e),At(H)},Xt=m=>{const S=m.trim();!S||Jt.includes(S)||lr([...Jt,S])},Tr=m=>{lr(Jt.filter(S=>S!==m))},pe=Qe("white","blackAlpha.400"),Cs=Qe("gray.200","whiteAlpha.200"),Gr=Qe("gray.600","gray.300"),_s=m=>{var $e;const S=Pe(),H=($e=m.tag)!=null?$e:"warp",Ue=S.findIndex(Me=>(Me==null?void 0:Me.tag)===H);Ue>=0?S[Ue]=m:S.push(m),Be(S)},Ds=()=>{const m=Pe(),S=m.findIndex(H=>(H==null?void 0:H.tag)==="warp");S!==-1&&(m.splice(S,1),Be(m),lr([]),Je(""),x(""))},As=m=>{const S=Pe();J!==null&&J>=0&&J<S.length?S[J]=m:S.push(m),Be(S),Se(null)},ba=()=>{se()},Xs=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{ge(!1)}).catch(m=>{console.error("Error exiting fullscreen:",m)}):document.documentElement.requestFullscreen().then(()=>{ge(!0)}).catch(m=>{console.error("Error entering fullscreen:",m)})},Un=()=>{var S,H,Ue,$e;const m=W.getValues("config")||{};switch(ke){case"inboundSettings":return JSON.stringify((S=m.inbounds)!=null?S:[],null,2);case"outboundSettings":return JSON.stringify((H=m.outbounds)!=null?H:[],null,2);case"routingRuleSettings":return JSON.stringify(($e=(Ue=m.routing)==null?void 0:Ue.rules)!=null?$e:[],null,2);case"xraySetting":default:return JSON.stringify(m!=null?m:{},null,2)}},Ln=m=>{var S,H,Ue,$e;try{const Me=JSON.parse(m),je={...W.getValues("config")||{}};switch(ke){case"inboundSettings":je.inbounds=Me;break;case"outboundSettings":je.outbounds=Me,ee(Me);break;case"routingRuleSettings":je.routing||(je.routing={}),je.routing.rules=Me,lt(Me);break;case"xraySetting":default:W.setValue("config",Me,{shouldDirty:!0}),ee((Me==null?void 0:Me.outbounds)||[]),lt(((S=Me==null?void 0:Me.routing)==null?void 0:S.rules)||[]),M(((Ue=(H=Me==null?void 0:Me.routing)==null?void 0:H.balancers)==null?void 0:Ue.map((Qt,us)=>{var ns;return{key:us,tag:Qt.tag||"",strategy:((ns=Qt.strategy)==null?void 0:ns.type)||"random",selector:Qt.selector||[],fallbackTag:Qt.fallbackTag||""}}))||[]),F((($e=Me==null?void 0:Me.dns)==null?void 0:$e.servers)||[]),de((Me==null?void 0:Me.fakedns)||[]);return}W.setValue("config",je,{shouldDirty:!0})}catch{}},Mn=()=>{var S,H;const m=W.getValues("config")||{};return ie==="observatory"?JSON.stringify((S=m.observatory)!=null?S:{},null,2):ie==="burstObservatory"?JSON.stringify((H=m.burstObservatory)!=null?H:{},null,2):""},On=m=>{try{const S=JSON.parse(m),H={...W.getValues("config")||{}};ie==="observatory"&&(H.observatory=S),ie==="burstObservatory"&&(H.burstObservatory=S),W.setValue("config",H,{shouldDirty:!0})}catch{}},Wn=m=>!m&&m!==0?[]:Array.isArray(m)?m.map(S=>typeof S=="string"?S.trim():String(S)).filter(Boolean):typeof m=="string"?m.split(",").map(S=>S.trim()).filter(Boolean):[String(m)],Rr=(m,S="blue")=>{const H=Wn(m);return H.length?e(Gh,{chips:H,color:S}):e(h,{color:"gray.400",children:"-"})},ds=m=>{if(m==null||m===""||typeof m=="string"&&!m.trim())return e(h,{color:"gray.400",children:"-"});const S=typeof m=="string"?m:String(m);return S.length>30?e(Xh,{text:S,label:t("details")}):e(h,{children:S})},Fn=m=>{if(!m)return e(h,{color:"gray.400",children:"-"});try{const S=JSON.parse(m);if(S&&typeof S=="object"&&!Array.isArray(S)){const H=Object.entries(S);return H.length?e(L,{display:"flex",flexWrap:"wrap",gap:"1",children:H.map(([Ue,$e])=>e(nt,{colorScheme:"purple",size:"sm",children:`${Ue}: ${String($e)}`},Ue))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:m})},Hn=Mn(),Bn=Un();return s(le,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(xe,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:s(xe,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(G,{size:"sm",colorScheme:"primary",isLoading:i,isDisabled:!te||i,onClick:zt,w:{base:"full",sm:"auto"},children:t("core.save")}),e(G,{size:"sm",leftIcon:e(ro,{}),isLoading:kt,onClick:()=>Oe(),variant:"outline",w:{base:"full",sm:"auto"},children:t(kt?"core.restarting":"core.restartCore")})]})}),s(Js,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[s(qs,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(Bt,{children:s(O,{spacing:2,align:"center",children:[e(yp,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(Bt,{children:s(O,{spacing:2,align:"center",children:[e(Sp,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(Bt,{children:s(O,{spacing:2,align:"center",children:[e(xp,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(Bt,{children:s(O,{spacing:2,align:"center",children:[e(kp,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(Bt,{children:s(O,{spacing:2,align:"center",children:[e(wp,{}),e(h,{as:"span",children:t("DNS")})]})}),e(Bt,{children:s(O,{spacing:2,align:"center",children:[e(vp,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(Bt,{children:s(O,{spacing:2,align:"center",children:[e(Cp,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),s(Ys,{children:[e(Vt,{children:s(le,{spacing:4,align:"stretch",children:[s(za,{title:t("pages.xray.generalConfigs"),children:[e(Pr,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:m=>s(Ye,{id:m,size:"sm",maxW:"220px",value:Ir,onChange:S=>bt(S.target.value),isDisabled:nr===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(S=>e("option",{value:S,children:S},S))]})}),e(Pr,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:m=>e(st,{name:"config.routing.domainStrategy",control:W.control,render:({field:S})=>e(Ye,{...S,id:m,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(H=>e("option",{value:H,children:H},H))})})})]}),e(L,{borderWidth:"1px",borderColor:Cs,borderRadius:"lg",bg:pe,p:{base:3,md:4},children:s(le,{align:"stretch",spacing:3,children:[s(O,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(G,{variant:"outline",size:"sm",leftIcon:e(so,{}),onClick:me,children:pr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:Gr,children:t("pages.xray.warpRoutingDesc")}),s(Qn,{children:[Jt.length===0&&e(bn,{children:e(nt,{colorScheme:"gray",variant:"subtle",children:e(mi,{children:t("core.empty","Empty")})})}),Jt.map(m=>e(bn,{children:s(nt,{colorScheme:"primary",borderRadius:"full",children:[e(mi,{children:m}),e(Lc,{"aria-label":t("core.remove"),onClick:()=>Tr(m)})]})},m))]}),s(O,{spacing:3,flexWrap:"wrap",children:[e(Ye,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:dt,onChange:m=>{const{value:S}=m.target;S&&Xt(S),Je("")},children:_p.map(m=>e("option",{value:m.value,children:m.label},m.value))}),s(O,{spacing:2,maxW:"320px",flex:"1",children:[e(be,{size:"sm",value:q,onChange:m=>x(m.target.value),placeholder:"geosite:google"}),e(G,{size:"sm",colorScheme:"primary",onClick:()=>{Xt(q),x("")},isDisabled:!q.trim(),children:t("core.add")})]})]})]})}),s(za,{title:t("pages.xray.statistics"),children:[e(Pr,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:m=>e(st,{name:"config.policy.system.statsInboundUplink",control:W.control,render:({field:S})=>e(ot,{id:m,isChecked:!!S.value,onChange:H=>S.onChange(H.target.checked)})})}),e(Pr,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:m=>e(st,{name:"config.policy.system.statsInboundDownlink",control:W.control,render:({field:S})=>e(ot,{id:m,isChecked:!!S.value,onChange:H=>S.onChange(H.target.checked)})})}),e(Pr,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:m=>e(st,{name:"config.policy.system.statsOutboundUplink",control:W.control,render:({field:S})=>e(ot,{id:m,isChecked:!!S.value,onChange:H=>S.onChange(H.target.checked)})})}),e(Pr,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:m=>e(st,{name:"config.policy.system.statsOutboundDownlink",control:W.control,render:({field:S})=>e(ot,{id:m,isChecked:!!S.value,onChange:H=>S.onChange(H.target.checked)})})})]}),s(za,{title:t("pages.xray.logConfigs"),children:[e(Pr,{label:t("pages.xray.logLevel"),controlId:"log-level",children:m=>e(st,{name:"config.log.loglevel",control:W.control,render:({field:S})=>e(Ye,{...S,id:m,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(H=>e("option",{value:H,children:H},H))})})}),e(Pr,{label:t("pages.xray.accessLog"),controlId:"access-log",children:m=>e(st,{name:"config.log.access",control:W.control,render:({field:S})=>s(Ye,{...S,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(H=>e("option",{value:H,children:H},H))]})})}),e(Pr,{label:t("pages.xray.errorLog"),controlId:"error-log",children:m=>e(st,{name:"config.log.error",control:W.control,render:({field:S})=>s(Ye,{...S,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(H=>e("option",{value:H,children:H},H))]})})}),e(Pr,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:m=>e(st,{name:"config.log.maskAddress",control:W.control,render:({field:S})=>s(Ye,{...S,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(H=>e("option",{value:H,children:H},H))]})})}),e(Pr,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:m=>e(st,{name:"config.log.dnsLog",control:W.control,render:({field:S})=>e(ot,{id:m,isChecked:!!S.value,onChange:H=>S.onChange(H.target.checked)})})})]})]})}),e(Vt,{children:s(le,{spacing:4,align:"stretch",children:[e(G,{leftIcon:e(sn,{}),...on,onClick:Et,children:t("pages.xray.rules.add")}),e(ln,{children:s(cn,{minW:"1100px",children:[s(Wr,{children:[s(Ct,{children:[e(Le,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(Le,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(Le,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(Le,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(Le,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(Le,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(Le,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(Le,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),s(Ct,{children:[e(Le,{children:t("IP",{defaultValue:"IP"})}),e(Le,{children:t("port",{defaultValue:"Port"})}),e(Le,{children:t("network",{defaultValue:"Network"})}),e(Le,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(Le,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(Le,{children:t("IP",{defaultValue:"IP"})}),e(Le,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(Le,{children:t("port",{defaultValue:"Port"})}),e(Le,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(Le,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),s(Nr,{children:[he.length===0&&e(Ct,{children:e(ze,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),he.map((m,S)=>s(Ct,{children:[e(ze,{children:s(le,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:S+1}),s(O,{spacing:1,children:[e(Ne,{"aria-label":"move up",icon:e(eo,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>k(S,S-1)}),e(Ne,{"aria-label":"move down",icon:e(to,{}),size:"xs",variant:"ghost",isDisabled:S===he.length-1,onClick:()=>k(S,S+1)})]})]})}),e(ze,{children:Rr(m.source,"blue")}),e(ze,{children:ds(m.sourcePort)}),e(ze,{children:Rr(m.network,"purple")}),e(ze,{children:Rr(m.protocol,"green")}),e(ze,{children:Fn(m.attrs)}),e(ze,{children:Rr(m.ip,"blue")}),e(ze,{children:Rr(m.domain,"blue")}),e(ze,{children:ds(m.port)}),e(ze,{children:Rr(m.inboundTag,"teal")}),e(ze,{children:Rr(m.user,"cyan")}),e(ze,{children:ds(m.outboundTag)}),e(ze,{children:ds(m.balancerTag)}),e(ze,{children:s(O,{spacing:1,children:[e(Ne,{"aria-label":"edit",icon:e(an,{}),size:"xs",variant:"ghost",onClick:()=>rr(S)}),e(Ne,{"aria-label":"delete",icon:e(nn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>$(S)})]})})]},m.key))]})]})})]})}),e(Vt,{children:s(le,{spacing:4,align:"stretch",children:[s(O,{children:[e(G,{leftIcon:e(sn,{}),...on,onClick:Gt,children:t("pages.xray.outbound.addOutbound")}),e(G,{leftIcon:e(so,{}),size:"xs",variant:"ghost",onClick:me,children:pr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(G,{leftIcon:e(ro,{}),size:"xs",variant:"ghost",onClick:Kt,children:t("refresh")})]}),e(ln,{children:s(cn,{minW:"880px",children:[e(Wr,{children:s(Ct,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.outbound.tag")}),e(Le,{children:t("protocol")}),e(Le,{children:t("pages.xray.outbound.address")}),e(Le,{children:t("pages.inbounds.traffic")})]})}),e(Nr,{children:j.map((m,S)=>{var H,Ue,$e;return s(Ct,{children:[e(ze,{children:s(O,{children:[e(h,{children:S+1}),e(Ne,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(eo,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>ut(S)}),e(Ne,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(to,{}),size:"xs",variant:"ghost",isDisabled:S===j.length-1,onClick:()=>tr(S)}),e(Ne,{"aria-label":"edit",icon:e(an,{}),size:"xs",variant:"ghost",onClick:()=>er(S)}),e(Ne,{"aria-label":"delete",icon:e(nn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Wt(S)})]})}),e(ze,{children:m.tag}),s(ze,{children:[e(nt,{colorScheme:"purple",children:m.protocol}),["vmess","vless","trojan","shadowsocks"].includes(m.protocol)&&s(Rt,{children:[e(nt,{colorScheme:"blue",children:(H=m.streamSettings)==null?void 0:H.network}),((Ue=m.streamSettings)==null?void 0:Ue.security)==="tls"&&e(nt,{colorScheme:"green",children:"tls"}),(($e=m.streamSettings)==null?void 0:$e.security)==="reality"&&e(nt,{colorScheme:"green",children:"reality"})]})]}),e(ze,{children:qr(m).map(Me=>e(h,{children:Me},Me))}),e(ze,{children:e(nt,{colorScheme:"green",children:Dr(m)})})]},m.key)})})]})})]})}),e(Vt,{children:s(le,{spacing:4,align:"stretch",children:[e(G,{leftIcon:e(sn,{}),...on,onClick:Fe,children:t("pages.xray.balancer.addBalancer")}),e(ln,{children:s(cn,{minW:"680px",children:[e(Wr,{children:s(Ct,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.balancer.tag")}),e(Le,{children:t("pages.xray.balancer.balancerStrategy")}),e(Le,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(Nr,{children:ve.map((m,S)=>s(Ct,{children:[e(ze,{children:s(O,{children:[e(h,{children:S+1}),e(Ne,{"aria-label":"edit",icon:e(an,{}),size:"xs",variant:"ghost",onClick:()=>Re()}),e(Ne,{"aria-label":"delete",icon:e(nn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>et(S)})]})}),e(ze,{children:m.tag}),e(ze,{children:e(nt,{colorScheme:m.strategy==="random"?"purple":"green",children:m.strategy==="random"?"Random":m.strategy==="roundRobin"?"Round Robin":m.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(ze,{children:m.selector.map(H=>e(nt,{colorScheme:"blue",m:1,children:H},H))})]},m.key))})]})}),(((Qs=W.getValues("config"))==null?void 0:Qs.observatory)||((Zs=W.getValues("config"))==null?void 0:Zs.burstObservatory))&&s(le,{spacing:3,align:"stretch",children:[e(oa,{onChange:m=>{ne(m),fe(S=>S+1)},value:ie,children:s(O,{spacing:3,children:[((ye=W.getValues("config"))==null?void 0:ye.observatory)&&e(Mr,{value:"observatory",children:"Observatory"}),((vt=W.getValues("config"))==null?void 0:vt.burstObservatory)&&e(Mr,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(L,{h:"300px",children:e($a,{json:Hn,onChange:m=>On(m)},`obs-${ie}-${K}`)})]})]})}),e(Vt,{children:s(le,{spacing:4,align:"stretch",children:[s(w,{display:"flex",alignItems:"center",children:[e(C,{children:t("pages.xray.dns.enable")}),e(st,{name:"config.dns",control:W.control,render:({field:m})=>e(ot,{isChecked:!!m.value,onChange:S=>{const H={...W.getValues("config")};S.target.checked?H.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete H.dns,delete H.fakedns),W.setValue("config",H,{shouldDirty:!0}),F([]),de([])}})})]}),E.length>0&&s(Rt,{children:[e(G,{leftIcon:e(sn,{}),...on,onClick:ft,children:t("pages.xray.dns.add")}),e(ln,{children:s(cn,{minW:"720px",children:[e(Wr,{children:s(Ct,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.outbound.address")}),e(Le,{children:t("pages.xray.dns.domains")}),e(Le,{children:t("pages.xray.dns.expectIPs")})]})}),e(Nr,{children:E.map((m,S)=>s(Ct,{children:[e(ze,{children:s(O,{children:[e(h,{children:S+1}),e(Ne,{"aria-label":"edit",icon:e(an,{}),size:"xs",variant:"ghost",onClick:()=>Pt()}),e(Ne,{"aria-label":"delete",icon:e(nn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>it(S)})]})}),e(ze,{children:typeof m=="object"?m.address:m}),e(ze,{children:typeof m=="object"?no(m.domains):""}),e(ze,{children:typeof m=="object"?no(m.expectIPs):""})]},S))})]})})]}),ce.length>0&&s(Rt,{children:[e(G,{leftIcon:e(sn,{}),...on,onClick:Nt,children:t("pages.xray.fakedns.add")}),e(ln,{children:s(cn,{minW:"520px",children:[e(Wr,{children:s(Ct,{children:[e(Le,{children:"#"}),e(Le,{children:t("pages.xray.fakedns.ipPool")}),e(Le,{children:t("pages.xray.fakedns.poolSize")})]})}),e(Nr,{children:ce.map((m,S)=>s(Ct,{children:[e(ze,{children:s(O,{children:[e(h,{children:S+1}),e(Ne,{"aria-label":"edit",icon:e(an,{}),size:"xs",variant:"ghost",onClick:()=>Lt()}),e(Ne,{"aria-label":"delete",icon:e(nn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Jr(S)})]})}),e(ze,{children:m.ipPool}),e(ze,{children:m.poolSize})]},S))})]})})]})]})}),e(Vt,{children:s(le,{spacing:4,align:"stretch",children:[s(L,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(L,{px:2,children:e(oa,{onChange:m=>{Xe(m),fe(S=>S+1)},value:ke,children:s(O,{spacing:3,wrap:"wrap",children:[e(Mr,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Mr,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Mr,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Mr,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),s(L,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(Ne,{position:X?"fixed":"absolute",top:2,right:2,"aria-label":X?"Exit Full Screen":"Full Screen",icon:X?e(bp,{}):e(fp,{}),onClick:Xs,zIndex:X?1101:10}),e(L,{w:X?"100vw":"100%",h:X?"100vh":"100%",position:X?"fixed":"relative",top:X?0:"auto",left:X?0:"auto",zIndex:X?1e3:"auto",children:e($a,{json:Bn,onChange:m=>{Ln(m)}},`advanced-${ke}-${K}`)}),X&&oe&&e(G,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:Xs,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(Vt,{children:e(L,{children:e(ml,{showTitle:!1})})})]})]}),e(ep,{isOpen:p,onClose:or,mode:J!==null?"edit":"create",initialOutbound:J!==null?Mt[J]:null,onSubmitOutbound:As}),e(op,{isOpen:A,mode:Y!==null?"edit":"create",initialRule:Y!==null&&zr[Y]||null,availableInboundTags:Ar,availableOutboundTags:Yr,availableBalancerTags:sr,onSubmit:T,onClose:Te}),e(gp,{isOpen:_e,onClose:ba,initialOutbound:kr,onSave:_s,onDelete:Ds}),e(lp,{isOpen:y,onClose:z,form:W,setBalancersData:M}),e(cp,{isOpen:U,onClose:D,form:W,setDnsServers:F}),e(dp,{isOpen:B,onClose:P,form:W,setFakeDns:de})]})},Ap=({isOpen:t,onClose:n,onSubmit:r,isSaving:l,allHosts:o,allAdmins:i,initialService:a})=>{var N,he,Ae,ve;const{t:c}=He(),[u,p]=d.exports.useState((N=a==null?void 0:a.name)!=null?N:""),[g,f]=d.exports.useState((he=a==null?void 0:a.description)!=null?he:""),[A,v]=d.exports.useState((Ae=a==null?void 0:a.admin_ids)!=null?Ae:[]),[b,y]=d.exports.useState((ve=a==null?void 0:a.hosts.map(M=>M.id))!=null?ve:[]),[_,z]=d.exports.useState(""),[U,re]=d.exports.useState(""),[D,B]=d.exports.useState(null),I=Ut();d.exports.useEffect(()=>{var M,E,F,ce;t&&(p((M=a==null?void 0:a.name)!=null?M:""),f((E=a==null?void 0:a.description)!=null?E:""),v((F=a==null?void 0:a.admin_ids)!=null?F:[]),y((ce=a==null?void 0:a.hosts.map(de=>de.id))!=null?ce:[]),z(""),re(""))},[t,a]);const P=d.exports.useMemo(()=>new Map(o.map(M=>[M.id,M])),[o]),_e=d.exports.useMemo(()=>o.filter(M=>!b.includes(M.id)&&!M.isDisabled),[o,b]),me=d.exports.useMemo(()=>{const M=U.trim().toLowerCase();return M?_e.filter(E=>{const F=E.label.toLowerCase(),ce=E.inboundTag.toLowerCase(),de=E.protocol.toLowerCase();return F.includes(M)||ce.includes(M)||de.includes(M)}):_e},[_e,U]),se=d.exports.useMemo(()=>{const M=_.trim().toLowerCase();return M?i.filter(E=>E.username.toLowerCase().includes(M)):i},[_,i]),W=d.exports.useMemo(()=>new Set(A),[A]),Q=M=>{v(E=>E.includes(M)?E.filter(F=>F!==M):[...E,M])},ue=M=>{y(E=>E.includes(M)?E.filter(F=>F!==M):[...E,M])},te=(M,E)=>{y(F=>{const ce=F.indexOf(M);if(ce===-1)return F;const de=E==="up"?ce-1:ce+1;if(de<0||de>=F.length)return F;const De=[...F];return[De[ce],De[de]]=[De[de],De[ce]],De})},j=async()=>{if(!u.trim()){I({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!b.length){I({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const M=b.map((E,F)=>({host_id:E,sort:F}));await r({name:u.trim(),description:(g==null?void 0:g.trim())||null,admin_ids:A,hosts:M},a==null?void 0:a.id)};return s(It,{isOpen:t,onClose:n,size:"5xl",children:[e(pt,{}),s(Tt,{children:[e(gt,{children:a?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Dt,{}),e(mt,{children:s(xe,{spacing:6,children:[s(O,{spacing:4,children:[e($t,{label:c("services.fields.name","Name"),value:u,onChange:M=>p(M.target.value),maxLength:128,isRequired:!0}),e($t,{label:c("services.fields.description","Description"),value:g!=null?g:"",onChange:M=>f(M.target.value),maxLength:256})]}),s(L,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),s(xe,{spacing:3,children:[e($t,{value:_,onChange:M=>z(M.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(le,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:i.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):se.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):se.map(M=>{const E=W.has(M.id);return e(L,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:E?"primary.400":"gray.200",bg:E?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:E?"primary.300":"gray.600",bg:E?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>Q(M.id),onKeyDown:F=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),Q(M.id))},role:"button",tabIndex:0,children:s(St,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:M.username}),E&&e(Kr,{colorScheme:"primary",children:c("services.selected","Selected")})]})},M.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),s(Za,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(ms,{children:s(Br,{variant:"outline",h:"full",children:[e(Ls,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(Zr,{children:s(xe,{spacing:3,children:[e($t,{value:U,onChange:M=>re(M.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(le,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:_e.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):me.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):me.map(M=>s(L,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:D===M.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>B(M.id),onMouseLeave:()=>B(null),onClick:()=>ue(M.id),children:[e(h,{fontWeight:"medium",children:M.label}),s(h,{fontSize:"sm",color:"gray.500",children:[M.protocol.toUpperCase()," - ",M.inboundTag]})]},M.id))})]})})]})}),e(ms,{children:s(Br,{variant:"outline",h:"full",children:[e(Ls,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(Zr,{children:s(le,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[b.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),b.map((M,E)=>{const F=P.get(M);return F?e(Mc.div,{layout:!0,children:s(St,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[s(L,{children:[s(O,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:F.label}),F.isDisabled&&e(Kr,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),s(h,{fontSize:"sm",color:"gray.500",children:[F.protocol.toUpperCase()," - ",F.inboundTag]})]}),s(O,{spacing:1,children:[e(at,{label:c("services.moveUp","Move up"),children:e(Ne,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(Vo,{width:16}),onClick:()=>te(M,"up"),isDisabled:E===0})}),e(at,{label:c("services.moveDown","Move down"),children:e(Ne,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e($o,{width:16}),onClick:()=>te(M,"down"),isDisabled:E===b.length-1})}),e(at,{label:c("services.removeHost","Remove host"),children:e(Ne,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(Vr,{width:16}),onClick:()=>ue(M)})})]})]})},M):null})]})})]})})]})]})}),e(_t,{children:s(O,{justify:"flex-end",w:"full",children:[e(G,{onClick:n,children:c("cancel")}),e(G,{colorScheme:"primary",onClick:j,isLoading:l,children:c(a?"saveChanges":"create")})]})})]})]})},Ip=()=>{var Xe;const{t}=He(),n=Ut(),{userData:r,getUserIsSuccess:l}=vs(),o=l&&r.is_sudo,i=Os(),a=ss(),c=el(),{inbounds:u,refetchUsers:p}=ht(),g=Yt(),[f,A]=d.exports.useState(null);d.exports.useEffect(()=>{!l||!o||(i.fetchServices(),a.fetchAdmins({limit:500,offset:0}),kn(),c.fetchHosts())},[l,o]);const v=d.exports.useMemo(()=>a.admins.slice().sort((ie,ne)=>ie.username.localeCompare(ne.username)).map(ie=>({id:ie.id,username:ie.username})),[a.admins]),b=d.exports.useMemo(()=>{var ne,oe;const ie=[];for(const[K,fe]of Object.entries(c.hosts)){const dt=(ne=Array.from(u.values()).flat().find(q=>q.tag===K))!=null?ne:null,Je=(oe=dt==null?void 0:dt.protocol)!=null?oe:"unknown";fe.forEach(q=>{q.id!=null&&ie.push({id:q.id,label:q.remark,inboundTag:K,protocol:Je,isDisabled:Boolean(q.is_disabled)})})}return ie},[c.hosts,u]),y=()=>{A(null),g.onOpen()},_=async ie=>{try{const ne=await i.fetchServiceDetail(ie);A(ne),g.onOpen()}catch{n({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},z=async(ie,ne)=>{var oe,K;try{ne?(await i.updateService(ne,ie),n({status:"success",title:t("services.updated","Service updated")})):(await i.createService(ie),n({status:"success",title:t("services.created","Service created")})),p(),g.onClose()}catch(fe){n({status:"error",title:(K=(oe=fe==null?void 0:fe.data)==null?void 0:oe.detail)!=null?K:t("services.saveFailed","Failed to save service")})}},U=async ie=>{var ne,oe;try{const K=await i.fetchServiceDetail(ie);Ae(K),we()}catch(K){n({status:"error",title:(oe=(ne=K==null?void 0:K.data)==null?void 0:ne.detail)!=null?oe:t("services.deleteFailed","Unable to delete service")})}},re=async ie=>{var ne,oe;try{await i.resetServiceUsage(ie),n({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(K){n({status:"error",title:(oe=(ne=K==null?void 0:K.data)==null?void 0:ne.detail)!=null?oe:t("services.resetFailed","Failed to reset usage")})}},[D,B]=d.exports.useState(null),[I,P]=d.exports.useState(!1),{isOpen:_e,onOpen:me,onClose:se}=Yt(),W=d.exports.useRef(null),Q=ie=>{B(ie),me()},ue=async()=>{if(D!=null){P(!0);try{await re(D)}finally{P(!1),se()}}},te=D!=null?(Xe=i.services.find(ie=>ie.id===D))==null?void 0:Xe.name:void 0,j=()=>{Ae(null),J()},N=async()=>{var ne,oe;if(!he)return;const ie={mode:he.user_count?ve:"delete_users",unlink_admins:E};if(ie.mode==="transfer_users"){if(!ce){n({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}ie.target_service_id=ce}Ee(!0);try{await i.deleteService(he.id,ie),n({status:"success",title:t("services.deleted","Service removed")}),p(),j()}catch(K){n({status:"error",title:(oe=(ne=K==null?void 0:K.data)==null?void 0:ne.detail)!=null?oe:t("services.deleteFailed","Unable to delete service")})}finally{Ee(!1)}},[he,Ae]=d.exports.useState(null),[ve,M]=d.exports.useState("delete_users"),[E,F]=d.exports.useState(!1),[ce,de]=d.exports.useState(null),[De,Ee]=d.exports.useState(!1),{isOpen:Y,onOpen:we,onClose:J}=Yt(),Se=d.exports.useMemo(()=>he?i.services.filter(ie=>ie.id!==he.id):i.services,[he,i.services]);d.exports.useEffect(()=>{he&&(M("delete_users"),F(he.admin_ids.length>0),de(null))},[he]),d.exports.useEffect(()=>{ve==="delete_users"&&de(null)},[ve]);const X=ie=>e(Lo,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:ne})=>s(Rt,{children:[s(Mo,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[s(L,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:ie.name}),ie.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:ne?3:1,mt:1,children:ie.description})]}),s(le,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[s(O,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:ie.host_count})]}),s(O,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:ie.user_count})]})]}),e(Oc,{})]}),e(Oo,{pt:0,pb:4,children:s(xe,{spacing:4,children:[s(Ve,{columns:2,spacing:3,children:[s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:qe(ie.used_traffic)})]}),s(L,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:qe(ie.lifetime_used_traffic)})]})]}),s(xe,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),s(O,{spacing:2,flexWrap:"wrap",children:[e(at,{label:t("services.view","View"),children:e(Ne,{"aria-label":"View",icon:e(yn,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),i.fetchServiceDetail(ie.id)}})}),e(at,{label:t("services.edit","Edit"),children:e(Ne,{"aria-label":"Edit",icon:e(Oa,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),_(ie.id)},isDisabled:!o})}),e(at,{label:t("services.resetUsage","Reset usage"),children:e(Ne,{"aria-label":"Reset usage",icon:e($r,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),Q(ie.id)},isDisabled:!o})}),e(at,{label:t("services.delete","Delete"),children:e(Ne,{"aria-label":"Delete",icon:e(Vr,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:oe=>{oe.stopPropagation(),U(ie.id)},isDisabled:!o})})]})]})]})})]})},`service-accordion-${ie.id}`),ge=ie=>s(Ct,{children:[e(ze,{children:s(le,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:ie.name}),ie.description&&e(h,{fontSize:"sm",color:"gray.500",children:ie.description})]})}),e(ze,{children:ie.host_count}),e(ze,{children:ie.user_count}),e(ze,{children:qe(ie.used_traffic)}),e(ze,{children:qe(ie.lifetime_used_traffic)}),e(ze,{children:s(O,{spacing:2,children:[e(at,{label:t("services.view","View"),children:e(Ne,{"aria-label":"View",icon:e(yn,{width:18}),size:"sm",variant:"ghost",onClick:()=>i.fetchServiceDetail(ie.id)})}),o&&s(Rt,{children:[e(at,{label:t("services.edit","Edit"),children:e(Ne,{"aria-label":"Edit",icon:e(Oa,{width:18}),size:"sm",variant:"ghost",onClick:()=>_(ie.id)})}),e(at,{label:t("services.resetUsage","Reset usage"),children:e(Ne,{"aria-label":"Reset usage",icon:e($r,{width:18}),size:"sm",variant:"ghost",onClick:()=>Q(ie.id)})}),e(at,{label:t("services.delete","Delete"),children:e(Ne,{"aria-label":"Delete",icon:e(Vr,{width:18}),size:"sm",variant:"ghost",onClick:()=>U(ie.id)})})]})]})})]},ie.id),ke=i.serviceDetail;return l?o?s(le,{spacing:4,align:"stretch",children:[s(St,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[s(L,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),o&&e(G,{leftIcon:e(ts,{width:18}),colorScheme:"primary",onClick:y,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(Br,{variant:"outline",children:e(Zr,{children:i.isLoading?e(St,{justify:"center",py:10,children:e(xt,{})}):s(Rt,{children:[e(Uo,{allowToggle:!0,display:{base:"block",md:"none"},children:i.services.map(X)}),e(L,{display:{base:"none",md:"block"},overflowX:"auto",children:s(ys,{variant:"simple",children:[e(Wr,{children:s(Ct,{children:[e(Le,{children:t("services.columns.name","Name")}),e(Le,{children:t("services.columns.hosts","Hosts")}),e(Le,{children:t("services.columns.users","Users")}),e(Le,{children:t("services.columns.usage","Usage")}),e(Le,{children:t("services.columns.lifetime","Lifetime")}),e(Le,{children:t("services.columns.actions","Actions")})]})}),e(Nr,{children:i.services.map(ge)})]})})]})})}),ke&&s(Br,{variant:"outline",children:[e(Ls,{children:s(St,{justify:"space-between",align:"center",children:[s(L,{children:[e(h,{fontWeight:"semibold",children:ke.name}),ke.description&&e(h,{fontSize:"sm",color:"gray.500",children:ke.description})]}),e(Kr,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:ke.user_count})})]})}),e(Zr,{children:s(Ve,{columns:{base:1,md:2},spacing:6,children:[s(L,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(xe,{spacing:2,children:ke.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):ke.admins.map(ie=>s(St,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:ie.username}),s(h,{fontSize:"sm",color:"gray.500",children:[qe(ie.used_traffic)," /"," ",qe(ie.lifetime_used_traffic)]})]},ie.id))})]}),s(L,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(xe,{spacing:2,children:ke.hosts.map(ie=>s(St,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[s(L,{children:[e(h,{fontWeight:"medium",children:ie.remark}),s(h,{fontSize:"sm",color:"gray.500",children:[ie.inbound_protocol.toUpperCase()," - ",ie.inbound_tag]})]}),s(Kr,{colorScheme:"gray",children:["#",ie.sort+1]})]},ie.id))})]})]})})]}),e(Sn,{isOpen:_e,leastDestructiveRef:W,onClose:se,isCentered:!0,motionPreset:"slideInBottom",children:e(pt,{children:s(xn,{mx:{base:4,sm:0},children:[e(gt,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(mt,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:te!=null?te:t("services.thisService","this service")})}),s(_t,{children:[e(G,{ref:W,onClick:se,children:t("cancel","Cancel")}),e(G,{colorScheme:"primary",ml:3,onClick:ue,isLoading:I,children:t("services.resetUsage","Reset usage")})]})]})})}),s(It,{isOpen:Y,onClose:j,size:"lg",children:[e(pt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(Tt,{children:[s(gt,{children:[t("services.deleteDialogTitle","Delete Service"),he?` \u2013 ${he.name}`:""]}),e(Dt,{}),e(mt,{children:he?s(le,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:he.name})}),he.admin_ids.length>0?e(Sr,{isChecked:E,onChange:ie=>F(ie.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),he.user_count>0?s(le,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:he.user_count})}),e(oa,{value:ve,onChange:ie=>M(ie),children:s(xe,{align:"flex-start",spacing:2,children:[e(Mr,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Mr,{value:"transfer_users",isDisabled:Se.length===0,children:Se.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),ve==="transfer_users"&&Se.length>0&&s(w,{isRequired:!0,children:[e(C,{children:t("services.selectTargetService","Target service")}),e(Ye,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:ce!=null?ce:"",onChange:ie=>de(ie.target.value?Number(ie.target.value):null),children:Se.map(ie=>e("option",{value:ie.id,children:ie.name},ie.id))}),e(Cr,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):s(br,{status:"info",borderRadius:"md",children:[e(yr,{}),e(os,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),s(_t,{gap:3,children:[e(G,{variant:"ghost",onClick:j,children:t("cancel","Cancel")}),e(G,{colorScheme:"red",onClick:N,isLoading:De,isDisabled:Boolean((he==null?void 0:he.user_count)&&ve==="transfer_users"&&Se.length>0&&!ce),children:t("services.delete","Delete")})]})]})]}),e(Ap,{isOpen:g.isOpen,onClose:g.onClose,onSubmit:z,isSaving:i.isSaving,allHosts:b,allAdmins:v,initialService:f!=null?f:void 0})]}):s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(St,{justify:"center",align:"center",h:"full",py:10,children:e(xt,{})})};We.extend(Pn);const ao=Z(Cn,{baseStyle:{w:4,h:4}}),Tp=Z(ei,{baseStyle:{w:4,h:4}}),Pp={key:"30d",label:"30d",amount:30,unit:"day"},Ep=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,l=We.utc(r);return l.isValid()?n?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},io=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",oo=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Kn=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return We.utc(r).valueOf()},lo=t=>{const n=t.unit==="hour"?"hour":"day",r=We().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},Np=(t,n)=>{const r=We(t),l=We(n),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},zp=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>qe(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>qe(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Rp=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>qe(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Up=()=>{var De,Ee,Y,we;const{t}=He(),{colorMode:n}=cs(),{admins:r}=ss(),l="auto-end",o=(De=ur({base:"bottom",md:"auto-end"}))!=null?De:l,[i,a]=d.exports.useState([]),[c,u]=d.exports.useState([]),[p,g]=d.exports.useState(null),[f,A]=d.exports.useState([]),[v,b]=d.exports.useState(!1),y=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),_=(Ee=y.find(J=>J.key==="30d"))!=null?Ee:Pp,[z,U]=d.exports.useState(()=>lo(_)),[re,D]=d.exports.useState(_.key),[B,I]=d.exports.useState(null),[P,_e]=d.exports.useState([]),[me,se]=d.exports.useState(!1),[W,Q]=d.exports.useState(!1),[ue,te]=d.exports.useState([z.start,z.end]);d.exports.useMemo(()=>{var J;return(J=c.find(Se=>Se.id===p))!=null?J:null},[c,p]);const j=d.exports.useMemo(()=>{if(!p)return i;const J=new Set(f.map(X=>X.username).filter(X=>Boolean(X))),Se=i.filter(X=>J.has(X.username));return Se.length?Se:i},[i,p,f]),N=d.exports.useMemo(()=>f.reduce((J,Se)=>J+(Se.used_traffic||0),0),[f]),he=d.exports.useMemo(()=>f.map(J=>J.used_traffic||0),[f]),Ae=d.exports.useMemo(()=>f.map(J=>J.username||t("services.unassignedAdmin","Unassigned")),[f,t]),ve=d.exports.useMemo(()=>Rp(n,Ae),[n,Ae]);d.exports.useEffect(()=>{W||te([z.start,z.end])},[W,z.start,z.end]),d.exports.useEffect(()=>{let J=!1;return(async()=>{var X;try{const ge=await Ce("/v2/services",{query:{limit:500}});if(J||!ge)return;const ke=(X=ge.services)!=null?X:[];u(ke),g(Xe=>Xe!==null?Xe:ke.length?ke[0].id:null)}catch{J||u([])}})(),()=>{J=!0}},[]),d.exports.useEffect(()=>{if(!p){A([]);return}let J=!1;return b(!0),Ce(`/v2/services/${p}/usage/admins`,{query:{start:io(z.start),end:oo(z.end)}}).then(Se=>{var X;J||!Se||A((X=Se.admins)!=null?X:[])}).catch(()=>{J||A([])}).finally(()=>{J||b(!1)}),()=>{J=!0}},[p,z.start,z.end,z.unit]),d.exports.useEffect(()=>{let J=!1;return(async()=>{try{const X=await Ce("/admins");if(J)return;Array.isArray(X)?a(X):a(X.admins||[])}catch(X){console.error("Failed to load all admins:",X),a(r||[])}})(),()=>{J=!0}},[r]),d.exports.useEffect(()=>{if(!B)return;let J=!1;se(!0);const Se=z.unit==="hour",X={start:io(z.start),end:oo(z.end)};Se&&(X.granularity="hour");const ge=Se?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:B,endpoint:ge,query:X}),Ce(`/admin/${encodeURIComponent(B)}/usage/${ge}`,{query:X}).then(ke=>{if(J)return;const Xe=Array.isArray(ke==null?void 0:ke.usages)?ke.usages:[];console.debug("AdminsUsage: response usages",{length:Xe.length,endpoint:ge});let ie;if(Se){const ne=new Map;Xe.forEach(K=>{var Je,q;const fe=typeof(K==null?void 0:K.date)=="string"?K.date:"";if(!fe)return;const dt=(Je=ne.get(fe))!=null?Je:0;ne.set(fe,dt+Number((q=K==null?void 0:K.used_traffic)!=null?q:0))});const oe=Array.from(ne.entries());oe.sort((K,fe)=>{const[dt]=K,[Je]=fe;return Kn(dt)-Kn(Je)}),ie=oe.map(([K,fe])=>({date:K,used_traffic:fe}))}else{const ne=Xe.map(oe=>{var K,fe;return{date:(K=oe==null?void 0:oe.date)!=null?K:"",used_traffic:Number((fe=oe==null?void 0:oe.used_traffic)!=null?fe:0)}});ne.sort((oe,K)=>Kn(oe.date)-Kn(K.date)),ie=ne}_e(ie)}).catch(ke=>{J||(console.error("Error fetching admin usage:",ke),_e([]))}).finally(()=>{J||se(!1)}),()=>{J=!0}},[B,z]),d.exports.useEffect(()=>{if(!j||j.length===0)return;j.some(Se=>Se.username===B)||I(j[0].username)},[j,B]),d.exports.useEffect(()=>{const J=y.find(Se=>Se.key===z.key);D(J?J.key:"custom")},[z,y]);const M=d.exports.useMemo(()=>P.map(J=>Ep(J.date)),[P]),E=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:P.map(J=>J.used_traffic)}],[P,t]),F=d.exports.useMemo(()=>({options:zp(n,M),series:E}),[n,M,E]),ce=d.exports.useMemo(()=>P.reduce((J,Se)=>J+Number(Se.used_traffic||0),0),[P]),de=d.exports.useMemo(()=>{const J=We(z.start).format("YYYY-MM-DD"),Se=We(z.end).format("YYYY-MM-DD");return J===Se?J:`${J} - ${Se}`},[z.start,z.end]);return s(le,{spacing:4,align:"stretch",children:[s(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(xe,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[s(le,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),s(xe,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(Ye,{value:p!=null?p:"",onChange:J=>{const Se=Number(J.target.value);g(Number.isNaN(Se)?null:Se)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(J=>e("option",{value:J.id,children:J.name},J.id))}),s(O,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(ao,{}),s(h,{children:[t("services.totalUsage","Total"),":"," ",e(Z.span,{fontWeight:"medium",children:qe(N,2)})]})]})]})]}),s(xe,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(L,{flex:"1",children:v?s(le,{spacing:3,py:8,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):f.length&&N>0?e(Hr,{type:"donut",height:320,options:ve,series:he}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(le,{flex:"1",align:"stretch",spacing:2,children:f.length?f.map(J=>{var ke;const Se=J.username||t("services.unassignedAdmin","Unassigned"),X=Boolean(J.username),ge=B===J.username&&X;return e(G,{size:"sm",variant:ge?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{X&&J.username&&I(J.username)},isDisabled:!X,children:s(O,{justify:"space-between",w:"full",children:[e(h,{children:Se}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:qe(J.used_traffic||0,2)})]})},`${(ke=J.admin_id)!=null?ke:"na"}-${Se}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),s(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(xe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[s(O,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(at,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(ao,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(Z.span,{fontWeight:"medium",children:B!=null?B:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(Z.span,{fontWeight:"medium",children:qe(ce||0,2)})]})]}),s(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(xe,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:y.map(J=>e(G,{size:"sm",onClick:()=>{D(J.key),U(lo(J))},variant:re===J.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:J.label},J.key))}),s(xe,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[s(_n,{placement:o,isOpen:W,onClose:()=>{Q(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Dn,{children:e(G,{size:"sm",variant:"outline",leftIcon:e(Tp,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(W){Q(!1);return}te([z.start,z.end]),Q(!0)},children:de})}),s(An,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(In,{}),s(Tn,{px:3,py:3,children:[e(L,{overflowX:"auto",maxW:"full",children:e(zn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(Y=ue[0])!=null?Y:void 0,endDate:(we=ue[1])!=null?we:void 0,calendarClassName:"usage-range-datepicker",onChange:J=>{const[Se,X]=J!=null?J:[null,null];if(te([Se,X]),Se&&X){const ge=Np(Se,X);D("custom"),U(ge),Q(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(Ye,{value:B!=null?B:"",onChange:J=>I(J.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!j.length,children:j.map(J=>e("option",{value:J.username,children:J.username},J.username))})]})]})]}),e(L,{mt:6,children:me?s(le,{spacing:3,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):F.series&&F.series.length?e(Hr,{options:F.options,series:F.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};We.extend(Pn);const Lp=Z(ei,{baseStyle:{w:4,h:4}}),Ra=Z(Cn,{baseStyle:{w:4,h:4}}),Ua=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],co=t=>{const n=t.unit==="hour"?"hour":"day",r=We().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},Mp=(t,n)=>{const r=We(t),l=We(n),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},uo=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),ho=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),po=(t,n)=>{if(!t)return t;const r=We.utc(t);return r.isValid()?n==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},mo=(t,n,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>qe(Number(o)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>qe(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Op=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>qe(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Wp=({services:t,selectedServiceId:n})=>{var oe,K,fe,dt,Je,q;const{t:r}=He(),{colorMode:l}=cs(),o="auto-end",i=(oe=ur({base:"bottom",md:"auto-end"}))!=null?oe:o,a=d.exports.useMemo(()=>t.map(x=>({id:x.id,name:x.name})),[t]),c=d.exports.useMemo(()=>n||(a.length?a[0].id:null),[n,a]),u=(K=Ua.find(x=>x.key==="30d"))!=null?K:Ua[0],[p,g]=d.exports.useState(c),[f,A]=d.exports.useState(()=>co(u)),[v,b]=d.exports.useState(u.key),[y,_]=d.exports.useState([null,null]),[z,U]=d.exports.useState(!1),[re,D]=d.exports.useState([]),[B,I]=d.exports.useState("day"),[P,_e]=d.exports.useState([]),[me,se]=d.exports.useState(!1),[W,Q]=d.exports.useState(!1),[ue,te]=d.exports.useState(null),[j,N]=d.exports.useState([]),[he,Ae]=d.exports.useState("day"),[ve,M]=d.exports.useState(""),[E,F]=d.exports.useState(!1);d.exports.useEffect(()=>{g(c)},[c]),d.exports.useEffect(()=>{if(!p){D([]),_e([]),N([]),te(null),M("");return}const x={start:uo(f.start),end:ho(f.end)},R=f.unit==="hour"?"hour":"day";let ee=!1;return se(!0),Ce(`/v2/services/${p}/usage/timeseries`,{query:{...x,granularity:R}}).then(Pe=>{var Be,rt;ee||!Pe||(D((Be=Pe.points)!=null?Be:[]),I((rt=Pe.granularity)!=null?rt:R))}).catch(()=>{ee||(D([]),I(R))}).finally(()=>{ee||se(!1)}),Q(!0),Ce(`/v2/services/${p}/usage/admins`,{query:x}).then(Pe=>{var Be;ee||!Pe||_e((Be=Pe.admins)!=null?Be:[])}).catch(()=>{ee||_e([])}).finally(()=>{ee||Q(!1)}),()=>{ee=!0}},[p,f.start,f.end,f.unit]),d.exports.useEffect(()=>{if(!p){te(null),N([]),M("");return}if(!P.length){te(null);return}te(x=>{var Be,rt;const R=P.map(lt=>lt.admin_id);if(x===null){if(R.includes(null))return x}else if(R.includes(x))return x;const ee=P.find(lt=>(lt.used_traffic||0)>0);if(ee)return(Be=ee.admin_id)!=null?Be:null;const Pe=P[0];return(rt=Pe==null?void 0:Pe.admin_id)!=null?rt:null})},[P,p]),d.exports.useEffect(()=>{if(!p){N([]),M(""),Ae("day");return}if(ue===void 0)return;if(!P.length&&ue===null){N([]),M("");return}const x=f.unit==="hour"?"hour":"day",R=ue===null?"null":Number.isFinite(ue)?String(ue):"null";let ee=!1;return F(!0),Ce(`/v2/services/${p}/usage/admin-timeseries`,{query:{start:uo(f.start),end:ho(f.end),granularity:x,admin_id:R}}).then(Pe=>{var Be,rt,lt;ee||!Pe||(N((Be=Pe.points)!=null?Be:[]),Ae((rt=Pe.granularity)!=null?rt:x),M((lt=Pe.username)!=null?lt:""))}).catch(()=>{ee||(N([]),M(""),Ae(x))}).finally(()=>{ee||F(!1)}),()=>{ee=!0}},[P,f.end,f.start,f.unit,ue,p]);const ce=d.exports.useMemo(()=>{const x=We(f.start).format("YYYY-MM-DD"),R=We(f.end).format("YYYY-MM-DD");return`${x} \u2013 ${R}`},[f.start,f.end]),de=d.exports.useMemo(()=>re.map(x=>po(x.timestamp,B)),[re,B]),De=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:re.map(x=>x.used_traffic)}],[re,r]),Ee=d.exports.useMemo(()=>mo(l,de,r("services.usageYAxis","Usage")),[de,l,r]),Y=d.exports.useMemo(()=>P.map(x=>({value:x.admin_id===null?"null":String(x.admin_id),label:x.username||r("services.unassignedAdmin","Unassigned")})),[P,r]),we=d.exports.useMemo(()=>{var R,ee;const x=ue===null?"null":String(ue);return(ee=(R=Y.find(Pe=>Pe.value===x))==null?void 0:R.label)!=null?ee:ue===null?r("services.unassignedAdmin","Unassigned"):""},[Y,ue,r]),J=d.exports.useMemo(()=>j.map(x=>po(x.timestamp,he)),[j,he]),Se=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:j.map(x=>x.used_traffic)}],[j,r]),X=d.exports.useMemo(()=>mo(l,J,r("services.usageYAxis","Usage")),[J,l,r]),ge=d.exports.useMemo(()=>j.reduce((x,R)=>x+(R.used_traffic||0),0),[j]),ke=d.exports.useMemo(()=>P.map(x=>x.used_traffic),[P]),Xe=d.exports.useMemo(()=>P.map(x=>x.username||r("services.unassignedAdmin","Unassigned")),[P,r]),ie=d.exports.useMemo(()=>Op(l,Xe),[l,Xe]),ne=d.exports.useMemo(()=>P.reduce((x,R)=>x+(R.used_traffic||0),0),[P]);return a.length===0?s(le,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(L,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):s(le,{spacing:4,align:"stretch",children:[s(O,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),s(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(Ye,{value:p!=null?p:"",onChange:x=>g(Number(x.target.value)||null),minW:{md:"220px"},children:a.map(x=>e("option",{value:x.id,children:x.name},x.id))}),e(xe,{direction:{base:"column",sm:"row"},spacing:2,children:Ua.map(x=>e(G,{size:"sm",variant:v===x.key?"solid":"outline",colorScheme:"primary",onClick:()=>{b(x.key),A(co(x))},children:x.label},x.key))}),s(_n,{placement:i,isOpen:z,onClose:()=>U(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Dn,{children:e(G,{size:"sm",variant:"outline",leftIcon:e(Lp,{}),onClick:()=>{_([f.start,f.end]),U(x=>!x)},children:ce})}),s(An,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(In,{}),s(Tn,{px:3,py:3,children:[e(L,{overflowX:"auto",maxW:"full",children:e(zn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(fe=y[0])!=null?fe:void 0,endDate:(dt=y[1])!=null?dt:void 0,calendarClassName:"usage-range-datepicker",onChange:x=>{const[R,ee]=x!=null?x:[null,null];if(_([R,ee]),R&&ee){const Pe=Mp(R,ee);b("custom"),A(Pe),U(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),s(L,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(O,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),s(O,{fontSize:"sm",color:"gray.500",children:[e(Ra,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(Z.span,{fontWeight:"medium",children:qe(re.reduce((x,R)=>x+(R.used_traffic||0),0),2)})]})]})]}),e(L,{mt:4,children:me?s(le,{spacing:3,py:10,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):re.length?e(Hr,{type:"area",height:360,options:Ee,series:De}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(L,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(xe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(at,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(Ra,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(Z.span,{fontWeight:"medium",children:we||ve||"-"})," ",r("services.totalUsage","Total"),":"," ",e(Z.span,{fontWeight:"medium",children:qe(ge||0,2)})]})]}),e(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(Ye,{size:"sm",minW:{md:"200px"},value:ue===null?"null":String(ue),onChange:x=>{const R=x.target.value;if(R==="null"){te(null);return}const ee=Number(R);te(Number.isNaN(ee)?null:ee)},isDisabled:Y.length===0,children:Y.map(x=>e("option",{value:x.value,children:x.label},x.value))})})]}),e(L,{mt:4,children:E?s(le,{spacing:3,py:10,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(q=(Je=Se[0])==null?void 0:Je.data)!=null&&q.length?e(Hr,{type:"area",height:360,options:X,series:Se}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(L,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(O,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),s(O,{fontSize:"sm",color:"gray.500",children:[e(Ra,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(Z.span,{fontWeight:"medium",children:qe(ne,2)})]})]})]}),s(xe,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(L,{flex:"1",children:W?s(le,{spacing:3,py:8,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):P.length&&ne>0?e(Hr,{type:"donut",height:320,options:ie,series:ke}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(le,{flex:"1",align:"stretch",spacing:2,children:P.length?P.map(x=>{var R;return s(O,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:x.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:qe(x.used_traffic||0,2)})]},`${(R=x.admin_id)!=null?R:"na"}-${x.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};We.extend(Pn);const Fp=Z(ei,{baseStyle:{w:4,h:4}}),Jn=Z(Cn,{baseStyle:{w:4,h:4}}),dn={key:"30d",label:"30d",amount:30,unit:"day"},go=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,l=We.utc(r);return l.isValid()?n?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},un=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss"),hn=t=>We(t).utc().format("YYYY-MM-DDTHH:mm:ss"),as=t=>{const n=t.unit==="hour"?"hour":"day",r=We().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},qn=(t,n)=>{const r=We(t),l=We(n),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},fo=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>qe(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>qe(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Yn=({presets:t,range:n,onPresetChange:r,onCustomChange:l})=>{var b,y,_;const{t:o}=He(),i="auto-end",a=(b=ur({base:"bottom",md:"auto-end"}))!=null?b:i,c=We(n.start).format("YYYY-MM-DD"),u=We(n.end).format("YYYY-MM-DD"),p=c===u?c:`${c} - ${u}`,[g,f]=d.exports.useState(!1),[A,v]=d.exports.useState([n.start,n.end]);return d.exports.useEffect(()=>{g||v([n.start,n.end])},[g,n.start,n.end]),s(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(xe,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(z=>e(G,{size:"sm",onClick:()=>r(z.key),colorScheme:"primary",variant:n.key===z.key?"solid":"outline",w:{base:"full",sm:"auto"},children:z.label},z.key))}),s(_n,{placement:a,isOpen:g,onClose:()=>{f(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Dn,{children:e(G,{size:"sm",variant:"outline",leftIcon:e(Fp,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(g){f(!1);return}v([n.start,n.end]),f(!0)},children:p})}),s(An,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(In,{}),s(Tn,{px:3,py:3,children:[e(L,{overflowX:"auto",maxW:"full",children:e(zn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(y=A[0])!=null?y:void 0,endDate:(_=A[1])!=null?_:void 0,calendarClassName:"usage-range-datepicker",onChange:z=>{const[U,re]=z!=null?z:[null,null];v([U,re]),U&&re&&(l(U,re),f(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},Hp=()=>{var Gt,er,Wt,Ge,ut,tr,Et,rr;const{t}=He(),n=Ut(),{colorMode:r}=cs(),{data:l}=ri(),{fetchNodesUsage:o}=Rn(),{userData:i}=vs(),a=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(er=(Gt=a.find($=>$.key==="30d"))!=null?Gt:a[0])!=null?er:dn,[u,p]=d.exports.useState(()=>as(c)),[g,f]=d.exports.useState([]),[A,v]=d.exports.useState(!1),[b,y]=d.exports.useState(()=>as(c)),[_,z]=d.exports.useState(null),[U,re]=d.exports.useState(!1),[D,B]=d.exports.useState([]),[I,P]=d.exports.useState(null),[_e,me]=d.exports.useState(()=>as(c)),[se,W]=d.exports.useState(()=>as(c)),[Q,ue]=d.exports.useState([]),[te,j]=d.exports.useState(null),[N,he]=d.exports.useState(null),[Ae,ve]=d.exports.useState([]),[M,E]=d.exports.useState([]),[F,ce]=d.exports.useState(!1),[de,De]=d.exports.useState(null),[Ee,Y]=d.exports.useState(!1),[we,J]=d.exports.useState([]),[Se,X]=d.exports.useState(null),ge=d.exports.useCallback($=>$?(Array.isArray($)?$:Object.values($)).map(T=>{var Te,Fe,Re,et;return{nodeId:Number((Te=T==null?void 0:T.node_id)!=null?Te:0),nodeName:(Fe=T==null?void 0:T.node_name)!=null?Fe:t("nodes.unknownNode","Unknown"),total:Number((Re=T==null?void 0:T.uplink)!=null?Re:0)+Number((et=T==null?void 0:T.downlink)!=null?et:0)}}):[],[t]),ke=d.exports.useCallback($=>{var T;const k=(T=a.find(Te=>Te.key===$))!=null?T:dn;p(as(k))},[a]),Xe=d.exports.useCallback(($,k)=>{const T=qn($,k);p(T)},[]),ie=d.exports.useCallback($=>{var T;const k=(T=a.find(Te=>Te.key===$))!=null?T:dn;y(as(k))},[a]),ne=d.exports.useCallback(($,k)=>{const T=qn($,k);y(T)},[]),oe=d.exports.useCallback($=>{var T;const k=(T=a.find(Te=>Te.key===$))!=null?T:dn;W(as(k))},[a]),K=d.exports.useCallback(($,k)=>{const T=qn($,k);W(T)},[]),fe=d.exports.useCallback($=>{var T;const k=(T=a.find(Te=>Te.key===$))!=null?T:dn;me(as(k))},[a]),dt=d.exports.useCallback(($,k)=>{const T=qn($,k);me(T)},[]),Je=d.exports.useMemo(()=>g.reduce(($,k)=>$+k.total,0),[g]),q=d.exports.useMemo(()=>{const $=g.map(T=>T.total),k=g.map(T=>T.nodeName);return ca(r,`${t("userDialog.total")} ${qe(Je||0,2)}`,$,k)},[r,g,t,Je]),x=d.exports.useMemo(()=>D.map($=>go($.date)),[D]),R=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:D.map($=>$.used_traffic)}],[D,t]),ee=d.exports.useMemo(()=>D.reduce(($,k)=>$+k.used_traffic,0),[D]),Pe=d.exports.useMemo(()=>({options:fo(r,x),series:R}),[r,x,R]),Be=d.exports.useMemo(()=>M.reduce(($,k)=>$+k.total,0),[M]),rt=d.exports.useMemo(()=>{const $=M.map(T=>T.total),k=M.map(T=>T.nodeName);return ca(r,`${t("userDialog.total")} ${qe(Be||0,2)}`,$,k)},[M,r,t,Be]),lt=d.exports.useMemo(()=>we.map($=>go($.date)),[we]),At=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:we.map($=>$.used_traffic)}],[we,t]),Ze=d.exports.useMemo(()=>we.reduce(($,k)=>$+k.used_traffic,0),[we]),Oe=d.exports.useMemo(()=>({options:fo(r,lt),series:At}),[r,lt,At]),kt=d.exports.useMemo(()=>{const $=[],k=new Set;return g.forEach(T=>{T.nodeId>0&&!k.has(T.nodeId)&&(k.add(T.nodeId),$.push({value:T.nodeId,label:T.nodeName}))}),Array.isArray(l)&&l.forEach(T=>{(T==null?void 0:T.id)&&!k.has(T.id)&&(k.add(T.id),$.push({value:T.id,label:T.name}))}),$.sort((T,Te)=>T.label.localeCompare(Te.label))},[g,l]),zt=d.exports.useMemo(()=>{const $=[],k=new Set;return Ae.forEach(T=>{k.has(T.nodeId)||(k.add(T.nodeId),$.push({value:T.nodeId,label:T.nodeName}))}),k.has(0)||$.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(T=>{(T==null?void 0:T.id)&&!k.has(T.id)&&(k.add(T.id),$.push({value:T.id,label:T.name}))}),$.sort((T,Te)=>T.label.localeCompare(Te.label))},[Ae,l,t]),Kt=d.exports.useMemo(()=>Q.map($=>({value:$,label:$})),[Q]),or=d.exports.useMemo(()=>{const $=new Map;return Array.isArray(l)&&l.forEach(k=>{(k==null?void 0:k.id)!=null&&$.set(k.id,k.name)}),$},[l]);return d.exports.useEffect(()=>{let $=!1;return v(!0),o({start:un(u.start),end:hn(u.end)}).then(k=>{if($)return;const T=ge(k==null?void 0:k.usages);f(T)}).catch(k=>{$||(console.error("Error fetching usage data:",k),f([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{$||v(!1)}),()=>{$=!0}},[o,u,ge,n,t]),d.exports.useEffect(()=>{!(i!=null&&i.username)||(j($=>$!=null?$:i.username),he($=>$!=null?$:i.username),i.is_sudo||ue([i.username]))},[i]),d.exports.useEffect(()=>{if(!(i!=null&&i.is_sudo))return;let $=!1;return Ce("/admins").then(k=>{if($)return;const Te=(Array.isArray(k)?k:Array.isArray(k==null?void 0:k.admins)?k.admins:[]).map(Re=>Re==null?void 0:Re.username).filter(Re=>typeof Re=="string"),Fe=Array.from(new Set(Te)).sort((Re,et)=>Re.localeCompare(et));if(!Fe.length&&(i==null?void 0:i.username)){ue([i.username]);return}ue(Fe),j(Re=>{var et,ft;return Re&&Fe.includes(Re)?Re:(ft=(et=Fe[0])!=null?et:Re)!=null?ft:null}),he(Re=>{var et,ft;return Re&&Fe.includes(Re)?Re:(ft=(et=Fe[0])!=null?et:Re)!=null?ft:null})}).catch(k=>{console.error("Error fetching admins:",k)}),()=>{$=!0}},[i==null?void 0:i.is_sudo,i==null?void 0:i.username]),d.exports.useEffect(()=>{var k,T;if(_!==null)return;const $=(k=g.filter(Te=>Te.nodeId>0).sort((Te,Fe)=>Fe.total-Te.total)[0])==null?void 0:k.nodeId;if($&&$>0){z($);return}if(Array.isArray(l)&&l.length){const Te=(T=l[0])==null?void 0:T.id;Te&&z(Te)}},[_,g,l]),d.exports.useEffect(()=>{De(null)},[te]),d.exports.useEffect(()=>{if(!te){ve([]),De(null);return}let $=!1;const k={start:un(se.start),end:hn(se.end)};return Ce(`/admin/${encodeURIComponent(te)}/usage/nodes`,{query:k}).then(T=>{if($)return;const Te=ge(T==null?void 0:T.usages);ve(Te),De(Fe=>{var et,ft,Pt;if(Fe!==null)return Fe;const Re=(et=Te.filter(it=>it.nodeId!==0).sort((it,Nt)=>Nt.total-it.total)[0])==null?void 0:et.nodeId;return typeof Re=="number"?Re:(Pt=(ft=Te[0])==null?void 0:ft.nodeId)!=null?Pt:0})}).catch(T=>{$||(console.error("Error fetching daily admin nodes:",T),ve([]),De(null),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{$=!0}},[te,se,ge,n,t]),d.exports.useEffect(()=>{if(!N){E([]),ce(!1);return}let $=!1;return ce(!0),Ce(`/admin/${encodeURIComponent(N)}/usage/nodes`,{query:{start:un(_e.start),end:hn(_e.end)}}).then(k=>{if($)return;const T=ge(k==null?void 0:k.usages);E(T)}).catch(k=>{$||(console.error("Error fetching admin totals nodes:",k),E([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{$||ce(!1)}),()=>{$=!0}},[N,_e,ge,n,t]),d.exports.useEffect(()=>{if(_===null){B([]),P(null);return}let $=!1;re(!0);const k={start:un(b.start),end:hn(b.end)};return b.unit==="hour"&&(k.granularity="hour"),Ce(`/node/${_}/usage/daily`,{query:k}).then(T=>{var et,ft,Pt;if($)return;const Fe=(Array.isArray(T==null?void 0:T.usages)?T.usages:[]).map(it=>{var Nt,Lt;return{date:(Nt=it==null?void 0:it.date)!=null?Nt:"",used_traffic:Number((Lt=it==null?void 0:it.used_traffic)!=null?Lt:0)}});B(Fe);const Re=(ft=(et=T==null?void 0:T.node_name)!=null?et:or.get(_))!=null?ft:t("nodes.unknownNode","Unknown");P({nodeName:Re,nodeId:(Pt=T==null?void 0:T.node_id)!=null?Pt:_})}).catch(T=>{$||(console.error("Error fetching node daily usage:",T),B([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{$||re(!1)}),()=>{$=!0}},[_,b,or,n,t]),d.exports.useEffect(()=>{if(!te){J([]),X(null);return}if(de===null){J([]),X(null);return}let $=!1;Y(!0);const k={start:un(se.start),end:hn(se.end)};return de!=null&&(k.node_id=de),se.unit==="hour"&&(k.granularity="hour"),Ce(`/admin/${encodeURIComponent(te)}/usage/chart`,{query:k}).then(T=>{var Re,et,ft,Pt;if($)return;const Fe=(Array.isArray(T==null?void 0:T.usages)?T.usages:[]).map(it=>{var Nt,Lt;return{date:(Nt=it==null?void 0:it.date)!=null?Nt:"",used_traffic:Number((Lt=it==null?void 0:it.used_traffic)!=null?Lt:0)}});J(Fe),X({nodeName:(ft=(et=T==null?void 0:T.node_name)!=null?et:(Re=zt.find(it=>it.value===de))==null?void 0:Re.label)!=null?ft:null,nodeId:(Pt=T==null?void 0:T.node_id)!=null?Pt:de})}).catch(T=>{$||(console.error("Error fetching admin usage chart:",T),J([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{$||Y(!1)}),()=>{$=!0}},[te,de,se,zt,t,n]),s(le,{spacing:6,align:"stretch",children:[s(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(xe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(at,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:qe(Je||0,2)})]})]}),e(Yn,{presets:a,range:u,onPresetChange:ke,onCustomChange:Xe})]}),e(L,{mt:6,children:A?s(le,{spacing:3,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):q.series.length?e(Hr,{options:q.options,series:q.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(xe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(at,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(Z.span,{fontWeight:"medium",children:(Wt=I==null?void 0:I.nodeName)!=null?Wt:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:qe(ee||0,2)})]})]}),s(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ye,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:_!=null?_:"",onChange:$=>{const k=$.target.value;if(!k){z(null);return}const T=Number(k);z(Number.isFinite(T)&&T>0?T:null)},placeholder:t("nodes.selectNode","Select node"),children:kt.map($=>e("option",{value:$.value,children:$.label},$.value))}),e(Yn,{presets:a,range:b,onPresetChange:ie,onCustomChange:ne})]})]}),e(L,{mt:6,children:U?s(le,{spacing:3,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(ut=(Ge=R[0])==null?void 0:Ge.data)!=null&&ut.length?e(Hr,{options:Pe.options,series:Pe.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(xe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(at,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(Z.span,{fontWeight:"medium",children:te!=null?te:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(Z.span,{fontWeight:"medium",children:(tr=Se==null?void 0:Se.nodeName)!=null?tr:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:qe(Ze||0,2)})]})]}),s(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ye,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:te!=null?te:"",onChange:$=>j($.target.value||null),isDisabled:Kt.length===0,children:Kt.map($=>e("option",{value:$.value,children:$.label},$.value))}),e(Ye,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:de!=null?de:"",onChange:$=>{const k=$.target.value;if(k===""){De(null);return}const T=Number(k);De(Number.isNaN(T)?null:T)},placeholder:t("nodes.selectNode","Select node"),children:zt.map($=>e("option",{value:$.value,children:$.label},$.value))}),e(Yn,{presets:a,range:se,onPresetChange:oe,onCustomChange:K})]})]}),e(L,{mt:6,children:Ee?s(le,{spacing:3,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(rr=(Et=At[0])==null?void 0:Et.data)!=null&&rr.length?e(Hr,{options:Oe.options,series:Oe.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(L,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(xe,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[s(le,{align:"start",spacing:1,children:[e(at,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:s(O,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(Jn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(Z.span,{fontWeight:"medium",children:N!=null?N:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(Z.span,{fontWeight:"medium",children:qe(Be||0,2)})]})]}),s(xe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ye,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:N!=null?N:"",onChange:$=>he($.target.value||null),isDisabled:Kt.length===0,children:Kt.map($=>e("option",{value:$.value,children:$.label},$.value))}),e(Yn,{presets:a,range:_e,onPresetChange:fe,onCustomChange:dt})]})]}),e(L,{mt:6,children:F?s(le,{spacing:3,children:[e(xt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):rt.series.length?e(Hr,{options:rt.options,series:rt.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},Bp=()=>{const{t}=He(),{userData:n,getUserIsSuccess:r}=vs(),l=r&&n.is_sudo,o=Os(a=>a.services),i=Os(a=>a.fetchServices);return d.exports.useEffect(()=>{l&&i({limit:500})},[i,l]),r?l?s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),s(Js,{variant:"enclosed",colorScheme:"primary",children:[s(qs,{children:[e(Bt,{children:t("usage.tabs.services","Services")}),e(Bt,{children:t("usage.tabs.admins","Admins")}),e(Bt,{children:t("usage.tabs.nodes","Nodes")})]}),s(Ys,{children:[e(Vt,{px:0,children:e(Wp,{services:o})}),e(Vt,{px:0,children:e(Up,{})}),e(Vt,{px:0,children:e(Hp,{})})]})]})]}):s(le,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(St,{justify:"center",align:"center",py:10,children:e(xt,{})})},Vp=async()=>Ce("/settings/telegram"),$p=async t=>Ce("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),fl="__dot__",Ja=t=>t.replace(/\./g,fl),Rs=t=>t.replace(new RegExp(fl,"g"),"."),Kp=t=>{const n={},r=(l,o)=>{if(o!==void 0){if(typeof o=="boolean"){n[Rs(l)]=o;return}if(typeof o=="string"){if(o==="")return;o==="true"||o==="false"?n[Rs(l)]=o==="true":n[Rs(l)]=Boolean(o);return}if(typeof o=="number"){n[Rs(l)]=o!==0;return}if(Array.isArray(o)){n[Rs(l)]=o.length>0;return}if(o&&typeof o=="object"){Object.entries(o).forEach(([i,a])=>{const c=l?`${l}.${i}`:i;r(c,a)});return}n[Rs(l)]=Boolean(o)}};return Object.entries(t).forEach(([l,o])=>{r(l,o)}),n},bl=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],Jp=bl.flatMap(t=>t.events.map(n=>n.key)),qp=Z($r,{baseStyle:{w:4,h:4}}),Yp=Z(Wc,{baseStyle:{w:4,h:4}}),La=t=>{var l,o,i;const n={};Object.entries(t.forum_topics||{}).forEach(([a,c])=>{var u;n[a]={title:(u=c.title)!=null?u:"",topic_id:c.topic_id!=null?String(c.topic_id):""}});const r={};return Jp.forEach(a=>{var p;const c=Ja(a),u=(p=t.event_toggles)==null?void 0:p[a];r[c]=u===void 0?!0:Boolean(u)}),Object.entries(t.event_toggles||{}).forEach(([a,c])=>{const u=Ja(a);u in r||(r[u]=Boolean(c))}),{api_token:(l=t.api_token)!=null?l:"",proxy_url:(o=t.proxy_url)!=null?o:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(i=t.default_vless_flow)!=null?i:"",forum_topics:n,event_toggles:r}},Gp=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(n=>n.length>0).map(n=>Number(n)).filter(n=>Number.isFinite(n)),Xp=()=>{const{t}=He(),n=Ut(),r=ja(),{data:l,isLoading:o,refetch:i}=es("telegram-settings",Vp,{refetchOnWindowFocus:!1}),{register:a,control:c,handleSubmit:u,reset:p,watch:g,formState:{isDirty:f}}=_r({defaultValues:La(l!=null?l:{api_token:null,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{l&&p(La(l))},[l,p]);const A=Lr($p,{onSuccess:y=>{p(La(y)),r.setQueryData("telegram-settings",y),n({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{n({title:t("errors.generic","Something went wrong"),status:"error"})}}),v=y=>{const _=Kp(y.event_toggles||{}),z={api_token:y.api_token.trim()||null,proxy_url:y.proxy_url.trim()||null,admin_chat_ids:Gp(y.admin_chat_ids),logs_chat_id:y.logs_chat_id.trim()?Number(y.logs_chat_id.trim()):null,logs_chat_is_forum:y.logs_chat_is_forum,default_vless_flow:y.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(y.forum_topics||{}).map(([U,re])=>[U,{title:re.title,topic_id:re.topic_id.trim()?Number(re.topic_id.trim()):void 0}])),event_toggles:_};A.mutate(z)},b=g("forum_topics");return s(L,{px:{base:4,md:8},py:{base:6,md:8},children:[e(ya,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),s(Js,{colorScheme:"primary",children:[s(qs,{children:[e(Bt,{children:t("settings.telegram","Telegram")}),e(Bt,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),s(Ys,{children:[e(Vt,{px:{base:0,md:2},children:o&&!l?e(St,{align:"center",justify:"center",py:12,children:e(xt,{size:"lg"})}):e("form",{onSubmit:u(v),children:s(le,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),s(Ve,{columns:{base:1,md:2},spacing:6,children:[s(w,{children:[e(C,{children:t("settings.telegram.apiToken","Bot API Token")}),e(be,{placeholder:"123456:ABC",...a("api_token")})]}),s(w,{children:[e(C,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(be,{placeholder:"socks5://user:pass@host:port",...a("proxy_url")})]}),s(w,{children:[e(C,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(be,{placeholder:"12345, 67890",...a("admin_chat_ids")}),e(Cr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),s(w,{children:[e(C,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(be,{placeholder:"-100123456789",...a("logs_chat_id")}),e(Cr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),s(w,{display:"flex",alignItems:"center",children:[e(C,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(st,{control:c,name:"logs_chat_is_forum",render:({field:y})=>e(ot,{id:"logs_chat_is_forum",isChecked:y.value,onChange:y.onChange})})]}),s(w,{children:[e(C,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(be,{placeholder:"xtls-rprx-vision",...a("default_vless_flow")})]})]}),s(L,{children:[e(ya,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),b&&Object.keys(b).length>0?e(xe,{spacing:4,children:Object.entries(b).map(([y])=>s(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",y]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(w,{children:[e(C,{children:t("settings.telegram.topicTitle","Topic Title")}),e(be,{...a(`forum_topics.${y}.title`)})]}),s(w,{children:[e(C,{children:t("settings.telegram.topicId","Topic ID")}),e(be,{type:"number",...a(`forum_topics.${y}.topic_id`)}),e(Cr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},y))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]}),s(L,{children:[e(ya,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(xe,{spacing:4,children:bl.map(y=>s(L,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(y.titleKey,y.defaultTitle)}),e(Ve,{columns:{base:1,md:2},spacing:4,children:y.events.map(_=>s(w,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[s(L,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(_.labelKey,_.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(_.hintKey,_.defaultHint)})]}),e(st,{control:c,name:`event_toggles.${Ja(_.key)}`,render:({field:z})=>e(ot,{isChecked:Boolean(z.value),onChange:U=>z.onChange(U.target.checked)})})]},_.key))})]},y.key))})]}),s(St,{gap:3,justify:"flex-end",children:[e(G,{variant:"outline",leftIcon:e(qp,{}),onClick:()=>i(),isDisabled:A.isLoading,children:t("actions.refresh","Refresh")}),e(G,{colorScheme:"primary",leftIcon:e(Yp,{}),type:"submit",isLoading:A.isLoading,isDisabled:!f&&!A.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(Vt,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},Qp=async()=>{try{const t=la();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const n=await Ce("/admin",{headers:{Authorization:`Bearer ${t}`}});if(n&&typeof n=="object"&&"error"in n)throw new Error(`API error: ${n.error||"Unknown error"}`);return n}catch(t){throw console.error("Loader error:",t),t}},Zp=Fc([{path:"/",element:e(Md,{}),errorElement:e(wi,{}),loader:Qp,children:[{index:!0,element:e($d,{})},{path:"users",element:e(Lu,{})},{path:"admins",element:e(Hu,{})},{path:"usage",element:e(Bp,{})},{path:"services",element:e(Ip,{})},{path:"hosts",element:e(Dh,{})},{path:"node-settings",element:e(Kh,{})},{path:"integrations",element:e(Xp,{})},{path:"xray-settings",element:e(Dp,{})},{path:"xray-logs",element:e(ml,{})}]},{path:"/login/",element:e(wi,{})}]);function jp(){return e(Hc,{router:Zp})}We.extend(Bc);We.extend(Vc);We.extend(Pn);We.extend($c);We.extend(Kc);jn(Jc.get()||"light");qc.createRoot(document.getElementById("root")).render(e(Ma.StrictMode,{children:e(Yc,{theme:Xc,children:e(Gc,{client:Zn,children:e(jp,{})})})}));
