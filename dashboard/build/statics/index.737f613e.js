var gl=Object.defineProperty;var fl=(t,n,r)=>n in t?gl(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var V=(t,n,r)=>(fl(t,typeof n!="symbol"?n+"":n,r),r);import{i as Yn,B as bl,a as yl,b as Sl,j as mo,d as Fe,U as Ja,z as xl,r as kl,f as wl,Q as vl,e as Cl,m as wt,$ as _l,c as j,X as qa,R as La,N as qr,I as Se,g as Yr,h as s,F as k,k as e,l as C,n as mr,o as Dl,p as ca,q as Mt,s as Al,t as Il,u as Tl,v as Pl,w as wr,x as Br,L as El,C as da,y as He,A as Qe,M as ta,D as ra,E as ze,G as sa,H as Zt,J as E,K as Nl,T as h,S as zl,P as Rl,O as Ma,V as Ur,W as Ua,Y as go,Z as fo,_ as Ll,a0 as Ut,a1 as os,a2 as Yt,a3 as d,a4 as ci,a5 as z,a6 as na,a7 as Nt,a8 as dt,a9 as zt,aa as ht,ab as Pt,ac as ut,ad as oe,ae as Ve,af as Ce,ag as kr,ah as X,ai as At,aj as dr,ak as Ee,al as Ml,am as fn,an as Ya,ao as Ul,ap as Ga,aq as vr,ar as Mr,as as $r,at as ur,au as hr,av as as,aw as ua,ax as Gr,ay as Ol,az as bo,aA as Wl,aB as Fl,aC as Hl,aD as Bl,aE as ha,aF as yo,aG as So,aH as bn,aI as di,aJ as Vl,aK as Kl,aL as xo,aM as or,aN as Tt,aO as $l,aP as Jl,aQ as ko,aR as wo,aS as Ks,aT as ql,aU as Yl,aV as pa,aW as kt,aX as vo,aY as Or,aZ as Xr,a_ as Gl,a$ as Xa,b0 as hs,b1 as Co,b2 as Xl,b3 as Ql,b4 as qe,b5 as _o,b6 as Zl,b7 as jl,b8 as Do,b9 as ec,ba as Ao,bb as tc,bc as rc,bd as sc,be as Io,bf as nc,bg as ac,bh as ic,bi as mn,bj as ui,bk as $s,bl as Js,bm as Bt,bn as qs,bo as Vt,bp as oc,bq as lc,br as is,bs as cc,bt as qt,bu as dc,bv as lt,bw as at,bx as ft,by as Lr,bz as Wr,bA as To,bB as Po,bC as Eo,bD as ms,bE as zr,bF as Dt,bG as Me,bH as Ir,bI as Re,bJ as No,bK as zo,bL as Ro,bM as hi,bN as Vr,bO as uc,bP as hc,bQ as pc,bR as mc,bS as gc,bT as fc,bU as yn,bV as Sn,bW as vn,bX as Lo,bY as tt,bZ as bc,b_ as Ms,b$ as pr,c0 as Cn,c1 as _n,c2 as yc,c3 as Dn,c4 as An,c5 as Mo,c6 as In,c7 as Qa,c8 as Sc,c9 as Gn,ca as xc,cb as Uo,cc as Za,cd as Er,ce as Oo,cf as aa,cg as Nr,ch as Tn,ci as Us,cj as kc,ck as wc,cl as vc,cm as Cc,cn as Xn,co as gn,cp as Wo,cq as Fo,cr as _c,cs as Dc,ct as Ac,cu as Ic,cv as Tc,cw as Pc,cx as Ec,cy as Nc,cz as zc,cA as pi,cB as Rc,cC as Lc,cD as Mc,cE as ja,cF as Uc,cG as ba,cH as Oc,cI as Wc,cJ as Fc,cK as Hc,cL as Bc,cM as Vc,cN as Kc,cO as $c,cP as Jc,cQ as qc}from"./vendor.ace13279.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();Yn.use(bl).use(yl).use(Sl).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:mo(["/","statics/locales/{{lng}}.json"])}},function(t,n){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",Yn.language),Fe.locale(Yn.language)});Yn.on("languageChanged",t=>{console.log("Language changed to:",t),Fe.locale(t)});Ja("zh-cn",xl);Ja("ru",kl);Ja("fa",wl);const Qn=new vl,Zn=(t,n)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:n||"#f6f8ff"},o=n||l[t]||l.default;r==null||r.setAttribute("content",o)},Yc=Cl({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:wt("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:wt("surface.light","surface.dark")(t),borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:wt("lg","dark-lg")(t)},item:{_hover:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:wt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:wt("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:wt("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:wt("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:wt("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:wt("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:wt("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const ia=()=>localStorage.getItem("token"),Gc=t=>{localStorage.setItem("token",t)},Xc=()=>{localStorage.removeItem("token")},Qc=_l.create({baseURL:"https://bot.mazholl.com:8585/api"}),Zc=(t,n={})=>(ia()&&(n.headers={...(n==null?void 0:n.headers)||{},Authorization:`Bearer ${ia()}`}),Qc(t,n)),De=Zc,jc=j(qa,{baseStyle:{w:4,h:4}}),sr=La.forwardRef(({disabled:t,step:n,label:r,className:l,startAdornment:o,endAdornment:a,type:i="text",placeholder:c,onChange:u,onBlur:p,name:g,value:f,onClick:v,error:x,clearable:S=!1,...b},w)=>{const P=()=>{u&&u({target:{value:"",name:g}})},{size:L="md"}=b,te=i=="number"?qr:Se,_=i=="number"?Yr:La.Fragment,U=i=="number"?{keepWithinRange:!0,precision:5,format:D=>isNaN(parseFloat(String(D)))||Number(parseFloat(String(D)).toFixed(5))===0?D:Number(parseFloat(String(D)).toFixed(5)),min:0,step:n,name:g,type:i,placeholder:c,onChange:D=>{u&&u(D)},onBlur:p,value:f,onClick:v,disabled:t,flexGrow:1,size:L}:{};return s(k,{isInvalid:!!x,children:[r&&e(C,{children:r}),s(mr,{size:L,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[o&&e(Dl,{children:o}),s(_,{...U,children:[e(te,{name:g,ref:w,step:n,className:ca(l),type:i,placeholder:c,onChange:u,onBlur:p,value:f,onClick:v,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...b,roundedLeft:o?"0":"md",roundedRight:a?"0":"md"}),i=="number"&&e(Mt,{children:s(Al,{children:[e(Il,{}),e(Tl,{})]})})]}),a&&e(Pl,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:a}),S&&f&&f.length&&e(wr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:P,cursor:"pointer",children:e(jc,{})})]}),!!x&&e(Br,{children:x})]})}),ed="/statics/logo.e8dba2f4.svg",td=j(El,{baseStyle:{w:4,h:4}}),rd=j(da,{baseStyle:{w:4,h:4}}),Ho=({actions:t})=>{const{i18n:n}=He(),r=Qe("surface.light","surface.dark"),l=Qe("blackAlpha.50","whiteAlpha.100"),o=Qe("blackAlpha.200","whiteAlpha.200"),a=Qe("gray.800","gray.100"),i=u=>{n.changeLanguage(u)};return s(ta,{placement:"bottom-end",children:[e(ra,{as:ze,size:"sm",variant:"outline",icon:e(td,{}),position:"relative"}),e(sa,{minW:"160px",zIndex:9999,bg:r,borderColor:o,color:a,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:p,flag:g})=>e(Zt,{fontSize:"sm",onClick:()=>i(u),_hover:{bg:l},children:s(E,{justify:"space-between",w:"full",children:[s(E,{spacing:2,children:[e(Nl,{countryCode:g,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:p})]}),n.language===u&&e(rd,{})]})},u))})]})},mi="rb-theme",gi="rb-custom-themes",sd=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],fi=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],bi=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],ar={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},ir={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},ya=.14,Sa=.22,yi=j(da,{baseStyle:{w:4,h:4}}),nd=j(zl,{baseStyle:{w:4,h:4}}),ad=j(Rl,{baseStyle:{w:4,h:4}}),id=j(Ma,{baseStyle:{w:4,h:4}}),od=j(Ur,{baseStyle:{w:4,h:4}}),Si=j(Ua,{baseStyle:{w:4,h:4}}),ld=j(go,{baseStyle:{w:4,h:4}}),cd=j(fo,{baseStyle:{w:4,h:4}}),dd=j(Ll,{baseStyle:{w:4,h:4}}),Bo=(t,n=0,r=1)=>Math.min(r,Math.max(n,t)),Oa=t=>{const n=t.replace("#",""),r=parseInt(n,16);if(n.length===3){const l=r>>8&15,o=r>>4&15,a=r&15;return{r:l<<4|l,g:o<<4|o,b:a<<4|a}}return{r:r>>16&255,g:r>>8&255,b:r&255}},Vo=(t,n,r)=>{const l=o=>o.toString(16).padStart(2,"0");return`#${l(t)}${l(n)}${l(r)}`},ud=(t,n,r)=>{t/=255,n/=255,r/=255;const l=Math.max(t,n,r),o=Math.min(t,n,r);let a=0,i=0;const c=(l+o)/2;if(l!==o){const u=l-o;switch(i=c>.5?u/(2-l-o):u/(l+o),l){case t:a=(n-r)/u+(n<r?6:0);break;case n:a=(r-t)/u+2;break;default:a=(t-n)/u+4}a/=6}return{h:a,s:i,l:c}},hd=(t,n,r)=>{let l,o,a;if(n===0)l=o=a=r;else{const i=(p,g,f)=>(f<0&&(f+=1),f>1&&(f-=1),f<.16666666666666666?p+(g-p)*6*f:f<.5?g:f<.6666666666666666?p+(g-p)*(.6666666666666666-f)*6:p),c=r<.5?r*(1+n):r+n-r*n,u=2*r-c;l=i(u,c,t+1/3),o=i(u,c,t),a=i(u,c,t-1/3)}return{r:Math.round(l*255),g:Math.round(o*255),b:Math.round(a*255)}},xa=t=>{try{const{r:n,g:r,b:l}=Oa(t),{h:o,s:a,l:i}=ud(n,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[p,g])=>{const{r:f,g:v,b:x}=hd(o,a,Bo(i+g));return u[`--primary-${p}`]=Vo(f,v,x),u},{})}catch{return{}}},pd=(t,n,r)=>{const l=Bo(r,0,1),o=Oa(t),a=Oa(n),i=(c,u)=>Math.round(c*(1-l)+u*l);return Vo(i(o.r,a.r),i(o.g,a.g),i(o.b,a.b))},As=(t,n,r,l)=>{try{return pd(t,n,r)}catch{return l}},md=()=>{const t=document.documentElement;sd.forEach(n=>t.style.removeProperty(n)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},gd=(t,n)=>{const r=document.documentElement;Object.entries(t).forEach(([l,o])=>r.style.setProperty(l,o)),r.style.setProperty("--bg-light",n.bgLight),r.style.setProperty("--bg-dark",n.bgDark),r.style.setProperty("--surface-light",n.surfaceLight),r.style.setProperty("--surface-dark",n.surfaceDark)},ka=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},xi=()=>({name:"",light:{...ar},dark:{...ir}}),Ft=(t,n)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:n,Ko=({minimal:t=!1})=>{const{t:n}=He(),r=Ut(),{colorMode:l,toggleColorMode:o}=os(),a=Yt(),i=Yt(),c=Qe("surface.light","surface.dark"),u=Qe("blackAlpha.50","whiteAlpha.100"),p=Qe("blackAlpha.200","whiteAlpha.200"),g=Qe("gray.800","gray.100"),f=Qe("gray.600","gray.300"),v=Qe("blackAlpha.400","blackAlpha.700"),x=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:f}}),[f]),[S,b]=d.exports.useState(()=>{try{return localStorage.getItem(mi)||"default"}catch{return"default"}}),[w,P]=d.exports.useState(()=>{try{const T=localStorage.getItem(gi);if(!T)return[];const R=JSON.parse(T);return Array.isArray(R)?R.map(de=>{var pe,O,fe,K,Z,ee;const q=Ft(((pe=de.light)==null?void 0:pe.primary)||ar.primary,ar.primary),be=Ft(((O=de.light)==null?void 0:O.bg)||ar.bg,ar.bg),Pe=As(be,q,ya,ar.surface),Ie=Ft(((fe=de.light)==null?void 0:fe.surface)||Pe,Pe),Oe=Ft(((K=de.dark)==null?void 0:K.primary)||ir.primary,ir.primary),Q=Ft(((Z=de.dark)==null?void 0:Z.bg)||ir.bg,ir.bg),xe=As(Q,Oe,Sa,ir.surface),Y=Ft(((ee=de.dark)==null?void 0:ee.surface)||xe,xe);return{id:de.id||ka(),name:de.name||"Custom",light:{primary:q,bg:be,surface:Ie},dark:{primary:Oe,bg:Q,surface:Y}}}):[]}catch{return[]}}),[L,te]=d.exports.useState(xi),[_,U]=d.exports.useState(null),[D,A]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(gi,JSON.stringify(w))}catch{}},[w]),d.exports.useEffect(()=>{try{localStorage.setItem(mi,S)}catch{}},[S]),d.exports.useEffect(()=>{S.startsWith("custom:")&&(w.some(R=>`custom:${R.id}`===S)||b("default"))},[S,w]),d.exports.useEffect(()=>{const T=document.documentElement;Array.from(T.classList).filter(de=>de.startsWith("rb-theme-")).forEach(de=>T.classList.remove(de)),md();const R=fi.find(de=>de.key===S);if(R){R.className&&T.classList.add(R.className),Zn(R.key);return}if(S.startsWith("custom:")){const de=w.find(Pe=>`custom:${Pe.id}`===S);if(!de)return;const q=l==="dark"?de.dark:de.light,be=xa(q.primary);gd(be,{bgLight:de.light.bg,bgDark:de.dark.bg,surfaceLight:de.light.surface,surfaceDark:de.dark.surface}),Zn("custom",l==="dark"?de.dark.bg:de.light.bg)}else Zn("default")},[S,w,l]);const Ae=d.exports.useCallback(T=>{T.colorModeTarget&&l!==T.colorModeTarget&&o(),b(T.key)},[l,o]),ge=T=>{b(`custom:${T}`)},re=T=>{U(null),te(T?{name:n(`theme.presets.${T.key}.name`),light:{...T.light},dark:{...T.dark}}:xi()),a.onOpen()},F=T=>{U(T.id),te({name:T.name,light:{...T.light},dark:{...T.dark}}),a.onOpen()},se=()=>{const T=L.name.trim()||n("theme.untitled"),R=Ft(L.light.primary,ar.primary),de=Ft(L.light.bg,ar.bg),q=As(de,R,ya,ar.surface),be=Ft(L.light.surface,q),Pe=Ft(L.dark.primary,ir.primary),Ie=Ft(L.dark.bg,ir.bg),Oe=As(Ie,Pe,Sa,ir.surface),Q=Ft(L.dark.surface,Oe),xe={id:_||ka(),name:T,light:{primary:R,bg:de,surface:be},dark:{primary:Pe,bg:Ie,surface:Q}};P(Y=>_?Y.map(pe=>pe.id===_?xe:pe):[...Y,xe]),b(`custom:${xe.id}`),a.onClose(),U(null),r({status:"success",title:n("theme.customSaved")})},le=T=>{P(R=>R.filter(de=>de.id!==T)),S===`custom:${T}`&&b("default"),r({status:"info",title:n("theme.customDeleted")})},ie=()=>{b("default"),r({status:"info",title:n("theme.resetSuccess")})},ne=async()=>{if(!w.length){r({status:"warning",title:n("theme.exportEmpty")});return}const T=w.map(({id:de,...q})=>q),R=JSON.stringify(T,null,2);try{await navigator.clipboard.writeText(R),r({status:"success",title:n("theme.exportSuccess")})}catch{try{const de=new Blob([R],{type:"application/json"}),q=URL.createObjectURL(de),be=document.createElement("a");be.href=q,be.download="rebecca-themes.json",be.click(),URL.revokeObjectURL(q),r({status:"success",title:n("theme.exportSuccessDownload")})}catch{r({status:"error",title:n("theme.exportError")})}}},I=()=>{try{const T=JSON.parse(D),de=(Array.isArray(T)?T:[T]).map(q=>{var O,fe,K,Z,ee,B;const be=Ft(((O=q==null?void 0:q.light)==null?void 0:O.primary)||ar.primary,ar.primary),Pe=Ft(((fe=q==null?void 0:q.light)==null?void 0:fe.bg)||ar.bg,ar.bg),Ie=As(Pe,be,ya,ar.surface),Oe=Ft(((K=q==null?void 0:q.light)==null?void 0:K.surface)||Ie,Ie),Q=Ft(((Z=q==null?void 0:q.dark)==null?void 0:Z.primary)||ir.primary,ir.primary),xe=Ft(((ee=q==null?void 0:q.dark)==null?void 0:ee.bg)||ir.bg,ir.bg),Y=As(xe,Q,Sa,ir.surface),pe=Ft(((B=q==null?void 0:q.dark)==null?void 0:B.surface)||Y,Y);return{id:ka(),name:(q==null?void 0:q.name)||"Custom",light:{primary:be,bg:Pe,surface:Oe},dark:{primary:Q,bg:xe,surface:pe}}}).filter(q=>q.name);if(!de.length){r({status:"warning",title:n("theme.importError")});return}P(q=>[...q,...de]),i.onClose(),A(""),r({status:"success",title:n("theme.importSuccess")})}catch{r({status:"error",title:n("theme.importError")})}},ce=d.exports.useCallback((T,R)=>{T.preventDefault(),T.stopPropagation(),R()},[]),Te=d.exports.useMemo(()=>xa(L.light.primary),[L.light.primary]),ve=d.exports.useMemo(()=>xa(L.dark.primary),[L.dark.primary]),N=T=>{const R=L[T],de=T==="dark"?ve:Te,q=de["--primary-500"]||R.primary,be=de["--primary-300"]||de["--primary-400"]||q,Pe=T==="dark"?"whiteAlpha.900":"gray.800",Ie=T==="dark"?"whiteAlpha.700":"gray.600",Oe=T==="dark"?"whiteAlpha.200":"blackAlpha.200",Q=T==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(z,{borderWidth:"1px",borderRadius:"md",bg:R.bg,p:4,borderColor:Oe,children:s(Ce,{spacing:3,children:[e(h,{fontWeight:"semibold",color:Pe,children:n(T==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(z,{borderRadius:"lg",bg:R.surface,p:4,borderWidth:"1px",borderColor:Oe,children:s(Ce,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:Pe,children:n("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:Ie,children:n("theme.previewSampleBody")}),e(X,{size:"sm",bg:q,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:n("theme.previewSampleAction")}),s(E,{spacing:2,pt:2,children:[e(z,{flex:"1",h:"2",borderRadius:"full",bg:be,opacity:.8}),e(z,{flex:"1",h:"2",borderRadius:"full",bg:q,opacity:.9})]})]})}),s(E,{spacing:1,pt:1,flexWrap:"wrap",children:[e(z,{w:6,h:6,borderRadius:"sm",bg:R.bg,borderWidth:"1px",borderColor:Q}),e(z,{w:6,h:6,borderRadius:"sm",bg:R.surface,borderWidth:"1px",borderColor:Q}),Object.entries(de).map(([xe,Y])=>e(z,{w:6,h:6,borderRadius:"sm",bg:Y,borderWidth:"1px",borderColor:Q,title:xe},xe))]})]})})};return s(Mt,{children:[s(ta,{placement:"bottom-end",children:[e(ra,{as:ze,size:"sm",variant:"outline",icon:e(nd,{}),position:"relative"}),s(sa,{minW:"260px",zIndex:9999,bg:c,color:g,borderColor:p,children:[e(ci,{title:n("theme.builtIn"),sx:x,children:fi.map(T=>{const R=S===T.key;return e(Zt,{onClick:()=>Ae(T),_hover:{bg:u},children:s(E,{justify:"space-between",w:"full",children:[s(E,{children:[e(z,{w:"4",h:"3",bg:T.accent,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:n(`theme.${T.key}`)})]}),R&&e(yi,{})]})},T.key)})}),!t&&s(Mt,{children:[e(na,{borderColor:p}),s(ci,{title:n("theme.customGroup"),sx:x,children:[w.length?w.map(T=>{const R=S===`custom:${T.id}`;return e(Zt,{onClick:()=>ge(T.id),_hover:{bg:u},children:s(E,{justify:"space-between",w:"full",children:[s(E,{children:[e(z,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${T.light.surface}, ${T.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:T.name})]}),s(E,{spacing:1,children:[R&&e(yi,{}),[{icon:e(id,{}),label:n("theme.edit"),onClick:()=>F(T)},{icon:e(od,{}),label:n("theme.delete"),onClick:()=>le(T.id)}].map(({icon:de,label:q,onClick:be})=>e(z,{as:"span",role:"button",tabIndex:0,"aria-label":q,onClick:Pe=>ce(Pe,be),onKeyDown:Pe=>{(Pe.key==="Enter"||Pe.key===" ")&&ce(Pe,be)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:u},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:de},q))]})]})},T.id)}):e(Zt,{isDisabled:!0,children:n("theme.noCustom")}),e(Zt,{icon:e(ad,{}),onClick:()=>re(),_hover:{bg:u},children:n("theme.createCustom")})]}),e(na,{borderColor:p}),e(Zt,{icon:e(Si,{}),onClick:()=>re(bi[0]),_hover:{bg:u},children:n("theme.quickPreset")}),e(Zt,{icon:e(ld,{}),onClick:ne,_hover:{bg:u},children:n("theme.export")}),e(Zt,{icon:e(cd,{}),onClick:()=>i.onOpen(),_hover:{bg:u},children:n("theme.import")}),e(Zt,{icon:e(dd,{}),onClick:ie,_hover:{bg:u},children:n("theme.reset")})]})]})]}),s(Nt,{isOpen:a.isOpen,onClose:a.onClose,isCentered:!0,size:"xl",children:[e(dt,{bg:v,backdropFilter:"blur(4px)"}),s(zt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:g,children:[e(ht,{color:g,children:n(_?"theme.editThemeTitle":"theme.customTitle")}),e(Pt,{}),e(ut,{children:s(oe,{spacing:6,align:"stretch",children:[s(k,{children:[e(C,{color:f,children:n("theme.customName")}),e(Se,{placeholder:n("theme.customNamePlaceholder")||"",value:L.name,onChange:T=>te(R=>({...R,name:T.target.value}))})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[N("light"),N("dark")]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(Ce,{spacing:4,children:[s(k,{children:[e(C,{color:f,children:n("theme.lightPrimary")}),e(Se,{type:"color",value:L.light.primary,onChange:T=>te(R=>({...R,light:{...R.light,primary:T.target.value}}))}),e(kr,{color:f,children:n("theme.lightPrimaryHint")})]}),s(k,{children:[e(C,{color:f,children:n("theme.lightSurface")}),e(Se,{type:"color",value:L.light.surface,onChange:T=>te(R=>({...R,light:{...R.light,surface:T.target.value}}))}),e(kr,{color:f,children:n("theme.lightSurfaceHint")})]}),s(k,{children:[e(C,{color:f,children:n("theme.lightBackground")}),e(Se,{type:"color",value:L.light.bg,onChange:T=>te(R=>({...R,light:{...R.light,bg:T.target.value}}))})]})]}),s(Ce,{spacing:4,children:[s(k,{children:[e(C,{color:f,children:n("theme.darkPrimary")}),e(Se,{type:"color",value:L.dark.primary,onChange:T=>te(R=>({...R,dark:{...R.dark,primary:T.target.value}}))}),e(kr,{color:f,children:n("theme.darkPrimaryHint")})]}),s(k,{children:[e(C,{color:f,children:n("theme.darkSurface")}),e(Se,{type:"color",value:L.dark.surface,onChange:T=>te(R=>({...R,dark:{...R.dark,surface:T.target.value}}))}),e(kr,{color:f,children:n("theme.darkSurfaceHint")})]}),s(k,{children:[e(C,{color:f,children:n("theme.darkBackground")}),e(Se,{type:"color",value:L.dark.bg,onChange:T=>te(R=>({...R,dark:{...R.dark,bg:T.target.value}}))})]})]})]}),s(z,{children:[s(E,{mb:2,children:[e(Si,{}),e(h,{fontWeight:"semibold",children:n("theme.presets")})]}),e(Ve,{columns:{base:1,md:3},spacing:3,children:bi.map(T=>e(X,{size:"sm",variant:"outline",onClick:()=>te({name:n(`theme.presets.${T.key}.name`),light:{...T.light},dark:{...T.dark}}),children:n(`theme.presets.${T.key}.name`)},T.key))})]})]})}),s(At,{children:[e(X,{variant:"ghost",mr:3,onClick:a.onClose,children:n("cancel")}),e(X,{colorScheme:"primary",onClick:se,children:n(_?"theme.customUpdate":"theme.customSave")})]})]})]}),s(Nt,{isOpen:i.isOpen,onClose:i.onClose,size:"lg",isCentered:!0,children:[e(dt,{bg:v,backdropFilter:"blur(4px)"}),s(zt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:g,children:[e(ht,{color:g,children:n("theme.importTitle")}),e(Pt,{}),e(ut,{children:s(oe,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:f,children:n("theme.importDescription")}),e(dr,{rows:8,placeholder:n("theme.importPlaceholder")||"",value:D,onChange:T=>A(T.target.value),bg:"transparent",borderColor:p,color:g})]})}),s(At,{children:[e(X,{variant:"ghost",mr:3,onClick:i.onClose,children:n("cancel")}),e(X,{colorScheme:"primary",onClick:I,children:n("theme.importAction")})]})]})]})]})},fd=Ee.object({username:Ee.string().min(1,"login.fieldRequired"),password:Ee.string().min(1,"login.fieldRequired")}),bd=j("img",{baseStyle:{w:12,h:12}}),yd=j(Ml,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Sd=j(fn,{baseStyle:{w:4,h:4}}),xd=j(Ya,{baseStyle:{w:4,h:4}}),ki=()=>{var x,S;const[t,n]=d.exports.useState(""),[r,l]=d.exports.useState(!1),[o,a]=d.exports.useState(!1),i=Ul(),{t:c}=He();let u=Ga();const{register:p,formState:{errors:g},handleSubmit:f}=vr({resolver:ua(fd)});d.exports.useEffect(()=>{Xc(),u.pathname!=="/login"&&i("/login",{replace:!0})},[]);const v=b=>{n("");const w=new FormData;w.append("username",b.username),w.append("password",b.password),w.append("grant_type","password"),l(!0),De("/admin/token",{method:"post",body:w}).then(({access_token:P})=>{console.log("Token received:",P),Gc(P),i("/")}).catch(P=>{var L,te;n(((te=(L=P.response)==null?void 0:L._data)==null?void 0:te.detail)||"Login failed")}).finally(()=>l(!1))};return e(oe,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(Mr,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:s($r,{children:[s(E,{justifyContent:"end",spacing:2,mb:6,children:[e(Ho,{}),e(Ko,{minimal:!0})]}),s(oe,{alignItems:"center",w:"full",spacing:4,children:[e(bd,{src:ed,alt:c("appName")||"Rebecca"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(z,{w:"full",pt:"4",children:e("form",{onSubmit:f(v),children:s(oe,{spacing:4,children:[e(k,{children:e(sr,{w:"full",placeholder:c("username"),...p("username"),error:c((x=g==null?void 0:g.username)==null?void 0:x.message)})}),s(k,{isInvalid:!!g.password,children:[s(mr,{children:[e(Se,{w:"full",type:o?"text":"password",placeholder:c("password"),...p("password")}),e(wr,{children:e(ze,{"aria-label":o?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>a(!o),icon:o?e(xd,{}):e(Sd,{})})})]}),e(Br,{children:(S=g.password)==null?void 0:S.message})]}),t&&s(ur,{status:"error",rounded:"md",children:[e(hr,{}),e(as,{children:t})]}),s(X,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(yd,{marginRight:1}),c("login")]})]})})})]})})})},kd=async()=>await De("/admin"),Ss=()=>{const{data:t,isError:n,isLoading:r,isSuccess:l,error:o}=Gr({queryFn:()=>kd()});return{userData:t||{is_sudo:!1,telegram_id:"",username:"",users_usage:0},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:n,getUserError:o}},Qr={baseStyle:{w:5,h:5}},wd=j(Ol,Qr),vd=j(bo,Qr),Cd=j(Wl,Qr),wa=j(Fl,Qr),_d=j(Hl,Qr),Dd=j(Bl,Qr),Ad=j(ha,Qr),Id=j(yo,Qr),Td=j(So,Qr),wi=({collapsed:t,inDrawer:n=!1})=>{const{t:r}=He(),l=Ga(),{userData:o,getUserIsSuccess:a}=Ss(),i=a&&o.is_sudo,u=[...[{title:r("header.hostSettings"),url:"/hosts",icon:Cd},{title:r("header.nodeSettings"),url:"/node-settings",icon:_d},{title:r("header.integrationSettings","Master Settings"),url:"/integrations",icon:wa},{title:r("header.xraySettings"),url:"/xray-settings",icon:wa}]];i&&u.unshift({title:r("services.menu","Services"),url:"/services",icon:Id});const p=u.some(x=>l.pathname===x.url),[g,f]=d.exports.useState(p);d.exports.useEffect(()=>{p&&f(!0)},[p]);const v=[{title:r("dashboard"),url:"/",icon:wd},{title:r("users"),url:"/users",icon:vd}];return i&&(v.push({title:r("usage.menu","Usage"),url:"/usage",icon:Td}),v.push({title:r("admins","Admins"),url:"/admins",icon:Dd}),v.push({title:r("header.settings"),icon:wa,subItems:u})),e(z,{w:n?"full":t?"16":"60",h:n?"100%":"100vh",maxH:n?"100%":"100vh",bg:"surface.light",borderRight:n?void 0:"1px",borderColor:n?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:n?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:n?"relative":"fixed",top:n?void 0:"0",left:n?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:s(oe,{spacing:1,p:4,align:"stretch",children:[!t&&e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},px:2,mb:2,children:r("menu")}),v.map(x=>{const S=x.url,b=typeof S=="string"&&l.pathname===S||typeof S=="string"&&S!=="/"&&l.pathname.startsWith(S)||x.subItems&&x.subItems.some(P=>l.pathname===P.url),w=x.icon;return e(z,{children:x.subItems?s(Mt,{children:[s(E,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:b?"primary.50":"transparent",color:b?"primary.600":"gray.700",_dark:{bg:b?"primary.900":"transparent",color:b?"primary.200":"gray.300"},_hover:{bg:b?"primary.50":"gray.50",_dark:{bg:b?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>f(!g),children:[s(E,{children:[e(w,{}),!t&&e(h,{fontSize:"sm",fontWeight:b?"semibold":"normal",children:x.title})]}),!t&&e(Ad,{transform:g?"rotate(180deg)":"rotate(0deg)"})]}),!t&&e(bn,{in:g,animateOpacity:!0,children:e(oe,{align:"stretch",pl:6,spacing:1,mt:2,children:x.subItems.map(P=>{const L=l.pathname===P.url,te=P.icon;return e(di,{to:P.url,children:s(E,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:L?"primary.50":"transparent",color:L?"primary.600":"gray.700",_dark:{bg:L?"primary.900":"transparent",color:L?"primary.200":"gray.300"},_hover:{bg:L?"primary.50":"gray.50",_dark:{bg:L?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(te,{}),e(h,{fontSize:"sm",fontWeight:L?"semibold":"normal",children:P.title})]})},P.url)})})})]}):x.url?e(di,{to:x.url,children:s(E,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:b?"primary.50":"transparent",color:b?"primary.600":"gray.700",_dark:{bg:b?"primary.900":"transparent",color:b?"primary.200":"gray.300"},_hover:{bg:b?"primary.50":"gray.50",_dark:{bg:b?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(w,{}),!t&&e(h,{fontSize:"sm",fontWeight:b?"semibold":"normal",children:x.title})]})}):null},x.title)})]})})},jn=Vl,Pd="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",$o={base:Pd,folder:"apple/64",ext:".png",className:"apple-emoji"},va=t=>{var n,r;return typeof t=="string"&&((r=(n=jn.test)==null?void 0:n.call(jn,t))!=null?r:!1)},Ed=t=>t.some(n=>{var r;return n.type==="characterData"?va((r=n.target)==null?void 0:r.data):n.type==="childList"?Array.from(n.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return va(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const o=l;return o.tagName==="IMG"&&o.classList.contains($o.className)?!1:va(o.textContent)}return!1}):!1}),Nd=()=>{const t=Ga();d.exports.useEffect(()=>{const n=document.getElementById("root");if(!n)return;const r=()=>{jn.parse(n,$o)};r();const l=new MutationObserver(o=>{Ed(o)&&requestAnimationFrame(r)});return l.observe(n,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},Jo={baseStyle:{w:4,h:4}},zd=j(Kl,Jo),Rd=j(xo,Jo);function Ld(){const[t,n]=d.exports.useState(!1),r=or({base:!0,md:!1}),l=Yt();return Nd(),s(Tt,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(wi,{collapsed:t}),s(Tt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[s(z,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(ze,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():n(!t)},icon:e(Rd,{})}),s(E,{spacing:2,children:[e(Ho,{}),e(Ko,{}),e($l,{to:"/login",children:e(ze,{size:"sm",variant:"outline","aria-label":"logout",icon:e(zd,{})})})]})]}),e(z,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(Jl,{})})]}),r&&s(ko,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(dt,{}),e(wo,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(ut,{p:0,children:e(wi,{collapsed:!1,inDrawer:!0})})})]})]})}const qo="marzban-num-users-per-page",vi=10,Md=()=>{const t=localStorage.getItem(qo)||vi.toString();return parseInt(t)||vi},Ud=t=>localStorage.setItem(qo,t),Od=t=>{for(const n in t)t[n]||delete t[n];return ct.setState({loading:!0}),De("/users",{query:t}).then(n=>{var a,i;const r=(a=n.users_limit)!=null?a:null,l=(i=n.active_total)!=null?i:null,o=r!=null&&r>0&&l!==null?l>=r:!1;return ct.setState({users:n,isUserLimitReached:o}),n}).finally(()=>{ct.setState({loading:!1})})},xn=()=>De("/inbounds").then(t=>{ct.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{ct.setState({loading:!1})}),ct=Ks(ql((t,n)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Md(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{Od(n().filters)},resetAllUsage:()=>De("/users/reset",{method:"POST"}).then(()=>{n().onResetAllUsage(!1),n().refetchUsers()}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...n().filters,...r}}),n().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),De(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),n().refetchUsers(),Qn.invalidateQueries(ea)})),createUser:r=>De("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(),Qn.invalidateQueries(ea)}),createUserWithService:r=>De("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),n().refetchUsers(),Qn.invalidateQueries(ea)}),editUser:(r,l)=>De(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{n().onEditingUser(null),n().refetchUsers()}),fetchUserUsage:(r,l)=>{for(const o in l)l[o]||delete l[o];return De(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>De(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),n().refetchUsers()}),revokeSubscription:r=>De(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),n().refetchUsers()}),onEditingCore:r=>t({isEditingCore:r})})));function Je(t,n=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,o=n<0?0:n,a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(t)/Math.log(l)),c=parseFloat((t/Math.pow(l,i)).toFixed(o));return r?[c,a[i]]:`${c} ${a[i]}`}const Ci=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Wd=j(bo,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Fd=j(Yl,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),_i=({title:t,content:n,icon:r})=>s(Mr,{p:6,borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[s(E,{alignItems:"center",columnGap:"4",children:[e(z,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:r}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(z,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:n})]}),ea="statistics-query-key",Hd=t=>{var a;const{version:n}=ct(),{userData:r}=Ss(),{data:l}=Gr({queryKey:ea,queryFn:()=>De("/system"),refetchInterval:6e5,onSuccess:({version:i})=>{n!==i&&ct.setState({version:i})}}),{t:o}=He();return s(E,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(_i,{title:o("activeUsers"),content:l&&s(E,{alignItems:"flex-end",children:[e(h,{children:Ci(l.users_active)}),s(h,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Ci(l.total_user)]})]}),icon:e(Wd,{})}),e(_i,{title:o("UsersUsage"),content:Je((a=r.users_usage)!=null?a:0),icon:e(Fd,{})})]})},Bd=()=>{const{t}=He();return e(oe,{spacing:6,align:"stretch",children:s(z,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(Hd,{})]})})},gs=({children:t,color:n})=>e(z,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${n}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${n}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${n}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${n}.400`}},children:e(h,{color:`${n}.500`,_dark:{color:`${n}.900`},position:"relative",zIndex:"2",children:t})}),Pn=j(Ur,{baseStyle:{w:5,h:5}}),Vd=()=>{const[t,n]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:o}=ct(),{t:a}=He(),i=Ut(),c=()=>{l(null)},u=()=>{r&&(n(!0),o(r).then(()=>{i({title:a("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(n.bind(null,!1)))};return s(Nt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(ht,{pt:6,children:e(gs,{color:"red",children:e(Pn,{})})}),e(Pt,{mt:3}),s(ut,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:a("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(pa,{components:{b:e("b",{})},children:a("deleteUser.prompt",{username:r.username})})})]}),s(At,{display:"flex",children:[e(X,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(X,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(kt,{size:"xs"}):void 0,children:a("delete")})]})]})]})},Kd={search:"",limit:10,offset:0,sort:"username"},Zr=Ks((t,n)=>({admins:[],total:0,loading:!1,filters:Kd,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=n(),o={...l,...r},a={};o.search&&(a.username=o.search),o.offset!==void 0&&(a.offset=o.offset),o.limit!==void 0&&(a.limit=o.limit),o.sort&&(o.sort==="data_usage"?a.sort="users_usage":o.sort==="data_limit"?a.sort="data_limit":a.sort=o.sort),t({loading:!0});try{const i=await De("/admins",{query:a}),{admins:c,total:u}=Array.isArray(i)?{admins:i,total:i.length}:{admins:i.admins||[],total:i.total||0};t(p=>{const g=p.adminInDetails?c.find(f=>{var v;return f.username===((v=p.adminInDetails)==null?void 0:v.username)})||p.adminInDetails:null;return{admins:c,total:u,adminInDetails:g}})}catch(i){console.error("Failed to fetch admins:",i),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),n().fetchAdmins()},async createAdmin(r){await De("/admin",{method:"POST",body:r}),await n().fetchAdmins()},async updateAdmin(r,l){await De(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await n().fetchAdmins()},async deleteAdmin(r){await De(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await n().fetchAdmins()},async resetUsage(r){await De(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await n().fetchAdmins()},async disableUsers(r){await De(`/admin/${encodeURIComponent(r)}/users/disable`,{method:"POST"})},async activateUsers(r){await De(`/admin/${encodeURIComponent(r)}/users/activate`,{method:"POST"})},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),ma={baseStyle:{w:4,h:4}},$d=j(vo,ma),Jd=j(qa,ma),Yo=j(Or,ma),qd=j(Xr,ma),Yd=Gl((t,n)=>{n==="users"?ct.getState().onFilterChange({...ct.getState().filters,offset:0,search:t}):Zr.getState().onFilterChange({search:t,offset:0})},300),Go=({for:t="users",...n})=>{var D;const{loading:r,filters:l,onFilterChange:o,refetchUsers:a,onCreateUser:i}=ct(),{loading:c,filters:u,onFilterChange:p,fetchAdmins:g,openAdminDialog:f}=Zr(),{t:v}=He(),[x,S]=d.exports.useState(""),b=t==="users"?r:c,w=t==="users"?l:u,P=A=>{S(A.target.value),Yd(A.target.value,t)},L=()=>{S(""),t==="users"?o({...w,offset:0,search:""}):p({search:"",offset:0})},te=()=>{t==="users"?a():g()},_=()=>{t==="users"?i(!0):f()},U=(D=or({base:!0,sm:!1}))!=null?D:!1;return s(Xa,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...n,children:[e(hs,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:s(E,{spacing:2,align:"center",w:"full",children:[s(mr,{flex:"1",children:[e(Co,{pointerEvents:"none",children:e($d,{})}),e(Se,{placeholder:t==="users"?v("search"):v("admins.searchPlaceholder","Search admins..."),value:x,borderColor:"light-border",w:"full",onChange:P}),s(wr,{children:[b&&e(kt,{size:"xs"}),w.search&&w.search.length>0&&e(ze,{onClick:L,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Jd,{})})]})]}),e(ze,{"aria-label":"refresh",disabled:b,onClick:te,size:U?"sm":"md",variant:U?"ghost":"outline",borderRadius:"full",minW:U?"36px":"40px",h:U?"36px":void 0,children:e(Yo,{className:ca({"animate-spin":b})})})]})}),e(hs,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(Ce,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:e(X,{colorScheme:"primary",size:U?"sm":"md",onClick:_,px:U?3:5,leftIcon:U?void 0:e(qd,{}),w:"auto",h:U?"36px":void 0,minW:U?"auto":"8.5rem",fontSize:U?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?v("createUser"):v("admins.addAdmin","Add admin")})})})]})},Gd=j(Xl,{baseStyle:{w:4,h:4}}),Xd=j(Ql,{baseStyle:{w:4,h:4}}),Di=5;function Qd(t,n,r){if(r<Di)throw new Error(`Must allow at least ${Di} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,n-Math.floor(r/2))),o=new Array(r);for(let a=0;a<r;a+=1)o[a]=a+l;return typeof o[0]=="number"&&o[0]>0&&(o[0]=0,o[1]="prev-more"),o[o.length-1]<t-1&&(o[o.length-1]=t-1,o[o.length-2]="next-more"),o}const Xo=({for:t="users"})=>{const{filters:n,onFilterChange:r,users:{total:l}}=ct(),{filters:o,onFilterChange:a,total:i}=Zr(),{t:c}=He(),{filters:u,total:p,onFilterChange:g}=d.exports.useMemo(()=>t==="admins"?{filters:o,total:i,onFilterChange:a}:{filters:n,total:l,onFilterChange:r},[t,o,i,a,n,l,r]),{limit:f,offset:v}=u,x=Number(f||10),S=Number(v||0),b=Math.floor(S/x),w=Math.ceil(p/x),P=Qd(w,b,7),L=D=>{g({...u,offset:D*x})},te=D=>{const A=parseInt(D.target.value,10);g({...u,limit:A,offset:0}),t==="users"&&Ud(D.target.value)},_=d.exports.useMemo(()=>b>0&&w>0,[b,w]),U=d.exports.useMemo(()=>b+1<w&&w>0,[b,w]);return p<=x&&b===0?null:s(E,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(z,{order:{base:2,md:1},children:s(E,{children:[s(qe,{minW:"60px",value:String(x),onChange:te,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),s(_o,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(X,{leftIcon:e(Gd,{}),onClick:()=>L(b-1),isDisabled:!_,children:c("previous")}),P.map(D=>typeof D=="string"?e(X,{children:"..."},D):e(X,{variant:D===b?"solid":"outline",onClick:()=>L(D),children:D+1},D)),e(X,{rightIcon:e(Xd,{}),onClick:()=>L(b+1),isDisabled:!U,children:c("next")})]})]})},Zd=Zl;const Ai=j(jl),jd=j(Do,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),eu=j(ec,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),tu=j(Ao,{baseStyle:{w:5,h:5}}),ru=()=>{const{QRcodeLinks:t,setQRCode:n,setSubLink:r,subscribeUrl:l}=ct(),o=t!==null,[a,i]=d.exports.useState(0),{t:c}=He(),u=()=>{n(null),r(null)},p=String(l).startsWith("/")?window.location.origin+l:String(l);return s(Nt,{isOpen:o,onClose:u,children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(ht,{pt:6,children:e(gs,{color:"primary",children:e(tu,{color:"white"})})}),e(Pt,{mt:3}),t&&s(ut,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&s(oe,{children:[e(Ai,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),s(z,{w:"300px",children:[e(Zd,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:i,onInit:()=>i(0),nextArrow:e(ze,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(jd,{})}),prevArrow:e(ze,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(eu,{})}),children:t.map((g,f)=>e(E,{children:e(Ai,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:g,bg:"white"})},f))}),s(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[a+1," / ",t.length]})]})]})]})]})},su=j(Or,{baseStyle:{w:5,h:5}}),nu=()=>{const[t,n]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=ct(),{t:o}=He(),a=Ut(),i=()=>{ct.setState({resetUsageUser:null})},c=()=>{r&&(n(!0),l(r).then(()=>{a({title:o("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:o("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(Nt,{isCentered:!0,isOpen:!!r,onClose:i,size:"sm",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(ht,{pt:6,children:e(gs,{color:"blue",children:e(su,{})})}),e(Pt,{mt:3}),s(ut,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(pa,{components:{b:e("b",{})},children:o("resetUserUsage.prompt",{username:r.username})})})]}),s(At,{display:"flex",children:[e(X,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(X,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(kt,{size:"xs"}):void 0,children:o("reset")})]})]})]})},au=j(Or,{baseStyle:{w:5,h:5}}),iu=()=>{const[t,n]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=ct(),{t:o}=He(),a=Ut(),i=()=>{ct.setState({revokeSubscriptionUser:null})},c=()=>{r&&(n(!0),l(r).then(()=>{a({title:o("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:o("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{n(!1)}))};return s(Nt,{isCentered:!0,isOpen:!!r,onClose:i,size:"sm",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(ht,{pt:6,children:e(gs,{color:"blue",children:e(au,{})})}),e(Pt,{mt:3}),s(ut,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(pa,{components:{b:e("b",{})},children:o("revokeUserSub.prompt",{username:r.username})})})]}),s(At,{display:"flex",children:[e(X,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(X,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(kt,{size:"xs"}):void 0,children:o("revoke")})]})]})]})},En={baseStyle:{strokeWidth:"2px",w:4,h:4}},Ii=j(tc,En),ou=j(rc,En),Ti=j(sc,En),Pi=j(Io,En),lu=j(Io,En),Wa=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],ps={active:{statusColor:"green",bandWidthColor:"primary",icon:Ii},connected:{statusColor:"green",bandWidthColor:"primary",icon:Ii},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:ou},expired:{statusColor:"orange",bandWidthColor:"orange",icon:Pi},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:lu},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:Pi},limited:{statusColor:"red",bandWidthColor:"red",icon:Ti},error:{statusColor:"red",bandWidthColor:"red",icon:Ti}},Os=Ks((t,n)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await De("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await De(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await De("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await n().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const o=await De(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:o}),await n().fetchServices(),o}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await De(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await n().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await De(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await n().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),ga=t=>{let n={status:"",time:""};if(t){Fe(t*1e3).utc().isAfter(Fe().utc())?n.status="expires":n.status="expired";const r=[],l=Fe.duration(Fe(t*1e3).utc().diff(Fe()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),n.time=r.join(", ")}return n},Nn=d.exports.forwardRef((t,n)=>e(nc,{...t,ref:n}));Nn.displayName="DatePicker";function cu(t){const n=360/t,r=90,l=47,o=[];for(let a=0;a<t;a++){const i=a*n%360+140,c=du(i,r,l);o.push(c)}return o}function du(t,n,r){t/=360,n/=100,r/=100;let l,o,a;if(n===0)l=o=a=r;else{const c=(g,f,v)=>(v<0&&(v+=1),v>1&&(v-=1),v<.16666666666666666?g+(f-g)*6*v:v<.5?f:v<.6666666666666666?g+(f-g)*(.6666666666666666-v)*6:g),u=r<.5?r*(1+n):r+n-r*n,p=2*r-u;l=Math.round(c(p,u,t+1/3)*255),o=Math.round(c(p,u,t)*255),a=Math.round(c(p,u,t-1/3)*255)}const i=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${i(l)}${i(o)}${i(a)}`}const Ei=({border:t,...n})=>{const{getInputProps:r,getRadioProps:l}=oc(n),o=or({base:"xs",md:"sm"});return s(z,{as:"label",children:[e("input",{...r()}),e(z,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:o,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:n.children})]})},uu=({onChange:t,defaultValue:n,...r})=>{const{t:l,i18n:o}=He();os();const a=or({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),i={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=or({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:p,setValue:g}=ac({name:"filter",defaultValue:n,onChange:se=>{if(se==="custom")return;x(),a.indexOf(se)>=0?(w(l("userDialog.custom")),L(!1)):(w(l("userDialog.custom")+` (${se})`),L(!0));const le=Number(se.substring(0,se.length-1)),ie=i[se[se.length-1]];t(se,{start:Fe().utc().subtract(le,ie).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:f,onOpen:v,onClose:x}=Yt(),S=d.exports.useRef(null);ic({ref:S,handler:x});const[b,w]=d.exports.useState(l("userDialog.custom")),[P,L]=d.exports.useState(!1),[te,_]=d.exports.useState(0),U=or({base:1,md:2}),D=or({base:"xs",md:"sm"}),[A,Ae]=d.exports.useState(null),[ge,re]=d.exports.useState(null),F=se=>{const[le,ie]=se;ge&&!ie?(Ae(null),re(null)):(Ae(le),re(ie),le&&ie&&(x(),t("custom",{start:Fe(le).format("YYYY-MM-DDT00:00:00"),end:Fe(ie).format("YYYY-MM-DDT23:59:59")})))};return s(oe,{...r,children:[te==0&&s(Ve,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[a.map(se=>e(Ei,{...p({value:se}),children:se},se)),e(z,{onClick:()=>{Ae(null),re(null),v()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:D,px:3,py:1,bg:P?"primary.500":"unset",color:P?"white":"unset",borderColor:P?"primary.500":"unset",children:s(E,{children:[e(h,{children:b}),e(mn,{as:ui,boxSize:"18px"})]})})]}),te==1&&s(E,{onClick:v,cursor:"pointer",fontSize:D,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:A?"unset":"gray.500",children:A?Fe(A).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(mn,{as:Do,boxSize:"18px"}),e(h,{w:"full",color:ge?"unset":"gray.500",children:ge?Fe(ge).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(mn,{as:ui,boxSize:"18px"})]}),e(oe,{ref:S,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:f?"unset":"none",children:s($s,{onChange:se=>_(se),children:[s(Js,{children:[e(Bt,{fontSize:D,children:l("userDialog.relative")}),e(Bt,{fontSize:D,children:l("userDialog.absolute")})]}),s(qs,{children:[e(Vt,{children:c.map(se=>e(oe,{alignItems:"start",pl:2,pr:2,children:s(E,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:D,minW:"60px",children:l("userDialog."+se.title)}),se.options.map(le=>e(Ei,{border:!0,...p({value:le}),children:le},le+".custom"))]})},se.title))}),e(Vt,{className:"datepicker-panel",children:e(oe,{children:e(Nn,{locale:o.language.toLocaleLowerCase(),selected:A,onChange:F,startDate:A,endDate:ge,selectsRange:!0,maxDate:new Date,monthsShown:U,peekNextMonth:!1,inline:!0})})})]})]})})]})};function oa(t,n,r=[],l=[]){const o=Je(r.reduce((a,i)=>a+=i,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${n}${o}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(a,{seriesIndex:i,w:c})=>Je(c.config.series[i],1)},tooltip:{custom:({series:a,seriesIndex:i,dataPointIndex:c,w:u})=>{const p=Je(a[i],1),g=Math.max(a.reduce((v,x)=>v+=x),1),f=Math.round(a[i]/g*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[i]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[i]}: <b>${f}, ${p}</b>
            </div>
          `}},colors:cu(r.length)}}}const hu=j(lc,{baseStyle:{w:5,h:5}}),pu=j(is,{baseStyle:{w:5,h:5}}),mu=j(So,{baseStyle:{w:5,h:5}}),gu=j(cc,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});j(da,{baseStyle:{w:4,h:4}});const fu=t=>{var r,l,o,a,i;const n=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(n),next_plan_data_limit:n!=null&&n.data_limit?Number((n.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(o=n==null?void 0:n.expire)!=null?o:null,next_plan_add_remaining_traffic:(a=n==null?void 0:n.add_remaining_traffic)!=null?a:!1,next_plan_fire_on_either:(i=n==null?void 0:n.fire_on_either)!=null?i:!0}},Ni=()=>({data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),js={username:Ee.string().min(1,{message:"Required"}),note:Ee.string().nullable(),service_id:Ee.union([Ee.string(),Ee.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),proxies:Ee.record(Ee.string(),Ee.record(Ee.string(),Ee.any())).transform(t=>{const n=(r,l)=>{r&&r[l]===""&&delete r[l]};return n(t.vmess,"id"),n(t.vless,"id"),n(t.trojan,"password"),n(t.shadowsocks,"password"),n(t.shadowsocks,"method"),t}),data_limit:Ee.string().min(0).or(Ee.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:Ee.number().nullable(),data_limit_reset_strategy:Ee.string(),inbounds:Ee.record(Ee.string(),Ee.array(Ee.string())).transform(t=>(Object.keys(t).forEach(n=>{var r;Array.isArray(t[n])&&!((r=t[n])!=null&&r.length)&&delete t[n]}),t)),next_plan_enabled:Ee.boolean().default(!1),next_plan_data_limit:Ee.union([Ee.string(),Ee.number(),Ee.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:Math.max(0,n)}),next_plan_expire:Ee.union([Ee.number(),Ee.string(),Ee.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const n=Number(t);return Number.isNaN(n)?null:n}),next_plan_add_remaining_traffic:Ee.boolean().default(!1),next_plan_fire_on_either:Ee.boolean().default(!0)},bu=Ee.discriminatedUnion("status",[Ee.object({status:Ee.literal("active"),...js}),Ee.object({status:Ee.literal("disabled"),...js}),Ee.object({status:Ee.literal("limited"),...js}),Ee.object({status:Ee.literal("expired"),...js}),Ee.object({status:Ee.literal("on_hold"),on_hold_expire_duration:Ee.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...js})]),yu=()=>{var mt,vt,Rt,Kt,jt,Gt,er,Wt;const{editingUser:t,isCreatingNewUser:n,onCreateUser:r,editUser:l,fetchUserUsage:o,onEditingUser:a,createUserWithService:i,onDeletingUser:c,users:u,isUserLimitReached:p}=ct(),g=!!t,f=n||g,v=(mt=u.users_limit)!=null?mt:null,x=(vt=u.active_total)!=null?vt:null,S=p&&!g,[b,w]=d.exports.useState(!1),[P,L]=d.exports.useState(""),te=Ut(),{t:_}=He(),{colorMode:U}=os(),D=vr({defaultValues:Ni(),resolver:ua(bu)}),A=D.getValues("expire"),Ae=D.getValues("next_plan_expire");function ge($){if(typeof $!="number"||$<=0)return null;const _e=Fe.unix($).utc().local(),Ge=Fe(),et=_e.diff(Ge,"day",!0);return Number.isFinite(et)?Math.max(0,Math.round(et)):null}function re($){return Fe().add($,"day").endOf("day").utc().unix()}const[F,se]=d.exports.useState(()=>ge(A)),[le,ie]=d.exports.useState(()=>ge(Ae)),ne=Os($=>$.services),I=Os($=>$.isLoading),{userData:ce,getUserIsSuccess:Te}=Ss(),ve=Boolean(Te&&ce.is_sudo),[N,T]=d.exports.useState(null),R=ne.length>0,de=N&&(Rt=ne.find($=>$.id===N))!=null?Rt:null,q=Boolean(t==null?void 0:t.service_id),[be,Pe]=d.exports.useState(!1),Ie=()=>{Pe($=>!$)};d.exports.useEffect(()=>{f&&Os.getState().fetchServices()},[f]),d.exports.useEffect(()=>{var $,_e;g?t!=null&&t.service_id?T(t.service_id):ve?T(null):ne.length?T((_e=($=ne[0])==null?void 0:$.id)!=null?_e:null):T(null):f||T(null)},[g,t,f,ve,ne]),d.exports.useEffect(()=>{!g&&f&&R&&T($=>{var _e,Ge;return(Ge=$!=null?$:(_e=ne[0])==null?void 0:_e.id)!=null?Ge:null})},[ne,g,f,R]),d.exports.useEffect(()=>{!g&&f&&!R&&T(null)},[R,g,f]);const[Oe,Q]=qt({control:D.control,name:["data_limit","status"]}),xe=qt({control:D.control,name:"next_plan_enabled"}),Y=qt({control:D.control,name:"expire"}),pe=qt({control:D.control,name:"next_plan_data_limit"}),O=qt({control:D.control,name:"next_plan_expire"}),fe=qt({control:D.control,name:"next_plan_add_remaining_traffic"}),K=qt({control:D.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const $=ge(Y);se(_e=>_e===$?_e:$)},[Y]),d.exports.useEffect(()=>{const $=ge(O);ie(_e=>_e===$?_e:$)},[O]);const Z=$=>{D.setValue("next_plan_enabled",$,{shouldDirty:!0}),$?(D.getValues("next_plan_data_limit")===null&&D.setValue("next_plan_data_limit",0,{shouldDirty:!1}),D.getValues("next_plan_add_remaining_traffic")===void 0&&D.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),D.getValues("next_plan_fire_on_either")===void 0&&D.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(D.setValue("next_plan_data_limit",null,{shouldDirty:!0}),D.setValue("next_plan_expire",null,{shouldDirty:!0}),ie(null))},ee=_("userDialog.total"),[B,ke]=d.exports.useState(oa(U,ee)),[bt,Ye]=d.exports.useState("1m"),G=$=>{o(t,$).then(_e=>{const Ge=[],et=[];for(const yt in _e.usages)et.push(_e.usages[yt].used_traffic),Ge.push(_e.usages[yt].node_name);ke(oa(U,ee,et,Ge))})};d.exports.useEffect(()=>{t&&(D.reset(fu(t)),G({start:Fe().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[t,g,f]);const W=$=>{if(S)return;w(!0),L(null);const{service_id:_e,next_plan_enabled:Ge,next_plan_data_limit:et,next_plan_expire:yt,next_plan_add_remaining_traffic:H,next_plan_fire_on_either:ue,proxies:J,inbounds:Xe,status:st,data_limit:$e,data_limit_reset_strategy:it,on_hold_expire_duration:Ct,...$t}=$,gt=Ge&&et&&et>0?Number((Number(et)*1073741824).toFixed(5)):0,Ot=Ge?{data_limit:gt,expire:yt!=null?yt:0,add_remaining_traffic:H,fire_on_either:ue}:null;if(!g){if(!N){L(_("userDialog.selectService","Please choose a service")),w(!1);return}const St={username:$.username,service_id:N,note:$.note,status:$.status==="active"||$.status==="disabled"||$.status==="on_hold"?$.status:"active",expire:$.expire,data_limit:$.data_limit,data_limit_reset_strategy:$e&&$e>0?it:"no_reset",on_hold_expire_duration:st==="on_hold"?Ct:null};Ot&&(St.next_plan=Ot),i(St).then(()=>{te({title:_("userDialog.userCreated",{username:$.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),he()}).catch(xt=>{var gr,Et,nr,fr,lr;(((gr=xt==null?void 0:xt.response)==null?void 0:gr.status)===409||((Et=xt==null?void 0:xt.response)==null?void 0:Et.status)===400)&&L((fr=(nr=xt==null?void 0:xt.response)==null?void 0:nr._data)==null?void 0:fr.detail),((lr=xt==null?void 0:xt.response)==null?void 0:lr.status)===422&&Object.keys(xt.response._data.detail).forEach(Cr=>{L(xt==null?void 0:xt.response._data.detail[Cr]),D.setError(Cr,{type:"custom",message:xt.response._data.detail[Cr]})})}).finally(()=>{w(!1)});return}const Lt={...$t,data_limit:$e,data_limit_reset_strategy:$e&&$e>0?it:"no_reset",status:st==="active"||st==="disabled"||st==="on_hold"?st:"active",on_hold_expire_duration:st==="on_hold"?Ct:null};Ot?Lt.next_plan=Ot:!Ge&&(t==null?void 0:t.next_plan)&&(Lt.next_plan=null),t!=null&&t.service_id||(J&&Object.keys(J).length>0&&(Lt.proxies=J),Xe&&Object.keys(Xe).length>0&&(Lt.inbounds=Xe)),typeof N<"u"&&(N===null?ve&&(Lt.service_id=null):N!==(t==null?void 0:t.service_id)&&(Lt.service_id=N)),l(t.username,Lt).then(()=>{te({title:_("userDialog.userEdited",{username:$.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),he()}).catch(St=>{var xt,gr,Et,nr,fr;(((xt=St==null?void 0:St.response)==null?void 0:xt.status)===409||((gr=St==null?void 0:St.response)==null?void 0:gr.status)===400)&&L((nr=(Et=St==null?void 0:St.response)==null?void 0:Et._data)==null?void 0:nr.detail),((fr=St==null?void 0:St.response)==null?void 0:fr.status)===422&&Object.keys(St.response._data.detail).forEach(lr=>{L(St==null?void 0:St.response._data.detail[lr]),D.setError(lr,{type:"custom",message:St.response._data.detail[lr]})})}).finally(()=>{w(!1)})},he=()=>{D.reset(Ni()),r(!1),a(null),L(null),Pe(!1),Ye("1m"),T(null)},we=()=>{ct.setState({resetUsageUser:t})},We=()=>{ct.setState({revokeSubscriptionUser:t})},Ne=b||S,rt=Q==="on_hold",[pt,It]=d.exports.useState(!1),Ze=()=>{It(!0);let $="";const _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ge=_e.length;let et=0;for(;et<6;)$+=_e.charAt(Math.floor(Math.random()*Ge)),et+=1;return $};return s(Nt,{isOpen:f,onClose:he,size:"2xl",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(dc,{...D,children:s(zt,{mx:"3",position:"relative",overflow:"hidden",children:[e(Pt,{mt:3,disabled:b}),e(z,{pointerEvents:S?"none":"auto",filter:S?"blur(6px)":"none",transition:"filter 0.2s ease",children:s("form",{onSubmit:D.handleSubmit(W),children:[e(ht,{pt:6,children:s(E,{gap:2,children:[e(gs,{color:"primary",children:g?e(pu,{color:"white"}):e(hu,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:_(g?"userDialog.editUserTitle":"createNewUser")})]})}),s(ut,{children:[g&&q&&s(ur,{status:"info",mb:4,borderRadius:"md",children:[e(hr,{}),_("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(Kt=t==null?void 0:t.service_name)!=null?Kt:""})]}),s(Xa,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(hs,{children:s(oe,{justifyContent:"space-between",children:[s(Tt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(Tt,{flexDirection:"row",w:"full",gap:2,children:s(k,{mb:"10px",children:[e(C,{children:s(Tt,{gap:2,alignItems:"center",children:[_("username"),!g&&e(Yo,{cursor:"pointer",className:ca({"animate-spin":pt}),onClick:()=>{const $=Ze();D.setValue("username",$),setTimeout(()=>{It(!1)},350)}})]})}),s(E,{children:[e(sr,{size:"sm",type:"text",borderRadius:"6px",error:(jt=D.formState.errors.username)==null?void 0:jt.message,disabled:Ne||g,...D.register("username")}),g&&e(E,{px:1,children:e(lt,{name:"status",control:D.control,render:({field:$})=>e(at,{placement:"top",label:"status: "+_(`status.${$.value}`),textTransform:"capitalize",children:e(z,{children:e(ft,{colorScheme:"primary",isChecked:$.value==="active",onChange:_e=>{_e.target.checked?$.onChange("active"):$.onChange("disabled")}})})})})})]})]})}),s(k,{mb:"10px",children:[e(C,{children:_("userDialog.dataLimit")}),e(lt,{control:D.control,name:"data_limit",render:({field:$})=>{var _e;return e(sr,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:$.onChange,disabled:Ne,error:(_e=D.formState.errors.data_limit)==null?void 0:_e.message,value:$.value?String($.value):""})}})]}),e(bn,{in:!!(Oe&&Oe>0),animateOpacity:!0,style:{width:"100%"},children:s(k,{height:"66px",children:[e(C,{children:_("userDialog.periodicUsageReset")}),e(lt,{control:D.control,name:"data_limit_reset_strategy",render:({field:$})=>e(qe,{size:"sm",...$,disabled:Ne,bg:Ne?"gray.100":"transparent",_dark:{bg:Ne?"gray.600":"transparent"},sx:{option:{backgroundColor:U==="dark"?"#222C3B":"white"}},children:Wa.map(_e=>e("option",{value:_e.value,children:_("userDialog.resetStrategy"+_e.title)},_e.value))})})]})}),s(z,{mb:"10px",children:[s(E,{justify:"space-between",align:"center",children:[e(C,{mb:0,children:_("userDialog.nextPlanTitle","Next plan")}),e(ft,{colorScheme:"primary",isChecked:xe,onChange:$=>Z($.target.checked),isDisabled:Ne})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:_("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(bn,{in:xe,animateOpacity:!0,style:{width:"100%"},children:s(oe,{align:"stretch",spacing:3,mt:3,children:[s(k,{children:[e(C,{fontSize:"sm",children:_("userDialog.nextPlanDataLimit","Next plan data limit")}),e(sr,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",disabled:Ne,value:pe!==null&&typeof pe<"u"?String(pe):"",onChange:$=>{const _e=$.target.value;if(!_e){D.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Ge=Number(_e);Number.isNaN(Ge)||D.setValue("next_plan_data_limit",Math.max(0,Ge),{shouldDirty:!0})}})]}),s(k,{children:[e(C,{fontSize:"sm",children:_("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(lt,{control:D.control,name:"next_plan_expire",render:({field:$})=>{const _e=Ge=>{if(!Ge){ie(null),$.onChange(null);return}const et=Number(Ge);if(Number.isNaN(et)||et<0)return;const yt=Math.min(Math.round(et),3650);ie(yt);const H=re(yt);$.onChange(H)};return s(E,{spacing:3,align:{base:"stretch",md:"flex-end"},flexWrap:"wrap",children:[e(z,{flex:"1",minW:"180px",children:e(Yr,{min:0,clampValueOnBlur:!1,value:typeof le=="number"?le:"",onChange:Ge=>_e(Ge),isDisabled:Ne,children:e(qr,{placeholder:_("userDialog.expiryDaysPlaceholder","e.g. 30")})})}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},whiteSpace:"nowrap",children:_("userDialog.days","Days")})]})}})]}),s(E,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:_("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(ft,{size:"sm",colorScheme:"primary",isChecked:Boolean(fe),onChange:$=>D.setValue("next_plan_add_remaining_traffic",$.target.checked,{shouldDirty:!0}),isDisabled:Ne})]}),s(E,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:_("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(ft,{size:"sm",colorScheme:"primary",isChecked:Boolean(K),onChange:$=>D.setValue("next_plan_fire_on_either",$.target.checked,{shouldDirty:!0}),isDisabled:Ne})]})]})})]}),s(k,{mb:"10px",isInvalid:!rt&&Boolean(D.formState.errors.expire),children:[s(Tt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(C,{mb:0,children:rt?_("userDialog.onHoldExpireDuration"):_("userDialog.expiryDaysLabel","Expires in (days)")}),!g&&e(lt,{name:"status",control:D.control,render:({field:$})=>s(E,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:_("userDialog.onHold")}),e(ft,{colorScheme:"primary",isChecked:$.value==="on_hold",onChange:_e=>$.onChange(_e.target.checked?"on_hold":"active"),isDisabled:Ne})]})})]}),rt?e(lt,{control:D.control,name:"on_hold_expire_duration",render:({field:$})=>{var _e;return e(sr,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Ge=>{D.setValue("expire",null),$.onChange({target:{value:Ge}})},disabled:Ne,error:(_e=D.formState.errors.on_hold_expire_duration)==null?void 0:_e.message,value:$.value?String($.value):""})}}):s(Mt,{children:[e(lt,{name:"expire",control:D.control,render:({field:$})=>{const{status:_e,time:Ge}=ga($.value),et=yt=>{if(!yt){se(null),$.onChange(null);return}const H=Number(yt);if(Number.isNaN(H)||H<0)return;const ue=Math.min(Math.round(H),3650);se(ue),D.setValue("on_hold_expire_duration",null,{shouldDirty:!1});const J=re(ue);$.onChange(J)};return s(E,{spacing:3,align:{base:"stretch",md:"flex-end"},flexWrap:"wrap",children:[s(z,{flex:"1",minW:"180px",children:[e(Yr,{min:0,clampValueOnBlur:!1,value:typeof F=="number"?F:"",onChange:yt=>et(yt),isDisabled:Ne,children:e(qr,{placeholder:_("userDialog.expiryDaysPlaceholder","e.g. 30")})}),$.value?e(kr,{children:_(_e,{time:Ge})}):null]}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},whiteSpace:"nowrap",children:_("userDialog.days","Days")})]})}}),e(Br,{children:(Gt=D.formState.errors.expire)==null?void 0:Gt.message})]})]}),s(k,{mb:"10px",isInvalid:!!D.formState.errors.note,children:[e(C,{children:_("userDialog.note")}),e(dr,{...D.register("note")}),e(Br,{children:(Wt=(er=D.formState.errors)==null?void 0:er.note)==null?void 0:Wt.message})]})]}),P&&s(ur,{status:"error",display:{base:"none",md:"flex"},children:[e(hr,{}),P]})]})}),e(hs,{children:s(k,{isRequired:!g,children:[e(C,{children:_("userDialog.selectServiceLabel","Service")}),I?s(E,{spacing:2,py:4,children:[e(kt,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:_("loading")})]}):R?s(oe,{align:"stretch",spacing:3,children:[g&&ve&&s(z,{role:"button",tabIndex:Ne?-1:0,"aria-pressed":N===null,onKeyDown:$=>{Ne||($.key==="Enter"||$.key===" ")&&($.preventDefault(),T(null))},onClick:()=>{Ne||T(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:N===null?"primary.500":"gray.200",bg:N===null?"primary.50":"transparent",cursor:Ne?"not-allowed":"pointer",pointerEvents:Ne?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ne?{}:{borderColor:N===null?"primary.500":"gray.300"},_dark:{borderColor:N===null?"primary.400":"gray.700",bg:N===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:_("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:_("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),ne.map($=>{const _e=N===$.id;return e(z,{role:"button",tabIndex:Ne?-1:0,"aria-pressed":_e,onKeyDown:Ge=>{Ne||(Ge.key==="Enter"||Ge.key===" ")&&(Ge.preventDefault(),T($.id))},onClick:()=>{Ne||T($.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:_e?"primary.500":"gray.200",bg:_e?"primary.50":"transparent",cursor:Ne?"not-allowed":"pointer",pointerEvents:Ne?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ne?{}:{borderColor:_e?"primary.500":"gray.300"},_dark:{borderColor:_e?"primary.400":"gray.700",bg:_e?"primary.900":"transparent"},children:s(E,{justify:"space-between",align:"flex-start",children:[s(oe,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:$.name}),$.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:$.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:_("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:$.host_count,users:$.user_count})})]})},$.id)})]}):s(ur,{status:"warning",borderRadius:"md",children:[e(hr,{}),_("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),de&&e(kr,{mt:2,children:_("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:de.host_count,users:de.user_count})})]})}),g&&be&&e(hs,{pt:6,colSpan:{base:1,md:2},children:s(oe,{gap:4,children:[e(uu,{defaultValue:bt,onChange:($,_e)=>{Ye($),G(_e)}}),e(z,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(Lr,{options:B.options,series:B.series,type:"donut"})})]})})]}),P&&s(ur,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(hr,{}),P]})]}),e(At,{mt:"3",children:s(E,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(E,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:g&&s(Mt,{children:[e(at,{label:_("delete"),placement:"top",children:e(ze,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),he()},children:e(Pn,{})})}),e(at,{label:_("userDialog.usage"),placement:"top",children:e(ze,{"aria-label":"usage",size:"sm",onClick:Ie,children:e(mu,{})})}),e(X,{onClick:we,size:"sm",children:_("userDialog.resetUsage")}),e(X,{onClick:We,size:"sm",children:_("userDialog.revokeSubscription")})]})}),e(E,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(X,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:b?e(kt,{size:"xs"}):void 0,disabled:Ne,children:_(g?"userDialog.editUser":"createUser")})})]})})]})}),S&&s(Tt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(gs,{color:"primary",children:e(gu,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:_("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:v&&v>0?_("userDialog.limitReachedBody",{limit:v,active:x!=null?x:v}):_("userDialog.limitReachedContent")})]})]})})]})},Su=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),xu=t=>{if(!t)return null;const n=new Date(`${t}Z`);return Math.floor(n.getTime()/1e3)},zi=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),r=xu(t);return!t||r===null?e(z,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):n-r<=60?e(z,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(z,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},ku=t=>{if(!t)return null;const n=new Date(t+"Z");return Math.floor(n.getTime()/1e3)},Ri=({lastOnline:t})=>{const n=Math.floor(Date.now()/1e3),r=ku(t),l=r?n-r:null,o=r?ga(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${o.time} ago`:o.time})},Ca=({expiryDate:t,status:n,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:a}=He(),i=ga(t),c=ps[n].icon;return s(Mt,{children:[s(Wr,{colorScheme:ps[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),l&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[n&&a(`status.${n}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(i.status,{time:i.time})})]})},wu=j(Su),Ys={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},vu=j(To,Ys),Cu=j(ha,Ys),Li=j(da,Ys),_u=j(Po,Ys),Du=j(Ao,Ys),Au=j(is,Ys),Iu=j(ha,{baseStyle:{width:"15px",height:"15px"}}),Tu=t=>{for(var n=0;n<Wa.length;n++){const r=Wa[n];if(r.value==t)return r.title}return"No"},Pu=t=>{const{used:n,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o}=t,a=r===0||r===null;return e(E,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:s(h,{children:[Je(n)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Je(r)]})})},Mi=t=>{const{used:n,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o,...a}=t,i=r===0||r===null,c=!i&&n/r*100>=100;return s(Mt,{children:[e(uc,{orientation:"horizontal",value:i?100:Math.min(n/r*100,100),colorScheme:c?"red":"primary",...a,children:e(hc,{h:"6px",borderRadius:"full",children:e(pc,{borderRadius:"full"})})}),s(E,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[s(h,{children:[Je(n)," /"," ",i?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Je(r)+(l&&l!=="no_reset"?" "+Vr("userDialog.resetStrategy"+Tu(l)):"")]}),s(h,{children:[Vr("usersTable.total"),": ",Je(o)]})]})]})},en=({sort:t,column:n})=>t.includes(n)?e(Iu,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,Eu=t=>{const{filters:n,users:{users:r,total:l},onEditingUser:o,onFilterChange:a}=ct(),{t:i}=He(),[c,u]=d.exports.useState(void 0),p=or({base:!1,md:!0}),g=r.length!==l,f=S=>{let b=n.sort;b.includes(S)?b.startsWith("-")?b="-created_at":b="-"+S:b=S,a({sort:b})},v=S=>{a({status:S.target.value.length>0?S.target.value:void 0})},x=S=>{u(S===c?void 0:S)};return s(z,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(Eo,{allowMultiple:!0,display:{base:"block",md:"none"},index:c,children:s(ms,{orientation:"vertical",zIndex:"docked",...t,children:[e(zr,{zIndex:"docked",position:"relative",children:s(Dt,{children:[e(Me,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:f.bind(null,"username"),children:s(E,{children:[e("span",{children:i("users")}),e(en,{sort:n.sort,column:"username"})]})}),e(Me,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:s(E,{spacing:0,position:"relative",children:[s(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[i("usersTable.status"),n.status?": "+n.status:""]}),s(qe,{value:n.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Mt,{}),_focusVisible:{border:"0 !important"},onChange:v,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Me,{minW:"100px",cursor:"pointer",pr:0,onClick:f.bind(null,"used_traffic"),children:s(E,{children:[e("span",{children:i("usersTable.dataUsage")}),e(en,{sort:n.sort,column:"used_traffic"})]})}),e(Me,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(Ir,{children:!p&&(r==null?void 0:r.map((S,b)=>{var w;return s(d.exports.Fragment,{children:[s(Dt,{onClick:x.bind(null,b),cursor:"pointer",children:[e(Re,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:s("div",{className:"flex-status",children:[e(zi,{lastOnline:S.online_at}),e(h,{isTruncated:!0,children:S.username})]})}),e(Re,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Ca,{compact:!0,showDetail:!1,expiryDate:S.expire,status:S.status})}),e(Re,{borderBottom:0,minW:"100px",pr:0,children:e(Pu,{totalUsedTraffic:S.lifetime_used_traffic,dataLimitResetStrategy:S.data_limit_reset_strategy,used:S.used_traffic,total:S.data_limit,colorScheme:ps[S.status].bandWidthColor})}),e(Re,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Cu,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:c===b?"rotate(180deg)":"0deg"})})]}),e(Dt,{className:"collapsible",onClick:x.bind(null,b),children:e(Re,{p:0,colSpan:4,children:s(No,{border:0,children:[e(zo,{display:"none"}),e(Ro,{border:0,cursor:"pointer",px:6,py:3,children:s(oe,{justifyContent:"space-between",spacing:"4",children:[s(oe,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:i("usersTable.dataUsage")}),e(z,{width:"full",minW:"230px",children:e(Mi,{totalUsedTraffic:S.lifetime_used_traffic,dataLimitResetStrategy:S.data_limit_reset_strategy,used:S.used_traffic,total:S.data_limit,colorScheme:ps[S.status].bandWidthColor})})]}),s(oe,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:i("usersTable.service","Service")}),e(h,{fontSize:"sm",color:S.service_name?"gray.700":"gray.500",_dark:{color:S.service_name?"gray.200":"gray.500"},children:(w=S.service_name)!=null?w:i("usersTable.defaultService","Default")})]}),s(E,{w:"full",justifyContent:"space-between",children:[s(z,{width:"full",children:[e(Ca,{compact:!0,expiryDate:S.expire,status:S.status}),e(Ri,{lastOnline:S.online_at})]}),s(E,{children:[e(Ui,{user:S}),e(at,{label:i("userDialog.editUser"),placement:"top",children:e(ze,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:P=>{P.stopPropagation(),o(S)},children:e(Au,{})})})]})]})]})})]})})})]},S.username)}))})]})}),s(ms,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(zr,{position:"relative",zIndex:"docked",children:s(Dt,{children:[e(Me,{minW:"140px",cursor:"pointer",onClick:f.bind(null,"username"),children:s(E,{children:[e("span",{children:i("username")}),e(en,{sort:n.sort,column:"username"})]})}),e(Me,{width:"400px",minW:"150px",cursor:"pointer",children:s(E,{position:"relative",gap:"5px",children:[s(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[i("usersTable.status"),n.status?": "+n.status:""]}),e(h,{children:"/"}),e(en,{sort:n.sort,column:"expire"}),e(E,{onClick:f.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),s(qe,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Mt,{}),_focusVisible:{border:"0 !important"},value:n.sort,onChange:v,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Me,{minW:"150px",children:e("span",{children:i("usersTable.service","Service")})}),e(Me,{width:"350px",minW:"230px",cursor:"pointer",onClick:f.bind(null,"used_traffic"),children:s(E,{children:[e("span",{children:i("usersTable.dataUsage")}),e(en,{sort:n.sort,column:"used_traffic"})]})}),e(Me,{width:"200px",minW:"180px"})]})}),s(Ir,{children:[p&&(r==null?void 0:r.map((S,b)=>{var w;return s(Dt,{className:ca("interactive",{"last-row":b===r.length-1}),onClick:()=>o(S),children:[e(Re,{minW:"140px",children:s("div",{className:"flex-status",children:[e(zi,{lastOnline:S.online_at}),S.username,e(Ri,{lastOnline:S.online_at})]})}),e(Re,{width:"400px",minW:"150px",children:e(Ca,{expiryDate:S.expire,status:S.status})}),e(Re,{minW:"150px",children:e(h,{fontSize:"sm",color:S.service_name?"gray.700":"gray.500",_dark:{color:S.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(w=S.service_name)!=null?w:i("usersTable.defaultService","Default")})}),e(Re,{width:"350px",minW:"230px",children:e(Mi,{totalUsedTraffic:S.lifetime_used_traffic,dataLimitResetStrategy:S.data_limit_reset_strategy,used:S.used_traffic,total:S.data_limit,colorScheme:ps[S.status].bandWidthColor})}),e(Re,{width:"200px",minW:"180px",children:e(Ui,{user:S})})]},S.username)})),r.length==0&&e(Dt,{children:e(Re,{colSpan:4,children:e(Nu,{isFiltered:g})})})]})]})]})},Ui=({user:t})=>{const{setQRCode:n,setSubLink:r}=ct(),l=t.links.join(`\r
`),[o,a]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{o[1]&&setTimeout(()=>{a([-1,!1])},1e3)},[o]),s(E,{justifyContent:"flex-end",onClick:i=>{i.preventDefault(),i.stopPropagation()},children:[e(hi,{text:t.subscription_url.startsWith("/")?window.location.origin+t.subscription_url:t.subscription_url,onCopy:()=>{a([0,!0])},children:e("div",{children:e(at,{label:o[0]==0&&o[1]?Vr("usersTable.copied"):Vr("usersTable.copyLink"),placement:"top",children:e(ze,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==0&&o[1]?e(Li,{}):e(_u,{})})})})}),e(hi,{text:l,onCopy:()=>{a([1,!0])},children:e("div",{children:e(at,{label:o[0]==1&&o[1]?Vr("usersTable.copied"):Vr("usersTable.copyConfigs"),placement:"top",children:e(ze,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==1&&o[1]?e(Li,{}):e(vu,{})})})})}),e(at,{label:"QR Code",placement:"top",children:e(ze,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{n(t.links),r(t.subscription_url)},children:e(Du,{})})})]})},Nu=({isFiltered:t})=>{const{onCreateUser:n}=ct();return s(z,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(wu,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Vr("usersTable.noUserMatched"):Vr("usersTable.noUser")}),!t&&e(X,{size:"sm",colorScheme:"primary",onClick:()=>n(!0),children:Vr("createUser")})]})},zu=()=>{const{t}=He();return d.exports.useEffect(()=>{ct.getState().refetchUsers(),xn()},[]),s(oe,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(Go,{}),e(Eu,{}),e(Xo,{}),e(yu,{}),e(Vd,{}),e(ru,{}),e(nu,{}),e(iu,{})]})},Qt=(t,n,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return n({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return n({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Jt=(t,n)=>n({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),Ru=()=>{var re,F,se,le,ie;const{t}=He(),n=Ut(),{adminInDialog:r,isAdminDialogOpen:l,closeAdminDialog:o,createAdmin:a,updateAdmin:i}=Zr(),c=d.exports.useMemo(()=>r?"edit":"create",[r]),u=d.exports.useMemo(()=>Ee.object({username:c==="create"?Ee.string().trim().min(3,{message:t("admins.validation.usernameMin")}):Ee.string().optional(),password:Ee.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>!I||I.length>=6,t("admins.validation.passwordMin")),telegram_id:Ee.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.telegramNumeric")),is_sudo:Ee.boolean().optional(),data_limit:Ee.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:Ee.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.usersLimitNumeric","Users limit must be a number"))}).superRefine((I,ce)=>{c==="create"&&!I.password&&ce.addIssue({code:Ee.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[c,t]),p=vr({resolver:ua(u),defaultValues:{username:"",password:"",telegram_id:"",is_sudo:!1,data_limit:"",users_limit:""}}),{register:g,handleSubmit:f,reset:v,formState:x,setValue:S,watch:b,setError:w}=p,P=g("is_sudo"),[L,te]=d.exports.useState(!1),_=d.exports.useCallback(ne=>{var Te;const I="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",ce=I.length;if(typeof window<"u"&&((Te=window.crypto)==null?void 0:Te.getRandomValues)){const ve=new Uint32Array(ne);return window.crypto.getRandomValues(ve),Array.from(ve,N=>I[N%ce]).join("")}return Array.from({length:ne},()=>{const ve=Math.floor(Math.random()*ce);return I[ve]}).join("")},[]),U=d.exports.useCallback(()=>{if(c==="edit")return;const ne=_(8);S("username",ne,{shouldDirty:!0,shouldValidate:!0})},[_,c,S]),D=d.exports.useCallback(()=>{const ne=_(12);S("password",ne,{shouldDirty:!0,shouldValidate:!0})},[_,S]),{errors:A,isSubmitting:Ae}=x;d.exports.useEffect(()=>{var ne,I;l&&v({username:(ne=r==null?void 0:r.username)!=null?ne:"",password:"",telegram_id:(r==null?void 0:r.telegram_id)!==void 0&&(r==null?void 0:r.telegram_id)!==null?String(r.telegram_id):"",is_sudo:(I=r==null?void 0:r.is_sudo)!=null?I:!1,data_limit:(r==null?void 0:r.data_limit)!==void 0&&(r==null?void 0:r.data_limit)!==null?String(Math.floor(r.data_limit/(1024*1024*1024))):"",users_limit:(r==null?void 0:r.users_limit)!==void 0&&(r==null?void 0:r.users_limit)!==null?String(r.users_limit):""})},[r,l,v]);const ge=f(async ne=>{var I,ce,Te,ve;if(c==="edit"&&r){const N=(I=r.active_users)!=null?I:0;if(ne.users_limit){const T=Number(ne.users_limit);if(!Number.isNaN(T)&&T>0&&T<N){w("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:N})});return}}}try{if(c==="create"){const N={username:ne.username.trim(),password:(ce=ne.password)!=null?ce:"",is_sudo:(Te=ne.is_sudo)!=null?Te:!1,telegram_id:ne.telegram_id?Number(ne.telegram_id):void 0,data_limit:ne.data_limit?Number(ne.data_limit)*1024*1024*1024:void 0,users_limit:ne.users_limit?Number(ne.users_limit):void 0};await a(N),Jt(t("admins.createSuccess","Admin created"),n)}else if(r){const N={is_sudo:(ve=ne.is_sudo)!=null?ve:!1,telegram_id:ne.telegram_id?Number(ne.telegram_id):void 0,data_limit:ne.data_limit?Number(ne.data_limit)*1024*1024*1024:void 0,users_limit:ne.users_limit?Number(ne.users_limit):void 0};ne.password&&(N.password=ne.password),await i(r.username,N),Jt(t("admins.updateSuccess","Admin updated"),n)}o()}catch(N){Qt(N,n,p)}});return s(Nt,{isOpen:l,onClose:o,size:"lg",children:[e(dt,{}),s(zt,{children:[e(ht,{children:c==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Pt,{}),e(ut,{children:s(oe,{spacing:4,align:"stretch",children:[s(k,{isInvalid:!!A.username,children:[e(C,{children:t("username")}),s(mr,{children:[e(Se,{placeholder:t("admins.usernamePlaceholder","Admin username"),...g("username"),isDisabled:c==="edit"}),c==="create"&&e(wr,{children:e(ze,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(Ua,{width:20}),onClick:U})})]}),e(Br,{children:(re=A.username)==null?void 0:re.message})]}),s(k,{isInvalid:!!A.password,children:[e(C,{children:t("password")}),s(E,{spacing:2,children:[s(mr,{children:[e(Se,{placeholder:t("admins.passwordPlaceholder","Password"),type:L?"text":"password",...g("password")}),e(wr,{children:e(ze,{"aria-label":L?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:L?e(Ya,{width:16}):e(fn,{width:16}),onClick:()=>te(!L)})})]}),e(ze,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(Ua,{width:20}),onClick:D})]}),e(Br,{children:(F=A.password)==null?void 0:F.message}),c==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),e(k,{display:"flex",alignItems:"center",children:s(oe,{align:"start",spacing:1,w:"full",children:[s(E,{justify:"space-between",w:"full",children:[e(C,{htmlFor:"is_sudo",mb:"0",children:t("admins.sudoAccess","Sudo access")}),e(ft,{id:"is_sudo",isChecked:b("is_sudo"),onChange:ne=>S("is_sudo",ne.target.checked,{shouldDirty:!0}),onBlur:P.onBlur,ref:P.ref})]}),e(h,{fontSize:"xs",color:"gray.500",children:t("admins.sudoDescription","Sudo admins can manage other admins.")})]})}),s(k,{isInvalid:!!A.telegram_id,children:[e(C,{children:t("admins.telegramId","Telegram ID")}),e(Se,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...g("telegram_id")}),e(Br,{children:(se=A.telegram_id)==null?void 0:se.message})]}),s(k,{isInvalid:!!A.data_limit,children:[e(C,{children:t("admins.dataLimit","Data Limit (GB)")}),e(Se,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...g("data_limit")}),e(Br,{children:(le=A.data_limit)==null?void 0:le.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),s(k,{isInvalid:!!A.users_limit,children:[e(C,{children:t("admins.usersLimit","Users Limit")}),e(Se,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...g("users_limit")}),e(Br,{children:(ie=A.users_limit)==null?void 0:ie.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})}),e(At,{children:s(E,{spacing:3,children:[e(X,{variant:"ghost",onClick:o,children:t("cancel")}),e(X,{colorScheme:"primary",onClick:ge,isLoading:Ae,children:c==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]})},Lu=()=>{var ne;const{t}=He(),n=Ut(),r=Qe("gray.50","whiteAlpha.100"),l=Qe("primary.50","primary.900"),{admins:o,loading:a,total:i,filters:c,onFilterChange:u,fetchAdmins:p,deleteAdmin:g,resetUsage:f,disableUsers:v,activateUsers:x,openAdminDialog:S,openAdminDetails:b,adminInDetails:w}=Zr(),P=d.exports.useRef(null),{isOpen:L,onOpen:te,onClose:_}=Yt(),[U,D]=d.exports.useState(null),[A,Ae]=d.exports.useState(null),ge=I=>{if(I==="data_usage"||I==="data_limit"){const ce=c.sort===I?`-${I}`:I;u({sort:ce,offset:0})}else{const ce=c.sort===I?`-${I}`:c.sort===`-${I}`?void 0:I;u({sort:ce,offset:0})}},re=I=>{D(I),te()},F=async()=>{if(!!U)try{await g(U.username),Jt(t("admins.deleteSuccess","Admin removed"),n),_(),D(null)}catch(I){Qt(I,n)}},se=async(I,ce)=>{Ae({type:I,username:ce.username});try{I==="reset"?(await f(ce.username),Jt(t("admins.resetUsageSuccess","Usage reset"),n)):I==="disable"?(await v(ce.username),Jt(t("admins.disableUsersSuccess","Users disabled"),n)):I==="activate"&&(await x(ce.username),Jt(t("admins.activateUsersSuccess","Users activated"),n)),p()}catch(Te){Qt(Te,n)}finally{Ae(null)}},le=({column:I})=>{var ve,N,T,R,de;let ce=!1,Te=!1;return I==="data"?(ce=((ve=c.sort)==null?void 0:ve.includes("data_usage"))||((N=c.sort)==null?void 0:N.includes("data_limit")),Te=ce&&((T=c.sort)==null?void 0:T.startsWith("-"))):(ce=(R=c.sort)==null?void 0:R.includes(I),Te=ce&&((de=c.sort)==null?void 0:de.startsWith("-"))),e(ha,{style:{width:"1rem",height:"1rem",opacity:ce?1:0,transform:ce&&!Te?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},ie=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return a&&!o.length?e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(kt,{})}):i?s(Mt,{children:[e(z,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:s(ms,{variant:"simple",size:"sm",minW:"640px",children:[e(zr,{children:e(Dt,{children:ie.map(I=>e(Me,{onClick:()=>I.key==="username"||I.key==="users_count"||I.key==="data"?ge(I.key):void 0,cursor:I.key==="username"||I.key==="users_count"||I.key==="data"?"pointer":"default",textAlign:I.key==="actions"?"right":"left",children:s(E,{justify:I.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:I.label}),I.key==="data"?s(ta,{children:[e(ra,{as:ze,size:"xs",variant:"ghost",icon:e(le,{column:"data"})}),s(sa,{children:[e(Zt,{onClick:()=>ge("data_usage"),children:t("admins.sortByUsage")}),e(Zt,{onClick:()=>ge("data_limit"),children:t("admins.sortByLimit")})]})]}):I.key==="username"||I.key==="users_count"?e(le,{column:I.key}):null]})},I.key))})}),e(Ir,{children:o.map(I=>{var N,T;const ce=(w==null?void 0:w.username)===I.username,Te=I.users_limit&&I.users_limit>0?String(I.users_limit):"\u221E",ve=`${(N=I.active_users)!=null?N:0}/${Te}`;return s(Dt,{onClick:()=>b(I),cursor:"pointer",bg:ce?l:void 0,_hover:{bg:r},transition:"background-color 0.15s ease-in-out",children:[s(Re,{children:[e(h,{fontWeight:"medium",children:I.username}),I.is_sudo&&e(Wr,{colorScheme:"purple",fontSize:"xs",mt:1,children:t("sudo")})]}),e(Re,{children:s(h,{whiteSpace:"nowrap",children:[Je((T=I.users_usage)!=null?T:0,2)," /"," ",I.data_limit?Je(I.data_limit,2):"-"]})}),e(Re,{children:s(Ce,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:ve})]})}),e(Re,{textAlign:"right",children:s(ta,{children:[e(ra,{as:ze,icon:e(mc,{width:20}),variant:"ghost",onClick:R=>R.stopPropagation()}),s(sa,{onClick:R=>R.stopPropagation(),children:[e(Zt,{icon:e(is,{width:20}),onClick:R=>{R.stopPropagation(),S(I)},children:t("edit")}),e(Zt,{icon:e(Or,{width:20}),onClick:R=>{R.stopPropagation(),se("reset",I)},isDisabled:(A==null?void 0:A.username)===I.username,children:t("admins.resetUsage")}),e(na,{}),e(Zt,{icon:e(gc,{width:20}),onClick:R=>{R.stopPropagation(),se("activate",I)},isDisabled:(A==null?void 0:A.username)===I.username,children:t("admins.activateUsers")}),e(Zt,{icon:e(fc,{width:20}),onClick:R=>{R.stopPropagation(),se("disable",I)},isDisabled:(A==null?void 0:A.username)===I.username,children:t("admins.disableUsers")}),e(na,{}),e(Zt,{color:"red.500",icon:e(Ur,{width:20}),onClick:R=>{R.stopPropagation(),re(I)},children:t("delete")})]})]})})]},I.username)})})]})}),e(yn,{isOpen:L,leastDestructiveRef:P,onClose:_,children:e(dt,{children:s(Sn,{children:[e(ht,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(ut,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(ne=U==null?void 0:U.username)!=null?ne:""})}),s(At,{children:[e(X,{ref:P,onClick:_,children:t("cancel")}),e(X,{colorScheme:"red",onClick:F,ml:3,children:t("delete")})]})]})})})]}):e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},Mu=(t,n)=>!t||t<=0?n!=null?n:"\u221E":`${t}`,_a=(t,n)=>!t||t<=0?n!=null?n:"\u221E":Je(t,2),Uu=()=>{var P,L,te,_,U,D,A,Ae,ge,re;const{t}=He(),{isAdminDetailsOpen:n,adminInDetails:r,closeAdminDetails:l}=Zr(F=>({isAdminDetailsOpen:F.isAdminDetailsOpen,adminInDetails:F.adminInDetails,closeAdminDetails:F.closeAdminDetails})),o=Qe("gray.50","whiteAlpha.50"),a=(P=r==null?void 0:r.active_users)!=null?P:0,i=(L=r==null?void 0:r.users_limit)!=null?L:null,c=t("admins.details.unlimited","Unlimited"),u=i&&i>0?String(i):c,p=(te=r==null?void 0:r.users_count)!=null?te:0,g=(_=r==null?void 0:r.limited_users)!=null?_:0,f=(U=r==null?void 0:r.expired_users)!=null?U:0,v=(D=r==null?void 0:r.online_users)!=null?D:0,x=(A=r==null?void 0:r.users_usage)!=null?A:0,S=(Ae=r==null?void 0:r.data_limit)!=null?Ae:null,b=S&&S>0?Math.max(S-x,0):null,w=(ge=r==null?void 0:r.lifetime_usage)!=null?ge:null;return s(ko,{isOpen:n,placement:"right",size:"md",onClose:l,children:[e(dt,{}),s(wo,{children:[e(Pt,{}),e(ht,{bg:o,children:s(Ce,{spacing:1,children:[s(E,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(re=r==null?void 0:r.username)!=null?re:t("admins.details.title","Admin details")}),(r==null?void 0:r.is_sudo)&&e(z,{as:"span",fontSize:"xs",px:2,py:.5,borderRadius:"full",bg:"purple.500",color:"white",children:t("admins.sudoBadge","Sudo")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:a,limit:u})})]})}),e(ut,{children:r?s(Ce,{spacing:8,children:[s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),s(Ve,{columns:{base:2,md:3},spacing:4,children:[e(Pr,{label:t("admins.details.activeLabel","Active"),value:String(a)}),e(Pr,{label:t("admins.details.onlineLabel","Online"),value:String(v)}),e(Pr,{label:t("admins.details.limitedLabel","Limited"),value:String(g)}),e(Pr,{label:t("admins.details.expiredLabel","Expired"),value:String(f)}),e(Pr,{label:t("admins.details.totalUsers","Total users"),value:String(p)}),e(Pr,{label:t("admins.details.usersLimit","Users limit"),value:Mu(i,c)})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),s(Ve,{columns:{base:2,md:4},spacing:4,children:[e(Pr,{label:t("admins.details.used","Used"),value:Je(x,2)}),e(Pr,{label:t("admins.details.limit","Limit"),value:_a(S,c)}),e(Pr,{label:t("admins.details.remaining","Remaining"),value:_a(b,c)}),e(Pr,{label:t("admins.details.lifetime","Lifetime usage"),value:_a(w,void 0)})]})]})]}):e(z,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(At,{children:e(X,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},Pr=({label:t,value:n})=>s(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:n})]}),Ou=()=>{const{t}=He(),n=Zr(a=>a.fetchAdmins),{userData:r,getUserIsSuccess:l}=Ss(),o=l&&r.is_sudo;return d.exports.useEffect(()=>{o&&n()},[n,o]),o?s(oe,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(Go,{for:"admins"}),e(Lu,{}),e(Xo,{for:"admins"}),e(Ru,{}),e(Uu,{})]}):s(oe,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},Qo=Ks(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),De("/hosts").then(n=>t({hosts:n})).finally(()=>t({isLoading:!1}))},setHosts:n=>(t({isPostLoading:!0}),De("/hosts",{method:"PUT",body:n}).finally(()=>{t({isPostLoading:!1})}))})),Wu=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Fu=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],Hu=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Bu=j(is,{baseStyle:{w:4,h:4}}),Zo=j(Xr,{baseStyle:{w:4,h:4}}),jo=j(xo,{baseStyle:{w:4,h:4}}),Vu=j(vn,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Ku=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],Ws=()=>{const{t}=He();return s(Cn,{isLazy:!0,placement:"right",children:[e(_n,{children:e(z,{mt:"-1",children:e(Vu,{})})}),e(yc,{children:s(Dn,{maxW:"xs",fontSize:"xs",children:[e(An,{}),e(Mo,{}),e(In,{children:s(z,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),Ku.map(({token:n,labelKey:r})=>s(h,{mt:1,children:[e(Wr,{mr:2,children:n}),t(r)]},n))]})})]})})]})},el=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,xr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,Rr=t=>(t!=null?t:"").trim(),tn=(t,n=!1)=>typeof t=="boolean"?t:n,$u=(t,n)=>{var r,l,o,a,i,c,u,p;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(o=t.address)!=null?o:"",sort:(a=t.sort)!=null?a:n,port:(i=t.port)!=null?i:null,path:Rr(t.path),sni:Rr(t.sni),host:Rr(t.host),mux_enable:tn(t.mux_enable),allowinsecure:tn(t.allowinsecure),is_disabled:tn(t.is_disabled,!1),fragment_setting:Rr(t.fragment_setting),noise_setting:Rr(t.noise_setting),random_user_agent:tn(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:tn(t.use_sni_as_host)}},Fa=t=>{var n,r;return{id:(n=t.id)!=null?n:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},Oi=t=>{var n,r;return{...t,id:(n=t.id)!=null?n:null,port:(r=t.port)!=null?r:null,path:Rr(t.path),sni:Rr(t.sni),host:Rr(t.host),fragment_setting:Rr(t.fragment_setting),noise_setting:Rr(t.noise_setting)}},tl=t=>{const n=Oi(t.data),r=Oi(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(n)!==JSON.stringify(r)},Ju=t=>{var n;return{id:(n=t.id)!=null?n:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},hn=t=>[...t].sort((n,r)=>{const l=xr(n.data.sort)-xr(r.data.sort);return l!==0?l:n.data.remark.localeCompare(r.data.remark)}),qu=t=>{const n=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((o,a)=>{const i=$u(o,a),c=i.id!=null?`host-${i.id}`:el();n.push({uid:c,inboundTag:r,initialInboundTag:r,data:Fa(i),original:Fa(i)})})}),hn(n)},rl=t=>{const n=new Map;t.forEach(l=>{var a;const o=(a=n.get(l.inboundTag))!=null?a:[];o.push(l.data),n.set(l.inboundTag,o)});const r={};return n.forEach((l,o)=>{r[o]=l.map(a=>Ju(a)).sort((a,i)=>xr(a.sort)-xr(i.sort))}),r},Da=(t,n)=>{const r=rl(t),l=Array.from(new Set(n)),o={};return l.forEach(a=>{var i;o[a]=(i=r[a])!=null?i:[]}),o},Yu=({host:t,inboundOptions:n,orderIndex:r,onToggleActive:l,onEdit:o,onDelete:a,saving:i,deleting:c})=>{const{t:u}=He(),p=n.find(x=>x.value===t.inboundTag),g=!t.data.is_disabled,f=tl(t),v=t.data.remark||u("hostsPage.untitledHost");return e(Mr,{borderWidth:"1px",borderColor:f?"primary.400":"gray.200",_dark:{borderColor:f?"primary.300":"gray.700",bg:f?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>o(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:s($r,{as:Ce,spacing:4,children:[s(E,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(oe,{align:"flex-start",spacing:1,flex:"1",children:[e(at,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:v})}),s(E,{spacing:2,flexWrap:"wrap",children:[e(tt,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),p&&e(tt,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(tt,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),f&&e(tt,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),s(E,{spacing:2,children:[e(ft,{size:"sm",colorScheme:"primary",isChecked:g,onChange:x=>{x.stopPropagation(),l(t.uid,x.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(g?"hostsPage.enabled":"hostsPage.disabled")})]})]}),s(oe,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),s(E,{justify:"space-between",children:[e(X,{size:"sm",variant:"outline",leftIcon:e(Bu,{}),onClick:x=>{x.stopPropagation(),o(t.uid)},isLoading:i,children:u("hostsPage.edit")}),e(ze,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:x=>{x.stopPropagation(),a(t.uid)},icon:e(Pn,{}),isLoading:c})]})]})})},Gu=({host:t,index:n})=>{const{t:r}=He(),l=bc(),o=t.data.remark||r("hostsPage.untitledHost"),a=d.exports.useCallback(i=>{i.pointerType==="mouse"&&i.button!==0||(i.preventDefault(),l.start(i))},[l]);return e(Lo.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:s(E,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(at,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(ze,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(jo,{}),cursor:"grab",onPointerDown:a,style:{touchAction:"none"}})}),e(tt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:n+1})}),s(oe,{align:"flex-start",spacing:0,flex:"1",children:[e(at,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:o})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Xu=({host:t,inboundOptions:n,isOpen:r,onClose:l,onChange:o,onChangeInbound:a,onSave:i,onReset:c,onDelete:u,saving:p,deleting:g})=>{var S;const{t:f}=He();if(!t)return null;const v=n.find(b=>b.value===t.inboundTag),x=tl(t);return s(Nt,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,children:[e(dt,{}),s(zt,{children:[e(Pt,{}),e(ht,{pb:1,children:s(oe,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||f("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||f("hostsPage.noAddress")}),v&&e(tt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${v.value} (${v.protocol.toUpperCase()} - ${v.network})`})]})}),e(ut,{children:s(oe,{align:"stretch",spacing:5,children:[s(Mr,{variant:"outline",children:[e(Ms,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.general")})}),e($r,{pt:0,children:s(oe,{align:"stretch",spacing:4,children:[s(k,{children:[e(C,{children:f("hostsDialog.remark")}),s(mr,{children:[e(Se,{value:t.data.remark,onChange:b=>o(t.uid,"remark",b.target.value)}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:f("hostsPage.inboundLabel")}),e(qe,{value:t.inboundTag,onChange:b=>a(t.uid,b.target.value),children:n.map(b=>e("option",{value:b.value,children:b.label},b.value))})]}),s(k,{children:[e(C,{children:f("hostsDialog.sort")}),e(Yr,{value:t.data.sort,allowMouseWheel:!0,onChange:(b,w)=>o(t.uid,"sort",Number.isNaN(w)?t.data.sort:w),children:e(qr,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:f("hostsDialog.address")}),s(mr,{children:[e(Se,{value:t.data.address,onChange:b=>o(t.uid,"address",b.target.value)}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(k,{children:[e(C,{children:f("hostsDialog.port")}),e(Yr,{value:(S=t.data.port)!=null?S:"",allowMouseWheel:!0,onChange:(b,w)=>o(t.uid,"port",Number.isNaN(w)?null:w),children:e(qr,{})})]})]}),s(k,{children:[e(C,{children:f("hostsDialog.path")}),e(Se,{value:t.data.path,onChange:b=>o(t.uid,"path",b.target.value),placeholder:"/"})]})]})})]}),s(Mr,{variant:"outline",children:[e(Ms,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.security")})}),e($r,{pt:0,children:s(oe,{align:"stretch",spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:f("hostsDialog.sni")}),e(Se,{value:t.data.sni,onChange:b=>o(t.uid,"sni",b.target.value)})]}),s(k,{children:[e(C,{children:f("hostsDialog.host")}),s(mr,{children:[e(Se,{value:t.data.host,onChange:b=>o(t.uid,"host",b.target.value)}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]})]}),s(Ve,{columns:{base:1,md:3},spacing:4,children:[s(k,{children:[e(C,{children:f("hostsDialog.security")}),e(qe,{value:t.data.security,onChange:b=>o(t.uid,"security",b.target.value),children:Wu.map(b=>e("option",{value:b.value,children:b.title},b.value))})]}),s(k,{children:[e(C,{children:f("hostsDialog.alpn")}),e(qe,{value:t.data.alpn,onChange:b=>o(t.uid,"alpn",b.target.value),children:Fu.map(b=>e("option",{value:b.value,children:b.title},b.value))})]}),s(k,{children:[e(C,{children:f("hostsDialog.fingerprint")}),e(qe,{value:t.data.fingerprint,onChange:b=>o(t.uid,"fingerprint",b.target.value),children:Hu.map(b=>e("option",{value:b.value,children:b.title},b.value))})]})]})]})})]}),s(Mr,{variant:"outline",children:[e(Ms,{pb:2,children:e(h,{fontWeight:"semibold",children:f("hostsPage.section.advanced")})}),e($r,{pt:0,children:s(oe,{align:"stretch",spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:f("hostsDialog.fragment")}),e(Se,{value:t.data.fragment_setting,onChange:b=>o(t.uid,"fragment_setting",b.target.value)})]}),s(k,{children:[e(C,{children:f("hostsDialog.noise")}),e(Se,{value:t.data.noise_setting,onChange:b=>o(t.uid,"noise_setting",b.target.value)})]})]}),s(Ce,{direction:{base:"column",md:"row"},spacing:4,children:[e(pr,{isChecked:t.data.allowinsecure,onChange:b=>o(t.uid,"allowinsecure",b.target.checked),children:f("hostsDialog.allowinsecure")}),e(pr,{isChecked:t.data.mux_enable,onChange:b=>o(t.uid,"mux_enable",b.target.checked),children:f("hostsDialog.muxEnable")}),e(pr,{isChecked:t.data.random_user_agent,onChange:b=>o(t.uid,"random_user_agent",b.target.checked),children:f("hostsDialog.randomUserAgent")}),e(pr,{isChecked:t.data.use_sni_as_host,onChange:b=>o(t.uid,"use_sni_as_host",b.target.checked),children:f("hostsDialog.useSniAsHost")})]})]})})]})]})}),s(At,{justifyContent:"space-between",children:[e(X,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(Pn,{}),onClick:()=>u(t.uid),isLoading:g,children:f("hostsPage.delete")}),s(E,{spacing:3,children:[e(X,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!x||p,children:f("hostsPage.reset")}),e(X,{size:"sm",colorScheme:"primary",onClick:()=>i(t.uid),isDisabled:!x,isLoading:p,children:f("hostsPage.save")})]})]})]})]})},Qu=({isOpen:t,onClose:n,inboundOptions:r,onSubmit:l,isSubmitting:o,defaultSort:a})=>{var f,v,x,S;const{t:i}=He(),c=d.exports.useRef(null),[u,p]=d.exports.useState({inboundTag:(v=(f=r[0])==null?void 0:f.value)!=null?v:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var b,w;t&&(p({inboundTag:(w=(b=r[0])==null?void 0:b.value)!=null?w:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var P;return(P=c.current)==null?void 0:P.focus()},150))},[a,r,t]);const g=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return s(Nt,{isOpen:t,onClose:n,size:"lg",initialFocusRef:c,children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(zt,{children:[e(ht,{children:s(E,{spacing:3,children:[e(Zo,{}),e(h,{fontWeight:"semibold",children:i("hostsPage.create.title")})]})}),e(Pt,{mt:2}),s(ut,{as:oe,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:i("hostsPage.create.description")}),s(k,{children:[e(C,{children:i("hostsPage.inboundLabel")}),e(qe,{value:u.inboundTag,onChange:b=>p(w=>({...w,inboundTag:b.target.value})),children:r.map(b=>e("option",{value:b.value,children:b.label},b.value))})]}),s(k,{isRequired:!0,children:[e(C,{children:i("hostsDialog.remark")}),s(mr,{children:[e(Se,{ref:c,value:u.remark,onChange:b=>p(w=>({...w,remark:b.target.value}))}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{isRequired:!0,children:[e(C,{children:i("hostsDialog.address")}),s(mr,{children:[e(Se,{value:u.address,onChange:b=>p(w=>({...w,address:b.target.value}))}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(k,{children:[e(C,{children:i("hostsDialog.port")}),e(Yr,{value:(x=u.port)!=null?x:"",onChange:(b,w)=>p(P=>({...P,port:Number.isNaN(w)?null:w})),children:e(qr,{})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("hostsDialog.path")}),e(Se,{value:u.path,onChange:b=>p(w=>({...w,path:b.target.value}))})]}),s(k,{children:[e(C,{children:i("hostsDialog.sni")}),e(Se,{value:u.sni,onChange:b=>p(w=>({...w,sni:b.target.value}))})]})]}),s(k,{children:[e(C,{children:i("hostsDialog.host")}),s(mr,{children:[e(Se,{value:u.host,onChange:b=>p(w=>({...w,host:b.target.value}))}),e(wr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Ws,{})})]})]}),s(k,{children:[e(C,{children:i("hostsDialog.sort")}),e(Yr,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(b,w)=>p(P=>({...P,sort:Number.isNaN(w)?P.sort:w})),children:e(qr,{})})]}),e(z,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:i("hostsPage.create.sortHint",{value:(S=u.sort)!=null?S:a})})]}),s(At,{gap:2,children:[e(X,{variant:"ghost",onClick:n,children:i("hostsPage.cancel")}),e(X,{colorScheme:"primary",onClick:g,isLoading:o,children:i("hostsPage.create.submit")})]})]})]})},Zu=()=>{var Ye;const{t}=He(),n=Ut(),{hosts:r,fetchHosts:l,isLoading:o,isPostLoading:a,setHosts:i}=Qo(),{inbounds:c}=ct(),[u,p]=d.exports.useState([]),g=d.exports.useRef([]),f=d.exports.useCallback(G=>{typeof G=="function"?p(W=>{const he=G(W);return g.current=he,he}):(g.current=G,p(G))},[]),[v,x]=d.exports.useState(null),[S,b]=d.exports.useState(!1),[w,P]=d.exports.useState(!1),[L,te]=d.exports.useState(null),[_,U]=d.exports.useState(null),[D,A]=d.exports.useState(null),[Ae,ge]=d.exports.useState(null),re=d.exports.useRef(null),[F,se]=d.exports.useState(!1),le=d.exports.useRef(!1),[ie,ne]=d.exports.useState(!1),[I,ce]=d.exports.useState(!1),[Te,ve]=d.exports.useState(null);d.exports.useEffect(()=>{l()},[l]),d.exports.useEffect(()=>{c.size||xn()},[c]),d.exports.useEffect(()=>{const G=qu(r);f(G)},[r,f]),d.exports.useEffect(()=>{if(Ae){const G=g.current.find(W=>W.inboundTag===Ae.inboundTag&&W.data.remark.trim()===Ae.remark&&W.data.address.trim()===Ae.address);G&&(x(G.uid),ge(null))}},[u,Ae]),d.exports.useEffect(()=>{v&&!g.current.some(G=>G.uid===v)&&!Ae&&x(null)},[u,v,Ae]);const N=d.exports.useCallback(G=>{le.current=G,se(G)},[]);d.exports.useEffect(()=>{I||(ve(null),N(!1))},[S,I,N]),d.exports.useEffect(()=>{if(!I||!Te)return;const G=new Set(g.current.map(he=>he.uid));Te.every(he=>G.has(he.uid))||(ve(null),N(!1))},[u,I,N,Te]);const T=d.exports.useMemo(()=>{const G=[];return c.forEach(W=>{W.forEach(he=>{G.push({label:`${he.tag} (${he.protocol.toUpperCase()} - ${he.network})`,value:he.tag,protocol:he.protocol,network:he.network})})}),G.sort((W,he)=>W.label.localeCompare(he.label))},[c]),R=d.exports.useMemo(()=>g.current.filter(G=>!G.data.is_disabled).sort((G,W)=>xr(G.data.sort)-xr(W.data.sort)),[u]),de=d.exports.useMemo(()=>[...g.current].sort((G,W)=>xr(G.data.sort)-xr(W.data.sort)),[u]),q=d.exports.useMemo(()=>S?de:R,[R,de,S]);d.exports.useEffect(()=>{I&&ve(G=>G!=null?G:[...R])},[R,I]);const be=I?Te!=null?Te:R:q,Pe=d.exports.useMemo(()=>{const G=new Map;return be.forEach((W,he)=>G.set(W.uid,he)),G},[be]),Ie=v&&(Ye=g.current.find(G=>G.uid===v))!=null?Ye:null,Oe=(G,W,he)=>{f(we=>hn(we.map(We=>We.uid===G?{...We,data:{...We.data,[W]:he}}:We)))},Q=(G,W)=>{f(he=>hn(he.map(we=>we.uid===G?{...we,inboundTag:W}:we)))},xe=d.exports.useCallback(async()=>{if(!I||ie)return!1;const G=R,W=Te!=null?Te:G;if(!(W.length!==G.length||W.some((Ze,mt)=>{var vt;return Ze.uid!==((vt=G[mt])==null?void 0:vt.uid)}))||!Te||W.length===0)return ce(!1),ve(null),N(!1),!0;const we=W.map(Ze=>Ze.uid),We=new Map;we.forEach((Ze,mt)=>We.set(Ze,mt));const Ne=g.current,rt=g.current.filter(Ze=>We.has(Ze.uid)).sort((Ze,mt)=>{var vt,Rt;return((vt=We.get(Ze.uid))!=null?vt:Number.MAX_SAFE_INTEGER)-((Rt=We.get(mt.uid))!=null?Rt:Number.MAX_SAFE_INTEGER)}),pt=g.current.filter(Ze=>!We.has(Ze.uid)).sort((Ze,mt)=>xr(Ze.data.sort)-xr(mt.data.sort)),It=[...rt,...pt].map((Ze,mt)=>({...Ze,data:{...Ze.data,sort:mt},original:{...Ze.original,sort:mt}}));f(It),ve(It.filter(Ze=>!Ze.data.is_disabled)),ne(!0);try{const Ze=rl(It);return await i(Ze),await l(),N(!1),ce(!1),ve(null),n({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{f(Ne);const mt=Ne.filter(vt=>!vt.data.is_disabled).sort((vt,Rt)=>xr(vt.data.sort)-xr(Rt.data.sort));return ve(mt),N(!0),n({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{ne(!1)}},[f,R,l,I,ie,i,N,t,n,Te]),Y=d.exports.useCallback(G=>{if(!I||!G.length)return;const W=Te!=null?Te:R;!(G.length!==W.length||G.some((we,We)=>{var Ne;return we.uid!==((Ne=W[We])==null?void 0:Ne.uid)}))||(ve(G),le.current||N(!0))},[R,I,N,Te]),pe=d.exports.useCallback(()=>{ve([...R]),N(!1),ce(!0)},[R,N]),O=d.exports.useCallback(()=>{ce(!1),ve(null),N(!1)},[N]),fe=d.exports.useCallback(()=>{xe()},[xe]),K=async G=>{const W=g.current.find(he=>he.uid===G);if(!!W){te(G),ge({inboundTag:W.inboundTag,remark:W.data.remark.trim(),address:W.data.address.trim()});try{const he=Da(g.current,[W.inboundTag,W.initialInboundTag]);await i(he),await l(),n({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"})}catch{n({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{te(null)}}},Z=G=>{f(W=>hn(W.map(he=>he.uid===G?{...he,inboundTag:he.initialInboundTag,data:Fa(he.original)}:he)))},ee=(G,W)=>{Oe(G,"is_disabled",!W),W||b(!0)},B=G=>{A(G)},ke=async()=>{if(!D)return;const G=g.current.find(W=>W.uid===D);if(!!G){U(D);try{const W=g.current.filter(we=>we.uid!==D);f(W);const he=Da(W,[G.inboundTag,G.initialInboundTag]);await i(he),await l(),n({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),v===D&&x(null)}catch{n({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{U(null),A(null)}}},bt=async G=>{const W=g.current.length?Math.max(...g.current.map(he=>he.data.sort))+1:0;te("create"),ge({inboundTag:G.inboundTag,remark:G.remark.trim(),address:G.address.trim()});try{const he={uid:el(),inboundTag:G.inboundTag,initialInboundTag:G.inboundTag,data:{id:null,remark:G.remark,address:G.address,sort:Number.isFinite(G.sort)?G.sort:W,port:G.port,path:G.path,sni:G.sni,host:G.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:G.remark,address:G.address,sort:Number.isFinite(G.sort)?G.sort:W,port:G.port,path:G.path,sni:G.sni,host:G.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},we=hn([...g.current,he]);f(we);const We=Da(we,[G.inboundTag]);await i(We),await l(),n({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),P(!1)}catch{n({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{te(null)}};return s(oe,{align:"stretch",spacing:4,children:[I?s(oe,{align:"stretch",spacing:2,children:[s(E,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),s(E,{spacing:2,children:[e(X,{variant:"ghost",onClick:O,isDisabled:ie,children:t("hostsPage.cancel")}),e(X,{colorScheme:"primary",onClick:fe,isLoading:ie,isDisabled:!F&&!ie,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),ie?s(E,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(kt,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):F?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):s(E,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(E,{spacing:3,children:[e(X,{colorScheme:"primary",size:"sm",onClick:()=>P(!0),leftIcon:e(Zo,{}),isDisabled:!T.length,children:t("hostsPage.addHost")}),e(ft,{isChecked:S,onChange:G=>b(G.target.checked),children:t("hostsPage.showDisabled")})]}),e(X,{size:"sm",variant:"outline",leftIcon:e(jo,{}),onClick:pe,isDisabled:o||!R.length,children:t("hostsPage.enterSort")})]}),o?e(E,{justify:"center",py:10,children:e(kt,{})}):be.length===0?e(z,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t("hostsPage.emptyState")})}):I?e(Lo.Group,{axis:"y",values:be,onReorder:Y,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:be.map((G,W)=>e(Gu,{host:G,index:W},G.uid))}):e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:q.map((G,W)=>{var he;return e(Yu,{host:G,inboundOptions:T,orderIndex:(he=Pe.get(G.uid))!=null?he:W,onToggleActive:ee,onEdit:x,onDelete:B,saving:L===G.uid&&a,deleting:_===G.uid&&a},G.uid)})}),e(Qu,{isOpen:w,onClose:()=>P(!1),inboundOptions:T,onSubmit:bt,isSubmitting:L==="create"&&a,defaultSort:g.current.length?Math.max(...g.current.map(G=>G.data.sort))+1:0}),e(Xu,{host:Ie,inboundOptions:T,isOpen:Boolean(Ie),onClose:()=>x(null),onChange:Oe,onChangeInbound:Q,onSave:K,onReset:Z,onDelete:B,saving:!!Ie&&L===Ie.uid&&a,deleting:!!Ie&&_===Ie.uid&&a}),e(yn,{isOpen:Boolean(D),leastDestructiveRef:re,onClose:()=>A(null),children:e(dt,{children:s(Sn,{children:[e(ht,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(ut,{children:t("hostsPage.deleteConfirmation")}),s(At,{children:[e(X,{ref:re,onClick:()=>A(null),children:t("hostsPage.cancel")}),e(X,{colorScheme:"red",onClick:ke,ml:3,isLoading:Boolean(_),children:t("hostsPage.delete")})]})]})})})]})},ju=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),Wi=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(ju(t))}catch{}return""},eh=t=>{if(typeof t!="string"||t.length===0)return"";const n=globalThis.Wireguard;if(n!=null&&n.generateKeypair)try{const r=n.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class cr{static isEmpty(n){return n==null?!0:typeof n=="string"?n.trim().length===0:Array.isArray(n)?n.length===0:typeof n=="object"?Object.keys(n).length===0:!1}static isArrEmpty(n){return!Array.isArray(n)||n.length===0}}const ae=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),sl=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const th=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),rh=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const sh=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Aa=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class ot{static toJsonArray(n){return n.map(r=>r.toJson())}static fromJson(n){return new ot}toJson(){return{}}toString(n=!0){const r=this.toJson();return n?JSON.stringify(r,null,2):JSON.stringify(r)}}class Jr extends ot{constructor(r="none",l="",o=""){super();V(this,"type");V(this,"host");V(this,"path");this.type=r,this.host=l,this.path=o}static fromJson(r={}){var o,a,i,c,u,p,g,f,v,x;const l=r==null?void 0:r.header;if(!l)return new Jr;if(l.type==="http"&&l.request){const S=((a=(o=l.request)==null?void 0:o.headers)==null?void 0:a.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(c=(i=l.request)==null?void 0:i.headers)==null?void 0:c.Host)!=null?u:"",b=((p=l.request)==null?void 0:p.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(f=(g=l.request)==null?void 0:g.path)!=null?f:"";return new Jr((v=l.type)!=null?v:"http",S,b)}return new Jr((x=l.type)!=null?x:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:cr.isEmpty(this.host)?[]:this.host.split(",")},path:cr.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class Fs extends ot{constructor(r=1350,l=50,o=5,a=20,i=!1,c=2,u=2,p="none",g=""){super();V(this,"mtu");V(this,"tti");V(this,"upCap");V(this,"downCap");V(this,"congestion");V(this,"readBuffer");V(this,"writeBuffer");V(this,"type");V(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=o!=null?o:5,this.downCap=a!=null?a:20,this.congestion=Boolean(i),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=p!=null?p:"none",this.seed=g!=null?g:""}static fromJson(r={}){var l,o,a;return new Fs(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(o=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?o:"none",(a=r==null?void 0:r.seed)!=null?a:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class fs extends ot{constructor(r="/",l="",o=0){super();V(this,"path");V(this,"host");V(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=o!=null?o:0}static fromJson(r={}){var l,o,a;return new fs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(a=r==null?void 0:r.heartbeatPeriod)!=null?a:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class bs extends ot{constructor(r="",l="",o=!1){super();V(this,"serviceName");V(this,"authority");V(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(o)}static fromJson(r={}){var l,o;return new bs((l=r==null?void 0:r.serviceName)!=null?l:"",(o=r==null?void 0:r.authority)!=null?o:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class Hs extends ot{constructor(r="/",l=""){super();V(this,"path");V(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,o;return new Hs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"")}toJson(){return{path:this.path,host:this.host}}}class Bs extends ot{constructor(r="/",l="",o="",a=!1,i="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,p,g,f,v,x;super();V(this,"path");V(this,"host");V(this,"mode");V(this,"noGRPCHeader");V(this,"scMinPostsIntervalMs");V(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=o!=null?o:"",this.noGRPCHeader=Boolean(a),this.scMinPostsIntervalMs=i!=null?i:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(g=c==null?void 0:c.cMaxReuseTimes)!=null?g:0,hMaxRequestTimes:(f=c==null?void 0:c.hMaxRequestTimes)!=null?f:"600-900",hMaxReusableSecs:(v=c==null?void 0:c.hMaxReusableSecs)!=null?v:"1800-3000",hKeepAlivePeriod:(x=c==null?void 0:c.hKeepAlivePeriod)!=null?x:0}}static fromJson(r={}){var l,o,a,i;return new Bs((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(a=r==null?void 0:r.mode)!=null?a:"",Boolean(r==null?void 0:r.noGRPCHeader),(i=r==null?void 0:r.scMinPostsIntervalMs)!=null?i:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class ys extends ot{constructor(r="",l=[],o="",a=!1,i=""){super();V(this,"serverName");V(this,"alpn");V(this,"fingerprint");V(this,"allowInsecure");V(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=o!=null?o:"",this.allowInsecure=Boolean(a),this.echConfigList=i!=null?i:""}static fromJson(r={}){var l,o,a;return new ys((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(o=r==null?void 0:r.fingerprint)!=null?o:"",Boolean(r==null?void 0:r.allowInsecure),(a=r==null?void 0:r.echConfigList)!=null?a:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class Vs extends ot{constructor(r="",l="",o="",a="",i="",c=""){super();V(this,"publicKey");V(this,"fingerprint");V(this,"serverName");V(this,"shortId");V(this,"spiderX");V(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=o!=null?o:"",this.shortId=a!=null?a:"",this.spiderX=i!=null?i:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var l,o,a,i,c,u;return new Vs((l=r==null?void 0:r.publicKey)!=null?l:"",(o=r==null?void 0:r.fingerprint)!=null?o:"",(a=r==null?void 0:r.serverName)!=null?a:"",(i=r==null?void 0:r.shortId)!=null?i:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class kn extends ot{constructor(r="",l=!1,o=0,a=!1,i=!1,c=Aa.NONE){super();V(this,"dialerProxy");V(this,"tcpFastOpen");V(this,"tcpKeepAliveInterval");V(this,"tcpMptcp");V(this,"penetrate");V(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=o!=null?o:0,this.tcpMptcp=Boolean(a),this.penetrate=Boolean(i),this.addressPortStrategy=c!=null?c:Aa.NONE}static fromJson(r={}){var l,o,a;return!r||Object.keys(r).length===0?new kn:new kn((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(o=r==null?void 0:r.tcpKeepAliveInterval)!=null?o:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(a=r==null?void 0:r.addressPortStrategy)!=null?a:Aa.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class ns extends ot{constructor(r="tcp",l="none",o=new ys,a=new Vs,i=new Jr,c=new Fs,u=new fs,p=new bs,g=new Hs,f=new Bs,v){super();V(this,"network");V(this,"security");V(this,"tls");V(this,"reality");V(this,"tcp");V(this,"kcp");V(this,"ws");V(this,"grpc");V(this,"httpupgrade");V(this,"xhttp");V(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=o,this.reality=a,this.tcp=i,this.kcp=c,this.ws=u,this.grpc=p,this.httpupgrade=g,this.xhttp=f,this.sockopt=v}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new kn:void 0}static fromJson(r={}){var l,o;return new ns((l=r==null?void 0:r.network)!=null?l:"tcp",(o=r==null?void 0:r.security)!=null?o:"none",ys.fromJson(r==null?void 0:r.tlsSettings),Vs.fromJson(r==null?void 0:r.realitySettings),Jr.fromJson(r==null?void 0:r.tcpSettings),Fs.fromJson(r==null?void 0:r.kcpSettings),fs.fromJson(r==null?void 0:r.wsSettings),bs.fromJson(r==null?void 0:r.grpcSettings),Hs.fromJson(r==null?void 0:r.httpupgradeSettings),Bs.fromJson(r==null?void 0:r.xhttpSettings),kn.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class wn extends ot{constructor(r=!1,l=8,o=16,a="reject"){super();V(this,"enabled");V(this,"concurrency");V(this,"xudpConcurrency");V(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=o!=null?o:16,this.xudpProxyUDP443=a!=null?a:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new wn:new wn(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var Kr,Ar;const Ke=class extends ot{constructor(r="",l=ae.VLESS,o=Ke.Settings.getSettings(ae.VLESS),a=new ns,i,c=new wn){super();V(this,"tag");V(this,"_protocol");V(this,"settings");V(this,"stream");V(this,"sendThrough");V(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:ae.VLESS,this.settings=o!=null?o:Ke.Settings.getSettings(this._protocol),this.stream=a,this.sendThrough=i,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=Ke.Settings.getSettings(r),this.stream=new ns}canEnableTls(){return[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===ae.VLESS:!1}canEnableReality(){return[ae.VLESS,ae.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks,ae.HTTP,ae.Socks].includes(this.protocol)}hasVnext(){return[ae.VMess,ae.VLESS].includes(this.protocol)}hasServers(){return[ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP].includes(this.protocol)}hasAddressPort(){return[ae.DNS,ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP].includes(this.protocol)}hasUsername(){return[ae.Socks,ae.HTTP].includes(this.protocol)}static fromJson(r={}){var l,o,a,i;return new Ke((l=r==null?void 0:r.tag)!=null?l:"",(o=r==null?void 0:r.protocol)!=null?o:ae.VLESS,Ke.Settings.fromProtocol((a=r==null?void 0:r.protocol)!=null?a:ae.VLESS,r==null?void 0:r.settings),ns.fromJson(r==null?void 0:r.streamSettings),(i=r==null?void 0:r.sendThrough)!=null?i:"",wn.fromJson(r==null?void 0:r.mux))}toJson(){var l,o;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof ot?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(o=this.mux)!=null&&o.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const o=l[0].toLowerCase();try{switch(o){case ae.VMess:return Ke.fromVmessLink(JSON.parse(Wi(l[1])));case ae.VLESS:case ae.Trojan:case"ss":return Ke.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var i,c,u,p,g,f,v,x,S,b,w,P,L,te,_,U,D,A,Ae,ge,re,F,se;if(!r)return null;const l=new ns((i=r==null?void 0:r.net)!=null?i:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),o=r==null?void 0:r.net;o==="tcp"?l.tcp=new Jr((u=r==null?void 0:r.type)!=null?u:"none",(p=r==null?void 0:r.host)!=null?p:"",(g=r==null?void 0:r.path)!=null?g:""):o==="kcp"?(l.kcp=new Fs,l.kcp.type=(f=r==null?void 0:r.type)!=null?f:"none",l.kcp.seed=(v=r==null?void 0:r.path)!=null?v:""):o==="ws"?l.ws=new fs((x=r==null?void 0:r.path)!=null?x:"/",(S=r==null?void 0:r.host)!=null?S:""):o==="grpc"?l.grpc=new bs((b=r==null?void 0:r.path)!=null?b:"",(w=r==null?void 0:r.authority)!=null?w:"",(r==null?void 0:r.type)==="multi"):o==="httpupgrade"?l.httpupgrade=new Hs((P=r==null?void 0:r.path)!=null?P:"/",(L=r==null?void 0:r.host)!=null?L:""):o==="xhttp"&&(l.xhttp=new Bs((te=r==null?void 0:r.path)!=null?te:"/",(_=r==null?void 0:r.host)!=null?_:"",(U=r==null?void 0:r.mode)!=null?U:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new ys((D=r==null?void 0:r.sni)!=null?D:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(A=r==null?void 0:r.fp)!=null?A:"",Boolean(r==null?void 0:r.allowInsecure)));const a=Number((Ae=r==null?void 0:r.port)!=null?Ae:0);return Number.isNaN(a)?null:new Ke((ge=r==null?void 0:r.ps)!=null?ge:"",ae.VMess,new Ke.VmessSettings((re=r==null?void 0:r.add)!=null?re:"",a,(F=r==null?void 0:r.id)!=null?F:"",(se=r==null?void 0:r.scy)!=null?se:""),l)}static fromParamLink(r){var U,D,A,Ae,ge,re,F,se,le,ie,ne,I,ce,Te,ve,N,T,R,de,q,be;let l;try{l=new URL(r)}catch{return null}const o=(U=l.searchParams.get("type"))!=null?U:"tcp",a=(D=l.searchParams.get("security"))!=null?D:"none",i=new ns(o,a),c=(A=l.searchParams.get("headerType"))!=null?A:void 0,u=(Ae=l.searchParams.get("host"))!=null?Ae:void 0,p=(ge=l.searchParams.get("path"))!=null?ge:void 0,g=(re=l.searchParams.get("mode"))!=null?re:void 0;if(o==="tcp"||o==="none"?i.tcp=new Jr(c!=null?c:"none",u!=null?u:"",p!=null?p:""):o==="kcp"?(i.kcp=new Fs,i.kcp.type=c!=null?c:"none",i.kcp.seed=p!=null?p:""):o==="ws"?i.ws=new fs(p!=null?p:"/",u!=null?u:""):o==="grpc"?i.grpc=new bs((F=l.searchParams.get("serviceName"))!=null?F:"",(se=l.searchParams.get("authority"))!=null?se:"",l.searchParams.get("mode")==="multi"):o==="httpupgrade"?i.httpupgrade=new Hs(p!=null?p:"/",u!=null?u:""):o==="xhttp"&&(i.xhttp=new Bs(p!=null?p:"/",u!=null?u:"",g!=null?g:"")),a==="tls"){const Pe=(le=l.searchParams.get("fp"))!=null?le:"none",Ie=l.searchParams.get("alpn"),Oe=l.searchParams.get("allowInsecure"),Q=(ie=l.searchParams.get("sni"))!=null?ie:"",xe=(ne=l.searchParams.get("ech"))!=null?ne:"";i.tls=new ys(Q,Ie?Ie.split(","):[],Pe,Oe==="1",xe)}if(a==="reality"){const Pe=(I=l.searchParams.get("pbk"))!=null?I:"",Ie=(ce=l.searchParams.get("fp"))!=null?ce:"",Oe=(Te=l.searchParams.get("sni"))!=null?Te:"",Q=(ve=l.searchParams.get("sid"))!=null?ve:"",xe=(N=l.searchParams.get("spx"))!=null?N:"",Y=(T=l.searchParams.get("pqv"))!=null?T:"";i.reality=new Vs(Pe,Ie,Oe,Q,xe,Y)}const f=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,v=r.match(f);if(!v)return null;let[,x,S,b,w]=v,P=Number(w);Number.isNaN(P)&&(P=0),x==="ss"&&(x=ae.Shadowsocks,S=Wi(S));let L=null;switch(x){case ae.VLESS:{const Pe=(R=l.searchParams.get("encryption"))!=null?R:"none";L=new Ke.VLESSSettings(b,P,S,(de=l.searchParams.get("flow"))!=null?de:"",Pe);break}case ae.Trojan:L=new Ke.TrojanSettings(b,P,S);break;case ae.Shadowsocks:{const Pe=S.split(":"),Ie=(q=Pe.shift())!=null?q:"";L=new Ke.ShadowsocksSettings(b,P,Pe.join(":"),Ie,!0);break}default:return null}const te=decodeURIComponent((be=l.hash)!=null?be:""),_=te.length>1?te.substring(1):`out-${x}-${P}`;return new Ke(_,x,L,i)}};let Ht=Ke;V(Ht,"Settings",class extends ot{constructor(o){super();V(this,"protocol");this.protocol=o}static getSettings(o){switch(o){case ae.Freedom:return new Ke.FreedomSettings;case ae.Blackhole:return new Ke.BlackholeSettings;case ae.DNS:return new Ke.DNSSettings;case ae.VMess:return new Ke.VmessSettings;case ae.VLESS:return new Ke.VLESSSettings;case ae.Trojan:return new Ke.TrojanSettings;case ae.Shadowsocks:return new Ke.ShadowsocksSettings;case ae.Socks:return new Ke.SocksSettings;case ae.HTTP:return new Ke.HttpSettings;case ae.Wireguard:return new Ke.WireguardSettings;default:return null}}static fromProtocol(o,a){switch(o){case ae.Freedom:return Ke.FreedomSettings.fromJson(a);case ae.Blackhole:return Ke.BlackholeSettings.fromJson(a);case ae.DNS:return Ke.DNSSettings.fromJson(a);case ae.VMess:return Ke.VmessSettings.fromJson(a);case ae.VLESS:return Ke.VLESSSettings.fromJson(a);case ae.Trojan:return Ke.TrojanSettings.fromJson(a);case ae.Shadowsocks:return Ke.ShadowsocksSettings.fromJson(a);case ae.Socks:return Ke.SocksSettings.fromJson(a);case ae.HTTP:return Ke.HttpSettings.fromJson(a);case ae.Wireguard:return Ke.WireguardSettings.fromJson(a);default:return null}}toJson(){return{}}}),V(Ht,"FreedomSettings",(Kr=class extends ot{constructor(o="",a="",i={},c=[]){super();V(this,"domainStrategy");V(this,"redirect");V(this,"fragment");V(this,"noises");this.domainStrategy=o!=null?o:"",this.redirect=a!=null?a:"",this.fragment=i!=null?i:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new Ke.FreedomSettings.Noise)}delNoise(o){this.noises.splice(o,1)}static fromJson(o={}){var a,i;return new Kr((a=o==null?void 0:o.domainStrategy)!=null?a:"",(i=o==null?void 0:o.redirect)!=null?i:"",o!=null&&o.fragment?Kr.Fragment.fromJson(o.fragment):{},Array.isArray(o==null?void 0:o.noises)?o.noises.map(c=>Kr.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:cr.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:cr.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:ot.toJsonArray(this.noises)}}},V(Kr,"Fragment",class nl extends ot{constructor(i="1-3",c="",u="",p=""){super();V(this,"packets");V(this,"length");V(this,"interval");V(this,"maxSplit");this.packets=i!=null?i:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=p!=null?p:""}static fromJson(i={}){var c,u,p,g;return new nl((c=i==null?void 0:i.packets)!=null?c:"1-3",(u=i==null?void 0:i.length)!=null?u:"",(p=i==null?void 0:i.interval)!=null?p:"",(g=i==null?void 0:i.maxSplit)!=null?g:"")}}),V(Kr,"Noise",class al extends ot{constructor(i="rand",c="10-20",u="10-16",p="ip"){super();V(this,"type");V(this,"packet");V(this,"delay");V(this,"applyTo");this.type=i!=null?i:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(i={}){var c,u,p,g;return new al((c=i==null?void 0:i.type)!=null?c:"rand",(u=i==null?void 0:i.packet)!=null?u:"10-20",(p=i==null?void 0:i.delay)!=null?p:"10-16",(g=i==null?void 0:i.applyTo)!=null?g:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),Kr)),V(Ht,"BlackholeSettings",class il extends ot{constructor(o){super();V(this,"type");this.type=o}static fromJson(o={}){var a;return new il((a=o==null?void 0:o.response)==null?void 0:a.type)}toJson(){return{response:cr.isEmpty(this.type)?void 0:{type:this.type}}}}),V(Ht,"DNSSettings",class ol extends ot{constructor(o="udp",a="",i=53,c="reject",u=[]){super();V(this,"network");V(this,"address");V(this,"port");V(this,"nonIPQuery");V(this,"blockTypes");this.network=o!=null?o:"udp",this.address=a!=null?a:"",this.port=i!=null?i:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(o={}){var a,i,c,u;return new ol((a=o==null?void 0:o.network)!=null?a:"udp",(i=o==null?void 0:o.address)!=null?i:"",(c=o==null?void 0:o.port)!=null?c:53,(u=o==null?void 0:o.nonIPQuery)!=null?u:"reject",Array.isArray(o==null?void 0:o.blockTypes)?o.blockTypes:[])}}),V(Ht,"VmessSettings",class extends ot{constructor(o="",a=0,i="",c=""){super();V(this,"address");V(this,"port");V(this,"id");V(this,"security");this.address=o!=null?o:"",this.port=a!=null?a:0,this.id=i!=null?i:"",this.security=c!=null?c:""}static fromJson(o={}){var c,u,p,g;if(cr.isArrEmpty(o==null?void 0:o.vnext))return new Ke.VmessSettings;const a=o.vnext[0],i=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Ke.VmessSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=i==null?void 0:i.id)!=null?p:"",(g=i==null?void 0:i.security)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),V(Ht,"VLESSSettings",class extends ot{constructor(o="",a=0,i="",c="",u=""){super();V(this,"address");V(this,"port");V(this,"id");V(this,"flow");V(this,"encryption");this.address=o!=null?o:"",this.port=a!=null?a:0,this.id=i!=null?i:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(o={}){var c,u,p,g,f;if(cr.isArrEmpty(o==null?void 0:o.vnext))return new Ke.VLESSSettings;const a=o.vnext[0],i=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Ke.VLESSSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=i==null?void 0:i.id)!=null?p:"",(g=i==null?void 0:i.flow)!=null?g:"",(f=i==null?void 0:i.encryption)!=null?f:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),V(Ht,"TrojanSettings",class extends ot{constructor(o="",a=0,i=""){super();V(this,"address");V(this,"port");V(this,"password");this.address=o!=null?o:"",this.port=a!=null?a:0,this.password=i!=null?i:""}static fromJson(o={}){var i,c,u;if(cr.isArrEmpty(o==null?void 0:o.servers))return new Ke.TrojanSettings;const a=o.servers[0];return new Ke.TrojanSettings((i=a==null?void 0:a.address)!=null?i:"",(c=a==null?void 0:a.port)!=null?c:0,(u=a==null?void 0:a.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),V(Ht,"ShadowsocksSettings",class extends ot{constructor(o="",a=0,i="",c="",u,p){super();V(this,"address");V(this,"port");V(this,"password");V(this,"method");V(this,"uot");V(this,"UoTVersion");this.address=o!=null?o:"",this.port=a!=null?a:0,this.password=i!=null?i:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=p}static fromJson(o={}){var c,u,p,g;let a=o==null?void 0:o.servers;cr.isArrEmpty(a)&&(a=[{}]);const i=a[0];return new Ke.ShadowsocksSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=i==null?void 0:i.password)!=null?p:"",(g=i==null?void 0:i.method)!=null?g:"",i==null?void 0:i.uot,i==null?void 0:i.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),V(Ht,"SocksSettings",class extends ot{constructor(o="",a=0,i="",c=""){super();V(this,"address");V(this,"port");V(this,"user");V(this,"pass");this.address=o!=null?o:"",this.port=a!=null?a:0,this.user=i!=null?i:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,g,f;let a=o==null?void 0:o.servers;cr.isArrEmpty(a)&&(a=[{users:[{}]}]);const i=a[0],c=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Ke.SocksSettings((u=i==null?void 0:i.address)!=null?u:"",(p=i==null?void 0:i.port)!=null?p:0,(g=c==null?void 0:c.user)!=null?g:"",(f=c==null?void 0:c.pass)!=null?f:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:cr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),V(Ht,"HttpSettings",class extends ot{constructor(o="",a=0,i="",c=""){super();V(this,"address");V(this,"port");V(this,"user");V(this,"pass");this.address=o!=null?o:"",this.port=a!=null?a:0,this.user=i!=null?i:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,g,f;let a=o==null?void 0:o.servers;cr.isArrEmpty(a)&&(a=[{users:[{}]}]);const i=a[0],c=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Ke.HttpSettings((u=i==null?void 0:i.address)!=null?u:"",(p=i==null?void 0:i.port)!=null?p:0,(g=c==null?void 0:c.user)!=null?g:"",(f=c==null?void 0:c.pass)!=null?f:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:cr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),V(Ht,"WireguardSettings",(Ar=class extends ot{constructor(o=1420,a="",i=[""],c=2,u="",p="",g=[new Ar.Peer],f=!1){super();V(this,"mtu");V(this,"secretKey");V(this,"pubKey");V(this,"address");V(this,"workers");V(this,"domainStrategy");V(this,"reserved");V(this,"peers");V(this,"noKernelTun");this.mtu=o!=null?o:1420,this.secretKey=a!=null?a:"",this.pubKey=this.secretKey.length>0?eh(this.secretKey):"",this.address=Array.isArray(i)?i.join(","):i!=null?i:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=g!=null?g:[new Ar.Peer],this.noKernelTun=Boolean(f)}addPeer(){this.peers.push(new Ar.Peer)}delPeer(o){this.peers.splice(o,1)}static fromJson(o={}){var a,i,c,u,p,g,f;return new Ar((a=o==null?void 0:o.mtu)!=null?a:1420,(i=o==null?void 0:o.secretKey)!=null?i:"",(c=o==null?void 0:o.address)!=null?c:[""],(u=o==null?void 0:o.workers)!=null?u:2,(p=o==null?void 0:o.domainStrategy)!=null?p:"",(g=o==null?void 0:o.reserved)!=null?g:"",Array.isArray(o==null?void 0:o.peers)?o.peers.map(v=>Ar.Peer.fromJson(v)):[new Ar.Peer],(f=o==null?void 0:o.noKernelTun)!=null?f:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:sh.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(o=>Number(o)).filter(o=>!Number.isNaN(o)):void 0,peers:ot.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},V(Ar,"Peer",class extends ot{constructor(i="",c="",u=["0.0.0.0/0","::/0"],p="",g=0){super();V(this,"publicKey");V(this,"psk");V(this,"allowedIPs");V(this,"endpoint");V(this,"keepAlive");this.publicKey=i!=null?i:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=g!=null?g:0}static fromJson(i={}){var c,u,p,g;return new Ke.WireguardSettings.Peer((c=i==null?void 0:i.publicKey)!=null?c:"",(u=i==null?void 0:i.preSharedKey)!=null?u:"",Array.isArray(i==null?void 0:i.allowedIPs)?i.allowedIPs:["0.0.0.0/0","::/0"],(p=i==null?void 0:i.endpoint)!=null?p:"",(g=i==null?void 0:i.keepAlive)!=null?g:0)}toJson(){var i;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(i=this.allowedIPs)!=null&&i.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),Ar));class us{static sizeFormat(n){if(n<=0||Number.isNaN(n))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,o=n;for(;o>=1024&&l<r.length-1;)o/=1024,l++;return`${o.toFixed(2)} ${r[l]}`}}const nh=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(rh);const ah=Object.values(th),ei=["vmess","vless","trojan","shadowsocks"],ih=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp"],oh=["none","tls","reality"],Ia=t=>t.split(/[\n,]/).map(n=>n.trim()).filter(Boolean),Ta=t=>t&&t.length?t.join(`
`):"",Is=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",ll=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),lh=t=>{if(!t)return 0;const n=Number(t);return!Number.isNaN(n)&&n>0?n:t.trim()},Sr=t=>(Object.keys(t).forEach(n=>{const r=t[n];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[n]}),t),Ts=t=>{if(t===""||t===null||typeof t>"u")return;const n=Number(t);return Number.isFinite(n)?n:void 0},ch=t=>{if(!t.sockoptEnabled)return;const n=t.sockopt,r={acceptProxyProtocol:n.acceptProxyProtocol,tcpFastOpen:n.tcpFastOpen,mark:Ts(n.mark),tproxy:n.tproxy||void 0,tcpMptcp:n.tcpMptcp,penetrate:n.penetrate,domainStrategy:n.domainStrategy||void 0,tcpMaxSeg:Ts(n.tcpMaxSeg),dialerProxy:n.dialerProxy||void 0,tcpKeepAliveInterval:Ts(n.tcpKeepAliveInterval),tcpKeepAliveIdle:Ts(n.tcpKeepAliveIdle),tcpUserTimeout:Ts(n.tcpUserTimeout),tcpcongestion:n.tcpcongestion||void 0,V6Only:n.V6Only,tcpWindowClamp:Ts(n.tcpWindowClamp),interface:n.interfaceName||void 0};return Sr(r)},Ha=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:ll()}),dh=t=>{var n,r,l,o,a,i,c;return{dest:(r=(n=t==null?void 0:t.dest)==null?void 0:n.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(o=t==null?void 0:t.type)!=null?o:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(a=t==null?void 0:t.alpn)!=null?a:"",xver:(c=(i=t==null?void 0:t.xver)==null?void 0:i.toString())!=null?c:""}},Fi=t=>{var r,l,o;const n={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(o=t.type)==null?void 0:o.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(n.alpn=t.alpn.split(",").map(a=>a.trim()).filter(Boolean)),Sr(n)},uh=t=>{var u,p,g,f,v,x,S,b,w,P,L,te,_,U,D,A,Ae,ge,re,F,se,le,ie,ne,I,ce,Te,ve,N,T,R,de,q,be,Pe,Ie,Oe,Q,xe,Y,pe,O,fe,K,Z,ee,B,ke,bt,Ye,G,W,he,we,We,Ne,rt,pt,It,Ze,mt,vt,Rt,Kt,jt,Gt,er,Wt;const n=ei.includes(t.protocol)?t.protocol:"vless",r=Ha(n),l=(u=t.settings)!=null?u:{},o=(p=t.sniffing)!=null?p:{},a=(g=t.streamSettings)!=null?g:{},i=(f=a.tlsSettings)!=null?f:{},c=(v=a.realitySettings)!=null?v:{};return{...r,tag:(x=t.tag)!=null?x:"",listen:(S=t.listen)!=null?S:"",port:(w=(b=t.port)==null?void 0:b.toString())!=null?w:"",disableInsecureEncryption:Boolean((P=l.disableInsecureEncryption)!=null?P:r.disableInsecureEncryption),vlessDecryption:(L=l.decryption)!=null?L:r.vlessDecryption,vlessEncryption:(te=l.encryption)!=null?te:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map($=>dh($)):r.fallbacks,shadowsocksNetwork:(_=l.network)!=null?_:r.shadowsocksNetwork,sniffingEnabled:Boolean((U=o.enabled)!=null?U:r.sniffingEnabled),sniffingDestinations:Array.isArray(o.destOverride)&&o.destOverride.length?o.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((D=o.routeOnly)!=null?D:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((A=o.metadataOnly)!=null?A:r.sniffingMetadataOnly),streamNetwork:(Ae=a.network)!=null?Ae:r.streamNetwork,streamSecurity:(ge=a.security)!=null?ge:r.streamSecurity,tlsServerName:(re=i.serverName)!=null?re:r.tlsServerName,tlsAlpn:Array.isArray(i.alpn)?i.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((F=i.allowInsecure)!=null?F:r.tlsAllowInsecure),tlsFingerprint:(se=i.fingerprint)!=null?se:r.tlsFingerprint,realityPrivateKey:(le=c.privateKey)!=null?le:r.realityPrivateKey,realityServerNames:Ta(c.serverNames),realityShortIds:Ta(c.shortIds),realityDest:(ie=c.dest)!=null?ie:r.realityDest,realitySpiderX:(ne=c.spiderX)!=null?ne:r.realitySpiderX,realityXver:(ce=(I=c.xver)==null?void 0:I.toString())!=null?ce:r.realityXver,wsPath:(ve=(Te=a==null?void 0:a.wsSettings)==null?void 0:Te.path)!=null?ve:r.wsPath,wsHost:(R=(T=(N=a==null?void 0:a.wsSettings)==null?void 0:N.headers)==null?void 0:T.Host)!=null?R:r.wsHost,tcpHeaderType:(be=(q=(de=a==null?void 0:a.tcpSettings)==null?void 0:de.header)==null?void 0:q.type)!=null?be:r.tcpHeaderType,tcpHttpHosts:Ta((Q=(Oe=(Ie=(Pe=a==null?void 0:a.tcpSettings)==null?void 0:Pe.header)==null?void 0:Ie.request)==null?void 0:Oe.headers)==null?void 0:Q.Host),tcpHttpPath:Array.isArray((pe=(Y=(xe=a==null?void 0:a.tcpSettings)==null?void 0:xe.header)==null?void 0:Y.request)==null?void 0:pe.path)?a.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(fe=(O=a==null?void 0:a.grpcSettings)==null?void 0:O.serviceName)!=null?fe:r.grpcServiceName,grpcAuthority:(Z=(K=a==null?void 0:a.grpcSettings)==null?void 0:K.authority)!=null?Z:r.grpcAuthority,grpcMultiMode:Boolean((B=(ee=a==null?void 0:a.grpcSettings)==null?void 0:ee.multiMode)!=null?B:r.grpcMultiMode),kcpHeaderType:(Ye=(bt=(ke=a==null?void 0:a.kcpSettings)==null?void 0:ke.header)==null?void 0:bt.type)!=null?Ye:r.kcpHeaderType,kcpSeed:(W=(G=a==null?void 0:a.kcpSettings)==null?void 0:G.seed)!=null?W:r.kcpSeed,quicSecurity:(we=(he=a==null?void 0:a.quicSettings)==null?void 0:he.security)!=null?we:r.quicSecurity,quicKey:(Ne=(We=a==null?void 0:a.quicSettings)==null?void 0:We.key)!=null?Ne:r.quicKey,quicHeaderType:(It=(pt=(rt=a==null?void 0:a.quicSettings)==null?void 0:rt.header)==null?void 0:pt.type)!=null?It:r.quicHeaderType,httpupgradePath:(mt=(Ze=a==null?void 0:a.httpupgradeSettings)==null?void 0:Ze.path)!=null?mt:r.httpupgradePath,httpupgradeHost:(Rt=(vt=a==null?void 0:a.httpupgradeSettings)==null?void 0:vt.host)!=null?Rt:r.httpupgradeHost,splithttpPath:(jt=(Kt=a==null?void 0:a.splithttpSettings)==null?void 0:Kt.path)!=null?jt:r.splithttpPath,splithttpHost:(er=(Gt=a==null?void 0:a.splithttpSettings)==null?void 0:Gt.host)!=null?er:r.splithttpHost,vlessSelectedAuth:(Wt=l.selectedAuth)!=null?Wt:r.vlessSelectedAuth,sockoptEnabled:Boolean(a==null?void 0:a.sockopt),sockopt:(()=>{var Ge,et,yt,H,ue,J;const $=ll(),_e=(Ge=a==null?void 0:a.sockopt)!=null?Ge:{};return $.acceptProxyProtocol=Boolean(_e.acceptProxyProtocol),$.tcpFastOpen=Boolean(_e.tcpFastOpen),$.mark=Is(_e.mark),$.tproxy=(et=_e.tproxy)!=null?et:$.tproxy,$.tcpMptcp=Boolean(_e.tcpMptcp),$.penetrate=Boolean(_e.penetrate),$.domainStrategy=(yt=_e.domainStrategy)!=null?yt:$.domainStrategy,$.tcpMaxSeg=Is(_e.tcpMaxSeg),$.dialerProxy=(H=_e.dialerProxy)!=null?H:$.dialerProxy,$.tcpKeepAliveInterval=Is(_e.tcpKeepAliveInterval),$.tcpKeepAliveIdle=Is(_e.tcpKeepAliveIdle),$.tcpUserTimeout=Is(_e.tcpUserTimeout),$.tcpcongestion=(ue=_e.tcpcongestion)!=null?ue:$.tcpcongestion,$.V6Only=Boolean(_e.V6Only),$.tcpWindowClamp=Is(_e.tcpWindowClamp),$.interfaceName=(J=_e.interface)!=null?J:$.interfaceName,$})()}},hh=t=>{var l;const n={network:t.streamNetwork,security:t.streamSecurity};t.streamNetwork==="ws"&&(n.wsSettings=Sr({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?n.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:Ia(t.tcpHttpHosts)}:{}}}}:n.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(n.grpcSettings=Sr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(n.kcpSettings=Sr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(n.quicSettings=Sr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(n.httpupgradeSettings=Sr({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(n.splithttpSettings=Sr({path:t.splithttpPath,host:t.splithttpHost})),t.streamSecurity==="tls"&&(n.tlsSettings=Sr({serverName:t.tlsServerName||void 0,alpn:(l=t.tlsAlpn)!=null&&l.length?t.tlsAlpn:void 0,allowInsecure:t.tlsAllowInsecure||void 0,fingerprint:t.tlsFingerprint||void 0})),t.streamSecurity==="reality"&&(n.realitySettings=Sr({privateKey:t.realityPrivateKey||void 0,serverNames:Ia(t.realityServerNames),shortIds:Ia(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=ch(t);return r&&(n.sockopt=r),Sr(n)},ph=t=>{const n={clients:[]};switch(t.protocol){case"vmess":n.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":n.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(n.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(n.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(Fi).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(n.fallbacks=t.fallbacks.map(Fi).filter(r=>Object.keys(r).length));break;case"shadowsocks":n.network=t.shadowsocksNetwork||"tcp,udp";break}return n},mh=t=>{const n={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:lh(t.port),protocol:t.protocol,settings:ph(t),streamSettings:hh(t)};return t.sniffingEnabled&&(n.sniffing=Sr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly})),n};class Ba{static gf(n){const r=new Float64Array(16);if(n)for(let l=0;l<n.length;++l)r[l]=n[l];return r}static pack(n,r){let l;const o=this.gf(),a=this.gf();for(let i=0;i<16;++i)a[i]=r[i];this.carry(a),this.carry(a),this.carry(a);for(let i=0;i<2;++i){o[0]=a[0]-65517;for(let c=1;c<15;++c)o[c]=a[c]-65535-(o[c-1]>>16&1),o[c-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),l=o[15]>>16&1,o[14]&=65535,this.cswap(a,o,1-l)}for(let i=0;i<16;++i)n[2*i]=a[i]&255,n[2*i+1]=a[i]>>8}static carry(n){for(let r=0;r<16;++r)n[(r+1)%16]+=(r<15?1:38)*Math.floor(n[r]/65536),n[r]&=65535}static cswap(n,r,l){const o=~(l-1);for(let a=0;a<16;++a){const i=o&(n[a]^r[a]);n[a]^=i,r[a]^=i}}static add(n,r,l){for(let o=0;o<16;++o)n[o]=r[o]+l[o]|0}static subtract(n,r,l){for(let o=0;o<16;++o)n[o]=r[o]-l[o]|0}static multmod(n,r,l){const o=new Float64Array(31);for(let a=0;a<16;++a)for(let i=0;i<16;++i)o[a+i]+=r[a]*l[i];for(let a=0;a<15;++a)o[a]+=38*o[a+16];for(let a=0;a<16;++a)n[a]=o[a];this.carry(n),this.carry(n)}static invert(n,r){const l=this.gf();for(let o=0;o<16;++o)l[o]=r[o];for(let o=253;o>=0;--o)this.multmod(l,l,l),o!==2&&o!==4&&this.multmod(l,l,r);for(let o=0;o<16;++o)n[o]=l[o]}static clamp(n){n[31]=n[31]&127|64,n[0]&=248}static generatePublicKey(n){let r;const l=new Uint8Array(32),o=this.gf([1]),a=this.gf([9]),i=this.gf(),c=this.gf([1]),u=this.gf(),p=this.gf(),g=this.gf([56129,1]),f=this.gf([9]);for(let v=0;v<32;++v)l[v]=n[v];this.clamp(l);for(let v=254;v>=0;--v)r=l[v>>>3]>>>(v&7)&1,this.cswap(o,a,r),this.cswap(i,c,r),this.add(u,o,i),this.subtract(o,o,i),this.add(i,a,c),this.subtract(a,a,c),this.multmod(c,u,u),this.multmod(p,o,o),this.multmod(o,i,o),this.multmod(i,a,u),this.add(u,o,i),this.subtract(o,o,i),this.multmod(a,o,o),this.subtract(i,c,p),this.multmod(o,i,g),this.add(o,o,c),this.multmod(i,i,o),this.multmod(o,c,p),this.multmod(c,a,f),this.multmod(a,u,u),this.cswap(o,a,r),this.cswap(i,c,r);return this.invert(i,i),this.multmod(o,o,i),this.pack(l,o),l}static generatePresharedKey(){const n=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(n),n}static generatePrivateKey(){const n=this.generatePresharedKey();return this.clamp(n),n}static encodeBase64(n,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let o=0;o<4;++o)n[o]=l[o]+65+(25-l[o]>>8&6)-(51-l[o]>>8&75)-(61-l[o]>>8&15)+(62-l[o]>>8&3)}static keyToBase64(n){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),n.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([n[r*3+0],n[r*3+1],0])),l[43]=61,Array.from(l).map(o=>String.fromCharCode(o)).join("")}static keyFromBase64(n){const r=globalThis.atob(n),l=new Uint8Array(r.length);for(let o=0;o<r.length;o++)l[o]=r.charCodeAt(o);return l}static generateKeypair(n=""){const r=n.length>0?this.keyFromBase64(n):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:n.length>0?n:this.keyToBase64(r)}}}const la=t=>Ba.generateKeypair(t!=null?t:""),gh=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:Ba.generateKeypair.bind(Ba)})},fh=async()=>De("/xray/vlessenc"),nt=d.exports.forwardRef((t,n)=>e(Se,{size:"sm",ref:n,...t}));nt.displayName="InboundFormInput";const Ls=d.exports.forwardRef((t,n)=>e(qe,{size:"sm",ref:n,...t}));Ls.displayName="InboundFormSelect";const pn=d.exports.forwardRef((t,n)=>e(dr,{size:"sm",resize:"vertical",ref:n,...t}));pn.displayName="InboundFormTextarea";const Hi=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),bh=t=>{const n=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!n)return"";const r=n.length%4;return r===0?n:`${n}${"=".repeat(4-r)}`},yh=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],Sh=["bbr","cubic","reno"],xh=["off","redirect","tproxy"],kh=({isOpen:t,mode:n,initialValue:r,isSubmitting:l,onClose:o,onSubmit:a})=>{var Y,pe;const{t:i}=He(),c=Ut(),[u,p]=d.exports.useState([]),[g,f]=d.exports.useState(!1),v=vr({defaultValues:Ha()}),{control:x,register:S,handleSubmit:b,reset:w,watch:P}=v,{fields:L,append:te,remove:_}=Qa({control:x,name:"fallbacks"}),U=qt({control:x,name:"protocol"})||P("protocol"),D=qt({control:x,name:"streamNetwork"})||P("streamNetwork"),A=qt({control:x,name:"streamSecurity"})||P("streamSecurity"),Ae=(Y=qt({control:x,name:"sniffingEnabled"}))!=null?Y:P("sniffingEnabled"),ge=qt({control:x,name:"realityPrivateKey"})||P("realityPrivateKey"),re=qt({control:x,name:"tcpHeaderType"})||P("tcpHeaderType"),F=(pe=qt({control:x,name:"sockoptEnabled"}))!=null?pe:!1,se=qt({control:x,name:"vlessSelectedAuth"})||"",le=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),ie=d.exports.useMemo(()=>{const O=[...le,...u.map(K=>K.label)].filter(Boolean);return Array.from(new Set(O)).map(K=>({label:K,value:K}))},[le,u]);d.exports.useEffect(()=>{if(t)if(r){const O=uh(r);w(O)}else w(Ha())},[r,w,t]);const ne=d.exports.useCallback((O,fe)=>s(k,{children:[e(C,{children:fe}),e(lt,{control:x,name:`sockopt.${O}`,render:({field:K})=>{var Z;return e(Yr,{min:0,value:(Z=K.value)!=null?Z:"",onChange:ee=>K.onChange(ee),children:e(qr,{})})}})]}),[x]),I=d.exports.useCallback((O,fe)=>s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:fe}),e(lt,{control:x,name:`sockopt.${O}`,render:({field:K})=>e(ft,{isChecked:K.value,onChange:Z=>K.onChange(Z.target.checked)})})]}),[x]),ce=d.exports.useCallback((O,fe,K)=>s(k,{children:[e(C,{children:fe}),e(nt,{...S(`sockopt.${O}`),placeholder:K})]}),[S]),Te=U==="vless"||U==="trojan",ve=Qe("gray.200","gray.700"),N=async O=>{await a(O)},T=d.exports.useCallback(()=>{try{const{privateKey:O}=la();v.setValue("realityPrivateKey",Hi(O),{shouldDirty:!0})}catch(O){c({status:"error",title:i("inbounds.reality.generateError","Unable to generate key pair"),description:O instanceof Error?O.message:void 0})}},[v,c,i]),R=d.exports.useCallback(()=>{try{const O=typeof window>"u"?void 0:window.crypto;if(!(O!=null&&O.getRandomValues))throw new Error("Crypto API is not available in this environment.");const fe=new Uint8Array(4);O.getRandomValues(fe);const K=Array.from(fe).map(B=>B.toString(16).padStart(2,"0")).join(""),ee=(v.getValues("realityShortIds")||"").split(/[\s,]+/).map(B=>B.trim()).filter(Boolean);ee.push(K),v.setValue("realityShortIds",ee.join(`
`),{shouldDirty:!0})}catch(O){c({status:"error",title:i("inbounds.reality.shortIdError","Unable to generate short ID"),description:O instanceof Error?O.message:void 0})}},[v,c,i]),de=d.exports.useMemo(()=>{const O=bh(ge);if(!O)return"";try{const{publicKey:fe}=la(O);return Hi(fe)}catch{return""}},[ge]),q=()=>te({dest:"",path:"",type:"",alpn:"",xver:""}),be=d.exports.useCallback(async()=>{var O;f(!0);try{const fe=await fh(),K=(O=fe==null?void 0:fe.auths)!=null?O:[];return p(K),K}catch(fe){return console.error(fe),c({status:"error",title:i("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{f(!1)}},[c,i]),Pe=d.exports.useCallback(async()=>u.length?u:be(),[be,u]),Ie=d.exports.useCallback((O,fe)=>{var Z,ee;const K=fe.find(B=>B.label===O);if(!K){c({status:"warning",title:i("inbounds.vless.authNotFound","Authentication block not available")});return}v.setValue("vlessDecryption",(Z=K.decryption)!=null?Z:"",{shouldDirty:!0}),v.setValue("vlessEncryption",(ee=K.encryption)!=null?ee:"",{shouldDirty:!0})},[v,i,c]),Oe=d.exports.useCallback(async O=>{if(!O){v.setValue("vlessDecryption","",{shouldDirty:!0}),v.setValue("vlessEncryption","",{shouldDirty:!0});return}const fe=await Pe();fe.length&&Ie(O,fe)},[Ie,Pe,v]),Q=d.exports.useCallback(async()=>{const O=v.getValues("vlessSelectedAuth");if(!O){c({status:"info",title:i("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const fe=await be();fe.length&&Ie(O,fe)},[Ie,be,v,i,c]),xe=d.exports.useCallback(()=>{v.setValue("vlessSelectedAuth","",{shouldDirty:!0}),v.setValue("vlessDecryption","",{shouldDirty:!0}),v.setValue("vlessEncryption","",{shouldDirty:!0})},[v]);return d.exports.useEffect(()=>{t&&U==="vless"&&Pe()},[U,Pe,t]),s(Nt,{isOpen:t,onClose:o,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(dt,{}),s(zt,{maxW:{base:"95vw",md:"4xl"},children:[e(ht,{children:n==="create"?i("inbounds.add","Add inbound"):i("inbounds.edit","Edit inbound")}),e(Pt,{}),e(ut,{children:s(oe,{align:"stretch",spacing:6,children:[s(Ce,{spacing:4,borderWidth:"1px",borderColor:ve,borderRadius:"lg",p:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{isRequired:!0,children:[e(C,{children:i("inbounds.tag","Tag")}),e(nt,{...S("tag",{required:!0}),isDisabled:n==="edit"})]}),s(k,{children:[e(C,{children:i("inbounds.listen","Listen address")}),e(nt,{placeholder:"0.0.0.0",...S("listen")})]})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{isRequired:!0,children:[e(C,{children:i("inbounds.port","Port")}),e(nt,{placeholder:"443",...S("port",{required:!0})})]}),s(k,{isRequired:!0,children:[e(C,{children:i("inbounds.protocol","Protocol")}),e(Ls,{...S("protocol",{required:!0}),isDisabled:n==="edit",children:ei.map(O=>e("option",{value:O,children:O.toUpperCase()},O))})]})]}),U==="vmess"&&s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:i("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(ft,{...S("disableInsecureEncryption")})]}),U==="shadowsocks"&&s(k,{children:[e(C,{children:i("inbounds.shadowsocks.network","Allowed networks")}),e(nt,{...S("shadowsocksNetwork")})]}),U==="vless"&&s(Ce,{spacing:3,children:[e(lt,{control:x,name:"vlessSelectedAuth",render:({field:O})=>s(k,{children:[e(C,{children:i("inbounds.vless.authentication","Authentication")}),s(qe,{placeholder:i("inbounds.vless.authPlaceholder","Select authentication"),value:O.value||"",onChange:async fe=>{const K=fe.target.value;O.onChange(K),await Oe(K)},children:[e("option",{value:"",children:i("common.none","None")}),ie.map(fe=>e("option",{value:fe.value,children:fe.label},fe.value))]})]})}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:i("inbounds.vless.decryption","Decryption")}),e(nt,{...S("vlessDecryption")})]}),s(k,{children:[e(C,{children:i("inbounds.vless.encryption","Encryption")}),e(nt,{...S("vlessEncryption")})]})]}),s(E,{spacing:3,children:[e(X,{size:"sm",onClick:Q,isLoading:g,isDisabled:!se,children:i("inbounds.vless.getKeys","Get new keys")}),e(X,{size:"sm",variant:"ghost",onClick:xe,children:i("inbounds.vless.clearKeys","Clear")})]})]})]}),s(Ce,{spacing:4,borderWidth:"1px",borderColor:ve,borderRadius:"lg",p:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:i("inbounds.network","Network")}),e(Ls,{...S("streamNetwork"),children:ih.map(O=>e("option",{value:O,children:O},O))})]}),s(k,{children:[e(C,{children:i("inbounds.security","Security")}),e(Ls,{...S("streamSecurity"),children:oh.map(O=>e("option",{value:O,children:O},O))})]})]}),D==="ws"&&s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:i("inbounds.ws.path","WebSocket path")}),e(nt,{...S("wsPath"),placeholder:"/ws"})]}),s(k,{children:[e(C,{children:i("inbounds.ws.host","WebSocket host header")}),e(nt,{...S("wsHost")})]})]}),D==="tcp"&&s(Ce,{spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.tcp.headerType","TCP header type")}),s(Ls,{...S("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),re==="http"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.tcp.host","HTTP host list")}),e(pn,{...S("tcpHttpHosts"),placeholder:"example.com"})]}),s(k,{children:[e(C,{children:i("inbounds.tcp.path","HTTP path")}),e(nt,{...S("tcpHttpPath")})]})]})]}),D==="grpc"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.grpc.serviceName","Service name")}),e(nt,{...S("grpcServiceName")})]}),s(k,{children:[e(C,{children:i("inbounds.grpc.authority","Authority")}),e(nt,{...S("grpcAuthority")})]}),s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:i("inbounds.grpc.multiMode","Multi mode")}),e(ft,{...S("grpcMultiMode")})]})]}),D==="kcp"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.kcp.headerType","mKCP header")}),e(nt,{...S("kcpHeaderType")})]}),s(k,{children:[e(C,{children:i("inbounds.kcp.seed","mKCP seed")}),e(nt,{...S("kcpSeed")})]})]}),D==="quic"&&s(Ve,{columns:{base:1,md:3},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.quic.security","QUIC security")}),e(nt,{...S("quicSecurity")})]}),s(k,{children:[e(C,{children:i("inbounds.quic.key","QUIC key")}),e(nt,{...S("quicKey")})]}),s(k,{children:[e(C,{children:i("inbounds.quic.headerType","QUIC header type")}),e(nt,{...S("quicHeaderType")})]})]}),D==="httpupgrade"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.httpUpgrade.path","Path")}),e(nt,{...S("httpupgradePath")})]}),s(k,{children:[e(C,{children:i("inbounds.httpUpgrade.host","Host")}),e(nt,{...S("httpupgradeHost")})]})]}),D==="splithttp"&&s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.splitHttp.path","Path")}),e(nt,{...S("splithttpPath")})]}),s(k,{children:[e(C,{children:i("inbounds.splitHttp.host","Host")}),e(nt,{...S("splithttpHost")})]})]}),s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:i("inbounds.sockopt.enable","Enable sockopt")}),e(lt,{control:x,name:"sockoptEnabled",render:({field:O})=>e(ft,{isChecked:Boolean(O.value),onChange:fe=>O.onChange(fe.target.checked)})})]}),e(bn,{in:Boolean(F),animateOpacity:!0,children:s(Ce,{spacing:4,borderWidth:"1px",borderColor:ve,borderRadius:"md",p:4,mt:2,children:[s(Ve,{columns:{base:1,md:2},spacing:3,children:[ne("mark",i("inbounds.sockopt.routeMark","Route mark")),ne("tcpKeepAliveInterval",i("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),ne("tcpKeepAliveIdle",i("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),ne("tcpMaxSeg",i("inbounds.sockopt.tcpMaxSeg","TCP max segment")),ne("tcpUserTimeout",i("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),ne("tcpWindowClamp",i("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[ce("dialerProxy",i("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),ce("interfaceName",i("inbounds.sockopt.interfaceName","Interface name"))]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.sockopt.domainStrategy","Domain strategy")}),e(lt,{control:x,name:"sockopt.domainStrategy",render:({field:O})=>s(qe,{...O,children:[e("option",{value:"",children:i("common.none","None")}),yh.map(fe=>e("option",{value:fe,children:fe},fe))]})})]}),s(k,{children:[e(C,{children:i("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(lt,{control:x,name:"sockopt.tcpcongestion",render:({field:O})=>s(qe,{...O,children:[e("option",{value:"",children:i("common.none","None")}),Sh.map(fe=>e("option",{value:fe,children:fe},fe))]})})]}),s(k,{children:[e(C,{children:i("inbounds.sockopt.tproxy","TProxy")}),e(lt,{control:x,name:"sockopt.tproxy",render:({field:O})=>e(qe,{...O,children:xh.map(fe=>e("option",{value:fe,children:fe},fe))})})]})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[I("acceptProxyProtocol",i("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),I("tcpFastOpen",i("inbounds.sockopt.tcpFastOpen","TCP fast open")),I("tcpMptcp",i("inbounds.sockopt.tcpMptcp","Multipath TCP")),I("penetrate",i("inbounds.sockopt.penetrate","Penetrate")),I("V6Only",i("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),A==="tls"&&s(Ce,{spacing:4,borderWidth:"1px",borderColor:ve,borderRadius:"lg",p:4,children:[s(k,{children:[e(C,{children:i("inbounds.tls.serverName","Server name (SNI)")}),e(nt,{...S("tlsServerName"),placeholder:"example.com"})]}),s(k,{children:[e(C,{children:i("inbounds.tls.fingerprint","uTLS fingerprint")}),s(Ls,{...S("tlsFingerprint"),children:[e("option",{value:"",children:i("common.none","None")}),ah.map(O=>e("option",{value:O,children:O},O))]})]}),s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:i("inbounds.tls.allowInsecure","Allow insecure")}),e(ft,{...S("tlsAllowInsecure")})]})]}),A==="reality"&&s(Ce,{spacing:4,borderWidth:"1px",borderColor:ve,borderRadius:"lg",p:4,children:[s(k,{isRequired:!0,children:[e(C,{children:i("inbounds.reality.privateKey","Reality private key")}),e(pn,{rows:3,...S("realityPrivateKey",{required:!0})}),e(X,{size:"xs",mt:2,variant:"outline",onClick:T,alignSelf:"flex-start",children:i("inbounds.reality.generateKeys","Generate key pair")})]}),s(k,{children:[e(C,{children:i("inbounds.reality.publicKey","Reality public key")}),e(nt,{value:de,isReadOnly:!0,placeholder:i("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:i("inbounds.reality.serverNames","Server names")}),e(pn,{rows:2,...S("realityServerNames"),placeholder:"domain.com"}),e(z,{fontSize:"sm",color:"gray.500",children:i("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),s(k,{children:[e(C,{children:i("inbounds.reality.dest","Destination (host:port)")}),e(nt,{...S("realityDest"),placeholder:"example.com:443"})]})]}),s(k,{children:[e(C,{children:i("inbounds.reality.shortIds","Short IDs")}),e(pn,{rows:2,...S("realityShortIds")}),e(X,{size:"xs",mt:2,variant:"outline",onClick:R,alignSelf:"flex-start",children:i("inbounds.reality.generateShortId","Generate short ID")}),e(z,{fontSize:"sm",color:"gray.500",children:i("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:i("inbounds.reality.spiderX","SpiderX")}),e(nt,{...S("realitySpiderX")})]}),s(k,{children:[e(C,{children:i("inbounds.reality.xver","Xver")}),e(nt,{...S("realityXver")})]})]})]}),Te&&s(Ce,{spacing:3,borderWidth:"1px",borderColor:ve,borderRadius:"lg",p:4,children:[s(Tt,{align:"center",justify:"space-between",children:[e(z,{fontWeight:"medium",children:i("inbounds.fallbacks","Fallbacks")}),e(X,{size:"xs",onClick:q,children:i("inbounds.fallbacks.add","Add fallback")})]}),L.length===0?e(h,{fontSize:"sm",color:"gray.500",children:i("inbounds.fallbacks.empty","No fallbacks configured yet.")}):L.map((O,fe)=>s(z,{borderWidth:"1px",borderRadius:"md",borderColor:ve,p:3,children:[s(Tt,{justify:"space-between",align:"center",mb:3,children:[s(h,{fontWeight:"semibold",children:[i("inbounds.fallbacks.type","Fallback")," #",fe+1]}),e(X,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>_(fe),children:i("hostsPage.delete","Delete")})]}),s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.fallbacks.dest","Destination (host:port)")}),e(nt,{placeholder:"example.com:443",...S(`fallbacks.${fe}.dest`)})]}),s(k,{children:[e(C,{children:i("inbounds.fallbacks.path","Path")}),e(nt,{...S(`fallbacks.${fe}.path`),placeholder:"/"})]}),s(k,{children:[e(C,{children:i("inbounds.fallbacks.type","Type")}),e(nt,{...S(`fallbacks.${fe}.type`),placeholder:"none"})]}),s(k,{children:[e(C,{children:i("inbounds.fallbacks.alpn","ALPN")}),e(nt,{...S(`fallbacks.${fe}.alpn`),placeholder:"h2,http/1.1"})]}),s(k,{children:[e(C,{children:"Xver"}),e(nt,{...S(`fallbacks.${fe}.xver`),placeholder:"0"})]})]})]},O.id))]}),s(Ce,{spacing:4,borderWidth:"1px",borderColor:ve,borderRadius:"lg",p:4,children:[s(Tt,{align:"center",justify:"space-between",children:[s(E,{spacing:2,children:[e(z,{fontWeight:"medium",children:i("inbounds.sniffing","Sniffing")}),e(at,{label:i("inbounds.sniffingHint","It is recommended to keep the default."),children:e(Sc,{width:16,height:16})})]}),e(ft,{...S("sniffingEnabled")})]}),Ae&&s(Ce,{spacing:3,children:[s(k,{children:[e(C,{children:i("inbounds.sniffingDestinations","Protocols to sniff")}),e(lt,{control:x,name:"sniffingDestinations",render:({field:O})=>{var fe;return e(Gn,{value:(fe=O.value)!=null?fe:[],onChange:O.onChange,children:e(E,{spacing:4,children:nh.map(K=>e(pr,{value:K.value,children:K.label},K.value))})})}})]}),s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:i("inbounds.sniffingRouteOnly","Route only")}),e(ft,{...S("sniffingRouteOnly")})]}),s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:0,children:i("inbounds.sniffingMetadataOnly","Metadata only")}),e(ft,{...S("sniffingMetadataOnly")})]})]})]})]})}),s(At,{children:[e(X,{variant:"ghost",mr:3,onClick:o,children:i("hostsPage.cancel","Cancel")}),e(X,{colorScheme:"primary",isLoading:l,onClick:b(N),children:n==="create"?i("common.create","Create"):i("common.save","Save")})]})]})]})},wh=()=>{const{t}=He(),n=Ut(),[r,l]=d.exports.useState([]),[o,a]=d.exports.useState(!0),[i,c]=d.exports.useState(!1),[u,p]=d.exports.useState(null),[g,f]=d.exports.useState({protocol:"all",search:""}),[v,x]=d.exports.useState(null),{isOpen:S,onOpen:b,onClose:w}=Yt(),[P,L]=d.exports.useState("create"),te=or({base:!1,md:!0}),_=d.exports.useCallback(()=>{a(!0),p(null),De("/inbounds/full").then(re=>{l(re||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>a(!1))},[t]);d.exports.useEffect(()=>{_()},[_]);const U=d.exports.useMemo(()=>{const re=g.search.trim().toLowerCase();return r.filter(F=>{var se;return g.protocol!=="all"&&F.protocol!==g.protocol?!1:re?F.tag.toLowerCase().includes(re)||((se=F.port)==null?void 0:se.toString().includes(re)):!0})},[r,g]),D=()=>{L("create"),x(null),b()},A=re=>{L("edit"),x(re),b()},Ae=async re=>{var F;c(!0);try{const se=mh(re),le=P==="create"?"/inbounds":`/inbounds/${encodeURIComponent(se.tag)}`;await De(le,{method:P==="create"?"POST":"PUT",body:se}),n({status:"success",title:P==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),xn(),await _(),w()}catch(se){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((F=se==null?void 0:se.data)==null?void 0:F.detail)||(se==null?void 0:se.message)})}finally{c(!1)}},ge=async re=>{var se;const F=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:re.tag});if(!!window.confirm(F)){c(!0);try{await De(`/inbounds/${encodeURIComponent(re.tag)}`,{method:"DELETE"}),n({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),xn(),await _()}catch(le){n({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((se=le==null?void 0:le.data)==null?void 0:se.detail)||(le==null?void 0:le.message)})}finally{c(!1)}}};return s(Ce,{spacing:4,children:[s(Tt,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(Se,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:g.search,onChange:re=>f(F=>({...F,search:re.target.value}))}),s(E,{spacing:3,children:[s(qe,{width:"180px",value:g.protocol,onChange:re=>f(F=>({...F,protocol:re.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),ei.map(re=>e("option",{value:re,children:re.toUpperCase()},re))]}),e(X,{leftIcon:e(Xr,{width:18,height:18}),onClick:D,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&s(ur,{status:"error",children:[e(hr,{}),u]}),o?e(Tt,{justify:"center",py:10,children:e(kt,{})}):U.length===0?e(z,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):te?e(z,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:s(ms,{variant:"simple",size:"sm",children:[e(zr,{bg:"gray.50",_dark:{bg:"gray.900"},children:s(Dt,{children:[e(Me,{children:t("inbounds.tag","Tag")}),e(Me,{children:t("inbounds.protocol","Protocol")}),e(Me,{children:t("inbounds.portLabel","Port")}),e(Me,{children:t("inbounds.network","Network")}),e(Me,{children:t("inbounds.security","Security")}),e(Me,{children:t("inbounds.sniffing","Sniffing")}),e(Me,{width:"120px",children:t("actions","Actions")})]})}),e(Ir,{children:U.map(re=>{var se;const F=re.streamSettings||{};return s(Dt,{children:[s(Re,{children:[e(h,{fontWeight:"semibold",children:re.tag}),re.listen&&e(h,{fontSize:"sm",color:"gray.500",children:re.listen})]}),e(Re,{children:e(tt,{colorScheme:"purple",children:re.protocol})}),e(Re,{children:re.port}),e(Re,{children:F.network||"\u2014"}),e(Re,{children:F.security&&F.security!=="none"?e(tt,{colorScheme:"blue",children:F.security}):"\u2014"}),e(Re,{children:(se=re.sniffing)!=null&&se.enabled?e(tt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(tt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Re,{children:s(E,{spacing:2,children:[e(ze,{"aria-label":t("common.edit","Edit"),icon:e(is,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>A(re)}),e(ze,{"aria-label":t("common.delete","Delete"),icon:e(Ur,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ge(re),isLoading:i})]})})]},re.tag)})})]})}):e(Ce,{spacing:3,children:U.map(re=>{var se;const F=re.streamSettings||{};return s(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(Tt,{justify:"space-between",align:"center",mb:2,children:[s(z,{children:[e(h,{fontWeight:"semibold",children:re.tag}),s(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",re.port]})]}),s(E,{spacing:2,children:[e(ze,{"aria-label":t("common.edit","Edit"),icon:e(is,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>A(re)}),e(ze,{"aria-label":t("common.delete","Delete"),icon:e(Ur,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ge(re),isLoading:i})]})]}),s(Ce,{spacing:2,children:[s(E,{spacing:2,wrap:"wrap",children:[e(tt,{colorScheme:"purple",children:re.protocol}),F.network&&e(tt,{children:F.network}),F.security&&F.security!=="none"&&e(tt,{colorScheme:"blue",children:F.security})]}),s(E,{spacing:2,wrap:"wrap",children:[(se=re.sniffing)!=null&&se.enabled?e(tt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(tt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),re.listen&&e(tt,{size:"sm",colorScheme:"gray",children:re.listen})]})]})]},re.tag)})}),e(kh,{isOpen:S,mode:P,initialValue:v,isSubmitting:i,onClose:w,onSubmit:Ae})]})},vh=()=>{const{t}=He();return s(oe,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),s($s,{colorScheme:"primary",isLazy:!0,children:[s(Js,{children:[e(Bt,{children:s(E,{spacing:2,children:[e(mn,{as:Po,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(Bt,{children:s(E,{spacing:2,children:[e(mn,{as:yo,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),s(qs,{children:[e(Vt,{px:0,children:s(oe,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(wh,{})]})}),e(Vt,{px:0,children:s(oe,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Zu,{})]})})]})]})]})},Ch=Ee.object({name:Ee.string().min(1),address:Ee.string().min(1),port:Ee.number().min(1).or(Ee.string().transform(t=>parseFloat(t))),api_port:Ee.number().min(1).or(Ee.string().transform(t=>parseFloat(t))),xray_version:Ee.string().nullable().optional(),id:Ee.number().nullable().optional(),status:Ee.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:Ee.string().nullable().optional(),add_as_new_host:Ee.boolean().optional(),usage_coefficient:Ee.number().or(Ee.string().transform(t=>parseFloat(t))),data_limit:Ee.number().nullable().optional(),uplink:Ee.number().nullable().optional(),downlink:Ee.number().nullable().optional()}),Bn=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0}),yr="fetch-nodes-query-key",ti=()=>{const{isEditingNodes:t}=ct();return Gr({queryKey:yr,queryFn:zn.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},zn=Ks((t,n)=>({nodes:[],addNode(r){return De("/node",{method:"POST",body:r})},fetchNodes(){return De("/nodes")},fetchNodesUsage(r){return De("/nodes/usage",{query:r})},updateNode(r){return De(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return De(`/node/${r.id}/reconnect`,{method:"POST"})},resetNodeUsage(r){return De(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return De("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return De("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return De(`/node/${(r=n().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),Bi=({expiryDate:t,status:n,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:a}=He(),i=ga(t),c=ps[n].icon;return s(Mt,{children:[s(Wr,{colorScheme:ps[n].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),l&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[n&&a(`nodeModal.status.${n}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(i.status,{time:i.time})})]})},_h=j(fn,{baseStyle:{w:4,h:4}}),Dh=j(Ya,{baseStyle:{w:4,h:4}}),Ah=j(xc,{baseStyle:{w:4,h:4}}),Ih=j(fo,{baseStyle:{w:4,h:4}}),Vi=1024*1024*1024,Ps=t=>{if(t&&typeof t=="object"&&"message"in t){const n=t.message;return typeof n=="string"?n:void 0}},Ki=({isOpen:t,onClose:n,node:r,mutate:l,isLoading:o,isAddMode:a=!1})=>{var re,F,se,le,ie,ne,I,ce,Te,ve,N,T,R,de;const{t:i}=He(),c=Ut(),[u,p]=d.exports.useState(a),{fetchNodesUsage:g}=zn(),[f,v]=d.exports.useState(null),{data:x,isLoading:S}=Gr({queryKey:"node-settings",queryFn:()=>De("/node/settings")}),b=q=>{if(q==null)return null;const be=q/Vi;return Number.isFinite(be)?Math.round(be*100)/100:null},w=q=>q==null?null:Math.round(q*Vi),P=a?{...Bn(),add_as_new_host:!1}:{...Bn(),...r,add_as_new_host:!1},L=vr({resolver:ua(Ch),defaultValues:{...P,data_limit:b((re=P.data_limit)!=null?re:null)}}),te=(F=x==null?void 0:x.certificate)!=null?F:"",{onCopy:_,hasCopied:U}=Uo(te);d.exports.useEffect(()=>{var q;if(t){const be=a?{...Bn(),add_as_new_host:!1}:{...Bn(),...r,add_as_new_host:!1};L.reset({...be,data_limit:b((q=be.data_limit)!=null?q:null)}),p(a&&!!te)}},[t,a,r,L,te]),d.exports.useEffect(()=>{!a&&r&&t?g({start:Fe().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(q=>{const be=q.usages[r.id];be&&v({uplink:be.uplink,downlink:be.downlink})}):v(null)},[r,a,t,g]);const D=L.handleSubmit(q=>{var Pe;const be={...q,data_limit:w((Pe=q.data_limit)!=null?Pe:null)};l(be)}),A=()=>{!te||(_(),c({title:i("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},Ae=()=>{if(!te)return;const q=new Blob([te],{type:"text/plain"}),be=URL.createObjectURL(q),Pe=document.createElement("a");Pe.href=be,Pe.download="ssl_client_cert.pem",Pe.click(),URL.revokeObjectURL(be)},ge=()=>{p(!1),v(null),n()};return s(Nt,{isOpen:t,onClose:ge,size:"lg",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",as:"form",onSubmit:D,children:[e(ht,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(a?"nodes.addNewMarzbanNode":"nodes.editNode")})}),e(Pt,{mt:3}),e(ut,{children:s(Ce,{spacing:6,children:[!a&&f&&s(Ce,{spacing:2,children:[e(h,{fontWeight:"medium",children:i("nodes.usage")}),s(E,{children:[s(tt,{colorScheme:"green",children:[i("nodes.uplink"),": ",us.sizeFormat(f.uplink)]}),s(tt,{colorScheme:"blue",children:[i("nodes.downlink"),": ",us.sizeFormat(f.downlink)]})]})]}),a&&s(Ce,{spacing:3,children:[s(E,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:i("nodes.certificate")}),s(E,{spacing:2,children:[e(X,{size:"xs",variant:"outline",leftIcon:e(Ah,{}),onClick:A,isDisabled:!te,children:i(U?"copied":"copy")}),e(X,{size:"xs",variant:"outline",leftIcon:e(Ih,{}),onClick:Ae,isDisabled:!te,children:i("nodes.download-certificate")}),e(at,{placement:"top",label:i(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(ze,{"aria-label":i(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p(q=>!q),size:"xs",variant:"ghost",children:u?e(Dh,{}):e(_h,{})})})]})]}),e(bn,{in:u&&!!te,animateOpacity:!0,children:e(z,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:te||(S?i("loading"):"")})}),!te&&!S&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:i("nodes.certificateUnavailable","Certificate not available.")})]}),s(Ce,{spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(sr,{label:i("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...L.register("name"),error:Ps((le=(se=L.formState)==null?void 0:se.errors)==null?void 0:le.name)})}),e(k,{children:e(sr,{label:i("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...L.register("address"),error:Ps((ne=(ie=L.formState)==null?void 0:ie.errors)==null?void 0:ne.address)})})]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(sr,{label:i("nodes.nodePort"),size:"sm",placeholder:"62050",...L.register("port"),error:Ps((ce=(I=L.formState)==null?void 0:I.errors)==null?void 0:ce.port)})}),e(k,{children:e(sr,{label:i("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...L.register("api_port"),error:Ps((ve=(Te=L.formState)==null?void 0:Te.errors)==null?void 0:ve.api_port)})})]}),e(k,{children:e(sr,{label:i("nodes.usageCoefficient"),size:"sm",placeholder:"1",...L.register("usage_coefficient"),error:Ps((T=(N=L.formState)==null?void 0:N.errors)==null?void 0:T.usage_coefficient)})}),s(k,{children:[e(sr,{label:i("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:i("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...L.register("data_limit",{setValueAs:q=>{if(q===""||q===null||q===void 0)return null;const be=Number(q);return Number.isFinite(be)?be:Number.NaN},validate:q=>q==null?!0:Number.isNaN(q)?i("nodes.dataLimitValidation","Data limit must be a valid number"):q>=0||i("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:Ps((de=(R=L.formState)==null?void 0:R.errors)==null?void 0:de.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:i("nodes.dataLimitHint","Leave empty for unlimited data.")})]})]}),a&&e(z,{children:e(pr,{...L.register("add_as_new_host"),children:i("nodes.addHostForEveryInbound")})})]})}),s(At,{gap:3,children:[e(X,{variant:"outline",onClick:ge,children:i("cancel")}),e(X,{type:"submit",colorScheme:"primary",isLoading:o,children:i(a?"nodes.addNode":"nodes.editNode")})]})]})]})},Th=({deleteCallback:t})=>{const{deleteNode:n,deletingNode:r,setDeletingNode:l}=zn(),{t:o}=He(),a=Ut(),i=Za(),c=()=>{l(null)},{isLoading:u,mutate:p}=Er(n,{onSuccess:()=>{Jt(o("deleteNode.deleteSuccess",{name:r&&r.name}),a),l(null),i.invalidateQueries(yr),t&&t()},onError:g=>{Qt(g,a)}});return s(Nt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(ht,{pt:6,children:e(gs,{color:"red",children:e(Pn,{})})}),e(Pt,{mt:3}),s(ut,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(pa,{components:{b:e("b",{})},children:o("deleteNode.prompt",{name:r.name})})})]}),s(At,{display:"flex",children:[e(X,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(X,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:u?e(kt,{size:"xs"}):void 0,children:o("delete")})]})]})]})},Ph=10,Eh=({isOpen:t,title:n,description:r,currentVersion:l,allowPersist:o=!1,isSubmitting:a,onSubmit:i,onClose:c})=>{const{t:u}=He(),[p,g]=d.exports.useState(""),[f,v]=d.exports.useState(!1),[x,S]=d.exports.useState(null),b=Gr(["core-xray-releases"],()=>De("/core/xray/releases",{query:{limit:Ph}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(g(l||""),v(!1),S(null))},[t,l]);const w=d.exports.useMemo(()=>{var U,D;return(D=(U=b.data)==null?void 0:U.tags)!=null?D:[]},[b.data]),P=U=>{g(U.target.value)},L=U=>{g(U.target.value)},te=async()=>{if(!p){S(u("validation.required"));return}try{S(null),await i({version:p,persist:o?f:void 0})}catch(U){U instanceof Error?S(U.message):S(u("core.generalErrorMessage"))}},_=b.isLoading;return s(Nt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(dt,{}),s(zt,{children:[e(ht,{children:n}),e(Pt,{}),e(ut,{children:s(Ce,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),s(k,{children:[e(C,{children:u("nodes.coreVersionDialog.latestReleases")}),e(qe,{placeholder:u(_?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&w.includes(p)?p:"",onChange:P,isDisabled:_||w.length===0,size:"sm",children:w.map(U=>e("option",{value:U,children:U},U))}),_&&s(Ce,{direction:"row",align:"center",spacing:2,mt:2,children:[e(kt,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),b.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),s(k,{isRequired:!0,children:[e(C,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(Se,{value:p,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:L,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),o&&e(pr,{isChecked:f,onChange:U=>v(U.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),x&&s(ur,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(hr,{}),e(as,{children:x})]})]})}),s(At,{children:[e(X,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(X,{colorScheme:"primary",onClick:te,isLoading:a,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},$i="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",Nh=j(Oo,{baseStyle:{w:3.5,h:3.5}}),zh=j(Xr,{baseStyle:{w:3.5,h:3.5}}),Rh=j(Or,{baseStyle:{w:4,h:4}}),Lh=({isOpen:t,title:n,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:o,onSubmit:a,onClose:i})=>{const{t:c}=He(),[u,p]=d.exports.useState("template"),[g,f]=d.exports.useState($i),[v,x]=d.exports.useState(""),[S,b]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[w,P]=d.exports.useState(!0),[L,te]=d.exports.useState(!1),[_,U]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),f(o||$i),x(""),b([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),P(!0),te(!1),U(null))},[t,o]);const D=Gr(["geo-templates",g],()=>De("/core/geo/templates",{query:g?{index_url:g}:void 0}),{enabled:t&&u==="template"&&Boolean(g),staleTime:10*60*1e3}),A=d.exports.useMemo(()=>{var ie,ne;return(ne=(ie=D.data)==null?void 0:ie.templates)!=null?ne:[]},[D.data]);d.exports.useEffect(()=>{A.length>0&&x(ie=>ie||A[0].name)},[A]);const Ae=Qe("gray.50","whiteAlpha.50"),ge=()=>{b(ie=>[...ie,{name:"",url:""}])},re=(ie,ne,I)=>{b(ce=>ce.map((Te,ve)=>ve===ie?{...Te,[ne]:I}:Te))},F=ie=>{b(ne=>ne.filter((I,ce)=>ce!==ie))},se=async()=>{const ie=u==="manual"?S.filter(I=>I.name.trim()&&I.url.trim()):[];if(u==="template"){if(!g.trim()){U(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!v){U(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(ie.length===0){U(c("nodes.geoDialog.errors.missingFiles"));return}if(ie.find(ce=>!ce.name.trim()||!ce.url.trim())){U(c("nodes.geoDialog.errors.invalidFile"));return}}U(null);const ne=u==="manual"?ie:[];try{await a({mode:u,templateIndexUrl:g.trim(),templateName:v,files:ne,persistEnv:w,applyToNodes:L})}catch(I){const ce=I instanceof Error?I.message:c("nodes.geoDialog.genericError");U(ce)}},le=()=>s(Ce,{spacing:3,bg:Ae,p:4,borderRadius:"md",children:[S.map((ie,ne)=>s(z,{borderWidth:"1px",borderRadius:"md",p:3,children:[s(Ve,{columns:{base:1,md:2},spacing:3,children:[s(k,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(Se,{size:"sm",value:ie.name,placeholder:"geosite.dat",onChange:I=>re(ne,"name",I.target.value)})]}),s(k,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(Se,{size:"sm",value:ie.url,placeholder:"https://example.com/geosite.dat",onChange:I=>re(ne,"url",I.target.value)})]})]}),e(E,{justify:"flex-end",mt:3,children:e(at,{label:c("nodes.geoDialog.removeFile"),children:e(ze,{"aria-label":"remove file",icon:e(Nh,{}),variant:"ghost",size:"sm",onClick:()=>F(ne),isDisabled:S.length<=1})})})]},`manual-file-${ne}`)),e(X,{onClick:ge,leftIcon:e(zh,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return s(Nt,{isOpen:t,onClose:i,size:"xl",isCentered:!0,children:[e(dt,{}),s(zt,{children:[e(ht,{children:n}),e(Pt,{}),e(ut,{children:s(Ce,{spacing:4,children:[s(k,{as:"fieldset",children:[e(C,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(aa,{value:u,onChange:ie=>p(ie),children:s(E,{spacing:4,children:[e(Nr,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Nr,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?s(Ce,{spacing:3,children:[s(k,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(Se,{size:"sm",value:g,onChange:ie=>f(ie.target.value)})]}),s(k,{isRequired:!0,children:[e(C,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),s(E,{align:"center",spacing:2,children:[e(qe,{size:"sm",flex:1,value:v,onChange:ie=>x(ie.target.value),isDisabled:D.isLoading||!A.length,placeholder:D.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:A.map(ie=>e("option",{value:ie.name,children:ie.name},ie.name))}),e(at,{label:c("nodes.geoDialog.refreshTemplates"),children:e(ze,{"aria-label":"refresh templates",icon:e(Rh,{}),size:"sm",variant:"outline",onClick:()=>D.refetch(),isLoading:D.isFetching,isDisabled:!g.trim()})})]})]}),D.isError&&s(ur,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(hr,{}),e(as,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):le(),l&&s(Ce,{spacing:2,children:[e(pr,{isChecked:w,onChange:ie=>P(ie.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(pr,{isChecked:L,onChange:ie=>te(ie.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),_&&s(ur,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(hr,{}),e(as,{children:_})]})]})}),s(At,{children:[e(X,{variant:"ghost",mr:3,onClick:i,children:c("cancel")}),e(X,{colorScheme:"primary",onClick:se,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};Fe.extend(Tn);const Mh=j(Xr,{baseStyle:{w:4,h:4}}),Uh=j(Ur,{baseStyle:{w:4,h:4}}),Oh=j(is,{baseStyle:{w:4,h:4}}),Ji=j(Or,{baseStyle:{w:4,h:4}}),Wh=j(vo,{baseStyle:{w:4,h:4}}),cl=1024**3,Fh=t=>{if(t==null)return"";const n=t/cl;return Number.isFinite(n)?(Math.round(n*100)/100).toString():""},qi=t=>{const n=t.trim();if(!n)return null;const r=Number(n);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*cl)},Hh=()=>{var Gs,Rn,Ln,Mn,Un,On,Tr,cs,Wn,Fn,Hn,Xs,Qs;const{t}=He(),{onEditingNodes:n}=ct(),r=ct(ye=>ye.isEditingNodes),{data:l,isLoading:o,error:a,refetch:i,isFetching:c}=ti(),{addNode:u,updateNode:p,reconnectNode:g,resetNodeUsage:f,updateMasterNode:v,resetMasterUsage:x,setDeletingNode:S}=zn(),b=Za(),w=Ut(),[P,L]=d.exports.useState(null),[te,_]=d.exports.useState(!1),[U,D]=d.exports.useState(""),[A,Ae]=d.exports.useState(null),[ge,re]=d.exports.useState(null),[F,se]=d.exports.useState(null),[le,ie]=d.exports.useState(null),[ne,I]=d.exports.useState(!1),[ce,Te]=d.exports.useState(!1),[ve,N]=d.exports.useState(!1),[T,R]=d.exports.useState(null),[de,q]=d.exports.useState({}),[be,Pe]=d.exports.useState(null),[Ie,Oe]=d.exports.useState(null),{isOpen:Q,onOpen:xe,onClose:Y}=Yt(),pe=d.exports.useRef(null),[O,fe]=d.exports.useState(""),[K,Z]=d.exports.useState(!1),{isOpen:ee,onOpen:B,onClose:ke}=Yt(),bt=d.exports.useRef(null),{data:Ye,isLoading:G,refetch:W,error:he}=Gr(["core-stats"],()=>De("/core"),{refetchOnWindowFocus:!1}),{data:we,isLoading:We,error:Ne,refetch:rt}=Gr(["master-node-state"],()=>De("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(n(!0),()=>{n(!1)}),[n]),d.exports.useEffect(()=>{var _t,m;if(!we)return;if(K){const y=qi(O),M=(_t=we.data_limit)!=null?_t:null;if(y!==M)return}const ye=Fh((m=we.data_limit)!=null?m:null);fe(ye),K&&Z(!1)},[we,K,O]);const{isLoading:pt,mutate:It}=Er(u,{onSuccess:()=>{Jt(t("nodes.addNodeSuccess"),w),b.invalidateQueries(yr),_(!1)},onError:ye=>{Qt(ye,w)}}),{isLoading:Ze,mutate:mt}=Er(p,{onSuccess:()=>{Jt(t("nodes.nodeUpdated"),w),b.invalidateQueries(yr),L(null)},onError:ye=>{Qt(ye,w)}}),{isLoading:vt,mutate:Rt}=Er(g,{onSuccess:()=>{b.invalidateQueries(yr)}}),{mutate:Kt,isLoading:jt}=Er(p,{onSuccess:()=>{b.invalidateQueries(yr)},onError:ye=>{Qt(ye,w)},onSettled:(ye,_t,m)=>{(m==null?void 0:m.id)!=null&&q(y=>{const M={...y};return delete M[m.id],M}),R(null)}}),{isLoading:Gt,mutate:er}=Er(f,{onSuccess:()=>{Jt(t("nodes.resetUsageSuccess","Node usage reset"),w),b.invalidateQueries(yr)},onError:ye=>{Qt(ye,w)},onSettled:()=>{Pe(null),Oe(null),Y()}}),{isLoading:Wt,mutate:$}=Er(v,{onSuccess:()=>{Jt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),w),rt(),Z(!1)},onError:ye=>{Qt(ye,w)}}),{isLoading:_e,mutate:Ge}=Er(x,{onSuccess:()=>{Jt(t("nodes.resetMasterUsageSuccess","Master usage reset"),w),rt(),ke()},onError:ye=>{Qt(ye,w)}}),et=d.exports.useMemo(()=>qi(O),[O]),yt=(Gs=we==null?void 0:we.data_limit)!=null?Gs:null,H=et===void 0,ue=et!==void 0&&et!==yt,J=G||We,Xe=d.exports.useMemo(()=>{if(he instanceof Error)return he.message;if(typeof he=="string")return he;if(Ne instanceof Error)return Ne.message;if(typeof Ne=="string")return Ne},[he,Ne]),st=(Rn=we==null?void 0:we.total_usage)!=null?Rn:0,$e=(Ln=we==null?void 0:we.data_limit)!=null?Ln:null,it=(Mn=we==null?void 0:we.remaining_data)!=null?Mn:null,Ct=we!=null&&we.updated_at?Fe(we.updated_at).local().format("YYYY-MM-DD HH:mm"):null,$t=(Un=we==null?void 0:we.status)!=null?Un:"error",gt=Je(st,2),Ot=$e!==null&&$e>0?Je($e,2):t("nodes.unlimited","Unlimited"),Lt=it!=null?Je(it,2):null,St=ye=>{Z(!0),fe(ye)},xt=()=>{if(H||et===void 0){Qt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),w);return}$({data_limit:et!=null?et:null})},gr=()=>{Z(!0),fe(""),$({data_limit:null})},Et=()=>{B()},nr=ye=>{if(!(ye!=null&&ye.id))return;const _t=ye.status!=="disabled",m=_t?"disabled":"connecting",y=ye.id;R(y),q(M=>({...M,[y]:!_t})),Kt({...ye,status:m})},fr=ye=>{!(ye!=null&&ye.id)||(Oe(ye),xe())},lr=()=>{!(Ie!=null&&Ie.id)||(Pe(Ie.id),er(Ie))},Cr=()=>{Oe(null),Y()},br=()=>Ae(null),jr=()=>re(null),xs=async({version:ye,persist:_t})=>{var m;if(!!A){if(A.type==="master"){I(!0);try{await De("/core/xray/update",{method:"POST",body:{version:ye,persist_env:Boolean(_t)}}),Jt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:ye}),w),await Promise.all([W(),b.invalidateQueries(yr)]),br()}catch(y){Qt(y,w)}finally{I(!1)}return}if(A.type==="bulk"){const y=(l!=null?l:[]).filter(M=>M.id!=null&&M.status==="connected");if(y.length===0){w({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}Te(!0);try{const M=[];for(const je of y)try{await De(`/node/${je.id}/xray/update`,{method:"POST",body:{version:ye}}),M.push({status:"fulfilled",node:je})}catch(Xt){M.push({status:"rejected",node:je}),Qt(Xt,w)}const Le=M.filter(je=>je.status==="fulfilled").length,Be=M.length-Le,Ue=M.length;Le>0&&Jt(t("nodes.coreVersionDialog.bulkSuccess",{success:Le,total:Ue}),w),Be>0&&w({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:Be,total:Ue}),status:"error",isClosable:!0,position:"top",duration:4e3}),b.invalidateQueries(yr),br()}finally{Te(!1)}return}if(A.type==="node"){const y=A.node;if(!(y!=null&&y.id))return;se(y.id);try{await De(`/node/${y.id}/xray/update`,{method:"POST",body:{version:ye}}),Jt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(m=y.name)!=null?m:t("nodes.unnamedNode","Unnamed node"),version:ye}),w),b.invalidateQueries(yr),br()}catch(M){Qt(M,w)}finally{se(null)}}}},ks=async ye=>{var m;if(!ge)return;const _t={mode:ye.mode,template_index_url:ye.templateIndexUrl,template_name:ye.templateName,files:ye.files,persist_env:ye.persistEnv};if(ge.type==="master"){N(!0);try{await De("/core/geo/update",{method:"POST",body:_t}),Jt(t("nodes.geoDialog.masterUpdateSuccess"),w),jr()}catch(y){Qt(y,w)}finally{N(!1)}return}if(ge.type==="node"){const y=ge.node;if(!(y!=null&&y.id))return;ie(y.id);try{await De(`/node/${y.id}/geo/update`,{method:"POST",body:_t}),Jt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(m=y.name)!=null?m:t("nodes.unnamedNode","Unnamed node")}),w),b.invalidateQueries(yr),jr()}catch(M){Qt(M,w)}finally{ie(null)}}},ws=d.exports.useMemo(()=>{if(!l)return[];const ye=U.trim().toLowerCase();return ye?l.filter(_t=>{var Le,Be,Ue;const m=((Le=_t.name)!=null?Le:"").toLowerCase(),y=((Be=_t.address)!=null?Be:"").toLowerCase(),M=((Ue=_t.xray_version)!=null?Ue:"").toLowerCase();return m.includes(ye)||y.includes(ye)||M.includes(ye)}):l},[l,U]),ls=d.exports.useMemo(()=>(l!=null?l:[]).some(ye=>ye.id!=null&&ye.status==="connected"),[l]),_r=d.exports.useMemo(()=>{if(!!a){if(a instanceof Error)return a.message;if(typeof a=="string")return a;if(typeof a=="object"&&"message"in a){const ye=a.message;if(typeof ye=="string")return ye}return t("errorOccurred")}},[a,t]),es=Boolean(_r),Fr=t("nodes.masterNode","Master"),ts=U.trim().toLowerCase(),me=!ts||Fr.toLowerCase().includes(ts)||((On=Ye==null?void 0:Ye.version)!=null?On:"").toLowerCase().includes(ts),vs=(A==null?void 0:A.type)==="master"?ne:(A==null?void 0:A.type)==="node"?A.node.id!=null&&F===A.node.id:(A==null?void 0:A.type)==="bulk"?ce:!1,Hr=(ge==null?void 0:ge.type)==="master"?ve:(ge==null?void 0:ge.type)==="node"?ge.node.id!=null&&le===ge.node.id:!1,Cs=(A==null?void 0:A.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(A==null?void 0:A.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(A==null?void 0:A.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Tr=A.node.name)!=null?Tr:t("nodes.unnamedNode","Unnamed node")}):"",_s=(A==null?void 0:A.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(A==null?void 0:A.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(A==null?void 0:A.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(cs=A.node.name)!=null?cs:t("nodes.unnamedNode","Unnamed node")}):"",Ds=(A==null?void 0:A.type)==="master"?(Wn=Ye==null?void 0:Ye.version)!=null?Wn:"":(A==null?void 0:A.type)==="node"&&(Fn=A.node.xray_version)!=null?Fn:"",fa=(ge==null?void 0:ge.type)==="master"?t("nodes.geoDialog.masterTitle"):(ge==null?void 0:ge.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(Hn=ge.node.name)!=null?Hn:t("nodes.unnamedNode","Unnamed node")}):"";return s(oe,{spacing:6,align:"stretch",children:[s(Ce,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),es&&s(ur,{status:"error",borderRadius:"md",children:[e(hr,{}),e(as,{children:_r})]}),s(Ce,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),s(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[s(E,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[s(mr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(Co,{pointerEvents:"none",children:e(Wh,{color:"gray.400"})}),e(Se,{value:U,onChange:ye=>D(ye.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(at,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(ze,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(Ji,{}),variant:"ghost",size:"sm",onClick:()=>i(),isLoading:c})})]}),s(Ce,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(X,{variant:"outline",size:"sm",onClick:()=>Ae({type:"bulk"}),isDisabled:!ls,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(X,{leftIcon:e(Mh,{}),colorScheme:"primary",size:"sm",onClick:()=>_(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),o?e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((ye,_t)=>e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:s(oe,{spacing:3,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${_t}`))}):s(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:[me&&e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:J?s(oe,{spacing:3,align:"center",justify:"center",children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Xe?s(oe,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Xe}),e(X,{size:"sm",variant:"outline",onClick:()=>{W(),rt()},children:t("refresh","Refresh")})]}):we?s(oe,{align:"stretch",spacing:4,children:[s(Ce,{spacing:2,children:[s(E,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:Fr}),e(tt,{colorScheme:"purple",size:"sm",children:Ye!=null&&Ye.version?`Xray ${Ye.version}`:t("nodes.versionUnknown","Version unknown")})]}),s(E,{spacing:2,align:"center",children:[e(Bi,{status:$t,compact:!0}),we.limit_exceeded&&e(tt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Ye!=null&&Ye.started?t("nodes.masterStartedAt",{date:Fe(Ye.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),we.message&&s(ur,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(hr,{}),e(as,{fontSize:"sm",children:we.message})]}),e(Us,{}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:gt})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:Ot})]}),Lt&&s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:Lt})]}),Ct&&s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:Ct})]})]}),s(Ce,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[s(mr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(Se,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:O,onChange:ye=>St(ye.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(wr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(X,{colorScheme:"primary",size:"sm",onClick:xt,isDisabled:!ue||H||Wt,isLoading:Wt,children:t("save","Save")}),e(X,{variant:"ghost",size:"sm",onClick:gr,isDisabled:$e===null||Wt,isLoading:Wt&&$e===null,children:t("nodes.clearDataLimit","Clear limit")})]}),H&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),s(Ce,{direction:{base:"column",sm:"row"},spacing:2,children:[e(X,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>Ae({type:"master"}),isLoading:ne,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(X,{size:"sm",variant:"outline",onClick:()=>re({type:"master"}),isLoading:ve,children:t("nodes.geoDialog.updateMasterButton")}),e(X,{size:"sm",variant:"outline",colorScheme:"red",onClick:Et,isLoading:_e,children:t("nodes.resetUsage","Reset usage")})]})]}):s(oe,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(X,{size:"sm",variant:"outline",onClick:()=>{W(),rt()},children:t("refresh","Refresh")})]})},"master-node"),ws.length>0?ws.map(ye=>{var Xt,ds,rs,Zs;const _t=ye.status||"error",m=ye==null?void 0:ye.id,y=_t!=="disabled"&&_t!=="limited",M=m!=null?de[m]:void 0,Le=M!=null?M:y,Be=m!=null&&T===m&&jt,Ue=m!=null&&F===m,je=m!=null&&le===m;return e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:s(oe,{align:"stretch",spacing:4,children:[s(Ce,{spacing:2,children:[s(E,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:ye.name||t("nodes.unnamedNode","Unnamed node")}),e(ft,{size:"sm",colorScheme:"primary",isChecked:Le,onChange:()=>nr(ye),isDisabled:Be,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),ye.status==="error"&&e(X,{size:"sm",variant:"outline",leftIcon:e(Ji,{}),onClick:()=>Rt(ye),isLoading:vt,children:t("nodes.reconnect")})]}),s(E,{spacing:2,flexWrap:"wrap",children:[e(Bi,{status:_t,compact:!0}),s(E,{spacing:1,align:"center",children:[e(tt,{colorScheme:"blue",size:"sm",children:ye.xray_version?`Xray ${ye.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(X,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>m&&Ae({type:"node",node:ye}),isLoading:Ue,isDisabled:!m,children:t("nodes.updateCoreAction")})]}),e(X,{size:"xs",variant:"ghost",onClick:()=>m&&re({type:"node",node:ye}),isLoading:je,isDisabled:!m,children:t("nodes.updateGeoAction","Update geo")}),e(X,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>fr(ye),isLoading:Gt&&m!=null&&be===m,isDisabled:!m,children:t("nodes.resetUsage","Reset usage")})]}),_t==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(Us,{}),s(Ve,{columns:{base:1,sm:2},spacingY:2,children:[s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:ye.address})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:ye.port})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:ye.api_port})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:ye.usage_coefficient})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Je(((Xt=ye.uplink)!=null?Xt:0)+((ds=ye.downlink)!=null?ds:0),2)})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:ye.data_limit!=null&&ye.data_limit>0?Je(ye.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(Us,{}),s(E,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[s(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(rs=ye.id)!=null?rs:"-"]}),s(_o,{size:"sm",variant:"ghost",children:[e(ze,{"aria-label":t("edit"),icon:e(Oh,{}),onClick:()=>L(ye)}),e(ze,{"aria-label":t("delete"),icon:e(Uh,{}),colorScheme:"red",onClick:()=>S(ye)})]})]})]})},(Zs=ye.id)!=null?Zs:ye.name)}):e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(Eh,{isOpen:Boolean(A),onClose:br,onSubmit:xs,currentVersion:Ds,title:Cs,description:_s,allowPersist:(A==null?void 0:A.type)==="master",isSubmitting:vs}),e(Lh,{isOpen:Boolean(ge),onClose:jr,onSubmit:ks,title:fa,showMasterOptions:(ge==null?void 0:ge.type)==="master",isSubmitting:Hr}),e(yn,{isOpen:Q,leastDestructiveRef:pe,onClose:Cr,children:e(dt,{children:s(Sn,{children:[e(ht,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(ut,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(Qs=(Xs=Ie==null?void 0:Ie.name)!=null?Xs:Ie==null?void 0:Ie.address)!=null?Qs:t("nodes.thisNode","this node")})}),s(At,{children:[e(X,{ref:pe,onClick:Cr,children:t("cancel","Cancel")}),e(X,{colorScheme:"red",onClick:lr,ml:3,isLoading:Gt,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(yn,{isOpen:ee,leastDestructiveRef:bt,onClose:ke,children:e(dt,{children:s(Sn,{children:[e(ht,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(ut,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:Fr})}),s(At,{children:[e(X,{ref:bt,onClick:ke,children:t("cancel","Cancel")}),e(X,{colorScheme:"red",onClick:()=>Ge(),ml:3,isLoading:_e,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Ki,{isOpen:te,onClose:()=>_(!1),mutate:It,isLoading:pt,isAddMode:!0}),e(Ki,{isOpen:!!P,onClose:()=>L(null),node:P||void 0,mutate:mt,isLoading:Ze}),e(Th,{deleteCallback:()=>b.invalidateQueries(yr)})]})},Bh=Ks(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([De("/core").then(({version:n,started:r,logs_websocket:l})=>{t({version:n,started:r,logs_websocket:l})}).catch(n=>{throw console.error("Error fetching /core:",n),n}),De("/core/config").then(n=>{t({config:n})}).catch(n=>{throw console.error("Error fetching /core/config:",n),n})])}finally{t({isLoading:!1})}},updateConfig:n=>(t({isPostLoading:!0}),De("/core/config",{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>De("/core/restart",{method:"POST"})}));const Va=d.exports.forwardRef(({json:t,onChange:n,mode:r="code"},l)=>{const{colorMode:o}=os(),a=d.exports.useRef(null),i=d.exports.useRef(null),c=d.exports.useRef(n),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=n},[n]);const p=d.exports.useCallback(x=>{u.current=x,c.current(x)},[]);d.exports.useEffect(()=>{if(!a.current)return;const x=new kc(a.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:o==="dark"?"ace/theme/one_dark":"ace/theme/github"});i.current=x;const S=x.aceEditor;S&&(S.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),S.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?x.setText(t):t!==void 0&&x.set(t)}catch{typeof t=="string"&&x.updateText(t)}return()=>{x.destroy(),i.current=null}},[]),d.exports.useEffect(()=>{const x=i.current;if(!x)return;const b=(P=>{if(P==null)return"";if(typeof P=="string")return P;try{return JSON.stringify(P,null,2)}catch{return""}})(t);if(b===null)return;if(u.current!==null){let P=u.current;try{P=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,P===b)return}let w=null;try{w=x.getText()}catch{w=null}if(w!==b)if(typeof t=="string")try{x.updateText(b)}catch{x.setText(b)}else{const P=t==null?{}:t;try{x.update(P)}catch{x.set(P)}}},[t]),d.exports.useEffect(()=>{const x=i.current;if(!!x)try{x.getMode&&x.getMode()!==r?x.setMode(r):x.getMode||x.setMode(r)}catch{x.setMode(r)}},[r]),d.exports.useEffect(()=>{var S;const x=(S=i.current)==null?void 0:S.aceEditor;!x||x.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github")},[o]);const g=Qe("gray.300","whiteAlpha.300"),f=Qe("surface.light","surface.dark"),v=Qe("sm","none");return e(z,{ref:l,border:"1px solid",borderColor:g,bg:f,borderRadius:"lg",h:"full",boxShadow:v,overflow:"hidden",children:e(z,{height:"full",ref:a})})}),Vh=j(vn,{baseStyle:{w:4,h:4}}),Kh=j(To,{baseStyle:{w:4,h:4}}),dl=({triggerLabel:t,title:n,children:r})=>{const l=or({base:!0,md:!1});return s(Cn,{placement:l?"bottom":"right",isLazy:!0,children:[e(_n,{children:e(X,{size:"xs",variant:"outline",children:t!=null?t:e(Vh,{})})}),s(Dn,{children:[e(An,{}),e(Mo,{}),n&&e(wc,{fontWeight:"semibold",children:n}),e(In,{children:r})]})]})},$h=({chips:t,color:n="blue"})=>{const r=t[0],l=t.slice(1);return s(E,{spacing:2,align:"center",children:[r?e(tt,{size:"sm",colorScheme:n,children:r}):e(h,{color:"gray.400",children:"-"}),l.length>0&&e(dl,{triggerLabel:s(tt,{size:"sm",children:["+",l.length]}),title:"Details",children:e(oe,{align:"stretch",children:t.map((o,a)=>e(E,{justify:"space-between",children:e(h,{children:o})},a))})})]})},Jh=({text:t,label:n})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:o}=Uo(t!=null?t:"");return e(E,{spacing:2,align:"center",children:e(dl,{triggerLabel:r,title:n,children:s(oe,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),s(E,{children:[e(ze,{"aria-label":"copy",size:"sm",icon:e(Kh,{}),onClick:o}),e(h,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},Yi=500,qh=t=>{try{let n=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(n.protocol==="https:"?"wss://":"ws://")+mo([n.host+n.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+ia()}catch(n){return console.error("Unable to generate websocket url"),console.error(n),null}},ul=({showTitle:t=!0})=>{const{t:n}=He(),{data:r}=ti(),[l,o]=d.exports.useState(""),[a,i]=d.exports.useState([]),c=d.exports.useRef(null),[u,p]=d.exports.useState(!0),{colorMode:g}=os(),f=_=>{if(_!==l){if(!_){o(""),i([]);return}o(_),i([])}},v=d.exports.useCallback(vc.exports.debounce(_=>{i(U=>U.length>=Yi?[...U.slice(U.length-Yi+1),_]:[...U,_])},50),[]);d.exports.useEffect(()=>()=>{v.cancel()},[v]);const{readyState:x}=Cc(qh(l),{onMessage:_=>{var U;v((U=_.data)!=null?U:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const _=c.current;if(!_)return;const U=()=>{const A=_.scrollHeight-_.scrollTop-_.clientHeight<=32;p(A)};return _.addEventListener("scroll",U),U(),()=>{_.removeEventListener("scroll",U)}},[]),d.exports.useEffect(()=>{u&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[a,u]);const S=d.exports.useMemo(()=>{const _=g==="dark";return{error:{bg:_?"rgba(248, 113, 113, 0.16)":"red.50",color:_?"#fed7d7":"#c53030",border:_?"#f87171":"#feb2b2"},warn:{bg:_?"rgba(251, 191, 36, 0.18)":"orange.50",color:_?"#fefcbf":"#975a16",border:_?"#fbbf24":"#f6ad55"},info:{bg:_?"rgba(96, 165, 250, 0.18)":"blue.50",color:_?"#bfdbfe":"#1a56db",border:_?"#60a5fa":"#63b3ed"},debug:{bg:_?"rgba(148, 163, 184, 0.16)":"gray.100",color:_?"#e2e8f0":"#1f2933",border:_?"#94a3b8":"#cbd5e1"},default:{bg:_?"rgba(30, 64, 175, 0.1)":"gray.50",color:_?"#e2e8f0":"#1f2933",border:_?"#475569":"#e2e8f0"}}},[g]),b=Qe("#f5f7fb","#1f2329"),w=Qe("gray.200","gray.600"),P=Qe("gray.500","gray.400"),L=Qe("white","gray.700"),te=_=>/error|failed|exception/i.test(_)?"error":/warn/i.test(_)?"warn":/info/i.test(_)?"info":/debug/i.test(_)?"debug":"default";return s(oe,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:n("header.xrayLogs")}),s(Ce,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[s(Ce,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(r==null?void 0:r[0])&&s(qe,{size:"sm",w:{base:"full",sm:"auto"},bg:L,onChange:_=>f(_.target.value),value:l,children:[e("option",{value:"",children:n("core.master")}),r.map(_=>e("option",{value:String(_.id),children:n(_.name)},_.address))]}),e(h,{fontSize:"sm",color:P,children:n(`core.socket.${x}`)})]}),e(h,{fontSize:"xs",color:P,children:u?n("core.autoScrollOn","Auto-scroll: On"):n("core.autoScrollOff","Auto-scroll: Off")})]}),e(z,{border:"1px solid",borderColor:w,bg:b,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:c,fontFamily:"mono",fontSize:"sm",children:e(oe,{align:"stretch",spacing:2,children:a.map((_,U)=>{var Ae;const D=te(_),A=(Ae=S[D])!=null?Ae:S.default;return e(z,{bg:A.bg,color:A.color,borderLeftWidth:3,borderLeftColor:A.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(j.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:_})},`${_}-${U}`)})})})]})},Yh=j(Xr),Gh=j(Oo),tr={tag:"",protocol:ae.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:sl.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},Es=t=>{const n={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case ae.VMess:n.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case ae.VLESS:n.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case ae.Trojan:n.servers=[{address:r,port:l,password:t.password||void 0}];break;case ae.Shadowsocks:n.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case ae.Socks:case ae.HTTP:n.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case ae.Freedom:n.domainStrategy=t.freedomStrategy||void 0;break;case ae.Blackhole:n.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case ae.DNS:n.network=t.dnsNetwork,n.address=t.dnsAddress||void 0,n.port=Number(t.dnsPort)||void 0;break;case ae.Wireguard:n.secretKey=t.wireguardSecret||void 0,n.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,n.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const o=new ns;o.network=t.network,o.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?o.tcp=new Jr(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?o.ws=new fs(t.wsPath,t.wsHost,0):t.network==="grpc"&&(o.grpc=new bs(t.grpcServiceName,"",!1)),t.tlsEnabled&&(o.tls=new ys(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(o.reality=new Vs(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const i=new Ht(t.tag,t.protocol,n,o,void 0).toJson();return i.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(i.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),i},Xh=({isOpen:t,onClose:n,mode:r,initialOutbound:l,onSubmitOutbound:o})=>{const{t:a}=He(),i=Ut(),c=Qe("gray.50","whiteAlpha.100"),{control:u,register:p,reset:g,handleSubmit:f,watch:v,getValues:x,setValue:S,formState:{isValid:b}}=vr({defaultValues:tr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:w,append:P,remove:L}=Qa({control:u,name:"wireguardPeers"}),te=v("protocol"),_=v("network"),U=v("tlsEnabled"),D=v("realityEnabled"),A=v("tcpType"),Ae=v("muxEnabled"),ge=a("validation.required",{defaultValue:"Required"}),re=a("validation.invalidPort",{defaultValue:"Invalid port"}),F=te||ae.VLESS,se=![ae.Freedom,ae.Blackhole,ae.DNS,ae.Wireguard].includes(F),le=[ae.VMess,ae.VLESS].includes(F),ie=[ae.Trojan,ae.Shadowsocks].includes(F),ne=F===ae.Shadowsocks,I=F===ae.DNS,ce=qt({control:u}),[Te,ve]=d.exports.useState(0),[N,T]=d.exports.useState(()=>Es(tr)),[R,de]=d.exports.useState(()=>JSON.stringify(Es(tr),null,2)),[q,be]=d.exports.useState(null),[Pe,Ie]=d.exports.useState(""),Oe=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;ve(0),be(null),Ie("");const Z=l?xe(l):tr;Oe.current=!0,g(Z);const ee=Es(Z);T(ee),de(JSON.stringify(ee,null,2))},[l,t,g]),d.exports.useEffect(()=>{if(!ce)return;if(Oe.current){Oe.current=!1;return}const Z=Es(ce);T(Z);const ee=JSON.stringify(Z,null,2);de(B=>B===ee?B:ee),be(null)},[ce]);const Q=d.exports.useMemo(()=>[ae.VLESS,ae.VMess,ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP,ae.Freedom,ae.Blackhole,ae.DNS,ae.Wireguard],[]),xe=Z=>{var bt,Ye,G,W,he,we,We,Ne,rt,pt,It,Ze,mt,vt,Rt,Kt,jt,Gt,er,Wt,$,_e,Ge,et,yt,H,ue,J,Xe,st,$e,it,Ct,$t,gt,Ot,Lt,St,xt,gr,Et,nr,fr,lr,Cr,br,jr,xs,ks,ws,ls,_r,es,Fr,ts;const ee=Ht.fromJson(Z),B={...tr,tag:(bt=Z==null?void 0:Z.tag)!=null?bt:"",protocol:(ee==null?void 0:ee.protocol)||tr.protocol,sendThrough:(Ye=Z==null?void 0:Z.sendThrough)!=null?Ye:"",muxEnabled:Boolean((G=Z==null?void 0:Z.mux)==null?void 0:G.enabled),muxConcurrency:Number((he=(W=Z==null?void 0:Z.mux)==null?void 0:W.concurrency)!=null?he:tr.muxConcurrency)},ke=ee==null?void 0:ee.stream;switch(B.network=(we=ke==null?void 0:ke.network)!=null?we:tr.network,B.tlsEnabled=(ke==null?void 0:ke.security)==="tls",B.realityEnabled=(ke==null?void 0:ke.security)==="reality",B.tlsServerName=(Ne=(We=ke==null?void 0:ke.tls)==null?void 0:We.serverName)!=null?Ne:"",B.realityPublicKey=(pt=(rt=ke==null?void 0:ke.reality)==null?void 0:rt.publicKey)!=null?pt:"",B.realityShortId=(Ze=(It=ke==null?void 0:ke.reality)==null?void 0:It.shortId)!=null?Ze:"",(ke==null?void 0:ke.network)==="tcp"&&ke.tcp&&(B.tcpType=ke.tcp.type,B.tcpHost=(mt=ke.tcp.host)!=null?mt:"",B.tcpPath=(vt=ke.tcp.path)!=null?vt:""),(ke==null?void 0:ke.network)==="ws"&&ke.ws&&(B.wsHost=(Rt=ke.ws.host)!=null?Rt:"",B.wsPath=(Kt=ke.ws.path)!=null?Kt:""),(ke==null?void 0:ke.network)==="grpc"&&ke.grpc&&(B.grpcServiceName=(jt=ke.grpc.serviceName)!=null?jt:""),ee!=null&&ee.hasAddressPort()&&(B.address=($=(Wt=(Gt=ee.settings)==null?void 0:Gt.address)!=null?Wt:(er=Z==null?void 0:Z.settings)==null?void 0:er.address)!=null?$:"",B.port=Number((yt=(et=(_e=ee.settings)==null?void 0:_e.port)!=null?et:(Ge=Z==null?void 0:Z.settings)==null?void 0:Ge.port)!=null?yt:tr.port)),B.protocol){case ae.VMess:{const me=ee.settings;B.id=(H=me==null?void 0:me.id)!=null?H:"",B.vnextEncryption=(ue=me==null?void 0:me.security)!=null?ue:tr.vnextEncryption,B.address=(J=me==null?void 0:me.address)!=null?J:B.address,B.port=Number((Xe=me==null?void 0:me.port)!=null?Xe:B.port);break}case ae.VLESS:{const me=ee.settings;B.id=(st=me==null?void 0:me.id)!=null?st:"",B.flow=($e=me==null?void 0:me.flow)!=null?$e:"",B.encryption=(it=me==null?void 0:me.encryption)!=null?it:B.encryption,B.address=(Ct=me==null?void 0:me.address)!=null?Ct:B.address,B.port=Number(($t=me==null?void 0:me.port)!=null?$t:B.port);break}case ae.Trojan:{const me=ee.settings;B.password=(gt=me==null?void 0:me.password)!=null?gt:"",B.address=(Ot=me==null?void 0:me.address)!=null?Ot:B.address,B.port=Number((Lt=me==null?void 0:me.port)!=null?Lt:B.port);break}case ae.Shadowsocks:{const me=ee.settings;B.password=(St=me==null?void 0:me.password)!=null?St:"",B.method=(xt=me==null?void 0:me.method)!=null?xt:tr.method,B.address=(gr=me==null?void 0:me.address)!=null?gr:B.address,B.port=Number((Et=me==null?void 0:me.port)!=null?Et:B.port);break}case ae.Socks:case ae.HTTP:{const me=(B.protocol===ae.Socks,ee.settings);B.user=(nr=me==null?void 0:me.user)!=null?nr:"",B.pass=(fr=me==null?void 0:me.pass)!=null?fr:"",B.address=(lr=me==null?void 0:me.address)!=null?lr:B.address,B.port=Number((Cr=me==null?void 0:me.port)!=null?Cr:B.port);break}case ae.DNS:{const me=ee.settings;B.dnsNetwork=(br=me==null?void 0:me.network)!=null?br:tr.dnsNetwork,B.dnsAddress=(jr=me==null?void 0:me.address)!=null?jr:"",B.dnsPort=Number((xs=me==null?void 0:me.port)!=null?xs:tr.dnsPort);break}case ae.Freedom:{const me=ee.settings;B.freedomStrategy=(ks=me==null?void 0:me.domainStrategy)!=null?ks:"";break}case ae.Blackhole:{const me=ee.settings;B.blackholeResponse=(ws=me==null?void 0:me.type)!=null?ws:"";break}case ae.Wireguard:{const me=ee.settings;B.wireguardSecret=(ls=me==null?void 0:me.secretKey)!=null?ls:"",B.wireguardAddress=(_r=me==null?void 0:me.address)!=null?_r:"";const vs=(Fr=(es=me==null?void 0:me.peers)==null?void 0:es.map(Hr=>{var Cs,_s,Ds;return{publicKey:(Cs=Hr.publicKey)!=null?Cs:"",allowedIPs:Array.isArray(Hr.allowedIPs)?Hr.allowedIPs.join(","):"",endpoint:(_s=Hr.endpoint)!=null?_s:"",keepAlive:Number((Ds=Hr.keepAlive)!=null?Ds:0)}}))!=null?Fr:[];B.wireguardPeers=vs.length>0?vs:tr.wireguardPeers;break}}return((ts=Z==null?void 0:Z.mux)==null?void 0:ts.concurrency)!=null&&(B.muxConcurrency=Number(Z.mux.concurrency)),(!B.wireguardPeers||B.wireguardPeers.length===0)&&(B.wireguardPeers=tr.wireguardPeers),B},Y=Z=>{de(Z);try{const ee=JSON.parse(Z);be(null),T(ee),Oe.current=!0;const B=xe(ee);g(B)}catch(ee){be(ee.message)}},pe=()=>{const Z=Pe.trim();if(!Z){be(a("pages.outbound.configEmpty","Please paste a config link"));return}const ee=Ht.fromLink(Z);if(!ee){be(a("pages.outbound.invalidConfig","Unsupported or invalid config link")),i({status:"error",duration:2500,position:"top",title:a("pages.outbound.configParseFailedTitle","Conversion failed"),description:a("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const B=ee.toJson(),ke=JSON.stringify(B,null,2);Ie(""),Y(ke),i({status:"success",duration:2e3,position:"top",title:a("pages.outbound.configConvertedTitle","Config converted"),description:a("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},O=f(async Z=>{var B;const ee=Es(Z);try{await o(ee),i({title:r==="edit"?a("pages.xray.outbound.updated","Outbound updated"):a("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),n()}catch(ke){i({title:((B=ke==null?void 0:ke.data)==null?void 0:B.detail)||(ke==null?void 0:ke.message)||a("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),fe=()=>{n()},K=Z=>{if(ve(Z),Z===1){const ee=Es(x());T(ee);const B=JSON.stringify(ee,null,2);de(ke=>ke===B?ke:B),be(null)}};return s(Nt,{size:"4xl",isOpen:t,onClose:fe,scrollBehavior:"inside",children:[e(dt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),s(zt,{as:"form",onSubmit:O,children:[e(ht,{children:r==="edit"?a("pages.xray.outbound.editOutbound","Edit Outbound"):a("pages.xray.outbound.addOutbound")}),e(Pt,{}),e(ut,{children:s($s,{variant:"enclosed",colorScheme:"primary",index:Te,onChange:K,children:[s(Js,{children:[e(Bt,{children:a("form")}),e(Bt,{children:a("json")})]}),s(qs,{children:[e(Vt,{children:s(oe,{spacing:6,align:"stretch",children:[s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.basicSettings","Basic settings")}),s(oe,{spacing:3,align:"stretch",children:[s(k,{isRequired:!0,children:[e(C,{children:a("pages.xray.outbound.tag")}),e(Se,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:ge})})]}),s(E,{children:[s(k,{isRequired:!0,children:[e(C,{children:a("protocol")}),e(qe,{size:"sm",...p("protocol"),children:Q.map(Z=>e("option",{value:Z,children:Z},Z))})]}),s(k,{children:[e(C,{children:a("pages.xray.outbound.sendThrough")}),e(Se,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),se&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.endpoint","Endpoint")}),s(oe,{spacing:3,align:"stretch",children:[s(k,{isRequired:se,children:[e(C,{children:a("pages.outbound.address","Address")}),e(Se,{size:"sm",placeholder:"example.com",...p("address",{required:se?ge:!1})})]}),s(E,{children:[s(k,{isRequired:se,children:[e(C,{children:a("pages.outbound.port","Port")}),e(Se,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:se?ge:!1,valueAsNumber:!0,min:{value:1,message:re},max:{value:65535,message:re}})})]}),le?s(k,{isRequired:le,children:[e(C,{children:"ID"}),e(Se,{size:"sm",placeholder:"UUID",...p("id",{required:le?ge:!1})})]}):ie?s(k,{isRequired:ie,children:[e(C,{children:a("password")}),e(Se,{size:"sm",placeholder:"password",...p("password",{required:ie?ge:!1})})]}):s(k,{children:[e(C,{children:a("username")}),e(Se,{size:"sm",placeholder:"username",...p("user")})]})]}),F===ae.Shadowsocks&&s(k,{isRequired:ne,children:[e(C,{children:a("pages.outbound.method","Method")}),e(qe,{size:"sm",...p("method",{required:ne?ge:!1}),children:Object.values(sl).map(Z=>e("option",{value:Z,children:Z},Z))})]}),F===ae.VLESS&&s(E,{children:[s(k,{children:[e(C,{children:a("pages.outbound.encryption","Encryption")}),e(Se,{size:"sm",placeholder:"none",...p("encryption")})]}),s(k,{children:[e(C,{children:"Flow"}),e(Se,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),F===ae.VMess&&s(k,{children:[e(C,{children:a("pages.outbound.security","User security")}),e(Se,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),F===ae.DNS&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.dnsSettings","DNS settings")}),s(E,{children:[s(k,{children:[e(C,{children:a("pages.outbound.network")}),s(qe,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),s(k,{isRequired:I,children:[e(C,{children:a("pages.outbound.port")}),e(Se,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:I?ge:!1,valueAsNumber:!0,min:{value:1,message:re},max:{value:65535,message:re}})})]})]}),s(k,{mt:3,isRequired:I,children:[e(C,{children:a("pages.outbound.address")}),e(Se,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:I?ge:!1})})]})]}),F===ae.Freedom&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.freedom","Freedom options")}),s(k,{children:[e(C,{children:a("pages.outbound.strategy","Strategy")}),e(Se,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),F===ae.Blackhole&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.blackhole","Blackhole options")}),s(k,{children:[e(C,{children:a("pages.outbound.response")}),e(Se,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),F===ae.Wireguard&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.wireguard","Wireguard")}),s(oe,{spacing:3,align:"stretch",children:[s(k,{children:[e(C,{children:a("pages.outbound.secretKey","Secret key")}),e(Se,{size:"sm",...p("wireguardSecret")})]}),s(k,{children:[e(C,{children:a("pages.outbound.address")}),e(Se,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),s(oe,{spacing:3,align:"stretch",children:[s(E,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:a("pages.outbound.peer","Peers")}),e(ze,{size:"sm","aria-label":a("add"),icon:e(Yh,{boxSize:3}),onClick:()=>P({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),w.map((Z,ee)=>s(z,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[s(E,{children:[s(k,{children:[e(C,{children:a("pages.outbound.publicKey","Public key")}),e(Se,{size:"sm",...p(`wireguardPeers.${ee}.publicKey`)})]}),w.length>1&&e(ze,{mt:6,size:"sm","aria-label":a("delete"),icon:e(Gh,{boxSize:3}),onClick:()=>L(ee)})]}),s(E,{mt:2,children:[s(k,{children:[e(C,{children:a("pages.outbound.allowedIPs","Allowed IPs")}),e(Se,{size:"sm",...p(`wireguardPeers.${ee}.allowedIPs`)})]}),s(k,{children:[e(C,{children:a("pages.outbound.endpoint","Endpoint")}),e(Se,{size:"sm",...p(`wireguardPeers.${ee}.endpoint`)})]})]}),s(k,{mt:2,children:[e(C,{children:a("pages.outbound.keepAlive","Keep alive")}),e(Se,{size:"sm",type:"number",...p(`wireguardPeers.${ee}.keepAlive`,{valueAsNumber:!0})})]})]},Z.id))]})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.transport","Transport")}),s(oe,{spacing:3,align:"stretch",children:[s(k,{children:[e(C,{children:a("pages.outbound.network")}),s(qe,{size:"sm",...p("network"),onChange:Z=>{p("network").onChange(Z)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),_==="tcp"&&s(E,{children:[s(k,{children:[e(C,{children:a("pages.outbound.tcpHeader","Header")}),s(qe,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),A==="http"&&s(Mt,{children:[s(k,{children:[e(C,{children:a("host")}),e(Se,{size:"sm",...p("tcpHost")})]}),s(k,{children:[e(C,{children:a("path")}),e(Se,{size:"sm",...p("tcpPath")})]})]})]}),_==="ws"&&s(E,{children:[s(k,{children:[e(C,{children:a("host")}),e(Se,{size:"sm",...p("wsHost")})]}),s(k,{children:[e(C,{children:a("path")}),e(Se,{size:"sm",...p("wsPath")})]})]}),_==="grpc"&&s(k,{children:[e(C,{children:a("serviceName")}),e(Se,{size:"sm",...p("grpcServiceName")})]})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.security")}),s(E,{children:[s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:"0",children:"TLS"}),e(ft,{size:"sm",isChecked:U,onChange:Z=>{const ee=Z.target.checked;S("tlsEnabled",ee),ee&&S("realityEnabled",!1)}})]}),s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:"0",children:"Reality"}),e(ft,{size:"sm",isChecked:D,onChange:Z=>{const ee=Z.target.checked;S("realityEnabled",ee),ee&&S("tlsEnabled",!1)}})]})]}),U&&s(k,{mt:3,children:[e(C,{children:"SNI"}),e(Se,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),D&&s(oe,{spacing:3,align:"stretch",mt:3,children:[s(k,{children:[e(C,{children:"SNI"}),e(Se,{size:"sm",...p("tlsServerName")})]}),s(k,{children:[e(C,{children:a("pages.outbound.publicKey")}),e(Se,{size:"sm",...p("realityPublicKey")})]}),s(k,{children:[e(C,{children:a("pages.outbound.shortId")}),e(Se,{size:"sm",...p("realityShortId")})]})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.mux")}),s(k,{display:"flex",alignItems:"center",children:[e(C,{mb:"0",children:a("pages.outbound.enableMux")}),e(ft,{size:"sm",...p("muxEnabled")})]}),Ae&&s(k,{mt:3,children:[e(C,{children:a("pages.outbound.concurrency")}),e(Se,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(Vt,{children:s(oe,{align:"stretch",spacing:3,children:[s(k,{children:[e(C,{children:a("pages.outbound.configToJson","Config to JSON")}),s(E,{align:"start",spacing:3,children:[e(dr,{value:Pe,onChange:Z=>Ie(Z.target.value),placeholder:a("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(X,{size:"sm",colorScheme:"primary",onClick:pe,children:a("pages.outbound.convertConfig","Convert")})]})]}),e(z,{height:"420px",children:e(Va,{json:N,onChange:Y})}),q&&e(h,{fontSize:"sm",color:"red.500",children:q})]})})]})]})}),s(At,{gap:3,children:[e(X,{variant:"outline",onClick:fe,children:a("cancel")}),e(X,{colorScheme:"primary",type:"submit",isDisabled:!b,children:a(r==="edit"?"save":"add")})]})]})]})},Qh=["tcp","udp","http","quic","grpc"],Zh=["http","tls","bittorrent","quic"],jh=["field","chained"],ep=["","hybrid","linear"],hl={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},Ns=t=>Array.isArray(t)?t.join(", "):"",zs=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(Boolean),tp=t=>{var r,l,o,a;if(!t)return{...hl};const n=t.attrs?Object.entries(t.attrs).map(([i,c])=>({key:i,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(o=t.outboundTag)!=null?o:"",balancerTag:(a=t.balancerTag)!=null?a:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:Ns(t.source),sourcePort:Ns(t.sourcePort),domain:Ns(t.domain),ip:Ns(t.ip),user:Ns(t.user),port:Ns(t.port),attrs:n}},rp=t=>{const n={};t.type&&(n.type=t.type),t.domainMatcher&&(n.domainMatcher=t.domainMatcher),t.outboundTag&&(n.outboundTag=t.outboundTag),t.balancerTag&&(n.balancerTag=t.balancerTag),t.inboundTags.length&&(n.inboundTag=t.inboundTags),t.networks.length&&(n.network=t.networks),t.protocols.length&&(n.protocol=t.protocols);const r=zs(t.sourceIps);r.length&&(n.source=r);const l=zs(t.sourcePort);l.length&&(n.sourcePort=l);const o=zs(t.domain);o.length&&(n.domain=o);const a=zs(t.ip);a.length&&(n.ip=a);const i=zs(t.user);i.length&&(n.user=i);const c=zs(t.port);if(c.length&&(n.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:p,value:g})=>{!p.trim()||(u[p.trim()]=g)}),Object.keys(u).length&&(n.attrs=u)}return n.type||(n.type="field"),n},sp=({isOpen:t,mode:n,initialRule:r,availableInboundTags:l,availableOutboundTags:o,availableBalancerTags:a,onSubmit:i,onClose:c})=>{const{t:u}=He(),p=Qe("white","gray.900"),{control:g,register:f,handleSubmit:v,reset:x,formState:{isSubmitting:S}}=vr({defaultValues:hl}),{fields:b,append:w,remove:P}=Qa({control:g,name:"attrs"});d.exports.useEffect(()=>{t&&x(tp(r))},[t,r,x]);const L=()=>w({key:"",value:""}),te=()=>{c()},_=v(D=>{const A=rp(D);i(A),te()}),U=d.exports.useMemo(()=>n==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[n,u]);return s(Nt,{isOpen:t,onClose:te,size:"xl",scrollBehavior:"inside",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{as:"form",onSubmit:_,bg:p,children:[e(ht,{children:U}),e(Pt,{}),e(ut,{children:s(Ce,{spacing:5,children:[s(k,{children:[e(C,{children:u("pages.xray.rules.type","Rule Type")}),e(qe,{...f("type"),size:"sm",children:jh.map(D=>e("option",{value:D,children:D||u("core.none","None")},D))})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(qe,{...f("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:o.map(D=>e("option",{value:D,children:D},D))})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(qe,{...f("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:a.map(D=>e("option",{value:D,children:D},D))})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(lt,{control:g,name:"inboundTags",render:({field:D})=>e(Gn,{...D,children:e(Xn,{spacing:3,children:l.map(A=>e(gn,{children:e(pr,{value:A,children:A})},A))})})})]}),e(Us,{}),s(k,{children:[e(C,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(qe,{...f("domainMatcher"),size:"sm",children:ep.map(D=>e("option",{value:D,children:D||u("core.default","Default")},D||"empty"))})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.network","Network")}),e(lt,{control:g,name:"networks",render:({field:D})=>e(Gn,{...D,children:e(Xn,{spacing:3,children:Qh.map(A=>e(gn,{children:e(pr,{value:A,children:A})},A))})})})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.protocol","Protocol")}),e(lt,{control:g,name:"protocols",render:({field:D})=>e(Gn,{...D,children:e(Xn,{spacing:3,children:Zh.map(A=>e(gn,{children:e(pr,{value:A,children:A})},A))})})})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.source","Source IPs")}),e(dr,{...f("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(dr,{...f("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.ip","Destination IPs")}),e(dr,{...f("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.domain","Domains")}),e(dr,{...f("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.user","Users")}),e(dr,{...f("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),s(k,{children:[e(C,{children:u("pages.xray.rules.port","Ports")}),e(dr,{...f("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(Us,{}),s(z,{children:[s(k,{children:[e(C,{children:u("pages.xray.rules.attrs","Attributes")}),e(X,{onClick:L,size:"xs",leftIcon:e(Xr,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),s(Ce,{spacing:2,mt:3,children:[b.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),b.map((D,A)=>s(E,{spacing:2,align:"flex-start",children:[e(Se,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...f(`attrs.${A}.key`)}),e(Se,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...f(`attrs.${A}.value`)}),e(ze,{"aria-label":"Remove attribute",icon:e(qa,{width:16}),size:"sm",variant:"ghost",onClick:()=>P(A)})]},D.id))]})]})]})}),s(At,{gap:3,children:[e(X,{variant:"outline",onClick:te,children:u("cancel")}),e(X,{colorScheme:"primary",type:"submit",isLoading:S,children:n==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},np=({isOpen:t,onClose:n,form:r,setBalancersData:l,balancerIndex:o})=>{const{t:a}=He(),i=vr({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=i.handleSubmit(u=>{const p={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},g=r.getValues("config.routing.balancers")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.routing.balancers",g,{shouldDirty:!0}),l(g.map((f,v)=>{var x;return{key:v,tag:f.tag||"",strategy:((x=f.strategy)==null?void 0:x.type)||"random",selector:f.selector||[],fallbackTag:f.fallbackTag||""}})),n()});return s(Nt,{isOpen:t,onClose:n,size:"sm",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(ht,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Pt,{mt:3}),e(ut,{children:e("form",{onSubmit:c,children:s(oe,{spacing:4,children:[s(k,{children:[e(C,{children:a("pages.xray.balancer.tag")}),e(Se,{...i.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),s(k,{children:[e(C,{children:a("pages.xray.balancer.balancerStrategy")}),e(qe,{...i.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),s(k,{children:[e(C,{children:a("pages.xray.balancer.balancerSelectors")}),e(Se,{...i.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),s(k,{children:[e(C,{children:a("pages.xray.balancer.fallbackTag")}),e(Se,{...i.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(X,{type:"submit",colorScheme:"primary",size:"sm",children:a(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},ap=({isOpen:t,onClose:n,form:r,setDnsServers:l,dnsIndex:o})=>{const{t:a}=He(),i=vr({defaultValues:{address:"",domains:"",expectIPs:""}}),c=i.handleSubmit(u=>{const p={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},g=r.getValues("config.dns.servers")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.dns.servers",g,{shouldDirty:!0}),l(g),n()});return s(Nt,{isOpen:t,onClose:n,size:"sm",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(ht,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Pt,{mt:3}),e(ut,{children:e("form",{onSubmit:c,children:s(oe,{spacing:4,children:[s(k,{children:[e(C,{children:a("pages.xray.dns.address")}),e(Se,{...i.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),s(k,{children:[e(C,{children:a("pages.xray.dns.domains")}),e(Se,{...i.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),s(k,{children:[e(C,{children:a("pages.xray.dns.expectIPs")}),e(Se,{...i.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(X,{type:"submit",colorScheme:"primary",size:"sm",children:a(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},ip=({isOpen:t,onClose:n,form:r,setFakeDns:l,fakeDnsIndex:o})=>{const{t:a}=He(),i=vr({defaultValues:{ipPool:"",poolSize:""}}),c=i.handleSubmit(u=>{const p={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},g=r.getValues("config.fakedns")||[];o!==void 0?g[o]=p:g.push(p),r.setValue("config.fakedns",g.length>0?g:null,{shouldDirty:!0}),l(g),n()});return s(Nt,{isOpen:t,onClose:n,size:"sm",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(zt,{mx:"3",children:[e(ht,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Pt,{mt:3}),e(ut,{children:e("form",{onSubmit:c,children:s(oe,{spacing:4,children:[s(k,{children:[e(C,{children:a("pages.xray.fakedns.ipPool")}),e(Se,{...i.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),s(k,{children:[e(C,{children:a("pages.xray.fakedns.poolSize")}),e(Se,{...i.register("poolSize"),size:"sm",placeholder:"100"})]}),e(X,{type:"submit",colorScheme:"primary",size:"sm",children:a(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},Ka={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Gi=t=>{var u,p,g,f,v,x,S,b,w,P,L,te,_;if(!t)return{...Ka};const n=(u=t.settings)!=null?u:{},l=(p=(Array.isArray(n.peers)?n.peers:[])[0])!=null?p:{},o=Array.isArray(n.address)?n.address:[],a=(f=(g=o.find(U=>typeof U=="string"&&U.endsWith("/32")))==null?void 0:g.replace("/32",""))!=null?f:"",i=(x=(v=o.find(U=>typeof U=="string"&&U.endsWith("/128")))==null?void 0:v.replace("/128",""))!=null?x:"",c=Array.isArray(n.reserved)?n.reserved.filter(U=>Number.isFinite(Number(U))).join(","):"";return{tag:(S=t.tag)!=null?S:"warp",privateKey:(w=(b=n.secretKey)!=null?b:n.privateKey)!=null?w:"",publicKey:(P=l.publicKey)!=null?P:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:a,addressV6:i,reserved:c,mtu:(L=n.mtu)!=null?L:1420,domainStrategy:(te=n.domainStrategy)!=null?te:"ForceIP",notes:typeof t.notes=="string"?t.notes:(_=n.notes)!=null?_:""}},op=t=>{const n=[];t.addressV4.trim()&&n.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&n.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(a=>Number(a.trim())).filter(a=>Number.isFinite(a)),o=Ht.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:n,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?o.notes=t.notes.trim():delete o.notes,o},lp=t=>{if(!t)return[];try{const n=atob(t);return Array.from(n).map(r=>r.charCodeAt(0))}catch{return[]}},cp=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const n=t;return n.host?n.port?`${n.host}:${n.port}`:n.host:""}return""},dp=(t,n)=>{var p,g,f,v,x,S,b,w,P,L,te;if(!t||!(n!=null&&n.config))return null;const r=n.config,l=[],o=(g=(p=r.interface)==null?void 0:p.addresses)!=null?g:{};o.v4&&l.push(`${o.v4}/32`),o.v6&&l.push(`${o.v6}/128`);const i=(f=(Array.isArray(r.peers)?r.peers:[])[0])!=null?f:{},c=(x=(v=i.allowed_ips)!=null?v:i.allowedIPs)!=null?x:["0.0.0.0/0","::/0"];return Ht.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(b=(S=r.interface)==null?void 0:S.mtu)!=null?b:1420,secretKey:t.private_key,address:l,reserved:lp(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(P=(w=i.public_key)!=null?w:t.public_key)!=null?P:"",endpoint:cp(i.endpoint),allowedIPs:c,keepAlive:(te=(L=i.keep_alive)!=null?L:i.keepAlive)!=null?te:0}]}})},Xi=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},Pa=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":us.sizeFormat(t),rr=({label:t,value:n})=>{const r=Qe("gray.500","gray.400");return s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:n||"-"})]})},up=({isOpen:t,onClose:n,initialOutbound:r,onSave:l,onDelete:o})=>{var Pe,Ie,Oe,Q,xe;const{t:a}=He(),i=Ut(),[c,u]=d.exports.useState({...Ka}),[p,g]=d.exports.useState(null),[f,v]=d.exports.useState(null),[x,S]=d.exports.useState(null),[b,w]=d.exports.useState(""),[P,L]=d.exports.useState(!1),[te,_]=d.exports.useState(!1),[U,D]=d.exports.useState(!1),[A,Ae]=d.exports.useState(!1),[ge,re]=d.exports.useState(!1);d.exports.useEffect(()=>{gh()},[]);const F=d.exports.useCallback(async()=>{var Y,pe;L(!0);try{const O=await De("/core/warp",{method:"GET"});g((Y=O.account)!=null?Y:null),v(null),S(null)}catch(O){i({title:a("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((pe=O==null?void 0:O.data)==null?void 0:pe.detail)||(O==null?void 0:O.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{L(!1)}},[i,a]);d.exports.useEffect(()=>{t&&F().catch(()=>{})},[t,F]),d.exports.useEffect(()=>{t&&u(Gi(r))},[r,t]),d.exports.useEffect(()=>{var Y;w((Y=p==null?void 0:p.license_key)!=null?Y:"")},[p]);const se=(Y,pe)=>{u(O=>({...O,[Y]:pe}))},le=Qe("gray.600","gray.300"),ie=Qe("gray.200","whiteAlpha.200"),ne=()=>{const Y=la();se("privateKey",Y.privateKey),se("publicKey",Y.publicKey),i({title:a("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},I=()=>{const Y=Array.from({length:3},()=>Math.floor(Math.random()*256));se("reserved",Y.join(","))},ce=d.exports.useCallback((Y,pe)=>{if(!Y||!pe){S(null);return}const O=dp(Y,pe);O&&(S(O),u(Gi(O.toJson())))},[]),Te=async()=>{var Y;_(!0);try{const pe=la(),O=await De("/core/warp/register",{method:"POST",body:{private_key:pe.privateKey,public_key:pe.publicKey}});g(O.account),v(O.config),ce(O.account,O.config),i({title:a("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(pe){i({title:a("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((Y=pe==null?void 0:pe.data)==null?void 0:Y.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{_(!1)}},ve=async()=>{var Y;if(!p){i({title:a("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}Ae(!0);try{const pe=await De("/core/warp/config",{method:"GET"});v(pe.config),ce(p,pe.config),i({title:a("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(pe){i({title:a("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((Y=pe==null?void 0:pe.data)==null?void 0:Y.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{Ae(!1)}},N=async()=>{var Y;if(!!b.trim()){D(!0);try{const pe=await De("/core/warp/license",{method:"POST",body:{license_key:b.trim()}});g(pe.account),i({title:a("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(pe){i({title:a("pages.xray.warp.licenseFailed","Failed to update license."),description:((Y=pe==null?void 0:pe.data)==null?void 0:Y.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{D(!1)}}},T=async()=>{var Y;re(!0);try{await De("/core/warp",{method:"DELETE"}),g(null),v(null),S(null),o(),i({title:a("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(pe){i({title:a("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((Y=pe==null?void 0:pe.data)==null?void 0:Y.detail)||(pe==null?void 0:pe.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{re(!1)}},R=()=>{if(!x)return;const Y=x.toJson();l(Y),i({title:a("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},de=()=>{o(),u({...Ka}),i({title:a("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},q=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){i({title:a("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const Y=op(c);l(Y),n()},be=d.exports.useMemo(()=>Boolean(r),[r]);return s(Nt,{isOpen:t,onClose:n,size:"xl",scrollBehavior:"inside",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),s(zt,{children:[e(ht,{children:a("pages.xray.warp.manage","Manage WARP")}),e(Pt,{}),e(ut,{children:s(oe,{spacing:5,align:"stretch",children:[s(ur,{status:"info",borderRadius:"md",children:[e(hr,{}),e(as,{children:a("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(z,{borderWidth:"1px",borderColor:ie,borderRadius:"lg",p:4,children:p?s(oe,{spacing:4,align:"stretch",children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(rr,{label:a("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(rr,{label:a("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(rr,{label:a("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(rr,{label:a("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(rr,{label:a("pages.xray.warp.registeredAt","Registered at"),value:Xi(p.created_at)}),e(rr,{label:a("pages.xray.warp.updatedAt","Updated at"),value:Xi(p.updated_at)})]}),s(E,{spacing:3,flexWrap:"wrap",children:[e(X,{variant:"outline",onClick:ve,isLoading:A,children:a("pages.xray.warp.fetchInfo","Refresh info")}),e(X,{variant:"ghost",colorScheme:"red",onClick:T,isLoading:ge,children:a("pages.xray.warp.removeAccount","Remove account")})]})]}):s(oe,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:le,children:a("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(X,{colorScheme:"primary",onClick:Te,isLoading:te||P,children:a("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&s(z,{borderWidth:"1px",borderColor:ie,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.licenseSection","WARP+/License key")}),s(E,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(Se,{value:b,onChange:Y=>w(Y.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(X,{colorScheme:"primary",onClick:N,isLoading:U,isDisabled:!b.trim(),children:a("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:le,mt:2,children:a("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),s(z,{borderWidth:"1px",borderColor:ie,borderRadius:"lg",p:4,children:[s(E,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:a("pages.xray.warp.remoteConfig","Remote configuration")}),f?e(Wr,{colorScheme:f.enabled?"green":"yellow",children:f.enabled?a("core.active","Active"):a("core.pending","Pending")}):e(Wr,{colorScheme:"gray",children:a("core.empty","Empty")})]}),f?s(Ce,{spacing:4,children:[s(Ve,{columns:{base:1,md:2},spacing:4,children:[e(rr,{label:a("core.name","Name"),value:(Pe=f.name)!=null?Pe:"-"}),e(rr,{label:a("core.model","Model"),value:(Ie=f.model)!=null?Ie:"-"}),e(rr,{label:a("core.status","Status"),value:f.enabled?a("core.enabled","Enabled"):a("core.disabled","Disabled")}),e(rr,{label:a("core.id","ID"),value:(Oe=f.id)!=null?Oe:"-"})]}),f.account&&s(Mt,{children:[e(Us,{}),s(Ve,{columns:{base:1,md:3},spacing:4,children:[e(rr,{label:a("core.type","Type"),value:(Q=f.account.account_type)!=null?Q:"-"}),e(rr,{label:a("core.role","Role"),value:(xe=f.account.role)!=null?xe:"-"}),e(rr,{label:a("pages.xray.warp.premiumData","WARP+ data"),value:Pa(f.account.premium_data)}),e(rr,{label:a("core.quota","Quota"),value:Pa(f.account.quota)}),e(rr,{label:a("core.usage","Usage"),value:Pa(f.account.usage)})]})]}),s(E,{spacing:3,flexWrap:"wrap",children:[e(X,{colorScheme:"primary",onClick:R,isDisabled:!x,children:a("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(X,{variant:"ghost",onClick:()=>v(null),children:a("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:le,children:a("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),s(z,{borderWidth:"1px",borderColor:ie,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.manualTitle","Manual outbound")}),s(Ce,{spacing:4,children:[s(k,{isRequired:!0,children:[e(C,{children:a("pages.xray.outbound.tag","Tag")}),e(Se,{size:"sm",value:c.tag,onChange:Y=>se("tag",Y.target.value),placeholder:"warp"})]}),s(k,{isRequired:!0,children:[e(C,{children:a("pages.xray.warp.privateKey")}),e(dr,{size:"sm",value:c.privateKey,onChange:Y=>se("privateKey",Y.target.value),rows:2})]}),s(k,{isRequired:!0,children:[e(C,{children:a("pages.xray.warp.publicKey")}),e(dr,{size:"sm",value:c.publicKey,onChange:Y=>se("publicKey",Y.target.value),rows:2})]}),s(k,{children:[e(X,{size:"sm",colorScheme:"primary",onClick:ne,children:a("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:le,mt:1,children:a("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),s(k,{isRequired:!0,children:[e(C,{children:a("pages.xray.warp.endpoint")}),e(Se,{size:"sm",value:c.endpoint,onChange:Y=>se("endpoint",Y.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),s(k,{children:[e(C,{children:a("pages.xray.warp.addressV4","Client IPv4")}),e(Se,{size:"sm",value:c.addressV4,onChange:Y=>se("addressV4",Y.target.value),placeholder:"172.16.0.2"}),e(kr,{children:a("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),s(k,{children:[e(C,{children:a("pages.xray.warp.addressV6","Client IPv6")}),e(Se,{size:"sm",value:c.addressV6,onChange:Y=>se("addressV6",Y.target.value),placeholder:"2606:4700:****:****::****"})]}),s(k,{children:[e(C,{children:a("pages.xray.warp.reserved")}),e(Se,{size:"sm",value:c.reserved,onChange:Y=>se("reserved",Y.target.value),placeholder:"0,0,0"}),e(kr,{children:a("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(X,{size:"xs",mt:2,variant:"ghost",onClick:I,children:a("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),s(k,{children:[e(C,{children:a("pages.xray.warp.mtu","MTU")}),e(Yr,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(Y,pe)=>se("mtu",pe||1420),children:e(qr,{})})]}),s(k,{children:[e(C,{children:a("pages.xray.warp.notes","Notes (optional)")}),e(dr,{size:"sm",rows:2,value:c.notes,onChange:Y=>se("notes",Y.target.value)})]})]})]})]})}),s(At,{display:"flex",justifyContent:"space-between",children:[be?e(X,{colorScheme:"red",variant:"outline",onClick:de,children:a("delete")}):e("span",{}),s(E,{spacing:3,children:[e(X,{variant:"ghost",onClick:n,children:a("cancel")}),e(X,{colorScheme:"primary",onClick:q,children:a(be?"save":"add")})]})]})]})]})},rn=j(Xr,{baseStyle:{w:3.5,h:3.5}}),sn=j(Ur,{baseStyle:{w:4,h:4}}),nn=j(is,{baseStyle:{w:4,h:4}}),Qi=j(Wo,{baseStyle:{w:4,h:4}}),Zi=j(Fo,{baseStyle:{w:4,h:4}}),ji=j(Or,{baseStyle:{w:4,h:4}}),hp=j(_c,{baseStyle:{w:4,h:4}}),pp=j(Dc,{baseStyle:{w:4,h:4}}),mp=j(Ac,{baseStyle:{w:4,h:4}}),gp=j(Ic,{baseStyle:{w:4,h:4}}),fp=j(go,{baseStyle:{w:4,h:4}}),bp=j(Tc,{baseStyle:{w:4,h:4}}),yp=j(Pc,{baseStyle:{w:4,h:4}}),Sp=j(Ec,{baseStyle:{w:4,h:4}}),xp=j(Nc,{baseStyle:{w:4,h:4}}),eo=j(zc,{baseStyle:{w:4,h:4}}),an={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},Vn=t=>JSON.stringify(t!=null?t:{}),to=t=>Array.isArray(t)?t.join(","):t!=null?t:"",kp=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],Ea=({title:t,children:n})=>{const r=Qe("gray.50","whiteAlpha.100"),l=Qe("gray.200","whiteAlpha.300");return s(z,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(z,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(z,{overflowX:"auto",children:e(ms,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(Ir,{children:n})})})]})},Dr=({label:t,controlId:n,children:r})=>{const l=Qe("gray.700","whiteAlpha.800");return s(Dt,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Re,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(C,{htmlFor:n,mb:{base:2,md:0},color:l,children:t})}),e(Re,{py:3,display:{base:"block",md:"table-cell"},children:e(k,{id:n,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(n)})})]})},on=({children:t})=>{const n=Qe("gray.200","whiteAlpha.200"),r=Qe("white","blackAlpha.400"),l=Qe("sm","none");return e(z,{borderWidth:"1px",borderColor:n,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(z,{overflowX:"auto",children:t})})},ln=({children:t,...n})=>{const r=Qe("gray.50","whiteAlpha.100"),l=Qe("gray.200","whiteAlpha.300"),o=Qe("gray.300","whiteAlpha.300"),a=Qe("gray.100","whiteAlpha.200"),i=Qe("gray.50","whiteAlpha.100");return e(ms,{size:"sm",w:"full",...n,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:o,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:a,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:i}},children:t})},wp=()=>{var Xs,Qs,ye,_t;const{t}=He(),{fetchCoreSettings:n,updateConfig:r,isLoading:l,config:o,isPostLoading:a,restartCore:i}=Bh(),{onEditingCore:c}=ct(),u=Ut(),{isOpen:p,onOpen:g,onClose:f}=Yt(),{isOpen:v,onOpen:x,onClose:S}=Yt(),{isOpen:b,onOpen:w,onClose:P}=Yt(),{isOpen:L,onOpen:te,onClose:_}=Yt(),{isOpen:U,onOpen:D,onClose:A}=Yt(),{isOpen:Ae,onOpen:ge,onClose:re}=Yt(),F=vr({defaultValues:{config:o||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),se=d.exports.useRef(Vn(F.getValues("config"))),le=qt({control:F.control,name:"config"}),ie=d.exports.useMemo(()=>Vn(le)!==se.current,[le]),[ne,I]=d.exports.useState([]),[ce,Te]=d.exports.useState([]),[ve,N]=d.exports.useState([]),[T,R]=d.exports.useState([]),[de,q]=d.exports.useState([]),[be,Pe]=d.exports.useState([]),[Ie,Oe]=d.exports.useState(null),[Q,xe]=d.exports.useState(null),[Y,pe]=d.exports.useState(!1),[O,fe]=d.exports.useState("xraySetting"),[K,Z]=d.exports.useState(""),ee=or({base:!0,md:!1}),[B,ke]=d.exports.useState(0),[bt,Ye]=d.exports.useState(""),[G,W]=d.exports.useState(""),he=d.exports.useCallback(m=>m.map((y,M)=>{var Le,Be;return{key:`${M}-${(Be=(Le=y.tag)!=null?Le:y.protocol)!=null?Be:"outbound"}`,...y}}),[]),we=d.exports.useCallback(m=>{I(he(m))},[he]),We=d.exports.useCallback(()=>{const m=F.getValues("config.outbounds");return Array.isArray(m)?JSON.parse(JSON.stringify(m)):[]},[F]),Ne=d.exports.useCallback(m=>{F.setValue("config.outbounds",m,{shouldDirty:!0}),we(m),ke(y=>y+1)},[F,we]),rt=d.exports.useCallback(m=>m.map((y,M)=>{var Le,Be,Ue,je,Xt,ds,rs,Zs,ri,si,ni,ai,ii,oi,li;return{key:`${M}-${(Be=(Le=y.outboundTag)!=null?Le:y.balancerTag)!=null?Be:"rule"}`,source:(Ue=y.source)!=null?Ue:[],sourcePort:(je=y.sourcePort)!=null?je:[],network:(Xt=y.network)!=null?Xt:[],protocol:(ds=y.protocol)!=null?ds:[],attrs:y.attrs?JSON.stringify(y.attrs,null,2):"",ip:(rs=y.ip)!=null?rs:[],domain:(Zs=y.domain)!=null?Zs:[],port:(ri=y.port)!=null?ri:[],inboundTag:(si=y.inboundTag)!=null?si:[],user:(ni=y.user)!=null?ni:[],outboundTag:(ai=y.outboundTag)!=null?ai:"",balancerTag:(ii=y.balancerTag)!=null?ii:"",type:(oi=y.type)!=null?oi:"field",domainMatcher:(li=y.domainMatcher)!=null?li:""}}),[]),pt=d.exports.useCallback(m=>{Te(rt(m))},[rt]),It=d.exports.useCallback(m=>{F.setValue("config.routing.rules",m,{shouldDirty:!0}),pt(m),ke(y=>y+1)},[F,pt]),Ze=d.exports.useCallback(()=>{const m=F.getValues("config.routing.rules");return Array.isArray(m)?JSON.parse(JSON.stringify(m)):[]},[F]);d.exports.useEffect(()=>{const m=()=>{pe(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",m),()=>{document.removeEventListener("fullscreenchange",m)}},[]),d.exports.useEffect(()=>(c(!0),n().then(()=>{console.log("Core settings fetched successfully")}).catch(m=>{u({title:t("core.errorFetchingConfig"),description:m.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>c(!1)),[n,c,u,t]),d.exports.useEffect(()=>{var m,y,M,Le;o&&(F.reset({config:o}),se.current=Vn(o),we((o==null?void 0:o.outbounds)||[]),pt(((m=o==null?void 0:o.routing)==null?void 0:m.rules)||[]),N(((M=(y=o==null?void 0:o.routing)==null?void 0:y.balancers)==null?void 0:M.map((Be,Ue)=>{var je;return{key:Ue,tag:Be.tag||"",strategy:((je=Be.strategy)==null?void 0:je.type)||"random",selector:Be.selector||[],fallbackTag:Be.fallbackTag||""}}))||[]),R(((Le=o==null?void 0:o.dns)==null?void 0:Le.servers)||[]),q((o==null?void 0:o.fakedns)||[]),Z(o!=null&&o.observatory?"observatory":o!=null&&o.burstObservatory?"burstObservatory":""),ke(Be=>Be+1))},[o,F,we,pt]);const{mutate:mt,isLoading:vt}=Er(i,{onSuccess:()=>{u({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:m=>{var y,M;u({title:t("core.generalErrorMessage"),description:((M=(y=m.response)==null?void 0:y.data)==null?void 0:M.detail)||m.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Rt=F.handleSubmit(({config:m})=>{r(m).then(()=>{F.reset({config:m}),se.current=Vn(m),u({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(y=>{let M=t("core.generalErrorMessage");typeof y.response._data.detail=="object"&&(M=y.response._data.detail[Object.keys(y.response._data.detail)[0]]),typeof y.response._data.detail=="string"&&(M=y.response._data.detail),u({title:M,status:"error",isClosable:!0,position:"top",duration:3e3})})}),Kt=async()=>{const m=await De("/panel/xray/getOutboundsTraffic");m!=null&&m.success&&Pe(m.obj)},jt=()=>{xe(null),f()},Gt=()=>{xe(null),g()},er=m=>{xe(m),g()},Wt=m=>{const y=We();m<0||m>=y.length||(y.splice(m,1),Ne(y))},$=(m,y)=>{const M=We();if(m<0||m>=M.length||y<0||y>=M.length)return;const[Le]=M.splice(m,1);M.splice(y,0,Le),Ne(M)},_e=m=>{$(m,m-1)},Ge=m=>{$(m,m+1)},et=()=>{Oe(null),x()},yt=m=>{Oe(m),x()},H=m=>{const y=Ze();y.splice(m,1),It(y)},ue=(m,y)=>{const M=Ze();if(m<0||m>=M.length||y<0||y>=M.length)return;const[Le]=M.splice(m,1);M.splice(y,0,Le),It(M)},J=m=>{const y=Ze();Ie!==null&&Ie>=0&&Ie<y.length?y[Ie]=m:y.push(m),It(y),Oe(null)},Xe=()=>{Oe(null),S()},st=()=>{w()},$e=m=>{w()},it=m=>{const y=[...ve],M=y.splice(m,1)[0];F.setValue("config.routing.balancers",y,{shouldDirty:!0}),N(y);const Le={...F.getValues("config")};Le.observatory&&(Le.observatory.subjectSelector=Le.observatory.subjectSelector.filter(Be=>Be!==M.tag)),Le.burstObservatory&&(Le.burstObservatory.subjectSelector=Le.burstObservatory.subjectSelector.filter(Be=>Be!==M.tag)),F.setValue("config",Le,{shouldDirty:!0})},Ct=()=>{te()},$t=m=>{te()},gt=m=>{const y=[...T];y.splice(m,1),F.setValue("config.dns.servers",y,{shouldDirty:!0}),R(y)},Ot=()=>{D()},Lt=m=>{D()},St=m=>{const y=[...de];y.splice(m,1),F.setValue("config.fakedns",y.length>0?y:null,{shouldDirty:!0}),q(y)},xt=m=>{var y,M,Le,Be,Ue;switch(m.protocol){case"vmess":case"vless":return((y=m.settings.vnext)==null?void 0:y.map(je=>`${je.address}:${je.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((M=m.settings.servers)==null?void 0:M.map(je=>`${je.address}:${je.port}`))||[];case"dns":return[`${(Le=m.settings)==null?void 0:Le.address}:${(Be=m.settings)==null?void 0:Be.port}`];case"wireguard":return((Ue=m.settings.peers)==null?void 0:Ue.map(je=>je.endpoint))||[];default:return[]}},gr=m=>{const y=be.find(M=>M.tag===m.tag);return y?`${us.sizeFormat(y.up)} / ${us.sizeFormat(y.down)}`:`${us.sizeFormat(0)} / ${us.sizeFormat(0)}`},Et=d.exports.useMemo(()=>Array.isArray(le==null?void 0:le.outbounds)?le.outbounds:[],[le]),nr=d.exports.useMemo(()=>{var m;return Array.isArray((m=le==null?void 0:le.routing)==null?void 0:m.rules)?le.routing.rules:[]},[le]),fr=d.exports.useMemo(()=>{var m;return Array.from(new Set(((m=le==null?void 0:le.inbounds)!=null?m:[]).map(y=>y==null?void 0:y.tag).filter(y=>Boolean(y))))},[le]),lr=d.exports.useMemo(()=>Array.from(new Set(Et.map(m=>m==null?void 0:m.tag).filter(m=>Boolean(m)))),[Et]),Cr=d.exports.useMemo(()=>{var m,y;return Array.from(new Set(((y=(m=le==null?void 0:le.routing)==null?void 0:m.balancers)!=null?y:[]).map(M=>M==null?void 0:M.tag).filter(M=>Boolean(M))))},[le]),br=d.exports.useMemo(()=>Et.length===0?-1:Et.findIndex(m=>(m==null?void 0:m.protocol)==="freedom"),[Et]),jr=d.exports.useMemo(()=>{var y,M;if(br<0)return"";const m=Et[br];return(M=(y=m==null?void 0:m.settings)==null?void 0:y.domainStrategy)!=null?M:""},[br,Et]),xs=m=>{const y=F.getValues("config")||{},M=Array.isArray(y.outbounds)?JSON.parse(JSON.stringify(y.outbounds)):[],Le=M.findIndex(je=>(je==null?void 0:je.protocol)==="freedom");if(Le===-1)return;const Be={...M[Le]},Ue={...Be.settings||{}};m?Ue.domainStrategy=m:delete Ue.domainStrategy,Be.settings=Ue,M[Le]=Be,F.setValue("config.outbounds",M,{shouldDirty:!0}),I(M.map((je,Xt)=>({key:Xt,...je}))),ke(je=>je+1)},ks=d.exports.useMemo(()=>{var m;return(m=Et.find(y=>(y==null?void 0:y.tag)==="warp"))!=null?m:null},[Et]),ls=d.exports.useMemo(()=>Et.findIndex(m=>(m==null?void 0:m.tag)==="warp"),[Et])!==-1,_r=d.exports.useMemo(()=>{const m=nr.find(y=>y.outboundTag==="warp");return Array.isArray(m==null?void 0:m.domain)?m.domain:[]},[nr]),es=m=>{const y=m.map(Ue=>Ue.trim()).filter((Ue,je,Xt)=>Ue.length>0&&Xt.indexOf(Ue)===je),M=Ze(),Le=M.findIndex(Ue=>Ue.outboundTag==="warp");if(y.length===0){Le!==-1&&(M.splice(Le,1),It(M));return}const Be={type:"field",outboundTag:"warp",domain:y};Le!==-1?M[Le]={...M[Le],...Be}:M.push(Be),It(M)},Fr=m=>{const y=m.trim();!y||_r.includes(y)||es([..._r,y])},ts=m=>{es(_r.filter(y=>y!==m))},me=Qe("white","blackAlpha.400"),vs=Qe("gray.200","whiteAlpha.200"),Hr=Qe("gray.600","gray.300"),Cs=m=>{var Be;const y=We(),M=(Be=m.tag)!=null?Be:"warp",Le=y.findIndex(Ue=>(Ue==null?void 0:Ue.tag)===M);Le>=0?y[Le]=m:y.push(m),Ne(y)},_s=()=>{const m=We(),y=m.findIndex(M=>(M==null?void 0:M.tag)==="warp");y!==-1&&(m.splice(y,1),Ne(m),es([]),Ye(""),W(""))},Ds=m=>{const y=We();Q!==null&&Q>=0&&Q<y.length?y[Q]=m:y.push(m),Ne(y),xe(null)},fa=()=>{re()},Gs=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{pe(!1)}).catch(m=>{console.error("Error exiting fullscreen:",m)}):document.documentElement.requestFullscreen().then(()=>{pe(!0)}).catch(m=>{console.error("Error entering fullscreen:",m)})},Rn=()=>{var y,M,Le,Be;const m=F.getValues("config")||{};switch(O){case"inboundSettings":return JSON.stringify((y=m.inbounds)!=null?y:[],null,2);case"outboundSettings":return JSON.stringify((M=m.outbounds)!=null?M:[],null,2);case"routingRuleSettings":return JSON.stringify((Be=(Le=m.routing)==null?void 0:Le.rules)!=null?Be:[],null,2);case"xraySetting":default:return JSON.stringify(m!=null?m:{},null,2)}},Ln=m=>{var y,M,Le,Be;try{const Ue=JSON.parse(m),je={...F.getValues("config")||{}};switch(O){case"inboundSettings":je.inbounds=Ue;break;case"outboundSettings":je.outbounds=Ue,we(Ue);break;case"routingRuleSettings":je.routing||(je.routing={}),je.routing.rules=Ue,pt(Ue);break;case"xraySetting":default:F.setValue("config",Ue,{shouldDirty:!0}),we((Ue==null?void 0:Ue.outbounds)||[]),pt(((y=Ue==null?void 0:Ue.routing)==null?void 0:y.rules)||[]),N(((Le=(M=Ue==null?void 0:Ue.routing)==null?void 0:M.balancers)==null?void 0:Le.map((Xt,ds)=>{var rs;return{key:ds,tag:Xt.tag||"",strategy:((rs=Xt.strategy)==null?void 0:rs.type)||"random",selector:Xt.selector||[],fallbackTag:Xt.fallbackTag||""}}))||[]),R(((Be=Ue==null?void 0:Ue.dns)==null?void 0:Be.servers)||[]),q((Ue==null?void 0:Ue.fakedns)||[]);return}F.setValue("config",je,{shouldDirty:!0})}catch{}},Mn=()=>{var y,M;const m=F.getValues("config")||{};return K==="observatory"?JSON.stringify((y=m.observatory)!=null?y:{},null,2):K==="burstObservatory"?JSON.stringify((M=m.burstObservatory)!=null?M:{},null,2):""},Un=m=>{try{const y=JSON.parse(m),M={...F.getValues("config")||{}};K==="observatory"&&(M.observatory=y),K==="burstObservatory"&&(M.burstObservatory=y),F.setValue("config",M,{shouldDirty:!0})}catch{}},On=m=>!m&&m!==0?[]:Array.isArray(m)?m.map(y=>typeof y=="string"?y.trim():String(y)).filter(Boolean):typeof m=="string"?m.split(",").map(y=>y.trim()).filter(Boolean):[String(m)],Tr=(m,y="blue")=>{const M=On(m);return M.length?e($h,{chips:M,color:y}):e(h,{color:"gray.400",children:"-"})},cs=m=>{if(m==null||m===""||typeof m=="string"&&!m.trim())return e(h,{color:"gray.400",children:"-"});const y=typeof m=="string"?m:String(m);return y.length>30?e(Jh,{text:y,label:t("details")}):e(h,{children:y})},Wn=m=>{if(!m)return e(h,{color:"gray.400",children:"-"});try{const y=JSON.parse(m);if(y&&typeof y=="object"&&!Array.isArray(y)){const M=Object.entries(y);return M.length?e(z,{display:"flex",flexWrap:"wrap",gap:"1",children:M.map(([Le,Be])=>e(tt,{colorScheme:"purple",size:"sm",children:`${Le}: ${String(Be)}`},Le))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:m})},Fn=Mn(),Hn=Rn();return s(oe,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(Ce,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:s(Ce,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(X,{size:"sm",colorScheme:"primary",isLoading:a,isDisabled:!ie||a,onClick:Rt,w:{base:"full",sm:"auto"},children:t("core.save")}),e(X,{size:"sm",leftIcon:e(ji,{}),isLoading:vt,onClick:()=>mt(),variant:"outline",w:{base:"full",sm:"auto"},children:t(vt?"core.restarting":"core.restartCore")})]})}),s($s,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[s(Js,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(Bt,{children:s(E,{spacing:2,align:"center",children:[e(mp,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(Bt,{children:s(E,{spacing:2,align:"center",children:[e(gp,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(Bt,{children:s(E,{spacing:2,align:"center",children:[e(fp,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(Bt,{children:s(E,{spacing:2,align:"center",children:[e(bp,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(Bt,{children:s(E,{spacing:2,align:"center",children:[e(yp,{}),e(h,{as:"span",children:t("DNS")})]})}),e(Bt,{children:s(E,{spacing:2,align:"center",children:[e(Sp,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(Bt,{children:s(E,{spacing:2,align:"center",children:[e(xp,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),s(qs,{children:[e(Vt,{children:s(oe,{spacing:4,align:"stretch",children:[s(Ea,{title:t("pages.xray.generalConfigs"),children:[e(Dr,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:m=>s(qe,{id:m,size:"sm",maxW:"220px",value:jr,onChange:y=>xs(y.target.value),isDisabled:br===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(y=>e("option",{value:y,children:y},y))]})}),e(Dr,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:m=>e(lt,{name:"config.routing.domainStrategy",control:F.control,render:({field:y})=>e(qe,{...y,id:m,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(M=>e("option",{value:M,children:M},M))})})})]}),e(z,{borderWidth:"1px",borderColor:vs,borderRadius:"lg",bg:me,p:{base:3,md:4},children:s(oe,{align:"stretch",spacing:3,children:[s(E,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(X,{variant:"outline",size:"sm",leftIcon:e(eo,{}),onClick:ge,children:ls?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:Hr,children:t("pages.xray.warpRoutingDesc")}),s(Xn,{children:[_r.length===0&&e(gn,{children:e(tt,{colorScheme:"gray",variant:"subtle",children:e(pi,{children:t("core.empty","Empty")})})}),_r.map(m=>e(gn,{children:s(tt,{colorScheme:"primary",borderRadius:"full",children:[e(pi,{children:m}),e(Rc,{"aria-label":t("core.remove"),onClick:()=>ts(m)})]})},m))]}),s(E,{spacing:3,flexWrap:"wrap",children:[e(qe,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:bt,onChange:m=>{const{value:y}=m.target;y&&Fr(y),Ye("")},children:kp.map(m=>e("option",{value:m.value,children:m.label},m.value))}),s(E,{spacing:2,maxW:"320px",flex:"1",children:[e(Se,{size:"sm",value:G,onChange:m=>W(m.target.value),placeholder:"geosite:google"}),e(X,{size:"sm",colorScheme:"primary",onClick:()=>{Fr(G),W("")},isDisabled:!G.trim(),children:t("core.add")})]})]})]})}),s(Ea,{title:t("pages.xray.statistics"),children:[e(Dr,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:m=>e(lt,{name:"config.policy.system.statsInboundUplink",control:F.control,render:({field:y})=>e(ft,{id:m,isChecked:!!y.value,onChange:M=>y.onChange(M.target.checked)})})}),e(Dr,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:m=>e(lt,{name:"config.policy.system.statsInboundDownlink",control:F.control,render:({field:y})=>e(ft,{id:m,isChecked:!!y.value,onChange:M=>y.onChange(M.target.checked)})})}),e(Dr,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:m=>e(lt,{name:"config.policy.system.statsOutboundUplink",control:F.control,render:({field:y})=>e(ft,{id:m,isChecked:!!y.value,onChange:M=>y.onChange(M.target.checked)})})}),e(Dr,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:m=>e(lt,{name:"config.policy.system.statsOutboundDownlink",control:F.control,render:({field:y})=>e(ft,{id:m,isChecked:!!y.value,onChange:M=>y.onChange(M.target.checked)})})})]}),s(Ea,{title:t("pages.xray.logConfigs"),children:[e(Dr,{label:t("pages.xray.logLevel"),controlId:"log-level",children:m=>e(lt,{name:"config.log.loglevel",control:F.control,render:({field:y})=>e(qe,{...y,id:m,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(M=>e("option",{value:M,children:M},M))})})}),e(Dr,{label:t("pages.xray.accessLog"),controlId:"access-log",children:m=>e(lt,{name:"config.log.access",control:F.control,render:({field:y})=>s(qe,{...y,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(M=>e("option",{value:M,children:M},M))]})})}),e(Dr,{label:t("pages.xray.errorLog"),controlId:"error-log",children:m=>e(lt,{name:"config.log.error",control:F.control,render:({field:y})=>s(qe,{...y,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(M=>e("option",{value:M,children:M},M))]})})}),e(Dr,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:m=>e(lt,{name:"config.log.maskAddress",control:F.control,render:({field:y})=>s(qe,{...y,id:m,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(M=>e("option",{value:M,children:M},M))]})})}),e(Dr,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:m=>e(lt,{name:"config.log.dnsLog",control:F.control,render:({field:y})=>e(ft,{id:m,isChecked:!!y.value,onChange:M=>y.onChange(M.target.checked)})})})]})]})}),e(Vt,{children:s(oe,{spacing:4,align:"stretch",children:[e(X,{leftIcon:e(rn,{}),...an,onClick:et,children:t("pages.xray.rules.add")}),e(on,{children:s(ln,{minW:"1100px",children:[s(zr,{children:[s(Dt,{children:[e(Me,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(Me,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(Me,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(Me,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(Me,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(Me,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(Me,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(Me,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),s(Dt,{children:[e(Me,{children:t("IP",{defaultValue:"IP"})}),e(Me,{children:t("port",{defaultValue:"Port"})}),e(Me,{children:t("network",{defaultValue:"Network"})}),e(Me,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(Me,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(Me,{children:t("IP",{defaultValue:"IP"})}),e(Me,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(Me,{children:t("port",{defaultValue:"Port"})}),e(Me,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(Me,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),s(Ir,{children:[ce.length===0&&e(Dt,{children:e(Re,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),ce.map((m,y)=>s(Dt,{children:[e(Re,{children:s(oe,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:y+1}),s(E,{spacing:1,children:[e(ze,{"aria-label":"move up",icon:e(Qi,{}),size:"xs",variant:"ghost",isDisabled:y===0,onClick:()=>ue(y,y-1)}),e(ze,{"aria-label":"move down",icon:e(Zi,{}),size:"xs",variant:"ghost",isDisabled:y===ce.length-1,onClick:()=>ue(y,y+1)})]})]})}),e(Re,{children:Tr(m.source,"blue")}),e(Re,{children:cs(m.sourcePort)}),e(Re,{children:Tr(m.network,"purple")}),e(Re,{children:Tr(m.protocol,"green")}),e(Re,{children:Wn(m.attrs)}),e(Re,{children:Tr(m.ip,"blue")}),e(Re,{children:Tr(m.domain,"blue")}),e(Re,{children:cs(m.port)}),e(Re,{children:Tr(m.inboundTag,"teal")}),e(Re,{children:Tr(m.user,"cyan")}),e(Re,{children:cs(m.outboundTag)}),e(Re,{children:cs(m.balancerTag)}),e(Re,{children:s(E,{spacing:1,children:[e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>yt(y)}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>H(y)})]})})]},m.key))]})]})})]})}),e(Vt,{children:s(oe,{spacing:4,align:"stretch",children:[s(E,{children:[e(X,{leftIcon:e(rn,{}),...an,onClick:Gt,children:t("pages.xray.outbound.addOutbound")}),e(X,{leftIcon:e(eo,{}),size:"xs",variant:"ghost",onClick:ge,children:ls?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(X,{leftIcon:e(ji,{}),size:"xs",variant:"ghost",onClick:Kt,children:t("refresh")})]}),e(on,{children:s(ln,{minW:"880px",children:[e(zr,{children:s(Dt,{children:[e(Me,{children:"#"}),e(Me,{children:t("pages.xray.outbound.tag")}),e(Me,{children:t("protocol")}),e(Me,{children:t("pages.xray.outbound.address")}),e(Me,{children:t("pages.inbounds.traffic")})]})}),e(Ir,{children:ne.map((m,y)=>{var M,Le,Be;return s(Dt,{children:[e(Re,{children:s(E,{children:[e(h,{children:y+1}),e(ze,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(Qi,{}),size:"xs",variant:"ghost",isDisabled:y===0,onClick:()=>_e(y)}),e(ze,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(Zi,{}),size:"xs",variant:"ghost",isDisabled:y===ne.length-1,onClick:()=>Ge(y)}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>er(y)}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Wt(y)})]})}),e(Re,{children:m.tag}),s(Re,{children:[e(tt,{colorScheme:"purple",children:m.protocol}),["vmess","vless","trojan","shadowsocks"].includes(m.protocol)&&s(Mt,{children:[e(tt,{colorScheme:"blue",children:(M=m.streamSettings)==null?void 0:M.network}),((Le=m.streamSettings)==null?void 0:Le.security)==="tls"&&e(tt,{colorScheme:"green",children:"tls"}),((Be=m.streamSettings)==null?void 0:Be.security)==="reality"&&e(tt,{colorScheme:"green",children:"reality"})]})]}),e(Re,{children:xt(m).map(Ue=>e(h,{children:Ue},Ue))}),e(Re,{children:e(tt,{colorScheme:"green",children:gr(m)})})]},m.key)})})]})})]})}),e(Vt,{children:s(oe,{spacing:4,align:"stretch",children:[e(X,{leftIcon:e(rn,{}),...an,onClick:st,children:t("pages.xray.balancer.addBalancer")}),e(on,{children:s(ln,{minW:"680px",children:[e(zr,{children:s(Dt,{children:[e(Me,{children:"#"}),e(Me,{children:t("pages.xray.balancer.tag")}),e(Me,{children:t("pages.xray.balancer.balancerStrategy")}),e(Me,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(Ir,{children:ve.map((m,y)=>s(Dt,{children:[e(Re,{children:s(E,{children:[e(h,{children:y+1}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>$e()}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>it(y)})]})}),e(Re,{children:m.tag}),e(Re,{children:e(tt,{colorScheme:m.strategy==="random"?"purple":"green",children:m.strategy==="random"?"Random":m.strategy==="roundRobin"?"Round Robin":m.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Re,{children:m.selector.map(M=>e(tt,{colorScheme:"blue",m:1,children:M},M))})]},m.key))})]})}),(((Xs=F.getValues("config"))==null?void 0:Xs.observatory)||((Qs=F.getValues("config"))==null?void 0:Qs.burstObservatory))&&s(oe,{spacing:3,align:"stretch",children:[e(aa,{onChange:m=>{Z(m),ke(y=>y+1)},value:K,children:s(E,{spacing:3,children:[((ye=F.getValues("config"))==null?void 0:ye.observatory)&&e(Nr,{value:"observatory",children:"Observatory"}),((_t=F.getValues("config"))==null?void 0:_t.burstObservatory)&&e(Nr,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(z,{h:"300px",children:e(Va,{json:Fn,onChange:m=>Un(m)},`obs-${K}-${B}`)})]})]})}),e(Vt,{children:s(oe,{spacing:4,align:"stretch",children:[s(k,{display:"flex",alignItems:"center",children:[e(C,{children:t("pages.xray.dns.enable")}),e(lt,{name:"config.dns",control:F.control,render:({field:m})=>e(ft,{isChecked:!!m.value,onChange:y=>{const M={...F.getValues("config")};y.target.checked?M.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete M.dns,delete M.fakedns),F.setValue("config",M,{shouldDirty:!0}),R([]),q([])}})})]}),T.length>0&&s(Mt,{children:[e(X,{leftIcon:e(rn,{}),...an,onClick:Ct,children:t("pages.xray.dns.add")}),e(on,{children:s(ln,{minW:"720px",children:[e(zr,{children:s(Dt,{children:[e(Me,{children:"#"}),e(Me,{children:t("pages.xray.outbound.address")}),e(Me,{children:t("pages.xray.dns.domains")}),e(Me,{children:t("pages.xray.dns.expectIPs")})]})}),e(Ir,{children:T.map((m,y)=>s(Dt,{children:[e(Re,{children:s(E,{children:[e(h,{children:y+1}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>$t()}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>gt(y)})]})}),e(Re,{children:typeof m=="object"?m.address:m}),e(Re,{children:typeof m=="object"?to(m.domains):""}),e(Re,{children:typeof m=="object"?to(m.expectIPs):""})]},y))})]})})]}),de.length>0&&s(Mt,{children:[e(X,{leftIcon:e(rn,{}),...an,onClick:Ot,children:t("pages.xray.fakedns.add")}),e(on,{children:s(ln,{minW:"520px",children:[e(zr,{children:s(Dt,{children:[e(Me,{children:"#"}),e(Me,{children:t("pages.xray.fakedns.ipPool")}),e(Me,{children:t("pages.xray.fakedns.poolSize")})]})}),e(Ir,{children:de.map((m,y)=>s(Dt,{children:[e(Re,{children:s(E,{children:[e(h,{children:y+1}),e(ze,{"aria-label":"edit",icon:e(nn,{}),size:"xs",variant:"ghost",onClick:()=>Lt()}),e(ze,{"aria-label":"delete",icon:e(sn,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>St(y)})]})}),e(Re,{children:m.ipPool}),e(Re,{children:m.poolSize})]},y))})]})})]})]})}),e(Vt,{children:s(oe,{spacing:4,align:"stretch",children:[s(z,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(z,{px:2,children:e(aa,{onChange:m=>{fe(m),ke(y=>y+1)},value:O,children:s(E,{spacing:3,wrap:"wrap",children:[e(Nr,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Nr,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Nr,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Nr,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),s(z,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(ze,{position:Y?"fixed":"absolute",top:2,right:2,"aria-label":Y?"Exit Full Screen":"Full Screen",icon:Y?e(pp,{}):e(hp,{}),onClick:Gs,zIndex:Y?1101:10}),e(z,{w:Y?"100vw":"100%",h:Y?"100vh":"100%",position:Y?"fixed":"relative",top:Y?0:"auto",left:Y?0:"auto",zIndex:Y?1e3:"auto",children:e(Va,{json:Hn,onChange:m=>{Ln(m)}},`advanced-${O}-${B}`)}),Y&&ee&&e(X,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:Gs,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(Vt,{children:e(z,{children:e(ul,{showTitle:!1})})})]})]}),e(Xh,{isOpen:p,onClose:jt,mode:Q!==null?"edit":"create",initialOutbound:Q!==null?Et[Q]:null,onSubmitOutbound:Ds}),e(sp,{isOpen:v,mode:Ie!==null?"edit":"create",initialRule:Ie!==null&&nr[Ie]||null,availableInboundTags:fr,availableOutboundTags:lr,availableBalancerTags:Cr,onSubmit:J,onClose:Xe}),e(up,{isOpen:Ae,onClose:fa,initialOutbound:ks,onSave:Cs,onDelete:_s}),e(np,{isOpen:b,onClose:P,form:F,setBalancersData:N}),e(ap,{isOpen:L,onClose:_,form:F,setDnsServers:R}),e(ip,{isOpen:U,onClose:A,form:F,setFakeDns:q})]})},vp=({isOpen:t,onClose:n,onSubmit:r,isSaving:l,allHosts:o,allAdmins:a,initialService:i})=>{var I,ce,Te,ve;const{t:c}=He(),[u,p]=d.exports.useState((I=i==null?void 0:i.name)!=null?I:""),[g,f]=d.exports.useState((ce=i==null?void 0:i.description)!=null?ce:""),[v,x]=d.exports.useState((Te=i==null?void 0:i.admin_ids)!=null?Te:[]),[S,b]=d.exports.useState((ve=i==null?void 0:i.hosts.map(N=>N.id))!=null?ve:[]),[w,P]=d.exports.useState(""),[L,te]=d.exports.useState(""),[_,U]=d.exports.useState(null),D=Ut();d.exports.useEffect(()=>{var N,T,R,de;t&&(p((N=i==null?void 0:i.name)!=null?N:""),f((T=i==null?void 0:i.description)!=null?T:""),x((R=i==null?void 0:i.admin_ids)!=null?R:[]),b((de=i==null?void 0:i.hosts.map(q=>q.id))!=null?de:[]),P(""),te(""))},[t,i]);const A=d.exports.useMemo(()=>new Map(o.map(N=>[N.id,N])),[o]),Ae=d.exports.useMemo(()=>o.filter(N=>!S.includes(N.id)&&!N.isDisabled),[o,S]),ge=d.exports.useMemo(()=>{const N=L.trim().toLowerCase();return N?Ae.filter(T=>{const R=T.label.toLowerCase(),de=T.inboundTag.toLowerCase(),q=T.protocol.toLowerCase();return R.includes(N)||de.includes(N)||q.includes(N)}):Ae},[Ae,L]),re=d.exports.useMemo(()=>{const N=w.trim().toLowerCase();return N?a.filter(T=>T.username.toLowerCase().includes(N)):a},[w,a]),F=d.exports.useMemo(()=>new Set(v),[v]),se=N=>{x(T=>T.includes(N)?T.filter(R=>R!==N):[...T,N])},le=N=>{b(T=>T.includes(N)?T.filter(R=>R!==N):[...T,N])},ie=(N,T)=>{b(R=>{const de=R.indexOf(N);if(de===-1)return R;const q=T==="up"?de-1:de+1;if(q<0||q>=R.length)return R;const be=[...R];return[be[de],be[q]]=[be[q],be[de]],be})},ne=async()=>{if(!u.trim()){D({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!S.length){D({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const N=S.map((T,R)=>({host_id:T,sort:R}));await r({name:u.trim(),description:(g==null?void 0:g.trim())||null,admin_ids:v,hosts:N},i==null?void 0:i.id)};return s(Nt,{isOpen:t,onClose:n,size:"5xl",children:[e(dt,{}),s(zt,{children:[e(ht,{children:i?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Pt,{}),e(ut,{children:s(Ce,{spacing:6,children:[s(E,{spacing:4,children:[e(sr,{label:c("services.fields.name","Name"),value:u,onChange:N=>p(N.target.value),maxLength:128,isRequired:!0}),e(sr,{label:c("services.fields.description","Description"),value:g!=null?g:"",onChange:N=>f(N.target.value),maxLength:256})]}),s(z,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),s(Ce,{spacing:3,children:[e(sr,{value:w,onChange:N=>P(N.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(oe,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:a.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):re.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):re.map(N=>{const T=F.has(N.id);return e(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:T?"primary.400":"gray.200",bg:T?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:T?"primary.300":"gray.600",bg:T?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>se(N.id),onKeyDown:R=>{(R.key==="Enter"||R.key===" ")&&(R.preventDefault(),se(N.id))},role:"button",tabIndex:0,children:s(Tt,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:N.username}),T&&e(Wr,{colorScheme:"primary",children:c("services.selected","Selected")})]})},N.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),s(Xa,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(hs,{children:s(Mr,{variant:"outline",h:"full",children:[e(Ms,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e($r,{children:s(Ce,{spacing:3,children:[e(sr,{value:L,onChange:N=>te(N.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(oe,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:Ae.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):ge.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):ge.map(N=>s(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:_===N.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>U(N.id),onMouseLeave:()=>U(null),onClick:()=>le(N.id),children:[e(h,{fontWeight:"medium",children:N.label}),s(h,{fontSize:"sm",color:"gray.500",children:[N.protocol.toUpperCase()," - ",N.inboundTag]})]},N.id))})]})})]})}),e(hs,{children:s(Mr,{variant:"outline",h:"full",children:[e(Ms,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e($r,{children:s(oe,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[S.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),S.map((N,T)=>{const R=A.get(N);return R?e(Lc.div,{layout:!0,children:s(Tt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[s(z,{children:[s(E,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:R.label}),R.isDisabled&&e(Wr,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),s(h,{fontSize:"sm",color:"gray.500",children:[R.protocol.toUpperCase()," - ",R.inboundTag]})]}),s(E,{spacing:1,children:[e(at,{label:c("services.moveUp","Move up"),children:e(ze,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(Wo,{width:16}),onClick:()=>ie(N,"up"),isDisabled:T===0})}),e(at,{label:c("services.moveDown","Move down"),children:e(ze,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(Fo,{width:16}),onClick:()=>ie(N,"down"),isDisabled:T===S.length-1})}),e(at,{label:c("services.removeHost","Remove host"),children:e(ze,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(Ur,{width:16}),onClick:()=>le(N)})})]})]})},N):null})]})})]})})]})]})}),e(At,{children:s(E,{justify:"flex-end",w:"full",children:[e(X,{onClick:n,children:c("cancel")}),e(X,{colorScheme:"primary",onClick:ne,isLoading:l,children:c(i?"saveChanges":"create")})]})})]})]})},Cp=()=>{var fe;const{t}=He(),n=Ut(),{userData:r,getUserIsSuccess:l}=Ss(),o=l&&r.is_sudo,a=Os(),i=Zr(),c=Qo(),{inbounds:u,refetchUsers:p}=ct(),g=Yt(),[f,v]=d.exports.useState(null);d.exports.useEffect(()=>{!l||!o||(a.fetchServices(),i.fetchAdmins({limit:500,offset:0}),xn(),c.fetchHosts())},[l,o]);const x=d.exports.useMemo(()=>i.admins.slice().sort((K,Z)=>K.username.localeCompare(Z.username)).map(K=>({id:K.id,username:K.username})),[i.admins]),S=d.exports.useMemo(()=>{var Z,ee;const K=[];for(const[B,ke]of Object.entries(c.hosts)){const bt=(Z=Array.from(u.values()).flat().find(G=>G.tag===B))!=null?Z:null,Ye=(ee=bt==null?void 0:bt.protocol)!=null?ee:"unknown";ke.forEach(G=>{G.id!=null&&K.push({id:G.id,label:G.remark,inboundTag:B,protocol:Ye,isDisabled:Boolean(G.is_disabled)})})}return K},[c.hosts,u]),b=()=>{v(null),g.onOpen()},w=async K=>{try{const Z=await a.fetchServiceDetail(K);v(Z),g.onOpen()}catch{n({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},P=async(K,Z)=>{var ee,B;try{Z?(await a.updateService(Z,K),n({status:"success",title:t("services.updated","Service updated")})):(await a.createService(K),n({status:"success",title:t("services.created","Service created")})),p(),g.onClose()}catch(ke){n({status:"error",title:(B=(ee=ke==null?void 0:ke.data)==null?void 0:ee.detail)!=null?B:t("services.saveFailed","Failed to save service")})}},L=async K=>{var Z,ee;try{const B=await a.fetchServiceDetail(K);Te(B),Oe()}catch(B){n({status:"error",title:(ee=(Z=B==null?void 0:B.data)==null?void 0:Z.detail)!=null?ee:t("services.deleteFailed","Unable to delete service")})}},te=async K=>{var Z,ee;try{await a.resetServiceUsage(K),n({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(B){n({status:"error",title:(ee=(Z=B==null?void 0:B.data)==null?void 0:Z.detail)!=null?ee:t("services.resetFailed","Failed to reset usage")})}},[_,U]=d.exports.useState(null),[D,A]=d.exports.useState(!1),{isOpen:Ae,onOpen:ge,onClose:re}=Yt(),F=d.exports.useRef(null),se=K=>{U(K),ge()},le=async()=>{if(_!=null){A(!0);try{await te(_)}finally{A(!1),re()}}},ie=_!=null?(fe=a.services.find(K=>K.id===_))==null?void 0:fe.name:void 0,ne=()=>{Te(null),Q()},I=async()=>{var Z,ee;if(!ce)return;const K={mode:ce.user_count?ve:"delete_users",unlink_admins:T};if(K.mode==="transfer_users"){if(!de){n({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}K.target_service_id=de}Pe(!0);try{await a.deleteService(ce.id,K),n({status:"success",title:t("services.deleted","Service removed")}),p(),ne()}catch(B){n({status:"error",title:(ee=(Z=B==null?void 0:B.data)==null?void 0:Z.detail)!=null?ee:t("services.deleteFailed","Unable to delete service")})}finally{Pe(!1)}},[ce,Te]=d.exports.useState(null),[ve,N]=d.exports.useState("delete_users"),[T,R]=d.exports.useState(!1),[de,q]=d.exports.useState(null),[be,Pe]=d.exports.useState(!1),{isOpen:Ie,onOpen:Oe,onClose:Q}=Yt(),xe=d.exports.useMemo(()=>ce?a.services.filter(K=>K.id!==ce.id):a.services,[ce,a.services]);d.exports.useEffect(()=>{ce&&(N("delete_users"),R(ce.admin_ids.length>0),q(null))},[ce]),d.exports.useEffect(()=>{ve==="delete_users"&&q(null)},[ve]);const Y=K=>e(No,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:Z})=>s(Mt,{children:[s(zo,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[s(z,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:K.name}),K.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:Z?3:1,mt:1,children:K.description})]}),s(oe,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[s(E,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:K.host_count})]}),s(E,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:K.user_count})]})]}),e(Mc,{})]}),e(Ro,{pt:0,pb:4,children:s(Ce,{spacing:4,children:[s(Ve,{columns:2,spacing:3,children:[s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:Je(K.used_traffic)})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:Je(K.lifetime_used_traffic)})]})]}),s(Ce,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),s(E,{spacing:2,flexWrap:"wrap",children:[e(at,{label:t("services.view","View"),children:e(ze,{"aria-label":"View",icon:e(fn,{width:18}),size:"sm",variant:"outline",onClick:ee=>{ee.stopPropagation(),a.fetchServiceDetail(K.id)}})}),e(at,{label:t("services.edit","Edit"),children:e(ze,{"aria-label":"Edit",icon:e(Ma,{width:18}),size:"sm",variant:"outline",onClick:ee=>{ee.stopPropagation(),w(K.id)},isDisabled:!o})}),e(at,{label:t("services.resetUsage","Reset usage"),children:e(ze,{"aria-label":"Reset usage",icon:e(Or,{width:18}),size:"sm",variant:"outline",onClick:ee=>{ee.stopPropagation(),se(K.id)},isDisabled:!o})}),e(at,{label:t("services.delete","Delete"),children:e(ze,{"aria-label":"Delete",icon:e(Ur,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:ee=>{ee.stopPropagation(),L(K.id)},isDisabled:!o})})]})]})]})})]})},`service-accordion-${K.id}`),pe=K=>s(Dt,{children:[e(Re,{children:s(oe,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:K.name}),K.description&&e(h,{fontSize:"sm",color:"gray.500",children:K.description})]})}),e(Re,{children:K.host_count}),e(Re,{children:K.user_count}),e(Re,{children:Je(K.used_traffic)}),e(Re,{children:Je(K.lifetime_used_traffic)}),e(Re,{children:s(E,{spacing:2,children:[e(at,{label:t("services.view","View"),children:e(ze,{"aria-label":"View",icon:e(fn,{width:18}),size:"sm",variant:"ghost",onClick:()=>a.fetchServiceDetail(K.id)})}),o&&s(Mt,{children:[e(at,{label:t("services.edit","Edit"),children:e(ze,{"aria-label":"Edit",icon:e(Ma,{width:18}),size:"sm",variant:"ghost",onClick:()=>w(K.id)})}),e(at,{label:t("services.resetUsage","Reset usage"),children:e(ze,{"aria-label":"Reset usage",icon:e(Or,{width:18}),size:"sm",variant:"ghost",onClick:()=>se(K.id)})}),e(at,{label:t("services.delete","Delete"),children:e(ze,{"aria-label":"Delete",icon:e(Ur,{width:18}),size:"sm",variant:"ghost",onClick:()=>L(K.id)})})]})]})})]},K.id),O=a.serviceDetail;return l?o?s(oe,{spacing:4,align:"stretch",children:[s(Tt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[s(z,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),o&&e(X,{leftIcon:e(Xr,{width:18}),colorScheme:"primary",onClick:b,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(Mr,{variant:"outline",children:e($r,{children:a.isLoading?e(Tt,{justify:"center",py:10,children:e(kt,{})}):s(Mt,{children:[e(Eo,{allowToggle:!0,display:{base:"block",md:"none"},children:a.services.map(Y)}),e(z,{display:{base:"none",md:"block"},overflowX:"auto",children:s(ms,{variant:"simple",children:[e(zr,{children:s(Dt,{children:[e(Me,{children:t("services.columns.name","Name")}),e(Me,{children:t("services.columns.hosts","Hosts")}),e(Me,{children:t("services.columns.users","Users")}),e(Me,{children:t("services.columns.usage","Usage")}),e(Me,{children:t("services.columns.lifetime","Lifetime")}),e(Me,{children:t("services.columns.actions","Actions")})]})}),e(Ir,{children:a.services.map(pe)})]})})]})})}),O&&s(Mr,{variant:"outline",children:[e(Ms,{children:s(Tt,{justify:"space-between",align:"center",children:[s(z,{children:[e(h,{fontWeight:"semibold",children:O.name}),O.description&&e(h,{fontSize:"sm",color:"gray.500",children:O.description})]}),e(Wr,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:O.user_count})})]})}),e($r,{children:s(Ve,{columns:{base:1,md:2},spacing:6,children:[s(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(Ce,{spacing:2,children:O.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):O.admins.map(K=>s(Tt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:K.username}),s(h,{fontSize:"sm",color:"gray.500",children:[Je(K.used_traffic)," /"," ",Je(K.lifetime_used_traffic)]})]},K.id))})]}),s(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(Ce,{spacing:2,children:O.hosts.map(K=>s(Tt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[s(z,{children:[e(h,{fontWeight:"medium",children:K.remark}),s(h,{fontSize:"sm",color:"gray.500",children:[K.inbound_protocol.toUpperCase()," - ",K.inbound_tag]})]}),s(Wr,{colorScheme:"gray",children:["#",K.sort+1]})]},K.id))})]})]})})]}),e(yn,{isOpen:Ae,leastDestructiveRef:F,onClose:re,isCentered:!0,motionPreset:"slideInBottom",children:e(dt,{children:s(Sn,{mx:{base:4,sm:0},children:[e(ht,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(ut,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:ie!=null?ie:t("services.thisService","this service")})}),s(At,{children:[e(X,{ref:F,onClick:re,children:t("cancel","Cancel")}),e(X,{colorScheme:"primary",ml:3,onClick:le,isLoading:D,children:t("services.resetUsage","Reset usage")})]})]})})}),s(Nt,{isOpen:Ie,onClose:ne,size:"lg",children:[e(dt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(zt,{children:[s(ht,{children:[t("services.deleteDialogTitle","Delete Service"),ce?` \u2013 ${ce.name}`:""]}),e(Pt,{}),e(ut,{children:ce?s(oe,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:ce.name})}),ce.admin_ids.length>0?e(pr,{isChecked:T,onChange:K=>R(K.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),ce.user_count>0?s(oe,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:ce.user_count})}),e(aa,{value:ve,onChange:K=>N(K),children:s(Ce,{align:"flex-start",spacing:2,children:[e(Nr,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Nr,{value:"transfer_users",isDisabled:xe.length===0,children:xe.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),ve==="transfer_users"&&xe.length>0&&s(k,{isRequired:!0,children:[e(C,{children:t("services.selectTargetService","Target service")}),e(qe,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:de!=null?de:"",onChange:K=>q(K.target.value?Number(K.target.value):null),children:xe.map(K=>e("option",{value:K.id,children:K.name},K.id))}),e(kr,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):s(ur,{status:"info",borderRadius:"md",children:[e(hr,{}),e(as,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),s(At,{gap:3,children:[e(X,{variant:"ghost",onClick:ne,children:t("cancel","Cancel")}),e(X,{colorScheme:"red",onClick:I,isLoading:be,isDisabled:Boolean((ce==null?void 0:ce.user_count)&&ve==="transfer_users"&&xe.length>0&&!de),children:t("services.delete","Delete")})]})]})]}),e(vp,{isOpen:g.isOpen,onClose:g.onClose,onSubmit:P,isSaving:a.isSaving,allHosts:S,allAdmins:x,initialService:f!=null?f:void 0})]}):s(oe,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(Tt,{justify:"center",align:"center",h:"full",py:10,children:e(kt,{})})};Fe.extend(Tn);const ro=j(vn,{baseStyle:{w:4,h:4}}),_p=j(ja,{baseStyle:{w:4,h:4}}),Dp={key:"30d",label:"30d",amount:30,unit:"day"},Ap=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,l=Fe.utc(r);return l.isValid()?n?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},so=t=>Fe(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",no=t=>Fe(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Kn=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return Fe.utc(r).valueOf()},ao=t=>{const n=t.unit==="hour"?"hour":"day",r=Fe().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},Ip=(t,n)=>{const r=Fe(t),l=Fe(n),[o,a]=r.isBefore(l)?[r,l]:[l,r],i=o.startOf("day"),c=a.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Tp=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Je(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Je(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Pp=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Je(Number(r)||0,2),title:{formatter:(r,l)=>{var o,a,i,c;return(c=(i=(a=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:a.labels)==null?void 0:i[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Ep=()=>{var be,Pe,Ie,Oe;const{t}=He(),{colorMode:n}=os(),{admins:r}=Zr(),l="auto-end",o=(be=or({base:"bottom",md:"auto-end"}))!=null?be:l,[a,i]=d.exports.useState([]),[c,u]=d.exports.useState([]),[p,g]=d.exports.useState(null),[f,v]=d.exports.useState([]),[x,S]=d.exports.useState(!1),b=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),w=(Pe=b.find(Q=>Q.key==="30d"))!=null?Pe:Dp,[P,L]=d.exports.useState(()=>ao(w)),[te,_]=d.exports.useState(w.key),[U,D]=d.exports.useState(null),[A,Ae]=d.exports.useState([]),[ge,re]=d.exports.useState(!1),[F,se]=d.exports.useState(!1),[le,ie]=d.exports.useState([P.start,P.end]);d.exports.useMemo(()=>{var Q;return(Q=c.find(xe=>xe.id===p))!=null?Q:null},[c,p]);const ne=d.exports.useMemo(()=>{if(!p)return a;const Q=new Set(f.map(Y=>Y.username).filter(Y=>Boolean(Y))),xe=a.filter(Y=>Q.has(Y.username));return xe.length?xe:a},[a,p,f]),I=d.exports.useMemo(()=>f.reduce((Q,xe)=>Q+(xe.used_traffic||0),0),[f]),ce=d.exports.useMemo(()=>f.map(Q=>Q.used_traffic||0),[f]),Te=d.exports.useMemo(()=>f.map(Q=>Q.username||t("services.unassignedAdmin","Unassigned")),[f,t]),ve=d.exports.useMemo(()=>Pp(n,Te),[n,Te]);d.exports.useEffect(()=>{F||ie([P.start,P.end])},[F,P.start,P.end]),d.exports.useEffect(()=>{let Q=!1;return(async()=>{var Y;try{const pe=await De("/v2/services",{query:{limit:500}});if(Q||!pe)return;const O=(Y=pe.services)!=null?Y:[];u(O),g(fe=>fe!==null?fe:O.length?O[0].id:null)}catch{Q||u([])}})(),()=>{Q=!0}},[]),d.exports.useEffect(()=>{if(!p){v([]);return}let Q=!1;return S(!0),De(`/v2/services/${p}/usage/admins`,{query:{start:so(P.start),end:no(P.end)}}).then(xe=>{var Y;Q||!xe||v((Y=xe.admins)!=null?Y:[])}).catch(()=>{Q||v([])}).finally(()=>{Q||S(!1)}),()=>{Q=!0}},[p,P.start,P.end,P.unit]),d.exports.useEffect(()=>{let Q=!1;return(async()=>{try{const Y=await De("/admins");if(Q)return;Array.isArray(Y)?i(Y):i(Y.admins||[])}catch(Y){console.error("Failed to load all admins:",Y),i(r||[])}})(),()=>{Q=!0}},[r]),d.exports.useEffect(()=>{if(!U)return;let Q=!1;re(!0);const xe=P.unit==="hour",Y={start:so(P.start),end:no(P.end)};xe&&(Y.granularity="hour");const pe=xe?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:U,endpoint:pe,query:Y}),De(`/admin/${encodeURIComponent(U)}/usage/${pe}`,{query:Y}).then(O=>{if(Q)return;const fe=Array.isArray(O==null?void 0:O.usages)?O.usages:[];console.debug("AdminsUsage: response usages",{length:fe.length,endpoint:pe});let K;if(xe){const Z=new Map;fe.forEach(B=>{var Ye,G;const ke=typeof(B==null?void 0:B.date)=="string"?B.date:"";if(!ke)return;const bt=(Ye=Z.get(ke))!=null?Ye:0;Z.set(ke,bt+Number((G=B==null?void 0:B.used_traffic)!=null?G:0))});const ee=Array.from(Z.entries());ee.sort((B,ke)=>{const[bt]=B,[Ye]=ke;return Kn(bt)-Kn(Ye)}),K=ee.map(([B,ke])=>({date:B,used_traffic:ke}))}else{const Z=fe.map(ee=>{var B,ke;return{date:(B=ee==null?void 0:ee.date)!=null?B:"",used_traffic:Number((ke=ee==null?void 0:ee.used_traffic)!=null?ke:0)}});Z.sort((ee,B)=>Kn(ee.date)-Kn(B.date)),K=Z}Ae(K)}).catch(O=>{Q||(console.error("Error fetching admin usage:",O),Ae([]))}).finally(()=>{Q||re(!1)}),()=>{Q=!0}},[U,P]),d.exports.useEffect(()=>{if(!ne||ne.length===0)return;ne.some(xe=>xe.username===U)||D(ne[0].username)},[ne,U]),d.exports.useEffect(()=>{const Q=b.find(xe=>xe.key===P.key);_(Q?Q.key:"custom")},[P,b]);const N=d.exports.useMemo(()=>A.map(Q=>Ap(Q.date)),[A]),T=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:A.map(Q=>Q.used_traffic)}],[A,t]),R=d.exports.useMemo(()=>({options:Tp(n,N),series:T}),[n,N,T]),de=d.exports.useMemo(()=>A.reduce((Q,xe)=>Q+Number(xe.used_traffic||0),0),[A]),q=d.exports.useMemo(()=>{const Q=Fe(P.start).format("YYYY-MM-DD"),xe=Fe(P.end).format("YYYY-MM-DD");return Q===xe?Q:`${Q} - ${xe}`},[P.start,P.end]);return s(oe,{spacing:4,align:"stretch",children:[s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(Ce,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[s(oe,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),s(Ce,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(qe,{value:p!=null?p:"",onChange:Q=>{const xe=Number(Q.target.value);g(Number.isNaN(xe)?null:xe)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(Q=>e("option",{value:Q.id,children:Q.name},Q.id))}),s(E,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(ro,{}),s(h,{children:[t("services.totalUsage","Total"),":"," ",e(j.span,{fontWeight:"medium",children:Je(I,2)})]})]})]})]}),s(Ce,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:x?s(oe,{spacing:3,py:8,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):f.length&&I>0?e(Lr,{type:"donut",height:320,options:ve,series:ce}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(oe,{flex:"1",align:"stretch",spacing:2,children:f.length?f.map(Q=>{var O;const xe=Q.username||t("services.unassignedAdmin","Unassigned"),Y=Boolean(Q.username),pe=U===Q.username&&Y;return e(X,{size:"sm",variant:pe?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{Y&&Q.username&&D(Q.username)},isDisabled:!Y,children:s(E,{justify:"space-between",w:"full",children:[e(h,{children:xe}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:Je(Q.used_traffic||0,2)})]})},`${(O=Q.admin_id)!=null?O:"na"}-${xe}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(oe,{align:"start",spacing:1,children:[s(E,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(at,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(ro,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(j.span,{fontWeight:"medium",children:U!=null?U:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(j.span,{fontWeight:"medium",children:Je(de||0,2)})]})]}),s(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ce,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:b.map(Q=>e(X,{size:"sm",onClick:()=>{_(Q.key),L(ao(Q))},variant:te===Q.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:Q.label},Q.key))}),s(Ce,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[s(Cn,{placement:o,isOpen:F,onClose:()=>{se(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(_n,{children:e(X,{size:"sm",variant:"outline",leftIcon:e(_p,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(F){se(!1);return}ie([P.start,P.end]),se(!0)},children:q})}),s(Dn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(An,{}),s(In,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(Nn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(Ie=le[0])!=null?Ie:void 0,endDate:(Oe=le[1])!=null?Oe:void 0,calendarClassName:"usage-range-datepicker",onChange:Q=>{const[xe,Y]=Q!=null?Q:[null,null];if(ie([xe,Y]),xe&&Y){const pe=Ip(xe,Y);_("custom"),L(pe),se(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(qe,{value:U!=null?U:"",onChange:Q=>D(Q.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!ne.length,children:ne.map(Q=>e("option",{value:Q.username,children:Q.username},Q.username))})]})]})]}),e(z,{mt:6,children:ge?s(oe,{spacing:3,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):R.series&&R.series.length?e(Lr,{options:R.options,series:R.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};Fe.extend(Tn);const Np=j(ja,{baseStyle:{w:4,h:4}}),Na=j(vn,{baseStyle:{w:4,h:4}}),za=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],io=t=>{const n=t.unit==="hour"?"hour":"day",r=Fe().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},zp=(t,n)=>{const r=Fe(t),l=Fe(n),[o,a]=r.isBefore(l)?[r,l]:[l,r],i=o.startOf("day"),c=a.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},oo=t=>Fe(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),lo=t=>Fe(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),co=(t,n)=>{if(!t)return t;const r=Fe.utc(t);return r.isValid()?n==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},uo=(t,n,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Je(Number(o)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Je(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Rp=(t,n)=>({labels:n,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Je(Number(r)||0,2),title:{formatter:(r,l)=>{var o,a,i,c;return(c=(i=(a=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:a.labels)==null?void 0:i[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Lp=({services:t,selectedServiceId:n})=>{var ee,B,ke,bt,Ye,G;const{t:r}=He(),{colorMode:l}=os(),o="auto-end",a=(ee=or({base:"bottom",md:"auto-end"}))!=null?ee:o,i=d.exports.useMemo(()=>t.map(W=>({id:W.id,name:W.name})),[t]),c=d.exports.useMemo(()=>n||(i.length?i[0].id:null),[n,i]),u=(B=za.find(W=>W.key==="30d"))!=null?B:za[0],[p,g]=d.exports.useState(c),[f,v]=d.exports.useState(()=>io(u)),[x,S]=d.exports.useState(u.key),[b,w]=d.exports.useState([null,null]),[P,L]=d.exports.useState(!1),[te,_]=d.exports.useState([]),[U,D]=d.exports.useState("day"),[A,Ae]=d.exports.useState([]),[ge,re]=d.exports.useState(!1),[F,se]=d.exports.useState(!1),[le,ie]=d.exports.useState(null),[ne,I]=d.exports.useState([]),[ce,Te]=d.exports.useState("day"),[ve,N]=d.exports.useState(""),[T,R]=d.exports.useState(!1);d.exports.useEffect(()=>{g(c)},[c]),d.exports.useEffect(()=>{if(!p){_([]),Ae([]),I([]),ie(null),N("");return}const W={start:oo(f.start),end:lo(f.end)},he=f.unit==="hour"?"hour":"day";let we=!1;return re(!0),De(`/v2/services/${p}/usage/timeseries`,{query:{...W,granularity:he}}).then(We=>{var Ne,rt;we||!We||(_((Ne=We.points)!=null?Ne:[]),D((rt=We.granularity)!=null?rt:he))}).catch(()=>{we||(_([]),D(he))}).finally(()=>{we||re(!1)}),se(!0),De(`/v2/services/${p}/usage/admins`,{query:W}).then(We=>{var Ne;we||!We||Ae((Ne=We.admins)!=null?Ne:[])}).catch(()=>{we||Ae([])}).finally(()=>{we||se(!1)}),()=>{we=!0}},[p,f.start,f.end,f.unit]),d.exports.useEffect(()=>{if(!p){ie(null),I([]),N("");return}if(!A.length){ie(null);return}ie(W=>{var Ne,rt;const he=A.map(pt=>pt.admin_id);if(W===null){if(he.includes(null))return W}else if(he.includes(W))return W;const we=A.find(pt=>(pt.used_traffic||0)>0);if(we)return(Ne=we.admin_id)!=null?Ne:null;const We=A[0];return(rt=We==null?void 0:We.admin_id)!=null?rt:null})},[A,p]),d.exports.useEffect(()=>{if(!p){I([]),N(""),Te("day");return}if(le===void 0)return;if(!A.length&&le===null){I([]),N("");return}const W=f.unit==="hour"?"hour":"day",he=le===null?"null":Number.isFinite(le)?String(le):"null";let we=!1;return R(!0),De(`/v2/services/${p}/usage/admin-timeseries`,{query:{start:oo(f.start),end:lo(f.end),granularity:W,admin_id:he}}).then(We=>{var Ne,rt,pt;we||!We||(I((Ne=We.points)!=null?Ne:[]),Te((rt=We.granularity)!=null?rt:W),N((pt=We.username)!=null?pt:""))}).catch(()=>{we||(I([]),N(""),Te(W))}).finally(()=>{we||R(!1)}),()=>{we=!0}},[A,f.end,f.start,f.unit,le,p]);const de=d.exports.useMemo(()=>{const W=Fe(f.start).format("YYYY-MM-DD"),he=Fe(f.end).format("YYYY-MM-DD");return`${W} \u2013 ${he}`},[f.start,f.end]),q=d.exports.useMemo(()=>te.map(W=>co(W.timestamp,U)),[te,U]),be=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:te.map(W=>W.used_traffic)}],[te,r]),Pe=d.exports.useMemo(()=>uo(l,q,r("services.usageYAxis","Usage")),[q,l,r]),Ie=d.exports.useMemo(()=>A.map(W=>({value:W.admin_id===null?"null":String(W.admin_id),label:W.username||r("services.unassignedAdmin","Unassigned")})),[A,r]),Oe=d.exports.useMemo(()=>{var he,we;const W=le===null?"null":String(le);return(we=(he=Ie.find(We=>We.value===W))==null?void 0:he.label)!=null?we:le===null?r("services.unassignedAdmin","Unassigned"):""},[Ie,le,r]),Q=d.exports.useMemo(()=>ne.map(W=>co(W.timestamp,ce)),[ne,ce]),xe=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ne.map(W=>W.used_traffic)}],[ne,r]),Y=d.exports.useMemo(()=>uo(l,Q,r("services.usageYAxis","Usage")),[Q,l,r]),pe=d.exports.useMemo(()=>ne.reduce((W,he)=>W+(he.used_traffic||0),0),[ne]),O=d.exports.useMemo(()=>A.map(W=>W.used_traffic),[A]),fe=d.exports.useMemo(()=>A.map(W=>W.username||r("services.unassignedAdmin","Unassigned")),[A,r]),K=d.exports.useMemo(()=>Rp(l,fe),[l,fe]),Z=d.exports.useMemo(()=>A.reduce((W,he)=>W+(he.used_traffic||0),0),[A]);return i.length===0?s(oe,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(z,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):s(oe,{spacing:4,align:"stretch",children:[s(E,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),s(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(qe,{value:p!=null?p:"",onChange:W=>g(Number(W.target.value)||null),minW:{md:"220px"},children:i.map(W=>e("option",{value:W.id,children:W.name},W.id))}),e(Ce,{direction:{base:"column",sm:"row"},spacing:2,children:za.map(W=>e(X,{size:"sm",variant:x===W.key?"solid":"outline",colorScheme:"primary",onClick:()=>{S(W.key),v(io(W))},children:W.label},W.key))}),s(Cn,{placement:a,isOpen:P,onClose:()=>L(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(_n,{children:e(X,{size:"sm",variant:"outline",leftIcon:e(Np,{}),onClick:()=>{w([f.start,f.end]),L(W=>!W)},children:de})}),s(Dn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(An,{}),s(In,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(Nn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(ke=b[0])!=null?ke:void 0,endDate:(bt=b[1])!=null?bt:void 0,calendarClassName:"usage-range-datepicker",onChange:W=>{const[he,we]=W!=null?W:[null,null];if(w([he,we]),he&&we){const We=zp(he,we);S("custom"),v(We),L(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),s(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(E,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),s(E,{fontSize:"sm",color:"gray.500",children:[e(Na,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(j.span,{fontWeight:"medium",children:Je(te.reduce((W,he)=>W+(he.used_traffic||0),0),2)})]})]})]}),e(z,{mt:4,children:ge?s(oe,{spacing:3,py:10,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):te.length?e(Lr,{type:"area",height:360,options:Pe,series:be}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(oe,{align:"start",spacing:1,children:[e(at,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:s(E,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(Na,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(j.span,{fontWeight:"medium",children:Oe||ve||"-"})," ",r("services.totalUsage","Total"),":"," ",e(j.span,{fontWeight:"medium",children:Je(pe||0,2)})]})]}),e(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(qe,{size:"sm",minW:{md:"200px"},value:le===null?"null":String(le),onChange:W=>{const he=W.target.value;if(he==="null"){ie(null);return}const we=Number(he);ie(Number.isNaN(we)?null:we)},isDisabled:Ie.length===0,children:Ie.map(W=>e("option",{value:W.value,children:W.label},W.value))})})]}),e(z,{mt:4,children:T?s(oe,{spacing:3,py:10,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(G=(Ye=xe[0])==null?void 0:Ye.data)!=null&&G.length?e(Lr,{type:"area",height:360,options:Y,series:xe}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(E,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),s(E,{fontSize:"sm",color:"gray.500",children:[e(Na,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(j.span,{fontWeight:"medium",children:Je(Z,2)})]})]})]}),s(Ce,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:F?s(oe,{spacing:3,py:8,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):A.length&&Z>0?e(Lr,{type:"donut",height:320,options:K,series:O}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(oe,{flex:"1",align:"stretch",spacing:2,children:A.length?A.map(W=>{var he;return s(E,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:W.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:Je(W.used_traffic||0,2)})]},`${(he=W.admin_id)!=null?he:"na"}-${W.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};Fe.extend(Tn);const Mp=j(ja,{baseStyle:{w:4,h:4}}),$n=j(vn,{baseStyle:{w:4,h:4}}),cn={key:"30d",label:"30d",amount:30,unit:"day"},ho=t=>{if(!t)return t;const n=t.includes(" "),r=n?t.replace(" ","T"):t,l=Fe.utc(r);return l.isValid()?n?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},dn=t=>Fe(t).utc().format("YYYY-MM-DDTHH:mm:ss"),un=t=>Fe(t).utc().format("YYYY-MM-DDTHH:mm:ss"),ss=t=>{const n=t.unit==="hour"?"hour":"day",r=Fe().utc().endOf(n),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(n);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},Jn=(t,n)=>{const r=Fe(t),l=Fe(n),[o,a]=r.isBefore(l)?[r,l]:[l,r],i=o.startOf("day"),c=a.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},po=(t,n)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:n,labels:{style:{colors:n.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Je(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Je(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},qn=({presets:t,range:n,onPresetChange:r,onCustomChange:l})=>{var S,b,w;const{t:o}=He(),a="auto-end",i=(S=or({base:"bottom",md:"auto-end"}))!=null?S:a,c=Fe(n.start).format("YYYY-MM-DD"),u=Fe(n.end).format("YYYY-MM-DD"),p=c===u?c:`${c} - ${u}`,[g,f]=d.exports.useState(!1),[v,x]=d.exports.useState([n.start,n.end]);return d.exports.useEffect(()=>{g||x([n.start,n.end])},[g,n.start,n.end]),s(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ce,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(P=>e(X,{size:"sm",onClick:()=>r(P.key),colorScheme:"primary",variant:n.key===P.key?"solid":"outline",w:{base:"full",sm:"auto"},children:P.label},P.key))}),s(Cn,{placement:i,isOpen:g,onClose:()=>{f(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(_n,{children:e(X,{size:"sm",variant:"outline",leftIcon:e(Mp,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(g){f(!1);return}x([n.start,n.end]),f(!0)},children:p})}),s(Dn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(An,{}),s(In,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(Nn,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(b=v[0])!=null?b:void 0,endDate:(w=v[1])!=null?w:void 0,calendarClassName:"usage-range-datepicker",onChange:P=>{const[L,te]=P!=null?P:[null,null];x([L,te]),L&&te&&(l(L,te),f(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},Up=()=>{var Gt,er,Wt,$,_e,Ge,et,yt;const{t}=He(),n=Ut(),{colorMode:r}=os(),{data:l}=ti(),{fetchNodesUsage:o}=zn(),{userData:a}=Ss(),i=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(er=(Gt=i.find(H=>H.key==="30d"))!=null?Gt:i[0])!=null?er:cn,[u,p]=d.exports.useState(()=>ss(c)),[g,f]=d.exports.useState([]),[v,x]=d.exports.useState(!1),[S,b]=d.exports.useState(()=>ss(c)),[w,P]=d.exports.useState(null),[L,te]=d.exports.useState(!1),[_,U]=d.exports.useState([]),[D,A]=d.exports.useState(null),[Ae,ge]=d.exports.useState(()=>ss(c)),[re,F]=d.exports.useState(()=>ss(c)),[se,le]=d.exports.useState([]),[ie,ne]=d.exports.useState(null),[I,ce]=d.exports.useState(null),[Te,ve]=d.exports.useState([]),[N,T]=d.exports.useState([]),[R,de]=d.exports.useState(!1),[q,be]=d.exports.useState(null),[Pe,Ie]=d.exports.useState(!1),[Oe,Q]=d.exports.useState([]),[xe,Y]=d.exports.useState(null),pe=d.exports.useCallback(H=>H?(Array.isArray(H)?H:Object.values(H)).map(J=>{var Xe,st,$e,it;return{nodeId:Number((Xe=J==null?void 0:J.node_id)!=null?Xe:0),nodeName:(st=J==null?void 0:J.node_name)!=null?st:t("nodes.unknownNode","Unknown"),total:Number(($e=J==null?void 0:J.uplink)!=null?$e:0)+Number((it=J==null?void 0:J.downlink)!=null?it:0)}}):[],[t]),O=d.exports.useCallback(H=>{var J;const ue=(J=i.find(Xe=>Xe.key===H))!=null?J:cn;p(ss(ue))},[i]),fe=d.exports.useCallback((H,ue)=>{const J=Jn(H,ue);p(J)},[]),K=d.exports.useCallback(H=>{var J;const ue=(J=i.find(Xe=>Xe.key===H))!=null?J:cn;b(ss(ue))},[i]),Z=d.exports.useCallback((H,ue)=>{const J=Jn(H,ue);b(J)},[]),ee=d.exports.useCallback(H=>{var J;const ue=(J=i.find(Xe=>Xe.key===H))!=null?J:cn;F(ss(ue))},[i]),B=d.exports.useCallback((H,ue)=>{const J=Jn(H,ue);F(J)},[]),ke=d.exports.useCallback(H=>{var J;const ue=(J=i.find(Xe=>Xe.key===H))!=null?J:cn;ge(ss(ue))},[i]),bt=d.exports.useCallback((H,ue)=>{const J=Jn(H,ue);ge(J)},[]),Ye=d.exports.useMemo(()=>g.reduce((H,ue)=>H+ue.total,0),[g]),G=d.exports.useMemo(()=>{const H=g.map(J=>J.total),ue=g.map(J=>J.nodeName);return oa(r,`${t("userDialog.total")} ${Je(Ye||0,2)}`,H,ue)},[r,g,t,Ye]),W=d.exports.useMemo(()=>_.map(H=>ho(H.date)),[_]),he=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:_.map(H=>H.used_traffic)}],[_,t]),we=d.exports.useMemo(()=>_.reduce((H,ue)=>H+ue.used_traffic,0),[_]),We=d.exports.useMemo(()=>({options:po(r,W),series:he}),[r,W,he]),Ne=d.exports.useMemo(()=>N.reduce((H,ue)=>H+ue.total,0),[N]),rt=d.exports.useMemo(()=>{const H=N.map(J=>J.total),ue=N.map(J=>J.nodeName);return oa(r,`${t("userDialog.total")} ${Je(Ne||0,2)}`,H,ue)},[N,r,t,Ne]),pt=d.exports.useMemo(()=>Oe.map(H=>ho(H.date)),[Oe]),It=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:Oe.map(H=>H.used_traffic)}],[Oe,t]),Ze=d.exports.useMemo(()=>Oe.reduce((H,ue)=>H+ue.used_traffic,0),[Oe]),mt=d.exports.useMemo(()=>({options:po(r,pt),series:It}),[r,pt,It]),vt=d.exports.useMemo(()=>{const H=[],ue=new Set;return g.forEach(J=>{J.nodeId>0&&!ue.has(J.nodeId)&&(ue.add(J.nodeId),H.push({value:J.nodeId,label:J.nodeName}))}),Array.isArray(l)&&l.forEach(J=>{(J==null?void 0:J.id)&&!ue.has(J.id)&&(ue.add(J.id),H.push({value:J.id,label:J.name}))}),H.sort((J,Xe)=>J.label.localeCompare(Xe.label))},[g,l]),Rt=d.exports.useMemo(()=>{const H=[],ue=new Set;return Te.forEach(J=>{ue.has(J.nodeId)||(ue.add(J.nodeId),H.push({value:J.nodeId,label:J.nodeName}))}),ue.has(0)||H.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(J=>{(J==null?void 0:J.id)&&!ue.has(J.id)&&(ue.add(J.id),H.push({value:J.id,label:J.name}))}),H.sort((J,Xe)=>J.label.localeCompare(Xe.label))},[Te,l,t]),Kt=d.exports.useMemo(()=>se.map(H=>({value:H,label:H})),[se]),jt=d.exports.useMemo(()=>{const H=new Map;return Array.isArray(l)&&l.forEach(ue=>{(ue==null?void 0:ue.id)!=null&&H.set(ue.id,ue.name)}),H},[l]);return d.exports.useEffect(()=>{let H=!1;return x(!0),o({start:dn(u.start),end:un(u.end)}).then(ue=>{if(H)return;const J=pe(ue==null?void 0:ue.usages);f(J)}).catch(ue=>{H||(console.error("Error fetching usage data:",ue),f([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||x(!1)}),()=>{H=!0}},[o,u,pe,n,t]),d.exports.useEffect(()=>{!(a!=null&&a.username)||(ne(H=>H!=null?H:a.username),ce(H=>H!=null?H:a.username),a.is_sudo||le([a.username]))},[a]),d.exports.useEffect(()=>{if(!(a!=null&&a.is_sudo))return;let H=!1;return De("/admins").then(ue=>{if(H)return;const Xe=(Array.isArray(ue)?ue:Array.isArray(ue==null?void 0:ue.admins)?ue.admins:[]).map($e=>$e==null?void 0:$e.username).filter($e=>typeof $e=="string"),st=Array.from(new Set(Xe)).sort(($e,it)=>$e.localeCompare(it));if(!st.length&&(a==null?void 0:a.username)){le([a.username]);return}le(st),ne($e=>{var it,Ct;return $e&&st.includes($e)?$e:(Ct=(it=st[0])!=null?it:$e)!=null?Ct:null}),ce($e=>{var it,Ct;return $e&&st.includes($e)?$e:(Ct=(it=st[0])!=null?it:$e)!=null?Ct:null})}).catch(ue=>{console.error("Error fetching admins:",ue)}),()=>{H=!0}},[a==null?void 0:a.is_sudo,a==null?void 0:a.username]),d.exports.useEffect(()=>{var ue,J;if(w!==null)return;const H=(ue=g.filter(Xe=>Xe.nodeId>0).sort((Xe,st)=>st.total-Xe.total)[0])==null?void 0:ue.nodeId;if(H&&H>0){P(H);return}if(Array.isArray(l)&&l.length){const Xe=(J=l[0])==null?void 0:J.id;Xe&&P(Xe)}},[w,g,l]),d.exports.useEffect(()=>{be(null)},[ie]),d.exports.useEffect(()=>{if(!ie){ve([]),be(null);return}let H=!1;const ue={start:dn(re.start),end:un(re.end)};return De(`/admin/${encodeURIComponent(ie)}/usage/nodes`,{query:ue}).then(J=>{if(H)return;const Xe=pe(J==null?void 0:J.usages);ve(Xe),be(st=>{var it,Ct,$t;if(st!==null)return st;const $e=(it=Xe.filter(gt=>gt.nodeId!==0).sort((gt,Ot)=>Ot.total-gt.total)[0])==null?void 0:it.nodeId;return typeof $e=="number"?$e:($t=(Ct=Xe[0])==null?void 0:Ct.nodeId)!=null?$t:0})}).catch(J=>{H||(console.error("Error fetching daily admin nodes:",J),ve([]),be(null),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{H=!0}},[ie,re,pe,n,t]),d.exports.useEffect(()=>{if(!I){T([]),de(!1);return}let H=!1;return de(!0),De(`/admin/${encodeURIComponent(I)}/usage/nodes`,{query:{start:dn(Ae.start),end:un(Ae.end)}}).then(ue=>{if(H)return;const J=pe(ue==null?void 0:ue.usages);T(J)}).catch(ue=>{H||(console.error("Error fetching admin totals nodes:",ue),T([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||de(!1)}),()=>{H=!0}},[I,Ae,pe,n,t]),d.exports.useEffect(()=>{if(w===null){U([]),A(null);return}let H=!1;te(!0);const ue={start:dn(S.start),end:un(S.end)};return S.unit==="hour"&&(ue.granularity="hour"),De(`/node/${w}/usage/daily`,{query:ue}).then(J=>{var it,Ct,$t;if(H)return;const st=(Array.isArray(J==null?void 0:J.usages)?J.usages:[]).map(gt=>{var Ot,Lt;return{date:(Ot=gt==null?void 0:gt.date)!=null?Ot:"",used_traffic:Number((Lt=gt==null?void 0:gt.used_traffic)!=null?Lt:0)}});U(st);const $e=(Ct=(it=J==null?void 0:J.node_name)!=null?it:jt.get(w))!=null?Ct:t("nodes.unknownNode","Unknown");A({nodeName:$e,nodeId:($t=J==null?void 0:J.node_id)!=null?$t:w})}).catch(J=>{H||(console.error("Error fetching node daily usage:",J),U([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||te(!1)}),()=>{H=!0}},[w,S,jt,n,t]),d.exports.useEffect(()=>{if(!ie){Q([]),Y(null);return}if(q===null){Q([]),Y(null);return}let H=!1;Ie(!0);const ue={start:dn(re.start),end:un(re.end)};return q!=null&&(ue.node_id=q),re.unit==="hour"&&(ue.granularity="hour"),De(`/admin/${encodeURIComponent(ie)}/usage/chart`,{query:ue}).then(J=>{var $e,it,Ct,$t;if(H)return;const st=(Array.isArray(J==null?void 0:J.usages)?J.usages:[]).map(gt=>{var Ot,Lt;return{date:(Ot=gt==null?void 0:gt.date)!=null?Ot:"",used_traffic:Number((Lt=gt==null?void 0:gt.used_traffic)!=null?Lt:0)}});Q(st),Y({nodeName:(Ct=(it=J==null?void 0:J.node_name)!=null?it:($e=Rt.find(gt=>gt.value===q))==null?void 0:$e.label)!=null?Ct:null,nodeId:($t=J==null?void 0:J.node_id)!=null?$t:q})}).catch(J=>{H||(console.error("Error fetching admin usage chart:",J),Q([]),n({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{H||Ie(!1)}),()=>{H=!0}},[ie,q,re,Rt,t,n]),s(oe,{spacing:6,align:"stretch",children:[s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(oe,{align:"start",spacing:1,children:[e(at,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:s(E,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e($n,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(j.span,{fontWeight:"medium",children:Je(Ye||0,2)})]})]}),e(qn,{presets:i,range:u,onPresetChange:O,onCustomChange:fe})]}),e(z,{mt:6,children:v?s(oe,{spacing:3,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):G.series.length?e(Lr,{options:G.options,series:G.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(oe,{align:"start",spacing:1,children:[e(at,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:s(E,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e($n,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(j.span,{fontWeight:"medium",children:(Wt=D==null?void 0:D.nodeName)!=null?Wt:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(j.span,{fontWeight:"medium",children:Je(we||0,2)})]})]}),s(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(qe,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:w!=null?w:"",onChange:H=>{const ue=H.target.value;if(!ue){P(null);return}const J=Number(ue);P(Number.isFinite(J)&&J>0?J:null)},placeholder:t("nodes.selectNode","Select node"),children:vt.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(qn,{presets:i,range:S,onPresetChange:K,onCustomChange:Z})]})]}),e(z,{mt:6,children:L?s(oe,{spacing:3,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(_e=($=he[0])==null?void 0:$.data)!=null&&_e.length?e(Lr,{options:We.options,series:We.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(oe,{align:"start",spacing:1,children:[e(at,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:s(E,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e($n,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(j.span,{fontWeight:"medium",children:ie!=null?ie:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(j.span,{fontWeight:"medium",children:(Ge=xe==null?void 0:xe.nodeName)!=null?Ge:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(j.span,{fontWeight:"medium",children:Je(Ze||0,2)})]})]}),s(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(qe,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:ie!=null?ie:"",onChange:H=>ne(H.target.value||null),isDisabled:Kt.length===0,children:Kt.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(qe,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:q!=null?q:"",onChange:H=>{const ue=H.target.value;if(ue===""){be(null);return}const J=Number(ue);be(Number.isNaN(J)?null:J)},placeholder:t("nodes.selectNode","Select node"),children:Rt.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(qn,{presets:i,range:re,onPresetChange:ee,onCustomChange:B})]})]}),e(z,{mt:6,children:Pe?s(oe,{spacing:3,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(yt=(et=It[0])==null?void 0:et.data)!=null&&yt.length?e(Lr,{options:mt.options,series:mt.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(Ce,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[s(oe,{align:"start",spacing:1,children:[e(at,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:s(E,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e($n,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(j.span,{fontWeight:"medium",children:I!=null?I:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(j.span,{fontWeight:"medium",children:Je(Ne||0,2)})]})]}),s(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(qe,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:I!=null?I:"",onChange:H=>ce(H.target.value||null),isDisabled:Kt.length===0,children:Kt.map(H=>e("option",{value:H.value,children:H.label},H.value))}),e(qn,{presets:i,range:Ae,onPresetChange:ke,onCustomChange:bt})]})]}),e(z,{mt:6,children:R?s(oe,{spacing:3,children:[e(kt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):rt.series.length?e(Lr,{options:rt.options,series:rt.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},Op=()=>{const{t}=He(),{userData:n,getUserIsSuccess:r}=Ss(),l=r&&n.is_sudo,o=Os(i=>i.services),a=Os(i=>i.fetchServices);return d.exports.useEffect(()=>{l&&a({limit:500})},[a,l]),r?l?s(oe,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),s($s,{variant:"enclosed",colorScheme:"primary",children:[s(Js,{children:[e(Bt,{children:t("usage.tabs.services","Services")}),e(Bt,{children:t("usage.tabs.admins","Admins")}),e(Bt,{children:t("usage.tabs.nodes","Nodes")})]}),s(qs,{children:[e(Vt,{px:0,children:e(Lp,{services:o})}),e(Vt,{px:0,children:e(Ep,{})}),e(Vt,{px:0,children:e(Up,{})})]})]})]}):s(oe,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(Tt,{justify:"center",align:"center",py:10,children:e(kt,{})})},Wp=async()=>De("/settings/telegram"),Fp=async t=>De("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),pl="__dot__",$a=t=>t.replace(/\./g,pl),Rs=t=>t.replace(new RegExp(pl,"g"),"."),Hp=t=>{const n={},r=(l,o)=>{if(o!==void 0){if(typeof o=="boolean"){n[Rs(l)]=o;return}if(typeof o=="string"){if(o==="")return;o==="true"||o==="false"?n[Rs(l)]=o==="true":n[Rs(l)]=Boolean(o);return}if(typeof o=="number"){n[Rs(l)]=o!==0;return}if(Array.isArray(o)){n[Rs(l)]=o.length>0;return}if(o&&typeof o=="object"){Object.entries(o).forEach(([a,i])=>{const c=l?`${l}.${a}`:a;r(c,i)});return}n[Rs(l)]=Boolean(o)}};return Object.entries(t).forEach(([l,o])=>{r(l,o)}),n},ml=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],Bp=ml.flatMap(t=>t.events.map(n=>n.key)),Vp=j(Or,{baseStyle:{w:4,h:4}}),Kp=j(Uc,{baseStyle:{w:4,h:4}}),Ra=t=>{var l,o,a;const n={};Object.entries(t.forum_topics||{}).forEach(([i,c])=>{var u;n[i]={title:(u=c.title)!=null?u:"",topic_id:c.topic_id!=null?String(c.topic_id):""}});const r={};return Bp.forEach(i=>{var p;const c=$a(i),u=(p=t.event_toggles)==null?void 0:p[i];r[c]=u===void 0?!0:Boolean(u)}),Object.entries(t.event_toggles||{}).forEach(([i,c])=>{const u=$a(i);u in r||(r[u]=Boolean(c))}),{api_token:(l=t.api_token)!=null?l:"",proxy_url:(o=t.proxy_url)!=null?o:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(a=t.default_vless_flow)!=null?a:"",forum_topics:n,event_toggles:r}},$p=t=>t.split(/[\s,]+/).map(n=>n.trim()).filter(n=>n.length>0).map(n=>Number(n)).filter(n=>Number.isFinite(n)),Jp=()=>{const{t}=He(),n=Ut(),r=Za(),{data:l,isLoading:o,refetch:a}=Gr("telegram-settings",Wp,{refetchOnWindowFocus:!1}),{register:i,control:c,handleSubmit:u,reset:p,watch:g,formState:{isDirty:f}}=vr({defaultValues:Ra(l!=null?l:{api_token:null,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{l&&p(Ra(l))},[l,p]);const v=Er(Fp,{onSuccess:b=>{p(Ra(b)),r.setQueryData("telegram-settings",b),n({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{n({title:t("errors.generic","Something went wrong"),status:"error"})}}),x=b=>{const w=Hp(b.event_toggles||{}),P={api_token:b.api_token.trim()||null,proxy_url:b.proxy_url.trim()||null,admin_chat_ids:$p(b.admin_chat_ids),logs_chat_id:b.logs_chat_id.trim()?Number(b.logs_chat_id.trim()):null,logs_chat_is_forum:b.logs_chat_is_forum,default_vless_flow:b.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(b.forum_topics||{}).map(([L,te])=>[L,{title:te.title,topic_id:te.topic_id.trim()?Number(te.topic_id.trim()):void 0}])),event_toggles:w};v.mutate(P)},S=g("forum_topics");return s(z,{px:{base:4,md:8},py:{base:6,md:8},children:[e(ba,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),s($s,{colorScheme:"primary",children:[s(Js,{children:[e(Bt,{children:t("settings.telegram","Telegram")}),e(Bt,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),s(qs,{children:[e(Vt,{px:{base:0,md:2},children:o&&!l?e(Tt,{align:"center",justify:"center",py:12,children:e(kt,{size:"lg"})}):e("form",{onSubmit:u(x),children:s(oe,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),s(Ve,{columns:{base:1,md:2},spacing:6,children:[s(k,{children:[e(C,{children:t("settings.telegram.apiToken","Bot API Token")}),e(Se,{placeholder:"123456:ABC",...i("api_token")})]}),s(k,{children:[e(C,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(Se,{placeholder:"socks5://user:pass@host:port",...i("proxy_url")})]}),s(k,{children:[e(C,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(Se,{placeholder:"12345, 67890",...i("admin_chat_ids")}),e(kr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),s(k,{children:[e(C,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(Se,{placeholder:"-100123456789",...i("logs_chat_id")}),e(kr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),s(k,{display:"flex",alignItems:"center",children:[e(C,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(lt,{control:c,name:"logs_chat_is_forum",render:({field:b})=>e(ft,{id:"logs_chat_is_forum",isChecked:b.value,onChange:b.onChange})})]}),s(k,{children:[e(C,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(Se,{placeholder:"xtls-rprx-vision",...i("default_vless_flow")})]})]}),s(z,{children:[e(ba,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),S&&Object.keys(S).length>0?e(Ce,{spacing:4,children:Object.entries(S).map(([b])=>s(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",b]}),s(Ve,{columns:{base:1,md:2},spacing:4,children:[s(k,{children:[e(C,{children:t("settings.telegram.topicTitle","Topic Title")}),e(Se,{...i(`forum_topics.${b}.title`)})]}),s(k,{children:[e(C,{children:t("settings.telegram.topicId","Topic ID")}),e(Se,{type:"number",...i(`forum_topics.${b}.topic_id`)}),e(kr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},b))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]}),s(z,{children:[e(ba,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(Ce,{spacing:4,children:ml.map(b=>s(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(b.titleKey,b.defaultTitle)}),e(Ve,{columns:{base:1,md:2},spacing:4,children:b.events.map(w=>s(k,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[s(z,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(w.labelKey,w.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(w.hintKey,w.defaultHint)})]}),e(lt,{control:c,name:`event_toggles.${$a(w.key)}`,render:({field:P})=>e(ft,{isChecked:Boolean(P.value),onChange:L=>P.onChange(L.target.checked)})})]},w.key))})]},b.key))})]}),s(Tt,{gap:3,justify:"flex-end",children:[e(X,{variant:"outline",leftIcon:e(Vp,{}),onClick:()=>a(),isDisabled:v.isLoading,children:t("actions.refresh","Refresh")}),e(X,{colorScheme:"primary",leftIcon:e(Kp,{}),type:"submit",isLoading:v.isLoading,isDisabled:!f&&!v.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(Vt,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},qp=async()=>{try{const t=ia();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const n=await De("/admin",{headers:{Authorization:`Bearer ${t}`}});if(n&&typeof n=="object"&&"error"in n)throw new Error(`API error: ${n.error||"Unknown error"}`);return n}catch(t){throw console.error("Loader error:",t),t}},Yp=Oc([{path:"/",element:e(Ld,{}),errorElement:e(ki,{}),loader:qp,children:[{index:!0,element:e(Bd,{})},{path:"users",element:e(zu,{})},{path:"admins",element:e(Ou,{})},{path:"usage",element:e(Op,{})},{path:"services",element:e(Cp,{})},{path:"hosts",element:e(vh,{})},{path:"node-settings",element:e(Hh,{})},{path:"integrations",element:e(Jp,{})},{path:"xray-settings",element:e(wp,{})},{path:"xray-logs",element:e(ul,{})}]},{path:"/login/",element:e(ki,{})}]);function Gp(){return e(Wc,{router:Yp})}Fe.extend(Fc);Fe.extend(Hc);Fe.extend(Tn);Fe.extend(Bc);Fe.extend(Vc);Zn(Kc.get()||"light");$c.createRoot(document.getElementById("root")).render(e(La.StrictMode,{children:e(Jc,{theme:Yc,children:e(qc,{client:Qn,children:e(Gp,{})})})}));
