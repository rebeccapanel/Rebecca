var uc=Object.defineProperty;var hc=(t,s,r)=>s in t?uc(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var X=(t,s,r)=>(hc(t,typeof s!="symbol"?s+"":s,r),r);import{i as Ei,B as pc,a as mc,b as gc,j as al,d as Re,U as Pa,z as fc,r as bc,f as yc,Q as Sc,e as xc,m as Ht,$ as vc,c as oe,X as Ta,R as ba,N as Sn,I as De,g as xn,h as n,F as C,k as e,l as _,n as Mr,o as wc,p as Ea,q as Bt,s as kc,t as Cc,u as _c,v as Dc,w as Vr,x as an,L as ol,C as mi,y as Ke,A as Oe,M as si,D as ks,E as We,G as ii,H as lr,J as M,K as ll,T as h,S as Ac,P as Ic,O as ya,V as wn,W as ai,Y as Na,Z as za,_ as Pc,a0 as Zt,a1 as jr,a2 as Qt,a3 as c,a4 as Ya,a5 as z,a6 as Mi,a7 as L,a8 as Wi,a9 as Lt,aa as kt,ab as Ot,ac as At,ad as Wt,ae as Ct,af as me,ag as Le,ah as ye,ai as cr,aj as Ut,ak as Nr,al as Ce,am as Tc,an as oi,ao as Ra,ap as Ec,aq as Ua,ar as en,as as Lr,at as Tn,au as zr,av as Rr,aw as Hn,ax as Fi,ay as Or,az as Nc,aA as zc,aB as Rc,aC as Uc,aD as Mc,aE as Lc,aF as Oc,aG as Wc,aH as Fc,aI as Hi,aJ as cl,aK as dl,aL as ft,aM as Cs,aN as Ga,aO as Hc,aP as Bc,aQ as Vc,aR as ul,aS as hl,aT as Ur,aU as gt,aV as Vn,aW as $n,aX as Kn,aY as os,aZ as Jn,a_ as Fn,a$ as $c,b0 as Kc,b1 as Jc,b2 as qc,b3 as Ns,b4 as Yc,b5 as Gc,b6 as ln,b7 as xs,b8 as jn,b9 as ut,ba as $r,bb as Bi,bc as Et,bd as rt,be as wr,bf as pl,bg as Xc,bh as cn,bi as Nn,bj as Qc,bk as li,bl as vn,bm as ml,bn as Ma,bo as gl,bp as ti,bq as Ni,br as Zc,bs as jc,bt as fl,bu as ed,bv as td,bw as La,bx as bl,by as yl,bz as rd,bA as nd,bB as sd,bC as Sl,bD as id,bE as ad,bF as od,bG as ri,bH as Xa,bI as ls,bJ as cs,bK as er,bL as ds,bM as tr,bN as ld,bO as cd,bP as Bn,bQ as dd,bR as sr,bS as ud,bT as xt,bU as bt,bV as xl,bW as vl,bX as wl,bY as hd,bZ as kl,b_ as rs,b$ as bn,c0 as Rt,c1 as $e,c2 as on,c3 as Ue,c4 as wi,c5 as hs,c6 as Cl,c7 as _l,c8 as Dl,c9 as Qa,ca as In,cb as pd,cc as md,cd as gd,ce as ci,cf as Br,cg as Al,ch as fd,ci as bd,cj as _s,ck as Ds,cl as gi,cm as Il,cn as yd,co as vs,cp as Ss,cq as zi,cr as Sd,cs as Pl,ct as Oa,cu as Hr,cv as Tl,cw as fi,cx as xd,cy as vd,cz as wd,cA as El,cB as Nl,cC as kd,cD as Cd,cE as _d,cF as Dd,cG as Ad,cH as Id,cI as Pd,cJ as Td,cK as Ed,cL as Nd,cM as Wa,cN as zd,cO as Mn,cP as Rd,cQ as Ud,cR as Md,cS as Ld,cT as Od,cU as Wd,cV as Fd,cW as Hd,cX as Bd,cY as Vd}from"./vendor.1b08f6ed.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();Ei.use(pc).use(mc).use(gc).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:al(["/","statics/locales/{{lng}}.json"])}},function(t,s){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",Ei.language),Re.locale(Ei.language)});Ei.on("languageChanged",t=>{console.log("Language changed to:",t),Re.locale(t)});Pa("zh-cn",fc);Pa("ru",bc);Pa("fa",yc);const Qs=new Sc,Ri=(t,s)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:s||"#f6f8ff"},i=s||l[t]||l.default;r==null||r.setAttribute("content",i)},$d=xc({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:'Vazirmatn,Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol",sans-serif'},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:Ht("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:Ht("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:Ht("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:Ht("surface.light","surface.dark")(t),borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:Ht("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Ht("lg","dark-lg")(t)},item:{_hover:{bg:Ht("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:Ht("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:Ht("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Ht("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:Ht("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:Ht("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:Ht("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:Ht("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:Ht("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:Ht("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:Ht("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const As=()=>localStorage.getItem("token"),Kd=t=>{localStorage.setItem("token",t)},Jd=()=>{localStorage.removeItem("token")},qd=vc.create({baseURL:"https://bot.mazholl.com:8585/api"}),Yd=(t,s={})=>(As()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${As()}`}),qd(t,s)),Ee=Yd,Gd=oe(Ta,{baseStyle:{w:4,h:4}}),ur=ba.forwardRef(({disabled:t,step:s,label:r,className:l,startAdornment:i,endAdornment:a,type:o="text",placeholder:d,onChange:u,onBlur:m,name:p,value:g,onClick:x,error:S,clearable:y=!1,...v},T)=>{const N=()=>{u&&u({target:{value:"",name:p}})},{size:W="md"}=v,he=o=="number"?Sn:De,E=o=="number"?xn:ba.Fragment,F=o=="number"?{keepWithinRange:!0,precision:5,format:P=>isNaN(parseFloat(String(P)))||Number(parseFloat(String(P)).toFixed(5))===0?P:Number(parseFloat(String(P)).toFixed(5)),min:typeof v.min=="number"?v.min:v.min!==void 0?Number(v.min):0,step:s,name:p,type:o,placeholder:d,onBlur:m,onClick:x,disabled:t,flexGrow:1,size:W,onChange:(P,j)=>{!u||u({target:{value:P,valueAsNumber:j,name:p}})}}:{};return n(C,{isInvalid:!!S,children:[r&&e(_,{children:r}),n(Mr,{size:W,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[i&&e(wc,{children:i}),n(E,{...F,children:[e(he,{name:p,ref:T,step:s,className:Ea(l),type:o,placeholder:d,onChange:o==="number"?void 0:u,onBlur:m,value:o==="number"?void 0:g,onClick:x,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...v,roundedLeft:i?"0":"md",roundedRight:a?"0":"md"}),o=="number"&&e(Bt,{children:n(kc,{children:[e(Cc,{}),e(_c,{})]})})]}),a&&e(Dc,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:a}),y&&g&&g.length&&e(Vr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:N,cursor:"pointer",children:e(Gd,{})})]}),!!S&&e(an,{children:S})]})}),Sa="/statics/logo.e8dba2f4.svg",Xd=oe(ol,{baseStyle:{w:4,h:4}}),Qd=oe(mi,{baseStyle:{w:4,h:4}}),Zd=({actions:t})=>{const{i18n:s}=Ke(),r=Oe("surface.light","surface.dark"),l=Oe("blackAlpha.50","whiteAlpha.100"),i=Oe("blackAlpha.200","whiteAlpha.200"),a=Oe("gray.800","gray.100"),o=u=>{s.changeLanguage(u)};return n(si,{placement:"bottom-end",children:[e(ks,{as:We,size:"sm",variant:"outline",icon:e(Xd,{}),position:"relative"}),e(ii,{minW:{base:"70vw",sm:"160px"},zIndex:9999,bg:r,borderColor:i,color:a,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:m,flag:p})=>e(lr,{fontSize:"sm",onClick:()=>o(u),_hover:{bg:l},children:n(M,{justify:"space-between",w:"full",children:[n(M,{spacing:2,children:[e(ll,{countryCode:p,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:m})]}),s.language===u&&e(Qd,{})]})},u))})]})},Za="rb-theme",ja="rb-custom-themes",jd=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],eo=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],to=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],Ir={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},Pr={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Qi=.14,Zi=.22,ro=oe(mi,{baseStyle:{w:4,h:4}}),no=oe(Ac,{baseStyle:{w:4,h:4}}),eu=oe(Ic,{baseStyle:{w:4,h:4}}),tu=oe(ya,{baseStyle:{w:4,h:4}}),ru=oe(wn,{baseStyle:{w:4,h:4}}),so=oe(ai,{baseStyle:{w:4,h:4}}),nu=oe(Na,{baseStyle:{w:4,h:4}}),su=oe(za,{baseStyle:{w:4,h:4}}),iu=oe(Pc,{baseStyle:{w:4,h:4}}),zl=(t,s=0,r=1)=>Math.min(r,Math.max(s,t)),xa=t=>{const s=t.replace("#",""),r=parseInt(s,16);if(s.length===3){const l=r>>8&15,i=r>>4&15,a=r&15;return{r:l<<4|l,g:i<<4|i,b:a<<4|a}}return{r:r>>16&255,g:r>>8&255,b:r&255}},Rl=(t,s,r)=>{const l=i=>i.toString(16).padStart(2,"0");return`#${l(t)}${l(s)}${l(r)}`},au=(t,s,r)=>{t/=255,s/=255,r/=255;const l=Math.max(t,s,r),i=Math.min(t,s,r);let a=0,o=0;const d=(l+i)/2;if(l!==i){const u=l-i;switch(o=d>.5?u/(2-l-i):u/(l+i),l){case t:a=(s-r)/u+(s<r?6:0);break;case s:a=(r-t)/u+2;break;default:a=(t-s)/u+4}a/=6}return{h:a,s:o,l:d}},ou=(t,s,r)=>{let l,i,a;if(s===0)l=i=a=r;else{const o=(m,p,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?m+(p-m)*6*g:g<.5?p:g<.6666666666666666?m+(p-m)*(.6666666666666666-g)*6:m),d=r<.5?r*(1+s):r+s-r*s,u=2*r-d;l=o(u,d,t+1/3),i=o(u,d,t),a=o(u,d,t-1/3)}return{r:Math.round(l*255),g:Math.round(i*255),b:Math.round(a*255)}},ji=t=>{try{const{r:s,g:r,b:l}=xa(t),{h:i,s:a,l:o}=au(s,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[m,p])=>{const{r:g,g:x,b:S}=ou(i,a,zl(o+p));return u[`--primary-${m}`]=Rl(g,x,S),u},{})}catch{return{}}},lu=(t,s,r)=>{const l=zl(r,0,1),i=xa(t),a=xa(s),o=(d,u)=>Math.round(d*(1-l)+u*l);return Rl(o(i.r,a.r),o(i.g,a.g),o(i.b,a.b))},ps=(t,s,r,l)=>{try{return lu(t,s,r)}catch{return l}},cu=()=>{const t=document.documentElement;jd.forEach(s=>t.style.removeProperty(s)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},du=(t,s)=>{const r=document.documentElement;Object.entries(t).forEach(([l,i])=>r.style.setProperty(l,i)),r.style.setProperty("--bg-light",s.bgLight),r.style.setProperty("--bg-dark",s.bgDark),r.style.setProperty("--surface-light",s.surfaceLight),r.style.setProperty("--surface-dark",s.surfaceDark)},ea=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},io=()=>({name:"",light:{...Ir},dark:{...Pr}}),ar=(t,s)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:s,Ul=({minimal:t=!1,portalContainer:s,trigger:r="icon",triggerLabel:l})=>{const{t:i}=Ke(),a=Zt(),{colorMode:o,toggleColorMode:d}=jr(),u=Qt(),m=Qt(),p=Oe("surface.light","surface.dark"),g=Oe("blackAlpha.50","whiteAlpha.100"),x=Oe("blackAlpha.200","whiteAlpha.200"),S=Oe("gray.800","gray.100"),y=Oe("gray.600","gray.300"),v=Oe("blackAlpha.400","blackAlpha.700"),T=c.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:y}}),[y]),[N,W]=c.exports.useState(()=>{try{return localStorage.getItem(Za)||"default"}catch{return"default"}}),[he,E]=c.exports.useState(()=>{try{const O=localStorage.getItem(ja);if(!O)return[];const G=JSON.parse(O);return Array.isArray(G)?G.map(pe=>{var re,H,ge,dt,lt,st;const k=ar(((re=pe.light)==null?void 0:re.primary)||Ir.primary,Ir.primary),I=ar(((H=pe.light)==null?void 0:H.bg)||Ir.bg,Ir.bg),U=ps(I,k,Qi,Ir.surface),Y=ar(((ge=pe.light)==null?void 0:ge.surface)||U,U),Ie=ar(((dt=pe.dark)==null?void 0:dt.primary)||Pr.primary,Pr.primary),Se=ar(((lt=pe.dark)==null?void 0:lt.bg)||Pr.bg,Pr.bg),He=ps(Se,Ie,Zi,Pr.surface),R=ar(((st=pe.dark)==null?void 0:st.surface)||He,He);return{id:pe.id||ea(),name:pe.name||"Custom",light:{primary:k,bg:I,surface:Y},dark:{primary:Ie,bg:Se,surface:R}}}):[]}catch{return[]}}),[F,P]=c.exports.useState(io),[j,q]=c.exports.useState(null),[le,V]=c.exports.useState("");c.exports.useEffect(()=>{try{localStorage.setItem(ja,JSON.stringify(he))}catch{}},[he]),c.exports.useEffect(()=>{try{localStorage.setItem(Za,N)}catch{}},[N]),c.exports.useEffect(()=>{N.startsWith("custom:")&&(he.some(G=>`custom:${G.id}`===N)||W("default"))},[N,he]),c.exports.useEffect(()=>{const O=document.documentElement;Array.from(O.classList).filter(pe=>pe.startsWith("rb-theme-")).forEach(pe=>O.classList.remove(pe)),cu();const G=eo.find(pe=>pe.key===N);if(G){G.className&&O.classList.add(G.className),Ri(G.key);return}if(N.startsWith("custom:")){const pe=he.find(U=>`custom:${U.id}`===N);if(!pe)return;const k=o==="dark"?pe.dark:pe.light,I=ji(k.primary);du(I,{bgLight:pe.light.bg,bgDark:pe.dark.bg,surfaceLight:pe.light.surface,surfaceDark:pe.dark.surface}),Ri("custom",o==="dark"?pe.dark.bg:pe.light.bg)}else Ri("default")},[N,he,o]);const ce=c.exports.useCallback(O=>{O.colorModeTarget&&o!==O.colorModeTarget&&d(),W(O.key)},[o,d]),A=O=>{W(`custom:${O}`)},be=O=>{q(null),P(O?{name:i(`theme.presets.${O.key}.name`),light:{...O.light},dark:{...O.dark}}:io()),u.onOpen()},f=O=>{q(O.id),P({name:O.name,light:{...O.light},dark:{...O.dark}}),u.onOpen()},te=()=>{const O=F.name.trim()||i("theme.untitled"),G=ar(F.light.primary,Ir.primary),pe=ar(F.light.bg,Ir.bg),k=ps(pe,G,Qi,Ir.surface),I=ar(F.light.surface,k),U=ar(F.dark.primary,Pr.primary),Y=ar(F.dark.bg,Pr.bg),Ie=ps(Y,U,Zi,Pr.surface),Se=ar(F.dark.surface,Ie),He={id:j||ea(),name:O,light:{primary:G,bg:pe,surface:I},dark:{primary:U,bg:Y,surface:Se}};E(R=>j?R.map(re=>re.id===j?He:re):[...R,He]),W(`custom:${He.id}`),u.onClose(),q(null),a({status:"success",title:i("theme.customSaved")})},J=O=>{E(G=>G.filter(pe=>pe.id!==O)),N===`custom:${O}`&&W("default"),a({status:"info",title:i("theme.customDeleted")})},we=()=>{W("default"),a({status:"info",title:i("theme.resetSuccess")})},Te=async()=>{if(!he.length){a({status:"warning",title:i("theme.exportEmpty")});return}const O=he.map(({id:pe,...k})=>k),G=JSON.stringify(O,null,2);try{await navigator.clipboard.writeText(G),a({status:"success",title:i("theme.exportSuccess")})}catch{try{const pe=new Blob([G],{type:"application/json"}),k=URL.createObjectURL(pe),I=document.createElement("a");I.href=k,I.download="rebecca-themes.json",I.click(),URL.revokeObjectURL(k),a({status:"success",title:i("theme.exportSuccessDownload")})}catch{a({status:"error",title:i("theme.exportError")})}}},Ne=()=>{try{const O=JSON.parse(le),pe=(Array.isArray(O)?O:[O]).map(k=>{var H,ge,dt,lt,st,ve;const I=ar(((H=k==null?void 0:k.light)==null?void 0:H.primary)||Ir.primary,Ir.primary),U=ar(((ge=k==null?void 0:k.light)==null?void 0:ge.bg)||Ir.bg,Ir.bg),Y=ps(U,I,Qi,Ir.surface),Ie=ar(((dt=k==null?void 0:k.light)==null?void 0:dt.surface)||Y,Y),Se=ar(((lt=k==null?void 0:k.dark)==null?void 0:lt.primary)||Pr.primary,Pr.primary),He=ar(((st=k==null?void 0:k.dark)==null?void 0:st.bg)||Pr.bg,Pr.bg),R=ps(He,Se,Zi,Pr.surface),re=ar(((ve=k==null?void 0:k.dark)==null?void 0:ve.surface)||R,R);return{id:ea(),name:(k==null?void 0:k.name)||"Custom",light:{primary:I,bg:U,surface:Ie},dark:{primary:Se,bg:He,surface:re}}}).filter(k=>k.name);if(!pe.length){a({status:"warning",title:i("theme.importError")});return}E(k=>[...k,...pe]),m.onClose(),V(""),a({status:"success",title:i("theme.importSuccess")})}catch{a({status:"error",title:i("theme.importError")})}},$=c.exports.useCallback((O,G)=>{O.preventDefault(),O.stopPropagation(),G()},[]),K=c.exports.useMemo(()=>ji(F.light.primary),[F.light.primary]),ee=c.exports.useMemo(()=>ji(F.dark.primary),[F.dark.primary]),_e=O=>{const G=F[O],pe=O==="dark"?ee:K,k=pe["--primary-500"]||G.primary,I=pe["--primary-300"]||pe["--primary-400"]||k,U=O==="dark"?"whiteAlpha.900":"gray.800",Y=O==="dark"?"whiteAlpha.700":"gray.600",Ie=O==="dark"?"whiteAlpha.200":"blackAlpha.200",Se=O==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(z,{borderWidth:"1px",borderRadius:"md",bg:G.bg,p:4,borderColor:Ie,children:n(ye,{spacing:3,children:[e(h,{fontWeight:"semibold",color:U,children:i(O==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(z,{borderRadius:"lg",bg:G.surface,p:4,borderWidth:"1px",borderColor:Ie,children:n(ye,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:U,children:i("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:Y,children:i("theme.previewSampleBody")}),e(L,{size:"sm",bg:k,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:i("theme.previewSampleAction")}),n(M,{spacing:2,pt:2,children:[e(z,{flex:"1",h:"2",borderRadius:"full",bg:I,opacity:.8}),e(z,{flex:"1",h:"2",borderRadius:"full",bg:k,opacity:.9})]})]})}),n(M,{spacing:1,pt:1,flexWrap:"wrap",children:[e(z,{w:6,h:6,borderRadius:"sm",bg:G.bg,borderWidth:"1px",borderColor:Se}),e(z,{w:6,h:6,borderRadius:"sm",bg:G.surface,borderWidth:"1px",borderColor:Se}),Object.entries(pe).map(([He,R])=>e(z,{w:6,h:6,borderRadius:"sm",bg:R,borderWidth:"1px",borderColor:Se,title:He},He))]})]})})},xe=n(ii,{minW:{base:"82vw",sm:"240px"},maxW:"320px",zIndex:9999,bg:p,color:S,borderColor:x,maxH:"70vh",overflowY:"auto",children:[e(Ya,{title:i("theme.builtIn"),sx:T,children:eo.map(O=>{const G=N===O.key;return e(lr,{onClick:()=>ce(O),_hover:{bg:g},children:n(M,{justify:"space-between",w:"full",children:[n(M,{children:[e(z,{w:"4",h:"3",bg:O.accent,borderRadius:"xs",borderWidth:"1px",borderColor:x}),e(h,{children:i(`theme.${O.key}`)})]}),G&&e(ro,{})]})},O.key)})}),!t&&n(Bt,{children:[e(Mi,{borderColor:x}),n(Ya,{title:i("theme.customGroup"),sx:T,children:[he.length?he.map(O=>{const G=N===`custom:${O.id}`;return e(lr,{onClick:()=>A(O.id),_hover:{bg:g},children:n(M,{justify:"space-between",w:"full",children:[n(M,{children:[e(z,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${O.light.surface}, ${O.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:x}),e(h,{children:O.name})]}),n(M,{spacing:1,children:[G&&e(ro,{}),[{icon:e(tu,{}),label:i("theme.edit"),onClick:()=>f(O)},{icon:e(ru,{}),label:i("theme.delete"),onClick:()=>J(O.id)}].map(({icon:pe,label:k,onClick:I})=>e(z,{as:"span",role:"button",tabIndex:0,"aria-label":k,onClick:U=>$(U,I),onKeyDown:U=>{(U.key==="Enter"||U.key===" ")&&$(U,I)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:g},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:pe},k))]})]})},O.id)}):e(lr,{isDisabled:!0,children:i("theme.noCustom")}),e(lr,{icon:e(eu,{}),onClick:()=>be(),_hover:{bg:g},children:i("theme.createCustom")})]}),e(Mi,{borderColor:x}),e(lr,{icon:e(so,{}),onClick:()=>be(to[0]),_hover:{bg:g},children:i("theme.quickPreset")}),e(lr,{icon:e(nu,{}),onClick:Te,_hover:{bg:g},children:i("theme.export")}),e(lr,{icon:e(su,{}),onClick:()=>m.onOpen(),_hover:{bg:g},children:i("theme.import")}),e(lr,{icon:e(iu,{}),onClick:we,_hover:{bg:g},children:i("theme.reset")})]})]}),B=r==="icon"?e(ks,{as:We,size:"sm",variant:"outline",icon:e(no,{}),position:"relative"}):e(ks,{as:L,w:"full",justifyContent:"space-between",variant:"ghost",rightIcon:e(no,{}),children:l||i("theme.triggerLabel","Theme")});return n(Bt,{children:[n(si,{placement:"bottom-end",children:[B,s?e(Wi,{containerRef:s,children:xe}):xe]}),n(Lt,{isOpen:u.isOpen,onClose:u.onClose,isCentered:!0,size:"xl",children:[e(kt,{bg:v,backdropFilter:"blur(4px)"}),n(Ot,{mx:4,bg:p,borderColor:x,borderWidth:"1px",color:S,children:[e(At,{color:S,children:i(j?"theme.editThemeTitle":"theme.customTitle")}),e(Wt,{}),e(Ct,{children:n(me,{spacing:6,align:"stretch",children:[n(C,{children:[e(_,{color:y,children:i("theme.customName")}),e(De,{placeholder:i("theme.customNamePlaceholder")||"",value:F.name,onChange:O=>P(G=>({...G,name:O.target.value}))})]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[_e("light"),_e("dark")]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(ye,{spacing:4,children:[n(C,{children:[e(_,{color:y,children:i("theme.lightPrimary")}),e(De,{type:"color",value:F.light.primary,onChange:O=>P(G=>({...G,light:{...G.light,primary:O.target.value}}))}),e(cr,{color:y,children:i("theme.lightPrimaryHint")})]}),n(C,{children:[e(_,{color:y,children:i("theme.lightSurface")}),e(De,{type:"color",value:F.light.surface,onChange:O=>P(G=>({...G,light:{...G.light,surface:O.target.value}}))}),e(cr,{color:y,children:i("theme.lightSurfaceHint")})]}),n(C,{children:[e(_,{color:y,children:i("theme.lightBackground")}),e(De,{type:"color",value:F.light.bg,onChange:O=>P(G=>({...G,light:{...G.light,bg:O.target.value}}))})]})]}),n(ye,{spacing:4,children:[n(C,{children:[e(_,{color:y,children:i("theme.darkPrimary")}),e(De,{type:"color",value:F.dark.primary,onChange:O=>P(G=>({...G,dark:{...G.dark,primary:O.target.value}}))}),e(cr,{color:y,children:i("theme.darkPrimaryHint")})]}),n(C,{children:[e(_,{color:y,children:i("theme.darkSurface")}),e(De,{type:"color",value:F.dark.surface,onChange:O=>P(G=>({...G,dark:{...G.dark,surface:O.target.value}}))}),e(cr,{color:y,children:i("theme.darkSurfaceHint")})]}),n(C,{children:[e(_,{color:y,children:i("theme.darkBackground")}),e(De,{type:"color",value:F.dark.bg,onChange:O=>P(G=>({...G,dark:{...G.dark,bg:O.target.value}}))})]})]})]}),n(z,{children:[n(M,{mb:2,children:[e(so,{}),e(h,{fontWeight:"semibold",children:i("theme.presets")})]}),e(Le,{columns:{base:1,md:3},spacing:3,children:to.map(O=>e(L,{size:"sm",variant:"outline",onClick:()=>P({name:i(`theme.presets.${O.key}.name`),light:{...O.light},dark:{...O.dark}}),children:i(`theme.presets.${O.key}.name`)},O.key))})]})]})}),n(Ut,{children:[e(L,{variant:"ghost",mr:3,onClick:u.onClose,children:i("cancel")}),e(L,{colorScheme:"primary",onClick:te,children:i(j?"theme.customUpdate":"theme.customSave")})]})]})]}),n(Lt,{isOpen:m.isOpen,onClose:m.onClose,size:"lg",isCentered:!0,children:[e(kt,{bg:v,backdropFilter:"blur(4px)"}),n(Ot,{mx:4,bg:p,borderColor:x,borderWidth:"1px",color:S,children:[e(At,{color:S,children:i("theme.importTitle")}),e(Wt,{}),e(Ct,{children:n(me,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:y,children:i("theme.importDescription")}),e(Nr,{rows:8,placeholder:i("theme.importPlaceholder")||"",value:le,onChange:O=>V(O.target.value),bg:"transparent",borderColor:x,color:S})]})}),n(Ut,{children:[e(L,{variant:"ghost",mr:3,onClick:m.onClose,children:i("cancel")}),e(L,{colorScheme:"primary",onClick:Ne,children:i("theme.importAction")})]})]})]})]})},uu=Ce.object({username:Ce.string().min(1,"login.fieldRequired"),password:Ce.string().min(1,"login.fieldRequired")}),hu=oe("img",{baseStyle:{w:12,h:12}}),pu=oe(Tc,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),mu=oe(oi,{baseStyle:{w:4,h:4}}),gu=oe(Ra,{baseStyle:{w:4,h:4}}),ao=()=>{var y,v;const[t,s]=c.exports.useState(""),[r,l]=c.exports.useState(!1),[i,a]=c.exports.useState(!1),o=Ec(),{t:d}=Ke(),{colorMode:u}=jr();let m=Ua();const{register:p,formState:{errors:g},handleSubmit:x}=en({resolver:Fi(uu)});c.exports.useEffect(()=>{Jd(),m.pathname!=="/login"&&o("/login",{replace:!0})},[]);const S=T=>{s("");const N=new FormData;N.append("username",T.username),N.append("password",T.password),N.append("grant_type","password"),l(!0),Ee("/admin/token",{method:"post",body:N}).then(({access_token:W})=>{console.log("Token received:",W),Kd(W),o("/")}).catch(W=>{var he,E;s(((E=(he=W.response)==null?void 0:he._data)==null?void 0:E.detail)||"Login failed")}).finally(()=>l(!1))};return e(me,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(Lr,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:n(Tn,{children:[n(M,{justifyContent:"end",spacing:2,mb:6,children:[e(Zd,{}),e(Ul,{minimal:!0})]}),n(me,{alignItems:"center",w:"full",spacing:4,children:[e(hu,{src:Sa,alt:d("appName")||"Rebecca",filter:u==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:d("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:d("login.welcomeBack")})]}),e(z,{w:"full",pt:"4",children:e("form",{onSubmit:x(S),children:n(me,{spacing:4,children:[e(C,{children:e(ur,{w:"full",placeholder:d("username"),...p("username"),error:d((y=g==null?void 0:g.username)==null?void 0:y.message)})}),n(C,{isInvalid:!!g.password,children:[n(Mr,{children:[e(De,{w:"full",type:i?"text":"password",placeholder:d("password"),...p("password")}),e(Vr,{children:e(We,{"aria-label":i?d("admins.hidePassword","Hide"):d("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>a(!i),icon:i?e(gu,{}):e(mu,{})})})]}),e(an,{children:(v=g.password)==null?void 0:v.message})]}),t&&n(zr,{status:"error",rounded:"md",children:[e(Rr,{}),e(Hn,{children:t})]}),n(L,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(pu,{marginRight:1}),d("login")]})]})})})]})})})};var Qe=(t=>(t.Standard="standard",t.Sudo="sudo",t.FullAccess="full_access",t))(Qe||{}),Wn=(t=>(t.Active="active",t.Disabled="disabled",t.Deleted="deleted",t))(Wn||{}),ht=(t=>(t.Create="create",t.Delete="delete",t.ResetUsage="reset_usage",t.Revoke="revoke",t.CreateOnHold="create_on_hold",t.AllowUnlimitedData="allow_unlimited_data",t.AllowUnlimitedExpire="allow_unlimited_expire",t.AllowNextPlan="allow_next_plan",t))(ht||{}),dr=(t=>(t.View="can_view",t.Edit="can_edit",t.ManageSudo="can_manage_sudo",t))(dr||{}),St=(t=>(t.Usage="usage",t.Admins="admins",t.Services="services",t.Hosts="hosts",t.Nodes="nodes",t.Integrations="integrations",t.Xray="xray",t))(St||{});const fu=t=>JSON.parse(JSON.stringify(t)),bu={users:{[ht.Create]:!0,[ht.Delete]:!1,[ht.ResetUsage]:!1,[ht.Revoke]:!1,[ht.CreateOnHold]:!1,[ht.AllowUnlimitedData]:!1,[ht.AllowUnlimitedExpire]:!1,[ht.AllowNextPlan]:!1,max_data_limit_per_user:null},admin_management:{[dr.View]:!1,[dr.Edit]:!1,[dr.ManageSudo]:!1},sections:{[St.Usage]:!1,[St.Admins]:!1,[St.Services]:!1,[St.Hosts]:!1,[St.Nodes]:!1,[St.Integrations]:!1,[St.Xray]:!1}},yu={users:{[ht.Create]:!0,[ht.Delete]:!0,[ht.ResetUsage]:!0,[ht.Revoke]:!0,[ht.CreateOnHold]:!0,[ht.AllowUnlimitedData]:!0,[ht.AllowUnlimitedExpire]:!0,[ht.AllowNextPlan]:!0,max_data_limit_per_user:null},admin_management:{[dr.View]:!0,[dr.Edit]:!0,[dr.ManageSudo]:!1},sections:{[St.Usage]:!0,[St.Admins]:!0,[St.Services]:!0,[St.Hosts]:!0,[St.Nodes]:!0,[St.Integrations]:!0,[St.Xray]:!0}},Su={users:{[ht.Create]:!0,[ht.Delete]:!0,[ht.ResetUsage]:!0,[ht.Revoke]:!0,[ht.CreateOnHold]:!0,[ht.AllowUnlimitedData]:!0,[ht.AllowUnlimitedExpire]:!0,[ht.AllowNextPlan]:!0,max_data_limit_per_user:null},admin_management:{[dr.View]:!0,[dr.Edit]:!0,[dr.ManageSudo]:!0},sections:{[St.Usage]:!0,[St.Admins]:!0,[St.Services]:!0,[St.Hosts]:!0,[St.Nodes]:!0,[St.Integrations]:!0,[St.Xray]:!0}},oo={[Qe.Standard]:bu,[Qe.Sudo]:yu,[Qe.FullAccess]:Su},di=(t=Qe.Standard)=>{var s;return fu((s=oo[t])!=null?s:oo[Qe.Standard])},lo=t=>typeof t=="object"&&t!==null&&!Array.isArray(t),Ml=(t,s)=>{const r={...t};return Object.entries(s).forEach(([l,i])=>{if(i!==void 0){if(lo(i)&&lo(r[l])){r[l]=Ml(r[l],i);return}r[l]=i}}),r},xu=(t,s)=>s?Ml(di(t),s):di(t),ki=di(Qe.Standard),vu=async()=>await Ee("/admin"),hr=()=>{const{data:t,isError:s,isLoading:r,isSuccess:l,error:i}=Or({queryFn:()=>vu()}),a={role:Qe.Standard,permissions:di(Qe.Standard),telegram_id:"",username:"",users_usage:0,status:Wn.Active,disabled_reason:null},o=(t==null?void 0:t.role)||Qe.Standard,d=t!=null&&t.permissions?xu(o,t.permissions):di(o);return{userData:t?{...t,role:o,permissions:d}:{...a,role:o,permissions:d},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:s,getUserError:i}},wu=()=>Ee("/ads"),ku=(t=!0)=>Or({queryKey:["ads"],queryFn:wu,enabled:t,staleTime:1e3*60*30,cacheTime:1e3*60*60}),Cu=({ad:t,compact:s=!1,ratio:r,maxSize:l})=>{const i=Oe("gray.200","whiteAlpha.200"),a=Oe("gray.600","gray.300"),o=Oe("primary.600","primary.200"),d=s?2:3,u=s?2:3,m=t.type==="image"||Boolean(t.image_url),p=r!=null?r:s?3/1:1,g=l!=null?l:460,x=m?e(Nc,{ratio:p,w:"full",children:e(zc,{alt:t.title||t.text||"Advertisement",borderRadius:"md",objectFit:"contain",src:t.image_url,w:"100%",h:"100%"})}):n(ye,{spacing:1,children:[t.title&&e(h,{fontSize:s?"sm":"md",fontWeight:"semibold",children:t.title}),t.text&&e(h,{fontSize:s?"xs":"sm",color:a,noOfLines:s?3:4,children:t.text})]}),S=n(z,{borderColor:i,borderWidth:"1px",borderRadius:"md",bg:Oe("white","gray.800"),px:u,py:d,w:"full",maxW:`${g}px`,shadow:"sm",transition:"box-shadow 0.2s ease",_hover:{shadow:"md"},children:[x,!m&&t.cta&&e(h,{fontSize:s?"xs":"sm",fontWeight:"semibold",color:o,mt:t.image_url?2:3,children:t.cta})]});return t.link?e(Rc,{href:t.link,isExternal:!0,display:"block",_hover:{textDecoration:"none"},children:S}):S},_u=t=>(t||"en").split(/[-_]/)[0].toLowerCase(),Du=(t,s,r)=>{var o,d,u;if(!t)return;const l=_u(r),i=(d=(o=t.locales)==null?void 0:o[l])==null?void 0:d[s];if(i!=null&&i.length)return i[0];const a=(u=t.default)==null?void 0:u[s];return a==null?void 0:a[0]},zn={baseStyle:{w:5,h:5}},Au=oe(Uc,zn),Iu=oe(Mc,zn),Pu=oe(Lc,zn),ta=oe(Oc,zn),Tu=oe(Wc,zn),Eu=oe(Fc,zn),Nu=oe(Hi,zn),zu=oe(cl,zn),Ru=oe(dl,zn),co=oe("img",{baseStyle:{w:8,h:8}}),uo=({collapsed:t,inDrawer:s=!1,onRequestExpand:r})=>{var le;const{t:l,i18n:i}=Ke(),a=Ua(),{colorMode:o}=jr(),{userData:d,getUserIsSuccess:u}=hr(),m=u,{data:p}=ku(m),g=i.language||"en",x=m?Du(p,"sidebar",g):void 0,S=c.exports.useMemo(()=>{switch(d.role){case Qe.FullAccess:return l("admins.roles.fullAccess","Full access");case Qe.Sudo:return l("admins.roles.sudo","Sudo");case Qe.Standard:default:return l("admins.roles.standard","Standard")}},[l,d.role]),y=(le=d.permissions)==null?void 0:le.sections,v=Boolean(y==null?void 0:y[St.Usage]),T=Boolean(y==null?void 0:y[St.Admins]),N=Boolean(y==null?void 0:y[St.Services]),he=[...[y!=null&&y[St.Hosts]?{title:l("header.hostSettings"),url:"/hosts",icon:Pu}:null,y!=null&&y[St.Nodes]?{title:l("header.nodeSettings"),url:"/node-settings",icon:Tu}:null,y!=null&&y[St.Integrations]?{title:l("header.integrationSettings","Master Settings"),url:"/integrations",icon:ta}:null,y!=null&&y[St.Xray]?{title:l("header.xraySettings"),url:"/xray-settings",icon:ta}:null].filter(Boolean)],E=()=>{s&&r&&r()};N&&he.unshift({title:l("services.menu","Services"),url:"/services",icon:zu});const F=he.some(V=>a.pathname===V.url),[P,j]=c.exports.useState(F);c.exports.useEffect(()=>{F&&j(!0)},[F]);const q=[{title:l("dashboard"),url:"/",icon:Au},{title:l("users"),url:"/users",icon:Iu}];return v&&q.push({title:l("usage.menu","Usage"),url:"/usage",icon:Ru}),T&&q.push({title:l("admins","Admins"),url:"/admins",icon:Eu}),he.length>0&&q.push({title:l("header.settings"),icon:ta,subItems:he}),e(z,{w:s?"full":t?"16":"60",h:s?"100%":"100vh",maxH:s?"100%":"100vh",bg:"surface.light",borderRight:s?void 0:"1px",borderColor:s?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:s?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:s?"relative":"fixed",top:s?void 0:"0",left:s?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:n(me,{spacing:2,p:t?2:4,align:"stretch",h:"100%",justify:"space-between",children:[n(z,{flex:"1",overflowY:"auto",children:[t?e(M,{justify:"center",mb:6,children:e(ft,{label:"Rebecca",placement:"right",hasArrow:!0,children:e(co,{src:Sa,alt:"Rebecca",filter:o==="dark"?"brightness(0) invert(1)":"none"})})}):n(M,{spacing:3,align:"center",mb:6,px:2,children:[e(co,{src:Sa,alt:"Rebecca",filter:o==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"lg",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},children:l("menu")})]}),q.map(V=>{const ce=V.url,A=typeof ce=="string"&&a.pathname===ce||typeof ce=="string"&&ce!=="/"&&a.pathname.startsWith(ce)||V.subItems&&V.subItems.some(f=>a.pathname===f.url),be=V.icon;return e(z,{children:V.subItems?n(Bt,{children:[e(ft,{label:t?V.title:"",placement:"right",hasArrow:!0,children:n(M,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:A?"primary.50":"transparent",color:A?"primary.600":"gray.700",_dark:{bg:A?"primary.900":"transparent",color:A?"primary.200":"gray.300"},_hover:{bg:A?"primary.50":"gray.50",_dark:{bg:A?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>{t?(r&&r(),j(!0)):j(!P)},children:[n(M,{spacing:3,children:[e(be,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:A?"semibold":"normal",children:V.title})]}),!t&&e(Nu,{transform:P?"rotate(180deg)":"rotate(0deg)"})]})}),!t&&e(Cs,{in:P,animateOpacity:!0,children:e(me,{align:"stretch",pl:6,spacing:1,mt:2,children:V.subItems.map(f=>{const te=a.pathname===f.url,J=f.icon;return e(Ga,{to:f.url,onClick:E,children:n(M,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:te?"primary.50":"transparent",color:te?"primary.600":"gray.700",_dark:{bg:te?"primary.900":"transparent",color:te?"primary.200":"gray.300"},_hover:{bg:te?"primary.50":"gray.50",_dark:{bg:te?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(J,{w:t?5:void 0,h:t?5:void 0}),e(h,{fontSize:"sm",fontWeight:te?"semibold":"normal",children:f.title})]})},f.url)})})})]}):V.url?e(Ga,{to:V.url,onClick:E,children:e(ft,{label:t?V.title:"",placement:"right",hasArrow:!0,children:n(M,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:A?"primary.50":"transparent",color:A?"primary.600":"gray.700",_dark:{bg:A?"primary.900":"transparent",color:A?"primary.200":"gray.300"},_hover:{bg:A?"primary.50":"gray.50",_dark:{bg:A?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(be,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:A?"semibold":"normal",children:V.title})]})})}):null},V.title)})]}),x&&!t&&e(z,{px:t?2:3,py:3,mt:4,w:"full",children:e(Cu,{ad:x})}),u&&d.username&&e(z,{px:t?2:3,py:2,borderTop:"1px",borderColor:"light-border",_dark:{borderColor:"whiteAlpha.200"},mt:4,children:t?e(ft,{label:`${d.username} \xB7 ${S}`,placement:"right",hasArrow:!0,children:e(z,{w:"8",h:"8",borderRadius:"full",bg:"primary.100",_dark:{bg:"primary.800"},display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",flexShrink:0,children:e(h,{fontSize:"sm",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},textAlign:"center",children:d.username.charAt(0).toUpperCase()})})}):n(me,{align:"flex-start",spacing:1,children:[e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:"username:"}),e(h,{fontSize:"sm",fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},noOfLines:1,children:d.username}),e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:l("admins.roleLabel","Admin role")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:S})]})})]})})},Uu=()=>{const[t,s]=c.exports.useState(null);return jr(),c.exports.useEffect(()=>{fetch("https://api.github.com/repos/rebeccapanel/Rebecca").then(l=>l.json()).then(l=>{l.stargazers_count&&s(l.stargazers_count)}).catch(()=>{})},[]),e(z,{as:"button",onClick:()=>{window.open("https://github.com/rebeccapanel/Rebecca","_blank","noopener,noreferrer")},px:3,py:1.5,borderRadius:"md",borderWidth:"1px",borderColor:"gray.300",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},_hover:{bg:"gray.50",borderColor:"gray.400",transform:"translateY(-1px)",boxShadow:"sm",_dark:{bg:"gray.700",borderColor:"gray.500"}},transition:"all 0.2s",cursor:"pointer","aria-label":"GitHub Stars",children:n(M,{spacing:2,align:"center",children:[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"})}),n(M,{spacing:1,px:1.5,py:.5,borderRadius:"full",bg:"gray.100",_dark:{bg:"gray.700"},children:[e(Hc,{style:{width:"14px",height:"14px",color:"#fbbf24"}}),t!==null?e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.700",_dark:{color:"gray.200"},lineHeight:"1",children:t>1e3?`${(t/1e3).toFixed(1)}k`:t}):e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},lineHeight:"1",children:"..."})]})]})})},Ui=Bc,Mu="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",Ll={base:Mu,folder:"apple/64",ext:".png",className:"apple-emoji"},ra=t=>{var s,r;return typeof t=="string"&&((r=(s=Ui.test)==null?void 0:s.call(Ui,t))!=null?r:!1)},Lu=t=>t.some(s=>{var r;return s.type==="characterData"?ra((r=s.target)==null?void 0:r.data):s.type==="childList"?Array.from(s.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return ra(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const i=l;return i.tagName==="IMG"&&i.classList.contains(Ll.className)?!1:ra(i.textContent)}return!1}):!1}),Ou=()=>{const t=Ua();c.exports.useEffect(()=>{const s=document.getElementById("root");if(!s)return;const r=()=>{Ui.parse(s,Ll)};r();const l=new MutationObserver(i=>{Lu(i)&&requestAnimationFrame(r)});return l.observe(s,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},Vi={baseStyle:{w:4,h:4}},Wu=oe(Vc,Vi),Fu=oe(ul,Vi),Hu=oe(hl,Vi),Bu=oe(ol,Vi);function Vu(){const[t,s]=c.exports.useState(!1),r=Ur({base:!0,md:!1}),l=Qt(),i=Qt(),a=c.exports.useRef(null),{t:o,i18n:d}=Ke();Ou();const u=[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}],m=p=>{d.changeLanguage(p)};return n(gt,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(uo,{collapsed:t,onRequestExpand:()=>s(!1)}),n(gt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[n(z,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(We,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():s(!t)},icon:e(Fu,{})}),n(M,{spacing:2,children:[e(Uu,{}),n(Vn,{isOpen:i.isOpen,onOpen:i.onOpen,onClose:i.onClose,placement:"bottom-end",children:[e($n,{children:e(We,{size:"sm",variant:"outline",icon:e(Hu,{}),"aria-label":"quick actions",onClick:()=>i.isOpen?i.onClose():i.onOpen()})}),n(Kn,{ref:a,w:"full",maxW:{base:"calc(100vw - 2rem)",sm:"56"},mx:{base:4,sm:0},children:[e(os,{}),e(Jn,{children:n(ye,{spacing:2,children:[n(si,{placement:"left-start",isLazy:!0,children:[e(ks,{as:L,justifyContent:"space-between",rightIcon:e(Bu,{}),variant:"ghost",children:o("header.language","Language")}),e(Wi,{containerRef:a,children:e(ii,{minW:{base:"100%",sm:"200px"},maxW:{base:"100%",sm:"240px"},maxH:"60vh",overflowY:"auto",children:u.map(({code:p,label:g,flag:x})=>{const S=d.language===p;return e(lr,{onClick:()=>{m(p),i.onClose()},children:n(M,{justify:"space-between",w:"full",children:[n(M,{spacing:2,children:[e(ll,{countryCode:x,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:g})]}),S&&e(mi,{width:16})]})},p)})})})]}),e(Fn,{}),e(Ul,{trigger:"menu",triggerLabel:o("header.theme","Theme"),portalContainer:a}),e(Fn,{}),e(L,{colorScheme:"red",leftIcon:e(Wu,{}),justifyContent:"flex-start",as:$c,to:"/login",onClick:i.onClose,children:o("header.logout","Log out")})]})})]})]})]})]}),e(z,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(Kc,{})})]}),r&&n(Jc,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(kt,{}),e(qc,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(Ct,{p:0,children:e(uo,{collapsed:!1,inDrawer:!0,onRequestExpand:l.onClose})})})]})]})}const Ol="rebecca-num-users-per-page",ho=10,$u=()=>{const t=localStorage.getItem(Ol)||ho.toString();return parseInt(t)||ho},Ku=t=>localStorage.setItem(Ol,t),Wl="-created_at",Ju=60*60*1e3,qu=t=>{const s={sort:t.sort||Wl};return Object.keys(t).forEach(r=>{if(r==="sort")return;const l=t[r];if(Array.isArray(l)){if(l.length===0)return;s[r]=l;return}l==null||l===""||(s[r]=l)}),s},Yu=t=>JSON.stringify(Object.keys(t).sort().map(s=>[s,t[s]])),Gu=(t,s={})=>{var m;const r=qu(t),l=Yu(r),{lastUsersFetchAt:i,usersCacheKey:a,users:o}=Tt.getState(),d=Date.now();if(!s.force&&i&&a===l&&d-i<Ju)return Promise.resolve(o);Tt.setState({loading:!0});const u={...r};return(m=r.advancedFilters)!=null&&m.length&&(u.filter=r.advancedFilters),r.owner&&(u.admin=r.owner),r.serviceId!==void 0&&(u.service_id=r.serviceId),delete u.advancedFilters,delete u.owner,delete u.serviceId,Ee("/users",{query:u}).then(p=>{var y,v;const g=(y=p.users_limit)!=null?y:null,x=(v=p.active_total)!=null?v:null,S=g!=null&&g>0&&x!==null?x>=g:!1;return Tt.setState({users:p,isUserLimitReached:S,lastUsersFetchAt:Date.now(),usersCacheKey:l}),p}).finally(()=>{Tt.setState({loading:!1})})},ui=()=>Ee("/inbounds").then(t=>{Tt.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{Tt.setState({loading:!1})}),Tt=Ns(Yc((t,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,lastUsersFetchAt:null,usersCacheKey:null,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{limit:$u(),sort:Wl,advancedFilters:[],owner:void 0,serviceId:void 0},inbounds:new Map,isEditingCore:!1,refetchUsers:(r=!1)=>{Gu(s().filters,{force:r})},resetAllUsage:()=>Ee("/users/reset",{method:"POST"}).then(()=>{s().onResetAllUsage(!1),s().refetchUsers(!0)}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...s().filters,...r}}),s().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),Ee(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),s().refetchUsers(!0),Qs.invalidateQueries(Ci)})),createUser:r=>Ee("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),Qs.invalidateQueries(Ci)}),createUserWithService:r=>Ee("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),Qs.invalidateQueries(Ci)}),editUser:(r,l)=>Ee(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{s().onEditingUser(null),s().refetchUsers(!0)}),fetchUserUsage:(r,l)=>{for(const i in l)l[i]||delete l[i];return Ee(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>Ee(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),s().refetchUsers(!0)}),revokeSubscription:r=>Ee(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),s().refetchUsers(!0)}),performBulkUserAction:r=>Ee("/users/actions",{method:"POST",body:r}).then(l=>(s().refetchUsers(!0),Qs.invalidateQueries(Ci),l)),onEditingCore:r=>t({isEditingCore:r})})));function Fe(t,s=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,i=s<0?0:s,a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(t)/Math.log(l)),d=parseFloat((t/Math.pow(l,o)).toFixed(i));return r?[d,a[o]]:`${d} ${a[o]}`}const Xu=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Qu=[{label:"d",seconds:24*60*60},{label:"h",seconds:60*60},{label:"m",seconds:60},{label:"s",seconds:1}],na=(t=0)=>{const s=Math.max(0,Math.floor(t));if(s===0)return"0s";const r=[];let l=s;for(const i of Qu){const a=Math.floor(l/i.seconds);a>0&&(r.push(`${a}${i.label}`),l-=a*i.seconds)}return r.join(" ")},Ci="statistics-query-key",Zu={baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}},ju=oe(Gc,Zu),Zr=t=>{var s;return(s=Xu(t))!=null?s:t.toString()},Fl=[{labelKey:"historyInterval.2m",seconds:120},{labelKey:"historyInterval.10m",seconds:600},{labelKey:"historyInterval.30m",seconds:1800},{labelKey:"historyInterval.1h",seconds:3600},{labelKey:"historyInterval.3h",seconds:10800},{labelKey:"historyInterval.5h",seconds:18e3}],eh=({isOpen:t,onClose:s,payload:r,intervalSeconds:l,onIntervalChange:i,t:a})=>{var v;const{colorMode:o}=jr(),u=Math.floor(Date.now()/1e3)-l,m=c.exports.useMemo(()=>!r||r.type==="network"||r.type==="panel"?[]:r.entries.filter(T=>T.timestamp>=u),[r,u]),p=c.exports.useMemo(()=>!r||r.type!=="network"?[]:r.entries.filter(T=>T.timestamp>=u),[r,u]),g=c.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.cpuEntries.filter(T=>T.timestamp>=u),[r,u]),x=c.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.memoryEntries.filter(T=>T.timestamp>=u),[r,u]),S=c.exports.useMemo(()=>r?r.type==="network"?[{name:a("networkIncoming"),data:p.map(T=>[T.timestamp*1e3,T.incoming])},{name:a("networkOutgoing"),data:p.map(T=>[T.timestamp*1e3,T.outgoing])}]:r.type==="panel"?[{name:a("cpuUsage"),data:g.map(T=>[T.timestamp*1e3,T.value])},{name:a("memoryUsage"),data:x.map(T=>[T.timestamp*1e3,T.value])}]:[{name:r.metricLabel,data:m.map(T=>[T.timestamp*1e3,T.value])}]:[],[m,p,g,x,r,a]),y=c.exports.useMemo(()=>({chart:{type:"line",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1},background:"transparent"},theme:{mode:o},stroke:{curve:"smooth"},xaxis:{type:"datetime",labels:{datetimeFormatter:{hour:"HH:mm"}}},yaxis:{decimalsInFloat:0},tooltip:{x:{format:"HH:mm:ss"}}}),[o]);return n(Lt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(kt,{}),n(Ot,{children:[e(At,{children:a("historyModalTitle",{metric:(v=r==null?void 0:r.title)!=null?v:""})}),e(Wt,{}),e(Ct,{children:n(ye,{spacing:3,children:[e(gt,{wrap:"wrap",gap:2,children:Fl.map(T=>e(L,{size:"sm",variant:l===T.seconds?"solid":"outline",onClick:()=>i(T.seconds),children:a(T.labelKey)},T.seconds))}),e(ln,{options:y,series:S,type:"line",height:300})]})}),e(Ut,{children:e(L,{onClick:s,children:a("close")})})]})]})},th=({values:t,accent:s})=>{const r=Oe("gray.600","gray.300"),l=t.length?t:[0],i=Math.max(...l,1);return e(M,{alignItems:"flex-end",spacing:"2px",mt:2,minH:"42px",w:"full",overflow:"hidden",children:l.map((a,o)=>{const d=i>0?a/i*100:0,u=Math.max(4,Math.round(d/100*40));return e(z,{flex:"0 1 4px",minW:"2px",maxW:"4px",h:`${u}px`,bg:s!=null?s:r,borderRadius:"1px",transition:"all 0.2s"},o)})})},ni=({label:t,value:s,history:r,accent:l,onOpen:i,actionLabel:a})=>n(ye,{spacing:1,children:[n(M,{justifyContent:"space-between",alignItems:"center",children:[n(z,{children:[e(h,{fontSize:"xs",color:"gray.500",children:t}),e(h,{fontSize:"lg",fontWeight:"semibold",children:s})]}),i&&e(L,{size:"xs",variant:"ghost",onClick:i,children:a})]}),e(th,{values:r,accent:l})]}),rr=({label:t,value:s,colorScheme:r="gray"})=>{const l=Oe("gray.200","gray.700"),i=Oe("white","gray.900"),a=Oe(r==="gray"?"gray.800":`${r}.600`,r==="gray"?"gray.100":`${r}.300`);return n(z,{px:3,py:2,borderRadius:"md",borderWidth:"1px",borderColor:l,bg:i,_dark:{bg:"gray.800",borderColor:"gray.700"},children:[e(h,{fontSize:"xs",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",color:a,children:s})]})},rh=({data:t,t:s,onOpenHistory:r})=>{const l=t.cpu_history.map(o=>o.value),i=t.memory_history.map(o=>o.value),a=t.network_history.map(o=>o.incoming);return e(Lr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ye,{spacing:4,children:[n(ye,{direction:{base:"column",md:"row"},spacing:{base:2,md:4},justifyContent:"space-between",align:{base:"flex-start",md:"center"},children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("systemOverview")}),n(xs,{spacing:2,shouldWrapChildren:!0,justify:{base:"flex-start",md:"flex-end"},children:[e(jn,{children:n(ut,{colorScheme:"gray",children:["v",t.version]})}),e(jn,{children:n(ut,{colorScheme:"gray",children:[s("loadAverage"),": "," ",t.load_avg.length?t.load_avg.map(o=>o.toFixed(2)).join(" | "):"-"]})})]})]}),n(Le,{columns:{base:1,md:3},gap:4,children:[e(ni,{label:s("cpuUsage"),value:`${t.cpu_usage.toFixed(1)}%`,history:l,actionLabel:s("viewHistory"),onOpen:()=>r({type:"cpu",title:s("cpuUsage"),metricLabel:s("cpuUsage"),entries:t.cpu_history})}),e(ni,{label:s("memoryUsage"),value:`${t.memory.percent.toFixed(1)}%`,history:i,actionLabel:s("viewHistory"),onOpen:()=>r({type:"memory",title:s("memoryUsage"),metricLabel:s("memoryUsage"),entries:t.memory_history})}),e(ni,{label:s("networkHistory"),value:`${Fe(t.incoming_bandwidth_speed)}/s`,history:a,actionLabel:s("viewHistory"),onOpen:()=>r({type:"network",title:s("networkHistory"),entries:t.network_history})})]}),n(Le,{columns:{base:1,md:2},gap:4,children:[e(rr,{label:s("incomingSpeed"),value:`${Fe(t.incoming_bandwidth_speed)}/s`,colorScheme:"green"}),e(rr,{label:s("outgoingSpeed"),value:`${Fe(t.outgoing_bandwidth_speed)}/s`,colorScheme:"blue"})]}),n(Le,{columns:{base:1,md:3},gap:4,children:[e(rr,{label:s("memoryUsage"),value:`${Fe(t.memory.current)} / ${Fe(t.memory.total)}`}),e(rr,{label:s("swapUsage"),value:`${Fe(t.swap.current)} / ${Fe(t.swap.total)}`}),e(rr,{label:s("diskUsage"),value:`${Fe(t.disk.current)} / ${Fe(t.disk.total)}`})]}),n(ye,{direction:{base:"column",md:"row"},spacing:2,flexWrap:"wrap",alignItems:"flex-start",children:[n(ut,{colorScheme:"green",children:[s("systemUptime"),": ",na(t.uptime_seconds)]}),n(ut,{colorScheme:"blue",children:[s("panelUptime"),": ",na(t.panel_uptime_seconds)]}),n(ut,{colorScheme:"orange",children:[s("xrayUptime"),": ",na(t.xray_uptime_seconds)]})]})]})})},nh=({data:t,t:s,onOpenHistory:r})=>{const l=t.panel_cpu_history.map(a=>a.value),i=t.panel_memory_history.map(a=>a.value);return e(Lr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ye,{spacing:4,children:[n(M,{justifyContent:"space-between",alignItems:"center",children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("panelUsage")}),e($r,{colorScheme:t.xray_running?"green":"red",children:t.xray_running?s("status.running"):s("status.stopped")})]}),n(Le,{columns:{base:1,md:2},gap:4,children:[e(ni,{label:s("cpuUsage"),value:`${t.panel_cpu_percent.toFixed(1)}%`,history:l,actionLabel:s("viewHistory"),onOpen:()=>r({type:"panel",title:s("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})}),e(ni,{label:s("memoryUsage"),value:`${t.panel_memory_percent.toFixed(1)}%`,history:i,actionLabel:s("viewHistory"),onOpen:()=>r({type:"panel",title:s("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})})]}),n(Le,{columns:{base:1,md:3},gap:4,children:[e(rr,{label:s("threads"),value:Zr(t.app_threads),colorScheme:"purple"}),e(rr,{label:s("appMemory"),value:Fe(t.app_memory),colorScheme:"blue"})]})]})})},sh=({value:t,t:s})=>{const r=Oe("gray.200","gray.700"),l=Oe("gray.50","gray.900"),i=Oe("primary.100","primary.900"),a=Oe("primary.500","primary.200");return e(z,{borderWidth:"1px",borderColor:r,borderRadius:"md",bg:l,p:4,children:n(M,{justifyContent:"space-between",alignItems:"center",children:[n(M,{alignItems:"center",spacing:3,children:[e(z,{p:2,borderRadius:"md",bg:i,children:e(ju,{color:a})}),e(h,{fontSize:"xs",color:"gray.500",children:s("UsersUsage")})]}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:Fe(t)})]})})},ih=({data:t,t:s})=>e(Lr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ye,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("usersOverview")}),e(rr,{label:s("totalUsersLabel"),value:Zr(t.total_user),colorScheme:"blue"}),e(sh,{value:t.panel_total_bandwidth,t:s}),n(Le,{columns:{base:1,sm:2},gap:3,children:[e(rr,{label:s("status.active"),value:Zr(t.users_active),colorScheme:"green"}),e(rr,{label:s("status.disabled"),value:Zr(t.users_disabled),colorScheme:"red"}),e(rr,{label:s("status.expired"),value:Zr(t.users_expired),colorScheme:"orange"}),e(rr,{label:s("status.limited"),value:Zr(t.users_limited),colorScheme:"yellow"}),e(rr,{label:s("status.on_hold"),value:Zr(t.users_on_hold),colorScheme:"purple"})]})]})}),ah=({data:t,t:s})=>t?e(Lr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ye,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("yourUsage")}),n(Le,{columns:{base:1,md:2},gap:4,children:[e(rr,{label:s("totalUsersLabel"),value:Zr(t.total_users),colorScheme:"blue"}),e(rr,{label:s("consumedData"),value:Fe(t.consumed_bytes),colorScheme:"green"}),e(rr,{label:s("builtData"),value:Fe(t.built_bytes),colorScheme:"purple"}),e(rr,{label:s("resetData"),value:Fe(t.reset_bytes),colorScheme:"orange"})]})]})}):null,oh=({data:t,t:s})=>t?e(Lr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(ye,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("adminOverview")}),n(Le,{columns:{base:1,md:2},gap:3,children:[e(rr,{label:s("totalAdmins"),value:Zr(t.total_admins),colorScheme:"blue"}),e(rr,{label:s("sudoAdmins"),value:Zr(t.sudo_admins),colorScheme:"purple"}),e(rr,{label:s("fullAccessAdmins"),value:Zr(t.full_access_admins),colorScheme:"green"}),e(rr,{label:s("standardAdmins"),value:Zr(t.standard_admins),colorScheme:"orange"})]}),t.top_admin_username&&n(z,{children:[n(h,{fontSize:"sm",color:"gray.500",children:[s("topAdmin"),":"," ",e(h,{as:"span",fontWeight:"semibold",children:t.top_admin_username})]}),n(h,{fontSize:"sm",color:"gray.500",children:[s("topAdminUsage"),": ",Fe(t.top_admin_usage)]})]})]})}):null,lh=t=>{const{version:s}=Tt(),{userData:r}=hr(),{t:l}=Ke(),{data:i}=Or({queryKey:"statistics-query-key",queryFn:()=>Ee("/system"),refetchInterval:3e3,onSuccess:({version:y})=>{s!==y&&Tt.setState({version:y})}}),[a,o]=c.exports.useState(null),[d,u]=c.exports.useState(Fl[0].seconds),m=r.role===Qe.Sudo||r.role===Qe.FullAccess,p=y=>{o(y)},g=[];i&&g.push(e(ih,{data:i,t:l},"users-overview"));const x=(i==null?void 0:i.personal_usage)&&e(ah,{data:i.personal_usage,t:l},"your-usage");x&&g.push(x);const S=g.length>1?2:1;return n(ye,{spacing:4,width:"full",...t,children:[i&&n(Bt,{children:[e(rh,{data:i,t:l,onOpenHistory:p}),e(nh,{data:i,t:l,onOpenHistory:p})]}),g.length>0&&e(Le,{columns:{base:1,md:S},gap:4,children:g}),m&&i&&e(oh,{data:i.admin_overview,t:l}),e(eh,{isOpen:Boolean(a),onClose:()=>o(null),payload:a,intervalSeconds:d,onIntervalChange:u,t:l})]})},ch=()=>{const{t}=Ke();return e(me,{spacing:6,align:"stretch",children:n(z,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(lh,{})]})})},ns=({children:t,color:s})=>e(z,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(h,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:t})}),bi=oe(wn,{baseStyle:{w:5,h:5}}),dh=()=>{const[t,s]=c.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:i}=Tt(),{t:a}=Ke(),o=Zt(),d=()=>{l(null)},u=()=>{r&&(s(!0),i(r).then(()=>{o({title:a("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(d).finally(s.bind(null,!1)))};return n(Lt,{isCentered:!0,isOpen:!!r,onClose:d,size:"sm",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",children:[e(At,{pt:6,children:e(ns,{color:"red",children:e(bi,{})})}),e(Wt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:a("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:a("deleteUser.prompt",{username:r.username})})})]}),n(Ut,{display:"flex",children:[e(L,{size:"sm",onClick:d,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(L,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(Et,{size:"xs"}):void 0,children:a("delete")})]})]})]})},uh={search:"",limit:10,offset:0,sort:"username"},dn=Ns((t,s)=>({admins:[],total:0,loading:!1,filters:uh,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=s(),i={...l,...r},a={};i.search&&(a.username=i.search),i.offset!==void 0&&(a.offset=i.offset),i.limit!==void 0&&(a.limit=i.limit),i.sort&&(i.sort==="data_usage"?a.sort="users_usage":i.sort==="data_limit"?a.sort="data_limit":a.sort=i.sort),t({loading:!0});try{const o=await Ee("/admins",{query:a}),{admins:d,total:u}=Array.isArray(o)?{admins:o,total:o.length}:{admins:o.admins||[],total:o.total||0};t(m=>{const p=m.adminInDetails?d.find(g=>{var x;return g.username===((x=m.adminInDetails)==null?void 0:x.username)})||m.adminInDetails:null;return{admins:d,total:u,adminInDetails:p}})}catch(o){console.error("Failed to fetch admins:",o),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),s().fetchAdmins()},async createAdmin(r){await Ee("/admin",{method:"POST",body:r}),await s().fetchAdmins()},async updateAdmin(r,l){await Ee(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await s().fetchAdmins()},async deleteAdmin(r){await Ee(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await s().fetchAdmins()},async resetUsage(r){await Ee(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await s().fetchAdmins()},async disableAdmin(r,l){await Ee(`/admin/${encodeURIComponent(r)}/disable`,{method:"POST",body:{reason:l}}),await s().fetchAdmins()},async enableAdmin(r){await Ee(`/admin/${encodeURIComponent(r)}/enable`,{method:"POST"}),await s().fetchAdmins()},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),es=Ns((t,s)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await Ee("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await Ee(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await Ee("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const i=await Ee(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:i}),await s().fetchServices(),i}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await Ee(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await s().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await Ee(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),hh=["expired","limited"],ph=()=>{const{t}=Ke(),s=Zt(),{performBulkUserAction:r}=Tt(),{userData:l}=hr(),{isOpen:i,onOpen:a,onClose:o}=Qt(),[d,u]=c.exports.useState(""),[m,p]=c.exports.useState(""),[g,x]=c.exports.useState(""),[S,y]=c.exports.useState(["expired","limited"]),[v,T]=c.exports.useState(!1),[N,W]=c.exports.useState(!1),[he,E]=c.exports.useState(!1),[F,P]=c.exports.useState(!1),[j,q]=c.exports.useState(!1),[le,V]=c.exports.useState("my_users"),{admins:ce,fetchAdmins:A}=dn(),be=l.role===Qe.Sudo||l.role===Qe.FullAccess;c.exports.useEffect(()=>{i&&be&&A({limit:200,offset:0})},[A,be,i]);const f=()=>be?le==="all_users"?null:le==="my_users"?l.username:le.startsWith("admin:")?le.replace(/^admin:/,""):l.username:l.username,te=(K,ee)=>{s({title:t("filters.advancedActions.modalTitle","Advanced actions"),description:K,status:ee,isClosable:!0})},J=K=>{te(K!=null?K:t("filters.advancedActions.error.general","Unable to perform action"),"error")},we=async K=>{var xe;const ee=Number(d);if(!Number.isFinite(ee)||ee<=0){te(t("filters.advancedActions.error.invalidDays","Enter a positive number of days"),"warning");return}const _e=K==="extend_expire"?T:W;_e(!0);try{const B=f(),O={action:K,days:Math.floor(ee),admin_username:B},G=await r(O);te(t("filters.advancedActions.success.expire",{count:(xe=G.count)!=null?xe:0}),"success"),u("")}catch{J()}finally{_e(!1)}},Te=async K=>{var xe;const ee=Number(m);if(!Number.isFinite(ee)||ee<=0){te(t("filters.advancedActions.error.invalidGigabytes","Enter a positive traffic value"),"warning");return}const _e=K==="increase_traffic"?E:P;_e(!0);try{const B=f(),G=await r({action:K,gigabytes:ee,admin_username:B});te(t("filters.advancedActions.success.traffic",{count:(xe=G.count)!=null?xe:0,value:ee}),"success"),p("")}catch{J()}finally{_e(!1)}},Ne=async()=>{var ee;const K=Number(g);if(!Number.isFinite(K)||K<=0){te(t("filters.advancedActions.error.invalidDays","Enter a positive number of days"),"warning");return}if(!S.length){te(t("filters.advancedActions.error.noStatuses","Select at least one status"),"warning");return}q(!0);try{const _e=f(),xe={action:"cleanup_status",days:Math.floor(K),statuses:S,admin_username:_e},B=await r(xe);te(t("filters.advancedActions.success.cleanup",{count:(ee=B.count)!=null?ee:0}),"success"),x("")}catch{J()}finally{q(!1)}},$=K=>{y(ee=>ee.includes(K)?ee.filter(_e=>_e!==K):[...ee,K])};return n(Bt,{children:[e(L,{leftIcon:e(ai,{className:"w-4 h-4"}),onClick:a,size:"sm",variant:"outline",children:t("filters.advancedActions.button","Advanced actions")}),n(Lt,{isOpen:i,onClose:o,size:"lg",children:[e(kt,{}),n(Ot,{children:[e(At,{children:t("filters.advancedActions.modalTitle","Advanced actions")}),e(Wt,{}),e(Ct,{children:n(me,{spacing:6,align:"stretch",children:[n(zr,{status:"warning",borderRadius:"md",children:[e(Rr,{}),e(h,{children:t("filters.advancedActions.modalDescription","These tools update every user and cannot be undone. Please double-check the values before confirming.")})]}),be&&n(C,{children:[e(_,{fontWeight:"semibold",children:t("filters.advancedActions.scope.label","Scope")}),n(rt,{value:le,onChange:K=>{const ee=K.target.value;(ee==="my_users"||ee==="all_users"||ee.startsWith("admin:"))&&V(ee)},size:"sm",children:[e("option",{value:"my_users",children:t("filters.advancedActions.scope.myUsers","My users")}),e("option",{value:"all_users",children:t("filters.advancedActions.scope.allUsers","All users")}),ce.filter(K=>K.username!==l.username).map(K=>e("option",{value:`admin:${K.username}`,children:K.username},K.username))]}),e(cr,{fontSize:"sm",children:t("filters.advancedActions.scope.helper","Select an admin or all users for this action.")})]}),n(ye,{spacing:4,children:[e(z,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:n(ye,{spacing:2,children:[e(h,{fontWeight:"semibold",children:t("filters.advancedActions.expireSection.title","Expiration dates")}),e(h,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.expireSection.description","Add or subtract days from every user's expiration timestamp.")}),n(C,{children:[e(_,{children:t("filters.advancedActions.expireSection.inputLabel","Days")}),e(xn,{value:d,onChange:u,min:1,step:1,w:"full",children:e(Sn,{})}),e(cr,{children:t("filters.advancedActions.expireSection.helper","The entered value will be added or removed when you click a button.")})]}),n(M,{spacing:2,flexWrap:"wrap",children:[e(L,{colorScheme:"primary",isLoading:v,flex:"1",minW:"150px",onClick:()=>we("extend_expire"),children:t("filters.advancedActions.expireSection.addButton","Add days to all users")}),e(L,{colorScheme:"gray",variant:"outline",isLoading:N,flex:"1",minW:"150px",onClick:()=>we("reduce_expire"),children:t("filters.advancedActions.expireSection.removeButton","Subtract days from all users")})]})]})}),e(z,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:n(ye,{spacing:2,children:[e(h,{fontWeight:"semibold",children:t("filters.advancedActions.trafficSection.title","Usage and traffic")}),e(h,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.trafficSection.description","Apply a traffic adjustment to all users.")}),n(C,{children:[e(_,{children:t("filters.advancedActions.trafficSection.inputLabel","Gigabytes")}),e(xn,{value:m,onChange:p,min:.01,step:.1,w:"full",children:e(Sn,{})})]}),n(M,{spacing:2,flexWrap:"wrap",children:[e(L,{colorScheme:"primary",isLoading:he,flex:"1",minW:"150px",onClick:()=>Te("increase_traffic"),children:t("filters.advancedActions.trafficSection.addButton","Add traffic to all users")}),e(L,{colorScheme:"gray",variant:"outline",isLoading:F,flex:"1",minW:"150px",onClick:()=>Te("decrease_traffic"),children:t("filters.advancedActions.trafficSection.removeButton","Subtract traffic from all users")})]})]})}),e(z,{borderWidth:"1px",borderRadius:"md",px:4,py:4,children:n(ye,{spacing:2,children:[e(h,{fontWeight:"semibold",children:t("filters.advancedActions.cleanupSection.title","Cleanup expired or limited")}),e(h,{fontSize:"sm",color:"gray.500",children:t("filters.advancedActions.cleanupSection.description","Remove users that have been expired/limited for the selected number of days.")}),n(C,{children:[e(_,{children:t("filters.advancedActions.cleanupSection.daysLabel","Days since status change")}),e(xn,{value:g,onChange:x,min:1,step:1,w:"full",children:e(Sn,{})})]}),e(M,{spacing:3,children:hh.map(K=>e(wr,{isChecked:S.includes(K),onChange:()=>$(K),children:t(`filters.advancedActions.cleanupSection.statuses.${K}`,K.charAt(0).toUpperCase()+K.slice(1))},K))}),e(L,{colorScheme:"primary",isLoading:j,w:"full",onClick:Ne,children:t("filters.advancedActions.cleanupSection.button","Delete selected users")})]})})]})]})}),e(Ut,{children:e(L,{variant:"ghost",onClick:o,children:t("filters.advancedActions.close","Close")})})]})]})]})},yi={baseStyle:{w:4,h:4}},mh=oe(pl,yi),gh=oe(Xc,yi),fh=oe(Ta,yi),bh=oe(cn,yi),yh=oe(Nn,yi),po=[{key:"online",labelKey:"filters.advanced.online",fallback:"Online right now"},{key:"offline",labelKey:"filters.advanced.offline",fallback:"Offline for 24h"},{key:"sub_not_updated",labelKey:"filters.advanced.subNotUpdated",fallback:"Sub link stale for 24h"},{key:"sub_never_updated",labelKey:"filters.advanced.subNeverUpdated",fallback:"Sub link never updated"},{key:"limit",labelKey:"filters.advanced.limit",fallback:"Has data limit"},{key:"unlimited",labelKey:"filters.advanced.unlimited",fallback:"Unlimited users"},{key:"finished",labelKey:"filters.advanced.finished",fallback:"Finished (limited or expired)"},{key:"expired",labelKey:"filters.advanced.statusExpired",fallback:"Expired users"},{key:"limited",labelKey:"filters.advanced.statusLimited",fallback:"Limited users"},{key:"disabled",labelKey:"filters.advanced.statusDisabled",fallback:"Disabled users"},{key:"on_hold",labelKey:"filters.advanced.statusOnHold",fallback:"On-hold users"}],Sh=Qc((t,s)=>{s==="users"?Tt.getState().onFilterChange({search:t,offset:0}):dn.getState().onFilterChange({search:t,offset:0})},300),Hl=({for:t="users",...s})=>{var O,G,pe,k,I,U,Y,Ie;const{loading:r,filters:l,onFilterChange:i,refetchUsers:a,onCreateUser:o}=Tt(),{loading:d,filters:u,onFilterChange:m,fetchAdmins:p,openAdminDialog:g,admins:x}=dn(),{t:S}=Ke(),[y,v]=c.exports.useState(""),{userData:T}=hr(),N=T.role===Qe.Sudo||T.role===Qe.FullAccess,W=!N&&T.status===Wn.Disabled,he=Boolean(((G=(O=T.permissions)==null?void 0:O.admin_management)==null?void 0:G[dr.Edit])||T.role===Qe.FullAccess),E=N||Boolean((k=(pe=T.permissions)==null?void 0:pe.users)==null?void 0:k[ht.Create]),F=t==="users"?E&&!W:he,P=t==="users"?r:d,j=t==="users",q=j?l:u,le=j?l:void 0,V=Boolean(le),ce=(I=le==null?void 0:le.advancedFilters)!=null?I:[],A=le==null?void 0:le.serviceId,be=le==null?void 0:le.owner,{services:f,fetchServices:te}=es();c.exports.useEffect(()=>{te({limit:500})},[te]),c.exports.useEffect(()=>{N&&p({limit:200,offset:0})},[p,N]),c.exports.useEffect(()=>{var He,R;const Se=j?(He=l.search)!=null?He:"":(R=u.search)!=null?R:"";v(Se)},[j,l.search,u.search]);const J=Se=>{const He=po.find(R=>R.key===Se);return He?S(He.labelKey,He.fallback):Se},we=Se=>{if(!V)return;const He=ce.includes(Se)?ce.filter(R=>R!==Se):[...ce,Se];i({advancedFilters:He,offset:0})},Te=()=>{!V||ce.length===0||i({advancedFilters:[],offset:0})},Ne=Se=>{i({serviceId:Se?Number(Se):void 0,offset:0})},$=Se=>{i({owner:Se||void 0,offset:0})},K=Se=>{v(Se.target.value),Sh(Se.target.value,t)},ee=()=>{v(""),j?i({...l,offset:0,search:""}):m({search:"",offset:0})},_e=()=>{t==="users"?a(!0):p()},xe=()=>{if(t==="users"){if(W||!E)return;o(!0)}else he&&g()},B=(U=Ur({base:!0,sm:!1}))!=null?U:!1;return n(li,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...s,children:[n(vn,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:[n(M,{spacing:2,align:"center",w:"full",children:[n(Mr,{flex:"1",children:[e(ml,{pointerEvents:"none",children:e(mh,{})}),e(De,{placeholder:t==="users"?S("search"):S("admins.searchPlaceholder","Search admins..."),value:y,borderColor:"light-border",w:"full",onChange:K}),n(Vr,{children:[P&&e(Et,{size:"xs"}),q.search&&q.search.length>0&&e(We,{onClick:ee,"aria-label":"clear",size:"xs",variant:"ghost",children:e(fh,{})})]})]}),V&&n(Vn,{placement:"bottom-start",children:[e($n,{children:e(L,{leftIcon:e(gh,{}),size:B?"sm":"md",variant:"outline",borderRadius:"full",minW:B?"auto":"8rem",h:B?"36px":void 0,fontSize:B?"xs":"sm",children:S("filters.advancedButton","Filters")})}),n(Kn,{borderColor:"light-border",minW:"250px",children:[e(os,{}),e(Ma,{}),e(gl,{fontWeight:"semibold",children:S("filters.advancedTitle","Advanced filters")}),n(Jn,{children:[e(ye,{spacing:2,children:po.map(Se=>e(wr,{isChecked:ce.includes(Se.key),onChange:()=>we(Se.key),children:J(Se.key)},Se.key))}),n(ye,{spacing:3,mt:3,children:[n(z,{children:[e(h,{fontSize:"sm",fontWeight:"semibold",mb:1,children:S("filters.advanced.serviceLabel","Service filter")}),n(rt,{value:A?String(A):"",onChange:Se=>Ne(Se.target.value),size:"sm",children:[e("option",{value:"",children:S("filters.advanced.serviceAll","All services")}),f.map(Se=>e("option",{value:String(Se.id),children:Se.name},Se.id))]})]}),N&&n(z,{children:[e(h,{fontSize:"sm",fontWeight:"semibold",mb:1,children:S("filters.advanced.adminLabel","Admin filter")}),n(rt,{value:be!=null?be:"",onChange:Se=>$(Se.target.value),size:"sm",children:[e("option",{value:"",children:S("filters.advanced.adminAll","All admins")}),e("option",{value:T.username,children:S("filters.advanced.adminMyUsers","My users")}),x.map(Se=>e("option",{value:Se.username,children:Se.username},Se.username))]})]})]}),e(L,{variant:"ghost",size:"sm",mt:3,w:"full",onClick:Te,isDisabled:ce.length===0,children:S("filters.advancedClear","Clear filters")})]})]})]}),e(We,{"aria-label":"refresh",disabled:P,onClick:_e,size:B?"sm":"md",variant:B?"ghost":"outline",borderRadius:"full",minW:B?"36px":"40px",h:B?"36px":void 0,children:e(bh,{className:Ea({"animate-spin":P})})})]}),V&&(ce.length>0||Boolean(A)||Boolean(be))&&n(xs,{mt:2,spacing:2,children:[ce.map(Se=>n(ut,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ti,{children:J(Se)}),e(Ni,{onClick:He=>{He.preventDefault(),He.stopPropagation(),we(Se)}})]},Se)),A&&n(ut,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ti,{children:S("filters.advanced.serviceTag","Service: {{name}}",{name:(Ie=(Y=f.find(Se=>Se.id===A))==null?void 0:Y.name)!=null?Ie:A})}),e(Ni,{onClick:Se=>{Se.preventDefault(),Se.stopPropagation(),Ne("")}})]},"service"),be&&n(ut,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ti,{children:be===T.username?S("filters.advanced.adminTagMine","My users"):be}),e(Ni,{onClick:Se=>{Se.preventDefault(),Se.stopPropagation(),$("")}})]},"owner")]})]}),e(vn,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:n(ye,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:[e(ph,{}),F&&e(L,{colorScheme:"primary",size:B?"sm":"md",onClick:xe,isDisabled:t==="admins"&&!he,px:B?3:5,leftIcon:B?void 0:e(yh,{}),w:"auto",h:B?"36px":void 0,minW:B?"auto":"8.5rem",fontSize:B?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?S("createUser"):S("admins.addAdmin","Add admin")})]})})]})},xh=oe(Zc,{baseStyle:{w:4,h:4}}),vh=oe(jc,{baseStyle:{w:4,h:4}}),mo=5;function wh(t,s,r){if(r<mo)throw new Error(`Must allow at least ${mo} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,s-Math.floor(r/2))),i=new Array(r);for(let a=0;a<r;a+=1)i[a]=a+l;return typeof i[0]=="number"&&i[0]>0&&(i[0]=0,i[1]="prev-more"),i[i.length-1]<t-1&&(i[i.length-1]=t-1,i[i.length-2]="next-more"),i}const Bl=({for:t="users"})=>{const{filters:s,onFilterChange:r,users:{total:l}}=Tt(),{filters:i,onFilterChange:a,total:o}=dn(),{t:d}=Ke(),{filters:u,total:m,onFilterChange:p}=c.exports.useMemo(()=>t==="admins"?{filters:i,total:o,onFilterChange:a}:{filters:s,total:l,onFilterChange:r},[t,i,o,a,s,l,r]),{limit:g,offset:x}=u,S=Number(g||10),y=Number(x||0),v=Math.floor(y/S),T=Math.ceil(m/S),N=wh(T,v,7),W=P=>{p({...u,offset:P*S})},he=P=>{const j=parseInt(P.target.value,10);p({...u,limit:j,offset:0}),t==="users"&&Ku(P.target.value)},E=c.exports.useMemo(()=>v>0&&T>0,[v,T]),F=c.exports.useMemo(()=>v+1<T&&T>0,[v,T]);return m<=S&&v===0?null:n(M,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(z,{order:{base:2,md:1},children:n(M,{children:[n(rt,{minW:"60px",value:String(S),onChange:he,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:d("itemsPerPage")})]})}),n(fl,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(L,{leftIcon:e(xh,{}),onClick:()=>W(v-1),isDisabled:!E,children:d("previous")}),N.map(P=>typeof P=="string"?e(L,{children:"..."},P):e(L,{variant:P===v?"solid":"outline",onClick:()=>W(P),children:P+1},P)),e(L,{rightIcon:e(vh,{}),onClick:()=>W(v+1),isDisabled:!F,children:d("next")})]})]})},kh=ed;const go=oe(td),Ch=oe(La,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),_h=oe(bl,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Dh=oe(yl,{baseStyle:{w:5,h:5}}),Ah=()=>{const{QRcodeLinks:t,setQRCode:s,setSubLink:r,subscribeUrl:l}=Tt(),i=t!==null,[a,o]=c.exports.useState(0),{t:d}=Ke(),u=()=>{s(null),r(null)},m=String(l).startsWith("/")?window.location.origin+l:String(l);return n(Lt,{isOpen:i,onClose:u,children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(At,{pt:6,children:e(ns,{color:"primary",children:e(Dh,{color:"white"})})}),e(Wt,{mt:3}),t&&n(Ct,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&n(me,{children:[e(go,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:d("qrcodeDialog.sublink")})]}),n(z,{w:"300px",children:[e(kh,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:o,onInit:()=>o(0),nextArrow:e(We,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(Ch,{})}),prevArrow:e(We,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(_h,{})}),children:t.map((p,g)=>e(M,{children:e(go,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"})},g))}),n(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[a+1," / ",t.length]})]})]})]})]})},Ih=oe(cn,{baseStyle:{w:5,h:5}}),Ph=()=>{const[t,s]=c.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=Tt(),{t:i}=Ke(),a=Zt(),o=()=>{Tt.setState({resetUsageUser:null})},d=()=>{r&&(s(!0),l(r).then(()=>{a({title:i("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:i("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Lt,{isCentered:!0,isOpen:!!r,onClose:o,size:"sm",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",children:[e(At,{pt:6,children:e(ns,{color:"blue",children:e(Ih,{})})}),e(Wt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:i("resetUserUsage.prompt",{username:r.username})})})]}),n(Ut,{display:"flex",children:[e(L,{size:"sm",onClick:o,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(L,{size:"sm",w:"full",colorScheme:"blue",onClick:d,leftIcon:t?e(Et,{size:"xs"}):void 0,children:i("reset")})]})]})]})},Th=oe(cn,{baseStyle:{w:5,h:5}}),Eh=()=>{const[t,s]=c.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=Tt(),{t:i}=Ke(),a=Zt(),o=()=>{Tt.setState({revokeSubscriptionUser:null})},d=()=>{r&&(s(!0),l(r).then(()=>{a({title:i("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:i("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Lt,{isCentered:!0,isOpen:!!r,onClose:o,size:"sm",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",children:[e(At,{pt:6,children:e(ns,{color:"blue",children:e(Th,{})})}),e(Wt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:i("revokeUserSub.prompt",{username:r.username})})})]}),n(Ut,{display:"flex",children:[e(L,{size:"sm",onClick:o,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(L,{size:"sm",w:"full",colorScheme:"blue",onClick:d,leftIcon:t?e(Et,{size:"xs"}):void 0,children:i("revoke")})]})]})]})},Si={baseStyle:{strokeWidth:"2px",w:4,h:4}},fo=oe(rd,Si),Nh=oe(nd,Si),bo=oe(sd,Si),yo=oe(Sl,Si),zh=oe(Sl,Si),va=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],ts={active:{statusColor:"green",bandWidthColor:"primary",icon:fo},connected:{statusColor:"green",bandWidthColor:"primary",icon:fo},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:Nh},expired:{statusColor:"orange",bandWidthColor:"orange",icon:yo},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:zh},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:yo},limited:{statusColor:"red",bandWidthColor:"red",icon:bo},error:{statusColor:"red",bandWidthColor:"red",icon:bo}},Rh=async()=>Ee("/settings/telegram"),Uh=async t=>Ee("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),Fa=async()=>Ee("/settings/panel"),Mh=async t=>Ee("/settings/panel",{method:"PUT",body:JSON.stringify(t)}),$i=t=>{let s={status:"",time:""};if(t){Re(t*1e3).utc().isAfter(Re().utc())?s.status="expires":s.status="expired";const r=[],l=Re.duration(Re(t*1e3).utc().diff(Re()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),s.time=r.join(", ")}return s},Lh=({value:t,onChange:s,placeholder:r="Select date",disabled:l=!1,minDate:i,quickSelects:a=[]})=>{const{isOpen:o,onOpen:d,onClose:u}=Qt(),[m,p]=c.exports.useState(()=>t?Re(t):Re()),[g,x]=c.exports.useState({hour:t?Re(t).hour():12,minute:t?Re(t).minute():0}),S=Oe("white","gray.900"),y=Oe("gray.900","white"),v=Oe("gray.200","gray.700"),T=Oe("gray.50","gray.800"),N=Oe("gray.100","gray.700"),W=Oe("gray.100","gray.700"),he=Oe("gray.500","gray.400"),E=Oe("gray.400","gray.500"),F=Oe("gray.100","gray.700"),P=Oe("gray.200","gray.700"),j=Oe("gray.600","gray.400"),q=Oe("primary.500","primary.400");c.exports.useEffect(()=>{t&&(p(Re(t)),x({hour:Re(t).hour(),minute:Re(t).minute()}))},[t]);const le=()=>{t||(p(Re()),x({hour:12,minute:0})),u()},V=m.daysInMonth(),ce=m.startOf("month").day(),A=Re(),be=t?Re(t):null,f=ee=>{const _e=m.date(ee).hour(g.hour).minute(g.minute).second(0).millisecond(0);i&&_e.isBefore(Re(i),"day")||s(_e.toDate())},te=(ee,_e)=>{if(x({hour:ee,minute:_e}),t){const xe=Re(t).hour(ee).minute(_e);s(xe.toDate())}},J=()=>{s(null),p(Re()),x({hour:12,minute:0}),u()},we=()=>p(m.subtract(1,"month")),Te=()=>p(m.add(1,"month")),Ne=ee=>{const xe=(t?Re(t):Re()).add(ee,"day");s(xe.toDate())},$=()=>{const ee=[],_e=i?Re(i):null;for(let xe=0;xe<ce;xe++)ee.push(e(vn,{},`empty-${xe}`));for(let xe=1;xe<=V;xe++){const B=m.date(xe),O=B.isSame(A,"day"),G=be==null?void 0:be.isSame(B,"day"),pe=_e&&B.isBefore(_e,"day");ee.push(e(vn,{children:e(L,{size:"xs",variant:"ghost",w:"full",h:"28px",minW:"28px",fontSize:"xs",fontWeight:O?"bold":"normal",bg:G?"primary.500":"transparent",color:G?"white":pe?E:"inherit",border:O?"1px solid":"none",borderColor:q,_hover:{bg:pe?"transparent":G?"primary.600":F},onClick:()=>!pe&&f(xe),isDisabled:!!pe,cursor:pe?"not-allowed":"pointer",children:xe})},xe))}return ee},K=t?Re(t).format("YYYY/MM/DD HH:mm"):"";return n(Vn,{isOpen:o,onOpen:d,onClose:le,placement:"bottom-start",isLazy:!0,children:[e($n,{children:e(De,{value:K,placeholder:r,size:"sm",isReadOnly:!0,cursor:"pointer",isDisabled:l,onClick:d,bg:"transparent",_dark:{bg:"transparent"}})}),e(Wi,{children:e(Kn,{w:"auto",maxW:"min(90vw, 420px)",bg:S,borderColor:v,color:y,_focus:{boxShadow:"none"},children:e(Jn,{p:0,children:n(gt,{children:[n(me,{spacing:1,align:"stretch",px:2,py:2,bg:T,minW:"100px",maxW:"110px",borderRight:"1px solid",borderColor:N,flexShrink:0,children:[e(L,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ne(1),_hover:{bg:W},children:"+1 Day"}),e(L,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ne(30),_hover:{bg:W},children:"+1 Month"}),e(L,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ne(90),_hover:{bg:W},children:"+3 Months"}),e(L,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ne(180),_hover:{bg:W},children:"+6 Months"}),e(L,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ne(365),_hover:{bg:W},children:"+1 Year"}),e(L,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Ne(1095),_hover:{bg:W},children:"+3 Years"})]}),n(z,{flex:"1",p:2,children:[n(gt,{justify:"space-between",align:"center",mb:2,children:[n(M,{spacing:1,children:[e(We,{"aria-label":"Previous month",size:"xs",variant:"ghost",icon:e(bl,{width:14,height:14}),onClick:we,_hover:{bg:W}}),e(We,{"aria-label":"Next month",size:"xs",variant:"ghost",icon:e(La,{width:14,height:14}),onClick:Te,_hover:{bg:W}})]}),e(h,{fontSize:"xs",fontWeight:"semibold",children:m.format("MMMM YYYY")})]}),e(li,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:1,children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(ee=>e(vn,{children:e(h,{fontSize:"2xs",textAlign:"center",color:he,fontWeight:"semibold",children:ee})},ee))}),e(li,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:2,children:$()}),n(M,{spacing:2,justify:"center",pt:2,borderTop:"1px solid",borderColor:P,children:[e(h,{fontSize:"2xs",color:j,children:"Time:"}),e(De,{type:"number",size:"xs",w:"45px",min:0,max:23,value:g.hour,onChange:ee=>{const _e=Math.max(0,Math.min(23,parseInt(ee.target.value)||0));te(_e,g.minute)},textAlign:"center",fontSize:"xs"}),e(h,{fontSize:"xs",children:":"}),e(De,{type:"number",size:"xs",w:"45px",min:0,max:59,value:g.minute,onChange:ee=>{const _e=Math.max(0,Math.min(59,parseInt(ee.target.value)||0));te(g.hour,_e)},textAlign:"center",fontSize:"xs"})]}),n(M,{spacing:2,justify:"flex-end",mt:2,children:[e(L,{size:"xs",variant:"ghost",onClick:J,children:"Clear"}),e(L,{size:"xs",colorScheme:"primary",onClick:le,children:"Done"})]})]})]})})})})]})},xi=c.exports.forwardRef((t,s)=>e(id,{...t,ref:s}));xi.displayName="DatePicker";function Oh(t){const s=360/t,r=90,l=47,i=[];for(let a=0;a<t;a++){const o=a*s%360+140,d=Wh(o,r,l);i.push(d)}return i}function Wh(t,s,r){t/=360,s/=100,r/=100;let l,i,a;if(s===0)l=i=a=r;else{const d=(p,g,x)=>(x<0&&(x+=1),x>1&&(x-=1),x<.16666666666666666?p+(g-p)*6*x:x<.5?g:x<.6666666666666666?p+(g-p)*(.6666666666666666-x)*6:p),u=r<.5?r*(1+s):r+s-r*s,m=2*r-u;l=Math.round(d(m,u,t+1/3)*255),i=Math.round(d(m,u,t)*255),a=Math.round(d(m,u,t-1/3)*255)}const o=d=>{const u=d.toString(16);return u.length===1?"0"+u:u};return`#${o(l)}${o(i)}${o(a)}`}const So=({border:t,...s})=>{const{getInputProps:r,getRadioProps:l}=ld(s),i=Ur({base:"xs",md:"sm"});return n(z,{as:"label",children:[e("input",{...r()}),e(z,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:i,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},Fh=({onChange:t,defaultValue:s,...r})=>{const{t:l,i18n:i}=Ke();jr();const a=Ur({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),o={h:"hour",d:"day",w:"week",m:"month",y:"year"},d=Ur({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:m,setValue:p}=ad({name:"filter",defaultValue:s,onChange:A=>{if(A==="custom")return;S(),a.indexOf(A)>=0?(T(l("userDialog.custom")),W(!1)):(T(l("userDialog.custom")+` (${A})`),W(!0));const be=Number(A.substring(0,A.length-1)),f=o[A[A.length-1]];t(A,{start:Re().utc().subtract(be,f).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:g,onOpen:x,onClose:S}=Qt(),y=c.exports.useRef(null);od({ref:y,handler:S});const[v,T]=c.exports.useState(l("userDialog.custom")),[N,W]=c.exports.useState(!1),[he,E]=c.exports.useState(0),F=Ur({base:1,md:2}),P=Ur({base:"xs",md:"sm"}),[j,q]=c.exports.useState(null),[le,V]=c.exports.useState(null),ce=A=>{const[be,f]=A;le&&!f?(q(null),V(null)):(q(be),V(f),be&&f&&(S(),t("custom",{start:Re(be).format("YYYY-MM-DDT00:00:00"),end:Re(f).format("YYYY-MM-DDT23:59:59")})))};return n(me,{...r,children:[he==0&&n(Le,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[a.map(A=>e(So,{...m({value:A}),children:A},A)),e(z,{onClick:()=>{q(null),V(null),x()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:P,px:3,py:1,bg:N?"primary.500":"unset",color:N?"white":"unset",borderColor:N?"primary.500":"unset",children:n(M,{children:[e(h,{children:v}),e(ri,{as:Xa,boxSize:"18px"})]})})]}),he==1&&n(M,{onClick:x,cursor:"pointer",fontSize:P,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:j?"unset":"gray.500",children:j?Re(j).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(ri,{as:La,boxSize:"18px"}),e(h,{w:"full",color:le?"unset":"gray.500",children:le?Re(le).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(ri,{as:Xa,boxSize:"18px"})]}),e(me,{ref:y,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:n(ls,{onChange:A=>E(A),children:[n(cs,{children:[e(er,{fontSize:P,children:l("userDialog.relative")}),e(er,{fontSize:P,children:l("userDialog.absolute")})]}),n(ds,{children:[e(tr,{children:d.map(A=>e(me,{alignItems:"start",pl:2,pr:2,children:n(M,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:P,minW:"60px",children:l("userDialog."+A.title)}),A.options.map(be=>e(So,{border:!0,...m({value:be}),children:be},be+".custom"))]})},A.title))}),e(tr,{className:"datepicker-panel",children:e(me,{children:e(xi,{locale:i.language.toLocaleLowerCase(),selected:j,onChange:ce,startDate:j,endDate:le,selectsRange:!0,maxDate:new Date,monthsShown:F,peekNextMonth:!1,inline:!0})})})]})]})})]})};function Li(t,s,r=[],l=[]){const i=Fe(r.reduce((a,o)=>a+=o,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${i}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(a,{seriesIndex:o,w:d})=>Fe(d.config.series[o],1)},tooltip:{custom:({series:a,seriesIndex:o,dataPointIndex:d,w:u})=>{const m=Fe(a[o],1),p=Math.max(a.reduce((x,S)=>x+=S),1),g=Math.round(a[o]/p*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[o]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[o]}: <b>${g}, ${m}</b>
            </div>
          `}},colors:Oh(r.length)}}}const Hh=oe(cd,{baseStyle:{w:5,h:5}}),Bh=oe(Bn,{baseStyle:{w:5,h:5}}),Vh=oe(dl,{baseStyle:{w:5,h:5}}),$h=oe(dd,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});oe(mi,{baseStyle:{w:4,h:4}});const Kh=t=>{var r,l,i,a,o;const s=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(s),next_plan_data_limit:s!=null&&s.data_limit?Number((s.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(i=s==null?void 0:s.expire)!=null?i:null,next_plan_add_remaining_traffic:(a=s==null?void 0:s.add_remaining_traffic)!=null?a:!1,next_plan_fire_on_either:(o=s==null?void 0:s.fire_on_either)!=null?o:!0}},sa=()=>({data_limit:null,ip_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),Ws={username:Ce.string().min(1,{message:"Required"}),note:Ce.string().nullable(),service_id:Ce.union([Ce.string(),Ce.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),proxies:Ce.record(Ce.string(),Ce.record(Ce.string(),Ce.any())).transform(t=>{const s=(r,l)=>{r&&r[l]===""&&delete r[l]};return s(t.vmess,"id"),s(t.vless,"id"),s(t.trojan,"password"),s(t.shadowsocks,"password"),s(t.shadowsocks,"method"),t}),data_limit:Ce.string().min(0).or(Ce.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:Ce.number().nullable(),data_limit_reset_strategy:Ce.string(),inbounds:Ce.record(Ce.string(),Ce.array(Ce.string())).transform(t=>(Object.keys(t).forEach(s=>{var r;Array.isArray(t[s])&&!((r=t[s])!=null&&r.length)&&delete t[s]}),t)),next_plan_enabled:Ce.boolean().default(!1),next_plan_data_limit:Ce.union([Ce.string(),Ce.number(),Ce.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:Math.max(0,s)}),next_plan_expire:Ce.union([Ce.number(),Ce.string(),Ce.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),next_plan_add_remaining_traffic:Ce.boolean().default(!1),next_plan_fire_on_either:Ce.boolean().default(!0),ip_limit:Ce.union([Ce.number().min(0),Ce.null()]).optional().transform(t=>typeof t!="number"?null:Number.isFinite(t)?t:null)},Jh=Ce.discriminatedUnion("status",[Ce.object({status:Ce.literal("active"),...Ws}),Ce.object({status:Ce.literal("disabled"),...Ws}),Ce.object({status:Ce.literal("limited"),...Ws}),Ce.object({status:Ce.literal("expired"),...Ws}),Ce.object({status:Ce.literal("on_hold"),on_hold_expire_duration:Ce.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...Ws})]),qh=()=>{var pr,gr,fr,ne,Ae,Q,Xe,_t,qt,Nt,zt,pt,mt,It,ir,Cr,Kr;const{editingUser:t,isCreatingNewUser:s,onCreateUser:r,editUser:l,fetchUserUsage:i,onEditingUser:a,createUserWithService:o,onDeletingUser:d,users:u,isUserLimitReached:m}=Tt(),p=!!t,g=s||p,x=(pr=u.users_limit)!=null?pr:null,S=(gr=u.active_total)!=null?gr:null,y=m&&!p,[v,T]=c.exports.useState(!1),[N,W]=c.exports.useState(""),he=Zt(),{t:E}=Ke(),{colorMode:F}=jr(),P=en({defaultValues:sa(),resolver:Fi(Jh)}),j=P.getValues("expire"),q=P.getValues("next_plan_expire");function le(Z){if(typeof Z!="number"||Z<=0)return null;const Pe=Re.unix(Z).utc().local(),Ve=Re(),Ze=Pe.diff(Ve,"day",!0);return Number.isFinite(Ze)?Math.max(0,Math.round(Ze)):null}function V(Z){return Re().add(Z,"day").endOf("day").utc().unix()}const[ce,A]=c.exports.useState(()=>le(j)),[be,f]=c.exports.useState(()=>le(q)),te=[{label:E("userDialog.quickSelectOneMonth","+1 month"),amount:1,unit:"month"},{label:E("userDialog.quickSelectThreeMonths","+3 months"),amount:3,unit:"month"},{label:E("userDialog.quickSelectOneYear","+1 year"),amount:1,unit:"year"}],J=es(Z=>Z.services),we=es(Z=>Z.isLoading),{userData:Te,getUserIsSuccess:Ne}=hr(),$=Boolean(Ne&&(Te.role===Qe.Sudo||Te.role===Qe.FullAccess));$||Boolean((ne=(fr=Te.permissions)==null?void 0:fr.users)==null?void 0:ne[ht.Create]);const K=$||Boolean((Q=(Ae=Te.permissions)==null?void 0:Ae.users)==null?void 0:Q[ht.Delete]),ee=$||Boolean((_t=(Xe=Te.permissions)==null?void 0:Xe.users)==null?void 0:_t[ht.ResetUsage]),_e=$||Boolean((Nt=(qt=Te.permissions)==null?void 0:qt.users)==null?void 0:Nt[ht.Revoke]),[xe,B]=c.exports.useState(null),O=J.length>0,G=xe&&(zt=J.find(Z=>Z.id===xe))!=null?zt:null,pe=Boolean(t==null?void 0:t.service_id),k=!$&&J.length===1,I=$||J.length!==1,U=I&&J.length>0,Y=!U,Ie=!$&&J.length===0,{data:Se}=Or("panel-settings",Fa,{enabled:g,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),He=Boolean(Se==null?void 0:Se.use_nobetci),[R,re]=c.exports.useState(!1),H=()=>{re(Z=>!Z)};c.exports.useEffect(()=>{g&&es.getState().fetchServices()},[g]),c.exports.useEffect(()=>{var Z,Pe;p?t!=null&&t.service_id?B(t.service_id):$?B(null):J.length?B((Pe=(Z=J[0])==null?void 0:Z.id)!=null?Pe:null):B(null):g||B(null)},[p,t,g,$,J]),c.exports.useEffect(()=>{!p&&g&&O&&B(Z=>{var Pe,Ve;return(Ve=Z!=null?Z:(Pe=J[0])==null?void 0:Pe.id)!=null?Ve:null})},[J,p,g,O]),c.exports.useEffect(()=>{!p&&g&&!O&&B(null)},[O,p,g]),c.exports.useEffect(()=>{k&&J[0]&&B(Z=>Z!=null?Z:J[0].id)},[k,J]);const[ge,dt]=sr({control:P.control,name:["data_limit","status"]}),lt=sr({control:P.control,name:"next_plan_enabled"}),st=sr({control:P.control,name:"expire"}),ve=sr({control:P.control,name:"next_plan_data_limit"}),Be=sr({control:P.control,name:"next_plan_expire"}),Je=sr({control:P.control,name:"next_plan_add_remaining_traffic"}),se=sr({control:P.control,name:"next_plan_fire_on_either"});c.exports.useEffect(()=>{const Z=le(st);A(Pe=>Pe===Z?Pe:Z)},[st]),c.exports.useEffect(()=>{const Z=le(Be);f(Pe=>Pe===Z?Pe:Z)},[Be]);const Ye=Z=>{P.setValue("next_plan_enabled",Z,{shouldDirty:!0}),Z?(P.getValues("next_plan_data_limit")===null&&P.setValue("next_plan_data_limit",0,{shouldDirty:!1}),P.getValues("next_plan_add_remaining_traffic")===void 0&&P.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),P.getValues("next_plan_fire_on_either")===void 0&&P.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(P.setValue("next_plan_data_limit",null,{shouldDirty:!0}),P.setValue("next_plan_expire",null,{shouldDirty:!0}),f(null))},ie=E("userDialog.total"),[D,de]=c.exports.useState(Li(F,ie)),[ze,Ge]=c.exports.useState("1m"),tt=Z=>{i(t,Z).then(Pe=>{const Ve=[],Ze=[];for(const vt in Pe.usages)Ze.push(Pe.usages[vt].used_traffic),Ve.push(Pe.usages[vt].node_name);de(Li(F,ie,Ze,Ve))})};c.exports.useEffect(()=>{if(t){const Z=Kh(t);P.reset(Z),A(le(Z.expire)),f(le(Z.next_plan_expire)),tt({start:Re().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const Z=sa();P.reset(Z),A(le(Z.expire)),f(le(Z.next_plan_expire))}},[t,p,g]);const qe=Z=>{var un,Xr;if(y)return;T(!0),W(null);const{service_id:Pe,next_plan_enabled:Ve,next_plan_data_limit:Ze,next_plan_expire:vt,next_plan_add_remaining_traffic:jt,next_plan_fire_on_either:br,proxies:Wr,inbounds:mr,status:_r,data_limit:Jr,data_limit_reset_strategy:kn,on_hold_expire_duration:Rn,ip_limit:qr,...Dr}=Z,ke=Ve&&Ze&&Ze>0?Number((Number(Ze)*1073741824).toFixed(5)):0,Yr=Ve?{data_limit:ke,expire:vt!=null?vt:0,add_remaining_traffic:jt,fire_on_either:br}:null,Gr=typeof qr=="number"&&Number.isFinite(qr)&&qr>0?Math.floor(qr):0;if(!p){const Ft=xe!=null?xe:k&&(Xr=(un=J[0])==null?void 0:un.id)!=null?Xr:null;if(!Ft){W(E("userDialog.selectService","Please choose a service")),T(!1);return}const Cn={username:Z.username,service_id:Ft,note:Z.note,status:Z.status==="active"||Z.status==="disabled"||Z.status==="on_hold"?Z.status:"active",expire:Z.expire,data_limit:Z.data_limit,ip_limit:Gr,data_limit_reset_strategy:Jr&&Jr>0?kn:"no_reset",on_hold_expire_duration:_r==="on_hold"?Rn:null};Yr&&(Cn.next_plan=Yr),o(Cn).then(()=>{he({title:E("userDialog.userCreated",{username:Z.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Vt()}).catch(Yt=>{var hn,_n,tn,pn,Un;(((hn=Yt==null?void 0:Yt.response)==null?void 0:hn.status)===409||((_n=Yt==null?void 0:Yt.response)==null?void 0:_n.status)===400)&&W((pn=(tn=Yt==null?void 0:Yt.response)==null?void 0:tn._data)==null?void 0:pn.detail),((Un=Yt==null?void 0:Yt.response)==null?void 0:Un.status)===422&&Object.keys(Yt.response._data.detail).forEach(Dn=>{W(Yt==null?void 0:Yt.response._data.detail[Dn]),P.setError(Dn,{type:"custom",message:Yt.response._data.detail[Dn]})})}).finally(()=>{T(!1)});return}const yr={...Dr,data_limit:Jr,ip_limit:Gr,data_limit_reset_strategy:Jr&&Jr>0?kn:"no_reset",status:_r==="active"||_r==="disabled"||_r==="on_hold"?_r:"active",on_hold_expire_duration:_r==="on_hold"?Rn:null};Yr?yr.next_plan=Yr:!Ve&&(t==null?void 0:t.next_plan)&&(yr.next_plan=null),t!=null&&t.service_id||(Wr&&Object.keys(Wr).length>0&&(yr.proxies=Wr),mr&&Object.keys(mr).length>0&&(yr.inbounds=mr)),typeof xe<"u"&&(xe===null?$&&(yr.service_id=null):xe!==(t==null?void 0:t.service_id)&&(yr.service_id=xe)),l(t.username,yr).then(()=>{he({title:E("userDialog.userEdited",{username:Z.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Vt()}).catch(Ft=>{var Cn,Yt,hn,_n,tn;(((Cn=Ft==null?void 0:Ft.response)==null?void 0:Cn.status)===409||((Yt=Ft==null?void 0:Ft.response)==null?void 0:Yt.status)===400)&&W((_n=(hn=Ft==null?void 0:Ft.response)==null?void 0:hn._data)==null?void 0:_n.detail),((tn=Ft==null?void 0:Ft.response)==null?void 0:tn.status)===422&&Object.keys(Ft.response._data.detail).forEach(pn=>{W(Ft==null?void 0:Ft.response._data.detail[pn]),P.setError(pn,{type:"custom",message:Ft.response._data.detail[pn]})})}).finally(()=>{T(!1)})},Vt=()=>{P.reset(sa()),A(null),f(null),r(!1),a(null),W(null),re(!1),Ge("1m"),B(null)},$t=()=>{!ee||Tt.setState({resetUsageUser:t})},Kt=()=>{!_e||Tt.setState({revokeSubscriptionUser:t})},Me=v||y,it=dt==="on_hold",[Jt,nr]=c.exports.useState(!1),kr=()=>{nr(!0);let Z="";const Pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ve=Pe.length;let Ze=0;for(;Ze<6;)Z+=Pe.charAt(Math.floor(Math.random()*Ve)),Ze+=1;return Z};return n(Lt,{isOpen:g,onClose:Vt,size:Ie?"lg":"2xl",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(ud,{...P,children:n(Ot,{mx:"3",position:"relative",overflow:"hidden",children:[e(Wt,{mt:3,disabled:v}),e(z,{pointerEvents:y?"none":"auto",filter:y?"blur(6px)":"none",transition:"filter 0.2s ease",children:n("form",{onSubmit:P.handleSubmit(qe),children:[e(At,{pt:6,children:n(M,{gap:2,children:[e(ns,{color:"primary",children:p?e(Bh,{color:"white"}):e(Hh,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:E(p?"userDialog.editUserTitle":"createNewUser")})]})}),n(Ct,{children:[p&&pe&&n(zr,{status:"info",mb:4,borderRadius:"md",children:[e(Rr,{}),E("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(pt=t==null?void 0:t.service_name)!=null?pt:""})]}),n(li,{templateColumns:{base:"repeat(1, 1fr)",md:U?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...Y?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(vn,{children:n(me,{justifyContent:"space-between",children:[n(gt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(gt,{flexDirection:"row",w:"full",gap:2,children:n(C,{mb:"10px",isInvalid:!!((mt=P.formState.errors.username)!=null&&mt.message),children:[e(_,{children:E("username")}),n(M,{align:"flex-end",children:[e(z,{flex:"1",minW:"0",children:n(Mr,{size:"sm",children:[e(De,{type:"text",borderRadius:"6px",placeholder:E("username"),isDisabled:Me||p,...P.register("username")}),!p&&e(Vr,{width:"auto",pr:1,children:e(We,{"aria-label":E("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(ai,{width:18}),onClick:()=>{const Z=kr();P.setValue("username",Z,{shouldDirty:!0}),setTimeout(()=>{nr(!1)},350)},isLoading:Jt,isDisabled:Me})})]})}),p&&e(M,{px:1,children:e(xt,{name:"status",control:P.control,render:({field:Z})=>e(ft,{placement:"top",label:"status: "+E(`status.${Z.value}`),textTransform:"capitalize",children:e(z,{children:e(bt,{colorScheme:"primary",isChecked:Z.value==="active",onChange:Pe=>{Pe.target.checked?Z.onChange("active"):Z.onChange("disabled")}})})})})})]}),e(an,{children:(It=P.formState.errors.username)==null?void 0:It.message})]})}),n(ye,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[n(C,{flex:"1",children:[e(_,{children:E("userDialog.dataLimit")}),e(xt,{control:P.control,name:"data_limit",render:({field:Z})=>{var Pe;return e(ur,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",onChange:Z.onChange,disabled:Me,error:(Pe=P.formState.errors.data_limit)==null?void 0:Pe.message,value:Z.value?String(Z.value):""})}})]}),He&&n(C,{flex:"1",children:[n(_,{display:"flex",alignItems:"center",gap:2,children:[E("userDialog.ipLimitLabel","IP limit"),e(ft,{hasArrow:!0,placement:"top",label:E("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(oe.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(xl,{width:16,height:16})})})]}),e(xt,{control:P.control,name:"ip_limit",rules:{validate:Z=>Z==null?!0:typeof Z!="number"||Number.isNaN(Z)?E("userDialog.ipLimitValidation","Enter a valid non-negative number"):Z>=0?!0:E("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:Z})=>{var Pe;return e(ur,{size:"sm",borderRadius:"6px",placeholder:E("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof Z.value=="number"&&Z.value>0?String(Z.value):"",onChange:Ve=>{const Ze=Ve.target.value;if(!Ze.trim()||Ze.trim()==="-"){Z.onChange(null);return}const vt=Number(Ze);Number.isNaN(vt)||Z.onChange(vt<0?0:Math.floor(vt))},disabled:Me,error:(Pe=P.formState.errors.ip_limit)==null?void 0:Pe.message})}})]})]}),e(Cs,{in:!!(ge&&ge>0),animateOpacity:!0,style:{width:"100%"},children:n(C,{height:"66px",children:[e(_,{children:E("userDialog.periodicUsageReset")}),e(xt,{control:P.control,name:"data_limit_reset_strategy",render:({field:Z})=>e(rt,{size:"sm",...Z,disabled:Me,bg:Me?"gray.100":"transparent",_dark:{bg:Me?"gray.600":"transparent"},sx:{option:{backgroundColor:F==="dark"?"#222C3B":"white"}},children:va.map(Pe=>e("option",{value:Pe.value,children:E("userDialog.resetStrategy"+Pe.title)},Pe.value))})})]})}),n(C,{mb:"10px",isInvalid:!it&&Boolean(P.formState.errors.expire),children:[n(gt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(_,{mb:0,children:it?E("userDialog.onHoldExpireDuration"):E("userDialog.expiryDaysLabel","Expires in (days)")}),!p&&e(xt,{name:"status",control:P.control,render:({field:Z})=>{const Pe=Z.value==="on_hold";return n(M,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:E("userDialog.onHold")}),e(bt,{colorScheme:"primary",isChecked:Pe,onChange:Ve=>{Ve.target.checked?Z.onChange("on_hold"):(Z.onChange("active"),P.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:Me})]})}})]}),it?e(xt,{control:P.control,name:"on_hold_expire_duration",render:({field:Z})=>{var Pe;return e(ur,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Ve=>{P.setValue("expire",null);const Ze=Ve.target.value;if(!Ze){Z.onChange(null);return}const vt=Number(Ze);Number.isNaN(vt)||vt<0||Z.onChange(Math.round(vt))},disabled:Me,error:(Pe=P.formState.errors.on_hold_expire_duration)==null?void 0:Pe.message,value:Z.value?String(Z.value):""})}}):n(Bt,{children:[e(xt,{name:"expire",control:P.control,render:({field:Z})=>{const{status:Pe,time:Ve}=$i(Z.value),Ze=Z.value?Re.unix(Z.value).toDate():null,vt=jt=>{if(!jt){Z.onChange(null),P.setValue("on_hold_expire_duration",null,{shouldDirty:!1});return}const br=Re(jt).utc().unix();P.setValue("on_hold_expire_duration",null,{shouldDirty:!1}),Z.onChange(br)};return n(z,{children:[e(Lh,{value:Ze,onChange:vt,placeholder:E("userDialog.selectExpiryDate","Select expiration date"),disabled:Me,minDate:new Date,quickSelects:te.map(jt=>({label:jt.label,onClick:()=>{const br=Re().add(jt.amount,jt.unit).endOf("day");vt(br.toDate())}}))}),Z.value?e(cr,{children:E(Pe,{time:Ve})}):null]})}}),e(an,{children:(ir=P.formState.errors.expire)==null?void 0:ir.message})]})]}),n(z,{mb:"10px",children:[n(M,{justify:"space-between",align:"center",children:[e(_,{mb:0,children:E("userDialog.nextPlanTitle","Next plan")}),e(bt,{colorScheme:"primary",isChecked:lt,onChange:Z=>Ye(Z.target.checked),isDisabled:Me})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:E("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(Cs,{in:lt,animateOpacity:!0,style:{width:"100%"},children:n(me,{align:"stretch",spacing:3,mt:3,children:[n(C,{children:[e(_,{fontSize:"sm",children:E("userDialog.nextPlanDataLimit","Next plan data limit")}),e(ur,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",disabled:Me,value:ve!==null&&typeof ve<"u"?String(ve):"",onChange:Z=>{const Pe=Z.target.value;if(!Pe){P.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Ve=Number(Pe);Number.isNaN(Ve)||P.setValue("next_plan_data_limit",Math.max(0,Ve),{shouldDirty:!0})}})]}),n(C,{children:[e(_,{fontSize:"sm",children:E("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(xt,{control:P.control,name:"next_plan_expire",render:({field:Z})=>{const Pe=Ve=>{if(!Ve){f(null),Z.onChange(null);return}const Ze=Number(Ve);if(Number.isNaN(Ze)||Ze<0)return;const vt=Math.min(Math.round(Ze),3650);f(vt);const jt=V(vt);Z.onChange(jt)};return e(ur,{endAdornment:E("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof be=="number"?String(be):"",onChange:Ve=>Pe(Ve.target.value),disabled:Me})}})]}),n(M,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:E("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(bt,{size:"sm",colorScheme:"primary",isChecked:Boolean(Je),onChange:Z=>P.setValue("next_plan_add_remaining_traffic",Z.target.checked,{shouldDirty:!0}),isDisabled:Me})]}),n(M,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:E("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(bt,{size:"sm",colorScheme:"primary",isChecked:Boolean(se),onChange:Z=>P.setValue("next_plan_fire_on_either",Z.target.checked,{shouldDirty:!0}),isDisabled:Me})]})]})})]}),n(C,{mb:"10px",isInvalid:!!P.formState.errors.note,children:[e(_,{children:E("userDialog.note")}),e(Nr,{...P.register("note")}),e(an,{children:(Kr=(Cr=P.formState.errors)==null?void 0:Cr.note)==null?void 0:Kr.message})]})]}),N&&n(zr,{status:"error",display:{base:"none",md:"flex"},children:[e(Rr,{}),N]})]})}),I&&e(vn,{mt:U?0:4,children:n(C,{isRequired:!p,children:[e(_,{children:E("userDialog.selectServiceLabel","Service")}),we?n(M,{spacing:2,py:4,children:[e(Et,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:E("loading")})]}):O?n(me,{align:"stretch",spacing:3,children:[p&&$&&n(z,{role:"button",tabIndex:Me?-1:0,"aria-pressed":xe===null,onKeyDown:Z=>{Me||(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),B(null))},onClick:()=>{Me||B(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:xe===null?"primary.500":"gray.200",bg:xe===null?"primary.50":"transparent",cursor:Me?"not-allowed":"pointer",pointerEvents:Me?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Me?{}:{borderColor:xe===null?"primary.500":"gray.300"},_dark:{borderColor:xe===null?"primary.400":"gray.700",bg:xe===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:E("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:E("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),J.map(Z=>{const Pe=xe===Z.id;return e(z,{role:"button",tabIndex:Me?-1:0,"aria-pressed":Pe,onKeyDown:Ve=>{Me||(Ve.key==="Enter"||Ve.key===" ")&&(Ve.preventDefault(),B(Z.id))},onClick:()=>{Me||B(Z.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:Pe?"primary.500":"gray.200",bg:Pe?"primary.50":"transparent",cursor:Me?"not-allowed":"pointer",pointerEvents:Me?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Me?{}:{borderColor:Pe?"primary.500":"gray.300"},_dark:{borderColor:Pe?"primary.400":"gray.700",bg:Pe?"primary.900":"transparent"},children:n(M,{justify:"space-between",align:"flex-start",children:[n(me,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:Z.name}),Z.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Z.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:E("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:Z.host_count,users:Z.user_count})})]})},Z.id)})]}):n(zr,{status:"warning",borderRadius:"md",children:[e(Rr,{}),E("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),G&&e(cr,{mt:2,children:E("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:G.host_count,users:G.user_count})})]})}),p&&R&&e(vn,{pt:6,colSpan:{base:1,md:I?2:1},children:n(me,{gap:4,children:[e(Fh,{defaultValue:ze,onChange:(Z,Pe)=>{Ge(Z),tt(Pe)}}),e(z,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(ln,{options:D.options,series:D.series,type:"donut"})})]})})]}),N&&n(zr,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(Rr,{}),N]})]}),e(Ut,{mt:"3",children:n(M,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(M,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:p&&n(Bt,{children:[K&&e(ft,{label:E("delete"),placement:"top",children:e(We,{"aria-label":"Delete",size:"sm",onClick:()=>{d(t),Vt()},children:e(bi,{})})}),e(ft,{label:E("userDialog.usage"),placement:"top",children:e(We,{"aria-label":"usage",size:"sm",onClick:H,children:e(Vh,{})})}),ee&&e(L,{onClick:$t,size:"sm",children:E("userDialog.resetUsage")}),_e&&e(L,{onClick:Kt,size:"sm",children:E("userDialog.revokeSubscription")})]})}),e(M,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(L,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:v?e(Et,{size:"xs"}):void 0,disabled:Me,children:E(p?"userDialog.editUser":"createUser")})})]})})]})}),y&&n(gt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(ns,{color:"primary",children:e($h,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:E("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:x&&x>0?E("userDialog.limitReachedBody",{limit:x,active:S!=null?S:x}):E("userDialog.limitReachedContent")})]})]})})]})},Yh=t=>c.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},c.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),c.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),c.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),c.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),c.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),c.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),c.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),c.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),c.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),c.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),c.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),c.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),c.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),c.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),c.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Gh=t=>{if(!t)return null;const s=new Date(`${t}Z`);return Math.floor(s.getTime()/1e3)},xo=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=Gh(t);return!t||r===null?e(z,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-r<=60?e(z,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(z,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Xh=t=>{if(!t)return null;const s=new Date(t+"Z");return Math.floor(s.getTime()/1e3)},vo=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=Xh(t),l=r?s-r:null,i=r?$i(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${i.time} ago`:i.time})},ia=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:i})=>{const{t:a}=Ke(),o=$i(t),d=ts[s].icon;return n(Bt,{children:[n($r,{colorScheme:ts[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(d,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&a(`status.${s}`),i&&`: ${i}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(o.status,{time:o.time})})]})},Qh=oe(Yh),zs={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Zh=oe(vl,zs),jh=oe(Hi,zs),wo=oe(mi,zs),ep=oe(wl,zs),tp=oe(yl,zs),rp=oe(Bn,zs),np=oe(Hi,{baseStyle:{width:"15px",height:"15px"}}),sp=oe(hd,{baseStyle:{width:{base:16,md:20},height:{base:16,md:20}}}),ip=t=>{for(var s=0;s<va.length;s++){const r=va[s];if(r.value==t)return r.title}return"No"},ap=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:i}=t,a=r===0||r===null;return e(M,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:n(h,{children:[Fe(s)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Fe(r)]})})},ko=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:i,...a}=t,o=r===0||r===null,d=!o&&s/r*100>=100;return n(Bt,{children:[e(pd,{orientation:"horizontal",value:o?100:Math.min(s/r*100,100),colorScheme:d?"red":"primary",...a,children:e(md,{h:"6px",borderRadius:"full",children:e(gd,{borderRadius:"full"})})}),n(M,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[n(h,{children:[Fe(s)," /"," ",o?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Fe(r)+(l&&l!=="no_reset"?" "+In("userDialog.resetStrategy"+ip(l)):"")]}),n(h,{children:[In("usersTable.total"),": ",Fe(i)]})]})]})},Fs=({sort:t,column:s})=>t.includes(s)?e(np,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,op=t=>{var F,P,j,q,le,V,ce,A,be;const{filters:s,users:{users:r,total:l},onEditingUser:i,onFilterChange:a,loading:o}=Tt(),{t:d}=Ke(),[u,m]=c.exports.useState(void 0),p=Ur({base:!1,md:!0}),{userData:g}=hr(),x=g.role===Qe.Sudo||g.role===Qe.FullAccess,S=Boolean(!x&&g.status===Wn.Disabled),y=x||Boolean((P=(F=g.permissions)==null?void 0:F.users)==null?void 0:P[ht.Create]);x||Boolean((q=(j=g.permissions)==null?void 0:j.users)==null?void 0:q[ht.Delete]),x||Boolean((V=(le=g.permissions)==null?void 0:le.users)==null?void 0:V[ht.ResetUsage]),x||Boolean((A=(ce=g.permissions)==null?void 0:ce.users)==null?void 0:A[ht.Revoke]);const v=g.disabled_reason,T=r.length!==l,N=s.limit||10,W=f=>{let te=s.sort;te.includes(f)?te.startsWith("-")?te="-created_at":te="-"+f:te=f,a({sort:te})},he=f=>{a({status:f.target.value.length>0?f.target.value:void 0})},E=f=>{m(f===u?void 0:f)};return n(z,{position:"relative",children:[n(z,{id:"users-table",overflowX:{base:"unset",md:"unset"},filter:S?"blur(4px)":void 0,pointerEvents:S?"none":void 0,"aria-hidden":S?!0:void 0,children:[e(kl,{allowMultiple:!0,display:{base:"block",md:"none"},index:u,children:n(rs,{orientation:"vertical",zIndex:"docked",...t,children:[e(bn,{zIndex:"docked",position:"relative",children:n(Rt,{children:[e($e,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:W.bind(null,"username"),children:n(M,{children:[e("span",{children:d("users")}),e(Fs,{sort:s.sort,column:"username"})]})}),e($e,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:n(M,{spacing:0,position:"relative",children:[n(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[d("usersTable.status"),s.status?": "+s.status:""]}),n(rt,{value:(be=s.status)!=null?be:"",fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Bt,{}),_focusVisible:{border:"0 !important"},onChange:he,children:[e("option",{value:""}),e("option",{value:"active",children:"active"}),e("option",{value:"on_hold",children:"on_hold"}),e("option",{value:"disabled",children:"disabled"}),e("option",{value:"limited",children:"limited"}),e("option",{value:"expired",children:"expired"})]})]})}),e($e,{minW:"100px",cursor:"pointer",pr:0,onClick:W.bind(null,"used_traffic"),children:n(M,{children:[e("span",{children:d("usersTable.dataUsage")}),e(Fs,{sort:s.sort,column:"used_traffic"})]})}),e($e,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),n(on,{children:[!p&&(o?Array.from({length:N}).map((f,te)=>n(c.exports.Fragment,{children:[n(Rt,{children:[e(Ue,{borderBottom:0,minW:"100px",pl:4,pr:4,children:e(wi,{noOfLines:1,width:"40%"})}),e(Ue,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(hs,{height:"16px",width:"64px"})}),e(Ue,{borderBottom:0,minW:"100px",pr:0,children:e(hs,{height:"16px",width:"120px"})}),e(Ue,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(hs,{height:"16px",width:"16px"})})]}),e(Rt,{className:"collapsible",children:e(Ue,{p:0,colSpan:4,children:e(z,{px:6,py:3,children:e(wi,{noOfLines:3})})})})]},"skeleton-"+te)):r==null?void 0:r.map((f,te)=>{var J;return n(c.exports.Fragment,{children:[n(Rt,{onClick:E.bind(null,te),cursor:"pointer",children:[e(Ue,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:n("div",{className:"flex-status",children:[e(xo,{lastOnline:f.online_at}),e(h,{isTruncated:!0,children:f.username})]})}),e(Ue,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(ia,{compact:!0,showDetail:!1,expiryDate:f.expire,status:f.status})}),e(Ue,{borderBottom:0,minW:"100px",pr:0,children:e(ap,{totalUsedTraffic:f.lifetime_used_traffic,dataLimitResetStrategy:f.data_limit_reset_strategy,used:f.used_traffic,total:f.data_limit,colorScheme:ts[f.status].bandWidthColor})}),e(Ue,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(jh,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:u===te?"rotate(180deg)":"0deg"})})]}),e(Rt,{className:"collapsible",onClick:E.bind(null,te),children:e(Ue,{p:0,colSpan:4,children:n(Cl,{border:0,children:[e(_l,{display:"none"}),e(Dl,{border:0,cursor:"pointer",px:6,py:3,children:n(me,{justifyContent:"space-between",spacing:"4",children:[n(me,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:d("usersTable.dataUsage")}),e(z,{width:"full",minW:"230px",children:e(ko,{totalUsedTraffic:f.lifetime_used_traffic,dataLimitResetStrategy:f.data_limit_reset_strategy,used:f.used_traffic,total:f.data_limit,colorScheme:ts[f.status].bandWidthColor})})]}),n(me,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:d("usersTable.service","Service")}),e(h,{fontSize:"sm",color:f.service_name?"gray.700":"gray.500",_dark:{color:f.service_name?"gray.200":"gray.500"},children:(J=f.service_name)!=null?J:d("usersTable.defaultService","Default")})]}),n(M,{w:"full",justifyContent:"space-between",children:[n(z,{width:"full",children:[e(ia,{compact:!0,expiryDate:f.expire,status:f.status}),e(vo,{lastOnline:f.online_at})]}),n(M,{children:[e(Co,{user:f}),y&&e(ft,{label:d("userDialog.editUser"),placement:"top",children:e(We,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:we=>{we.stopPropagation(),i(f)},children:e(rp,{})})})]})]})]})})]})})})]},f.username)})),!o&&!p&&r.length===0&&e(Rt,{children:e(Ue,{colSpan:4,border:0,children:e(_o,{isFiltered:T,isCreateDisabled:S})})})]})]})}),n(rs,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(bn,{position:"relative",zIndex:"docked",children:n(Rt,{children:[e($e,{minW:"140px",cursor:"pointer",onClick:W.bind(null,"username"),children:n(M,{children:[e("span",{children:d("username")}),e(Fs,{sort:s.sort,column:"username"})]})}),e($e,{width:"400px",minW:"150px",cursor:"pointer",children:n(M,{position:"relative",gap:"5px",children:[n(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[d("usersTable.status"),s.status?": "+s.status:""]}),e(h,{children:"/"}),e(Fs,{sort:s.sort,column:"expire"}),e(M,{onClick:W.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),n(rt,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Bt,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:he,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e($e,{minW:"150px",children:e("span",{children:d("usersTable.service","Service")})}),e($e,{width:"350px",minW:"230px",cursor:"pointer",onClick:W.bind(null,"used_traffic"),children:n(M,{children:[e("span",{children:d("usersTable.dataUsage")}),e(Fs,{sort:s.sort,column:"used_traffic"})]})}),e($e,{width:"200px",minW:"180px"})]})}),n(on,{children:[p&&(o?Array.from({length:N}).map((f,te)=>n(Rt,{children:[e(Ue,{minW:"140px",children:e(wi,{noOfLines:1,width:"40%"})}),e(Ue,{width:"400px",minW:"150px",children:e(hs,{height:"16px",width:"120px"})}),e(Ue,{minW:"150px",children:e(wi,{noOfLines:1,width:"60%"})}),e(Ue,{width:"350px",minW:"230px",children:e(hs,{height:"16px",width:"200px"})}),e(Ue,{width:"200px",minW:"180px",children:e(hs,{height:"16px",width:"64px"})})]},"skeleton-desktop-"+te)):r==null?void 0:r.map((f,te)=>{var J;return n(Rt,{className:Ea("interactive",{"last-row":te===r.length-1}),onClick:()=>{y&&i(f)},cursor:y?"pointer":"default",children:[e(Ue,{minW:"140px",children:n("div",{className:"flex-status",children:[e(xo,{lastOnline:f.online_at}),f.username,e(vo,{lastOnline:f.online_at})]})}),e(Ue,{width:"400px",minW:"150px",children:e(ia,{expiryDate:f.expire,status:f.status})}),e(Ue,{minW:"150px",children:e(h,{fontSize:"sm",color:f.service_name?"gray.700":"gray.500",_dark:{color:f.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(J=f.service_name)!=null?J:d("usersTable.defaultService","Default")})}),e(Ue,{width:"350px",minW:"230px",children:e(ko,{totalUsedTraffic:f.lifetime_used_traffic,dataLimitResetStrategy:f.data_limit_reset_strategy,used:f.used_traffic,total:f.data_limit,colorScheme:ts[f.status].bandWidthColor})}),e(Ue,{width:"200px",minW:"180px",children:e(Co,{user:f})})]},f.username)})),!o&&r.length==0&&e(Rt,{children:e(Ue,{colSpan:5,children:e(_o,{isFiltered:T,isCreateDisabled:S||!y})})})]})]})]}),S&&n(gt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",textAlign:"center",px:6,py:8,bg:"rgba(255, 255, 255, 0.85)",_dark:{bg:"rgba(15, 23, 42, 0.9)"},zIndex:"overlay",children:[e(sp,{color:"red.400",mb:6}),e(h,{fontSize:"xl",fontWeight:"bold",mb:3,children:d("usersTable.adminDisabledTitle","Your account is disabled")}),e(h,{maxW:"480px",color:"gray.600",_dark:{color:"gray.200"},children:v||d("usersTable.adminDisabledDescription","Please contact the sudo admin to regain access.")})]})]})},Co=({user:t})=>{const{setQRCode:s,setSubLink:r}=Tt(),l=t.links.join(`\r
`),a=(u=>u?u.startsWith("/")?window.location.origin+u:u:"")(t.subscription_url),[o,d]=c.exports.useState([-1,!1]);return c.exports.useEffect(()=>{o[1]&&setTimeout(()=>{d([-1,!1])},1e3)},[o]),n(M,{justifyContent:"flex-end",onClick:u=>{u.preventDefault(),u.stopPropagation()},children:[e(Qa,{text:a,onCopy:()=>{d([0,!0])},children:e("div",{children:e(ft,{label:o[0]==0&&o[1]?In("usersTable.copied"):In("usersTable.copyLink"),placement:"top",children:e(We,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==0&&o[1]?e(wo,{}):e(ep,{})})})})}),e(Qa,{text:l,onCopy:()=>{d([1,!0])},children:e("div",{children:e(ft,{label:o[0]==1&&o[1]?In("usersTable.copied"):In("usersTable.copyConfigs"),placement:"top",children:e(We,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==1&&o[1]?e(wo,{}):e(Zh,{})})})})}),e(ft,{label:"QR Code",placement:"top",children:e(We,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(t.links),r(a)},children:e(tp,{})})})]})},_o=({isFiltered:t,isCreateDisabled:s})=>{const{onCreateUser:r}=Tt(),l=()=>{s||r(!0)};return n(z,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Qh,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?In("usersTable.noUserMatched"):In("usersTable.noUser")}),!t&&!s&&e(L,{size:"sm",colorScheme:"primary",onClick:l,children:In("createUser")})]})},lp=()=>{const{t}=Ke();return c.exports.useEffect(()=>{Tt.getState().refetchUsers(),ui()},[]),n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(Hl,{}),e(op,{}),e(Bl,{}),e(qh,{}),e(dh,{}),e(Ah,{}),e(Ph,{}),e(Eh,{})]})},Gt=(t,s,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return s({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Xt=(t,s)=>s({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),cp=[{key:ht.Create,label:"admins.permissions.createUser"},{key:ht.Delete,label:"admins.permissions.deleteUser"},{key:ht.ResetUsage,label:"admins.permissions.resetUsage"},{key:ht.Revoke,label:"admins.permissions.revoke"},{key:ht.CreateOnHold,label:"admins.permissions.createOnHold"},{key:ht.AllowUnlimitedData,label:"admins.permissions.unlimitedData"},{key:ht.AllowUnlimitedExpire,label:"admins.permissions.unlimitedExpire"},{key:ht.AllowNextPlan,label:"admins.permissions.nextPlan"}],dp=[{key:dr.View,label:"admins.permissions.viewAdmins"},{key:dr.Edit,label:"admins.permissions.editAdmins"},{key:dr.ManageSudo,label:"admins.permissions.manageSudo"}],up=[{key:St.Usage,label:"admins.sections.usage"},{key:St.Admins,label:"admins.sections.admins"},{key:St.Services,label:"admins.sections.services"},{key:St.Hosts,label:"admins.sections.hosts"},{key:St.Nodes,label:"admins.sections.nodes"},{key:St.Integrations,label:"admins.sections.integrations"},{key:St.Xray,label:"admins.sections.xray"}],Vl=({value:t,onChange:s,maxDataLimitValue:r,onMaxDataLimitChange:l,maxDataLimitError:i,showReset:a=!1,onReset:o,hideExtendedSections:d=!1})=>{const{t:u}=Ke(),m=(g,x,S)=>{const y={...t[g],[x]:S},v={...t,[g]:y};s(v)},p=g=>{l==null||l(g.target.value)};return n(ye,{spacing:6,children:[n(M,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.userCapabilities","User capabilities")}),a&&o&&e(L,{size:"xs",variant:"ghost",onClick:o,children:u("admins.permissions.resetToDefaults","Reset to defaults")})]}),e(Le,{columns:{base:1,md:2},spacing:3,children:cp.map(({key:g,label:x})=>n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(x)}),e(bt,{isChecked:Boolean(t.users[g]),onChange:S=>m("users",g,S.target.checked)})]},g))}),n(C,{isInvalid:Boolean(i),children:[e(_,{children:u("admins.permissions.maxDataPerUser","Max per user data (GB)")}),e(ft,{label:u("admins.permissions.enableUnlimitedFirst","Enable unlimited data first to set this value."),isDisabled:Boolean(t.users.allow_unlimited_data),hasArrow:!0,openDelay:200,placement:"top",gutter:6,shouldWrapChildren:!0,children:e(De,{type:"number",min:"0",step:"1",placeholder:u("admins.permissions.maxDataHint","Leave empty for unlimited"),value:r,onChange:p,isDisabled:!t.users.allow_unlimited_data})}),i?e(an,{children:i}):e(cr,{children:t.users.allow_unlimited_data?u("admins.permissions.maxDataDescription","Applies when this admin creates or edits users."):u("admins.permissions.limitDisabledHint","Unlimited data must be allowed before setting a cap.")})]}),!d&&n(ye,{spacing:3,children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.manageAdminsTitle","Admin management")}),e(Le,{columns:{base:1,md:2},spacing:3,children:dp.map(({key:g,label:x})=>n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(x)}),e(bt,{isChecked:Boolean(t.admin_management[g]),onChange:S=>m("admin_management",g,S.target.checked)})]},g))})]}),!d&&n(ye,{spacing:3,children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.sectionAccess","Section access")}),e(Le,{columns:{base:1,md:2},spacing:3,children:up.map(({key:g,label:x})=>n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(x)}),e(bt,{isChecked:Boolean(t.sections[g]),onChange:S=>m("sections",g,S.target.checked)})]},g))})]})]})},$l=({isOpen:t,onClose:s,admin:r})=>{var S,y;const{t:l}=Ke(),i=Zt(),a=dn(v=>v.updateAdmin),[o,d]=c.exports.useState((S=r==null?void 0:r.permissions)!=null?S:ki),[u,m]=c.exports.useState(""),[p,g]=c.exports.useState(!1);c.exports.useEffect(()=>{var v;r?(d((v=r.permissions)!=null?v:ki),m(r.permissions.users.max_data_limit_per_user?String(Math.floor(r.permissions.users.max_data_limit_per_user/(1024*1024*1024))):"")):(d(ki),m(""))},[r,t]);const x=async()=>{if(!!r){g(!0);try{await a(r.username,{permissions:o}),Xt(l("admins.permissions.updateSuccess","Permissions updated"),i),s()}catch(v){Gt(v,i)}finally{g(!1)}}};return n(Lt,{isOpen:t,onClose:s,size:"lg",children:[e(kt,{}),n(Ot,{children:[e(At,{children:l("admins.permissions.modalTitle",{defaultValue:"Edit permissions for {{username}}",username:(y=r==null?void 0:r.username)!=null?y:""})}),e(Wt,{}),e(Ct,{children:e(Vl,{value:o,onChange:d,showReset:!0,onReset:()=>d(ki),maxDataLimitValue:u,onMaxDataLimitChange:v=>{m(v);const T=Number(v);d(N=>({...N,users:{...N.users,max_data_limit_per_user:!v||Number.isNaN(T)?null:Math.max(0,T)*1024*1024*1024}}))},hideExtendedSections:(r==null?void 0:r.role)===Qe.Standard})}),n(Ut,{children:[e(L,{variant:"ghost",mr:3,onClick:s,children:l("cancel")}),e(L,{colorScheme:"primary",onClick:x,isLoading:p,isDisabled:!r,children:l("save","Save")})]})]})]})},Zs=1024*1024*1024,hp={[Qe.Standard]:{users:{create:!0,delete:!1,reset_usage:!1,revoke:!1,create_on_hold:!1,allow_unlimited_data:!1,allow_unlimited_expire:!1,allow_next_plan:!1,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},[Qe.Sudo]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!1},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}},[Qe.FullAccess]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!0},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}}},Yn=t=>JSON.parse(JSON.stringify(hp[t])),pp=t=>t&&t>0?String(Math.floor(t/Zs)):"",mp=Ce.object({users:Ce.object({create:Ce.boolean(),delete:Ce.boolean(),reset_usage:Ce.boolean(),revoke:Ce.boolean(),create_on_hold:Ce.boolean(),allow_unlimited_data:Ce.boolean(),allow_unlimited_expire:Ce.boolean(),allow_next_plan:Ce.boolean(),max_data_limit_per_user:Ce.number().nullable()}),admin_management:Ce.object({can_view:Ce.boolean(),can_edit:Ce.boolean(),can_manage_sudo:Ce.boolean()}),sections:Ce.object({usage:Ce.boolean(),admins:Ce.boolean(),services:Ce.boolean(),hosts:Ce.boolean(),nodes:Ce.boolean(),integrations:Ce.boolean(),xray:Ce.boolean()})}),gp=()=>{var ee,_e,xe,B,O,G,pe;const{t}=Ke(),{userData:s}=hr(),r=s.role===Qe.FullAccess,l=Zt(),{admins:i,adminInDialog:a,isAdminDialogOpen:o,closeAdminDialog:d,createAdmin:u,updateAdmin:m}=dn(),p=c.exports.useMemo(()=>{var k;return a?(k=i.find(I=>I.username===a.username))!=null?k:a:null},[a,i]),g=c.exports.useMemo(()=>p?"edit":"create",[p]),x=c.exports.useMemo(()=>Ce.object({username:g==="create"?Ce.string().trim().min(3,{message:t("admins.validation.usernameMin")}):Ce.string().optional(),password:Ce.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>!I||I.length>=6,t("admins.validation.passwordMin")),telegram_id:Ce.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.telegramNumeric")),role:Ce.nativeEnum(Qe).optional(),data_limit:Ce.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:Ce.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.usersLimitNumeric","Users limit must be a number")),maxDataLimitPerUserGb:Ce.string().trim().optional().transform(I=>I===""?void 0:I),permissions:mp}).superRefine((I,U)=>{g==="create"&&!I.password&&U.addIssue({code:Ce.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[g,t]),S=en({resolver:Fi(x),defaultValues:{username:"",password:"",telegram_id:"",role:Qe.Standard,permissions:Yn(Qe.Standard),maxDataLimitPerUserGb:"",data_limit:"",users_limit:""}}),{register:y,handleSubmit:v,reset:T,formState:N,setValue:W,watch:he,setError:E}=S,[F,P]=c.exports.useState(!1),[j,q]=c.exports.useState(!1),le=c.exports.useCallback(k=>{var Y;const I="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",U=I.length;if(typeof window<"u"&&((Y=window.crypto)==null?void 0:Y.getRandomValues)){const Ie=new Uint32Array(k);return window.crypto.getRandomValues(Ie),Array.from(Ie,Se=>I[Se%U]).join("")}return Array.from({length:k},()=>{const Ie=Math.floor(Math.random()*U);return I[Ie]}).join("")},[]),V=c.exports.useCallback(()=>{if(g==="edit")return;const k=le(8);W("username",k,{shouldDirty:!0,shouldValidate:!0})},[le,g,W]),ce=c.exports.useCallback(()=>{const k=le(12);W("password",k,{shouldDirty:!0,shouldValidate:!0})},[le,W]),{errors:A,isSubmitting:be}=N,f=he("role"),te=he("permissions"),J=(ee=he("maxDataLimitPerUserGb"))!=null?ee:"",we=c.exports.useCallback(()=>{const k=f!=null?f:Qe.Standard;W("permissions",Yn(k),{shouldDirty:!0}),W("maxDataLimitPerUserGb","",{shouldDirty:!0})},[W,f]),Te=c.exports.useCallback(k=>{W("permissions",k,{shouldDirty:!0})},[W]),Ne=c.exports.useCallback(k=>{W("maxDataLimitPerUserGb",k,{shouldDirty:!0})},[W]);c.exports.useEffect(()=>{y("maxDataLimitPerUserGb"),y("permissions")},[y]),c.exports.useEffect(()=>{var k,I,U;if(o){const Y=(k=p==null?void 0:p.role)!=null?k:Qe.Standard,Ie=p&&(I=JSON.parse(JSON.stringify(p.permissions)))!=null?I:Yn(Y);T({username:(U=p==null?void 0:p.username)!=null?U:"",password:"",telegram_id:(p==null?void 0:p.telegram_id)!==void 0&&(p==null?void 0:p.telegram_id)!==null?String(p.telegram_id):"",role:Y,permissions:Ie,maxDataLimitPerUserGb:pp(Ie.users.max_data_limit_per_user),data_limit:(p==null?void 0:p.data_limit)!==void 0&&(p==null?void 0:p.data_limit)!==null?String(Math.floor(p.data_limit/Zs)):"",users_limit:(p==null?void 0:p.users_limit)!==void 0&&(p==null?void 0:p.users_limit)!==null?String(p.users_limit):""})}},[p,o,T]),c.exports.useEffect(()=>{o||q(!1)},[o]);const $=v(async k=>{var Y,Ie,Se,He,R;const I=(Y=k.role)!=null?Y:Qe.Standard;let U;if(g==="create"){const re=JSON.parse(JSON.stringify((Ie=k.permissions)!=null?Ie:Yn(I))),H=(Se=k.maxDataLimitPerUserGb)==null?void 0:Se.trim();if(H){const ge=Number(H);if(Number.isNaN(ge)||ge<0){E("maxDataLimitPerUserGb",{type:"manual",message:t("admins.validation.invalidMaxDataLimit","Enter a positive number or leave empty.")});return}re.users.max_data_limit_per_user=ge===0?null:Math.round(ge*Zs)}else re.users.max_data_limit_per_user=null;U=re}if(g==="edit"&&p){const re=(He=p.active_users)!=null?He:0;if(k.users_limit){const H=Number(k.users_limit);if(!Number.isNaN(H)&&H>0&&H<re){E("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:re})});return}}}try{if(g==="create"){const re={username:k.username.trim(),password:(R=k.password)!=null?R:"",role:I,permissions:U!=null?U:Yn(I),telegram_id:k.telegram_id?Number(k.telegram_id):void 0,data_limit:k.data_limit?Number(k.data_limit)*Zs:void 0,users_limit:k.users_limit?Number(k.users_limit):void 0};await u(re),Xt(t("admins.createSuccess","Admin created"),l)}else if(p){const re={role:I,telegram_id:k.telegram_id?Number(k.telegram_id):void 0,data_limit:k.data_limit?Number(k.data_limit)*Zs:void 0,users_limit:k.users_limit?Number(k.users_limit):void 0};k.password&&(re.password=k.password),await m(p.username,re),Xt(t("admins.updateSuccess","Admin updated"),l)}d()}catch(re){Gt(re,l,S)}}),K=n(me,{spacing:4,align:"stretch",children:[n(C,{isInvalid:!!A.username,children:[e(_,{children:t("username")}),n(Mr,{children:[e(De,{placeholder:t("admins.usernamePlaceholder","Admin username"),...y("username"),isDisabled:g==="edit"}),g==="create"&&e(Vr,{children:e(We,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(ai,{width:20}),onClick:V})})]}),e(an,{children:(_e=A.username)==null?void 0:_e.message})]}),n(C,{isInvalid:!!A.password,children:[e(_,{children:t("password")}),n(M,{spacing:2,children:[n(Mr,{children:[e(De,{placeholder:t("admins.passwordPlaceholder","Password"),type:F?"text":"password",...y("password")}),e(Vr,{children:e(We,{"aria-label":F?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:F?e(Ra,{width:16}):e(oi,{width:16}),onClick:()=>P(!F)})})]}),e(We,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(ai,{width:20}),onClick:ce})]}),e(an,{children:(xe=A.password)==null?void 0:xe.message}),g==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),n(C,{children:[e(_,{children:t("admins.roleLabel","Admin role")}),e(ci,{value:f!=null?f:Qe.Standard,onChange:k=>W("role",k,{shouldDirty:!0}),children:n(me,{align:"flex-start",spacing:2,children:[n(Br,{value:Qe.Standard,children:[e(h,{fontWeight:"medium",children:t("admins.roles.standard","Standard")}),e(cr,{m:0,children:t("admins.roles.standardDescription","Can manage own users with limited privileges.")})]}),n(Br,{value:Qe.Sudo,children:[e(h,{fontWeight:"medium",children:t("admins.roles.sudo","Sudo")}),e(cr,{m:0,children:t("admins.roles.sudoDescription","Extended access to settings and other admins.")})]}),r&&n(Br,{value:Qe.FullAccess,children:[e(h,{fontWeight:"medium",children:t("admins.roles.fullAccess","Full access")}),e(cr,{m:0,children:t("admins.roles.fullAccessDescription","Complete control, including other sudo admins.")})]})]})})]}),g==="edit"&&e(L,{alignSelf:"flex-start",onClick:()=>q(!0),variant:"outline",children:t("admins.editPermissionsButton","Edit permissions")}),n(C,{isInvalid:!!A.telegram_id,children:[e(_,{children:t("admins.telegramId","Telegram ID")}),e(De,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...y("telegram_id")}),e(an,{children:(B=A.telegram_id)==null?void 0:B.message})]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{isInvalid:!!A.data_limit,children:[e(_,{children:t("admins.dataLimit","Data Limit (GB)")}),e(De,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...y("data_limit")}),e(an,{children:(O=A.data_limit)==null?void 0:O.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),n(C,{isInvalid:!!A.users_limit,children:[e(_,{children:t("admins.usersLimit","Users Limit")}),e(De,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...y("users_limit")}),e(an,{children:(G=A.users_limit)==null?void 0:G.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})]});return n(Bt,{children:[n(Lt,{isOpen:o,onClose:d,size:"lg",children:[e(kt,{}),n(Ot,{children:[e(At,{children:g==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Wt,{}),e(Ct,{children:g==="create"?n(ls,{colorScheme:"primary",isFitted:!0,variant:"enclosed",children:[n(cs,{children:[e(er,{children:t("admins.detailsTabLabel","Details")}),e(er,{children:t("admins.permissionsTabLabel","Permissions")})]}),n(ds,{children:[e(tr,{px:0,children:K}),e(tr,{px:0,children:e(Vl,{value:te!=null?te:Yn(f!=null?f:Qe.Standard),onChange:Te,showReset:!0,onReset:we,maxDataLimitValue:J,onMaxDataLimitChange:Ne,maxDataLimitError:(pe=A.maxDataLimitPerUserGb)==null?void 0:pe.message})})]})]}):K}),e(Ut,{children:n(M,{spacing:3,children:[e(L,{variant:"ghost",onClick:d,children:t("cancel")}),e(L,{colorScheme:"primary",onClick:$,isLoading:be,children:g==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]}),e($l,{isOpen:j,onClose:()=>q(!1),admin:p})]})},fp="admin_data_limit_exhausted",bp=()=>{var ve,Be,Je;const{t}=Ke(),s=Zt(),{userData:r}=hr(),l=Oe("gray.50","whiteAlpha.100"),i=Oe("primary.50","primary.900"),a=Oe("surface.light","surface.dark"),o=Oe("light-border","gray.700"),{admins:d,loading:u,total:m,filters:p,onFilterChange:g,fetchAdmins:x,deleteAdmin:S,resetUsage:y,disableAdmin:v,enableAdmin:T,openAdminDialog:N,openAdminDetails:W,adminInDetails:he}=dn(),E=c.exports.useRef(null),F=c.exports.useRef(null),{isOpen:P,onOpen:j,onClose:q}=Qt(),{isOpen:le,onOpen:V,onClose:ce}=Qt(),{isOpen:A,onOpen:be,onClose:f}=Qt(),[te,J]=c.exports.useState(null),[we,Te]=c.exports.useState(null),[Ne,$]=c.exports.useState(""),[K,ee]=c.exports.useState(null),[_e,xe]=c.exports.useState(null),B=r.username,O=r.role===Qe.FullAccess,G=(ve=r.permissions)==null?void 0:ve.admin_management,pe=Boolean((G==null?void 0:G[dr.Edit])||O),k=Boolean((G==null?void 0:G[dr.ManageSudo])||O),I=se=>se.username===B?!0:se.role===Qe.FullAccess||!pe?!1:se.role===Qe.Sudo?k:!0,U=se=>{if(se==="data_usage"||se==="data_limit"){const Ye=p.sort===se?`-${se}`:se;g({sort:Ye,offset:0})}else{const Ye=p.sort===se?`-${se}`:p.sort===`-${se}`?void 0:se;g({sort:Ye,offset:0})}},Y=se=>{J(se),j()},Ie=async()=>{if(!!te)try{await S(te.username),Xt(t("admins.deleteSuccess","Admin removed"),s),q(),J(null)}catch(se){Gt(se,s)}},Se=async se=>{ee({type:"reset",username:se.username});try{await y(se.username),Xt(t("admins.resetUsageSuccess","Usage reset"),s),x()}catch(Ye){Gt(Ye,s)}finally{ee(null)}},He=se=>{Te(se),$(""),V()},R=()=>{ce(),Te(null),$("")},re=se=>{xe(se),be()},H=()=>{xe(null),f()},ge=async()=>{if(!we)return;const se=Ne.trim();if(!(se.length<3)){ee({type:"disableAdmin",username:we.username});try{await v(we.username,se),Xt(t("admins.disableAdminSuccess","Admin disabled"),s),R(),x()}catch(Ye){Gt(Ye,s)}finally{ee(null)}}},dt=async se=>{ee({type:"enableAdmin",username:se.username});try{await T(se.username),Xt(t("admins.enableAdminSuccess","Admin re-enabled"),s),x()}catch(Ye){Gt(Ye,s)}finally{ee(null)}},lt=({column:se})=>{var D,de,ze,Ge,tt;let Ye=!1,ie=!1;return se==="data"?(Ye=((D=p.sort)==null?void 0:D.includes("data_usage"))||((de=p.sort)==null?void 0:de.includes("data_limit")),ie=Ye&&((ze=p.sort)==null?void 0:ze.startsWith("-"))):(Ye=(Ge=p.sort)==null?void 0:Ge.includes(se),ie=Ye&&((tt=p.sort)==null?void 0:tt.startsWith("-"))),e(Hi,{style:{width:"1rem",height:"1rem",opacity:Ye?1:0,transform:Ye&&!ie?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},st=c.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return u&&!d.length?e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(Et,{})}):m?n(Bt,{children:[e(z,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:n(rs,{variant:"simple",size:"sm",minW:"640px",children:[e(bn,{children:e(Rt,{children:st.map(se=>e($e,{onClick:()=>se.key==="username"||se.key==="users_count"||se.key==="data"?U(se.key):void 0,cursor:se.key==="username"||se.key==="users_count"||se.key==="data"?"pointer":"default",textAlign:se.key==="actions"?"right":"left",children:n(M,{justify:se.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:se.label}),se.key==="data"?n(si,{children:[e(ks,{as:We,size:"xs",variant:"ghost",icon:e(lt,{column:"data"})}),n(ii,{children:[e(lr,{onClick:()=>U("data_usage"),children:t("admins.sortByUsage")}),e(lr,{onClick:()=>U("data_limit"),children:t("admins.sortByLimit")})]})]}):se.key==="username"||se.key==="users_count"?e(lt,{column:se.key}):null]})},se.key))})}),e(on,{children:d.map(se=>{var Kt,Me;const Ye=(he==null?void 0:he.username)===se.username,ie=se.users_limit&&se.users_limit>0?String(se.users_limit):"\u221E",D=`${(Kt=se.active_users)!=null?Kt:0}/${ie}`,de=I(se),ze=de&&se.username!==B,Ge=ze&&se.status!==Wn.Disabled,tt=se.disabled_reason===fp,qe=se.disabled_reason?tt?t("admins.disabledReason.dataLimitExceeded","Your data limit has been reached"):se.disabled_reason:null,Vt=ze&&se.status===Wn.Disabled&&!tt,$t=ze;return n(Rt,{onClick:()=>W(se),cursor:"pointer",bg:Ye?i:void 0,_hover:{bg:l},transition:"background-color 0.15s ease-in-out",children:[n(Ue,{children:[e(h,{fontWeight:"medium",children:se.username}),se.role!==Qe.Standard&&e($r,{colorScheme:se.role===Qe.FullAccess?"orange":"purple",fontSize:"xs",mt:1,children:se.role===Qe.FullAccess?t("admins.roles.fullAccess","Full access"):t("admins.roles.sudo","Sudo")}),se.status===Wn.Disabled&&e($r,{colorScheme:"red",fontSize:"xs",mt:1,children:t("admins.disabledLabel","Disabled")}),se.status===Wn.Disabled&&qe&&e(h,{fontSize:"xs",color:"red.400",mt:1,children:qe})]}),e(Ue,{children:n(h,{whiteSpace:"nowrap",children:[Fe((Me=se.users_usage)!=null?Me:0,2)," /"," ",se.data_limit?Fe(se.data_limit,2):"-"]})}),e(Ue,{children:n(ye,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:D})]})}),e(Ue,{textAlign:"right",children:n(si,{children:[e(ks,{as:We,icon:e(hl,{width:20}),variant:"ghost",isDisabled:!de&&!ze,onClick:it=>it.stopPropagation()}),n(ii,{onClick:it=>it.stopPropagation(),children:[de&&n(Bt,{children:[e(lr,{icon:e(Bn,{width:20}),onClick:it=>{it.stopPropagation(),N(se)},children:t("edit")}),e(lr,{icon:e(Al,{width:20}),onClick:it=>{it.stopPropagation(),re(se)},children:t("admins.editPermissionsButton","Edit permissions")}),e(lr,{icon:e(cn,{width:20}),onClick:it=>{it.stopPropagation(),Se(se)},isDisabled:(K==null?void 0:K.username)===se.username&&(K==null?void 0:K.type)==="reset",children:t("admins.resetUsage")})]}),(Ge||Vt||$t)&&de&&e(Mi,{}),Ge&&e(lr,{icon:e(fd,{width:20}),onClick:it=>{it.stopPropagation(),He(se)},isDisabled:(K==null?void 0:K.username)===se.username&&(K==null?void 0:K.type)==="disableAdmin",children:t("admins.disableAdmin","Disable admin")}),Vt&&e(lr,{icon:e(bd,{width:20}),onClick:it=>{it.stopPropagation(),dt(se)},isDisabled:(K==null?void 0:K.username)===se.username&&(K==null?void 0:K.type)==="enableAdmin",children:t("admins.enableAdmin","Enable admin")}),$t&&(Ge||Vt)&&e(Mi,{}),$t&&e(lr,{color:"red.500",icon:e(wn,{width:20}),onClick:it=>{it.stopPropagation(),Y(se)},children:t("delete")})]})]})})]},se.username)})})]})}),e(_s,{isOpen:P,leastDestructiveRef:E,onClose:q,children:e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(Ds,{bg:a,borderWidth:"1px",borderColor:o,children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(Ct,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(Be=te==null?void 0:te.username)!=null?Be:""})}),n(Ut,{children:[e(L,{ref:E,onClick:q,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(L,{colorScheme:"red",onClick:Ie,ml:3,children:t("delete")})]})]})})}),e(_s,{isOpen:le,leastDestructiveRef:F,onClose:R,children:e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(Ds,{bg:a,borderWidth:"1px",borderColor:o,children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("admins.disableAdminTitle","Disable admin")}),n(Ct,{children:[e(h,{mb:3,children:t("admins.disableAdminMessage","All users owned by {{username}} will be disabled. Provide a reason for this action.",{username:(Je=we==null?void 0:we.username)!=null?Je:""})}),e(Nr,{value:Ne,onChange:se=>$(se.target.value),placeholder:t("admins.disableAdminReasonPlaceholder","Reason for disabling")})]}),n(Ut,{children:[e(L,{ref:F,onClick:R,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(L,{colorScheme:"red",onClick:ge,ml:3,isDisabled:Ne.trim().length<3,isLoading:(K==null?void 0:K.type)==="disableAdmin"&&(K==null?void 0:K.username)===(we==null?void 0:we.username),children:t("admins.disableAdminConfirm","Disable admin")})]})]})})}),e($l,{isOpen:A,onClose:H,admin:_e})]}):e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},yp=(t,s)=>!t||t<=0?s!=null?s:"\u221E":`${t}`,aa=(t,s)=>!t||t<=0?s!=null?s:"\u221E":Fe(t,2),Sp=()=>{var P,j,q,le,V,ce,A,be,f,te,J,we,Te,Ne,$;const{t}=Ke(),{isAdminDetailsOpen:s,adminInDetails:r,closeAdminDetails:l}=dn(K=>({isAdminDetailsOpen:K.isAdminDetailsOpen,adminInDetails:K.adminInDetails,closeAdminDetails:K.closeAdminDetails})),i=Oe("gray.50","whiteAlpha.50"),a=(P=r==null?void 0:r.active_users)!=null?P:0,o=(j=r==null?void 0:r.users_limit)!=null?j:null,d=t("admins.details.unlimited","Unlimited"),u=o&&o>0?String(o):d,m=(q=r==null?void 0:r.users_count)!=null?q:0,p=(le=r==null?void 0:r.limited_users)!=null?le:0,g=(V=r==null?void 0:r.expired_users)!=null?V:0,x=(ce=r==null?void 0:r.online_users)!=null?ce:0,S=(A=r==null?void 0:r.on_hold_users)!=null?A:0,y=(be=r==null?void 0:r.disabled_users)!=null?be:0,v=(f=r==null?void 0:r.users_usage)!=null?f:0,T=(te=r==null?void 0:r.data_limit)!=null?te:null,N=T&&T>0?Math.max(T-v,0):null,W=(J=r==null?void 0:r.lifetime_usage)!=null?J:null,he=(we=r==null?void 0:r.data_limit_allocated)!=null?we:0,E=(Te=r==null?void 0:r.reset_bytes)!=null?Te:0,F=(Ne=r==null?void 0:r.unlimited_users_usage)!=null?Ne:0;return n(Lt,{isCentered:!0,isOpen:s,onClose:l,scrollBehavior:"inside",size:"xl",children:[e(kt,{}),n(Ot,{children:[e(At,{bg:i,children:n(ye,{spacing:1,children:[n(M,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:($=r==null?void 0:r.username)!=null?$:t("admins.details.title","Admin details")}),r&&e($r,{fontSize:"xs",px:2,py:.5,borderRadius:"full",colorScheme:r.role===Qe.FullAccess?"orange":r.role===Qe.Sudo?"purple":"gray",children:r.role===Qe.FullAccess?t("admins.roles.fullAccess","Full access"):r.role===Qe.Sudo?t("admins.roles.sudo","Sudo"):t("admins.roles.standard","Standard")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:a,limit:u})})]})}),e(Wt,{}),e(Ct,{children:r?n(ye,{spacing:8,children:[n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),n(Le,{columns:{base:2,md:3},spacing:4,children:[e(Sr,{label:t("admins.details.activeLabel","Active"),value:String(a)}),e(Sr,{label:t("admins.details.onlineLabel","Online"),value:String(x)}),e(Sr,{label:t("admins.details.limitedLabel","Limited"),value:String(p)}),e(Sr,{label:t("status.expired","Expired"),value:String(g)}),e(Sr,{label:t("status.on_hold","On hold"),value:String(S)}),e(Sr,{label:t("status.disabled","Disabled"),value:String(y)})]}),n(Le,{columns:{base:2,md:2},spacing:4,mt:3,children:[e(Sr,{label:t("admins.details.totalUsers","Total users"),value:String(m)}),e(Sr,{label:t("admins.details.usersLimit","Users limit"),value:yp(o,d)})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),n(Le,{columns:{base:2,md:4},spacing:4,children:[e(Sr,{label:t("admins.details.used","Used"),value:Fe(v,2)}),e(Sr,{label:t("admins.details.limit","Limit"),value:aa(T,d)}),e(Sr,{label:t("admins.details.remaining","Remaining"),value:aa(N,d)}),e(Sr,{label:t("admins.details.lifetime","Lifetime usage"),value:aa(W,void 0)})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.allocationSection","Data allocation")}),n(Le,{columns:{base:2,md:3},spacing:4,children:[e(Sr,{label:t("admins.details.dataAllocated","Allocated data"),value:Fe(he,2)}),e(Sr,{label:t("admins.details.resetVolume","Reset volume"),value:Fe(E,2)}),e(Sr,{label:t("admins.details.unlimitedUsage","Unlimited users usage"),value:Fe(F,2)})]})]})]}):e(z,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(Ut,{children:e(L,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},Sr=({label:t,value:s})=>n(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:s})]}),xp=()=>{var a;const{t}=Ke(),s=dn(o=>o.fetchAdmins),{userData:r,getUserIsSuccess:l}=hr(),i=l&&Boolean((a=r.permissions)==null?void 0:a.sections.admins);return c.exports.useEffect(()=>{i&&s()},[s,i]),i?n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(Hl,{for:"admins"}),e(bp,{}),e(Bl,{for:"admins"}),e(gp,{}),e(Sp,{})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},Kl=Ns(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),Ee("/hosts").then(s=>t({hosts:s})).finally(()=>t({isLoading:!1}))},setHosts:s=>(t({isPostLoading:!0}),Ee("/hosts",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})}))})),vp=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],wp=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],kp=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Cp=oe(Bn,{baseStyle:{w:4,h:4}}),Jl=oe(Nn,{baseStyle:{w:4,h:4}}),ql=oe(ul,{baseStyle:{w:4,h:4}}),_p=oe(gi,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Dp=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],ws=()=>{const{t}=Ke();return n(Vn,{isLazy:!0,placement:"right",children:[e($n,{children:e(z,{mt:"-1",children:e(_p,{})})}),e(Wi,{children:n(Kn,{maxW:"xs",fontSize:"xs",children:[e(os,{}),e(Ma,{}),e(Jn,{children:n(z,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),Dp.map(({token:s,labelKey:r})=>n(h,{mt:1,children:[e($r,{mr:2,children:s}),t(r)]},s))]})})]})})]})},Yl=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Qr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,yn=t=>(t!=null?t:"").trim(),Hs=(t,s=!1)=>typeof t=="boolean"?t:s,Ap=(t,s)=>{var r,l,i,a,o,d,u,m;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(i=t.address)!=null?i:"",sort:(a=t.sort)!=null?a:s,port:(o=t.port)!=null?o:null,path:yn(t.path),sni:yn(t.sni),host:yn(t.host),mux_enable:Hs(t.mux_enable),allowinsecure:Hs(t.allowinsecure),is_disabled:Hs(t.is_disabled,!1),fragment_setting:yn(t.fragment_setting),noise_setting:yn(t.noise_setting),random_user_agent:Hs(t.random_user_agent),security:(d=t.security)!=null?d:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(m=t.fingerprint)!=null?m:"",use_sni_as_host:Hs(t.use_sni_as_host)}},wa=t=>{var s,r;return{id:(s=t.id)!=null?s:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},Do=t=>{var s,r;return{...t,id:(s=t.id)!=null?s:null,port:(r=t.port)!=null?r:null,path:yn(t.path),sni:yn(t.sni),host:yn(t.host),fragment_setting:yn(t.fragment_setting),noise_setting:yn(t.noise_setting)}},Gl=t=>{const s=Do(t.data),r=Do(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(s)!==JSON.stringify(r)},Ip=t=>{var s;return{id:(s=t.id)!=null?s:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},js=t=>[...t].sort((s,r)=>{const l=Qr(s.data.sort)-Qr(r.data.sort);return l!==0?l:s.data.remark.localeCompare(r.data.remark)}),Pp=t=>{const s=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((i,a)=>{const o=Ap(i,a),d=o.id!=null?`host-${o.id}`:Yl();s.push({uid:d,inboundTag:r,initialInboundTag:r,data:wa(o),original:wa(o)})})}),js(s)},Xl=t=>{const s=new Map;t.forEach(l=>{var a;const i=(a=s.get(l.inboundTag))!=null?a:[];i.push(l.data),s.set(l.inboundTag,i)});const r={};return s.forEach((l,i)=>{r[i]=l.map(a=>Ip(a)).sort((a,o)=>Qr(a.sort)-Qr(o.sort))}),r},oa=(t,s)=>{const r=Xl(t),l=Array.from(new Set(s)),i={};return l.forEach(a=>{var o;i[a]=(o=r[a])!=null?o:[]}),i},Tp=({host:t,inboundOptions:s,orderIndex:r,onToggleActive:l,onEdit:i,onDelete:a,saving:o,deleting:d})=>{const{t:u}=Ke(),m=s.find(S=>S.value===t.inboundTag),p=!t.data.is_disabled,g=Gl(t),x=t.data.remark||u("hostsPage.untitledHost");return e(Lr,{borderWidth:"1px",borderColor:g?"primary.400":"gray.200",_dark:{borderColor:g?"primary.300":"gray.700",bg:g?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>i(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:n(Tn,{as:ye,spacing:4,children:[n(M,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(me,{align:"flex-start",spacing:1,flex:"1",children:[e(ft,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:x})}),n(M,{spacing:2,flexWrap:"wrap",children:[e(ut,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),m&&e(ut,{colorScheme:"purple",size:"sm",children:`${m.value} (${m.protocol.toUpperCase()} - ${m.network})`}),typeof t.data.port=="number"&&e(ut,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),g&&e(ut,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),n(M,{spacing:2,onClick:S=>S.stopPropagation(),onPointerDown:S=>S.stopPropagation(),children:[e(bt,{size:"sm",colorScheme:"primary",isChecked:p,onChange:S=>{S.stopPropagation(),l(t.uid,S.target.checked)},onClick:S=>S.stopPropagation(),onPointerDown:S=>S.stopPropagation(),"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(p?"hostsPage.enabled":"hostsPage.disabled")})]})]}),n(me,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),n(M,{justify:"space-between",children:[e(L,{size:"sm",variant:"outline",leftIcon:e(Cp,{}),onClick:S=>{S.stopPropagation(),i(t.uid)},isLoading:o,children:u("hostsPage.edit")}),e(We,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:S=>{S.stopPropagation(),a(t.uid)},icon:e(bi,{}),isLoading:d})]})]})})},Ep=({host:t,index:s})=>{const{t:r}=Ke(),l=yd(),i=t.data.remark||r("hostsPage.untitledHost"),a=c.exports.useCallback(o=>{o.pointerType==="mouse"&&o.button!==0||(o.preventDefault(),l.start(o))},[l]);return e(Il.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:n(M,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(ft,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(We,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(ql,{}),cursor:"grab",onPointerDown:a,style:{touchAction:"none"}})}),e(ut,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:s+1})}),n(me,{align:"flex-start",spacing:0,flex:"1",children:[e(ft,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:i})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Np=({host:t,inboundOptions:s,isOpen:r,onClose:l,onChange:i,onChangeInbound:a,onSave:o,onReset:d,onDelete:u,saving:m,deleting:p})=>{var y;const{t:g}=Ke();if(!t)return null;const x=s.find(v=>v.value===t.inboundTag),S=Gl(t);return n(Lt,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,returnFocusOnClose:!1,children:[e(kt,{}),n(Ot,{children:[e(Wt,{}),e(At,{pb:1,children:n(me,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||g("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||g("hostsPage.noAddress")}),x&&e(ut,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${x.value} (${x.protocol.toUpperCase()} - ${x.network})`})]})}),e(Ct,{children:n(me,{align:"stretch",spacing:5,children:[n(Lr,{variant:"outline",children:[e(vs,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.general")})}),e(Tn,{pt:0,children:n(me,{align:"stretch",spacing:4,children:[n(C,{children:[e(_,{children:g("hostsDialog.remark")}),n(Mr,{children:[e(De,{value:t.data.remark,onChange:v=>i(t.uid,"remark",v.target.value)}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ws,{})})]})]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:g("hostsPage.inboundLabel")}),e(rt,{value:t.inboundTag,onChange:v=>a(t.uid,v.target.value),children:s.map(v=>e("option",{value:v.value,children:v.label},v.value))})]}),n(C,{children:[e(_,{children:g("hostsDialog.sort")}),e(xn,{value:t.data.sort,allowMouseWheel:!0,onChange:(v,T)=>i(t.uid,"sort",Number.isNaN(T)?t.data.sort:T),children:e(Sn,{})})]})]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:g("hostsDialog.address")}),n(Mr,{children:[e(De,{value:t.data.address,onChange:v=>i(t.uid,"address",v.target.value)}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ws,{})})]})]}),n(C,{children:[e(_,{children:g("hostsDialog.port")}),e(xn,{value:(y=t.data.port)!=null?y:"",allowMouseWheel:!0,onChange:(v,T)=>i(t.uid,"port",Number.isNaN(T)?null:T),children:e(Sn,{})})]})]}),n(C,{children:[e(_,{children:g("hostsDialog.path")}),e(De,{value:t.data.path,onChange:v=>i(t.uid,"path",v.target.value),placeholder:"/"})]})]})})]}),n(Lr,{variant:"outline",children:[e(vs,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.security")})}),e(Tn,{pt:0,children:n(me,{align:"stretch",spacing:4,children:[n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:g("hostsDialog.sni")}),e(De,{value:t.data.sni,onChange:v=>i(t.uid,"sni",v.target.value)})]}),n(C,{children:[e(_,{children:g("hostsDialog.host")}),n(Mr,{children:[e(De,{value:t.data.host,onChange:v=>i(t.uid,"host",v.target.value)}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ws,{})})]})]})]}),n(Le,{columns:{base:1,md:3},spacing:4,children:[n(C,{children:[e(_,{children:g("hostsDialog.security")}),e(rt,{value:t.data.security,onChange:v=>i(t.uid,"security",v.target.value),children:vp.map(v=>e("option",{value:v.value,children:v.title},v.value))})]}),n(C,{children:[e(_,{children:g("hostsDialog.alpn")}),e(rt,{value:t.data.alpn,onChange:v=>i(t.uid,"alpn",v.target.value),children:wp.map(v=>e("option",{value:v.value,children:v.title},v.value))})]}),n(C,{children:[e(_,{children:g("hostsDialog.fingerprint")}),e(rt,{value:t.data.fingerprint,onChange:v=>i(t.uid,"fingerprint",v.target.value),children:kp.map(v=>e("option",{value:v.value,children:v.title},v.value))})]})]})]})})]}),n(Lr,{variant:"outline",children:[e(vs,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.advanced")})}),e(Tn,{pt:0,children:n(me,{align:"stretch",spacing:4,children:[n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:g("hostsDialog.fragment")}),e(De,{value:t.data.fragment_setting,onChange:v=>i(t.uid,"fragment_setting",v.target.value)})]}),n(C,{children:[e(_,{children:g("hostsDialog.noise")}),e(De,{value:t.data.noise_setting,onChange:v=>i(t.uid,"noise_setting",v.target.value)})]})]}),n(ye,{direction:{base:"column",md:"row"},spacing:4,children:[e(wr,{isChecked:t.data.allowinsecure,onChange:v=>i(t.uid,"allowinsecure",v.target.checked),children:g("hostsDialog.allowinsecure")}),e(wr,{isChecked:t.data.mux_enable,onChange:v=>i(t.uid,"mux_enable",v.target.checked),children:g("hostsDialog.muxEnable")}),e(wr,{isChecked:t.data.random_user_agent,onChange:v=>i(t.uid,"random_user_agent",v.target.checked),children:g("hostsDialog.randomUserAgent")}),e(wr,{isChecked:t.data.use_sni_as_host,onChange:v=>i(t.uid,"use_sni_as_host",v.target.checked),children:g("hostsDialog.useSniAsHost")})]})]})})]})]})}),n(Ut,{justifyContent:"space-between",children:[e(L,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(bi,{}),onClick:()=>u(t.uid),isLoading:p,children:g("hostsPage.delete")}),n(M,{spacing:3,children:[e(L,{size:"sm",variant:"outline",onClick:()=>d(t.uid),isDisabled:!S||m,children:g("hostsPage.reset")}),e(L,{size:"sm",colorScheme:"primary",onClick:()=>o(t.uid),isDisabled:!S,isLoading:m,children:g("hostsPage.save")})]})]})]})]})},zp=({isOpen:t,onClose:s,inboundOptions:r,onSubmit:l,isSubmitting:i,defaultSort:a})=>{var g,x,S,y;const{t:o}=Ke(),d=c.exports.useRef(null),[u,m]=c.exports.useState({inboundTag:(x=(g=r[0])==null?void 0:g.value)!=null?x:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""});c.exports.useEffect(()=>{var v,T;t&&(m({inboundTag:(T=(v=r[0])==null?void 0:v.value)!=null?T:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var N;return(N=d.current)==null?void 0:N.focus()},150))},[a,r,t]);const p=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return n(Lt,{isOpen:t,onClose:s,size:"lg",initialFocusRef:d,returnFocusOnClose:!1,children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ot,{children:[e(At,{children:n(M,{spacing:3,children:[e(Jl,{}),e(h,{fontWeight:"semibold",children:o("hostsPage.create.title")})]})}),e(Wt,{mt:2}),n(Ct,{as:me,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:o("hostsPage.create.description")}),n(C,{children:[e(_,{children:o("hostsPage.inboundLabel")}),e(rt,{value:u.inboundTag,onChange:v=>m(T=>({...T,inboundTag:v.target.value})),children:r.map(v=>e("option",{value:v.value,children:v.label},v.value))})]}),n(C,{isRequired:!0,children:[e(_,{children:o("hostsDialog.remark")}),n(Mr,{children:[e(De,{ref:d,value:u.remark,onChange:v=>m(T=>({...T,remark:v.target.value}))}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ws,{})})]})]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{isRequired:!0,children:[e(_,{children:o("hostsDialog.address")}),n(Mr,{children:[e(De,{value:u.address,onChange:v=>m(T=>({...T,address:v.target.value}))}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ws,{})})]})]}),n(C,{children:[e(_,{children:o("hostsDialog.port")}),e(xn,{value:(S=u.port)!=null?S:"",onChange:(v,T)=>m(N=>({...N,port:Number.isNaN(T)?null:T})),children:e(Sn,{})})]})]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("hostsDialog.path")}),e(De,{value:u.path,onChange:v=>m(T=>({...T,path:v.target.value}))})]}),n(C,{children:[e(_,{children:o("hostsDialog.sni")}),e(De,{value:u.sni,onChange:v=>m(T=>({...T,sni:v.target.value}))})]})]}),n(C,{children:[e(_,{children:o("hostsDialog.host")}),n(Mr,{children:[e(De,{value:u.host,onChange:v=>m(T=>({...T,host:v.target.value}))}),e(Vr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ws,{})})]})]}),n(C,{children:[e(_,{children:o("hostsDialog.sort")}),e(xn,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(v,T)=>m(N=>({...N,sort:Number.isNaN(T)?N.sort:T})),children:e(Sn,{})})]}),e(z,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:o("hostsPage.create.sortHint",{value:(y=u.sort)!=null?y:a})})]}),n(Ut,{gap:2,children:[e(L,{variant:"ghost",onClick:s,children:o("hostsPage.cancel")}),e(L,{colorScheme:"primary",onClick:p,isLoading:i,children:o("hostsPage.create.submit")})]})]})]})},Rp=()=>{var ie;const{t}=Ke(),s=Zt(),{hosts:r,fetchHosts:l,isLoading:i,isPostLoading:a,setHosts:o}=Kl(),{inbounds:d}=Tt(),[u,m]=c.exports.useState([]),p=c.exports.useRef([]),g=c.exports.useCallback(D=>{typeof D=="function"?m(de=>{const ze=D(de);return p.current=ze,ze}):(p.current=D,m(D))},[]),[x,S]=c.exports.useState(null),[y,v]=c.exports.useState(!1),[T,N]=c.exports.useState(""),[W,he]=c.exports.useState(!1),[E,F]=c.exports.useState(null),[P,j]=c.exports.useState(null),[q,le]=c.exports.useState(null),V=c.exports.useRef(null),[ce,A]=c.exports.useState(!1),be=c.exports.useRef(!1),[f,te]=c.exports.useState(!1),[J,we]=c.exports.useState(!1),[Te,Ne]=c.exports.useState(null);c.exports.useEffect(()=>{l()},[l]),c.exports.useEffect(()=>{d.size||ui()},[d]),c.exports.useEffect(()=>{const D=Pp(r);g(D)},[r,g]),c.exports.useEffect(()=>{x&&!p.current.some(D=>D.uid===x)&&S(null)},[u,x]);const $=c.exports.useCallback(D=>{be.current=D,A(D)},[]);c.exports.useEffect(()=>{J||(Ne(null),$(!1))},[y,J,$]),c.exports.useEffect(()=>{if(!J||!Te)return;const D=new Set(p.current.map(ze=>ze.uid));Te.every(ze=>D.has(ze.uid))||(Ne(null),$(!1))},[u,J,$,Te]);const K=c.exports.useMemo(()=>{const D=[];return d.forEach(de=>{de.forEach(ze=>{D.push({label:`${ze.tag} (${ze.protocol.toUpperCase()} - ${ze.network})`,value:ze.tag,protocol:ze.protocol,network:ze.network})})}),D.sort((de,ze)=>de.label.localeCompare(ze.label))},[d]),ee=c.exports.useMemo(()=>p.current.filter(D=>!D.data.is_disabled).sort((D,de)=>Qr(D.data.sort)-Qr(de.data.sort)),[u]),_e=c.exports.useMemo(()=>[...p.current].sort((D,de)=>Qr(D.data.sort)-Qr(de.data.sort)),[u]),xe=c.exports.useMemo(()=>y?_e:ee,[ee,_e,y]),B=T.trim().toLowerCase(),O=c.exports.useMemo(()=>B?xe.filter(D=>[D.data.remark,D.data.address,D.data.host,D.data.path,D.data.sni,D.inboundTag,D.data.port!=null?String(D.data.port):""].some(ze=>ze&&ze.toLowerCase().includes(B))):xe,[xe,B]);c.exports.useEffect(()=>{J&&Ne(D=>D!=null?D:[...ee])},[ee,J]);const G=J?Te!=null?Te:ee:O,pe=p.current.length>0,k=i&&!pe,I=i&&pe,U=B.length>0,Y=!J&&!k&&U&&xe.length>0&&O.length===0,Ie=c.exports.useMemo(()=>{const D=new Map;return G.forEach((de,ze)=>D.set(de.uid,ze)),D},[G]),Se=x&&(ie=p.current.find(D=>D.uid===x))!=null?ie:null,He=(D,de,ze)=>{g(Ge=>js(Ge.map(tt=>tt.uid===D?{...tt,data:{...tt.data,[de]:ze}}:tt)))},R=(D,de)=>{g(ze=>js(ze.map(Ge=>Ge.uid===D?{...Ge,inboundTag:de}:Ge)))},re=c.exports.useCallback(async()=>{if(!J||f)return!1;const D=ee,de=Te!=null?Te:D;if(!(de.length!==D.length||de.some((Me,it)=>{var Jt;return Me.uid!==((Jt=D[it])==null?void 0:Jt.uid)}))||!Te||de.length===0)return we(!1),Ne(null),$(!1),!0;const Ge=de.map(Me=>Me.uid),tt=new Map;Ge.forEach((Me,it)=>tt.set(Me,it));const qe=p.current,Vt=p.current.filter(Me=>tt.has(Me.uid)).sort((Me,it)=>{var Jt,nr;return((Jt=tt.get(Me.uid))!=null?Jt:Number.MAX_SAFE_INTEGER)-((nr=tt.get(it.uid))!=null?nr:Number.MAX_SAFE_INTEGER)}),$t=p.current.filter(Me=>!tt.has(Me.uid)).sort((Me,it)=>Qr(Me.data.sort)-Qr(it.data.sort)),Kt=[...Vt,...$t].map((Me,it)=>({...Me,data:{...Me.data,sort:it},original:{...Me.original,sort:it}}));g(Kt),Ne(Kt.filter(Me=>!Me.data.is_disabled)),te(!0);try{const Me=Xl(Kt);return await o(Me),await l(),$(!1),we(!1),Ne(null),s({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{g(qe);const it=qe.filter(Jt=>!Jt.data.is_disabled).sort((Jt,nr)=>Qr(Jt.data.sort)-Qr(nr.data.sort));return Ne(it),$(!0),s({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{te(!1)}},[g,ee,l,J,f,o,$,t,s,Te]),H=c.exports.useCallback(D=>{if(!J||!D.length)return;const de=Te!=null?Te:ee;!(D.length!==de.length||D.some((Ge,tt)=>{var qe;return Ge.uid!==((qe=de[tt])==null?void 0:qe.uid)}))||(Ne(D),be.current||$(!0))},[ee,J,$,Te]),ge=c.exports.useCallback(()=>{Ne([...ee]),$(!1),we(!0)},[ee,$]),dt=c.exports.useCallback(()=>{we(!1),Ne(null),$(!1)},[$]),lt=c.exports.useCallback(()=>{re()},[re]),st=async D=>{const de=p.current.find(ze=>ze.uid===D);if(!!de){F(D);try{const ze=oa(p.current,[de.inboundTag,de.initialInboundTag]);await o(ze),await l(),s({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"}),S(null)}catch{s({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{F(null)}}},ve=D=>{g(de=>js(de.map(ze=>ze.uid===D?{...ze,inboundTag:ze.initialInboundTag,data:wa(ze.original)}:ze)))},Be=(D,de)=>{He(D,"is_disabled",!de),de||v(!0)},Je=D=>{le(D)},se=async()=>{if(!q)return;const D=p.current.find(de=>de.uid===q);if(!!D){j(q);try{const de=p.current.filter(Ge=>Ge.uid!==q);g(de);const ze=oa(de,[D.inboundTag,D.initialInboundTag]);await o(ze),await l(),s({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),x===q&&S(null)}catch{s({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{j(null),le(null)}}},Ye=async D=>{const de=p.current.length?Math.max(...p.current.map(ze=>ze.data.sort))+1:0;F("create");try{const ze={uid:Yl(),inboundTag:D.inboundTag,initialInboundTag:D.inboundTag,data:{id:null,remark:D.remark,address:D.address,sort:Number.isFinite(D.sort)?D.sort:de,port:D.port,path:D.path,sni:D.sni,host:D.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:D.remark,address:D.address,sort:Number.isFinite(D.sort)?D.sort:de,port:D.port,path:D.path,sni:D.sni,host:D.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},Ge=js([...p.current,ze]);g(Ge);const tt=oa(Ge,[D.inboundTag]);await o(tt),await l(),s({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),he(!1)}catch{s({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{F(null)}};return n(me,{align:"stretch",spacing:4,children:[J?n(me,{align:"stretch",spacing:2,children:[n(M,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),n(M,{spacing:2,children:[e(L,{variant:"ghost",onClick:dt,isDisabled:f,children:t("hostsPage.cancel")}),e(L,{colorScheme:"primary",onClick:lt,isLoading:f,isDisabled:!ce&&!f,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),f?n(M,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(Et,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):ce?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):n(ye,{direction:{base:"column",md:"row"},spacing:3,align:{base:"stretch",md:"center"},justify:"space-between",children:[n(M,{spacing:3,flexWrap:"wrap",children:[e(L,{colorScheme:"primary",size:"sm",onClick:()=>he(!0),leftIcon:e(Jl,{}),isDisabled:!K.length,children:t("hostsPage.addHost")}),e(bt,{isChecked:y,onChange:D=>v(D.target.checked),children:t("hostsPage.showDisabled")})]}),n(ye,{direction:{base:"column",sm:"row"},spacing:2,align:{base:"stretch",sm:"center"},justify:"flex-end",w:"full",children:[e(De,{value:T,onChange:D=>N(D.target.value),placeholder:t("hostsPage.searchPlaceholder",{defaultValue:"Search hosts..."}),size:"sm",w:"100%"}),n(M,{spacing:2,justify:"flex-end",children:[I&&e(Et,{size:"sm"}),e(L,{size:"sm",variant:"outline",leftIcon:e(ql,{}),onClick:ge,isDisabled:k||!ee.length,children:t("hostsPage.enterSort")})]})]})]}),k?e(M,{justify:"center",py:10,children:e(Et,{})}):G.length===0?e(z,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t(Y?"hostsPage.searchEmpty":"hostsPage.emptyState")})}):J?e(Il.Group,{axis:"y",values:G,onReorder:H,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:G.map((D,de)=>e(Ep,{host:D,index:de},D.uid))}):e(Le,{columns:{base:1,md:2,xl:3},spacing:4,children:G.map((D,de)=>{var ze;return e(Tp,{host:D,inboundOptions:K,orderIndex:(ze=Ie.get(D.uid))!=null?ze:de,onToggleActive:Be,onEdit:S,onDelete:Je,saving:E===D.uid&&a,deleting:P===D.uid&&a},D.uid)})}),e(zp,{isOpen:W,onClose:()=>he(!1),inboundOptions:K,onSubmit:Ye,isSubmitting:E==="create"&&a,defaultSort:p.current.length?Math.max(...p.current.map(D=>D.data.sort))+1:0}),e(Np,{host:Se,inboundOptions:K,isOpen:Boolean(Se),onClose:()=>S(null),onChange:He,onChangeInbound:R,onSave:st,onReset:ve,onDelete:Je,saving:!!Se&&E===Se.uid&&a,deleting:!!Se&&P===Se.uid&&a}),e(_s,{isOpen:Boolean(q),leastDestructiveRef:V,onClose:()=>le(null),children:e(kt,{children:n(Ds,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(Ct,{children:t("hostsPage.deleteConfirmation")}),n(Ut,{children:[e(L,{ref:V,onClick:()=>le(null),children:t("hostsPage.cancel")}),e(L,{colorScheme:"red",onClick:se,ml:3,isLoading:Boolean(P),children:t("hostsPage.delete")})]})]})})})]})},Up=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),Ao=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(Up(t))}catch{}return""},Mp=t=>{if(typeof t!="string"||t.length===0)return"";const s=globalThis.Wireguard;if(s!=null&&s.generateKeypair)try{const r=s.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class Fr{static isEmpty(s){return s==null?!0:typeof s=="string"?s.trim().length===0:Array.isArray(s)?s.length===0:typeof s=="object"?Object.keys(s).length===0:!1}static isArrEmpty(s){return!Array.isArray(s)||s.length===0}}const fe=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),Ql=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const Lp=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),Op=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const Wp=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const la=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class Pt{static toJsonArray(s){return s.map(r=>r.toJson())}static fromJson(s){return new Pt}toJson(){return{}}toString(s=!0){const r=this.toJson();return s?JSON.stringify(r,null,2):JSON.stringify(r)}}class En extends Pt{constructor(r="none",l="",i=""){super();X(this,"type");X(this,"host");X(this,"path");this.type=r,this.host=l,this.path=i}static fromJson(r={}){var i,a,o,d,u,m,p,g,x,S;const l=r==null?void 0:r.header;if(!l)return new En;if(l.type==="http"&&l.request){const y=((a=(i=l.request)==null?void 0:i.headers)==null?void 0:a.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(d=(o=l.request)==null?void 0:o.headers)==null?void 0:d.Host)!=null?u:"",v=((m=l.request)==null?void 0:m.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(g=(p=l.request)==null?void 0:p.path)!=null?g:"";return new En((x=l.type)!=null?x:"http",y,v)}return new En((S=l.type)!=null?S:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:Fr.isEmpty(this.host)?[]:this.host.split(",")},path:Fr.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class Is extends Pt{constructor(r=1350,l=50,i=5,a=20,o=!1,d=2,u=2,m="none",p=""){super();X(this,"mtu");X(this,"tti");X(this,"upCap");X(this,"downCap");X(this,"congestion");X(this,"readBuffer");X(this,"writeBuffer");X(this,"type");X(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=i!=null?i:5,this.downCap=a!=null?a:20,this.congestion=Boolean(o),this.readBuffer=d!=null?d:2,this.writeBuffer=u!=null?u:2,this.type=m!=null?m:"none",this.seed=p!=null?p:""}static fromJson(r={}){var l,i,a;return new Is(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(i=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?i:"none",(a=r==null?void 0:r.seed)!=null?a:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class ss extends Pt{constructor(r="/",l="",i=0){super();X(this,"path");X(this,"host");X(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=i!=null?i:0}static fromJson(r={}){var l,i,a;return new ss((l=r==null?void 0:r.path)!=null?l:"/",(i=r==null?void 0:r.host)!=null?i:"",(a=r==null?void 0:r.heartbeatPeriod)!=null?a:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class is extends Pt{constructor(r="",l="",i=!1){super();X(this,"serviceName");X(this,"authority");X(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(i)}static fromJson(r={}){var l,i;return new is((l=r==null?void 0:r.serviceName)!=null?l:"",(i=r==null?void 0:r.authority)!=null?i:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class Ps extends Pt{constructor(r="/",l=""){super();X(this,"path");X(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,i;return new Ps((l=r==null?void 0:r.path)!=null?l:"/",(i=r==null?void 0:r.host)!=null?i:"")}toJson(){return{path:this.path,host:this.host}}}class Ts extends Pt{constructor(r="/",l="",i="",a=!1,o="30",d={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,m,p,g,x,S;super();X(this,"path");X(this,"host");X(this,"mode");X(this,"noGRPCHeader");X(this,"scMinPostsIntervalMs");X(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=i!=null?i:"",this.noGRPCHeader=Boolean(a),this.scMinPostsIntervalMs=o!=null?o:"30",this.xmux={maxConcurrency:(u=d==null?void 0:d.maxConcurrency)!=null?u:"16-32",maxConnections:(m=d==null?void 0:d.maxConnections)!=null?m:0,cMaxReuseTimes:(p=d==null?void 0:d.cMaxReuseTimes)!=null?p:0,hMaxRequestTimes:(g=d==null?void 0:d.hMaxRequestTimes)!=null?g:"600-900",hMaxReusableSecs:(x=d==null?void 0:d.hMaxReusableSecs)!=null?x:"1800-3000",hKeepAlivePeriod:(S=d==null?void 0:d.hKeepAlivePeriod)!=null?S:0}}static fromJson(r={}){var l,i,a,o;return new Ts((l=r==null?void 0:r.path)!=null?l:"/",(i=r==null?void 0:r.host)!=null?i:"",(a=r==null?void 0:r.mode)!=null?a:"",Boolean(r==null?void 0:r.noGRPCHeader),(o=r==null?void 0:r.scMinPostsIntervalMs)!=null?o:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class as extends Pt{constructor(r="",l=[],i="",a=!1,o=""){super();X(this,"serverName");X(this,"alpn");X(this,"fingerprint");X(this,"allowInsecure");X(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=i!=null?i:"",this.allowInsecure=Boolean(a),this.echConfigList=o!=null?o:""}static fromJson(r={}){var l,i,a;return new as((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(i=r==null?void 0:r.fingerprint)!=null?i:"",Boolean(r==null?void 0:r.allowInsecure),(a=r==null?void 0:r.echConfigList)!=null?a:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class Es extends Pt{constructor(r="",l="",i="",a="",o="",d=""){super();X(this,"publicKey");X(this,"fingerprint");X(this,"serverName");X(this,"shortId");X(this,"spiderX");X(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=i!=null?i:"",this.shortId=a!=null?a:"",this.spiderX=o!=null?o:"",this.mldsa65Verify=d!=null?d:""}static fromJson(r={}){var l,i,a,o,d,u;return new Es((l=r==null?void 0:r.publicKey)!=null?l:"",(i=r==null?void 0:r.fingerprint)!=null?i:"",(a=r==null?void 0:r.serverName)!=null?a:"",(o=r==null?void 0:r.shortId)!=null?o:"",(d=r==null?void 0:r.spiderX)!=null?d:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class hi extends Pt{constructor(r="",l=!1,i=0,a=!1,o=!1,d=la.NONE){super();X(this,"dialerProxy");X(this,"tcpFastOpen");X(this,"tcpKeepAliveInterval");X(this,"tcpMptcp");X(this,"penetrate");X(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=i!=null?i:0,this.tcpMptcp=Boolean(a),this.penetrate=Boolean(o),this.addressPortStrategy=d!=null?d:la.NONE}static fromJson(r={}){var l,i,a;return!r||Object.keys(r).length===0?new hi:new hi((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(i=r==null?void 0:r.tcpKeepAliveInterval)!=null?i:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(a=r==null?void 0:r.addressPortStrategy)!=null?a:la.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class On extends Pt{constructor(r="tcp",l="none",i=new as,a=new Es,o=new En,d=new Is,u=new ss,m=new is,p=new Ps,g=new Ts,x){super();X(this,"network");X(this,"security");X(this,"tls");X(this,"reality");X(this,"tcp");X(this,"kcp");X(this,"ws");X(this,"grpc");X(this,"httpupgrade");X(this,"xhttp");X(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=i,this.reality=a,this.tcp=o,this.kcp=d,this.ws=u,this.grpc=m,this.httpupgrade=p,this.xhttp=g,this.sockopt=x}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new hi:void 0}static fromJson(r={}){var l,i;return new On((l=r==null?void 0:r.network)!=null?l:"tcp",(i=r==null?void 0:r.security)!=null?i:"none",as.fromJson(r==null?void 0:r.tlsSettings),Es.fromJson(r==null?void 0:r.realitySettings),En.fromJson(r==null?void 0:r.tcpSettings),Is.fromJson(r==null?void 0:r.kcpSettings),ss.fromJson(r==null?void 0:r.wsSettings),is.fromJson(r==null?void 0:r.grpcSettings),Ps.fromJson(r==null?void 0:r.httpupgradeSettings),Ts.fromJson(r==null?void 0:r.xhttpSettings),hi.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class pi extends Pt{constructor(r=!1,l=8,i=16,a="reject"){super();X(this,"enabled");X(this,"concurrency");X(this,"xudpConcurrency");X(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=i!=null?i:16,this.xudpProxyUDP443=a!=null?a:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new pi:new pi(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var Pn,sn;const nt=class extends Pt{constructor(r="",l=fe.VLESS,i=nt.Settings.getSettings(fe.VLESS),a=new On,o,d=new pi){super();X(this,"tag");X(this,"_protocol");X(this,"settings");X(this,"stream");X(this,"sendThrough");X(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:fe.VLESS,this.settings=i!=null?i:nt.Settings.getSettings(this._protocol),this.stream=a,this.sendThrough=o,this.mux=d}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=nt.Settings.getSettings(r),this.stream=new On}canEnableTls(){return[fe.VMess,fe.VLESS,fe.Trojan,fe.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===fe.VLESS:!1}canEnableReality(){return[fe.VLESS,fe.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[fe.VMess,fe.VLESS,fe.Trojan,fe.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[fe.VMess,fe.VLESS,fe.Trojan,fe.Shadowsocks,fe.HTTP,fe.Socks].includes(this.protocol)}hasVnext(){return[fe.VMess,fe.VLESS].includes(this.protocol)}hasServers(){return[fe.Trojan,fe.Shadowsocks,fe.Socks,fe.HTTP].includes(this.protocol)}hasAddressPort(){return[fe.DNS,fe.VMess,fe.VLESS,fe.Trojan,fe.Shadowsocks,fe.Socks,fe.HTTP].includes(this.protocol)}hasUsername(){return[fe.Socks,fe.HTTP].includes(this.protocol)}static fromJson(r={}){var l,i,a,o;return new nt((l=r==null?void 0:r.tag)!=null?l:"",(i=r==null?void 0:r.protocol)!=null?i:fe.VLESS,nt.Settings.fromProtocol((a=r==null?void 0:r.protocol)!=null?a:fe.VLESS,r==null?void 0:r.settings),On.fromJson(r==null?void 0:r.streamSettings),(o=r==null?void 0:r.sendThrough)!=null?o:"",pi.fromJson(r==null?void 0:r.mux))}toJson(){var l,i;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof Pt?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(i=this.mux)!=null&&i.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const i=l[0].toLowerCase();try{switch(i){case fe.VMess:return nt.fromVmessLink(JSON.parse(Ao(l[1])));case fe.VLESS:case fe.Trojan:case"ss":return nt.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var o,d,u,m,p,g,x,S,y,v,T,N,W,he,E,F,P,j,q,le,V,ce,A;if(!r)return null;const l=new On((o=r==null?void 0:r.net)!=null?o:"tcp",(d=r==null?void 0:r.tls)!=null?d:"none"),i=r==null?void 0:r.net;i==="tcp"?l.tcp=new En((u=r==null?void 0:r.type)!=null?u:"none",(m=r==null?void 0:r.host)!=null?m:"",(p=r==null?void 0:r.path)!=null?p:""):i==="kcp"?(l.kcp=new Is,l.kcp.type=(g=r==null?void 0:r.type)!=null?g:"none",l.kcp.seed=(x=r==null?void 0:r.path)!=null?x:""):i==="ws"?l.ws=new ss((S=r==null?void 0:r.path)!=null?S:"/",(y=r==null?void 0:r.host)!=null?y:""):i==="grpc"?l.grpc=new is((v=r==null?void 0:r.path)!=null?v:"",(T=r==null?void 0:r.authority)!=null?T:"",(r==null?void 0:r.type)==="multi"):i==="httpupgrade"?l.httpupgrade=new Ps((N=r==null?void 0:r.path)!=null?N:"/",(W=r==null?void 0:r.host)!=null?W:""):i==="xhttp"&&(l.xhttp=new Ts((he=r==null?void 0:r.path)!=null?he:"/",(E=r==null?void 0:r.host)!=null?E:"",(F=r==null?void 0:r.mode)!=null?F:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new as((P=r==null?void 0:r.sni)!=null?P:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(j=r==null?void 0:r.fp)!=null?j:"",Boolean(r==null?void 0:r.allowInsecure)));const a=Number((q=r==null?void 0:r.port)!=null?q:0);return Number.isNaN(a)?null:new nt((le=r==null?void 0:r.ps)!=null?le:"",fe.VMess,new nt.VmessSettings((V=r==null?void 0:r.add)!=null?V:"",a,(ce=r==null?void 0:r.id)!=null?ce:"",(A=r==null?void 0:r.scy)!=null?A:""),l)}static fromParamLink(r){var F,P,j,q,le,V,ce,A,be,f,te,J,we,Te,Ne,$,K,ee,_e,xe,B;let l;try{l=new URL(r)}catch{return null}const i=(F=l.searchParams.get("type"))!=null?F:"tcp",a=(P=l.searchParams.get("security"))!=null?P:"none",o=new On(i,a),d=(j=l.searchParams.get("headerType"))!=null?j:void 0,u=(q=l.searchParams.get("host"))!=null?q:void 0,m=(le=l.searchParams.get("path"))!=null?le:void 0,p=(V=l.searchParams.get("mode"))!=null?V:void 0;if(i==="tcp"||i==="none"?o.tcp=new En(d!=null?d:"none",u!=null?u:"",m!=null?m:""):i==="kcp"?(o.kcp=new Is,o.kcp.type=d!=null?d:"none",o.kcp.seed=m!=null?m:""):i==="ws"?o.ws=new ss(m!=null?m:"/",u!=null?u:""):i==="grpc"?o.grpc=new is((ce=l.searchParams.get("serviceName"))!=null?ce:"",(A=l.searchParams.get("authority"))!=null?A:"",l.searchParams.get("mode")==="multi"):i==="httpupgrade"?o.httpupgrade=new Ps(m!=null?m:"/",u!=null?u:""):i==="xhttp"&&(o.xhttp=new Ts(m!=null?m:"/",u!=null?u:"",p!=null?p:"")),a==="tls"){const O=(be=l.searchParams.get("fp"))!=null?be:"none",G=l.searchParams.get("alpn"),pe=l.searchParams.get("allowInsecure"),k=(f=l.searchParams.get("sni"))!=null?f:"",I=(te=l.searchParams.get("ech"))!=null?te:"";o.tls=new as(k,G?G.split(","):[],O,pe==="1",I)}if(a==="reality"){const O=(J=l.searchParams.get("pbk"))!=null?J:"",G=(we=l.searchParams.get("fp"))!=null?we:"",pe=(Te=l.searchParams.get("sni"))!=null?Te:"",k=(Ne=l.searchParams.get("sid"))!=null?Ne:"",I=($=l.searchParams.get("spx"))!=null?$:"",U=(K=l.searchParams.get("pqv"))!=null?K:"";o.reality=new Es(O,G,pe,k,I,U)}const g=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,x=r.match(g);if(!x)return null;let[,S,y,v,T]=x,N=Number(T);Number.isNaN(N)&&(N=0),S==="ss"&&(S=fe.Shadowsocks,y=Ao(y));let W=null;switch(S){case fe.VLESS:{const O=(ee=l.searchParams.get("encryption"))!=null?ee:"none";W=new nt.VLESSSettings(v,N,y,(_e=l.searchParams.get("flow"))!=null?_e:"",O);break}case fe.Trojan:W=new nt.TrojanSettings(v,N,y);break;case fe.Shadowsocks:{const O=y.split(":"),G=(xe=O.shift())!=null?xe:"";W=new nt.ShadowsocksSettings(v,N,O.join(":"),G,!0);break}default:return null}const he=decodeURIComponent((B=l.hash)!=null?B:""),E=he.length>1?he.substring(1):`out-${S}-${N}`;return new nt(E,S,W,o)}};let or=nt;X(or,"Settings",class extends Pt{constructor(i){super();X(this,"protocol");this.protocol=i}static getSettings(i){switch(i){case fe.Freedom:return new nt.FreedomSettings;case fe.Blackhole:return new nt.BlackholeSettings;case fe.DNS:return new nt.DNSSettings;case fe.VMess:return new nt.VmessSettings;case fe.VLESS:return new nt.VLESSSettings;case fe.Trojan:return new nt.TrojanSettings;case fe.Shadowsocks:return new nt.ShadowsocksSettings;case fe.Socks:return new nt.SocksSettings;case fe.HTTP:return new nt.HttpSettings;case fe.Wireguard:return new nt.WireguardSettings;default:return null}}static fromProtocol(i,a){switch(i){case fe.Freedom:return nt.FreedomSettings.fromJson(a);case fe.Blackhole:return nt.BlackholeSettings.fromJson(a);case fe.DNS:return nt.DNSSettings.fromJson(a);case fe.VMess:return nt.VmessSettings.fromJson(a);case fe.VLESS:return nt.VLESSSettings.fromJson(a);case fe.Trojan:return nt.TrojanSettings.fromJson(a);case fe.Shadowsocks:return nt.ShadowsocksSettings.fromJson(a);case fe.Socks:return nt.SocksSettings.fromJson(a);case fe.HTTP:return nt.HttpSettings.fromJson(a);case fe.Wireguard:return nt.WireguardSettings.fromJson(a);default:return null}}toJson(){return{}}}),X(or,"FreedomSettings",(Pn=class extends Pt{constructor(i="",a="",o={},d=[]){super();X(this,"domainStrategy");X(this,"redirect");X(this,"fragment");X(this,"noises");this.domainStrategy=i!=null?i:"",this.redirect=a!=null?a:"",this.fragment=o!=null?o:{},this.noises=d!=null?d:[]}addNoise(){this.noises.push(new nt.FreedomSettings.Noise)}delNoise(i){this.noises.splice(i,1)}static fromJson(i={}){var a,o;return new Pn((a=i==null?void 0:i.domainStrategy)!=null?a:"",(o=i==null?void 0:i.redirect)!=null?o:"",i!=null&&i.fragment?Pn.Fragment.fromJson(i.fragment):{},Array.isArray(i==null?void 0:i.noises)?i.noises.map(d=>Pn.Noise.fromJson(d)):[])}toJson(){return{domainStrategy:Fr.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:Fr.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:Pt.toJsonArray(this.noises)}}},X(Pn,"Fragment",class Zl extends Pt{constructor(o="1-3",d="",u="",m=""){super();X(this,"packets");X(this,"length");X(this,"interval");X(this,"maxSplit");this.packets=o!=null?o:"1-3",this.length=d!=null?d:"",this.interval=u!=null?u:"",this.maxSplit=m!=null?m:""}static fromJson(o={}){var d,u,m,p;return new Zl((d=o==null?void 0:o.packets)!=null?d:"1-3",(u=o==null?void 0:o.length)!=null?u:"",(m=o==null?void 0:o.interval)!=null?m:"",(p=o==null?void 0:o.maxSplit)!=null?p:"")}}),X(Pn,"Noise",class jl extends Pt{constructor(o="rand",d="10-20",u="10-16",m="ip"){super();X(this,"type");X(this,"packet");X(this,"delay");X(this,"applyTo");this.type=o!=null?o:"rand",this.packet=d!=null?d:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=m!=null?m:"ip"}static fromJson(o={}){var d,u,m,p;return new jl((d=o==null?void 0:o.type)!=null?d:"rand",(u=o==null?void 0:o.packet)!=null?u:"10-20",(m=o==null?void 0:o.delay)!=null?m:"10-16",(p=o==null?void 0:o.applyTo)!=null?p:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),Pn)),X(or,"BlackholeSettings",class ec extends Pt{constructor(i){super();X(this,"type");this.type=i}static fromJson(i={}){var a;return new ec((a=i==null?void 0:i.response)==null?void 0:a.type)}toJson(){return{response:Fr.isEmpty(this.type)?void 0:{type:this.type}}}}),X(or,"DNSSettings",class tc extends Pt{constructor(i="udp",a="",o=53,d="reject",u=[]){super();X(this,"network");X(this,"address");X(this,"port");X(this,"nonIPQuery");X(this,"blockTypes");this.network=i!=null?i:"udp",this.address=a!=null?a:"",this.port=o!=null?o:53,this.nonIPQuery=d!=null?d:"reject",this.blockTypes=u!=null?u:[]}static fromJson(i={}){var a,o,d,u;return new tc((a=i==null?void 0:i.network)!=null?a:"udp",(o=i==null?void 0:i.address)!=null?o:"",(d=i==null?void 0:i.port)!=null?d:53,(u=i==null?void 0:i.nonIPQuery)!=null?u:"reject",Array.isArray(i==null?void 0:i.blockTypes)?i.blockTypes:[])}}),X(or,"VmessSettings",class extends Pt{constructor(i="",a=0,o="",d=""){super();X(this,"address");X(this,"port");X(this,"id");X(this,"security");this.address=i!=null?i:"",this.port=a!=null?a:0,this.id=o!=null?o:"",this.security=d!=null?d:""}static fromJson(i={}){var d,u,m,p;if(Fr.isArrEmpty(i==null?void 0:i.vnext))return new nt.VmessSettings;const a=i.vnext[0],o=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new nt.VmessSettings((d=a==null?void 0:a.address)!=null?d:"",(u=a==null?void 0:a.port)!=null?u:0,(m=o==null?void 0:o.id)!=null?m:"",(p=o==null?void 0:o.security)!=null?p:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),X(or,"VLESSSettings",class extends Pt{constructor(i="",a=0,o="",d="",u=""){super();X(this,"address");X(this,"port");X(this,"id");X(this,"flow");X(this,"encryption");this.address=i!=null?i:"",this.port=a!=null?a:0,this.id=o!=null?o:"",this.flow=d!=null?d:"",this.encryption=u!=null?u:""}static fromJson(i={}){var d,u,m,p,g;if(Fr.isArrEmpty(i==null?void 0:i.vnext))return new nt.VLESSSettings;const a=i.vnext[0],o=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new nt.VLESSSettings((d=a==null?void 0:a.address)!=null?d:"",(u=a==null?void 0:a.port)!=null?u:0,(m=o==null?void 0:o.id)!=null?m:"",(p=o==null?void 0:o.flow)!=null?p:"",(g=o==null?void 0:o.encryption)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),X(or,"TrojanSettings",class extends Pt{constructor(i="",a=0,o=""){super();X(this,"address");X(this,"port");X(this,"password");this.address=i!=null?i:"",this.port=a!=null?a:0,this.password=o!=null?o:""}static fromJson(i={}){var o,d,u;if(Fr.isArrEmpty(i==null?void 0:i.servers))return new nt.TrojanSettings;const a=i.servers[0];return new nt.TrojanSettings((o=a==null?void 0:a.address)!=null?o:"",(d=a==null?void 0:a.port)!=null?d:0,(u=a==null?void 0:a.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),X(or,"ShadowsocksSettings",class extends Pt{constructor(i="",a=0,o="",d="",u,m){super();X(this,"address");X(this,"port");X(this,"password");X(this,"method");X(this,"uot");X(this,"UoTVersion");this.address=i!=null?i:"",this.port=a!=null?a:0,this.password=o!=null?o:"",this.method=d!=null?d:"",this.uot=u,this.UoTVersion=m}static fromJson(i={}){var d,u,m,p;let a=i==null?void 0:i.servers;Fr.isArrEmpty(a)&&(a=[{}]);const o=a[0];return new nt.ShadowsocksSettings((d=o==null?void 0:o.address)!=null?d:"",(u=o==null?void 0:o.port)!=null?u:0,(m=o==null?void 0:o.password)!=null?m:"",(p=o==null?void 0:o.method)!=null?p:"",o==null?void 0:o.uot,o==null?void 0:o.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),X(or,"SocksSettings",class extends Pt{constructor(i="",a=0,o="",d=""){super();X(this,"address");X(this,"port");X(this,"user");X(this,"pass");this.address=i!=null?i:"",this.port=a!=null?a:0,this.user=o!=null?o:"",this.pass=d!=null?d:""}static fromJson(i={}){var u,m,p,g;let a=i==null?void 0:i.servers;Fr.isArrEmpty(a)&&(a=[{users:[{}]}]);const o=a[0],d=Array.isArray(o==null?void 0:o.users)&&o.users[0]?o.users[0]:{};return new nt.SocksSettings((u=o==null?void 0:o.address)!=null?u:"",(m=o==null?void 0:o.port)!=null?m:0,(p=d==null?void 0:d.user)!=null?p:"",(g=d==null?void 0:d.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Fr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),X(or,"HttpSettings",class extends Pt{constructor(i="",a=0,o="",d=""){super();X(this,"address");X(this,"port");X(this,"user");X(this,"pass");this.address=i!=null?i:"",this.port=a!=null?a:0,this.user=o!=null?o:"",this.pass=d!=null?d:""}static fromJson(i={}){var u,m,p,g;let a=i==null?void 0:i.servers;Fr.isArrEmpty(a)&&(a=[{users:[{}]}]);const o=a[0],d=Array.isArray(o==null?void 0:o.users)&&o.users[0]?o.users[0]:{};return new nt.HttpSettings((u=o==null?void 0:o.address)!=null?u:"",(m=o==null?void 0:o.port)!=null?m:0,(p=d==null?void 0:d.user)!=null?p:"",(g=d==null?void 0:d.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Fr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),X(or,"WireguardSettings",(sn=class extends Pt{constructor(i=1420,a="",o=[""],d=2,u="",m="",p=[new sn.Peer],g=!1){super();X(this,"mtu");X(this,"secretKey");X(this,"pubKey");X(this,"address");X(this,"workers");X(this,"domainStrategy");X(this,"reserved");X(this,"peers");X(this,"noKernelTun");this.mtu=i!=null?i:1420,this.secretKey=a!=null?a:"",this.pubKey=this.secretKey.length>0?Mp(this.secretKey):"",this.address=Array.isArray(o)?o.join(","):o!=null?o:"",this.workers=d!=null?d:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(m)?m.join(","):m!=null?m:"",this.peers=p!=null?p:[new sn.Peer],this.noKernelTun=Boolean(g)}addPeer(){this.peers.push(new sn.Peer)}delPeer(i){this.peers.splice(i,1)}static fromJson(i={}){var a,o,d,u,m,p,g;return new sn((a=i==null?void 0:i.mtu)!=null?a:1420,(o=i==null?void 0:i.secretKey)!=null?o:"",(d=i==null?void 0:i.address)!=null?d:[""],(u=i==null?void 0:i.workers)!=null?u:2,(m=i==null?void 0:i.domainStrategy)!=null?m:"",(p=i==null?void 0:i.reserved)!=null?p:"",Array.isArray(i==null?void 0:i.peers)?i.peers.map(x=>sn.Peer.fromJson(x)):[new sn.Peer],(g=i==null?void 0:i.noKernelTun)!=null?g:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:Wp.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(i=>Number(i)).filter(i=>!Number.isNaN(i)):void 0,peers:Pt.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},X(sn,"Peer",class extends Pt{constructor(o="",d="",u=["0.0.0.0/0","::/0"],m="",p=0){super();X(this,"publicKey");X(this,"psk");X(this,"allowedIPs");X(this,"endpoint");X(this,"keepAlive");this.publicKey=o!=null?o:"",this.psk=d!=null?d:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=m!=null?m:"",this.keepAlive=p!=null?p:0}static fromJson(o={}){var d,u,m,p;return new nt.WireguardSettings.Peer((d=o==null?void 0:o.publicKey)!=null?d:"",(u=o==null?void 0:o.preSharedKey)!=null?u:"",Array.isArray(o==null?void 0:o.allowedIPs)?o.allowedIPs:["0.0.0.0/0","::/0"],(m=o==null?void 0:o.endpoint)!=null?m:"",(p=o==null?void 0:o.keepAlive)!=null?p:0)}toJson(){var o;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(o=this.allowedIPs)!=null&&o.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),sn));class Zn{static sizeFormat(s){if(s<=0||Number.isNaN(s))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,i=s;for(;i>=1024&&l<r.length-1;)i/=1024,l++;return`${i.toFixed(2)} ${r[l]}`}}const Fp=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(Op);const Hp=Object.values(Lp),Ha=["vmess","vless","trojan","shadowsocks","http","socks"],Bp=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp","xhttp"],Vp=["none","tls","reality"],ca=t=>t.split(/[\n,]/).map(s=>s.trim()).filter(Boolean),da=t=>t&&t.length?t.join(`
`):"",ms=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",rc=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),$p=t=>{if(!t)return 0;const s=Number(t);return!Number.isNaN(s)&&s>0?s:t.trim()},Er=t=>(Object.keys(t).forEach(s=>{const r=t[s];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[s]}),t),Io=()=>({user:"",pass:""}),ka=()=>({name:"",value:""}),Po=t=>{var s,r;return{user:(s=t==null?void 0:t.user)!=null?s:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},To=t=>{var s,r;return Er({user:(s=t.user)==null?void 0:s.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},Xn=t=>{if(t===""||t===null||typeof t>"u")return;const s=Number(t);return Number.isFinite(s)?s:void 0},Kp=t=>{if(!t.sockoptEnabled)return;const s=t.sockopt,r={acceptProxyProtocol:s.acceptProxyProtocol,tcpFastOpen:s.tcpFastOpen,mark:Xn(s.mark),tproxy:s.tproxy||void 0,tcpMptcp:s.tcpMptcp,penetrate:s.penetrate,domainStrategy:s.domainStrategy||void 0,tcpMaxSeg:Xn(s.tcpMaxSeg),dialerProxy:s.dialerProxy||void 0,tcpKeepAliveInterval:Xn(s.tcpKeepAliveInterval),tcpKeepAliveIdle:Xn(s.tcpKeepAliveIdle),tcpUserTimeout:Xn(s.tcpUserTimeout),tcpcongestion:s.tcpcongestion||void 0,V6Only:s.V6Only,tcpWindowClamp:Xn(s.tcpWindowClamp),interface:s.interfaceName||void 0};return Er(r)},Ca=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",tlsRawSettings:{},realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",xhttpHost:"",xhttpPath:"/",xhttpHeaders:[ka()],xhttpMode:"auto",xhttpScMaxBufferedPosts:"30",xhttpScMaxEachPostBytes:"1000000",xhttpScStreamUpServerSecs:"20-80",xhttpPaddingBytes:"100-1000",xhttpNoSSEHeader:!1,vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:rc(),httpAccounts:[Io()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[Io()],socksUdpEnabled:!1,socksUdpIp:""}),Jp=t=>{var s,r,l,i,a,o,d;return{dest:(r=(s=t==null?void 0:t.dest)==null?void 0:s.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(i=t==null?void 0:t.type)!=null?i:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(a=t==null?void 0:t.alpn)!=null?a:"",xver:(d=(o=t==null?void 0:t.xver)==null?void 0:o.toString())!=null?d:""}},Eo=t=>{var r,l,i;const s={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(i=t.type)==null?void 0:i.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(s.alpn=t.alpn.split(",").map(a=>a.trim()).filter(Boolean)),Er(s)},qp=t=>{var m,p,g,x,S,y,v,T,N,W,he,E,F,P,j,q,le,V,ce,A,be,f,te,J,we,Te,Ne,$,K,ee,_e,xe,B,O,G,pe,k,I,U,Y,Ie,Se,He,R,re,H,ge,dt,lt,st,ve,Be,Je,se,Ye,ie,D,de,ze,Ge,tt,qe,Vt,$t,Kt,Me,it,Jt,nr,kr,pr,gr,fr,ne,Ae,Q,Xe,_t,qt,Nt,zt,pt,mt,It,ir,Cr,Kr,Z;const s=Ha.includes(t.protocol)?t.protocol:"vless",r=Ca(s),l=(m=t.settings)!=null?m:{},i=(p=t.sniffing)!=null?p:{},a=(g=t.streamSettings)!=null?g:{},o=(x=a.tlsSettings)!=null?x:{},d=a.tlsSettings!==void 0&&a.tlsSettings!==null?JSON.parse(JSON.stringify(a.tlsSettings)):{},u=(S=a.realitySettings)!=null?S:{};return{...r,tag:(y=t.tag)!=null?y:"",listen:(v=t.listen)!=null?v:"",port:(N=(T=t.port)==null?void 0:T.toString())!=null?N:"",disableInsecureEncryption:Boolean((W=l.disableInsecureEncryption)!=null?W:r.disableInsecureEncryption),vlessDecryption:(he=l.decryption)!=null?he:r.vlessDecryption,vlessEncryption:(E=l.encryption)!=null?E:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map(Pe=>Jp(Pe)):r.fallbacks,shadowsocksNetwork:(F=l.network)!=null?F:r.shadowsocksNetwork,sniffingEnabled:Boolean((P=i.enabled)!=null?P:r.sniffingEnabled),sniffingDestinations:Array.isArray(i.destOverride)&&i.destOverride.length?i.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((j=i.routeOnly)!=null?j:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((q=i.metadataOnly)!=null?q:r.sniffingMetadataOnly),streamNetwork:(le=a.network)!=null?le:r.streamNetwork,streamSecurity:(V=a.security)!=null?V:r.streamSecurity,tlsServerName:(ce=o.serverName)!=null?ce:r.tlsServerName,tlsAlpn:Array.isArray(o.alpn)?o.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((A=o.allowInsecure)!=null?A:r.tlsAllowInsecure),tlsFingerprint:(be=o.fingerprint)!=null?be:r.tlsFingerprint,tlsRawSettings:d,realityPrivateKey:(f=u.privateKey)!=null?f:r.realityPrivateKey,realityServerNames:da(u.serverNames),realityShortIds:da(u.shortIds),realityDest:(te=u.dest)!=null?te:r.realityDest,realitySpiderX:(J=u.spiderX)!=null?J:r.realitySpiderX,realityXver:(Te=(we=u.xver)==null?void 0:we.toString())!=null?Te:r.realityXver,wsPath:($=(Ne=a==null?void 0:a.wsSettings)==null?void 0:Ne.path)!=null?$:r.wsPath,wsHost:(_e=(ee=(K=a==null?void 0:a.wsSettings)==null?void 0:K.headers)==null?void 0:ee.Host)!=null?_e:r.wsHost,tcpHeaderType:(O=(B=(xe=a==null?void 0:a.tcpSettings)==null?void 0:xe.header)==null?void 0:B.type)!=null?O:r.tcpHeaderType,tcpHttpHosts:da((I=(k=(pe=(G=a==null?void 0:a.tcpSettings)==null?void 0:G.header)==null?void 0:pe.request)==null?void 0:k.headers)==null?void 0:I.Host),tcpHttpPath:Array.isArray((Ie=(Y=(U=a==null?void 0:a.tcpSettings)==null?void 0:U.header)==null?void 0:Y.request)==null?void 0:Ie.path)?a.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(He=(Se=a==null?void 0:a.grpcSettings)==null?void 0:Se.serviceName)!=null?He:r.grpcServiceName,grpcAuthority:(re=(R=a==null?void 0:a.grpcSettings)==null?void 0:R.authority)!=null?re:r.grpcAuthority,grpcMultiMode:Boolean((ge=(H=a==null?void 0:a.grpcSettings)==null?void 0:H.multiMode)!=null?ge:r.grpcMultiMode),kcpHeaderType:(st=(lt=(dt=a==null?void 0:a.kcpSettings)==null?void 0:dt.header)==null?void 0:lt.type)!=null?st:r.kcpHeaderType,kcpSeed:(Be=(ve=a==null?void 0:a.kcpSettings)==null?void 0:ve.seed)!=null?Be:r.kcpSeed,quicSecurity:(se=(Je=a==null?void 0:a.quicSettings)==null?void 0:Je.security)!=null?se:r.quicSecurity,quicKey:(ie=(Ye=a==null?void 0:a.quicSettings)==null?void 0:Ye.key)!=null?ie:r.quicKey,quicHeaderType:(ze=(de=(D=a==null?void 0:a.quicSettings)==null?void 0:D.header)==null?void 0:de.type)!=null?ze:r.quicHeaderType,httpupgradePath:(tt=(Ge=a==null?void 0:a.httpupgradeSettings)==null?void 0:Ge.path)!=null?tt:r.httpupgradePath,httpupgradeHost:(Vt=(qe=a==null?void 0:a.httpupgradeSettings)==null?void 0:qe.host)!=null?Vt:r.httpupgradeHost,splithttpPath:(Kt=($t=a==null?void 0:a.splithttpSettings)==null?void 0:$t.path)!=null?Kt:r.splithttpPath,splithttpHost:(it=(Me=a==null?void 0:a.splithttpSettings)==null?void 0:Me.host)!=null?it:r.splithttpHost,xhttpHost:(nr=(Jt=a==null?void 0:a.xhttpSettings)==null?void 0:Jt.host)!=null?nr:r.xhttpHost,xhttpPath:(pr=(kr=a==null?void 0:a.xhttpSettings)==null?void 0:kr.path)!=null?pr:r.xhttpPath,xhttpHeaders:(gr=a==null?void 0:a.xhttpSettings)!=null&&gr.headers?Qp(a.xhttpSettings.headers):r.xhttpHeaders,xhttpMode:(ne=(fr=a==null?void 0:a.xhttpSettings)==null?void 0:fr.mode)!=null?ne:r.xhttpMode,xhttpScMaxBufferedPosts:(Xe=(Q=(Ae=a==null?void 0:a.xhttpSettings)==null?void 0:Ae.scMaxBufferedPosts)==null?void 0:Q.toString())!=null?Xe:r.xhttpScMaxBufferedPosts,xhttpScMaxEachPostBytes:(Nt=(qt=(_t=a==null?void 0:a.xhttpSettings)==null?void 0:_t.scMaxEachPostBytes)==null?void 0:qt.toString())!=null?Nt:r.xhttpScMaxEachPostBytes,xhttpScStreamUpServerSecs:(mt=(pt=(zt=a==null?void 0:a.xhttpSettings)==null?void 0:zt.scStreamUpServerSecs)==null?void 0:pt.toString())!=null?mt:r.xhttpScStreamUpServerSecs,xhttpPaddingBytes:(ir=(It=a==null?void 0:a.xhttpSettings)==null?void 0:It.xPaddingBytes)!=null?ir:r.xhttpPaddingBytes,xhttpNoSSEHeader:Boolean((Kr=(Cr=a==null?void 0:a.xhttpSettings)==null?void 0:Cr.noSSEHeader)!=null?Kr:r.xhttpNoSSEHeader),vlessSelectedAuth:(Z=l.selectedAuth)!=null?Z:r.vlessSelectedAuth,sockoptEnabled:Boolean(a==null?void 0:a.sockopt),sockopt:(()=>{var Ze,vt,jt,br,Wr,mr;const Pe=rc(),Ve=(Ze=a==null?void 0:a.sockopt)!=null?Ze:{};return Pe.acceptProxyProtocol=Boolean(Ve.acceptProxyProtocol),Pe.tcpFastOpen=Boolean(Ve.tcpFastOpen),Pe.mark=ms(Ve.mark),Pe.tproxy=(vt=Ve.tproxy)!=null?vt:Pe.tproxy,Pe.tcpMptcp=Boolean(Ve.tcpMptcp),Pe.penetrate=Boolean(Ve.penetrate),Pe.domainStrategy=(jt=Ve.domainStrategy)!=null?jt:Pe.domainStrategy,Pe.tcpMaxSeg=ms(Ve.tcpMaxSeg),Pe.dialerProxy=(br=Ve.dialerProxy)!=null?br:Pe.dialerProxy,Pe.tcpKeepAliveInterval=ms(Ve.tcpKeepAliveInterval),Pe.tcpKeepAliveIdle=ms(Ve.tcpKeepAliveIdle),Pe.tcpUserTimeout=ms(Ve.tcpUserTimeout),Pe.tcpcongestion=(Wr=Ve.tcpcongestion)!=null?Wr:Pe.tcpcongestion,Pe.V6Only=Boolean(Ve.V6Only),Pe.tcpWindowClamp=ms(Ve.tcpWindowClamp),Pe.interfaceName=(mr=Ve.interface)!=null?mr:Pe.interfaceName,Pe})(),httpAccounts:s==="http"&&Array.isArray(l.accounts)?l.accounts.map(Pe=>Po(Pe)):r.httpAccounts,httpAllowTransparent:s==="http"&&typeof l.allowTransparent=="boolean"?l.allowTransparent:r.httpAllowTransparent,socksAuth:s==="socks"&&l.auth==="password"?"password":r.socksAuth,socksAccounts:s==="socks"&&Array.isArray(l.accounts)?l.accounts.map(Pe=>Po(Pe)):r.socksAccounts,socksUdpEnabled:s==="socks"&&typeof l.udp=="boolean"?l.udp:r.socksUdpEnabled,socksUdpIp:s==="socks"&&l.ip!==void 0&&l.ip!==null?String(l.ip):r.socksUdpIp}},Yp=t=>{var l,i,a,o;const s={network:t.streamNetwork,security:t.streamSecurity};if(t.streamNetwork==="ws"&&(s.wsSettings=Er({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?s.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:ca(t.tcpHttpHosts)}:{}}}}:s.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(s.grpcSettings=Er({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(s.kcpSettings=Er({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(s.quicSettings=Er({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(s.httpupgradeSettings=Er({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(s.splithttpSettings=Er({path:t.splithttpPath,host:t.splithttpHost})),t.streamNetwork==="xhttp"&&(s.xhttpSettings=Er({path:t.xhttpPath,host:t.xhttpHost,headers:Zp(t.xhttpHeaders),mode:t.xhttpMode,scMaxBufferedPosts:Xn(t.xhttpScMaxBufferedPosts),scMaxEachPostBytes:((l=t.xhttpScMaxEachPostBytes)==null?void 0:l.trim())||void 0,scStreamUpServerSecs:((i=t.xhttpScStreamUpServerSecs)==null?void 0:i.trim())||void 0,xPaddingBytes:((a=t.xhttpPaddingBytes)==null?void 0:a.trim())||void 0,noSSEHeader:t.xhttpNoSSEHeader||void 0})),t.streamSecurity==="tls"){const d=t.tlsRawSettings&&typeof t.tlsRawSettings=="object"?{...t.tlsRawSettings}:{};d.serverName=t.tlsServerName||void 0,d.alpn=(o=t.tlsAlpn)!=null&&o.length?t.tlsAlpn:void 0,d.allowInsecure=t.tlsAllowInsecure,d.fingerprint=t.tlsFingerprint||void 0,s.tlsSettings=Er(d)}t.streamSecurity==="reality"&&(s.realitySettings=Er({privateKey:t.realityPrivateKey||void 0,serverNames:ca(t.realityServerNames),shortIds:ca(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=Kp(t);return r&&(s.sockopt=r),Er(s)},Gp=t=>{const s={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(s.clients=[]),t.protocol){case"vmess":s.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":s.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(s.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(s.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(Eo).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(Eo).filter(r=>Object.keys(r).length));break;case"shadowsocks":s.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(To).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r),t.httpAllowTransparent&&(s.allowTransparent=!0);break}case"socks":{if(s.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(To).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r)}s.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(s.ip=t.socksUdpIp.trim());break}}return s},Xp=t=>{const r=t.protocol!=="http"&&t.protocol!=="socks"?Yp(t):void 0,l={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:$p(t.port),protocol:t.protocol,settings:Gp(t)};return r&&(l.streamSettings=r),t.sniffingEnabled?l.sniffing=Er({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly}):l.sniffing={enabled:!1},l},Qp=t=>{if(!t)return[ka()];const s=[];return Object.entries(t).forEach(([r,l])=>{var i;Array.isArray(l)?l.forEach(a=>{var o;return s.push({name:r,value:(o=a==null?void 0:a.toString())!=null?o:""})}):s.push({name:r,value:(i=l==null?void 0:l.toString())!=null?i:""})}),s.length?s:[ka()]},Zp=t=>{const s={};return t.forEach(({name:r,value:l})=>{const i=r==null?void 0:r.trim(),a=l==null?void 0:l.trim();!i||!a||(s[i]=a)}),Object.keys(s).length?s:void 0};class _a{static gf(s){const r=new Float64Array(16);if(s)for(let l=0;l<s.length;++l)r[l]=s[l];return r}static pack(s,r){let l;const i=this.gf(),a=this.gf();for(let o=0;o<16;++o)a[o]=r[o];this.carry(a),this.carry(a),this.carry(a);for(let o=0;o<2;++o){i[0]=a[0]-65517;for(let d=1;d<15;++d)i[d]=a[d]-65535-(i[d-1]>>16&1),i[d-1]&=65535;i[15]=a[15]-32767-(i[14]>>16&1),l=i[15]>>16&1,i[14]&=65535,this.cswap(a,i,1-l)}for(let o=0;o<16;++o)s[2*o]=a[o]&255,s[2*o+1]=a[o]>>8}static carry(s){for(let r=0;r<16;++r)s[(r+1)%16]+=(r<15?1:38)*Math.floor(s[r]/65536),s[r]&=65535}static cswap(s,r,l){const i=~(l-1);for(let a=0;a<16;++a){const o=i&(s[a]^r[a]);s[a]^=o,r[a]^=o}}static add(s,r,l){for(let i=0;i<16;++i)s[i]=r[i]+l[i]|0}static subtract(s,r,l){for(let i=0;i<16;++i)s[i]=r[i]-l[i]|0}static multmod(s,r,l){const i=new Float64Array(31);for(let a=0;a<16;++a)for(let o=0;o<16;++o)i[a+o]+=r[a]*l[o];for(let a=0;a<15;++a)i[a]+=38*i[a+16];for(let a=0;a<16;++a)s[a]=i[a];this.carry(s),this.carry(s)}static invert(s,r){const l=this.gf();for(let i=0;i<16;++i)l[i]=r[i];for(let i=253;i>=0;--i)this.multmod(l,l,l),i!==2&&i!==4&&this.multmod(l,l,r);for(let i=0;i<16;++i)s[i]=l[i]}static clamp(s){s[31]=s[31]&127|64,s[0]&=248}static generatePublicKey(s){let r;const l=new Uint8Array(32),i=this.gf([1]),a=this.gf([9]),o=this.gf(),d=this.gf([1]),u=this.gf(),m=this.gf(),p=this.gf([56129,1]),g=this.gf([9]);for(let x=0;x<32;++x)l[x]=s[x];this.clamp(l);for(let x=254;x>=0;--x)r=l[x>>>3]>>>(x&7)&1,this.cswap(i,a,r),this.cswap(o,d,r),this.add(u,i,o),this.subtract(i,i,o),this.add(o,a,d),this.subtract(a,a,d),this.multmod(d,u,u),this.multmod(m,i,i),this.multmod(i,o,i),this.multmod(o,a,u),this.add(u,i,o),this.subtract(i,i,o),this.multmod(a,i,i),this.subtract(o,d,m),this.multmod(i,o,p),this.add(i,i,d),this.multmod(o,o,i),this.multmod(i,d,m),this.multmod(d,a,g),this.multmod(a,u,u),this.cswap(i,a,r),this.cswap(o,d,r);return this.invert(o,o),this.multmod(i,i,o),this.pack(l,i),l}static generatePresharedKey(){const s=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(s),s}static generatePrivateKey(){const s=this.generatePresharedKey();return this.clamp(s),s}static encodeBase64(s,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let i=0;i<4;++i)s[i]=l[i]+65+(25-l[i]>>8&6)-(51-l[i]>>8&75)-(61-l[i]>>8&15)+(62-l[i]>>8&3)}static keyToBase64(s){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),s.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([s[r*3+0],s[r*3+1],0])),l[43]=61,Array.from(l).map(i=>String.fromCharCode(i)).join("")}static keyFromBase64(s){const r=globalThis.atob(s),l=new Uint8Array(r.length);for(let i=0;i<r.length;i++)l[i]=r.charCodeAt(i);return l}static generateKeypair(s=""){const r=s.length>0?this.keyFromBase64(s):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:s.length>0?s:this.keyToBase64(r)}}}const Oi=t=>_a.generateKeypair(t!=null?t:""),jp=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:_a.generateKeypair.bind(_a)})},em=async()=>Ee("/xray/vlessenc"),at=c.exports.forwardRef((t,s)=>e(De,{size:"sm",ref:s,...t}));at.displayName="InboundFormInput";const Qn=c.exports.forwardRef((t,s)=>e(rt,{size:"sm",ref:s,...t}));Qn.displayName="InboundFormSelect";const ei=c.exports.forwardRef((t,s)=>e(Nr,{size:"sm",resize:"vertical",ref:s,...t}));ei.displayName="InboundFormTextarea";const No=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),tm=t=>{const s=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!s)return"";const r=s.length%4;return r===0?s:`${s}${"=".repeat(4-r)}`},rm=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],nm=["bbr","cubic","reno"],sm=["off","redirect","tproxy"],im=["auto","packet-up","stream-up","stream-one"],am=({isOpen:t,mode:s,initialValue:r,isSubmitting:l,onClose:i,onSubmit:a})=>{var Be,Je,se,Ye;const{t:o}=Ke(),d=Zt(),[u,m]=c.exports.useState([]),[p,g]=c.exports.useState(!1),x=en({defaultValues:Ca()}),{control:S,register:y,handleSubmit:v,reset:T,watch:N}=x,{fields:W,append:he,remove:E}=Ss({control:S,name:"fallbacks"}),{fields:F,append:P,remove:j}=Ss({control:S,name:"httpAccounts"}),{fields:q,append:le,remove:V}=Ss({control:S,name:"socksAccounts"}),{fields:ce,append:A,remove:be}=Ss({control:S,name:"xhttpHeaders"}),f=sr({control:S,name:"protocol"})||N("protocol"),te=sr({control:S,name:"streamNetwork"})||N("streamNetwork"),J=sr({control:S,name:"streamSecurity"})||N("streamSecurity"),we=(Be=sr({control:S,name:"sniffingEnabled"}))!=null?Be:N("sniffingEnabled"),Te=sr({control:S,name:"realityPrivateKey"})||N("realityPrivateKey"),Ne=sr({control:S,name:"tcpHeaderType"})||N("tcpHeaderType"),$=(Je=sr({control:S,name:"sockoptEnabled"}))!=null?Je:!1,K=sr({control:S,name:"vlessSelectedAuth"})||"",ee=sr({control:S,name:"socksAuth"})||N("socksAuth")||"noauth",_e=(Ye=(se=sr({control:S,name:"socksUdpEnabled"}))!=null?se:N("socksUdpEnabled"))!=null?Ye:!1,xe=sr({control:S,name:"xhttpMode"})||N("xhttpMode")||"auto",B=f!=="http"&&f!=="socks",O=c.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),G=c.exports.useMemo(()=>{const ie=[...O,...u.map(de=>de.label)].filter(Boolean);return Array.from(new Set(ie)).map(de=>({label:de,value:de}))},[O,u]);c.exports.useEffect(()=>{if(t)if(r){const ie=qp(r);T(ie)}else T(Ca())},[r,T,t]);const pe=c.exports.useCallback((ie,D)=>n(C,{children:[e(_,{children:D}),e(xt,{control:S,name:`sockopt.${ie}`,render:({field:de})=>{const ze=typeof de.value=="number"||typeof de.value=="string"?de.value:void 0;return e(xn,{min:0,value:ze!=null?ze:"",onChange:Ge=>de.onChange(Ge),children:e(Sn,{})})}})]}),[S]),k=c.exports.useCallback((ie,D)=>n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:D}),e(xt,{control:S,name:`sockopt.${ie}`,render:({field:de})=>e(bt,{isChecked:typeof de.value=="boolean"?de.value:Boolean(de.value),onChange:ze=>de.onChange(ze.target.checked)})})]}),[S]),I=c.exports.useCallback((ie,D,de)=>n(C,{children:[e(_,{children:D}),e(at,{...y(`sockopt.${ie}`),placeholder:de})]}),[y]),U=f==="vless"||f==="trojan",Y=Oe("gray.200","gray.700"),Ie=async ie=>{await a(ie)},Se=c.exports.useCallback(()=>{try{const{privateKey:ie}=Oi();x.setValue("realityPrivateKey",No(ie),{shouldDirty:!0})}catch(ie){d({status:"error",title:o("inbounds.reality.generateError","Unable to generate key pair"),description:ie instanceof Error?ie.message:void 0})}},[x,d,o]),He=c.exports.useCallback(()=>{try{const ie=typeof window>"u"?void 0:window.crypto;if(!(ie!=null&&ie.getRandomValues))throw new Error("Crypto API is not available in this environment.");const D=new Uint8Array(4);ie.getRandomValues(D);const de=Array.from(D).map(tt=>tt.toString(16).padStart(2,"0")).join(""),Ge=(x.getValues("realityShortIds")||"").split(/[\s,]+/).map(tt=>tt.trim()).filter(Boolean);Ge.push(de),x.setValue("realityShortIds",Ge.join(`
`),{shouldDirty:!0})}catch(ie){d({status:"error",title:o("inbounds.reality.shortIdError","Unable to generate short ID"),description:ie instanceof Error?ie.message:void 0})}},[x,d,o]),R=c.exports.useMemo(()=>{const ie=tm(Te);if(!ie)return"";try{const{publicKey:D}=Oi(ie);return No(D)}catch{return""}},[Te]),re=()=>he({dest:"",path:"",type:"",alpn:"",xver:""}),H=c.exports.useCallback(async()=>{var ie;g(!0);try{const D=await em(),de=(ie=D==null?void 0:D.auths)!=null?ie:[];return m(de),de}catch(D){return console.error(D),d({status:"error",title:o("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{g(!1)}},[d,o]),ge=c.exports.useCallback(async()=>u.length?u:H(),[H,u]),dt=c.exports.useCallback((ie,D)=>{var ze,Ge;const de=D.find(tt=>tt.label===ie);if(!de){d({status:"warning",title:o("inbounds.vless.authNotFound","Authentication block not available")});return}x.setValue("vlessDecryption",(ze=de.decryption)!=null?ze:"",{shouldDirty:!0}),x.setValue("vlessEncryption",(Ge=de.encryption)!=null?Ge:"",{shouldDirty:!0})},[x,o,d]),lt=c.exports.useCallback(async ie=>{if(!ie){x.setValue("vlessDecryption","",{shouldDirty:!0}),x.setValue("vlessEncryption","",{shouldDirty:!0});return}const D=await ge();D.length&&dt(ie,D)},[dt,ge,x]),st=c.exports.useCallback(async()=>{const ie=x.getValues("vlessSelectedAuth");if(!ie){d({status:"info",title:o("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const D=await H();D.length&&dt(ie,D)},[dt,H,x,o,d]),ve=c.exports.useCallback(()=>{x.setValue("vlessSelectedAuth","",{shouldDirty:!0}),x.setValue("vlessDecryption","",{shouldDirty:!0}),x.setValue("vlessEncryption","",{shouldDirty:!0})},[x]);return c.exports.useEffect(()=>{t&&f==="vless"&&ge()},[f,ge,t]),n(Lt,{isOpen:t,onClose:i,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(kt,{}),n(Ot,{maxW:{base:"95vw",md:"4xl"},children:[e(At,{children:s==="create"?o("inbounds.add","Add inbound"):o("inbounds.edit","Edit inbound")}),e(Wt,{}),e(Ct,{children:n(me,{align:"stretch",spacing:6,children:[n(ye,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{isRequired:!0,children:[e(_,{children:o("inbounds.tag","Tag")}),e(at,{...y("tag",{required:!0}),isDisabled:s==="edit"})]}),n(C,{children:[e(_,{children:o("inbounds.listen","Listen address")}),e(at,{placeholder:"0.0.0.0",...y("listen")})]})]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{isRequired:!0,children:[e(_,{children:o("inbounds.port","Port")}),e(at,{placeholder:"443",...y("port",{required:!0})})]}),n(C,{isRequired:!0,children:[e(_,{children:o("inbounds.protocol","Protocol")}),e(Qn,{...y("protocol",{required:!0}),isDisabled:s==="edit",children:Ha.map(ie=>e("option",{value:ie,children:ie.toUpperCase()},ie))})]})]}),f==="vmess"&&n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(bt,{...y("disableInsecureEncryption")})]}),f==="shadowsocks"&&n(C,{children:[e(_,{children:o("inbounds.shadowsocks.network","Allowed networks")}),e(at,{...y("shadowsocksNetwork")})]}),f==="vless"&&n(ye,{spacing:3,children:[e(xt,{control:S,name:"vlessSelectedAuth",render:({field:ie})=>n(C,{children:[e(_,{children:o("inbounds.vless.authentication","Authentication")}),n(rt,{placeholder:o("inbounds.vless.authPlaceholder","Select authentication"),value:ie.value||"",onChange:async D=>{const de=D.target.value;ie.onChange(de),await lt(de)},children:[e("option",{value:"",children:o("common.none","None")}),G.map(D=>e("option",{value:D.value,children:D.label},D.value))]})]})}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:o("inbounds.vless.decryption","Decryption")}),e(at,{...y("vlessDecryption")})]}),n(C,{children:[e(_,{children:o("inbounds.vless.encryption","Encryption")}),e(at,{...y("vlessEncryption")})]})]}),n(M,{spacing:3,children:[e(L,{size:"sm",onClick:st,isLoading:p,isDisabled:!K,children:o("inbounds.vless.getKeys","Get new keys")}),e(L,{size:"sm",variant:"ghost",onClick:ve,children:o("inbounds.vless.clearKeys","Clear")})]})]}),f==="http"&&n(ye,{spacing:3,children:[n(gt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("inbounds.http.accounts","HTTP accounts")}),e(L,{size:"xs",onClick:()=>P({user:"",pass:""}),children:o("inbounds.accounts.add","Add account")})]}),n(ye,{spacing:3,children:[F.map((ie,D)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:Y,p:3,children:[n(gt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[o("inbounds.accounts.label","Account")," #",D+1]}),e(L,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>j(D),children:o("hostsPage.delete","Delete")})]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("username","Username")}),e(at,{...y(`httpAccounts.${D}.user`)})]}),n(C,{children:[e(_,{children:o("password","Password")}),e(at,{...y(`httpAccounts.${D}.pass`)})]})]})]},ie.id)),!F.length&&e(h,{fontSize:"sm",color:"gray.500",children:o("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.http.allowTransparent","Allow transparent proxy")}),e(bt,{...y("httpAllowTransparent")})]})]}),f==="socks"&&n(ye,{spacing:3,children:[n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.socks.udp","Enable UDP")}),e(bt,{...y("socksUdpEnabled")})]}),_e&&n(C,{children:[e(_,{children:o("inbounds.socks.udpIp","UDP bind IP")}),e(at,{...y("socksUdpIp"),placeholder:"127.0.0.1"})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.socks.auth","Require authentication")}),e(xt,{control:S,name:"socksAuth",render:({field:ie})=>e(bt,{isChecked:ie.value==="password",onChange:D=>ie.onChange(D.target.checked?"password":"noauth")})})]}),ee==="password"&&n(ye,{spacing:3,children:[n(gt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("inbounds.socks.accounts","SOCKS accounts")}),e(L,{size:"xs",onClick:()=>le({user:"",pass:""}),children:o("inbounds.accounts.add","Add account")})]}),q.map((ie,D)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:Y,p:3,children:[n(gt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[o("inbounds.accounts.label","Account")," #",D+1]}),e(L,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>V(D),children:o("hostsPage.delete","Delete")})]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("username","Username")}),e(at,{...y(`socksAccounts.${D}.user`)})]}),n(C,{children:[e(_,{children:o("password","Password")}),e(at,{...y(`socksAccounts.${D}.pass`)})]})]})]},ie.id)),!q.length&&e(h,{fontSize:"sm",color:"gray.500",children:o("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),B&&n(ye,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:o("inbounds.network","Network")}),e(Qn,{...y("streamNetwork"),children:Bp.map(ie=>e("option",{value:ie,children:ie},ie))})]}),n(C,{children:[e(_,{children:o("inbounds.security","Security")}),e(Qn,{...y("streamSecurity"),children:Vp.map(ie=>e("option",{value:ie,children:ie},ie))})]})]}),te==="ws"&&n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:o("inbounds.ws.path","WebSocket path")}),e(at,{...y("wsPath"),placeholder:"/ws"})]}),n(C,{children:[e(_,{children:o("inbounds.ws.host","WebSocket host header")}),e(at,{...y("wsHost")})]})]}),te==="tcp"&&n(ye,{spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.tcp.headerType","TCP header type")}),n(Qn,{...y("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),Ne==="http"&&n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.tcp.host","HTTP host list")}),e(ei,{...y("tcpHttpHosts"),placeholder:"example.com"})]}),n(C,{children:[e(_,{children:o("inbounds.tcp.path","HTTP path")}),e(at,{...y("tcpHttpPath")})]})]})]}),te==="grpc"&&n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.grpc.serviceName","Service name")}),e(at,{...y("grpcServiceName")})]}),n(C,{children:[e(_,{children:o("inbounds.grpc.authority","Authority")}),e(at,{...y("grpcAuthority")})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.grpc.multiMode","Multi mode")}),e(bt,{...y("grpcMultiMode")})]})]}),te==="kcp"&&n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.kcp.headerType","mKCP header")}),e(at,{...y("kcpHeaderType")})]}),n(C,{children:[e(_,{children:o("inbounds.kcp.seed","mKCP seed")}),e(at,{...y("kcpSeed")})]})]}),te==="quic"&&n(Le,{columns:{base:1,md:3},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.quic.security","QUIC security")}),e(at,{...y("quicSecurity")})]}),n(C,{children:[e(_,{children:o("inbounds.quic.key","QUIC key")}),e(at,{...y("quicKey")})]}),n(C,{children:[e(_,{children:o("inbounds.quic.headerType","QUIC header type")}),e(at,{...y("quicHeaderType")})]})]}),te==="httpupgrade"&&n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.httpUpgrade.path","Path")}),e(at,{...y("httpupgradePath")})]}),n(C,{children:[e(_,{children:o("inbounds.httpUpgrade.host","Host")}),e(at,{...y("httpupgradeHost")})]})]}),te==="splithttp"&&n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.splitHttp.path","Path")}),e(at,{...y("splithttpPath")})]}),n(C,{children:[e(_,{children:o("inbounds.splitHttp.host","Host")}),e(at,{...y("splithttpHost")})]})]}),te==="xhttp"&&n(ye,{spacing:3,children:[n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.xhttp.host","Host")}),e(at,{...y("xhttpHost"),placeholder:"example.com"})]}),n(C,{children:[e(_,{children:o("inbounds.xhttp.path","Path")}),e(at,{...y("xhttpPath"),placeholder:"/"})]})]}),n(ye,{spacing:2,children:[n(gt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("inbounds.xhttp.headers","Custom headers")}),e(L,{size:"xs",onClick:()=>A({name:"",value:""}),children:o("inbounds.accounts.add","Add")})]}),ce.map((ie,D)=>n(M,{spacing:2,align:"flex-start",children:[e(C,{children:e(at,{...y(`xhttpHeaders.${D}.name`),placeholder:o("inbounds.xhttp.headerName","Header name")})}),e(C,{children:e(at,{...y(`xhttpHeaders.${D}.value`),placeholder:o("inbounds.xhttp.headerValue","Header value")})}),e(L,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>be(D),children:o("hostsPage.delete","Delete")})]},ie.id))]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.xhttp.mode","Mode")}),e(Qn,{...y("xhttpMode"),children:im.map(ie=>e("option",{value:ie,children:ie},ie))})]}),n(C,{children:[e(_,{children:o("inbounds.xhttp.paddingBytes","Padding bytes")}),e(at,{...y("xhttpPaddingBytes"),placeholder:"100-1000"})]})]}),xe==="packet-up"&&n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.xhttp.maxBuffered","Max buffered upload")}),e(at,{...y("xhttpScMaxBufferedPosts"),placeholder:"30"})]}),n(C,{children:[e(_,{children:o("inbounds.xhttp.maxUploadBytes","Max upload size (bytes)")}),e(at,{...y("xhttpScMaxEachPostBytes"),placeholder:"1000000"})]})]}),xe==="stream-up"&&n(C,{children:[e(_,{children:o("inbounds.xhttp.streamUp","Stream-up server seconds")}),e(at,{...y("xhttpScStreamUpServerSecs"),placeholder:"20-80"})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.xhttp.noSSE","Disable SSE header")}),e(bt,{...y("xhttpNoSSEHeader")})]})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.sockopt.enable","Enable sockopt")}),e(xt,{control:S,name:"sockoptEnabled",render:({field:ie})=>e(bt,{isChecked:Boolean(ie.value),onChange:D=>ie.onChange(D.target.checked)})})]}),e(Cs,{in:Boolean($),animateOpacity:!0,children:n(ye,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"md",p:4,mt:2,children:[n(Le,{columns:{base:1,md:2},spacing:3,children:[pe("mark",o("inbounds.sockopt.routeMark","Route mark")),pe("tcpKeepAliveInterval",o("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),pe("tcpKeepAliveIdle",o("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),pe("tcpMaxSeg",o("inbounds.sockopt.tcpMaxSeg","TCP max segment")),pe("tcpUserTimeout",o("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),pe("tcpWindowClamp",o("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[I("dialerProxy",o("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),I("interfaceName",o("inbounds.sockopt.interfaceName","Interface name"))]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.sockopt.domainStrategy","Domain strategy")}),e(xt,{control:S,name:"sockopt.domainStrategy",render:({field:ie})=>n(rt,{...ie,children:[e("option",{value:"",children:o("common.none","None")}),rm.map(D=>e("option",{value:D,children:D},D))]})})]}),n(C,{children:[e(_,{children:o("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(xt,{control:S,name:"sockopt.tcpcongestion",render:({field:ie})=>n(rt,{...ie,children:[e("option",{value:"",children:o("common.none","None")}),nm.map(D=>e("option",{value:D,children:D},D))]})})]}),n(C,{children:[e(_,{children:o("inbounds.sockopt.tproxy","TProxy")}),e(xt,{control:S,name:"sockopt.tproxy",render:({field:ie})=>e(rt,{...ie,children:sm.map(D=>e("option",{value:D,children:D},D))})})]})]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[k("acceptProxyProtocol",o("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),k("tcpFastOpen",o("inbounds.sockopt.tcpFastOpen","TCP fast open")),k("tcpMptcp",o("inbounds.sockopt.tcpMptcp","Multipath TCP")),k("penetrate",o("inbounds.sockopt.penetrate","Penetrate")),k("V6Only",o("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),J==="tls"&&n(ye,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(C,{children:[e(_,{children:o("inbounds.tls.serverName","Server name (SNI)")}),e(at,{...y("tlsServerName"),placeholder:"example.com"})]}),n(C,{children:[e(_,{children:o("inbounds.tls.fingerprint","uTLS fingerprint")}),n(Qn,{...y("tlsFingerprint"),children:[e("option",{value:"",children:o("common.none","None")}),Hp.map(ie=>e("option",{value:ie,children:ie},ie))]})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.tls.allowInsecure","Allow insecure")}),e(bt,{...y("tlsAllowInsecure")})]})]}),J==="reality"&&n(ye,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(C,{isRequired:!0,children:[e(_,{children:o("inbounds.reality.privateKey","Reality private key")}),e(ei,{rows:3,...y("realityPrivateKey",{required:!0})}),e(L,{size:"xs",mt:2,variant:"outline",onClick:Se,alignSelf:"flex-start",children:o("inbounds.reality.generateKeys","Generate key pair")})]}),n(C,{children:[e(_,{children:o("inbounds.reality.publicKey","Reality public key")}),e(at,{value:R,isReadOnly:!0,placeholder:o("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:o("inbounds.reality.serverNames","Server names")}),e(ei,{rows:2,...y("realityServerNames"),placeholder:"domain.com"}),e(z,{fontSize:"sm",color:"gray.500",children:o("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),n(C,{children:[e(_,{children:o("inbounds.reality.dest","Destination (host:port)")}),e(at,{...y("realityDest"),placeholder:"example.com:443"})]})]}),n(C,{children:[e(_,{children:o("inbounds.reality.shortIds","Short IDs")}),e(ei,{rows:2,...y("realityShortIds")}),e(L,{size:"xs",mt:2,variant:"outline",onClick:He,alignSelf:"flex-start",children:o("inbounds.reality.generateShortId","Generate short ID")}),e(z,{fontSize:"sm",color:"gray.500",children:o("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:o("inbounds.reality.spiderX","SpiderX")}),e(at,{...y("realitySpiderX")})]}),n(C,{children:[e(_,{children:o("inbounds.reality.xver","Xver")}),e(at,{...y("realityXver")})]})]})]}),U&&n(ye,{spacing:3,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(gt,{align:"center",justify:"space-between",children:[e(z,{fontWeight:"medium",children:o("inbounds.fallbacks","Fallbacks")}),e(L,{size:"xs",onClick:re,children:o("inbounds.fallbacks.add","Add fallback")})]}),W.length===0?e(h,{fontSize:"sm",color:"gray.500",children:o("inbounds.fallbacks.empty","No fallbacks configured yet.")}):W.map((ie,D)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:Y,p:3,children:[n(gt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[o("inbounds.fallbacks.type","Fallback")," #",D+1]}),e(L,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>E(D),children:o("hostsPage.delete","Delete")})]}),n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.fallbacks.dest","Destination (host:port)")}),e(at,{placeholder:"example.com:443",...y(`fallbacks.${D}.dest`)})]}),n(C,{children:[e(_,{children:o("inbounds.fallbacks.path","Path")}),e(at,{...y(`fallbacks.${D}.path`),placeholder:"/"})]}),n(C,{children:[e(_,{children:o("inbounds.fallbacks.type","Type")}),e(at,{...y(`fallbacks.${D}.type`),placeholder:"none"})]}),n(C,{children:[e(_,{children:o("inbounds.fallbacks.alpn","ALPN")}),e(at,{...y(`fallbacks.${D}.alpn`),placeholder:"h2,http/1.1"})]}),n(C,{children:[e(_,{children:"Xver"}),e(at,{...y(`fallbacks.${D}.xver`),placeholder:"0"})]})]})]},ie.id))]}),n(ye,{spacing:4,borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(gt,{align:"center",justify:"space-between",children:[n(M,{spacing:2,children:[e(z,{fontWeight:"medium",children:o("inbounds.sniffing","Sniffing")}),e(ft,{label:o("inbounds.sniffingHint","It is recommended to keep the default."),children:e(xl,{width:16,height:16})})]}),e(bt,{...y("sniffingEnabled")})]}),we&&n(ye,{spacing:3,children:[n(C,{children:[e(_,{children:o("inbounds.sniffingDestinations","Protocols to sniff")}),e(xt,{control:S,name:"sniffingDestinations",render:({field:ie})=>{var D;return e(zi,{value:(D=ie.value)!=null?D:[],onChange:ie.onChange,children:e(M,{spacing:4,children:Fp.map(de=>e(wr,{value:de.value,children:de.label},de.value))})})}})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.sniffingRouteOnly","Route only")}),e(bt,{...y("sniffingRouteOnly")})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("inbounds.sniffingMetadataOnly","Metadata only")}),e(bt,{...y("sniffingMetadataOnly")})]})]})]})]})}),n(Ut,{children:[e(L,{variant:"ghost",mr:3,onClick:i,children:o("hostsPage.cancel","Cancel")}),e(L,{colorScheme:"primary",isLoading:l,onClick:v(Ie),children:s==="create"?o("common.create","Create"):o("common.save","Save")})]})]})]})},om=()=>{const{t}=Ke(),s=Zt(),[r,l]=c.exports.useState([]),[i,a]=c.exports.useState(!0),[o,d]=c.exports.useState(!1),[u,m]=c.exports.useState(null),[p,g]=c.exports.useState({protocol:"all",search:""}),[x,S]=c.exports.useState(null),{isOpen:y,onOpen:v,onClose:T}=Qt(),[N,W]=c.exports.useState("create"),he=Ur({base:!1,md:!0}),E=c.exports.useCallback(()=>{a(!0),m(null),Ee("/inbounds/full").then(V=>{l(V||[])}).catch(()=>{m(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>a(!1))},[t]);c.exports.useEffect(()=>{E()},[E]);const F=c.exports.useMemo(()=>{const V=p.search.trim().toLowerCase();return r.filter(ce=>{var A;return p.protocol!=="all"&&ce.protocol!==p.protocol?!1:V?ce.tag.toLowerCase().includes(V)||((A=ce.port)==null?void 0:A.toString().includes(V)):!0})},[r,p]),P=()=>{W("create"),S(null),v()},j=V=>{W("edit"),S(V),v()},q=async V=>{var ce;d(!0);try{const A=Xp(V),be=N==="create"?"/inbounds":`/inbounds/${encodeURIComponent(A.tag)}`;await Ee(be,{method:N==="create"?"POST":"PUT",body:A}),s({status:"success",title:N==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),ui(),await E(),T()}catch(A){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((ce=A==null?void 0:A.data)==null?void 0:ce.detail)||(A==null?void 0:A.message)})}finally{d(!1)}},le=async V=>{var A;const ce=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:V.tag});if(!!window.confirm(ce)){d(!0);try{await Ee(`/inbounds/${encodeURIComponent(V.tag)}`,{method:"DELETE"}),s({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),ui(),await E()}catch(be){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((A=be==null?void 0:be.data)==null?void 0:A.detail)||(be==null?void 0:be.message)})}finally{d(!1)}}};return n(ye,{spacing:4,children:[n(gt,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(De,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:p.search,onChange:V=>g(ce=>({...ce,search:V.target.value}))}),n(M,{spacing:3,children:[n(rt,{width:"180px",value:p.protocol,onChange:V=>g(ce=>({...ce,protocol:V.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),Ha.map(V=>e("option",{value:V,children:V.toUpperCase()},V))]}),e(L,{leftIcon:e(Nn,{width:18,height:18}),onClick:P,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&n(zr,{status:"error",children:[e(Rr,{}),u]}),i?e(gt,{justify:"center",py:10,children:e(Et,{})}):F.length===0?e(z,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):he?e(z,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:n(rs,{variant:"simple",size:"sm",children:[e(bn,{bg:"gray.50",_dark:{bg:"gray.900"},children:n(Rt,{children:[e($e,{children:t("inbounds.tag","Tag")}),e($e,{children:t("inbounds.protocol","Protocol")}),e($e,{children:t("inbounds.portLabel","Port")}),e($e,{children:t("inbounds.network","Network")}),e($e,{children:t("inbounds.security","Security")}),e($e,{children:t("inbounds.sniffing","Sniffing")}),e($e,{width:"120px",children:t("actions","Actions")})]})}),e(on,{children:F.map(V=>{var A;const ce=V.streamSettings||{};return n(Rt,{children:[n(Ue,{children:[e(h,{fontWeight:"semibold",children:V.tag}),V.listen&&e(h,{fontSize:"sm",color:"gray.500",children:V.listen})]}),e(Ue,{children:e(ut,{colorScheme:"purple",children:V.protocol})}),e(Ue,{children:V.port}),e(Ue,{children:ce.network||"\u2014"}),e(Ue,{children:ce.security&&ce.security!=="none"?e(ut,{colorScheme:"blue",children:ce.security}):"\u2014"}),e(Ue,{children:(A=V.sniffing)!=null&&A.enabled?e(ut,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(ut,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Ue,{children:n(M,{spacing:2,children:[e(We,{"aria-label":t("common.edit","Edit"),icon:e(Bn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>j(V)}),e(We,{"aria-label":t("common.delete","Delete"),icon:e(wn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>le(V),isLoading:o})]})})]},V.tag)})})]})}):e(ye,{spacing:3,children:F.map(V=>{var A;const ce=V.streamSettings||{};return n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(gt,{justify:"space-between",align:"center",mb:2,children:[n(z,{children:[e(h,{fontWeight:"semibold",children:V.tag}),n(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",V.port]})]}),n(M,{spacing:2,children:[e(We,{"aria-label":t("common.edit","Edit"),icon:e(Bn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>j(V)}),e(We,{"aria-label":t("common.delete","Delete"),icon:e(wn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>le(V),isLoading:o})]})]}),n(ye,{spacing:2,children:[n(M,{spacing:2,wrap:"wrap",children:[e(ut,{colorScheme:"purple",children:V.protocol}),ce.network&&e(ut,{children:ce.network}),ce.security&&ce.security!=="none"&&e(ut,{colorScheme:"blue",children:ce.security})]}),n(M,{spacing:2,wrap:"wrap",children:[(A=V.sniffing)!=null&&A.enabled?e(ut,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(ut,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),V.listen&&e(ut,{size:"sm",colorScheme:"gray",children:V.listen})]})]})]},V.tag)})}),e(am,{isOpen:y,mode:N,initialValue:x,isSubmitting:o,onClose:T,onSubmit:q})]})},lm=()=>{var i;const{t}=Ke(),{userData:s,getUserIsSuccess:r}=hr();return r&&Boolean((i=s.permissions)==null?void 0:i.sections.hosts)?n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),n(ls,{colorScheme:"primary",isLazy:!0,children:[n(cs,{children:[e(er,{children:n(M,{spacing:2,children:[e(ri,{as:wl,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(er,{children:n(M,{spacing:2,children:[e(ri,{as:cl,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),n(ds,{children:[e(tr,{px:0,children:n(me,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(om,{})]})}),e(tr,{px:0,children:n(me,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Rp,{})]})})]})]})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("hostsPage.noPermission","You do not have permission to manage host or inbound settings.")})]})},cm=Ce.object({name:Ce.string().min(1),address:Ce.string().min(1),port:Ce.number().min(1).or(Ce.string().transform(t=>parseFloat(t))),api_port:Ce.number().min(1).or(Ce.string().transform(t=>parseFloat(t))),xray_version:Ce.string().nullable().optional(),node_service_version:Ce.string().nullable().optional(),id:Ce.number().nullable().optional(),status:Ce.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:Ce.string().nullable().optional(),add_as_new_host:Ce.boolean().optional(),usage_coefficient:Ce.number().or(Ce.string().transform(t=>parseFloat(t))),data_limit:Ce.number().nullable().optional(),uplink:Ce.number().nullable().optional(),downlink:Ce.number().nullable().optional(),use_nobetci:Ce.boolean().optional(),nobetci_port:Ce.number().nullable().optional()}),_i=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",node_service_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,nobetci_port:null}),Tr="fetch-nodes-query-key",Ba=()=>{const{isEditingNodes:t}=Tt();return Or({queryKey:Tr,queryFn:vi.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},vi=Ns((t,s)=>({nodes:[],addNode(r){return Ee("/node",{method:"POST",body:r})},fetchNodes(){return Ee("/nodes")},fetchNodesUsage(r){return Ee("/nodes/usage",{query:r})},updateNode(r){return Ee(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return Ee(`/node/${r.id}/reconnect`,{method:"POST"})},restartNodeService(r){return Ee(`/node/${r.id}/service/restart`,{method:"POST"})},updateNodeService(r){return Ee(`/node/${r.id}/service/update`,{method:"POST"})},resetNodeUsage(r){return Ee(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return Ee("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return Ee("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return Ee(`/node/${(r=s().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),zo=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:i})=>{const{t:a}=Ke(),o=$i(t),d=ts[s].icon;return n(Bt,{children:[n($r,{colorScheme:ts[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(d,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[s&&a(`nodeModal.status.${s}`),i&&`: ${i}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(o.status,{time:o.time})})]})},dm=oe(oi,{baseStyle:{w:4,h:4}}),um=oe(Ra,{baseStyle:{w:4,h:4}}),hm=oe(Sd,{baseStyle:{w:4,h:4}}),pm=oe(za,{baseStyle:{w:4,h:4}}),Ro=1024*1024*1024,mm=51031,Gn=t=>{if(t&&typeof t=="object"&&"message"in t){const s=t.message;return typeof s=="string"?s:void 0}},Uo=({isOpen:t,onClose:s,node:r,mutate:l,isLoading:i,isAddMode:a=!1})=>{var be,f,te,J,we,Te,Ne,$,K,ee,_e,xe,B,O,G,pe,k;const{t:o}=Ke(),d=Zt(),[u,m]=c.exports.useState(a),{fetchNodesUsage:p}=vi(),[g,x]=c.exports.useState(null),{data:S,isLoading:y}=Or({queryKey:"node-settings",queryFn:()=>Ee("/node/settings")}),{data:v}=Or({queryKey:"panel-settings",queryFn:Fa,staleTime:5*60*1e3}),T=(be=v==null?void 0:v.use_nobetci)!=null?be:!0,N=I=>{if(I==null)return null;const U=I/Ro;return Number.isFinite(U)?Math.round(U*100)/100:null},W=I=>I==null?null:Math.round(I*Ro),he=a?{..._i(),add_as_new_host:!1}:{..._i(),...r,add_as_new_host:!1},E=en({resolver:Fi(cm),defaultValues:{...he,data_limit:N((f=he.data_limit)!=null?f:null)}}),F=(te=S==null?void 0:S.certificate)!=null?te:"",{onCopy:P,hasCopied:j}=Pl(F),q=E.watch("use_nobetci");c.exports.useEffect(()=>{if(!T||!q){E.getValues("nobetci_port")!==null&&E.setValue("nobetci_port",null);return}const I=E.getValues("nobetci_port");(I==null||I==="")&&E.setValue("nobetci_port",mm)},[q,E,T]),c.exports.useEffect(()=>{v&&!v.use_nobetci&&(E.getValues("use_nobetci")&&E.setValue("use_nobetci",!1),E.getValues("nobetci_port")!==null&&E.setValue("nobetci_port",null))},[v,E]),c.exports.useEffect(()=>{var I;if(t){const U=a?{..._i(),add_as_new_host:!1}:{..._i(),...r,add_as_new_host:!1};E.reset({...U,data_limit:N((I=U.data_limit)!=null?I:null)}),m(a&&!!F)}},[t,a,r,E,F]),c.exports.useEffect(()=>{!a&&r&&t?p({start:Re().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(I=>{const U=I.usages[r.id];U&&x({uplink:U.uplink,downlink:U.downlink})}):x(null)},[r,a,t,p]);const le=E.handleSubmit(I=>{var Y;const U={...I,data_limit:W((Y=I.data_limit)!=null?Y:null)};l(U)}),V=()=>{!F||(P(),d({title:o("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},ce=()=>{if(!F)return;const I=new Blob([F],{type:"text/plain"}),U=URL.createObjectURL(I),Y=document.createElement("a");Y.href=U,Y.download="ssl_client_cert.pem",Y.click(),URL.revokeObjectURL(U)},A=()=>{m(!1),x(null),s()};return n(Lt,{isOpen:t,onClose:A,size:"lg",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",as:"form",onSubmit:le,children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:o(a?"nodes.addNewRebeccaNode":"nodes.editNode")})}),e(Wt,{mt:3}),e(Ct,{children:n(ye,{spacing:6,children:[!a&&g&&n(ye,{spacing:2,children:[e(h,{fontWeight:"medium",children:o("nodes.usage")}),n(M,{children:[n(ut,{colorScheme:"green",children:[o("nodes.uplink"),": ",Zn.sizeFormat(g.uplink)]}),n(ut,{colorScheme:"blue",children:[o("nodes.downlink"),": ",Zn.sizeFormat(g.downlink)]})]})]}),a&&n(ye,{spacing:3,children:[n(M,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("nodes.certificate")}),n(M,{spacing:2,children:[e(L,{size:"xs",variant:"outline",leftIcon:e(hm,{}),onClick:V,isDisabled:!F,children:o(j?"copied":"copy")}),e(L,{size:"xs",variant:"outline",leftIcon:e(pm,{}),onClick:ce,isDisabled:!F,children:o("nodes.download-certificate")}),e(ft,{placement:"top",label:o(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(We,{"aria-label":o(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>m(I=>!I),size:"xs",variant:"ghost",children:u?e(um,{}):e(dm,{})})})]})]}),e(Cs,{in:u&&!!F,animateOpacity:!0,children:e(z,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:F||(y?o("loading"):"")})}),!F&&!y&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.certificateUnavailable","Certificate not available.")})]}),n(ye,{spacing:4,children:[n(Le,{columns:{base:1,md:2},spacing:4,children:[e(C,{children:e(ur,{label:o("nodes.nodeName"),size:"sm",placeholder:"Rebecca-S2",...E.register("name"),error:Gn((we=(J=E.formState)==null?void 0:J.errors)==null?void 0:we.name)})}),e(C,{children:e(ur,{label:o("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...E.register("address"),error:Gn((Ne=(Te=E.formState)==null?void 0:Te.errors)==null?void 0:Ne.address)})})]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[e(C,{children:e(ur,{label:o("nodes.nodePort"),size:"sm",placeholder:"62050",...E.register("port"),error:Gn((K=($=E.formState)==null?void 0:$.errors)==null?void 0:K.port)})}),e(C,{children:e(ur,{label:o("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...E.register("api_port"),error:Gn((_e=(ee=E.formState)==null?void 0:ee.errors)==null?void 0:_e.api_port)})})]}),e(C,{children:e(ur,{label:o("nodes.usageCoefficient"),size:"sm",placeholder:"1",...E.register("usage_coefficient"),error:Gn((B=(xe=E.formState)==null?void 0:xe.errors)==null?void 0:B.usage_coefficient)})}),n(C,{children:[e(ur,{label:o("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:o("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...E.register("data_limit",{setValueAs:I=>{if(I===""||I===null||I===void 0)return null;const U=Number(I);return Number.isFinite(U)?U:Number.NaN},validate:I=>I==null?!0:Number.isNaN(I)?o("nodes.dataLimitValidation","Data limit must be a valid number"):I>=0||o("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:Gn((G=(O=E.formState)==null?void 0:O.errors)==null?void 0:G.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:o("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),T&&n(Bt,{children:[n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:o("nodes.useNobetci","Enable Nobetci integration")}),e(xt,{control:E.control,name:"use_nobetci",render:({field:I})=>e(bt,{isChecked:Boolean(I.value),onChange:U=>I.onChange(U.target.checked)})})]}),e(Cs,{in:Boolean(q),animateOpacity:!0,children:n(C,{mt:q?2:0,children:[e(ur,{label:o("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...E.register("nobetci_port",{setValueAs:I=>{if(I===""||I===null||I===void 0)return null;const U=Number(I);return Number.isFinite(U)?U:Number.NaN},validate:I=>q?I==null?o("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(I)?o("nodes.nobetciPortInvalid","Enter a valid port number"):I>=1&&I<=65535?!0:o("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:Gn((k=(pe=E.formState)==null?void 0:pe.errors)==null?void 0:k.nobetci_port)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:o("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]})]}),a&&e(z,{children:e(wr,{...E.register("add_as_new_host"),children:o("nodes.addHostForEveryInbound")})})]})}),n(Ut,{gap:3,children:[e(L,{variant:"outline",onClick:A,children:o("cancel")}),e(L,{type:"submit",colorScheme:"primary",isLoading:i,children:o(a?"nodes.addNode":"nodes.editNode")})]})]})]})},gm=({deleteCallback:t})=>{const{deleteNode:s,deletingNode:r,setDeletingNode:l}=vi(),{t:i}=Ke(),a=Zt(),o=Oa(),d=()=>{l(null)},{isLoading:u,mutate:m}=Hr(s,{onSuccess:()=>{Xt(i("deleteNode.deleteSuccess",{name:r&&r.name}),a),l(null),o.invalidateQueries(Tr),t&&t()},onError:p=>{Gt(p,a)}});return n(Lt,{isCentered:!0,isOpen:!!r,onClose:d,size:"sm",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",children:[e(At,{pt:6,children:e(ns,{color:"red",children:e(bi,{})})}),e(Wt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:i("deleteNode.prompt",{name:r.name})})})]}),n(Ut,{display:"flex",children:[e(L,{size:"sm",onClick:d,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(L,{size:"sm",w:"full",colorScheme:"red",onClick:()=>m(),leftIcon:u?e(Et,{size:"xs"}):void 0,children:i("delete")})]})]})]})},fm=10,bm=({isOpen:t,title:s,description:r,currentVersion:l,allowPersist:i=!1,isSubmitting:a,onSubmit:o,onClose:d})=>{const{t:u}=Ke(),[m,p]=c.exports.useState(""),[g,x]=c.exports.useState(!1),[S,y]=c.exports.useState(null),v=Or(["core-xray-releases"],()=>Ee("/core/xray/releases",{query:{limit:fm}}),{enabled:t,staleTime:5*60*1e3});c.exports.useEffect(()=>{t&&(p(l||""),x(!1),y(null))},[t,l]);const T=c.exports.useMemo(()=>{var F,P;return(P=(F=v.data)==null?void 0:F.tags)!=null?P:[]},[v.data]),N=F=>{p(F.target.value)},W=F=>{p(F.target.value)},he=async()=>{if(!m){y(u("validation.required"));return}try{y(null),await o({version:m,persist:i?g:void 0})}catch(F){F instanceof Error?y(F.message):y(u("core.generalErrorMessage"))}},E=v.isLoading;return n(Lt,{isOpen:t,onClose:d,isCentered:!0,size:"lg",children:[e(kt,{}),n(Ot,{children:[e(At,{children:s}),e(Wt,{}),e(Ct,{children:n(ye,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),n(C,{children:[e(_,{children:u("nodes.coreVersionDialog.latestReleases")}),e(rt,{placeholder:u(E?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:m&&T.includes(m)?m:"",onChange:N,isDisabled:E||T.length===0,size:"sm",children:T.map(F=>e("option",{value:F,children:F},F))}),E&&n(ye,{direction:"row",align:"center",spacing:2,mt:2,children:[e(Et,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),v.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),n(C,{isRequired:!0,children:[e(_,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(De,{value:m,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:W,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),i&&e(wr,{isChecked:g,onChange:F=>x(F.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),S&&n(zr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Rr,{}),e(Hn,{children:S})]})]})}),n(Ut,{children:[e(L,{variant:"ghost",mr:3,onClick:d,children:u("cancel")}),e(L,{colorScheme:"primary",onClick:he,isLoading:a,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},Mo="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",ym=oe(Tl,{baseStyle:{w:3.5,h:3.5}}),Sm=oe(Nn,{baseStyle:{w:3.5,h:3.5}}),xm=oe(cn,{baseStyle:{w:4,h:4}}),vm=({isOpen:t,title:s,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:i,onSubmit:a,onClose:o})=>{const{t:d}=Ke(),[u,m]=c.exports.useState("template"),[p,g]=c.exports.useState(Mo),[x,S]=c.exports.useState(""),[y,v]=c.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[T,N]=c.exports.useState(!0),[W,he]=c.exports.useState(!1),[E,F]=c.exports.useState(null);c.exports.useEffect(()=>{t&&(m("template"),g(i||Mo),S(""),v([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),N(!0),he(!1),F(null))},[t,i]);const P=Or(["geo-templates",p],()=>Ee("/core/geo/templates",{query:p?{index_url:p}:void 0}),{enabled:t&&u==="template"&&Boolean(p),staleTime:10*60*1e3}),j=c.exports.useMemo(()=>{var f,te;return(te=(f=P.data)==null?void 0:f.templates)!=null?te:[]},[P.data]);c.exports.useEffect(()=>{j.length>0&&S(f=>f||j[0].name)},[j]);const q=Oe("gray.50","whiteAlpha.50"),le=()=>{v(f=>[...f,{name:"",url:""}])},V=(f,te,J)=>{v(we=>we.map((Te,Ne)=>Ne===f?{...Te,[te]:J}:Te))},ce=f=>{v(te=>te.filter((J,we)=>we!==f))},A=async()=>{const f=u==="manual"?y.filter(J=>J.name.trim()&&J.url.trim()):[];if(u==="template"){if(!p.trim()){F(d("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!x){F(d("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(f.length===0){F(d("nodes.geoDialog.errors.missingFiles"));return}if(f.find(we=>!we.name.trim()||!we.url.trim())){F(d("nodes.geoDialog.errors.invalidFile"));return}}F(null);const te=u==="manual"?f:[];try{await a({mode:u,templateIndexUrl:p.trim(),templateName:x,files:te,persistEnv:T,applyToNodes:W})}catch(J){const we=J instanceof Error?J.message:d("nodes.geoDialog.genericError");F(we)}},be=()=>n(ye,{spacing:3,bg:q,p:4,borderRadius:"md",children:[y.map((f,te)=>n(z,{borderWidth:"1px",borderRadius:"md",p:3,children:[n(Le,{columns:{base:1,md:2},spacing:3,children:[n(C,{isRequired:!0,children:[e(_,{fontSize:"sm",children:d("nodes.geoDialog.fileNameLabel")}),e(De,{size:"sm",value:f.name,placeholder:"geosite.dat",onChange:J=>V(te,"name",J.target.value)})]}),n(C,{isRequired:!0,children:[e(_,{fontSize:"sm",children:d("nodes.geoDialog.fileUrlLabel")}),e(De,{size:"sm",value:f.url,placeholder:"https://example.com/geosite.dat",onChange:J=>V(te,"url",J.target.value)})]})]}),e(M,{justify:"flex-end",mt:3,children:e(ft,{label:d("nodes.geoDialog.removeFile"),children:e(We,{"aria-label":"remove file",icon:e(ym,{}),variant:"ghost",size:"sm",onClick:()=>ce(te),isDisabled:y.length<=1})})})]},`manual-file-${te}`)),e(L,{onClick:le,leftIcon:e(Sm,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:d("nodes.geoDialog.addFile")})]});return n(Lt,{isOpen:t,onClose:o,size:"xl",isCentered:!0,children:[e(kt,{}),n(Ot,{children:[e(At,{children:s}),e(Wt,{}),e(Ct,{children:n(ye,{spacing:4,children:[n(C,{as:"fieldset",children:[e(_,{as:"legend",fontSize:"sm",children:d("nodes.geoDialog.modeLabel")}),e(ci,{value:u,onChange:f=>m(f),children:n(M,{spacing:4,children:[e(Br,{value:"template",children:d("nodes.geoDialog.modeTemplate")}),e(Br,{value:"manual",children:d("nodes.geoDialog.modeManual")})]})})]}),u==="template"?n(ye,{spacing:3,children:[n(C,{isRequired:!0,children:[e(_,{fontSize:"sm",children:d("nodes.geoDialog.templateIndexLabel")}),e(De,{size:"sm",value:p,onChange:f=>g(f.target.value)})]}),n(C,{isRequired:!0,children:[e(_,{fontSize:"sm",children:d("nodes.geoDialog.templateNameLabel")}),n(M,{align:"center",spacing:2,children:[e(rt,{size:"sm",flex:1,value:x,onChange:f=>S(f.target.value),isDisabled:P.isLoading||!j.length,placeholder:P.isLoading?d("nodes.geoDialog.loadingTemplates"):d("nodes.geoDialog.selectTemplatePlaceholder"),children:j.map(f=>e("option",{value:f.name,children:f.name},f.name))}),e(ft,{label:d("nodes.geoDialog.refreshTemplates"),children:e(We,{"aria-label":"refresh templates",icon:e(xm,{}),size:"sm",variant:"outline",onClick:()=>P.refetch(),isLoading:P.isFetching,isDisabled:!p.trim()})})]})]}),P.isError&&n(zr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Rr,{}),e(Hn,{children:d("nodes.geoDialog.failedToLoadTemplates")})]})]}):be(),l&&n(ye,{spacing:2,children:[e(wr,{isChecked:T,onChange:f=>N(f.target.checked),children:d("nodes.geoDialog.persistAssets")}),e(wr,{isChecked:W,onChange:f=>he(f.target.checked),children:d("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:d("nodes.geoDialog.applyToNodesHint")})]}),E&&n(zr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Rr,{}),e(Hn,{children:E})]})]})}),n(Ut,{children:[e(L,{variant:"ghost",mr:3,onClick:o,children:d("cancel")}),e(L,{colorScheme:"primary",onClick:A,isLoading:r,children:d("nodes.geoDialog.confirmUpdate")})]})]})]})};Re.extend(fi);const wm=oe(Nn,{baseStyle:{w:4,h:4}}),km=oe(wn,{baseStyle:{w:4,h:4}}),Cm=oe(Bn,{baseStyle:{w:4,h:4}}),Lo=oe(cn,{baseStyle:{w:4,h:4}}),_m=oe(pl,{baseStyle:{w:4,h:4}}),nc=1024**3,Dm=t=>{if(t==null)return"";const s=t/nc;return Number.isFinite(s)?(Math.round(s*100)/100).toString():""},Oo=t=>{const s=t.trim();if(!s)return null;const r=Number(s);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*nc)},Am=()=>{var Rs,Us,Ms,Ls,Os,b,w,ae,je,ct,et,Dt,Ar,qn;const{t}=Ke(),{onEditingNodes:s}=Tt(),r=Tt(ue=>ue.isEditingNodes),{data:l,isLoading:i,error:a,refetch:o,isFetching:d}=Ba(),{addNode:u,updateNode:m,reconnectNode:p,restartNodeService:g,updateNodeService:x,resetNodeUsage:S,updateMasterNode:y,resetMasterUsage:v,setDeletingNode:T}=vi(),N=Oa(),W=Zt(),{userData:he,getUserIsSuccess:E}=hr();if(!(E&&Boolean((Rs=he.permissions)==null?void 0:Rs.sections.nodes)))return n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("nodes.title","Nodes")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.noPermission","You do not have permission to manage nodes.")})]});const[P,j]=c.exports.useState(null),[q,le]=c.exports.useState(!1),[V,ce]=c.exports.useState(""),[A,be]=c.exports.useState(null),[f,te]=c.exports.useState(null),[J,we]=c.exports.useState(null),[Te,Ne]=c.exports.useState(null),[$,K]=c.exports.useState(!1),[ee,_e]=c.exports.useState(!1),[xe,B]=c.exports.useState(!1),[O,G]=c.exports.useState(null),[pe,k]=c.exports.useState({}),[I,U]=c.exports.useState(null),[Y,Ie]=c.exports.useState(null),[Se,He]=c.exports.useState(null),[R,re]=c.exports.useState(null),{isOpen:H,onOpen:ge,onClose:dt}=Qt(),lt=c.exports.useRef(null),[st,ve]=c.exports.useState(""),[Be,Je]=c.exports.useState(!1),{isOpen:se,onOpen:Ye,onClose:ie}=Qt(),D=c.exports.useRef(null),{data:de,isLoading:ze,refetch:Ge,error:tt}=Or(["core-stats"],()=>Ee("/core"),{refetchOnWindowFocus:!1}),{data:qe,isLoading:Vt,error:$t,refetch:Kt}=Or(["master-node-state"],()=>Ee("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});c.exports.useEffect(()=>(s(!0),()=>{s(!1)}),[s]),c.exports.useEffect(()=>{var yt,ot;if(!qe)return;if(Be){const wt=Oo(st),Mt=(yt=qe.data_limit)!=null?yt:null;if(wt!==Mt)return}const ue=Dm((ot=qe.data_limit)!=null?ot:null);ve(ue),Be&&Je(!1)},[qe,Be,st]);const{isLoading:Me,mutate:it}=Hr(u,{onSuccess:()=>{Xt(t("nodes.addNodeSuccess"),W),N.invalidateQueries(Tr),le(!1)},onError:ue=>{Gt(ue,W)}}),{isLoading:Jt,mutate:nr}=Hr(m,{onSuccess:()=>{Xt(t("nodes.nodeUpdated"),W),N.invalidateQueries(Tr),j(null)},onError:ue=>{Gt(ue,W)}}),{isLoading:kr,mutate:pr}=Hr(p,{onSuccess:()=>{N.invalidateQueries(Tr)}}),{mutate:gr,isLoading:fr}=Hr(m,{onSuccess:()=>{N.invalidateQueries(Tr)},onError:ue=>{Gt(ue,W)},onSettled:(ue,yt,ot)=>{(ot==null?void 0:ot.id)!=null&&k(wt=>{const Mt={...wt};return delete Mt[ot.id],Mt}),G(null)}}),{isLoading:ne,mutate:Ae}=Hr(S,{onSuccess:()=>{Xt(t("nodes.resetUsageSuccess","Node usage reset"),W),N.invalidateQueries(Tr)},onError:ue=>{Gt(ue,W)},onSettled:()=>{U(null),Ie(null),dt()}}),{mutate:Q,isLoading:Xe}=Hr(g,{onMutate:ue=>{var yt;He((yt=ue.id)!=null?yt:null)},onSuccess:()=>{Xt(t("nodes.restartServiceTriggered","Node restart requested"),W),N.invalidateQueries(Tr)},onError:ue=>{Gt(ue,W)},onSettled:()=>{He(null)}}),{mutate:_t,isLoading:qt}=Hr(x,{onMutate:ue=>{var yt;re((yt=ue.id)!=null?yt:null)},onSuccess:()=>{Xt(t("nodes.updateServiceTriggered","Node update requested"),W),N.invalidateQueries(Tr)},onError:ue=>{Gt(ue,W)},onSettled:()=>{re(null)}}),{isLoading:Nt,mutate:zt}=Hr(y,{onSuccess:()=>{Xt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),W),Kt(),Je(!1)},onError:ue=>{Gt(ue,W)}}),{isLoading:pt,mutate:mt}=Hr(v,{onSuccess:()=>{Xt(t("nodes.resetMasterUsageSuccess","Master usage reset"),W),Kt(),ie()},onError:ue=>{Gt(ue,W)}}),It=c.exports.useMemo(()=>Oo(st),[st]),ir=(Us=qe==null?void 0:qe.data_limit)!=null?Us:null,Cr=It===void 0,Kr=It!==void 0&&It!==ir,Z=ze||Vt,Pe=c.exports.useMemo(()=>{if(tt instanceof Error)return tt.message;if(typeof tt=="string")return tt;if($t instanceof Error)return $t.message;if(typeof $t=="string")return $t},[tt,$t]),Ve=(Ms=qe==null?void 0:qe.total_usage)!=null?Ms:0,Ze=(Ls=qe==null?void 0:qe.data_limit)!=null?Ls:null,vt=(Os=qe==null?void 0:qe.remaining_data)!=null?Os:null,jt=qe!=null&&qe.updated_at?Re(qe.updated_at).local().format("YYYY-MM-DD HH:mm"):null,br=(b=qe==null?void 0:qe.status)!=null?b:"error",Wr=Fe(Ve,2),mr=Ze!==null&&Ze>0?Fe(Ze,2):t("nodes.unlimited","Unlimited"),_r=vt!=null?Fe(vt,2):null,Jr=ue=>{Je(!0),ve(ue)},kn=()=>{if(Cr||It===void 0){Gt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),W);return}zt({data_limit:It!=null?It:null})},Rn=()=>{Je(!0),ve(""),zt({data_limit:null})},qr=()=>{Ye()},Dr=ue=>{if(!(ue!=null&&ue.id))return;const yt=ue.status!=="disabled",ot=yt?"disabled":"connecting",wt=ue.id;G(wt),k(Mt=>({...Mt,[wt]:!yt})),gr({...ue,status:ot})},ke=ue=>{!(ue!=null&&ue.id)||(Ie(ue),ge())},Yr=ue=>{if(!(ue!=null&&ue.id))return;const yt=ue.name||ue.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.restartServiceConfirm","Send a restart request to {{name}}? Services will be interrupted briefly.",{name:yt}))||Q(ue)},Gr=ue=>{if(!(ue!=null&&ue.id))return;const yt=ue.name||ue.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.updateServiceConfirm","Send an update request to {{name}}? The node will download updates and restart.",{name:yt}))||_t(ue)},yr=()=>{!(Y!=null&&Y.id)||(U(Y.id),Ae(Y))},un=()=>{Ie(null),dt()},Xr=()=>be(null),Ft=()=>te(null),Cn=async({version:ue,persist:yt})=>{var ot;if(!!A){if(A.type==="master"){K(!0);try{await Ee("/core/xray/update",{method:"POST",body:{version:ue,persist_env:Boolean(yt)}}),Xt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:ue}),W),await Promise.all([Ge(),N.invalidateQueries(Tr)]),Xr()}catch(wt){Gt(wt,W)}finally{K(!1)}return}if(A.type==="bulk"){const wt=(l!=null?l:[]).filter(Mt=>Mt.id!=null&&Mt.status==="connected");if(wt.length===0){W({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}_e(!0);try{const Mt=[];for(const fn of wt)try{await Ee(`/node/${fn.id}/xray/update`,{method:"POST",body:{version:ue}}),Mt.push({status:"fulfilled",node:fn})}catch(Xi){Mt.push({status:"rejected",node:fn}),Gt(Xi,W)}const rn=Mt.filter(fn=>fn.status==="fulfilled").length,mn=Mt.length-rn,gn=Mt.length;rn>0&&Xt(t("nodes.coreVersionDialog.bulkSuccess",{success:rn,total:gn}),W),mn>0&&W({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:mn,total:gn}),status:"error",isClosable:!0,position:"top",duration:4e3}),N.invalidateQueries(Tr),Xr()}finally{_e(!1)}return}if(A.type==="node"){const wt=A.node;if(!(wt!=null&&wt.id))return;we(wt.id);try{await Ee(`/node/${wt.id}/xray/update`,{method:"POST",body:{version:ue}}),Xt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(ot=wt.name)!=null?ot:t("nodes.unnamedNode","Unnamed node"),version:ue}),W),N.invalidateQueries(Tr),Xr()}catch(Mt){Gt(Mt,W)}finally{we(null)}}}},Yt=async ue=>{var ot;if(!f)return;const yt={mode:ue.mode,template_index_url:ue.templateIndexUrl,template_name:ue.templateName,files:ue.files,persist_env:ue.persistEnv};if(f.type==="master"){B(!0);try{await Ee("/core/geo/update",{method:"POST",body:yt}),Xt(t("nodes.geoDialog.masterUpdateSuccess"),W),Ft()}catch(wt){Gt(wt,W)}finally{B(!1)}return}if(f.type==="node"){const wt=f.node;if(!(wt!=null&&wt.id))return;Ne(wt.id);try{await Ee(`/node/${wt.id}/geo/update`,{method:"POST",body:yt}),Xt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(ot=wt.name)!=null?ot:t("nodes.unnamedNode","Unnamed node")}),W),N.invalidateQueries(Tr),Ft()}catch(Mt){Gt(Mt,W)}finally{Ne(null)}}},hn=c.exports.useMemo(()=>{if(!l)return[];const ue=V.trim().toLowerCase();return ue?l.filter(yt=>{var rn,mn,gn;const ot=((rn=yt.name)!=null?rn:"").toLowerCase(),wt=((mn=yt.address)!=null?mn:"").toLowerCase(),Mt=((gn=yt.xray_version)!=null?gn:"").toLowerCase();return ot.includes(ue)||wt.includes(ue)||Mt.includes(ue)}):l},[l,V]),_n=c.exports.useMemo(()=>(l!=null?l:[]).some(ue=>ue.id!=null&&ue.status==="connected"),[l]),tn=c.exports.useMemo(()=>{if(!!a){if(a instanceof Error)return a.message;if(typeof a=="string")return a;if(typeof a=="object"&&"message"in a){const ue=a.message;if(typeof ue=="string")return ue}return t("errorOccurred")}},[a,t]),pn=Boolean(tn),Un=t("nodes.masterNode","Master"),Dn=V.trim().toLowerCase(),Ki=!Dn||Un.toLowerCase().includes(Dn)||((w=de==null?void 0:de.version)!=null?w:"").toLowerCase().includes(Dn),Ji=(A==null?void 0:A.type)==="master"?$:(A==null?void 0:A.type)==="node"?A.node.id!=null&&J===A.node.id:(A==null?void 0:A.type)==="bulk"?ee:!1,An=(f==null?void 0:f.type)==="master"?xe:(f==null?void 0:f.type)==="node"?f.node.id!=null&&Te===f.node.id:!1,us=(A==null?void 0:A.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(A==null?void 0:A.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(A==null?void 0:A.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(ae=A.node.name)!=null?ae:t("nodes.unnamedNode","Unnamed node")}):"",qi=(A==null?void 0:A.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(A==null?void 0:A.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(A==null?void 0:A.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(je=A.node.name)!=null?je:t("nodes.unnamedNode","Unnamed node")}):"",Yi=(A==null?void 0:A.type)==="master"?(ct=de==null?void 0:de.version)!=null?ct:"":(A==null?void 0:A.type)==="node"&&(et=A.node.xray_version)!=null?et:"",Gi=(f==null?void 0:f.type)==="master"?t("nodes.geoDialog.masterTitle"):(f==null?void 0:f.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(Dt=f.node.name)!=null?Dt:t("nodes.unnamedNode","Unnamed node")}):"";return n(me,{spacing:6,align:"stretch",children:[n(ye,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),pn&&n(zr,{status:"error",borderRadius:"md",children:[e(Rr,{}),e(Hn,{children:tn})]}),n(ye,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),n(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[n(M,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[n(Mr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(ml,{pointerEvents:"none",children:e(_m,{color:"gray.400"})}),e(De,{value:V,onChange:ue=>ce(ue.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(ft,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(We,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(Lo,{}),variant:"ghost",size:"sm",onClick:()=>o(),isLoading:d})})]}),n(ye,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(L,{variant:"outline",size:"sm",onClick:()=>be({type:"bulk"}),isDisabled:!_n,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(L,{leftIcon:e(wm,{}),colorScheme:"primary",size:"sm",onClick:()=>le(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),i?e(Le,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((ue,yt)=>e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${yt}`))}):n(Le,{columns:{base:1,md:2,xl:3},spacing:4,children:[Ki&&e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:Z?n(me,{spacing:3,align:"center",justify:"center",children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Pe?n(me,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Pe}),e(L,{size:"sm",variant:"outline",onClick:()=>{Ge(),Kt()},children:t("refresh","Refresh")})]}):qe?n(me,{align:"stretch",spacing:4,children:[n(ye,{spacing:2,children:[n(M,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:Un}),e(ut,{colorScheme:"purple",size:"sm",children:de!=null&&de.version?`Xray ${de.version}`:t("nodes.versionUnknown","Version unknown")})]}),n(M,{spacing:2,align:"center",children:[e(zo,{status:br,compact:!0}),qe.limit_exceeded&&e(ut,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:de!=null&&de.started?t("nodes.masterStartedAt",{date:Re(de.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),qe.message&&n(zr,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(Rr,{}),e(Hn,{fontSize:"sm",children:qe.message})]}),e(Fn,{}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Wr})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:mr})]}),_r&&n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:_r})]}),jt&&n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:jt})]})]}),n(ye,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[n(Mr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(De,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:st,onChange:ue=>Jr(ue.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(Vr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(L,{colorScheme:"primary",size:"sm",onClick:kn,isDisabled:!Kr||Cr||Nt,isLoading:Nt,children:t("save","Save")}),e(L,{variant:"ghost",size:"sm",onClick:Rn,isDisabled:Ze===null||Nt,isLoading:Nt&&Ze===null,children:t("nodes.clearDataLimit","Clear limit")})]}),Cr&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),n(ye,{direction:{base:"column",sm:"row"},spacing:2,children:[e(L,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>be({type:"master"}),isLoading:$,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(L,{size:"sm",variant:"outline",onClick:()=>te({type:"master"}),isLoading:xe,children:t("nodes.geoDialog.updateMasterButton")}),e(L,{size:"sm",variant:"outline",colorScheme:"red",onClick:qr,isLoading:pt,children:t("nodes.resetUsage","Reset usage")})]})]}):n(me,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(L,{size:"sm",variant:"outline",onClick:()=>{Ge(),Kt()},children:t("refresh","Refresh")})]})},"master-node"),hn.length>0?hn.map(ue=>{var $a,Ka,Ja,qa;const yt=ue.status||"error",ot=ue==null?void 0:ue.id,wt=yt!=="disabled"&&yt!=="limited",Mt=ot!=null?pe[ot]:void 0,rn=Mt!=null?Mt:wt,mn=ot!=null&&O===ot&&fr,gn=ot!=null&&J===ot,fn=ot!=null&&Te===ot,Xi=Xe&&ot!=null&&Se===ot,cc=qt&&ot!=null&&R===ot,Va=e(zo,{status:yt,compact:!0}),dc=yt==="error"&&ue.message?e(ft,{label:ue.message,hasArrow:!0,placement:"top",openDelay:300,children:e(z,{as:"span",children:Va})}):Va;return e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:n(me,{align:"stretch",spacing:4,children:[n(ye,{spacing:2,children:[n(M,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:ue.name||t("nodes.unnamedNode","Unnamed node")}),e(bt,{size:"sm",colorScheme:"primary",isChecked:rn,onChange:()=>Dr(ue),isDisabled:mn,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),ue.status==="error"&&e(L,{size:"sm",variant:"outline",leftIcon:e(Lo,{}),onClick:()=>pr(ue),isLoading:kr,children:t("nodes.reconnect")})]}),n(M,{spacing:2,flexWrap:"wrap",children:[dc,n(M,{spacing:1,align:"center",children:[e(ut,{colorScheme:"blue",size:"sm",children:ue.xray_version?`Xray ${ue.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(ut,{colorScheme:"green",size:"sm",children:ue.node_service_version?t("nodes.nodeServiceVersionTag",{version:ue.node_service_version}):t("nodes.nodeServiceVersionUnknown","Node version unknown")}),e(L,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>ot&&be({type:"node",node:ue}),isLoading:gn,isDisabled:!ot,children:t("nodes.updateCoreAction")})]}),e(L,{size:"xs",variant:"ghost",onClick:()=>ot&&te({type:"node",node:ue}),isLoading:fn,isDisabled:!ot,children:t("nodes.updateGeoAction","Update geo")}),e(L,{size:"xs",variant:"ghost",colorScheme:"orange",onClick:()=>Yr(ue),isLoading:Xi,isDisabled:!ot,children:t("nodes.restartServiceAction","Restart node service")}),e(L,{size:"xs",variant:"ghost",colorScheme:"teal",onClick:()=>Gr(ue),isLoading:cc,isDisabled:!ot,children:t("nodes.updateServiceAction","Update node service")}),e(L,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ke(ue),isLoading:ne&&ot!=null&&I===ot,isDisabled:!ot,children:t("nodes.resetUsage","Reset usage")})]}),yt==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(Fn,{}),n(Le,{columns:{base:1,sm:2},spacingY:2,children:[n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:ue.address})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:ue.port})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:ue.api_port})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:ue.usage_coefficient})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Fe((($a=ue.uplink)!=null?$a:0)+((Ka=ue.downlink)!=null?Ka:0),2)})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:ue.data_limit!=null&&ue.data_limit>0?Fe(ue.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(Fn,{}),n(M,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[n(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(Ja=ue.id)!=null?Ja:"-"]}),n(fl,{size:"sm",variant:"ghost",children:[e(We,{"aria-label":t("edit"),icon:e(Cm,{}),onClick:()=>j(ue)}),e(We,{"aria-label":t("delete"),icon:e(km,{}),colorScheme:"red",onClick:()=>T(ue)})]})]})]})},(qa=ue.id)!=null?qa:ue.name)}):e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(bm,{isOpen:Boolean(A),onClose:Xr,onSubmit:Cn,currentVersion:Yi,title:us,description:qi,allowPersist:(A==null?void 0:A.type)==="master",isSubmitting:Ji}),e(vm,{isOpen:Boolean(f),onClose:Ft,onSubmit:Yt,title:Gi,showMasterOptions:(f==null?void 0:f.type)==="master",isSubmitting:An}),e(_s,{isOpen:H,leastDestructiveRef:lt,onClose:un,children:e(kt,{children:n(Ds,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(Ct,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(qn=(Ar=Y==null?void 0:Y.name)!=null?Ar:Y==null?void 0:Y.address)!=null?qn:t("nodes.thisNode","this node")})}),n(Ut,{children:[e(L,{ref:lt,onClick:un,children:t("cancel","Cancel")}),e(L,{colorScheme:"red",onClick:yr,ml:3,isLoading:ne,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(_s,{isOpen:se,leastDestructiveRef:D,onClose:ie,children:e(kt,{children:n(Ds,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(Ct,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:Un})}),n(Ut,{children:[e(L,{ref:D,onClick:ie,children:t("cancel","Cancel")}),e(L,{colorScheme:"red",onClick:()=>mt(),ml:3,isLoading:pt,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Uo,{isOpen:q,onClose:()=>le(!1),mutate:it,isLoading:Me,isAddMode:!0}),e(Uo,{isOpen:!!P,onClose:()=>j(null),node:P||void 0,mutate:nr,isLoading:Jt}),e(gm,{deleteCallback:()=>N.invalidateQueries(Tr)})]})},Im=Ns(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([Ee("/core").then(({version:s,started:r,logs_websocket:l})=>{t({version:s,started:r,logs_websocket:l})}).catch(s=>{throw console.error("Error fetching /core:",s),s}),Ee("/core/config").then(s=>{t({config:s})}).catch(s=>{throw console.error("Error fetching /core/config:",s),s})])}finally{t({isLoading:!1})}},updateConfig:s=>(t({isPostLoading:!0}),Ee("/core/config",{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>Ee("/core/restart",{method:"POST"})}));const Da=c.exports.forwardRef(({json:t,onChange:s,mode:r="code"},l)=>{const{colorMode:i}=jr(),a=c.exports.useRef(null),o=c.exports.useRef(null),d=c.exports.useRef(s),u=c.exports.useRef(null);c.exports.useEffect(()=>{d.current=s},[s]);const m=c.exports.useCallback(S=>{u.current=S,d.current(S)},[]);c.exports.useEffect(()=>{if(!a.current)return;const S=new xd(a.current,{mode:r,onChangeText:m,statusBar:!1,mainMenuBar:!1,theme:i==="dark"?"ace/theme/one_dark":"ace/theme/github"});o.current=S;const y=S.aceEditor;y&&(y.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),y.setTheme(i==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?S.setText(t):t!==void 0&&S.set(t)}catch{typeof t=="string"&&S.updateText(t)}return()=>{S.destroy(),o.current=null}},[]),c.exports.useEffect(()=>{const S=o.current;if(!S)return;const v=(N=>{if(N==null)return"";if(typeof N=="string")return N;try{return JSON.stringify(N,null,2)}catch{return""}})(t);if(v===null)return;if(u.current!==null){let N=u.current;try{N=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,N===v)return}let T=null;try{T=S.getText()}catch{T=null}if(T!==v)if(typeof t=="string")try{S.updateText(v)}catch{S.setText(v)}else{const N=t==null?{}:t;try{S.update(N)}catch{S.set(N)}}},[t]),c.exports.useEffect(()=>{const S=o.current;if(!!S)try{S.getMode&&S.getMode()!==r?S.setMode(r):S.getMode||S.setMode(r)}catch{S.setMode(r)}},[r]),c.exports.useEffect(()=>{var y;const S=(y=o.current)==null?void 0:y.aceEditor;!S||S.setTheme(i==="dark"?"ace/theme/one_dark":"ace/theme/github")},[i]);const p=Oe("gray.300","whiteAlpha.300"),g=Oe("surface.light","surface.dark"),x=Oe("sm","none");return e(z,{ref:l,border:"1px solid",borderColor:p,bg:g,borderRadius:"lg",h:"full",boxShadow:x,overflow:"hidden",children:e(z,{height:"full",ref:a})})}),Pm=oe(gi,{baseStyle:{w:4,h:4}}),Tm=oe(vl,{baseStyle:{w:4,h:4}}),sc=({triggerLabel:t,title:s,children:r})=>{const l=Ur({base:!0,md:!1});return n(Vn,{placement:l?"bottom":"right",isLazy:!0,children:[e($n,{children:e(L,{size:"xs",variant:"outline",children:t!=null?t:e(Pm,{})})}),n(Kn,{children:[e(os,{}),e(Ma,{}),s&&e(gl,{fontWeight:"semibold",children:s}),e(Jn,{children:r})]})]})},Em=({chips:t,color:s="blue"})=>{const r=t[0],l=t.slice(1);return n(M,{spacing:2,align:"center",children:[r?e(ut,{size:"sm",colorScheme:s,children:r}):e(h,{color:"gray.400",children:"-"}),l.length>0&&e(sc,{triggerLabel:n(ut,{size:"sm",children:["+",l.length]}),title:"Details",children:e(me,{align:"stretch",children:t.map((i,a)=>e(M,{justify:"space-between",children:e(h,{children:i})},a))})})]})},Nm=({text:t,label:s})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:i}=Pl(t!=null?t:"");return e(M,{spacing:2,align:"center",children:e(sc,{triggerLabel:r,title:s,children:n(me,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),n(M,{children:[e(We,{"aria-label":"copy",size:"sm",icon:e(Tm,{}),onClick:i}),e(h,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},Wo=500,zm=t=>{try{let s=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(s.protocol==="https:"?"wss://":"ws://")+al([s.host+s.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+As()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}},ic=({showTitle:t=!0})=>{var j;const{t:s}=Ke(),{userData:r,getUserIsSuccess:l}=hr();if(!(l&&Boolean((j=r.permissions)==null?void 0:j.sections.xray)))return n(me,{spacing:4,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("xrayLogs.title","Xray logs")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:s("xrayLogs.noPermission","You do not have permission to view Xray logs.")})]});const{data:a}=Ba(),[o,d]=c.exports.useState(""),[u,m]=c.exports.useState([]),p=c.exports.useRef(null),[g,x]=c.exports.useState(!0),{colorMode:S}=jr(),y=q=>{if(q!==o){if(!q){d(""),m([]);return}d(q),m([])}},v=c.exports.useCallback(vd.exports.debounce(q=>{m(le=>le.length>=Wo?[...le.slice(le.length-Wo+1),q]:[...le,q])},50),[]);c.exports.useEffect(()=>()=>{v.cancel()},[v]);const{readyState:T}=wd(zm(o),{onMessage:q=>{var le;v((le=q.data)!=null?le:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});c.exports.useEffect(()=>{const q=p.current;if(!q)return;const le=()=>{const ce=q.scrollHeight-q.scrollTop-q.clientHeight<=32;x(ce)};return q.addEventListener("scroll",le),le(),()=>{q.removeEventListener("scroll",le)}},[]),c.exports.useEffect(()=>{g&&p.current&&(p.current.scrollTop=p.current.scrollHeight)},[u,g]);const N=c.exports.useMemo(()=>{const q=S==="dark";return{error:{bg:q?"rgba(248, 113, 113, 0.16)":"red.50",color:q?"#fed7d7":"#c53030",border:q?"#f87171":"#feb2b2"},warn:{bg:q?"rgba(251, 191, 36, 0.18)":"orange.50",color:q?"#fefcbf":"#975a16",border:q?"#fbbf24":"#f6ad55"},info:{bg:q?"rgba(96, 165, 250, 0.18)":"blue.50",color:q?"#bfdbfe":"#1a56db",border:q?"#60a5fa":"#63b3ed"},debug:{bg:q?"rgba(148, 163, 184, 0.16)":"gray.100",color:q?"#e2e8f0":"#1f2933",border:q?"#94a3b8":"#cbd5e1"},default:{bg:q?"rgba(30, 64, 175, 0.1)":"gray.50",color:q?"#e2e8f0":"#1f2933",border:q?"#475569":"#e2e8f0"}}},[S]),W=Oe("#f5f7fb","#1f2329"),he=Oe("gray.200","gray.600"),E=Oe("gray.500","gray.400"),F=Oe("white","gray.700"),P=q=>/error|failed|exception/i.test(q)?"error":/warn/i.test(q)?"warn":/info/i.test(q)?"info":/debug/i.test(q)?"debug":"default";return n(me,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("header.xrayLogs")}),n(ye,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[n(ye,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(a==null?void 0:a[0])&&n(rt,{size:"sm",w:{base:"full",sm:"auto"},bg:F,onChange:q=>y(q.target.value),value:o,children:[e("option",{value:"",children:s("core.master")}),a.map(q=>e("option",{value:String(q.id),children:s(q.name)},q.address))]}),e(h,{fontSize:"sm",color:E,children:s(`core.socket.${T}`)})]}),e(h,{fontSize:"xs",color:E,children:g?s("core.autoScrollOn","Auto-scroll: On"):s("core.autoScrollOff","Auto-scroll: Off")})]}),e(z,{border:"1px solid",borderColor:he,bg:W,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:p,fontFamily:"mono",fontSize:"sm",children:e(me,{align:"stretch",spacing:2,children:u.map((q,le)=>{var A;const V=P(q),ce=(A=N[V])!=null?A:N.default;return e(z,{bg:ce.bg,color:ce.color,borderLeftWidth:3,borderLeftColor:ce.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(oe.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:q})},`${q}-${le}`)})})})]})},Rm=oe(Nn),Um=oe(Tl),xr={tag:"",protocol:fe.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:Ql.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},gs=t=>{const s={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case fe.VMess:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case fe.VLESS:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case fe.Trojan:s.servers=[{address:r,port:l,password:t.password||void 0}];break;case fe.Shadowsocks:s.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case fe.Socks:case fe.HTTP:s.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case fe.Freedom:s.domainStrategy=t.freedomStrategy||void 0;break;case fe.Blackhole:s.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case fe.DNS:s.network=t.dnsNetwork,s.address=t.dnsAddress||void 0,s.port=Number(t.dnsPort)||void 0;break;case fe.Wireguard:s.secretKey=t.wireguardSecret||void 0,s.address=t.wireguardAddress?t.wireguardAddress.split(",").map(d=>d.trim()).filter(Boolean):void 0,s.peers=t.wireguardPeers.map(d=>({publicKey:d.publicKey||void 0,allowedIPs:d.allowedIPs?d.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:d.endpoint||void 0,keepAlive:Number(d.keepAlive)||void 0}));break}const i=new On;i.network=t.network,i.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?i.tcp=new En(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?i.ws=new ss(t.wsPath,t.wsHost,0):t.network==="grpc"&&(i.grpc=new is(t.grpcServiceName,"",!1)),t.tlsEnabled&&(i.tls=new as(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(i.reality=new Es(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const o=new or(t.tag,t.protocol,s,i,void 0).toJson();return o.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(o.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),o},Mm=({isOpen:t,onClose:s,mode:r,initialOutbound:l,onSubmitOutbound:i})=>{const{t:a}=Ke(),o=Zt(),d=Oe("gray.50","whiteAlpha.100"),{control:u,register:m,reset:p,handleSubmit:g,watch:x,getValues:S,setValue:y,formState:{isValid:v}}=en({defaultValues:xr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});c.exports.useEffect(()=>{m("tlsEnabled"),m("realityEnabled")},[m]);const{fields:T,append:N,remove:W}=Ss({control:u,name:"wireguardPeers"}),he=x("protocol"),E=x("network"),F=x("tlsEnabled"),P=x("realityEnabled"),j=x("tcpType"),q=x("muxEnabled"),le=a("validation.required",{defaultValue:"Required"}),V=a("validation.invalidPort",{defaultValue:"Invalid port"}),ce=he||fe.VLESS,A=![fe.Freedom,fe.Blackhole,fe.DNS,fe.Wireguard].includes(ce),be=[fe.VMess,fe.VLESS].includes(ce),f=[fe.Trojan,fe.Shadowsocks].includes(ce),te=ce===fe.Shadowsocks,J=ce===fe.DNS,we=sr({control:u}),[Te,Ne]=c.exports.useState(0),[$,K]=c.exports.useState(()=>gs(xr)),[ee,_e]=c.exports.useState(()=>JSON.stringify(gs(xr),null,2)),[xe,B]=c.exports.useState(null),[O,G]=c.exports.useState(""),pe=c.exports.useRef(!1);c.exports.useEffect(()=>{if(!t)return;Ne(0),B(null),G("");const R=l?I(l):xr;pe.current=!0,p(R);const re=gs(R);K(re),_e(JSON.stringify(re,null,2))},[l,t,p]),c.exports.useEffect(()=>{if(!we)return;if(pe.current){pe.current=!1;return}const R=gs(we);K(R);const re=JSON.stringify(R,null,2);_e(H=>H===re?H:re),B(null)},[we]);const k=c.exports.useMemo(()=>[fe.VLESS,fe.VMess,fe.Trojan,fe.Shadowsocks,fe.Socks,fe.HTTP,fe.Freedom,fe.Blackhole,fe.DNS,fe.Wireguard],[]),I=R=>{var dt,lt,st,ve,Be,Je,se,Ye,ie,D,de,ze,Ge,tt,qe,Vt,$t,Kt,Me,it,Jt,nr,kr,pr,gr,fr,ne,Ae,Q,Xe,_t,qt,Nt,zt,pt,mt,It,ir,Cr,Kr,Z,Pe,Ve,Ze,vt,jt,br,Wr,mr,_r,Jr,kn,Rn,qr,Dr;const re=or.fromJson(R),H={...xr,tag:(dt=R==null?void 0:R.tag)!=null?dt:"",protocol:(re==null?void 0:re.protocol)||xr.protocol,sendThrough:(lt=R==null?void 0:R.sendThrough)!=null?lt:"",muxEnabled:Boolean((st=R==null?void 0:R.mux)==null?void 0:st.enabled),muxConcurrency:Number((Be=(ve=R==null?void 0:R.mux)==null?void 0:ve.concurrency)!=null?Be:xr.muxConcurrency)},ge=re==null?void 0:re.stream;switch(H.network=(Je=ge==null?void 0:ge.network)!=null?Je:xr.network,H.tlsEnabled=(ge==null?void 0:ge.security)==="tls",H.realityEnabled=(ge==null?void 0:ge.security)==="reality",H.tlsServerName=(Ye=(se=ge==null?void 0:ge.tls)==null?void 0:se.serverName)!=null?Ye:"",H.realityPublicKey=(D=(ie=ge==null?void 0:ge.reality)==null?void 0:ie.publicKey)!=null?D:"",H.realityShortId=(ze=(de=ge==null?void 0:ge.reality)==null?void 0:de.shortId)!=null?ze:"",(ge==null?void 0:ge.network)==="tcp"&&ge.tcp&&(H.tcpType=ge.tcp.type,H.tcpHost=(Ge=ge.tcp.host)!=null?Ge:"",H.tcpPath=(tt=ge.tcp.path)!=null?tt:""),(ge==null?void 0:ge.network)==="ws"&&ge.ws&&(H.wsHost=(qe=ge.ws.host)!=null?qe:"",H.wsPath=(Vt=ge.ws.path)!=null?Vt:""),(ge==null?void 0:ge.network)==="grpc"&&ge.grpc&&(H.grpcServiceName=($t=ge.grpc.serviceName)!=null?$t:""),re!=null&&re.hasAddressPort()&&(H.address=(Jt=(it=(Kt=re.settings)==null?void 0:Kt.address)!=null?it:(Me=R==null?void 0:R.settings)==null?void 0:Me.address)!=null?Jt:"",H.port=Number((gr=(pr=(nr=re.settings)==null?void 0:nr.port)!=null?pr:(kr=R==null?void 0:R.settings)==null?void 0:kr.port)!=null?gr:xr.port)),H.protocol){case fe.VMess:{const ke=re.settings;H.id=(fr=ke==null?void 0:ke.id)!=null?fr:"",H.vnextEncryption=(ne=ke==null?void 0:ke.security)!=null?ne:xr.vnextEncryption,H.address=(Ae=ke==null?void 0:ke.address)!=null?Ae:H.address,H.port=Number((Q=ke==null?void 0:ke.port)!=null?Q:H.port);break}case fe.VLESS:{const ke=re.settings;H.id=(Xe=ke==null?void 0:ke.id)!=null?Xe:"",H.flow=(_t=ke==null?void 0:ke.flow)!=null?_t:"",H.encryption=(qt=ke==null?void 0:ke.encryption)!=null?qt:H.encryption,H.address=(Nt=ke==null?void 0:ke.address)!=null?Nt:H.address,H.port=Number((zt=ke==null?void 0:ke.port)!=null?zt:H.port);break}case fe.Trojan:{const ke=re.settings;H.password=(pt=ke==null?void 0:ke.password)!=null?pt:"",H.address=(mt=ke==null?void 0:ke.address)!=null?mt:H.address,H.port=Number((It=ke==null?void 0:ke.port)!=null?It:H.port);break}case fe.Shadowsocks:{const ke=re.settings;H.password=(ir=ke==null?void 0:ke.password)!=null?ir:"",H.method=(Cr=ke==null?void 0:ke.method)!=null?Cr:xr.method,H.address=(Kr=ke==null?void 0:ke.address)!=null?Kr:H.address,H.port=Number((Z=ke==null?void 0:ke.port)!=null?Z:H.port);break}case fe.Socks:case fe.HTTP:{const ke=(H.protocol===fe.Socks,re.settings);H.user=(Pe=ke==null?void 0:ke.user)!=null?Pe:"",H.pass=(Ve=ke==null?void 0:ke.pass)!=null?Ve:"",H.address=(Ze=ke==null?void 0:ke.address)!=null?Ze:H.address,H.port=Number((vt=ke==null?void 0:ke.port)!=null?vt:H.port);break}case fe.DNS:{const ke=re.settings;H.dnsNetwork=(jt=ke==null?void 0:ke.network)!=null?jt:xr.dnsNetwork,H.dnsAddress=(br=ke==null?void 0:ke.address)!=null?br:"",H.dnsPort=Number((Wr=ke==null?void 0:ke.port)!=null?Wr:xr.dnsPort);break}case fe.Freedom:{const ke=re.settings;H.freedomStrategy=(mr=ke==null?void 0:ke.domainStrategy)!=null?mr:"";break}case fe.Blackhole:{const ke=re.settings;H.blackholeResponse=(_r=ke==null?void 0:ke.type)!=null?_r:"";break}case fe.Wireguard:{const ke=re.settings;H.wireguardSecret=(Jr=ke==null?void 0:ke.secretKey)!=null?Jr:"",H.wireguardAddress=(kn=ke==null?void 0:ke.address)!=null?kn:"";const Yr=(qr=(Rn=ke==null?void 0:ke.peers)==null?void 0:Rn.map(Gr=>{var yr,un,Xr;return{publicKey:(yr=Gr.publicKey)!=null?yr:"",allowedIPs:Array.isArray(Gr.allowedIPs)?Gr.allowedIPs.join(","):"",endpoint:(un=Gr.endpoint)!=null?un:"",keepAlive:Number((Xr=Gr.keepAlive)!=null?Xr:0)}}))!=null?qr:[];H.wireguardPeers=Yr.length>0?Yr:xr.wireguardPeers;break}}return((Dr=R==null?void 0:R.mux)==null?void 0:Dr.concurrency)!=null&&(H.muxConcurrency=Number(R.mux.concurrency)),(!H.wireguardPeers||H.wireguardPeers.length===0)&&(H.wireguardPeers=xr.wireguardPeers),H},U=R=>{_e(R);try{const re=JSON.parse(R);B(null),K(re),pe.current=!0;const H=I(re);p(H)}catch(re){B(re.message)}},Y=()=>{const R=O.trim();if(!R){B(a("pages.outbound.configEmpty","Please paste a config link"));return}const re=or.fromLink(R);if(!re){B(a("pages.outbound.invalidConfig","Unsupported or invalid config link")),o({status:"error",duration:2500,position:"top",title:a("pages.outbound.configParseFailedTitle","Conversion failed"),description:a("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const H=re.toJson(),ge=JSON.stringify(H,null,2);G(""),U(ge),o({status:"success",duration:2e3,position:"top",title:a("pages.outbound.configConvertedTitle","Config converted"),description:a("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},Ie=g(async R=>{var H;const re=gs(R);try{await i(re),o({title:r==="edit"?a("pages.xray.outbound.updated","Outbound updated"):a("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),s()}catch(ge){o({title:((H=ge==null?void 0:ge.data)==null?void 0:H.detail)||(ge==null?void 0:ge.message)||a("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),Se=()=>{s()},He=R=>{if(Ne(R),R===1){const re=gs(S());K(re);const H=JSON.stringify(re,null,2);_e(ge=>ge===H?ge:H),B(null)}};return n(Lt,{size:"4xl",isOpen:t,onClose:Se,scrollBehavior:"inside",children:[e(kt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),n(Ot,{as:"form",onSubmit:Ie,children:[e(At,{children:r==="edit"?a("pages.xray.outbound.editOutbound","Edit Outbound"):a("pages.xray.outbound.addOutbound")}),e(Wt,{}),e(Ct,{children:n(ls,{variant:"enclosed",colorScheme:"primary",index:Te,onChange:He,children:[n(cs,{children:[e(er,{children:a("form")}),e(er,{children:a("json")})]}),n(ds,{children:[e(tr,{children:n(me,{spacing:6,align:"stretch",children:[n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.basicSettings","Basic settings")}),n(me,{spacing:3,align:"stretch",children:[n(C,{isRequired:!0,children:[e(_,{children:a("pages.xray.outbound.tag")}),e(De,{size:"sm",placeholder:"outbound-tag",...m("tag",{required:le})})]}),n(M,{children:[n(C,{isRequired:!0,children:[e(_,{children:a("protocol")}),e(rt,{size:"sm",...m("protocol"),children:k.map(R=>e("option",{value:R,children:R},R))})]}),n(C,{children:[e(_,{children:a("pages.xray.outbound.sendThrough")}),e(De,{size:"sm",placeholder:"0.0.0.0",...m("sendThrough")})]})]})]})]}),A&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.endpoint","Endpoint")}),n(me,{spacing:3,align:"stretch",children:[n(C,{isRequired:A,children:[e(_,{children:a("pages.outbound.address","Address")}),e(De,{size:"sm",placeholder:"example.com",...m("address",{required:A?le:!1})})]}),n(M,{children:[n(C,{isRequired:A,children:[e(_,{children:a("pages.outbound.port","Port")}),e(De,{size:"sm",type:"number",min:1,max:65535,...m("port",{required:A?le:!1,valueAsNumber:!0,min:{value:1,message:V},max:{value:65535,message:V}})})]}),be?n(C,{isRequired:be,children:[e(_,{children:"ID"}),e(De,{size:"sm",placeholder:"UUID",...m("id",{required:be?le:!1})})]}):f?n(C,{isRequired:f,children:[e(_,{children:a("password")}),e(De,{size:"sm",placeholder:"password",...m("password",{required:f?le:!1})})]}):n(C,{children:[e(_,{children:a("username")}),e(De,{size:"sm",placeholder:"username",...m("user")})]})]}),ce===fe.Shadowsocks&&n(C,{isRequired:te,children:[e(_,{children:a("pages.outbound.method","Method")}),e(rt,{size:"sm",...m("method",{required:te?le:!1}),children:Object.values(Ql).map(R=>e("option",{value:R,children:R},R))})]}),ce===fe.VLESS&&n(M,{children:[n(C,{children:[e(_,{children:a("pages.outbound.encryption","Encryption")}),e(De,{size:"sm",placeholder:"none",...m("encryption")})]}),n(C,{children:[e(_,{children:"Flow"}),e(De,{size:"sm",placeholder:"xtls-rprx-vision",...m("flow")})]})]}),ce===fe.VMess&&n(C,{children:[e(_,{children:a("pages.outbound.security","User security")}),e(De,{size:"sm",placeholder:"auto",...m("vnextEncryption")})]})]})]}),ce===fe.DNS&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.dnsSettings","DNS settings")}),n(M,{children:[n(C,{children:[e(_,{children:a("pages.outbound.network")}),n(rt,{size:"sm",...m("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),n(C,{isRequired:J,children:[e(_,{children:a("pages.outbound.port")}),e(De,{size:"sm",type:"number",min:1,max:65535,...m("dnsPort",{required:J?le:!1,valueAsNumber:!0,min:{value:1,message:V},max:{value:65535,message:V}})})]})]}),n(C,{mt:3,isRequired:J,children:[e(_,{children:a("pages.outbound.address")}),e(De,{size:"sm",placeholder:"8.8.8.8",...m("dnsAddress",{required:J?le:!1})})]})]}),ce===fe.Freedom&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.freedom","Freedom options")}),n(C,{children:[e(_,{children:a("pages.outbound.strategy","Strategy")}),e(De,{size:"sm",placeholder:"UseIP",...m("freedomStrategy")})]})]}),ce===fe.Blackhole&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.blackhole","Blackhole options")}),n(C,{children:[e(_,{children:a("pages.outbound.response")}),e(De,{size:"sm",placeholder:"none",...m("blackholeResponse")})]})]}),ce===fe.Wireguard&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.wireguard","Wireguard")}),n(me,{spacing:3,align:"stretch",children:[n(C,{children:[e(_,{children:a("pages.outbound.secretKey","Secret key")}),e(De,{size:"sm",...m("wireguardSecret")})]}),n(C,{children:[e(_,{children:a("pages.outbound.address")}),e(De,{size:"sm",placeholder:"10.0.0.1/32",...m("wireguardAddress")})]}),n(me,{spacing:3,align:"stretch",children:[n(M,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:a("pages.outbound.peer","Peers")}),e(We,{size:"sm","aria-label":a("add"),icon:e(Rm,{boxSize:3}),onClick:()=>N({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),T.map((R,re)=>n(z,{borderWidth:"1px",borderRadius:"md",p:3,bg:d,children:[n(M,{children:[n(C,{children:[e(_,{children:a("pages.outbound.publicKey","Public key")}),e(De,{size:"sm",...m(`wireguardPeers.${re}.publicKey`)})]}),T.length>1&&e(We,{mt:6,size:"sm","aria-label":a("delete"),icon:e(Um,{boxSize:3}),onClick:()=>W(re)})]}),n(M,{mt:2,children:[n(C,{children:[e(_,{children:a("pages.outbound.allowedIPs","Allowed IPs")}),e(De,{size:"sm",...m(`wireguardPeers.${re}.allowedIPs`)})]}),n(C,{children:[e(_,{children:a("pages.outbound.endpoint","Endpoint")}),e(De,{size:"sm",...m(`wireguardPeers.${re}.endpoint`)})]})]}),n(C,{mt:2,children:[e(_,{children:a("pages.outbound.keepAlive","Keep alive")}),e(De,{size:"sm",type:"number",...m(`wireguardPeers.${re}.keepAlive`,{valueAsNumber:!0})})]})]},R.id))]})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.transport","Transport")}),n(me,{spacing:3,align:"stretch",children:[n(C,{children:[e(_,{children:a("pages.outbound.network")}),n(rt,{size:"sm",...m("network"),onChange:R=>{m("network").onChange(R)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),E==="tcp"&&n(M,{children:[n(C,{children:[e(_,{children:a("pages.outbound.tcpHeader","Header")}),n(rt,{size:"sm",...m("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),j==="http"&&n(Bt,{children:[n(C,{children:[e(_,{children:a("host")}),e(De,{size:"sm",...m("tcpHost")})]}),n(C,{children:[e(_,{children:a("path")}),e(De,{size:"sm",...m("tcpPath")})]})]})]}),E==="ws"&&n(M,{children:[n(C,{children:[e(_,{children:a("host")}),e(De,{size:"sm",...m("wsHost")})]}),n(C,{children:[e(_,{children:a("path")}),e(De,{size:"sm",...m("wsPath")})]})]}),E==="grpc"&&n(C,{children:[e(_,{children:a("serviceName")}),e(De,{size:"sm",...m("grpcServiceName")})]})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.security")}),n(M,{children:[n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"TLS"}),e(bt,{size:"sm",isChecked:F,onChange:R=>{const re=R.target.checked;y("tlsEnabled",re),re&&y("realityEnabled",!1)}})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"Reality"}),e(bt,{size:"sm",isChecked:P,onChange:R=>{const re=R.target.checked;y("realityEnabled",re),re&&y("tlsEnabled",!1)}})]})]}),F&&n(C,{mt:3,children:[e(_,{children:"SNI"}),e(De,{size:"sm",placeholder:"example.com",...m("tlsServerName")})]}),P&&n(me,{spacing:3,align:"stretch",mt:3,children:[n(C,{children:[e(_,{children:"SNI"}),e(De,{size:"sm",...m("tlsServerName")})]}),n(C,{children:[e(_,{children:a("pages.outbound.publicKey")}),e(De,{size:"sm",...m("realityPublicKey")})]}),n(C,{children:[e(_,{children:a("pages.outbound.shortId")}),e(De,{size:"sm",...m("realityShortId")})]})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.mux")}),n(C,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:a("pages.outbound.enableMux")}),e(bt,{size:"sm",...m("muxEnabled")})]}),q&&n(C,{mt:3,children:[e(_,{children:a("pages.outbound.concurrency")}),e(De,{size:"sm",type:"number",...m("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(tr,{children:n(me,{align:"stretch",spacing:3,children:[n(C,{children:[e(_,{children:a("pages.outbound.configToJson","Config to JSON")}),n(M,{align:"start",spacing:3,children:[e(Nr,{value:O,onChange:R=>G(R.target.value),placeholder:a("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(L,{size:"sm",colorScheme:"primary",onClick:Y,children:a("pages.outbound.convertConfig","Convert")})]})]}),e(z,{height:"420px",children:e(Da,{json:$,onChange:U})}),xe&&e(h,{fontSize:"sm",color:"red.500",children:xe})]})})]})]})}),n(Ut,{gap:3,children:[e(L,{variant:"outline",onClick:Se,children:a("cancel")}),e(L,{colorScheme:"primary",type:"submit",isDisabled:!v,children:a(r==="edit"?"save":"add")})]})]})]})},Lm=["tcp","udp","http","quic","grpc"],Om=["http","tls","bittorrent","quic"],Wm=["field","chained"],Fm=["","hybrid","linear"],ac={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},fs=t=>Array.isArray(t)?t.join(", "):"",bs=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean),Hm=t=>{var r,l,i,a;if(!t)return{...ac};const s=t.attrs?Object.entries(t.attrs).map(([o,d])=>({key:o,value:d==null?"":String(d)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(i=t.outboundTag)!=null?i:"",balancerTag:(a=t.balancerTag)!=null?a:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:fs(t.source),sourcePort:fs(t.sourcePort),domain:fs(t.domain),ip:fs(t.ip),user:fs(t.user),port:fs(t.port),attrs:s}},Bm=t=>{const s={};t.type&&(s.type=t.type),t.domainMatcher&&(s.domainMatcher=t.domainMatcher),t.outboundTag&&(s.outboundTag=t.outboundTag),t.balancerTag&&(s.balancerTag=t.balancerTag),t.inboundTags.length&&(s.inboundTag=t.inboundTags),t.networks.length&&(s.network=t.networks),t.protocols.length&&(s.protocol=t.protocols);const r=bs(t.sourceIps);r.length&&(s.source=r);const l=bs(t.sourcePort);l.length&&(s.sourcePort=l);const i=bs(t.domain);i.length&&(s.domain=i);const a=bs(t.ip);a.length&&(s.ip=a);const o=bs(t.user);o.length&&(s.user=o);const d=bs(t.port);if(d.length&&(s.port=d),t.attrs.length){const u={};t.attrs.forEach(({key:m,value:p})=>{!m.trim()||(u[m.trim()]=p)}),Object.keys(u).length&&(s.attrs=u)}return s.type||(s.type="field"),s},Vm=({isOpen:t,mode:s,initialRule:r,availableInboundTags:l,availableOutboundTags:i,availableBalancerTags:a,onSubmit:o,onClose:d})=>{const{t:u}=Ke(),m=Oe("white","gray.900"),{control:p,register:g,handleSubmit:x,reset:S,formState:{isSubmitting:y}}=en({defaultValues:ac}),{fields:v,append:T,remove:N}=Ss({control:p,name:"attrs"});c.exports.useEffect(()=>{t&&S(Hm(r))},[t,r,S]);const W=()=>T({key:"",value:""}),he=()=>{d()},E=x(P=>{const j=Bm(P);o(j),he()}),F=c.exports.useMemo(()=>s==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[s,u]);return n(Lt,{isOpen:t,onClose:he,size:"xl",scrollBehavior:"inside",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{as:"form",onSubmit:E,bg:m,children:[e(At,{children:F}),e(Wt,{}),e(Ct,{children:n(ye,{spacing:5,children:[n(C,{children:[e(_,{children:u("pages.xray.rules.type","Rule Type")}),e(rt,{...g("type"),size:"sm",children:Wm.map(P=>e("option",{value:P,children:P||u("core.none","None")},P))})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(rt,{...g("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:i.map(P=>e("option",{value:P,children:P},P))})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(rt,{...g("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:a.map(P=>e("option",{value:P,children:P},P))})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(xt,{control:p,name:"inboundTags",render:({field:P})=>e(zi,{...P,children:e(xs,{spacing:3,children:l.map(j=>e(jn,{children:e(wr,{value:j,children:j})},j))})})})]}),e(Fn,{}),n(C,{children:[e(_,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(rt,{...g("domainMatcher"),size:"sm",children:Fm.map(P=>e("option",{value:P,children:P||u("core.default","Default")},P||"empty"))})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.network","Network")}),e(xt,{control:p,name:"networks",render:({field:P})=>e(zi,{...P,children:e(xs,{spacing:3,children:Lm.map(j=>e(jn,{children:e(wr,{value:j,children:j})},j))})})})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.protocol","Protocol")}),e(xt,{control:p,name:"protocols",render:({field:P})=>e(zi,{...P,children:e(xs,{spacing:3,children:Om.map(j=>e(jn,{children:e(wr,{value:j,children:j})},j))})})})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.source","Source IPs")}),e(Nr,{...g("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(Nr,{...g("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.ip","Destination IPs")}),e(Nr,{...g("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.domain","Domains")}),e(Nr,{...g("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.user","Users")}),e(Nr,{...g("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(_,{children:u("pages.xray.rules.port","Ports")}),e(Nr,{...g("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(Fn,{}),n(z,{children:[n(C,{children:[e(_,{children:u("pages.xray.rules.attrs","Attributes")}),e(L,{onClick:W,size:"xs",leftIcon:e(Nn,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),n(ye,{spacing:2,mt:3,children:[v.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),v.map((P,j)=>n(M,{spacing:2,align:"flex-start",children:[e(De,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...g(`attrs.${j}.key`)}),e(De,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...g(`attrs.${j}.value`)}),e(We,{"aria-label":"Remove attribute",icon:e(Ta,{width:16}),size:"sm",variant:"ghost",onClick:()=>N(j)})]},P.id))]})]})]})}),n(Ut,{gap:3,children:[e(L,{variant:"outline",onClick:he,children:u("cancel")}),e(L,{colorScheme:"primary",type:"submit",isLoading:y,children:s==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},$m=({isOpen:t,onClose:s,form:r,setBalancersData:l,balancerIndex:i})=>{const{t:a}=Ke(),o=en({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),d=o.handleSubmit(u=>{const m={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},p=r.getValues("config.routing.balancers")||[];i!==void 0?p[i]=m:p.push(m),r.setValue("config.routing.balancers",p,{shouldDirty:!0}),l(p.map((g,x)=>{var S;return{key:x,tag:g.tag||"",strategy:((S=g.strategy)==null?void 0:S.type)||"random",selector:g.selector||[],fallbackTag:g.fallbackTag||""}})),s()});return n(Lt,{isOpen:t,onClose:s,size:"sm",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Wt,{mt:3}),e(Ct,{children:e("form",{onSubmit:d,children:n(me,{spacing:4,children:[n(C,{children:[e(_,{children:a("pages.xray.balancer.tag")}),e(De,{...o.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),n(C,{children:[e(_,{children:a("pages.xray.balancer.balancerStrategy")}),e(rt,{...o.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),n(C,{children:[e(_,{children:a("pages.xray.balancer.balancerSelectors")}),e(De,{...o.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),n(C,{children:[e(_,{children:a("pages.xray.balancer.fallbackTag")}),e(De,{...o.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(L,{type:"submit",colorScheme:"primary",size:"sm",children:a(i!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},Km=({isOpen:t,onClose:s,form:r,setDnsServers:l,dnsIndex:i})=>{const{t:a}=Ke(),o=en({defaultValues:{address:"",domains:"",expectIPs:""}}),d=o.handleSubmit(u=>{const m={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},p=r.getValues("config.dns.servers")||[];i!==void 0?p[i]=m:p.push(m),r.setValue("config.dns.servers",p,{shouldDirty:!0}),l(p),s()});return n(Lt,{isOpen:t,onClose:s,size:"sm",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Wt,{mt:3}),e(Ct,{children:e("form",{onSubmit:d,children:n(me,{spacing:4,children:[n(C,{children:[e(_,{children:a("pages.xray.dns.address")}),e(De,{...o.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),n(C,{children:[e(_,{children:a("pages.xray.dns.domains")}),e(De,{...o.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),n(C,{children:[e(_,{children:a("pages.xray.dns.expectIPs")}),e(De,{...o.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(L,{type:"submit",colorScheme:"primary",size:"sm",children:a(i!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},Jm=({isOpen:t,onClose:s,form:r,setFakeDns:l,fakeDnsIndex:i})=>{const{t:a}=Ke(),o=en({defaultValues:{ipPool:"",poolSize:""}}),d=o.handleSubmit(u=>{const m={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},p=r.getValues("config.fakedns")||[];i!==void 0?p[i]=m:p.push(m),r.setValue("config.fakedns",p.length>0?p:null,{shouldDirty:!0}),l(p),s()});return n(Lt,{isOpen:t,onClose:s,size:"sm",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ot,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Wt,{mt:3}),e(Ct,{children:e("form",{onSubmit:d,children:n(me,{spacing:4,children:[n(C,{children:[e(_,{children:a("pages.xray.fakedns.ipPool")}),e(De,{...o.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),n(C,{children:[e(_,{children:a("pages.xray.fakedns.poolSize")}),e(De,{...o.register("poolSize"),size:"sm",placeholder:"100"})]}),e(L,{type:"submit",colorScheme:"primary",size:"sm",children:a(i!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},Aa={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Fo=t=>{var u,m,p,g,x,S,y,v,T,N,W,he,E;if(!t)return{...Aa};const s=(u=t.settings)!=null?u:{},l=(m=(Array.isArray(s.peers)?s.peers:[])[0])!=null?m:{},i=Array.isArray(s.address)?s.address:[],a=(g=(p=i.find(F=>typeof F=="string"&&F.endsWith("/32")))==null?void 0:p.replace("/32",""))!=null?g:"",o=(S=(x=i.find(F=>typeof F=="string"&&F.endsWith("/128")))==null?void 0:x.replace("/128",""))!=null?S:"",d=Array.isArray(s.reserved)?s.reserved.filter(F=>Number.isFinite(Number(F))).join(","):"";return{tag:(y=t.tag)!=null?y:"warp",privateKey:(T=(v=s.secretKey)!=null?v:s.privateKey)!=null?T:"",publicKey:(N=l.publicKey)!=null?N:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:a,addressV6:o,reserved:d,mtu:(W=s.mtu)!=null?W:1420,domainStrategy:(he=s.domainStrategy)!=null?he:"ForceIP",notes:typeof t.notes=="string"?t.notes:(E=s.notes)!=null?E:""}},qm=t=>{const s=[];t.addressV4.trim()&&s.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&s.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(a=>Number(a.trim())).filter(a=>Number.isFinite(a)),i=or.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:s,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?i.notes=t.notes.trim():delete i.notes,i},Ym=t=>{if(!t)return[];try{const s=atob(t);return Array.from(s).map(r=>r.charCodeAt(0))}catch{return[]}},Gm=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const s=t;return s.host?s.port?`${s.host}:${s.port}`:s.host:""}return""},Xm=(t,s)=>{var m,p,g,x,S,y,v,T,N,W,he;if(!t||!(s!=null&&s.config))return null;const r=s.config,l=[],i=(p=(m=r.interface)==null?void 0:m.addresses)!=null?p:{};i.v4&&l.push(`${i.v4}/32`),i.v6&&l.push(`${i.v6}/128`);const o=(g=(Array.isArray(r.peers)?r.peers:[])[0])!=null?g:{},d=(S=(x=o.allowed_ips)!=null?x:o.allowedIPs)!=null?S:["0.0.0.0/0","::/0"];return or.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(v=(y=r.interface)==null?void 0:y.mtu)!=null?v:1420,secretKey:t.private_key,address:l,reserved:Ym(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(N=(T=o.public_key)!=null?T:t.public_key)!=null?N:"",endpoint:Gm(o.endpoint),allowedIPs:d,keepAlive:(he=(W=o.keep_alive)!=null?W:o.keepAlive)!=null?he:0}]}})},Ho=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},ua=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":Zn.sizeFormat(t),vr=({label:t,value:s})=>{const r=Oe("gray.500","gray.400");return n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:s||"-"})]})},Qm=({isOpen:t,onClose:s,initialOutbound:r,onSave:l,onDelete:i})=>{var O,G,pe,k,I;const{t:a}=Ke(),o=Zt(),[d,u]=c.exports.useState({...Aa}),[m,p]=c.exports.useState(null),[g,x]=c.exports.useState(null),[S,y]=c.exports.useState(null),[v,T]=c.exports.useState(""),[N,W]=c.exports.useState(!1),[he,E]=c.exports.useState(!1),[F,P]=c.exports.useState(!1),[j,q]=c.exports.useState(!1),[le,V]=c.exports.useState(!1);c.exports.useEffect(()=>{jp()},[]);const ce=c.exports.useCallback(async()=>{var U,Y;W(!0);try{const Ie=await Ee("/core/warp",{method:"GET"});p((U=Ie.account)!=null?U:null),x(null),y(null)}catch(Ie){o({title:a("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((Y=Ie==null?void 0:Ie.data)==null?void 0:Y.detail)||(Ie==null?void 0:Ie.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{W(!1)}},[o,a]);c.exports.useEffect(()=>{t&&ce().catch(()=>{})},[t,ce]),c.exports.useEffect(()=>{t&&u(Fo(r))},[r,t]),c.exports.useEffect(()=>{var U;T((U=m==null?void 0:m.license_key)!=null?U:"")},[m]);const A=(U,Y)=>{u(Ie=>({...Ie,[U]:Y}))},be=Oe("gray.600","gray.300"),f=Oe("gray.200","whiteAlpha.200"),te=()=>{const U=Oi();A("privateKey",U.privateKey),A("publicKey",U.publicKey),o({title:a("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},J=()=>{const U=Array.from({length:3},()=>Math.floor(Math.random()*256));A("reserved",U.join(","))},we=c.exports.useCallback((U,Y)=>{if(!U||!Y){y(null);return}const Ie=Xm(U,Y);Ie&&(y(Ie),u(Fo(Ie.toJson())))},[]),Te=async()=>{var U;E(!0);try{const Y=Oi(),Ie=await Ee("/core/warp/register",{method:"POST",body:{private_key:Y.privateKey,public_key:Y.publicKey}});p(Ie.account),x(Ie.config),we(Ie.account,Ie.config),o({title:a("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(Y){o({title:a("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((U=Y==null?void 0:Y.data)==null?void 0:U.detail)||(Y==null?void 0:Y.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{E(!1)}},Ne=async()=>{var U;if(!m){o({title:a("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}q(!0);try{const Y=await Ee("/core/warp/config",{method:"GET"});x(Y.config),we(m,Y.config),o({title:a("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(Y){o({title:a("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((U=Y==null?void 0:Y.data)==null?void 0:U.detail)||(Y==null?void 0:Y.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{q(!1)}},$=async()=>{var U;if(!!v.trim()){P(!0);try{const Y=await Ee("/core/warp/license",{method:"POST",body:{license_key:v.trim()}});p(Y.account),o({title:a("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(Y){o({title:a("pages.xray.warp.licenseFailed","Failed to update license."),description:((U=Y==null?void 0:Y.data)==null?void 0:U.detail)||(Y==null?void 0:Y.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{P(!1)}}},K=async()=>{var U;V(!0);try{await Ee("/core/warp",{method:"DELETE"}),p(null),x(null),y(null),i(),o({title:a("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(Y){o({title:a("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((U=Y==null?void 0:Y.data)==null?void 0:U.detail)||(Y==null?void 0:Y.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{V(!1)}},ee=()=>{if(!S)return;const U=S.toJson();l(U),o({title:a("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},_e=()=>{i(),u({...Aa}),o({title:a("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},xe=()=>{if(!d.privateKey.trim()||!d.publicKey.trim()||!d.endpoint.trim()){o({title:a("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const U=qm(d);l(U),s()},B=c.exports.useMemo(()=>Boolean(r),[r]);return n(Lt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),n(Ot,{children:[e(At,{children:a("pages.xray.warp.manage","Manage WARP")}),e(Wt,{}),e(Ct,{children:n(me,{spacing:5,align:"stretch",children:[n(zr,{status:"info",borderRadius:"md",children:[e(Rr,{}),e(Hn,{children:a("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:m?n(me,{spacing:4,align:"stretch",children:[n(Le,{columns:{base:1,md:2},spacing:4,children:[e(vr,{label:a("pages.xray.warp.accessToken","Access token"),value:m.access_token||"-"}),e(vr,{label:a("pages.xray.warp.deviceId","Device ID"),value:m.device_id||"-"}),e(vr,{label:a("pages.xray.warp.licenseKey","License key"),value:m.license_key||"-"}),e(vr,{label:a("pages.xray.warp.privateKey","Private key"),value:m.private_key||"-"}),e(vr,{label:a("pages.xray.warp.registeredAt","Registered at"),value:Ho(m.created_at)}),e(vr,{label:a("pages.xray.warp.updatedAt","Updated at"),value:Ho(m.updated_at)})]}),n(M,{spacing:3,flexWrap:"wrap",children:[e(L,{variant:"outline",onClick:Ne,isLoading:j,children:a("pages.xray.warp.fetchInfo","Refresh info")}),e(L,{variant:"ghost",colorScheme:"red",onClick:K,isLoading:le,children:a("pages.xray.warp.removeAccount","Remove account")})]})]}):n(me,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:be,children:a("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(L,{colorScheme:"primary",onClick:Te,isLoading:he||N,children:a("pages.xray.warp.registerAction","Create WARP device")})]})}),m&&n(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.licenseSection","WARP+/License key")}),n(M,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(De,{value:v,onChange:U=>T(U.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(L,{colorScheme:"primary",onClick:$,isLoading:F,isDisabled:!v.trim(),children:a("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:be,mt:2,children:a("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),n(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:[n(M,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:a("pages.xray.warp.remoteConfig","Remote configuration")}),g?e($r,{colorScheme:g.enabled?"green":"yellow",children:g.enabled?a("core.active","Active"):a("core.pending","Pending")}):e($r,{colorScheme:"gray",children:a("core.empty","Empty")})]}),g?n(ye,{spacing:4,children:[n(Le,{columns:{base:1,md:2},spacing:4,children:[e(vr,{label:a("core.name","Name"),value:(O=g.name)!=null?O:"-"}),e(vr,{label:a("core.model","Model"),value:(G=g.model)!=null?G:"-"}),e(vr,{label:a("core.status","Status"),value:g.enabled?a("core.enabled","Enabled"):a("core.disabled","Disabled")}),e(vr,{label:a("core.id","ID"),value:(pe=g.id)!=null?pe:"-"})]}),g.account&&n(Bt,{children:[e(Fn,{}),n(Le,{columns:{base:1,md:3},spacing:4,children:[e(vr,{label:a("core.type","Type"),value:(k=g.account.account_type)!=null?k:"-"}),e(vr,{label:a("core.role","Role"),value:(I=g.account.role)!=null?I:"-"}),e(vr,{label:a("pages.xray.warp.premiumData","WARP+ data"),value:ua(g.account.premium_data)}),e(vr,{label:a("core.quota","Quota"),value:ua(g.account.quota)}),e(vr,{label:a("core.usage","Usage"),value:ua(g.account.usage)})]})]}),n(M,{spacing:3,flexWrap:"wrap",children:[e(L,{colorScheme:"primary",onClick:ee,isDisabled:!S,children:a("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(L,{variant:"ghost",onClick:()=>x(null),children:a("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:be,children:a("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),n(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.manualTitle","Manual outbound")}),n(ye,{spacing:4,children:[n(C,{isRequired:!0,children:[e(_,{children:a("pages.xray.outbound.tag","Tag")}),e(De,{size:"sm",value:d.tag,onChange:U=>A("tag",U.target.value),placeholder:"warp"})]}),n(C,{isRequired:!0,children:[e(_,{children:a("pages.xray.warp.privateKey")}),e(Nr,{size:"sm",value:d.privateKey,onChange:U=>A("privateKey",U.target.value),rows:2})]}),n(C,{isRequired:!0,children:[e(_,{children:a("pages.xray.warp.publicKey")}),e(Nr,{size:"sm",value:d.publicKey,onChange:U=>A("publicKey",U.target.value),rows:2})]}),n(C,{children:[e(L,{size:"sm",colorScheme:"primary",onClick:te,children:a("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:be,mt:1,children:a("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),n(C,{isRequired:!0,children:[e(_,{children:a("pages.xray.warp.endpoint")}),e(De,{size:"sm",value:d.endpoint,onChange:U=>A("endpoint",U.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),n(C,{children:[e(_,{children:a("pages.xray.warp.addressV4","Client IPv4")}),e(De,{size:"sm",value:d.addressV4,onChange:U=>A("addressV4",U.target.value),placeholder:"172.16.0.2"}),e(cr,{children:a("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),n(C,{children:[e(_,{children:a("pages.xray.warp.addressV6","Client IPv6")}),e(De,{size:"sm",value:d.addressV6,onChange:U=>A("addressV6",U.target.value),placeholder:"2606:4700:****:****::****"})]}),n(C,{children:[e(_,{children:a("pages.xray.warp.reserved")}),e(De,{size:"sm",value:d.reserved,onChange:U=>A("reserved",U.target.value),placeholder:"0,0,0"}),e(cr,{children:a("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(L,{size:"xs",mt:2,variant:"ghost",onClick:J,children:a("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),n(C,{children:[e(_,{children:a("pages.xray.warp.mtu","MTU")}),e(xn,{size:"sm",min:576,max:1600,value:d.mtu,onChange:(U,Y)=>A("mtu",Y||1420),children:e(Sn,{})})]}),n(C,{children:[e(_,{children:a("pages.xray.warp.notes","Notes (optional)")}),e(Nr,{size:"sm",rows:2,value:d.notes,onChange:U=>A("notes",U.target.value)})]})]})]})]})}),n(Ut,{display:"flex",justifyContent:"space-between",children:[B?e(L,{colorScheme:"red",variant:"outline",onClick:_e,children:a("delete")}):e("span",{}),n(M,{spacing:3,children:[e(L,{variant:"ghost",onClick:s,children:a("cancel")}),e(L,{colorScheme:"primary",onClick:xe,children:a(B?"save":"add")})]})]})]})]})},Bs=oe(Nn,{baseStyle:{w:3.5,h:3.5}}),Vs=oe(wn,{baseStyle:{w:4,h:4}}),$s=oe(Bn,{baseStyle:{w:4,h:4}}),Bo=oe(El,{baseStyle:{w:4,h:4}}),Vo=oe(Nl,{baseStyle:{w:4,h:4}}),$o=oe(cn,{baseStyle:{w:4,h:4}}),Zm=oe(kd,{baseStyle:{w:4,h:4}}),jm=oe(Cd,{baseStyle:{w:4,h:4}}),eg=oe(Al,{baseStyle:{w:4,h:4}}),tg=oe(_d,{baseStyle:{w:4,h:4}}),rg=oe(Na,{baseStyle:{w:4,h:4}}),ng=oe(Dd,{baseStyle:{w:4,h:4}}),sg=oe(Ad,{baseStyle:{w:4,h:4}}),ig=oe(Id,{baseStyle:{w:4,h:4}}),ag=oe(Pd,{baseStyle:{w:4,h:4}}),Ko=oe(Td,{baseStyle:{w:4,h:4}}),Ks={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},Di=t=>JSON.stringify(t!=null?t:{}),Jo=t=>Array.isArray(t)?t.join(","):t!=null?t:"",og=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],ha=({title:t,children:s})=>{const r=Oe("gray.50","whiteAlpha.100"),l=Oe("gray.200","whiteAlpha.300");return n(z,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(z,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(z,{overflowX:"auto",children:e(rs,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(on,{children:s})})})]})},nn=({label:t,controlId:s,children:r})=>{const l=Oe("gray.700","whiteAlpha.800");return n(Rt,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Ue,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(_,{htmlFor:s,mb:{base:2,md:0},color:l,children:t})}),e(Ue,{py:3,display:{base:"block",md:"table-cell"},children:e(C,{id:s,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(s)})})]})},Js=({children:t})=>{const s=Oe("gray.200","whiteAlpha.200"),r=Oe("white","blackAlpha.400"),l=Oe("sm","none");return e(z,{borderWidth:"1px",borderColor:s,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(z,{overflowX:"auto",children:t})})},qs=({children:t,...s})=>{const r=Oe("gray.50","whiteAlpha.100"),l=Oe("gray.200","whiteAlpha.300"),i=Oe("gray.300","whiteAlpha.300"),a=Oe("gray.100","whiteAlpha.200"),o=Oe("gray.50","whiteAlpha.100");return e(rs,{size:"sm",w:"full",...s,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:i,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:a,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:o}},children:t})},lg=()=>{var Rs,Us,Ms,Ls,Os;const{t}=Ke(),{fetchCoreSettings:s,updateConfig:r,isLoading:l,config:i,isPostLoading:a,restartCore:o}=Im(),{userData:d,getUserIsSuccess:u}=hr();if(!(u&&Boolean((Rs=d.permissions)==null?void 0:Rs.sections.xray)))return n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.xraySettings","Xray settings")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("xraySettings.noPermission","You do not have permission to manage Xray settings.")})]});const{onEditingCore:p}=Tt(),g=Zt(),{isOpen:x,onOpen:S,onClose:y}=Qt(),{isOpen:v,onOpen:T,onClose:N}=Qt(),{isOpen:W,onOpen:he,onClose:E}=Qt(),{isOpen:F,onOpen:P,onClose:j}=Qt(),{isOpen:q,onOpen:le,onClose:V}=Qt(),{isOpen:ce,onOpen:A,onClose:be}=Qt(),f=en({defaultValues:{config:i||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),te=c.exports.useRef(Di(f.getValues("config"))),J=sr({control:f.control,name:"config"}),we=c.exports.useMemo(()=>Di(J)!==te.current,[J]),[Te,Ne]=c.exports.useState([]),[$,K]=c.exports.useState([]),[ee,_e]=c.exports.useState([]),[xe,B]=c.exports.useState([]),[O,G]=c.exports.useState([]),[pe,k]=c.exports.useState([]),[I,U]=c.exports.useState(null),[Y,Ie]=c.exports.useState(null),[Se,He]=c.exports.useState(!1),[R,re]=c.exports.useState("xraySetting"),[H,ge]=c.exports.useState(""),dt=Ur({base:!0,md:!1}),[lt,st]=c.exports.useState(0),[ve,Be]=c.exports.useState(""),[Je,se]=c.exports.useState(""),Ye=c.exports.useCallback(b=>b.map((w,ae)=>{var je,ct;return{key:`${ae}-${(ct=(je=w.tag)!=null?je:w.protocol)!=null?ct:"outbound"}`,...w}}),[]),ie=c.exports.useCallback(b=>{Ne(Ye(b))},[Ye]),D=c.exports.useCallback(()=>{const b=f.getValues("config.outbounds");return Array.isArray(b)?JSON.parse(JSON.stringify(b)):[]},[f]),de=c.exports.useCallback(b=>{f.setValue("config.outbounds",b,{shouldDirty:!0}),ie(b),st(w=>w+1)},[f,ie]),ze=c.exports.useCallback(b=>b.map((w,ae)=>{var je,ct,et,Dt,Ar,qn,ue,yt,ot,wt,Mt,rn,mn,gn,fn;return{key:`${ae}-${(ct=(je=w.outboundTag)!=null?je:w.balancerTag)!=null?ct:"rule"}`,source:(et=w.source)!=null?et:[],sourcePort:(Dt=w.sourcePort)!=null?Dt:[],network:(Ar=w.network)!=null?Ar:[],protocol:(qn=w.protocol)!=null?qn:[],attrs:w.attrs?JSON.stringify(w.attrs,null,2):"",ip:(ue=w.ip)!=null?ue:[],domain:(yt=w.domain)!=null?yt:[],port:(ot=w.port)!=null?ot:[],inboundTag:(wt=w.inboundTag)!=null?wt:[],user:(Mt=w.user)!=null?Mt:[],outboundTag:(rn=w.outboundTag)!=null?rn:"",balancerTag:(mn=w.balancerTag)!=null?mn:"",type:(gn=w.type)!=null?gn:"field",domainMatcher:(fn=w.domainMatcher)!=null?fn:""}}),[]),Ge=c.exports.useCallback(b=>{K(ze(b))},[ze]),tt=c.exports.useCallback(b=>{f.setValue("config.routing.rules",b,{shouldDirty:!0}),Ge(b),st(w=>w+1)},[f,Ge]),qe=c.exports.useCallback(()=>{const b=f.getValues("config.routing.rules");return Array.isArray(b)?JSON.parse(JSON.stringify(b)):[]},[f]);c.exports.useEffect(()=>{const b=()=>{He(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",b),()=>{document.removeEventListener("fullscreenchange",b)}},[]),c.exports.useEffect(()=>(p(!0),s().then(()=>{console.log("Core settings fetched successfully")}).catch(b=>{g({title:t("core.errorFetchingConfig"),description:b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>p(!1)),[s,p,g,t]),c.exports.useEffect(()=>{var b,w,ae,je;i&&(f.reset({config:i}),te.current=Di(i),ie((i==null?void 0:i.outbounds)||[]),Ge(((b=i==null?void 0:i.routing)==null?void 0:b.rules)||[]),_e(((ae=(w=i==null?void 0:i.routing)==null?void 0:w.balancers)==null?void 0:ae.map((ct,et)=>{var Dt;return{key:et,tag:ct.tag||"",strategy:((Dt=ct.strategy)==null?void 0:Dt.type)||"random",selector:ct.selector||[],fallbackTag:ct.fallbackTag||""}}))||[]),B(((je=i==null?void 0:i.dns)==null?void 0:je.servers)||[]),G((i==null?void 0:i.fakedns)||[]),ge(i!=null&&i.observatory?"observatory":i!=null&&i.burstObservatory?"burstObservatory":""),st(ct=>ct+1))},[i,f,ie,Ge]);const{mutate:Vt,isLoading:$t}=Hr(o,{onSuccess:()=>{g({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:b=>{var w,ae;g({title:t("core.generalErrorMessage"),description:((ae=(w=b.response)==null?void 0:w.data)==null?void 0:ae.detail)||b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Kt=f.handleSubmit(({config:b})=>{r(b).then(()=>{f.reset({config:b}),te.current=Di(b),g({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(w=>{let ae=t("core.generalErrorMessage");typeof w.response._data.detail=="object"&&(ae=w.response._data.detail[Object.keys(w.response._data.detail)[0]]),typeof w.response._data.detail=="string"&&(ae=w.response._data.detail),g({title:ae,status:"error",isClosable:!0,position:"top",duration:3e3})})}),Me=async()=>{const b=await Ee("/panel/xray/getOutboundsTraffic");b!=null&&b.success&&k(b.obj)},it=()=>{Ie(null),y()},Jt=()=>{Ie(null),S()},nr=b=>{Ie(b),S()},kr=b=>{const w=D();b<0||b>=w.length||(w.splice(b,1),de(w))},pr=(b,w)=>{const ae=D();if(b<0||b>=ae.length||w<0||w>=ae.length)return;const[je]=ae.splice(b,1);ae.splice(w,0,je),de(ae)},gr=b=>{pr(b,b-1)},fr=b=>{pr(b,b+1)},ne=()=>{U(null),T()},Ae=b=>{U(b),T()},Q=b=>{const w=qe();w.splice(b,1),tt(w)},Xe=(b,w)=>{const ae=qe();if(b<0||b>=ae.length||w<0||w>=ae.length)return;const[je]=ae.splice(b,1);ae.splice(w,0,je),tt(ae)},_t=b=>{const w=qe();I!==null&&I>=0&&I<w.length?w[I]=b:w.push(b),tt(w),U(null)},qt=()=>{U(null),N()},Nt=()=>{he()},zt=b=>{he()},pt=b=>{const w=[...ee],ae=w.splice(b,1)[0];f.setValue("config.routing.balancers",w,{shouldDirty:!0}),_e(w);const je={...f.getValues("config")};je.observatory&&(je.observatory.subjectSelector=je.observatory.subjectSelector.filter(ct=>ct!==ae.tag)),je.burstObservatory&&(je.burstObservatory.subjectSelector=je.burstObservatory.subjectSelector.filter(ct=>ct!==ae.tag)),f.setValue("config",je,{shouldDirty:!0})},mt=()=>{P()},It=b=>{P()},ir=b=>{const w=[...xe];w.splice(b,1),f.setValue("config.dns.servers",w,{shouldDirty:!0}),B(w)},Cr=()=>{le()},Kr=b=>{le()},Z=b=>{const w=[...O];w.splice(b,1),f.setValue("config.fakedns",w.length>0?w:null,{shouldDirty:!0}),G(w)},Pe=b=>{var w,ae,je,ct,et;switch(b.protocol){case"vmess":case"vless":return((w=b.settings.vnext)==null?void 0:w.map(Dt=>`${Dt.address}:${Dt.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((ae=b.settings.servers)==null?void 0:ae.map(Dt=>`${Dt.address}:${Dt.port}`))||[];case"dns":return[`${(je=b.settings)==null?void 0:je.address}:${(ct=b.settings)==null?void 0:ct.port}`];case"wireguard":return((et=b.settings.peers)==null?void 0:et.map(Dt=>Dt.endpoint))||[];default:return[]}},Ve=b=>{const w=pe.find(ae=>ae.tag===b.tag);return w?`${Zn.sizeFormat(w.up)} / ${Zn.sizeFormat(w.down)}`:`${Zn.sizeFormat(0)} / ${Zn.sizeFormat(0)}`},Ze=c.exports.useMemo(()=>Array.isArray(J==null?void 0:J.outbounds)?J.outbounds:[],[J]),vt=c.exports.useMemo(()=>{var b;return Array.isArray((b=J==null?void 0:J.routing)==null?void 0:b.rules)?J.routing.rules:[]},[J]),jt=c.exports.useMemo(()=>{var b;return Array.from(new Set(((b=J==null?void 0:J.inbounds)!=null?b:[]).map(w=>w==null?void 0:w.tag).filter(w=>Boolean(w))))},[J]),br=c.exports.useMemo(()=>Array.from(new Set(Ze.map(b=>b==null?void 0:b.tag).filter(b=>Boolean(b)))),[Ze]),Wr=c.exports.useMemo(()=>{var b,w;return Array.from(new Set(((w=(b=J==null?void 0:J.routing)==null?void 0:b.balancers)!=null?w:[]).map(ae=>ae==null?void 0:ae.tag).filter(ae=>Boolean(ae))))},[J]),mr=c.exports.useMemo(()=>Ze.length===0?-1:Ze.findIndex(b=>(b==null?void 0:b.protocol)==="freedom"),[Ze]),_r=c.exports.useMemo(()=>{var w,ae;if(mr<0)return"";const b=Ze[mr];return(ae=(w=b==null?void 0:b.settings)==null?void 0:w.domainStrategy)!=null?ae:""},[mr,Ze]),Jr=b=>{const w=f.getValues("config")||{},ae=Array.isArray(w.outbounds)?JSON.parse(JSON.stringify(w.outbounds)):[],je=ae.findIndex(Dt=>(Dt==null?void 0:Dt.protocol)==="freedom");if(je===-1)return;const ct={...ae[je]},et={...ct.settings||{}};b?et.domainStrategy=b:delete et.domainStrategy,ct.settings=et,ae[je]=ct,f.setValue("config.outbounds",ae,{shouldDirty:!0}),Ne(ae.map((Dt,Ar)=>({key:Ar,...Dt}))),st(Dt=>Dt+1)},kn=c.exports.useMemo(()=>{var b;return(b=Ze.find(w=>(w==null?void 0:w.tag)==="warp"))!=null?b:null},[Ze]),qr=c.exports.useMemo(()=>Ze.findIndex(b=>(b==null?void 0:b.tag)==="warp"),[Ze])!==-1,Dr=c.exports.useMemo(()=>{const b=vt.find(w=>w.outboundTag==="warp");return Array.isArray(b==null?void 0:b.domain)?b.domain:[]},[vt]),ke=b=>{const w=b.map(et=>et.trim()).filter((et,Dt,Ar)=>et.length>0&&Ar.indexOf(et)===Dt),ae=qe(),je=ae.findIndex(et=>et.outboundTag==="warp");if(w.length===0){je!==-1&&(ae.splice(je,1),tt(ae));return}const ct={type:"field",outboundTag:"warp",domain:w};je!==-1?ae[je]={...ae[je],...ct}:ae.push(ct),tt(ae)},Yr=b=>{const w=b.trim();if(!!w){if(Dr.includes(w)){g({title:t("pages.xray.warp.domainExists","This domain already exists in the list."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}ke([...Dr,w])}},Gr=b=>{ke(Dr.filter(w=>w!==b))},yr=c.exports.useMemo(()=>og.filter(b=>!Dr.includes(b.value)),[Dr]),un=Oe("white","blackAlpha.400"),Xr=Oe("gray.200","whiteAlpha.200"),Ft=Oe("gray.600","gray.300"),Cn=b=>{var ct;const w=D(),ae=(ct=b.tag)!=null?ct:"warp",je=w.findIndex(et=>(et==null?void 0:et.tag)===ae);je>=0?w[je]=b:w.push(b),de(w)},Yt=()=>{const b=D(),w=b.findIndex(ae=>(ae==null?void 0:ae.tag)==="warp");w!==-1&&(b.splice(w,1),de(b),ke([]),Be(""),se(""))},hn=b=>{const w=D();Y!==null&&Y>=0&&Y<w.length?w[Y]=b:w.push(b),de(w),Ie(null)},_n=()=>{be()},tn=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{He(!1)}).catch(b=>{console.error("Error exiting fullscreen:",b)}):document.documentElement.requestFullscreen().then(()=>{He(!0)}).catch(b=>{console.error("Error entering fullscreen:",b)})},pn=()=>{var w,ae,je,ct;const b=f.getValues("config")||{};switch(R){case"inboundSettings":return JSON.stringify((w=b.inbounds)!=null?w:[],null,2);case"outboundSettings":return JSON.stringify((ae=b.outbounds)!=null?ae:[],null,2);case"routingRuleSettings":return JSON.stringify((ct=(je=b.routing)==null?void 0:je.rules)!=null?ct:[],null,2);case"xraySetting":default:return JSON.stringify(b!=null?b:{},null,2)}},Un=b=>{var w,ae,je,ct;try{const et=JSON.parse(b),Dt={...f.getValues("config")||{}};switch(R){case"inboundSettings":Dt.inbounds=et;break;case"outboundSettings":Dt.outbounds=et,ie(et);break;case"routingRuleSettings":Dt.routing||(Dt.routing={}),Dt.routing.rules=et,Ge(et);break;case"xraySetting":default:f.setValue("config",et,{shouldDirty:!0}),ie((et==null?void 0:et.outbounds)||[]),Ge(((w=et==null?void 0:et.routing)==null?void 0:w.rules)||[]),_e(((je=(ae=et==null?void 0:et.routing)==null?void 0:ae.balancers)==null?void 0:je.map((Ar,qn)=>{var ue;return{key:qn,tag:Ar.tag||"",strategy:((ue=Ar.strategy)==null?void 0:ue.type)||"random",selector:Ar.selector||[],fallbackTag:Ar.fallbackTag||""}}))||[]),B(((ct=et==null?void 0:et.dns)==null?void 0:ct.servers)||[]),G((et==null?void 0:et.fakedns)||[]);return}f.setValue("config",Dt,{shouldDirty:!0})}catch{}},Dn=()=>{var w,ae;const b=f.getValues("config")||{};return H==="observatory"?JSON.stringify((w=b.observatory)!=null?w:{},null,2):H==="burstObservatory"?JSON.stringify((ae=b.burstObservatory)!=null?ae:{},null,2):""},Ki=b=>{try{const w=JSON.parse(b),ae={...f.getValues("config")||{}};H==="observatory"&&(ae.observatory=w),H==="burstObservatory"&&(ae.burstObservatory=w),f.setValue("config",ae,{shouldDirty:!0})}catch{}},Ji=b=>!b&&b!==0?[]:Array.isArray(b)?b.map(w=>typeof w=="string"?w.trim():String(w)).filter(Boolean):typeof b=="string"?b.split(",").map(w=>w.trim()).filter(Boolean):[String(b)],An=(b,w="blue")=>{const ae=Ji(b);return ae.length?e(Em,{chips:ae,color:w}):e(h,{color:"gray.400",children:"-"})},us=b=>{if(b==null||b===""||typeof b=="string"&&!b.trim())return e(h,{color:"gray.400",children:"-"});const w=typeof b=="string"?b:String(b);return w.length>30?e(Nm,{text:w,label:t("details")}):e(h,{children:w})},qi=b=>{if(!b)return e(h,{color:"gray.400",children:"-"});try{const w=JSON.parse(b);if(w&&typeof w=="object"&&!Array.isArray(w)){const ae=Object.entries(w);return ae.length?e(z,{display:"flex",flexWrap:"wrap",gap:"1",children:ae.map(([je,ct])=>e(ut,{colorScheme:"purple",size:"sm",children:`${je}: ${String(ct)}`},je))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:b})},Yi=Dn(),Gi=pn();return n(me,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(ye,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:n(ye,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(L,{size:"sm",colorScheme:"primary",isLoading:a,isDisabled:!we||a,onClick:Kt,w:{base:"full",sm:"auto"},children:t("core.save")}),e(L,{size:"sm",leftIcon:e($o,{}),isLoading:$t,onClick:()=>Vt(),variant:"outline",w:{base:"full",sm:"auto"},children:t($t?"core.restarting":"core.restartCore")})]})}),n(ls,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[n(cs,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(er,{children:n(M,{spacing:2,align:"center",children:[e(eg,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(er,{children:n(M,{spacing:2,align:"center",children:[e(tg,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(er,{children:n(M,{spacing:2,align:"center",children:[e(rg,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(er,{children:n(M,{spacing:2,align:"center",children:[e(ng,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(er,{children:n(M,{spacing:2,align:"center",children:[e(sg,{}),e(h,{as:"span",children:t("DNS")})]})}),e(er,{children:n(M,{spacing:2,align:"center",children:[e(ig,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(er,{children:n(M,{spacing:2,align:"center",children:[e(ag,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),n(ds,{children:[e(tr,{children:n(me,{spacing:4,align:"stretch",children:[n(ha,{title:t("pages.xray.generalConfigs"),children:[e(nn,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:b=>n(rt,{id:b,size:"sm",maxW:"220px",value:_r,onChange:w=>Jr(w.target.value),isDisabled:mr===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(w=>e("option",{value:w,children:w},w))]})}),e(nn,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:b=>e(xt,{name:"config.routing.domainStrategy",control:f.control,render:({field:w})=>e(rt,{...w,id:b,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(ae=>e("option",{value:ae,children:ae},ae))})})})]}),e(z,{borderWidth:"1px",borderColor:Xr,borderRadius:"lg",bg:un,p:{base:3,md:4},children:n(me,{align:"stretch",spacing:3,children:[n(M,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(L,{variant:"outline",size:"sm",leftIcon:e(Ko,{}),onClick:A,children:qr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:Ft,children:t("pages.xray.warpRoutingDesc")}),n(xs,{children:[Dr.length===0&&e(jn,{children:e(ut,{colorScheme:"gray",variant:"subtle",children:e(ti,{children:t("core.empty","Empty")})})}),Dr.map(b=>e(jn,{children:n(ut,{colorScheme:"primary",borderRadius:"full",children:[e(ti,{children:b}),e(Ni,{"aria-label":t("core.remove"),onClick:()=>Gr(b)})]})},b))]}),n(M,{spacing:3,flexWrap:"wrap",children:[e(rt,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:ve,onChange:b=>{const{value:w}=b.target;w&&Yr(w),Be("")},isDisabled:yr.length===0,children:yr.map(b=>e("option",{value:b.value,children:b.label},b.value))}),n(M,{spacing:2,maxW:"320px",flex:"1",children:[e(De,{size:"sm",value:Je,onChange:b=>se(b.target.value),placeholder:"geosite:google"}),e(L,{size:"sm",colorScheme:"primary",onClick:()=>{Yr(Je),se("")},isDisabled:!Je.trim(),children:t("core.add")})]})]})]})}),n(ha,{title:t("pages.xray.statistics"),children:[e(nn,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:b=>e(xt,{name:"config.policy.system.statsInboundUplink",control:f.control,render:({field:w})=>e(bt,{id:b,isChecked:!!w.value,onChange:ae=>w.onChange(ae.target.checked)})})}),e(nn,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:b=>e(xt,{name:"config.policy.system.statsInboundDownlink",control:f.control,render:({field:w})=>e(bt,{id:b,isChecked:!!w.value,onChange:ae=>w.onChange(ae.target.checked)})})}),e(nn,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:b=>e(xt,{name:"config.policy.system.statsOutboundUplink",control:f.control,render:({field:w})=>e(bt,{id:b,isChecked:!!w.value,onChange:ae=>w.onChange(ae.target.checked)})})}),e(nn,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:b=>e(xt,{name:"config.policy.system.statsOutboundDownlink",control:f.control,render:({field:w})=>e(bt,{id:b,isChecked:!!w.value,onChange:ae=>w.onChange(ae.target.checked)})})})]}),n(ha,{title:t("pages.xray.logConfigs"),children:[e(nn,{label:t("pages.xray.logLevel"),controlId:"log-level",children:b=>e(xt,{name:"config.log.loglevel",control:f.control,render:({field:w})=>e(rt,{...w,id:b,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(ae=>e("option",{value:ae,children:ae},ae))})})}),e(nn,{label:t("pages.xray.accessLog"),controlId:"access-log",children:b=>e(xt,{name:"config.log.access",control:f.control,render:({field:w})=>n(rt,{...w,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(ae=>e("option",{value:ae,children:ae},ae))]})})}),e(nn,{label:t("pages.xray.errorLog"),controlId:"error-log",children:b=>e(xt,{name:"config.log.error",control:f.control,render:({field:w})=>n(rt,{...w,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(ae=>e("option",{value:ae,children:ae},ae))]})})}),e(nn,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:b=>e(xt,{name:"config.log.maskAddress",control:f.control,render:({field:w})=>n(rt,{...w,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(ae=>e("option",{value:ae,children:ae},ae))]})})}),e(nn,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:b=>e(xt,{name:"config.log.dnsLog",control:f.control,render:({field:w})=>e(bt,{id:b,isChecked:!!w.value,onChange:ae=>w.onChange(ae.target.checked)})})})]})]})}),e(tr,{children:n(me,{spacing:4,align:"stretch",children:[e(L,{leftIcon:e(Bs,{}),...Ks,onClick:ne,children:t("pages.xray.rules.add")}),e(Js,{children:n(qs,{minW:"1100px",children:[n(bn,{children:[n(Rt,{children:[e($e,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e($e,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e($e,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e($e,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e($e,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e($e,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e($e,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e($e,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),n(Rt,{children:[e($e,{children:t("IP",{defaultValue:"IP"})}),e($e,{children:t("port",{defaultValue:"Port"})}),e($e,{children:t("network",{defaultValue:"Network"})}),e($e,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e($e,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e($e,{children:t("IP",{defaultValue:"IP"})}),e($e,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e($e,{children:t("port",{defaultValue:"Port"})}),e($e,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e($e,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),n(on,{children:[$.length===0&&e(Rt,{children:e(Ue,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),$.map((b,w)=>n(Rt,{children:[e(Ue,{children:n(me,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:w+1}),n(M,{spacing:1,children:[e(We,{"aria-label":"move up",icon:e(Bo,{}),size:"xs",variant:"ghost",isDisabled:w===0,onClick:()=>Xe(w,w-1)}),e(We,{"aria-label":"move down",icon:e(Vo,{}),size:"xs",variant:"ghost",isDisabled:w===$.length-1,onClick:()=>Xe(w,w+1)})]})]})}),e(Ue,{children:An(b.source,"blue")}),e(Ue,{children:us(b.sourcePort)}),e(Ue,{children:An(b.network,"purple")}),e(Ue,{children:An(b.protocol,"green")}),e(Ue,{children:qi(b.attrs)}),e(Ue,{children:An(b.ip,"blue")}),e(Ue,{children:An(b.domain,"blue")}),e(Ue,{children:us(b.port)}),e(Ue,{children:An(b.inboundTag,"teal")}),e(Ue,{children:An(b.user,"cyan")}),e(Ue,{children:us(b.outboundTag)}),e(Ue,{children:us(b.balancerTag)}),e(Ue,{children:n(M,{spacing:1,children:[e(We,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>Ae(w)}),e(We,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Q(w)})]})})]},b.key))]})]})})]})}),e(tr,{children:n(me,{spacing:4,align:"stretch",children:[n(M,{children:[e(L,{leftIcon:e(Bs,{}),...Ks,onClick:Jt,children:t("pages.xray.outbound.addOutbound")}),e(L,{leftIcon:e(Ko,{}),size:"xs",variant:"ghost",onClick:A,children:qr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(L,{leftIcon:e($o,{}),size:"xs",variant:"ghost",onClick:Me,children:t("refresh")})]}),e(Js,{children:n(qs,{minW:"880px",children:[e(bn,{children:n(Rt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.outbound.tag")}),e($e,{children:t("protocol")}),e($e,{children:t("pages.xray.outbound.address")}),e($e,{children:t("pages.inbounds.traffic")})]})}),e(on,{children:Te.map((b,w)=>{var ae,je,ct;return n(Rt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(We,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(Bo,{}),size:"xs",variant:"ghost",isDisabled:w===0,onClick:()=>gr(w)}),e(We,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(Vo,{}),size:"xs",variant:"ghost",isDisabled:w===Te.length-1,onClick:()=>fr(w)}),e(We,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>nr(w)}),e(We,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>kr(w)})]})}),e(Ue,{children:b.tag}),n(Ue,{children:[e(ut,{colorScheme:"purple",children:b.protocol}),["vmess","vless","trojan","shadowsocks"].includes(b.protocol)&&n(Bt,{children:[e(ut,{colorScheme:"blue",children:(ae=b.streamSettings)==null?void 0:ae.network}),((je=b.streamSettings)==null?void 0:je.security)==="tls"&&e(ut,{colorScheme:"green",children:"tls"}),((ct=b.streamSettings)==null?void 0:ct.security)==="reality"&&e(ut,{colorScheme:"green",children:"reality"})]})]}),e(Ue,{children:Pe(b).map(et=>e(h,{children:et},et))}),e(Ue,{children:e(ut,{colorScheme:"green",children:Ve(b)})})]},b.key)})})]})})]})}),e(tr,{children:n(me,{spacing:4,align:"stretch",children:[e(L,{leftIcon:e(Bs,{}),...Ks,onClick:Nt,children:t("pages.xray.balancer.addBalancer")}),e(Js,{children:n(qs,{minW:"680px",children:[e(bn,{children:n(Rt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.balancer.tag")}),e($e,{children:t("pages.xray.balancer.balancerStrategy")}),e($e,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(on,{children:ee.map((b,w)=>n(Rt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(We,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>zt()}),e(We,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>pt(w)})]})}),e(Ue,{children:b.tag}),e(Ue,{children:e(ut,{colorScheme:b.strategy==="random"?"purple":"green",children:b.strategy==="random"?"Random":b.strategy==="roundRobin"?"Round Robin":b.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Ue,{children:b.selector.map(ae=>e(ut,{colorScheme:"blue",m:1,children:ae},ae))})]},b.key))})]})}),(((Us=f.getValues("config"))==null?void 0:Us.observatory)||((Ms=f.getValues("config"))==null?void 0:Ms.burstObservatory))&&n(me,{spacing:3,align:"stretch",children:[e(ci,{onChange:b=>{ge(b),st(w=>w+1)},value:H,children:n(M,{spacing:3,children:[((Ls=f.getValues("config"))==null?void 0:Ls.observatory)&&e(Br,{value:"observatory",children:"Observatory"}),((Os=f.getValues("config"))==null?void 0:Os.burstObservatory)&&e(Br,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(z,{h:"300px",children:e(Da,{json:Yi,onChange:b=>Ki(b)},`obs-${H}-${lt}`)})]})]})}),e(tr,{children:n(me,{spacing:4,align:"stretch",children:[n(C,{display:"flex",alignItems:"center",children:[e(_,{children:t("pages.xray.dns.enable")}),e(xt,{name:"config.dns",control:f.control,render:({field:b})=>e(bt,{isChecked:!!b.value,onChange:w=>{const ae={...f.getValues("config")};w.target.checked?ae.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete ae.dns,delete ae.fakedns),f.setValue("config",ae,{shouldDirty:!0}),B([]),G([])}})})]}),xe.length>0&&n(Bt,{children:[e(L,{leftIcon:e(Bs,{}),...Ks,onClick:mt,children:t("pages.xray.dns.add")}),e(Js,{children:n(qs,{minW:"720px",children:[e(bn,{children:n(Rt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.outbound.address")}),e($e,{children:t("pages.xray.dns.domains")}),e($e,{children:t("pages.xray.dns.expectIPs")})]})}),e(on,{children:xe.map((b,w)=>n(Rt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(We,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>It()}),e(We,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ir(w)})]})}),e(Ue,{children:typeof b=="object"?b.address:b}),e(Ue,{children:typeof b=="object"?Jo(b.domains):""}),e(Ue,{children:typeof b=="object"?Jo(b.expectIPs):""})]},w))})]})})]}),O.length>0&&n(Bt,{children:[e(L,{leftIcon:e(Bs,{}),...Ks,onClick:Cr,children:t("pages.xray.fakedns.add")}),e(Js,{children:n(qs,{minW:"520px",children:[e(bn,{children:n(Rt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.fakedns.ipPool")}),e($e,{children:t("pages.xray.fakedns.poolSize")})]})}),e(on,{children:O.map((b,w)=>n(Rt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(We,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>Kr()}),e(We,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Z(w)})]})}),e(Ue,{children:b.ipPool}),e(Ue,{children:b.poolSize})]},w))})]})})]})]})}),e(tr,{children:n(me,{spacing:4,align:"stretch",children:[n(z,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(z,{px:2,children:e(ci,{onChange:b=>{re(b),st(w=>w+1)},value:R,children:n(M,{spacing:3,wrap:"wrap",children:[e(Br,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Br,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Br,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Br,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),n(z,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(We,{position:Se?"fixed":"absolute",top:2,right:2,"aria-label":Se?"Exit Full Screen":"Full Screen",icon:Se?e(jm,{}):e(Zm,{}),onClick:tn,zIndex:Se?1101:10}),e(z,{w:Se?"100vw":"100%",h:Se?"100vh":"100%",position:Se?"fixed":"relative",top:Se?0:"auto",left:Se?0:"auto",zIndex:Se?1e3:"auto",children:e(Da,{json:Gi,onChange:b=>{Un(b)}},`advanced-${R}-${lt}`)}),Se&&dt&&e(L,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:tn,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(tr,{children:e(z,{children:e(ic,{showTitle:!1})})})]})]}),e(Mm,{isOpen:x,onClose:it,mode:Y!==null?"edit":"create",initialOutbound:Y!==null?Ze[Y]:null,onSubmitOutbound:hn}),e(Vm,{isOpen:v,mode:I!==null?"edit":"create",initialRule:I!==null&&vt[I]||null,availableInboundTags:jt,availableOutboundTags:br,availableBalancerTags:Wr,onSubmit:_t,onClose:qt}),e(Qm,{isOpen:ce,onClose:_n,initialOutbound:kn,onSave:Cn,onDelete:Yt}),e($m,{isOpen:W,onClose:E,form:f,setBalancersData:_e}),e(Km,{isOpen:F,onClose:j,form:f,setDnsServers:B}),e(Jm,{isOpen:q,onClose:V,form:f,setFakeDns:G})]})},cg=({isOpen:t,onClose:s,onSubmit:r,isSaving:l,allHosts:i,allAdmins:a,initialService:o})=>{var J,we,Te,Ne;const{t:d}=Ke(),[u,m]=c.exports.useState((J=o==null?void 0:o.name)!=null?J:""),[p,g]=c.exports.useState((we=o==null?void 0:o.description)!=null?we:""),[x,S]=c.exports.useState((Te=o==null?void 0:o.admin_ids)!=null?Te:[]),[y,v]=c.exports.useState((Ne=o==null?void 0:o.hosts.map($=>$.id))!=null?Ne:[]),[T,N]=c.exports.useState(""),[W,he]=c.exports.useState(""),[E,F]=c.exports.useState(null),P=Zt();c.exports.useEffect(()=>{var $,K,ee,_e;t&&(m(($=o==null?void 0:o.name)!=null?$:""),g((K=o==null?void 0:o.description)!=null?K:""),S((ee=o==null?void 0:o.admin_ids)!=null?ee:[]),v((_e=o==null?void 0:o.hosts.map(xe=>xe.id))!=null?_e:[]),N(""),he(""))},[t,o]);const j=c.exports.useMemo(()=>new Map(i.map($=>[$.id,$])),[i]),q=c.exports.useMemo(()=>i.filter($=>!y.includes($.id)&&!$.isDisabled),[i,y]),le=c.exports.useMemo(()=>{const $=W.trim().toLowerCase();return $?q.filter(K=>{const ee=K.label.toLowerCase(),_e=K.inboundTag.toLowerCase(),xe=K.protocol.toLowerCase();return ee.includes($)||_e.includes($)||xe.includes($)}):q},[q,W]),V=c.exports.useMemo(()=>{const $=T.trim().toLowerCase();return $?a.filter(K=>K.username.toLowerCase().includes($)):a},[T,a]),ce=c.exports.useMemo(()=>new Set(x),[x]),A=$=>{S(K=>K.includes($)?K.filter(ee=>ee!==$):[...K,$])},be=$=>{v(K=>K.includes($)?K.filter(ee=>ee!==$):[...K,$])},f=($,K)=>{v(ee=>{const _e=ee.indexOf($);if(_e===-1)return ee;const xe=K==="up"?_e-1:_e+1;if(xe<0||xe>=ee.length)return ee;const B=[...ee];return[B[_e],B[xe]]=[B[xe],B[_e]],B})},te=async()=>{if(!u.trim()){P({status:"warning",title:d("services.validation.nameRequired","Service name is required")});return}if(!y.length){P({status:"warning",title:d("services.validation.hostRequired","Please select at least one host")});return}const $=y.map((K,ee)=>({host_id:K,sort:ee}));await r({name:u.trim(),description:(p==null?void 0:p.trim())||null,admin_ids:x,hosts:$},o==null?void 0:o.id)};return n(Lt,{isOpen:t,onClose:s,size:"5xl",children:[e(kt,{}),n(Ot,{children:[e(At,{children:o?d("services.editTitle","Edit Service"):d("services.createTitle","Create Service")}),e(Wt,{}),e(Ct,{children:n(ye,{spacing:6,children:[n(M,{spacing:4,children:[e(ur,{label:d("services.fields.name","Name"),value:u,onChange:$=>m($.target.value),maxLength:128,isRequired:!0}),e(ur,{label:d("services.fields.description","Description"),value:p!=null?p:"",onChange:$=>g($.target.value),maxLength:256})]}),n(z,{children:[e(h,{fontWeight:"medium",mb:2,children:d("services.fields.admins","Admins")}),n(ye,{spacing:3,children:[e(ur,{value:T,onChange:$=>N($.target.value),placeholder:d("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(me,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:a.length===0?e(h,{fontSize:"sm",color:"gray.500",children:d("services.noAdminsFound","No admins available")}):V.length===0?e(h,{fontSize:"sm",color:"gray.500",children:d("services.noAdminsMatching","No admins match your search")}):V.map($=>{const K=ce.has($.id);return e(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:K?"primary.400":"gray.200",bg:K?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:K?"primary.300":"gray.600",bg:K?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>A($.id),onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),A($.id))},role:"button",tabIndex:0,children:n(gt,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:$.username}),K&&e($r,{colorScheme:"primary",children:d("services.selected","Selected")})]})},$.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:d("services.adminHint","Selected admins can create users for this service")})]}),n(li,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(vn,{children:n(Lr,{variant:"outline",h:"full",children:[e(vs,{children:e(h,{fontWeight:"semibold",children:d("services.availableHosts","Available Hosts")})}),e(Tn,{children:n(ye,{spacing:3,children:[e(ur,{value:W,onChange:$=>he($.target.value),placeholder:d("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(me,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:q.length===0?e(h,{fontSize:"sm",color:"gray.500",children:d("services.noHostsLeft","All hosts are selected")}):le.length===0?e(h,{fontSize:"sm",color:"gray.500",children:d("services.noHostsMatching","No hosts match your search")}):le.map($=>n(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:E===$.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>F($.id),onMouseLeave:()=>F(null),onClick:()=>be($.id),children:[e(h,{fontWeight:"medium",children:$.label}),n(h,{fontSize:"sm",color:"gray.500",children:[$.protocol.toUpperCase()," - ",$.inboundTag]})]},$.id))})]})})]})}),e(vn,{children:n(Lr,{variant:"outline",h:"full",children:[e(vs,{children:e(h,{fontWeight:"semibold",children:d("services.selectedHosts","Selected Hosts")})}),e(Tn,{children:n(me,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[y.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:d("services.noHostsSelected","Choose hosts from the left list")}),y.map(($,K)=>{const ee=j.get($);return ee?e(Ed.div,{layout:!0,children:n(gt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[n(z,{children:[n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:ee.label}),ee.isDisabled&&e($r,{colorScheme:"red",children:d("services.hostDisabled","Disabled")})]}),n(h,{fontSize:"sm",color:"gray.500",children:[ee.protocol.toUpperCase()," - ",ee.inboundTag]})]}),n(M,{spacing:1,children:[e(ft,{label:d("services.moveUp","Move up"),children:e(We,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(El,{width:16}),onClick:()=>f($,"up"),isDisabled:K===0})}),e(ft,{label:d("services.moveDown","Move down"),children:e(We,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(Nl,{width:16}),onClick:()=>f($,"down"),isDisabled:K===y.length-1})}),e(ft,{label:d("services.removeHost","Remove host"),children:e(We,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(wn,{width:16}),onClick:()=>be($)})})]})]})},$):null})]})})]})})]})]})}),e(Ut,{children:n(M,{justify:"flex-end",w:"full",children:[e(L,{onClick:s,children:d("cancel")}),e(L,{colorScheme:"primary",onClick:te,isLoading:l,children:d(o?"saveChanges":"create")})]})})]})]})},dg=()=>{var Se,He;const{t}=Ke(),s=Zt(),{userData:r,getUserIsSuccess:l}=hr(),i=l&&Boolean((Se=r.permissions)==null?void 0:Se.sections.services),a=es(),o=dn(),d=Kl(),{inbounds:u,refetchUsers:m}=Tt(),p=Qt(),[g,x]=c.exports.useState(null);c.exports.useEffect(()=>{!l||!i||(a.fetchServices(),o.fetchAdmins({limit:500,offset:0}),ui(),d.fetchHosts())},[l,i]);const S=c.exports.useMemo(()=>o.admins.slice().sort((R,re)=>R.username.localeCompare(re.username)).map(R=>({id:R.id,username:R.username})),[o.admins]),y=c.exports.useMemo(()=>{var re,H;const R=[];for(const[ge,dt]of Object.entries(d.hosts)){const lt=(re=Array.from(u.values()).flat().find(ve=>ve.tag===ge))!=null?re:null,st=(H=lt==null?void 0:lt.protocol)!=null?H:"unknown";dt.forEach(ve=>{ve.id!=null&&R.push({id:ve.id,label:ve.remark,inboundTag:ge,protocol:st,isDisabled:Boolean(ve.is_disabled)})})}return R},[d.hosts,u]),v=()=>{x(null),p.onOpen()},T=async R=>{try{const re=await a.fetchServiceDetail(R);x(re),p.onOpen()}catch{s({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},N=async(R,re)=>{var H,ge;try{re?(await a.updateService(re,R),s({status:"success",title:t("services.updated","Service updated")})):(await a.createService(R),s({status:"success",title:t("services.created","Service created")})),m(!0),p.onClose()}catch(dt){s({status:"error",title:(ge=(H=dt==null?void 0:dt.data)==null?void 0:H.detail)!=null?ge:t("services.saveFailed","Failed to save service")})}},W=async R=>{var re,H;try{const ge=await a.fetchServiceDetail(R);Te(ge),pe()}catch(ge){s({status:"error",title:(H=(re=ge==null?void 0:ge.data)==null?void 0:re.detail)!=null?H:t("services.deleteFailed","Unable to delete service")})}},he=async R=>{var re,H;try{await a.resetServiceUsage(R),s({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(ge){s({status:"error",title:(H=(re=ge==null?void 0:ge.data)==null?void 0:re.detail)!=null?H:t("services.resetFailed","Failed to reset usage")})}},[E,F]=c.exports.useState(null),[P,j]=c.exports.useState(!1),{isOpen:q,onOpen:le,onClose:V}=Qt(),ce=c.exports.useRef(null),A=R=>{F(R),le()},be=async()=>{if(E!=null){j(!0);try{await he(E)}finally{j(!1),V()}}},f=E!=null?(He=a.services.find(R=>R.id===E))==null?void 0:He.name:void 0,te=()=>{Te(null),k()},J=async()=>{var re,H;if(!we)return;const R={mode:we.user_count?Ne:"delete_users",unlink_admins:K};if(R.mode==="transfer_users"){if(!_e){s({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}R.target_service_id=_e}O(!0);try{await a.deleteService(we.id,R),s({status:"success",title:t("services.deleted","Service removed")}),m(!0),te()}catch(ge){s({status:"error",title:(H=(re=ge==null?void 0:ge.data)==null?void 0:re.detail)!=null?H:t("services.deleteFailed","Unable to delete service")})}finally{O(!1)}},[we,Te]=c.exports.useState(null),[Ne,$]=c.exports.useState("delete_users"),[K,ee]=c.exports.useState(!1),[_e,xe]=c.exports.useState(null),[B,O]=c.exports.useState(!1),{isOpen:G,onOpen:pe,onClose:k}=Qt(),I=c.exports.useMemo(()=>we?a.services.filter(R=>R.id!==we.id):a.services,[we,a.services]);c.exports.useEffect(()=>{we&&($("delete_users"),ee(we.admin_ids.length>0),xe(null))},[we]),c.exports.useEffect(()=>{Ne==="delete_users"&&xe(null)},[Ne]);const U=R=>e(Cl,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:re})=>n(Bt,{children:[n(_l,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[n(z,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:R.name}),R.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:re?3:1,mt:1,children:R.description})]}),n(me,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[n(M,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:R.host_count})]}),n(M,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:R.user_count})]})]}),e(Nd,{})]}),e(Dl,{pt:0,pb:4,children:n(ye,{spacing:4,children:[n(Le,{columns:2,spacing:3,children:[n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:Fe(R.used_traffic)})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:Fe(R.lifetime_used_traffic)})]})]}),n(ye,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),n(M,{spacing:2,flexWrap:"wrap",children:[e(ft,{label:t("services.view","View"),children:e(We,{"aria-label":"View",icon:e(oi,{width:18}),size:"sm",variant:"outline",onClick:H=>{H.stopPropagation(),a.fetchServiceDetail(R.id)}})}),e(ft,{label:t("services.edit","Edit"),children:e(We,{"aria-label":"Edit",icon:e(ya,{width:18}),size:"sm",variant:"outline",onClick:H=>{H.stopPropagation(),T(R.id)},isDisabled:!i})}),e(ft,{label:t("services.resetUsage","Reset usage"),children:e(We,{"aria-label":"Reset usage",icon:e(cn,{width:18}),size:"sm",variant:"outline",onClick:H=>{H.stopPropagation(),A(R.id)},isDisabled:!i})}),e(ft,{label:t("services.delete","Delete"),children:e(We,{"aria-label":"Delete",icon:e(wn,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:H=>{H.stopPropagation(),W(R.id)},isDisabled:!i})})]})]})]})})]})},`service-accordion-${R.id}`),Y=R=>n(Rt,{children:[e(Ue,{children:n(me,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:R.name}),R.description&&e(h,{fontSize:"sm",color:"gray.500",children:R.description})]})}),e(Ue,{children:R.host_count}),e(Ue,{children:R.user_count}),e(Ue,{children:Fe(R.used_traffic)}),e(Ue,{children:Fe(R.lifetime_used_traffic)}),e(Ue,{children:n(M,{spacing:2,children:[e(ft,{label:t("services.view","View"),children:e(We,{"aria-label":"View",icon:e(oi,{width:18}),size:"sm",variant:"ghost",onClick:()=>a.fetchServiceDetail(R.id)})}),i&&n(Bt,{children:[e(ft,{label:t("services.edit","Edit"),children:e(We,{"aria-label":"Edit",icon:e(ya,{width:18}),size:"sm",variant:"ghost",onClick:()=>T(R.id)})}),e(ft,{label:t("services.resetUsage","Reset usage"),children:e(We,{"aria-label":"Reset usage",icon:e(cn,{width:18}),size:"sm",variant:"ghost",onClick:()=>A(R.id)})}),e(ft,{label:t("services.delete","Delete"),children:e(We,{"aria-label":"Delete",icon:e(wn,{width:18}),size:"sm",variant:"ghost",onClick:()=>W(R.id)})})]})]})})]},R.id),Ie=a.serviceDetail;return l?i?n(me,{spacing:4,align:"stretch",children:[n(gt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[n(z,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),i&&e(L,{leftIcon:e(Nn,{width:18}),colorScheme:"primary",onClick:v,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(Lr,{variant:"outline",children:e(Tn,{children:a.isLoading?e(gt,{justify:"center",py:10,children:e(Et,{})}):n(Bt,{children:[e(kl,{allowToggle:!0,display:{base:"block",md:"none"},children:a.services.map(U)}),e(z,{display:{base:"none",md:"block"},overflowX:"auto",children:n(rs,{variant:"simple",children:[e(bn,{children:n(Rt,{children:[e($e,{children:t("services.columns.name","Name")}),e($e,{children:t("services.columns.hosts","Hosts")}),e($e,{children:t("services.columns.users","Users")}),e($e,{children:t("services.columns.usage","Usage")}),e($e,{children:t("services.columns.lifetime","Lifetime")}),e($e,{children:t("services.columns.actions","Actions")})]})}),e(on,{children:a.services.map(Y)})]})})]})})}),Ie&&n(Lr,{variant:"outline",children:[e(vs,{children:n(gt,{justify:"space-between",align:"center",children:[n(z,{children:[e(h,{fontWeight:"semibold",children:Ie.name}),Ie.description&&e(h,{fontSize:"sm",color:"gray.500",children:Ie.description})]}),e($r,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:Ie.user_count})})]})}),e(Tn,{children:n(Le,{columns:{base:1,md:2},spacing:6,children:[n(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(ye,{spacing:2,children:Ie.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):Ie.admins.map(R=>n(gt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:R.username}),n(h,{fontSize:"sm",color:"gray.500",children:[Fe(R.used_traffic)," /"," ",Fe(R.lifetime_used_traffic)]})]},R.id))})]}),n(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(ye,{spacing:2,children:Ie.hosts.map(R=>n(gt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[n(z,{children:[e(h,{fontWeight:"medium",children:R.remark}),n(h,{fontSize:"sm",color:"gray.500",children:[R.inbound_protocol.toUpperCase()," - ",R.inbound_tag]})]}),n($r,{colorScheme:"gray",children:["#",R.sort+1]})]},R.id))})]})]})})]}),e(_s,{isOpen:q,leastDestructiveRef:ce,onClose:V,isCentered:!0,motionPreset:"slideInBottom",children:e(kt,{children:n(Ds,{mx:{base:4,sm:0},children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(Ct,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:f!=null?f:t("services.thisService","this service")})}),n(Ut,{children:[e(L,{ref:ce,onClick:V,children:t("cancel","Cancel")}),e(L,{colorScheme:"primary",ml:3,onClick:be,isLoading:P,children:t("services.resetUsage","Reset usage")})]})]})})}),n(Lt,{isOpen:G,onClose:te,size:"lg",children:[e(kt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ot,{children:[n(At,{children:[t("services.deleteDialogTitle","Delete Service"),we?` \u2013 ${we.name}`:""]}),e(Wt,{}),e(Ct,{children:we?n(me,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:we.name})}),we.admin_ids.length>0?e(wr,{isChecked:K,onChange:R=>ee(R.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),we.user_count>0?n(me,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:we.user_count})}),e(ci,{value:Ne,onChange:R=>$(R),children:n(ye,{align:"flex-start",spacing:2,children:[e(Br,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Br,{value:"transfer_users",isDisabled:I.length===0,children:I.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),Ne==="transfer_users"&&I.length>0&&n(C,{isRequired:!0,children:[e(_,{children:t("services.selectTargetService","Target service")}),e(rt,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:_e!=null?_e:"",onChange:R=>xe(R.target.value?Number(R.target.value):null),children:I.map(R=>e("option",{value:R.id,children:R.name},R.id))}),e(cr,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):n(zr,{status:"info",borderRadius:"md",children:[e(Rr,{}),e(Hn,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),n(Ut,{gap:3,children:[e(L,{variant:"ghost",onClick:te,children:t("cancel","Cancel")}),e(L,{colorScheme:"red",onClick:J,isLoading:B,isDisabled:Boolean((we==null?void 0:we.user_count)&&Ne==="transfer_users"&&I.length>0&&!_e),children:t("services.delete","Delete")})]})]})]}),e(cg,{isOpen:p.isOpen,onClose:p.onClose,onSubmit:N,isSaving:a.isSaving,allHosts:y,allAdmins:S,initialService:g!=null?g:void 0})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(gt,{justify:"center",align:"center",h:"full",py:10,children:e(Et,{})})};Re.extend(fi);const qo=oe(gi,{baseStyle:{w:4,h:4}}),ug=oe(Wa,{baseStyle:{w:4,h:4}}),hg={key:"30d",label:"30d",amount:30,unit:"day"},pg=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=Re.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},Yo=t=>Re(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Go=t=>Re(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Ai=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return Re.utc(r).valueOf()},Xo=t=>{const s=t.unit==="hour"?"hour":"day",r=Re().utc().endOf(s),l=Math.max(t.amount-1,0),i=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:i.toDate(),end:r.toDate(),unit:t.unit}},mg=(t,s)=>{const r=Re(t),l=Re(s),[i,a]=r.isBefore(l)?[r,l]:[l,r],o=i.startOf("day"),d=a.endOf("day"),u=o.isSame(d,"day");return{key:"custom",start:o.toDate(),end:d.toDate(),unit:u?"hour":"day"}},gg=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Fe(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Fe(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},fg=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Fe(Number(r)||0,2),title:{formatter:(r,l)=>{var i,a,o,d;return(d=(o=(a=(i=l==null?void 0:l.w)==null?void 0:i.globals)==null?void 0:a.labels)==null?void 0:o[l.seriesIndex])!=null?d:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),bg=()=>{var B,O,G,pe;const{t}=Ke(),{colorMode:s}=jr(),{admins:r}=dn(),l="auto-end",i=(B=Ur({base:"bottom",md:"auto-end"}))!=null?B:l,[a,o]=c.exports.useState([]),[d,u]=c.exports.useState([]),[m,p]=c.exports.useState(null),[g,x]=c.exports.useState([]),[S,y]=c.exports.useState(!1),v=c.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),T=(O=v.find(k=>k.key==="30d"))!=null?O:hg,[N,W]=c.exports.useState(()=>Xo(T)),[he,E]=c.exports.useState(T.key),[F,P]=c.exports.useState(null),[j,q]=c.exports.useState([]),[le,V]=c.exports.useState(!1),[ce,A]=c.exports.useState(!1),[be,f]=c.exports.useState([N.start,N.end]);c.exports.useMemo(()=>{var k;return(k=d.find(I=>I.id===m))!=null?k:null},[d,m]);const te=c.exports.useMemo(()=>{if(!m)return a;const k=new Set(g.map(U=>U.username).filter(U=>Boolean(U))),I=a.filter(U=>k.has(U.username));return I.length?I:a},[a,m,g]),J=c.exports.useMemo(()=>g.reduce((k,I)=>k+(I.used_traffic||0),0),[g]),we=c.exports.useMemo(()=>g.map(k=>k.used_traffic||0),[g]),Te=c.exports.useMemo(()=>g.map(k=>k.username||t("services.unassignedAdmin","Unassigned")),[g,t]),Ne=c.exports.useMemo(()=>fg(s,Te),[s,Te]);c.exports.useEffect(()=>{ce||f([N.start,N.end])},[ce,N.start,N.end]),c.exports.useEffect(()=>{let k=!1;return(async()=>{var U;try{const Y=await Ee("/v2/services",{query:{limit:500}});if(k||!Y)return;const Ie=(U=Y.services)!=null?U:[];u(Ie),p(Se=>Se!==null?Se:Ie.length?Ie[0].id:null)}catch{k||u([])}})(),()=>{k=!0}},[]),c.exports.useEffect(()=>{if(!m){x([]);return}let k=!1;return y(!0),Ee(`/v2/services/${m}/usage/admins`,{query:{start:Yo(N.start),end:Go(N.end)}}).then(I=>{var U;k||!I||x((U=I.admins)!=null?U:[])}).catch(()=>{k||x([])}).finally(()=>{k||y(!1)}),()=>{k=!0}},[m,N.start,N.end,N.unit]),c.exports.useEffect(()=>{let k=!1;return(async()=>{try{const U=await Ee("/admins");if(k)return;Array.isArray(U)?o(U):o(U.admins||[])}catch(U){console.error("Failed to load all admins:",U),o(r||[])}})(),()=>{k=!0}},[r]),c.exports.useEffect(()=>{if(!F)return;let k=!1;V(!0);const I=N.unit==="hour",U={start:Yo(N.start),end:Go(N.end)};I&&(U.granularity="hour");const Y=I?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:F,endpoint:Y,query:U}),Ee(`/admin/${encodeURIComponent(F)}/usage/${Y}`,{query:U}).then(Ie=>{if(k)return;const Se=Array.isArray(Ie==null?void 0:Ie.usages)?Ie.usages:[];console.debug("AdminsUsage: response usages",{length:Se.length,endpoint:Y});let He;if(I){const R=new Map;Se.forEach(H=>{var lt,st;const ge=typeof(H==null?void 0:H.date)=="string"?H.date:"";if(!ge)return;const dt=(lt=R.get(ge))!=null?lt:0;R.set(ge,dt+Number((st=H==null?void 0:H.used_traffic)!=null?st:0))});const re=Array.from(R.entries());re.sort((H,ge)=>{const[dt]=H,[lt]=ge;return Ai(dt)-Ai(lt)}),He=re.map(([H,ge])=>({date:H,used_traffic:ge}))}else{const R=Se.map(re=>{var H,ge;return{date:(H=re==null?void 0:re.date)!=null?H:"",used_traffic:Number((ge=re==null?void 0:re.used_traffic)!=null?ge:0)}});R.sort((re,H)=>Ai(re.date)-Ai(H.date)),He=R}q(He)}).catch(Ie=>{k||(console.error("Error fetching admin usage:",Ie),q([]))}).finally(()=>{k||V(!1)}),()=>{k=!0}},[F,N]),c.exports.useEffect(()=>{if(!te||te.length===0)return;te.some(I=>I.username===F)||P(te[0].username)},[te,F]),c.exports.useEffect(()=>{const k=v.find(I=>I.key===N.key);E(k?k.key:"custom")},[N,v]);const $=c.exports.useMemo(()=>j.map(k=>pg(k.date)),[j]),K=c.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:j.map(k=>k.used_traffic)}],[j,t]),ee=c.exports.useMemo(()=>({options:gg(s,$),series:K}),[s,$,K]),_e=c.exports.useMemo(()=>j.reduce((k,I)=>k+Number(I.used_traffic||0),0),[j]),xe=c.exports.useMemo(()=>{const k=Re(N.start).format("YYYY-MM-DD"),I=Re(N.end).format("YYYY-MM-DD");return k===I?k:`${k} - ${I}`},[N.start,N.end]);return n(me,{spacing:4,align:"stretch",children:[n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ye,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[n(me,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),n(ye,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(rt,{value:m!=null?m:"",onChange:k=>{const I=Number(k.target.value);p(Number.isNaN(I)?null:I)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!d.length,children:d.map(k=>e("option",{value:k.id,children:k.name},k.id))}),n(M,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(qo,{}),n(h,{children:[t("services.totalUsage","Total"),":"," ",e(oe.span,{fontWeight:"medium",children:Fe(J,2)})]})]})]})]}),n(ye,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:S?n(me,{spacing:3,py:8,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):g.length&&J>0?e(ln,{type:"donut",height:320,options:Ne,series:we}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(me,{flex:"1",align:"stretch",spacing:2,children:g.length?g.map(k=>{var Ie;const I=k.username||t("services.unassignedAdmin","Unassigned"),U=Boolean(k.username),Y=F===k.username&&U;return e(L,{size:"sm",variant:Y?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{U&&k.username&&P(k.username)},isDisabled:!U,children:n(M,{justify:"space-between",w:"full",children:[e(h,{children:I}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:Fe(k.used_traffic||0,2)})]})},`${(Ie=k.admin_id)!=null?Ie:"na"}-${I}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ye,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(ft,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(qo,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(oe.span,{fontWeight:"medium",children:F!=null?F:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(oe.span,{fontWeight:"medium",children:Fe(_e||0,2)})]})]}),n(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ye,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:v.map(k=>e(L,{size:"sm",onClick:()=>{E(k.key),W(Xo(k))},variant:he===k.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:k.label},k.key))}),n(ye,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[n(Vn,{placement:i,isOpen:ce,onClose:()=>{A(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e($n,{children:e(L,{size:"sm",variant:"outline",leftIcon:e(ug,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(ce){A(!1);return}f([N.start,N.end]),A(!0)},children:xe})}),n(Kn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(os,{}),n(Jn,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(xi,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(G=be[0])!=null?G:void 0,endDate:(pe=be[1])!=null?pe:void 0,calendarClassName:"usage-range-datepicker",onChange:k=>{const[I,U]=k!=null?k:[null,null];if(f([I,U]),I&&U){const Y=mg(I,U);E("custom"),W(Y),A(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(rt,{value:F!=null?F:"",onChange:k=>P(k.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!te.length,children:te.map(k=>e("option",{value:k.username,children:k.username},k.username))})]})]})]}),e(z,{mt:6,children:le?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):ee.series&&ee.series.length?e(ln,{options:ee.options,series:ee.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};Re.extend(fi);const yg=oe(Wa,{baseStyle:{w:4,h:4}}),pa=oe(gi,{baseStyle:{w:4,h:4}}),ma=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],Qo=t=>{const s=t.unit==="hour"?"hour":"day",r=Re().utc().endOf(s),l=Math.max(t.amount-1,0),i=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:i.toDate(),end:r.toDate(),unit:t.unit}},Sg=(t,s)=>{const r=Re(t),l=Re(s),[i,a]=r.isBefore(l)?[r,l]:[l,r],o=i.startOf("day"),d=a.endOf("day"),u=o.isSame(d,"day");return{key:"custom",start:o.toDate(),end:d.toDate(),unit:u?"hour":"day"}},Zo=t=>Re(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),jo=t=>Re(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),el=(t,s)=>{if(!t)return t;const r=Re.utc(t);return r.isValid()?s==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},tl=(t,s,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:i=>Fe(Number(i)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:i=>Fe(Number(i)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},xg=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Fe(Number(r)||0,2),title:{formatter:(r,l)=>{var i,a,o,d;return(d=(o=(a=(i=l==null?void 0:l.w)==null?void 0:i.globals)==null?void 0:a.labels)==null?void 0:o[l.seriesIndex])!=null?d:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),vg=({services:t,selectedServiceId:s})=>{var re,H,ge,dt,lt,st;const{t:r}=Ke(),{colorMode:l}=jr(),i="auto-end",a=(re=Ur({base:"bottom",md:"auto-end"}))!=null?re:i,o=c.exports.useMemo(()=>t.map(ve=>({id:ve.id,name:ve.name})),[t]),d=c.exports.useMemo(()=>s||(o.length?o[0].id:null),[s,o]),u=(H=ma.find(ve=>ve.key==="30d"))!=null?H:ma[0],[m,p]=c.exports.useState(d),[g,x]=c.exports.useState(()=>Qo(u)),[S,y]=c.exports.useState(u.key),[v,T]=c.exports.useState([null,null]),[N,W]=c.exports.useState(!1),[he,E]=c.exports.useState([]),[F,P]=c.exports.useState("day"),[j,q]=c.exports.useState([]),[le,V]=c.exports.useState(!1),[ce,A]=c.exports.useState(!1),[be,f]=c.exports.useState(null),[te,J]=c.exports.useState([]),[we,Te]=c.exports.useState("day"),[Ne,$]=c.exports.useState(""),[K,ee]=c.exports.useState(!1);c.exports.useEffect(()=>{p(d)},[d]),c.exports.useEffect(()=>{if(!m){E([]),q([]),J([]),f(null),$("");return}const ve={start:Zo(g.start),end:jo(g.end)},Be=g.unit==="hour"?"hour":"day";let Je=!1;return V(!0),Ee(`/v2/services/${m}/usage/timeseries`,{query:{...ve,granularity:Be}}).then(se=>{var Ye,ie;Je||!se||(E((Ye=se.points)!=null?Ye:[]),P((ie=se.granularity)!=null?ie:Be))}).catch(()=>{Je||(E([]),P(Be))}).finally(()=>{Je||V(!1)}),A(!0),Ee(`/v2/services/${m}/usage/admins`,{query:ve}).then(se=>{var Ye;Je||!se||q((Ye=se.admins)!=null?Ye:[])}).catch(()=>{Je||q([])}).finally(()=>{Je||A(!1)}),()=>{Je=!0}},[m,g.start,g.end,g.unit]),c.exports.useEffect(()=>{if(!m){f(null),J([]),$("");return}if(!j.length){f(null);return}f(ve=>{var Ye,ie;const Be=j.map(D=>D.admin_id);if(ve===null){if(Be.includes(null))return ve}else if(Be.includes(ve))return ve;const Je=j.find(D=>(D.used_traffic||0)>0);if(Je)return(Ye=Je.admin_id)!=null?Ye:null;const se=j[0];return(ie=se==null?void 0:se.admin_id)!=null?ie:null})},[j,m]),c.exports.useEffect(()=>{if(!m){J([]),$(""),Te("day");return}if(be===void 0)return;if(!j.length&&be===null){J([]),$("");return}const ve=g.unit==="hour"?"hour":"day",Be=be===null?"null":Number.isFinite(be)?String(be):"null";let Je=!1;return ee(!0),Ee(`/v2/services/${m}/usage/admin-timeseries`,{query:{start:Zo(g.start),end:jo(g.end),granularity:ve,admin_id:Be}}).then(se=>{var Ye,ie,D;Je||!se||(J((Ye=se.points)!=null?Ye:[]),Te((ie=se.granularity)!=null?ie:ve),$((D=se.username)!=null?D:""))}).catch(()=>{Je||(J([]),$(""),Te(ve))}).finally(()=>{Je||ee(!1)}),()=>{Je=!0}},[j,g.end,g.start,g.unit,be,m]);const _e=c.exports.useMemo(()=>{const ve=Re(g.start).format("YYYY-MM-DD"),Be=Re(g.end).format("YYYY-MM-DD");return`${ve} \u2013 ${Be}`},[g.start,g.end]),xe=c.exports.useMemo(()=>he.map(ve=>el(ve.timestamp,F)),[he,F]),B=c.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:he.map(ve=>ve.used_traffic)}],[he,r]),O=c.exports.useMemo(()=>tl(l,xe,r("services.usageYAxis","Usage")),[xe,l,r]),G=c.exports.useMemo(()=>j.map(ve=>({value:ve.admin_id===null?"null":String(ve.admin_id),label:ve.username||r("services.unassignedAdmin","Unassigned")})),[j,r]),pe=c.exports.useMemo(()=>{var Be,Je;const ve=be===null?"null":String(be);return(Je=(Be=G.find(se=>se.value===ve))==null?void 0:Be.label)!=null?Je:be===null?r("services.unassignedAdmin","Unassigned"):""},[G,be,r]),k=c.exports.useMemo(()=>te.map(ve=>el(ve.timestamp,we)),[te,we]),I=c.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:te.map(ve=>ve.used_traffic)}],[te,r]),U=c.exports.useMemo(()=>tl(l,k,r("services.usageYAxis","Usage")),[k,l,r]),Y=c.exports.useMemo(()=>te.reduce((ve,Be)=>ve+(Be.used_traffic||0),0),[te]),Ie=c.exports.useMemo(()=>j.map(ve=>ve.used_traffic),[j]),Se=c.exports.useMemo(()=>j.map(ve=>ve.username||r("services.unassignedAdmin","Unassigned")),[j,r]),He=c.exports.useMemo(()=>xg(l,Se),[l,Se]),R=c.exports.useMemo(()=>j.reduce((ve,Be)=>ve+(Be.used_traffic||0),0),[j]);return o.length===0?n(me,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(z,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):n(me,{spacing:4,align:"stretch",children:[n(M,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),n(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(rt,{value:m!=null?m:"",onChange:ve=>p(Number(ve.target.value)||null),minW:{md:"220px"},children:o.map(ve=>e("option",{value:ve.id,children:ve.name},ve.id))}),e(ye,{direction:{base:"column",sm:"row"},spacing:2,children:ma.map(ve=>e(L,{size:"sm",variant:S===ve.key?"solid":"outline",colorScheme:"primary",onClick:()=>{y(ve.key),x(Qo(ve))},children:ve.label},ve.key))}),n(Vn,{placement:a,isOpen:N,onClose:()=>W(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e($n,{children:e(L,{size:"sm",variant:"outline",leftIcon:e(yg,{}),onClick:()=>{T([g.start,g.end]),W(ve=>!ve)},children:_e})}),n(Kn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(os,{}),n(Jn,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(xi,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(ge=v[0])!=null?ge:void 0,endDate:(dt=v[1])!=null?dt:void 0,calendarClassName:"usage-range-datepicker",onChange:ve=>{const[Be,Je]=ve!=null?ve:[null,null];if(T([Be,Je]),Be&&Je){const se=Sg(Be,Je);y("custom"),x(se),W(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(M,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),n(M,{fontSize:"sm",color:"gray.500",children:[e(pa,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(oe.span,{fontWeight:"medium",children:Fe(he.reduce((ve,Be)=>ve+(Be.used_traffic||0),0),2)})]})]})]}),e(z,{mt:4,children:le?n(me,{spacing:3,py:10,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):he.length?e(ln,{type:"area",height:360,options:O,series:B}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(ye,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(ft,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(pa,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(oe.span,{fontWeight:"medium",children:pe||Ne||"-"})," ",r("services.totalUsage","Total"),":"," ",e(oe.span,{fontWeight:"medium",children:Fe(Y||0,2)})]})]}),e(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(rt,{size:"sm",minW:{md:"200px"},value:be===null?"null":String(be),onChange:ve=>{const Be=ve.target.value;if(Be==="null"){f(null);return}const Je=Number(Be);f(Number.isNaN(Je)?null:Je)},isDisabled:G.length===0,children:G.map(ve=>e("option",{value:ve.value,children:ve.label},ve.value))})})]}),e(z,{mt:4,children:K?n(me,{spacing:3,py:10,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(st=(lt=I[0])==null?void 0:lt.data)!=null&&st.length?e(ln,{type:"area",height:360,options:U,series:I}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(M,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),n(M,{fontSize:"sm",color:"gray.500",children:[e(pa,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(oe.span,{fontWeight:"medium",children:Fe(R,2)})]})]})]}),n(ye,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:ce?n(me,{spacing:3,py:8,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):j.length&&R>0?e(ln,{type:"donut",height:320,options:He,series:Ie}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(me,{flex:"1",align:"stretch",spacing:2,children:j.length?j.map(ve=>{var Be;return n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:ve.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:Fe(ve.used_traffic||0,2)})]},`${(Be=ve.admin_id)!=null?Be:"na"}-${ve.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};Re.extend(fi);const wg=oe(Wa,{baseStyle:{w:4,h:4}}),Ii=oe(gi,{baseStyle:{w:4,h:4}}),Ys={key:"30d",label:"30d",amount:30,unit:"day"},rl=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=Re.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},Gs=t=>Re(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Xs=t=>Re(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Ln=t=>{const s=t.unit==="hour"?"hour":"day",r=Re().utc().endOf(s),l=Math.max(t.amount-1,0),i=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:i.toDate(),end:r.toDate(),unit:t.unit}},Pi=(t,s)=>{const r=Re(t),l=Re(s),[i,a]=r.isBefore(l)?[r,l]:[l,r],o=i.startOf("day"),d=a.endOf("day"),u=o.isSame(d,"day");return{key:"custom",start:o.toDate(),end:d.toDate(),unit:u?"hour":"day"}},nl=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Fe(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Fe(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Ti=({presets:t,range:s,onPresetChange:r,onCustomChange:l})=>{var y,v,T;const{t:i}=Ke(),a="auto-end",o=(y=Ur({base:"bottom",md:"auto-end"}))!=null?y:a,d=Re(s.start).format("YYYY-MM-DD"),u=Re(s.end).format("YYYY-MM-DD"),m=d===u?d:`${d} - ${u}`,[p,g]=c.exports.useState(!1),[x,S]=c.exports.useState([s.start,s.end]);return c.exports.useEffect(()=>{p||S([s.start,s.end])},[p,s.start,s.end]),n(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ye,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(N=>e(L,{size:"sm",onClick:()=>r(N.key),colorScheme:"primary",variant:s.key===N.key?"solid":"outline",w:{base:"full",sm:"auto"},children:N.label},N.key))}),n(Vn,{placement:o,isOpen:p,onClose:()=>{g(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e($n,{children:e(L,{size:"sm",variant:"outline",leftIcon:e(wg,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(p){g(!1);return}S([s.start,s.end]),g(!0)},children:m})}),n(Kn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(os,{}),n(Jn,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(xi,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(v=x[0])!=null?v:void 0,endDate:(T=x[1])!=null?T:void 0,calendarClassName:"usage-range-datepicker",onChange:N=>{const[W,he]=N!=null?N:[null,null];S([W,he]),W&&he&&(l(W,he),g(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:i("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},kg=()=>{var Kt,Me,it,Jt,nr,kr,pr,gr,fr;const{t}=Ke(),s=Zt(),{colorMode:r}=jr(),{data:l}=Ba(),{fetchNodesUsage:i}=vi(),{userData:a}=hr(),o=c.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),d=(Me=(Kt=o.find(ne=>ne.key==="30d"))!=null?Kt:o[0])!=null?Me:Ys,[u,m]=c.exports.useState(()=>Ln(d)),[p,g]=c.exports.useState([]),[x,S]=c.exports.useState(!1),[y,v]=c.exports.useState(()=>Ln(d)),[T,N]=c.exports.useState(null),[W,he]=c.exports.useState(!1),[E,F]=c.exports.useState([]),[P,j]=c.exports.useState(null),[q,le]=c.exports.useState(()=>Ln(d)),[V,ce]=c.exports.useState(()=>Ln(d)),[A,be]=c.exports.useState([]),[f,te]=c.exports.useState(null),[J,we]=c.exports.useState(null),[Te,Ne]=c.exports.useState([]),[$,K]=c.exports.useState([]),[ee,_e]=c.exports.useState(!1),[xe,B]=c.exports.useState(null),[O,G]=c.exports.useState(!1),[pe,k]=c.exports.useState([]),[I,U]=c.exports.useState(null),Y=c.exports.useCallback(ne=>ne?(Array.isArray(ne)?ne:Object.values(ne)).map(Q=>{var Xe,_t,qt,Nt;return{nodeId:Number((Xe=Q==null?void 0:Q.node_id)!=null?Xe:0),nodeName:(_t=Q==null?void 0:Q.node_name)!=null?_t:t("nodes.unknownNode","Unknown"),total:Number((qt=Q==null?void 0:Q.uplink)!=null?qt:0)+Number((Nt=Q==null?void 0:Q.downlink)!=null?Nt:0)}}):[],[t]),Ie=c.exports.useCallback(ne=>{var Q;const Ae=(Q=o.find(Xe=>Xe.key===ne))!=null?Q:Ys;m(Ln(Ae))},[o]),Se=c.exports.useCallback((ne,Ae)=>{const Q=Pi(ne,Ae);m(Q)},[]),He=c.exports.useCallback(ne=>{var Q;const Ae=(Q=o.find(Xe=>Xe.key===ne))!=null?Q:Ys;v(Ln(Ae))},[o]),R=c.exports.useCallback((ne,Ae)=>{const Q=Pi(ne,Ae);v(Q)},[]),re=c.exports.useCallback(ne=>{var Q;const Ae=(Q=o.find(Xe=>Xe.key===ne))!=null?Q:Ys;ce(Ln(Ae))},[o]),H=c.exports.useCallback((ne,Ae)=>{const Q=Pi(ne,Ae);ce(Q)},[]),ge=c.exports.useCallback(ne=>{var Q;const Ae=(Q=o.find(Xe=>Xe.key===ne))!=null?Q:Ys;le(Ln(Ae))},[o]),dt=c.exports.useCallback((ne,Ae)=>{const Q=Pi(ne,Ae);le(Q)},[]),lt=c.exports.useMemo(()=>p.reduce((ne,Ae)=>ne+Ae.total,0),[p]),st=c.exports.useMemo(()=>{const ne=p.map(Q=>Q.total),Ae=p.map(Q=>Q.nodeName);return Li(r,`${t("userDialog.total")} ${Fe(lt||0,2)}`,ne,Ae)},[r,p,t,lt]),ve=c.exports.useMemo(()=>E.map(ne=>rl(ne.date)),[E]),Be=c.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:E.map(ne=>ne.used_traffic)}],[E,t]),Je=c.exports.useMemo(()=>E.reduce((ne,Ae)=>ne+Ae.used_traffic,0),[E]),se=c.exports.useMemo(()=>({options:nl(r,ve),series:Be}),[r,ve,Be]),Ye=c.exports.useMemo(()=>$.reduce((ne,Ae)=>ne+Ae.total,0),[$]),ie=c.exports.useMemo(()=>{const ne=$.map(Q=>Q.total),Ae=$.map(Q=>Q.nodeName);return Li(r,`${t("userDialog.total")} ${Fe(Ye||0,2)}`,ne,Ae)},[$,r,t,Ye]),D=c.exports.useMemo(()=>pe.map(ne=>rl(ne.date)),[pe]),de=c.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:pe.map(ne=>ne.used_traffic)}],[pe,t]),ze=c.exports.useMemo(()=>pe.reduce((ne,Ae)=>ne+Ae.used_traffic,0),[pe]),Ge=c.exports.useMemo(()=>({options:nl(r,D),series:de}),[r,D,de]),tt=c.exports.useMemo(()=>{const ne=[],Ae=new Set;return p.forEach(Q=>{Q.nodeId>0&&!Ae.has(Q.nodeId)&&(Ae.add(Q.nodeId),ne.push({value:Q.nodeId,label:Q.nodeName}))}),Array.isArray(l)&&l.forEach(Q=>{(Q==null?void 0:Q.id)&&!Ae.has(Q.id)&&(Ae.add(Q.id),ne.push({value:Q.id,label:Q.name}))}),ne.sort((Q,Xe)=>Q.label.localeCompare(Xe.label))},[p,l]),qe=c.exports.useMemo(()=>{const ne=[],Ae=new Set;return Te.forEach(Q=>{Ae.has(Q.nodeId)||(Ae.add(Q.nodeId),ne.push({value:Q.nodeId,label:Q.nodeName}))}),Ae.has(0)||ne.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(Q=>{(Q==null?void 0:Q.id)&&!Ae.has(Q.id)&&(Ae.add(Q.id),ne.push({value:Q.id,label:Q.name}))}),ne.sort((Q,Xe)=>Q.label.localeCompare(Xe.label))},[Te,l,t]),Vt=c.exports.useMemo(()=>A.map(ne=>({value:ne,label:ne})),[A]),$t=c.exports.useMemo(()=>{const ne=new Map;return Array.isArray(l)&&l.forEach(Ae=>{(Ae==null?void 0:Ae.id)!=null&&ne.set(Ae.id,Ae.name)}),ne},[l]);return c.exports.useEffect(()=>{let ne=!1;return S(!0),i({start:Gs(u.start),end:Xs(u.end)}).then(Ae=>{if(ne)return;const Q=Y(Ae==null?void 0:Ae.usages);g(Q)}).catch(Ae=>{ne||(console.error("Error fetching usage data:",Ae),g([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||S(!1)}),()=>{ne=!0}},[i,u,Y,s,t]),c.exports.useEffect(()=>{var Ae,Q;const ne=Boolean((Q=(Ae=a.permissions)==null?void 0:Ae.admin_management)==null?void 0:Q[dr.View])||a.role===Qe.FullAccess;!(a!=null&&a.username)||(te(Xe=>Xe!=null?Xe:a.username),we(Xe=>Xe!=null?Xe:a.username),ne||be([a.username]))},[a]),c.exports.useEffect(()=>{var Q,Xe;const ne=Boolean((Xe=(Q=a==null?void 0:a.permissions)==null?void 0:Q.admin_management)==null?void 0:Xe[dr.View])||(a==null?void 0:a.role)===Qe.FullAccess;if(!(a!=null&&a.username)||!ne)return;let Ae=!1;return Ee("/admins").then(_t=>{if(Ae)return;const Nt=(Array.isArray(_t)?_t:Array.isArray(_t==null?void 0:_t.admins)?_t.admins:[]).map(pt=>pt==null?void 0:pt.username).filter(pt=>typeof pt=="string"),zt=Array.from(new Set(Nt)).sort((pt,mt)=>pt.localeCompare(mt));if(!zt.length&&(a==null?void 0:a.username)){be([a.username]);return}be(zt),te(pt=>{var mt,It;return pt&&zt.includes(pt)?pt:(It=(mt=zt[0])!=null?mt:pt)!=null?It:null}),we(pt=>{var mt,It;return pt&&zt.includes(pt)?pt:(It=(mt=zt[0])!=null?mt:pt)!=null?It:null})}).catch(_t=>{console.error("Error fetching admins:",_t)}),()=>{Ae=!0}},[(it=a==null?void 0:a.permissions)==null?void 0:it.admin_management,a==null?void 0:a.role,a==null?void 0:a.username]),c.exports.useEffect(()=>{var Ae,Q;if(T!==null)return;const ne=(Ae=p.filter(Xe=>Xe.nodeId>0).sort((Xe,_t)=>_t.total-Xe.total)[0])==null?void 0:Ae.nodeId;if(ne&&ne>0){N(ne);return}if(Array.isArray(l)&&l.length){const Xe=(Q=l[0])==null?void 0:Q.id;Xe&&N(Xe)}},[T,p,l]),c.exports.useEffect(()=>{B(null)},[f]),c.exports.useEffect(()=>{if(!f){Ne([]),B(null);return}let ne=!1;const Ae={start:Gs(V.start),end:Xs(V.end)};return Ee(`/admin/${encodeURIComponent(f)}/usage/nodes`,{query:Ae}).then(Q=>{if(ne)return;const Xe=Y(Q==null?void 0:Q.usages);Ne(Xe),B(_t=>{var Nt,zt,pt;if(_t!==null)return _t;const qt=(Nt=Xe.filter(mt=>mt.nodeId!==0).sort((mt,It)=>It.total-mt.total)[0])==null?void 0:Nt.nodeId;return typeof qt=="number"?qt:(pt=(zt=Xe[0])==null?void 0:zt.nodeId)!=null?pt:0})}).catch(Q=>{ne||(console.error("Error fetching daily admin nodes:",Q),Ne([]),B(null),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{ne=!0}},[f,V,Y,s,t]),c.exports.useEffect(()=>{if(!J){K([]),_e(!1);return}let ne=!1;return _e(!0),Ee(`/admin/${encodeURIComponent(J)}/usage/nodes`,{query:{start:Gs(q.start),end:Xs(q.end)}}).then(Ae=>{if(ne)return;const Q=Y(Ae==null?void 0:Ae.usages);K(Q)}).catch(Ae=>{ne||(console.error("Error fetching admin totals nodes:",Ae),K([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||_e(!1)}),()=>{ne=!0}},[J,q,Y,s,t]),c.exports.useEffect(()=>{if(T===null){F([]),j(null);return}let ne=!1;he(!0);const Ae={start:Gs(y.start),end:Xs(y.end)};return y.unit==="hour"&&(Ae.granularity="hour"),Ee(`/node/${T}/usage/daily`,{query:Ae}).then(Q=>{var Nt,zt,pt;if(ne)return;const _t=(Array.isArray(Q==null?void 0:Q.usages)?Q.usages:[]).map(mt=>{var It,ir;return{date:(It=mt==null?void 0:mt.date)!=null?It:"",used_traffic:Number((ir=mt==null?void 0:mt.used_traffic)!=null?ir:0)}});F(_t);const qt=(zt=(Nt=Q==null?void 0:Q.node_name)!=null?Nt:$t.get(T))!=null?zt:t("nodes.unknownNode","Unknown");j({nodeName:qt,nodeId:(pt=Q==null?void 0:Q.node_id)!=null?pt:T})}).catch(Q=>{ne||(console.error("Error fetching node daily usage:",Q),F([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||he(!1)}),()=>{ne=!0}},[T,y,$t,s,t]),c.exports.useEffect(()=>{if(!f){k([]),U(null);return}if(xe===null){k([]),U(null);return}let ne=!1;G(!0);const Ae={start:Gs(V.start),end:Xs(V.end)};return xe!=null&&(Ae.node_id=xe),V.unit==="hour"&&(Ae.granularity="hour"),Ee(`/admin/${encodeURIComponent(f)}/usage/chart`,{query:Ae}).then(Q=>{var qt,Nt,zt,pt;if(ne)return;const _t=(Array.isArray(Q==null?void 0:Q.usages)?Q.usages:[]).map(mt=>{var It,ir;return{date:(It=mt==null?void 0:mt.date)!=null?It:"",used_traffic:Number((ir=mt==null?void 0:mt.used_traffic)!=null?ir:0)}});k(_t),U({nodeName:(zt=(Nt=Q==null?void 0:Q.node_name)!=null?Nt:(qt=qe.find(mt=>mt.value===xe))==null?void 0:qt.label)!=null?zt:null,nodeId:(pt=Q==null?void 0:Q.node_id)!=null?pt:xe})}).catch(Q=>{ne||(console.error("Error fetching admin usage chart:",Q),k([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{ne||G(!1)}),()=>{ne=!0}},[f,xe,V,qe,t,s]),n(me,{spacing:6,align:"stretch",children:[n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ye,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(ft,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(Ii,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(oe.span,{fontWeight:"medium",children:Fe(lt||0,2)})]})]}),e(Ti,{presets:o,range:u,onPresetChange:Ie,onCustomChange:Se})]}),e(z,{mt:6,children:x?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):st.series.length?e(ln,{options:st.options,series:st.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ye,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(ft,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(Ii,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(oe.span,{fontWeight:"medium",children:(Jt=P==null?void 0:P.nodeName)!=null?Jt:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(oe.span,{fontWeight:"medium",children:Fe(Je||0,2)})]})]}),n(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(rt,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:T!=null?T:"",onChange:ne=>{const Ae=ne.target.value;if(!Ae){N(null);return}const Q=Number(Ae);N(Number.isFinite(Q)&&Q>0?Q:null)},placeholder:t("nodes.selectNode","Select node"),children:tt.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(Ti,{presets:o,range:y,onPresetChange:He,onCustomChange:R})]})]}),e(z,{mt:6,children:W?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(kr=(nr=Be[0])==null?void 0:nr.data)!=null&&kr.length?e(ln,{options:se.options,series:se.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ye,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(ft,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(Ii,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(oe.span,{fontWeight:"medium",children:f!=null?f:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(oe.span,{fontWeight:"medium",children:(pr=I==null?void 0:I.nodeName)!=null?pr:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(oe.span,{fontWeight:"medium",children:Fe(ze||0,2)})]})]}),n(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(rt,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:f!=null?f:"",onChange:ne=>te(ne.target.value||null),isDisabled:Vt.length===0,children:Vt.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(rt,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:xe!=null?xe:"",onChange:ne=>{const Ae=ne.target.value;if(Ae===""){B(null);return}const Q=Number(Ae);B(Number.isNaN(Q)?null:Q)},placeholder:t("nodes.selectNode","Select node"),children:qe.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(Ti,{presets:o,range:V,onPresetChange:re,onCustomChange:H})]})]}),e(z,{mt:6,children:O?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(fr=(gr=de[0])==null?void 0:gr.data)!=null&&fr.length?e(ln,{options:Ge.options,series:Ge.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ye,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[n(me,{align:"start",spacing:1,children:[e(ft,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(Ii,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(oe.span,{fontWeight:"medium",children:J!=null?J:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(oe.span,{fontWeight:"medium",children:Fe(Ye||0,2)})]})]}),n(ye,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(rt,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:J!=null?J:"",onChange:ne=>we(ne.target.value||null),isDisabled:Vt.length===0,children:Vt.map(ne=>e("option",{value:ne.value,children:ne.label},ne.value))}),e(Ti,{presets:o,range:q,onPresetChange:ge,onCustomChange:dt})]})]}),e(z,{mt:6,children:ee?n(me,{spacing:3,children:[e(Et,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):ie.series.length?e(ln,{options:ie.options,series:ie.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},Cg=()=>{var o;const{t}=Ke(),{userData:s,getUserIsSuccess:r}=hr(),l=Boolean(r&&((o=s.permissions)==null?void 0:o.sections.usage)),i=es(d=>d.services),a=es(d=>d.fetchServices);return c.exports.useEffect(()=>{l&&a({limit:500})},[a,l]),r?l?n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),n(ls,{variant:"enclosed",colorScheme:"primary",children:[n(cs,{children:[e(er,{children:t("usage.tabs.services","Services")}),e(er,{children:t("usage.tabs.admins","Admins")}),e(er,{children:t("usage.tabs.nodes","Nodes")})]}),n(ds,{children:[e(tr,{px:0,children:e(vg,{services:i})}),e(tr,{px:0,children:e(bg,{})}),e(tr,{px:0,children:e(kg,{})})]})]})]}):n(me,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(gt,{justify:"center",align:"center",py:10,children:e(Et,{})})},oc="__dot__",Ia=t=>t.replace(/\./g,oc),ys=t=>t.replace(new RegExp(oc,"g"),"."),_g=t=>{const s={},r=(l,i)=>{if(i!==void 0){if(typeof i=="boolean"){s[ys(l)]=i;return}if(typeof i=="string"){if(i==="")return;i==="true"||i==="false"?s[ys(l)]=i==="true":s[ys(l)]=Boolean(i);return}if(typeof i=="number"){s[ys(l)]=i!==0;return}if(Array.isArray(i)){s[ys(l)]=i.length>0;return}if(i&&typeof i=="object"){Object.entries(i).forEach(([a,o])=>{const d=l?`${l}.${a}`:a;r(d,o)});return}s[ys(l)]=Boolean(i)}};return Object.entries(t).forEach(([l,i])=>{r(l,i)}),s},lc=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],Dg=lc.flatMap(t=>t.events.map(s=>s.key)),sl=oe(cn,{baseStyle:{w:4,h:4}}),il=oe(zd,{baseStyle:{w:4,h:4}}),ga=t=>{var l,i,a,o;const s={};Object.entries(t.forum_topics||{}).forEach(([d,u])=>{var m;s[d]={title:(m=u.title)!=null?m:"",topic_id:u.topic_id!=null?String(u.topic_id):""}});const r={};return Dg.forEach(d=>{var p;const u=Ia(d),m=(p=t.event_toggles)==null?void 0:p[d];r[u]=m===void 0?!0:Boolean(m)}),Object.entries(t.event_toggles||{}).forEach(([d,u])=>{const m=Ia(d);m in r||(r[m]=Boolean(u))}),{api_token:(l=t.api_token)!=null?l:"",use_telegram:(i=t.use_telegram)!=null?i:!0,proxy_url:(a=t.proxy_url)!=null?a:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(o=t.default_vless_flow)!=null?o:"",forum_topics:s,event_toggles:r}},fa=({disabled:t,message:s,children:r})=>n(z,{position:"relative",children:[e(z,{pointerEvents:t?"none":"auto",filter:t?"blur(1.2px)":"none",opacity:t?.55:1,transition:"all 0.2s ease",children:r}),t&&e(gt,{position:"absolute",inset:0,align:"center",justify:"center",textAlign:"center",fontWeight:"semibold",color:"white",px:6,borderRadius:"inherit",bg:"blackAlpha.400",backdropFilter:"blur(2px)",children:e(h,{children:s})})]}),Ag=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(s=>s.length>0).map(s=>Number(s)).filter(s=>Number.isFinite(s)),Ig=()=>{var $,K,ee,_e,xe;const{t}=Ke(),s=Zt(),{userData:r,getUserIsSuccess:l}=hr();if(!(l&&Boolean(($=r.permissions)==null?void 0:$.sections.integrations)))return n(me,{spacing:4,align:"stretch",children:[e(Mn,{size:"lg",children:t("header.integrationSettings","Integration settings")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("integrations.noPermission","You do not have permission to manage integration settings.")})]});const a=Oa(),{data:o,isLoading:d,refetch:u}=Or("telegram-settings",Rh,{refetchOnWindowFocus:!1}),{data:m,isLoading:p,refetch:g}=Or("panel-settings",Fa,{refetchOnWindowFocus:!1}),x=Or("maintenance-info",()=>Ee("/maintenance/info"),{refetchOnWindowFocus:!1}),[S,y]=c.exports.useState((K=m==null?void 0:m.use_nobetci)!=null?K:!1),[v,T]=c.exports.useState(!1),[N,W]=c.exports.useState(!1),he=c.exports.useRef(null);c.exports.useEffect(()=>{m&&y(m.use_nobetci)},[m]);const{register:E,control:F,handleSubmit:P,reset:j,watch:q,formState:{isDirty:le}}=en({defaultValues:ga(o!=null?o:{api_token:null,use_telegram:!0,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});c.exports.useEffect(()=>{o&&j(ga(o))},[o,j]);const V=Hr(Uh,{onSuccess:B=>{j(ga(B)),a.setQueryData("telegram-settings",B),s({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),ce=Hr(Mh,{onSuccess:B=>{y(B.use_nobetci),a.setQueryData("panel-settings",B),s({title:t("settings.panel.saved","Panel settings saved"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),A=B=>{const O=_g(B.event_toggles||{}),G={api_token:B.api_token.trim()||null,use_telegram:B.use_telegram,proxy_url:B.proxy_url.trim()||null,admin_chat_ids:Ag(B.admin_chat_ids),logs_chat_id:B.logs_chat_id.trim()?Number(B.logs_chat_id.trim()):null,logs_chat_is_forum:B.logs_chat_is_forum,default_vless_flow:B.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(B.forum_topics||{}).map(([pe,k])=>[pe,{title:k.title,topic_id:k.topic_id.trim()?Number(k.topic_id.trim()):void 0}])),event_toggles:O};V.mutate(G)},be=B=>{if(!B)return`rebecca-backup-${Date.now()}.zip`;const O=B.split(";");for(const G of O){const pe=G.trim();if(pe.toLowerCase().startsWith("filename="))return pe.split("=",1)[1].trim().replace(/(^\"|\"$)/g,"")||`rebecca-backup-${Date.now()}.zip`}return`rebecca-backup-${Date.now()}.zip`},f=async()=>{T(!0);try{const B=As(),O=await fetch("/api/maintenance/backup/export",{method:"GET",headers:B?{Authorization:`Bearer ${B}`}:void 0});if(!O.ok)throw new Error(await O.text());const G=await O.blob(),pe=be(O.headers.get("content-disposition")),k=window.URL.createObjectURL(G),I=document.createElement("a");I.href=k,I.download=pe,document.body.appendChild(I),I.click(),document.body.removeChild(I),window.URL.revokeObjectURL(k),Xt(t("settings.panel.backupDownloadSuccess"),s)}catch(B){Gt(B,s)}finally{T(!1)}},te=async B=>{var G;const O=(G=B.target.files)==null?void 0:G[0];if(!!O){W(!0);try{const pe=As(),k=new FormData;k.append("file",O);const I=await fetch("/api/maintenance/backup/import",{method:"POST",headers:pe?{Authorization:`Bearer ${pe}`}:void 0,body:k});if(!I.ok)throw new Error(await I.text());Xt(t("settings.panel.backupUploadSuccess"),s)}catch(pe){Gt(pe,s)}finally{W(!1),B.target.value=""}}},J=q("forum_topics"),we=q("use_telegram"),Te=t("settings.telegram.disabledOverlay","Telegram bot is disabled. Enable it to edit these settings."),Ne=()=>{var B;(B=he.current)==null||B.click()};return n(z,{px:{base:4,md:8},py:{base:6,md:8},children:[e(Mn,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),n(ls,{colorScheme:"primary",children:[n(cs,{children:[e(er,{children:t("settings.panel.tabTitle","Panel")}),e(er,{children:t("settings.telegram","Telegram")}),e(er,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),n(ds,{children:[e(tr,{px:{base:0,md:2},children:p&&m===void 0?e(gt,{align:"center",justify:"center",py:12,children:e(Et,{size:"lg"})}):n(ye,{spacing:6,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.description","Control dashboard-specific behaviors that affect all admins.")}),e(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(gt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Mn,{size:"sm",mb:1,children:t("settings.panel.useNobetciTitle","Enable Nobetci integration")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.useNobetciDescription","Show Nobetci options when creating or editing nodes.")})]}),e(bt,{isChecked:S,onChange:B=>y(B.target.checked),isDisabled:ce.isLoading||p})]})}),n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(gt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Mn,{size:"sm",mb:1,children:t("settings.panel.maintenanceTitle","Maintenance status")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceDescription","Inspect which container images are currently used by the panel and node.")})]}),e(L,{variant:"outline",size:"sm",leftIcon:e(cn,{width:16,height:16}),onClick:()=>x.refetch(),isLoading:x.isFetching,children:t("actions.refresh","Refresh")})]}),e(ye,{spacing:2,mt:4,children:x.isLoading&&!x.data?e(gt,{align:"center",justify:"center",py:4,children:e(Et,{size:"sm"})}):n(Bt,{children:[n(z,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.panelVersion","Panel image")}),e(h,{fontSize:"sm",color:"gray.500",children:(_e=(ee=x.data)==null?void 0:ee.panel)!=null&&_e.image?`${x.data.panel.image}${x.data.panel.tag?` (${x.data.panel.tag})`:""}`:t("settings.panel.versionUnknown","Unknown")})]}),n(z,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.nodeVersion","Node image")}),e(h,{fontSize:"sm",color:"gray.500",children:(xe=x.data)!=null&&xe.node?x.data.node.image?`${x.data.node.image}${x.data.node.tag?` (${x.data.node.tag})`:""}`:t("settings.panel.versionUnknown","Unknown"):t("settings.panel.nodeVersionUnavailable","Node deployment not detected")})]})]})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(gt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Mn,{size:"sm",mb:1,children:t("settings.panel.backupTitle","Backup & Restore")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.backupDescription","Create or restore backups directly through the maintenance service.")})]}),n(ye,{spacing:3,direction:{base:"column",md:"row"},children:[e(L,{leftIcon:e(za,{width:16,height:16}),onClick:f,isLoading:v,children:t("settings.panel.backupDownload","Download backup")}),e(L,{leftIcon:e(Na,{width:16,height:16}),onClick:Ne,isLoading:N,children:t("settings.panel.backupUpload","Restore backup")})]})]}),e("input",{ref:he,type:"file",accept:".zip,.tar.gz",style:{display:"none"},onChange:te})]}),n(gt,{gap:3,justify:"flex-end",children:[e(L,{variant:"outline",leftIcon:e(sl,{}),onClick:()=>g(),isDisabled:ce.isLoading,children:t("actions.refresh","Refresh")}),e(L,{colorScheme:"primary",leftIcon:e(il,{}),onClick:()=>ce.mutate({use_nobetci:S}),isLoading:ce.isLoading,isDisabled:ce.isLoading||m===void 0||S===m.use_nobetci,children:t("settings.save","Save Settings")})]})]})}),e(tr,{px:{base:0,md:2},children:d&&!o?e(gt,{align:"center",justify:"center",py:12,children:e(Et,{size:"lg"})}):e("form",{onSubmit:P(A),children:n(me,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),n(gt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Mn,{size:"sm",mb:1,children:t("settings.telegram.enableBot","Enable Telegram bot")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.enableBotDescription","Turn the bot on or off without clearing the API token.")})]}),e(xt,{control:F,name:"use_telegram",render:({field:B})=>e(bt,{isChecked:B.value,onChange:O=>B.onChange(O.target.checked)})})]}),e(fa,{disabled:!we,message:Te,children:e(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(Le,{columns:{base:1,md:2},spacing:6,children:[n(C,{children:[e(_,{children:t("settings.telegram.apiToken","Bot API Token")}),e(De,{placeholder:"123456:ABC",...E("api_token")})]}),n(C,{children:[e(_,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(De,{placeholder:"socks5://user:pass@host:port",...E("proxy_url")})]}),n(C,{children:[e(_,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(De,{placeholder:"12345, 67890",...E("admin_chat_ids")}),e(cr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),n(C,{children:[e(_,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(De,{placeholder:"-100123456789",...E("logs_chat_id")}),e(cr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),n(C,{display:"flex",alignItems:"center",children:[e(_,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(xt,{control:F,name:"logs_chat_is_forum",render:({field:B})=>e(bt,{id:"logs_chat_is_forum",isChecked:B.value,onChange:B.onChange})})]}),n(C,{children:[e(_,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(De,{placeholder:"xtls-rprx-vision",...E("default_vless_flow")})]})]})})}),e(fa,{disabled:!we,message:Te,children:n(z,{children:[e(Mn,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),J&&Object.keys(J).length>0?e(ye,{spacing:4,children:Object.entries(J).map(([B])=>n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",B]}),n(Le,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(_,{children:t("settings.telegram.topicTitle","Topic Title")}),e(De,{...E(`forum_topics.${B}.title`)})]}),n(C,{children:[e(_,{children:t("settings.telegram.topicId","Topic ID")}),e(De,{type:"number",...E(`forum_topics.${B}.topic_id`)}),e(cr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},B))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]})}),e(fa,{disabled:!we,message:Te,children:n(z,{children:[e(Mn,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(ye,{spacing:4,children:lc.map(B=>n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(B.titleKey,B.defaultTitle)}),e(Le,{columns:{base:1,md:2},spacing:4,children:B.events.map(O=>n(C,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[n(z,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(O.labelKey,O.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(O.hintKey,O.defaultHint)})]}),e(xt,{control:F,name:`event_toggles.${Ia(O.key)}`,render:({field:G})=>e(bt,{isChecked:Boolean(G.value),onChange:pe=>G.onChange(pe.target.checked)})})]},O.key))})]},B.key))})]})}),n(gt,{gap:3,justify:"flex-end",children:[e(L,{variant:"outline",leftIcon:e(sl,{}),onClick:()=>u(),isDisabled:V.isLoading,children:t("actions.refresh","Refresh")}),e(L,{colorScheme:"primary",leftIcon:e(il,{}),type:"submit",isLoading:V.isLoading,isDisabled:!le&&!V.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(tr,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},Pg=async()=>{try{const t=As();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const s=await Ee("/admin",{headers:{Authorization:`Bearer ${t}`}});if(s&&typeof s=="object"&&"error"in s)throw new Error(`API error: ${s.error||"Unknown error"}`);return s}catch(t){throw console.error("Loader error:",t),t}},Tg=Rd([{path:"/",element:e(Vu,{}),errorElement:e(ao,{}),loader:Pg,children:[{index:!0,element:e(ch,{})},{path:"users",element:e(lp,{})},{path:"admins",element:e(xp,{})},{path:"usage",element:e(Cg,{})},{path:"services",element:e(dg,{})},{path:"hosts",element:e(lm,{})},{path:"node-settings",element:e(Am,{})},{path:"integrations",element:e(Ig,{})},{path:"xray-settings",element:e(lg,{})},{path:"xray-logs",element:e(ic,{})}]},{path:"/login/",element:e(ao,{})}]);function Eg(){return e(Ud,{router:Tg})}Re.extend(Md);Re.extend(Ld);Re.extend(fi);Re.extend(Od);Re.extend(Wd);Ri(Fd.get()||"light");Hd.createRoot(document.getElementById("root")).render(e(ba.StrictMode,{children:e(Bd,{theme:$d,children:e(Vd,{client:Qs,children:e(Eg,{})})})}));
