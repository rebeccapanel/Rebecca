var Yl=Object.defineProperty;var Gl=(t,s,r)=>s in t?Yl(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var q=(t,s,r)=>(Gl(t,typeof s!="symbol"?s+"":s,r),r);import{i as di,B as Xl,a as Ql,b as Zl,j as $o,d as ze,U as ga,z as jl,r as ec,f as tc,Q as rc,e as nc,m as Mt,$ as sc,c as ie,X as fa,R as na,N as zn,I as ve,g as Nn,h as n,F as k,k as e,l as _,n as Dr,o as ic,p as ba,q as Ft,s as ac,t as oc,u as lc,v as cc,w as Rr,x as Jr,L as dc,C as Ci,y as Ke,A as at,M as bi,D as yi,E as Ue,G as xi,H as jt,J as R,K as uc,T as p,S as hc,P as pc,O as sa,V as on,W as Si,Y as ya,Z as xa,_ as mc,a0 as Kt,a1 as Gr,a2 as qt,a3 as d,a4 as Na,a5 as z,a6 as wi,a7 as Lt,a8 as wt,a9 as Ut,aa as _t,ab as Ot,ac as kt,ad as ue,ae as $e,af as Ce,ag as nr,ah as H,ai as zt,aj as Cr,ak as xe,al as gc,am as Fs,an as Sa,ao as fc,ap as wa,aq as Br,ar as sn,as as pn,at as Er,au as zr,av as wn,aw as _i,ax as Mr,ay as bc,az as Ko,aA as yc,aB as xc,aC as Sc,aD as wc,aE as Di,aF as Jo,aG as qo,aH as pt,aI as rs,aJ as Ra,aK as kc,aL as vc,aM as Cc,aN as Yo,aO as _r,aP as ct,aQ as _c,aR as Dc,aS as Ac,aT as Pc,aU as ds,aV as Ic,aW as Tc,aX as Ai,aY as At,aZ as Go,a_ as Yr,a$ as gn,b0 as Ec,b1 as Hs,b2 as an,b3 as Xo,b4 as zc,b5 as Nc,b6 as st,b7 as Qo,b8 as Rc,b9 as Mc,ba as ka,bb as Zo,bc as jo,bd as Lc,be as Uc,bf as Oc,bg as el,bh as us,bi as hs,bj as tl,bk as ps,bl as ms,bm as Wc,bn as Fc,bo as Hc,bp as Os,bq as Ma,br as Wn,bs as Fn,bt as Vt,bu as Hn,bv as $t,bw as Bc,bx as Vc,by as kn,bz as $c,bA as Jt,bB as Kc,bC as ft,bD as mt,bE as rl,bF as nn,bG as Hr,bH as nl,bI as sl,bJ as Jc,bK as il,bL as Rn,bM as tn,bN as Dt,bO as Fe,bP as qr,bQ as Ne,bR as ni,bS as Vn,bT as al,bU as ol,bV as ll,bW as La,bX as un,bY as qc,bZ as Yc,b_ as Gc,b$ as Bs,c0 as Tr,c1 as Xc,c2 as cl,c3 as Qc,c4 as Zc,c5 as ns,c6 as ss,c7 as Js,c8 as dl,c9 as yt,ca as jc,cb as Zn,cc as Nr,cd as qs,ce as ul,cf as Xn,cg as ui,ch as ed,ci as hl,cj as va,ck as Ir,cl as pl,cm as Ys,cn as jn,co as td,cp as rd,cq as nd,cr as sd,cs as hi,ct as Ws,cu as ml,cv as gl,cw as id,cx as ad,cy as od,cz as ld,cA as cd,cB as dd,cC as ud,cD as hd,cE as Ua,cF as pd,cG as md,cH as gd,cI as Ca,cJ as fd,cK as yn,cL as bd,cM as yd,cN as xd,cO as Sd,cP as wd,cQ as kd,cR as vd,cS as Cd,cT as _d,cU as Dd}from"./vendor.92015749.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();di.use(Xl).use(Ql).use(Zl).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:$o(["/","statics/locales/{{lng}}.json"])}},function(t,s){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",di.language),ze.locale(di.language)});di.on("languageChanged",t=>{console.log("Language changed to:",t),ze.locale(t)});ga("zh-cn",jl);ga("ru",ec);ga("fa",tc);const pi=new rc,mi=(t,s)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:s||"#f6f8ff"},o=s||l[t]||l.default;r==null||r.setAttribute("content",o)},Ad=nc({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:Mt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:Mt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:Mt("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:Mt("surface.light","surface.dark")(t),borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:Mt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Mt("lg","dark-lg")(t)},item:{_hover:{bg:Mt("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:Mt("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:Mt("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Mt("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:Mt("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:Mt("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:Mt("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:Mt("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:Mt("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:Mt("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:Mt("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const is=()=>localStorage.getItem("token"),Pd=t=>{localStorage.setItem("token",t)},Id=()=>{localStorage.removeItem("token")},Td=sc.create({baseURL:"https://bot.mazholl.com:8585/api"}),Ed=(t,s={})=>(is()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${is()}`}),Td(t,s)),Pe=Ed,zd=ie(fa,{baseStyle:{w:4,h:4}}),er=na.forwardRef(({disabled:t,step:s,label:r,className:l,startAdornment:o,endAdornment:i,type:a="text",placeholder:c,onChange:u,onBlur:h,name:m,value:g,onClick:w,error:v,clearable:S=!1,...y},N)=>{const I=()=>{u&&u({target:{value:"",name:m}})},{size:M="md"}=y,ae=a=="number"?zn:ve,b=a=="number"?Nn:na.Fragment,F=a=="number"?{keepWithinRange:!0,precision:5,format:C=>isNaN(parseFloat(String(C)))||Number(parseFloat(String(C)).toFixed(5))===0?C:Number(parseFloat(String(C)).toFixed(5)),min:typeof y.min=="number"?y.min:y.min!==void 0?Number(y.min):0,step:s,name:m,type:a,placeholder:c,onBlur:h,onClick:w,disabled:t,flexGrow:1,size:M,onChange:(C,X)=>{!u||u({target:{value:C,valueAsNumber:X,name:m}})}}:{};return n(k,{isInvalid:!!v,children:[r&&e(_,{children:r}),n(Dr,{size:M,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[o&&e(ic,{children:o}),n(b,{...F,children:[e(ae,{name:m,ref:N,step:s,className:ba(l),type:a,placeholder:c,onChange:a==="number"?void 0:u,onBlur:h,value:a==="number"?void 0:g,onClick:w,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...y,roundedLeft:o?"0":"md",roundedRight:i?"0":"md"}),a=="number"&&e(Ft,{children:n(ac,{children:[e(oc,{}),e(lc,{})]})})]}),i&&e(cc,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),S&&g&&g.length&&e(Rr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:I,cursor:"pointer",children:e(zd,{})})]}),!!v&&e(Jr,{children:v})]})}),ia="/statics/logo.e8dba2f4.svg",Nd=ie(dc,{baseStyle:{w:4,h:4}}),Rd=ie(Ci,{baseStyle:{w:4,h:4}}),fl=({actions:t})=>{const{i18n:s}=Ke(),r=at("surface.light","surface.dark"),l=at("blackAlpha.50","whiteAlpha.100"),o=at("blackAlpha.200","whiteAlpha.200"),i=at("gray.800","gray.100"),a=u=>{s.changeLanguage(u)};return n(bi,{placement:"bottom-end",children:[e(yi,{as:Ue,size:"sm",variant:"outline",icon:e(Nd,{}),position:"relative"}),e(xi,{minW:"160px",zIndex:9999,bg:r,borderColor:o,color:i,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:h,flag:m})=>e(jt,{fontSize:"sm",onClick:()=>a(u),_hover:{bg:l},children:n(R,{justify:"space-between",w:"full",children:[n(R,{spacing:2,children:[e(uc,{countryCode:m,svg:!0,style:{width:"16px",height:"12px"}}),e(p,{children:h})]}),s.language===u&&e(Rd,{})]})},u))})]})},Oa="rb-theme",Wa="rb-custom-themes",Md=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],Fa=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],Ha=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],Sr={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},wr={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Oi=.14,Wi=.22,Ba=ie(Ci,{baseStyle:{w:4,h:4}}),Ld=ie(hc,{baseStyle:{w:4,h:4}}),Ud=ie(pc,{baseStyle:{w:4,h:4}}),Od=ie(sa,{baseStyle:{w:4,h:4}}),Wd=ie(on,{baseStyle:{w:4,h:4}}),Va=ie(Si,{baseStyle:{w:4,h:4}}),Fd=ie(ya,{baseStyle:{w:4,h:4}}),Hd=ie(xa,{baseStyle:{w:4,h:4}}),Bd=ie(mc,{baseStyle:{w:4,h:4}}),bl=(t,s=0,r=1)=>Math.min(r,Math.max(s,t)),aa=t=>{const s=t.replace("#",""),r=parseInt(s,16);if(s.length===3){const l=r>>8&15,o=r>>4&15,i=r&15;return{r:l<<4|l,g:o<<4|o,b:i<<4|i}}return{r:r>>16&255,g:r>>8&255,b:r&255}},yl=(t,s,r)=>{const l=o=>o.toString(16).padStart(2,"0");return`#${l(t)}${l(s)}${l(r)}`},Vd=(t,s,r)=>{t/=255,s/=255,r/=255;const l=Math.max(t,s,r),o=Math.min(t,s,r);let i=0,a=0;const c=(l+o)/2;if(l!==o){const u=l-o;switch(a=c>.5?u/(2-l-o):u/(l+o),l){case t:i=(s-r)/u+(s<r?6:0);break;case s:i=(r-t)/u+2;break;default:i=(t-s)/u+4}i/=6}return{h:i,s:a,l:c}},$d=(t,s,r)=>{let l,o,i;if(s===0)l=o=i=r;else{const a=(h,m,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?h+(m-h)*6*g:g<.5?m:g<.6666666666666666?h+(m-h)*(.6666666666666666-g)*6:h),c=r<.5?r*(1+s):r+s-r*s,u=2*r-c;l=a(u,c,t+1/3),o=a(u,c,t),i=a(u,c,t-1/3)}return{r:Math.round(l*255),g:Math.round(o*255),b:Math.round(i*255)}},Fi=t=>{try{const{r:s,g:r,b:l}=aa(t),{h:o,s:i,l:a}=Vd(s,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[h,m])=>{const{r:g,g:w,b:v}=$d(o,i,bl(a+m));return u[`--primary-${h}`]=yl(g,w,v),u},{})}catch{return{}}},Kd=(t,s,r)=>{const l=bl(r,0,1),o=aa(t),i=aa(s),a=(c,u)=>Math.round(c*(1-l)+u*l);return yl(a(o.r,i.r),a(o.g,i.g),a(o.b,i.b))},$n=(t,s,r,l)=>{try{return Kd(t,s,r)}catch{return l}},Jd=()=>{const t=document.documentElement;Md.forEach(s=>t.style.removeProperty(s)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},qd=(t,s)=>{const r=document.documentElement;Object.entries(t).forEach(([l,o])=>r.style.setProperty(l,o)),r.style.setProperty("--bg-light",s.bgLight),r.style.setProperty("--bg-dark",s.bgDark),r.style.setProperty("--surface-light",s.surfaceLight),r.style.setProperty("--surface-dark",s.surfaceDark)},Hi=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},$a=()=>({name:"",light:{...Sr},dark:{...wr}}),Xt=(t,s)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:s,xl=({minimal:t=!1})=>{const{t:s}=Ke(),r=Kt(),{colorMode:l,toggleColorMode:o}=Gr(),i=qt(),a=qt(),c=at("surface.light","surface.dark"),u=at("blackAlpha.50","whiteAlpha.100"),h=at("blackAlpha.200","whiteAlpha.200"),m=at("gray.800","gray.100"),g=at("gray.600","gray.300"),w=at("blackAlpha.400","blackAlpha.700"),v=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:g}}),[g]),[S,y]=d.exports.useState(()=>{try{return localStorage.getItem(Oa)||"default"}catch{return"default"}}),[N,I]=d.exports.useState(()=>{try{const D=localStorage.getItem(Wa);if(!D)return[];const V=JSON.parse(D);return Array.isArray(V)?V.map(ge=>{var j,Te,qe,Qe,T,ce;const pe=Xt(((j=ge.light)==null?void 0:j.primary)||Sr.primary,Sr.primary),Z=Xt(((Te=ge.light)==null?void 0:Te.bg)||Sr.bg,Sr.bg),_e=$n(Z,pe,Oi,Sr.surface),te=Xt(((qe=ge.light)==null?void 0:qe.surface)||_e,_e),le=Xt(((Qe=ge.dark)==null?void 0:Qe.primary)||wr.primary,wr.primary),B=Xt(((T=ge.dark)==null?void 0:T.bg)||wr.bg,wr.bg),L=$n(B,le,Wi,wr.surface),U=Xt(((ce=ge.dark)==null?void 0:ce.surface)||L,L);return{id:ge.id||Hi(),name:ge.name||"Custom",light:{primary:pe,bg:Z,surface:te},dark:{primary:le,bg:B,surface:U}}}):[]}catch{return[]}}),[M,ae]=d.exports.useState($a),[b,F]=d.exports.useState(null),[C,X]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(Wa,JSON.stringify(N))}catch{}},[N]),d.exports.useEffect(()=>{try{localStorage.setItem(Oa,S)}catch{}},[S]),d.exports.useEffect(()=>{S.startsWith("custom:")&&(N.some(V=>`custom:${V.id}`===S)||y("default"))},[S,N]),d.exports.useEffect(()=>{const D=document.documentElement;Array.from(D.classList).filter(ge=>ge.startsWith("rb-theme-")).forEach(ge=>D.classList.remove(ge)),Jd();const V=Fa.find(ge=>ge.key===S);if(V){V.className&&D.classList.add(V.className),mi(V.key);return}if(S.startsWith("custom:")){const ge=N.find(_e=>`custom:${_e.id}`===S);if(!ge)return;const pe=l==="dark"?ge.dark:ge.light,Z=Fi(pe.primary);qd(Z,{bgLight:ge.light.bg,bgDark:ge.dark.bg,surfaceLight:ge.light.surface,surfaceDark:ge.dark.surface}),mi("custom",l==="dark"?ge.dark.bg:ge.light.bg)}else mi("default")},[S,N,l]);const Y=d.exports.useCallback(D=>{D.colorModeTarget&&l!==D.colorModeTarget&&o(),y(D.key)},[l,o]),me=D=>{y(`custom:${D}`)},O=D=>{F(null),ae(D?{name:s(`theme.presets.${D.key}.name`),light:{...D.light},dark:{...D.dark}}:$a()),i.onOpen()},oe=D=>{F(D.id),ae({name:D.name,light:{...D.light},dark:{...D.dark}}),i.onOpen()},P=()=>{const D=M.name.trim()||s("theme.untitled"),V=Xt(M.light.primary,Sr.primary),ge=Xt(M.light.bg,Sr.bg),pe=$n(ge,V,Oi,Sr.surface),Z=Xt(M.light.surface,pe),_e=Xt(M.dark.primary,wr.primary),te=Xt(M.dark.bg,wr.bg),le=$n(te,_e,Wi,wr.surface),B=Xt(M.dark.surface,le),L={id:b||Hi(),name:D,light:{primary:V,bg:ge,surface:Z},dark:{primary:_e,bg:te,surface:B}};I(U=>b?U.map(j=>j.id===b?L:j):[...U,L]),y(`custom:${L.id}`),i.onClose(),F(null),r({status:"success",title:s("theme.customSaved")})},we=D=>{I(V=>V.filter(ge=>ge.id!==D)),S===`custom:${D}`&&y("default"),r({status:"info",title:s("theme.customDeleted")})},A=()=>{y("default"),r({status:"info",title:s("theme.resetSuccess")})},De=async()=>{if(!N.length){r({status:"warning",title:s("theme.exportEmpty")});return}const D=N.map(({id:ge,...pe})=>pe),V=JSON.stringify(D,null,2);try{await navigator.clipboard.writeText(V),r({status:"success",title:s("theme.exportSuccess")})}catch{try{const ge=new Blob([V],{type:"application/json"}),pe=URL.createObjectURL(ge),Z=document.createElement("a");Z.href=pe,Z.download="rebecca-themes.json",Z.click(),URL.revokeObjectURL(pe),r({status:"success",title:s("theme.exportSuccessDownload")})}catch{r({status:"error",title:s("theme.exportError")})}}},ee=()=>{try{const D=JSON.parse(C),ge=(Array.isArray(D)?D:[D]).map(pe=>{var Te,qe,Qe,T,ce,$;const Z=Xt(((Te=pe==null?void 0:pe.light)==null?void 0:Te.primary)||Sr.primary,Sr.primary),_e=Xt(((qe=pe==null?void 0:pe.light)==null?void 0:qe.bg)||Sr.bg,Sr.bg),te=$n(_e,Z,Oi,Sr.surface),le=Xt(((Qe=pe==null?void 0:pe.light)==null?void 0:Qe.surface)||te,te),B=Xt(((T=pe==null?void 0:pe.dark)==null?void 0:T.primary)||wr.primary,wr.primary),L=Xt(((ce=pe==null?void 0:pe.dark)==null?void 0:ce.bg)||wr.bg,wr.bg),U=$n(L,B,Wi,wr.surface),j=Xt((($=pe==null?void 0:pe.dark)==null?void 0:$.surface)||U,U);return{id:Hi(),name:(pe==null?void 0:pe.name)||"Custom",light:{primary:Z,bg:_e,surface:le},dark:{primary:B,bg:L,surface:j}}}).filter(pe=>pe.name);if(!ge.length){r({status:"warning",title:s("theme.importError")});return}I(pe=>[...pe,...ge]),a.onClose(),X(""),r({status:"success",title:s("theme.importSuccess")})}catch{r({status:"error",title:s("theme.importError")})}},Ae=d.exports.useCallback((D,V)=>{D.preventDefault(),D.stopPropagation(),V()},[]),Re=d.exports.useMemo(()=>Fi(M.light.primary),[M.light.primary]),Me=d.exports.useMemo(()=>Fi(M.dark.primary),[M.dark.primary]),G=D=>{const V=M[D],ge=D==="dark"?Me:Re,pe=ge["--primary-500"]||V.primary,Z=ge["--primary-300"]||ge["--primary-400"]||pe,_e=D==="dark"?"whiteAlpha.900":"gray.800",te=D==="dark"?"whiteAlpha.700":"gray.600",le=D==="dark"?"whiteAlpha.200":"blackAlpha.200",B=D==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(z,{borderWidth:"1px",borderRadius:"md",bg:V.bg,p:4,borderColor:le,children:n(Ce,{spacing:3,children:[e(p,{fontWeight:"semibold",color:_e,children:s(D==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(z,{borderRadius:"lg",bg:V.surface,p:4,borderWidth:"1px",borderColor:le,children:n(Ce,{spacing:2,children:[e(p,{fontSize:"lg",fontWeight:"bold",color:_e,children:s("theme.previewSampleTitle")}),e(p,{fontSize:"sm",color:te,children:s("theme.previewSampleBody")}),e(H,{size:"sm",bg:pe,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:s("theme.previewSampleAction")}),n(R,{spacing:2,pt:2,children:[e(z,{flex:"1",h:"2",borderRadius:"full",bg:Z,opacity:.8}),e(z,{flex:"1",h:"2",borderRadius:"full",bg:pe,opacity:.9})]})]})}),n(R,{spacing:1,pt:1,flexWrap:"wrap",children:[e(z,{w:6,h:6,borderRadius:"sm",bg:V.bg,borderWidth:"1px",borderColor:B}),e(z,{w:6,h:6,borderRadius:"sm",bg:V.surface,borderWidth:"1px",borderColor:B}),Object.entries(ge).map(([L,U])=>e(z,{w:6,h:6,borderRadius:"sm",bg:U,borderWidth:"1px",borderColor:B,title:L},L))]})]})})};return n(Ft,{children:[n(bi,{placement:"bottom-end",children:[e(yi,{as:Ue,size:"sm",variant:"outline",icon:e(Ld,{}),position:"relative"}),n(xi,{minW:"260px",zIndex:9999,bg:c,color:m,borderColor:h,children:[e(Na,{title:s("theme.builtIn"),sx:v,children:Fa.map(D=>{const V=S===D.key;return e(jt,{onClick:()=>Y(D),_hover:{bg:u},children:n(R,{justify:"space-between",w:"full",children:[n(R,{children:[e(z,{w:"4",h:"3",bg:D.accent,borderRadius:"xs",borderWidth:"1px",borderColor:h}),e(p,{children:s(`theme.${D.key}`)})]}),V&&e(Ba,{})]})},D.key)})}),!t&&n(Ft,{children:[e(wi,{borderColor:h}),n(Na,{title:s("theme.customGroup"),sx:v,children:[N.length?N.map(D=>{const V=S===`custom:${D.id}`;return e(jt,{onClick:()=>me(D.id),_hover:{bg:u},children:n(R,{justify:"space-between",w:"full",children:[n(R,{children:[e(z,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${D.light.surface}, ${D.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:h}),e(p,{children:D.name})]}),n(R,{spacing:1,children:[V&&e(Ba,{}),[{icon:e(Od,{}),label:s("theme.edit"),onClick:()=>oe(D)},{icon:e(Wd,{}),label:s("theme.delete"),onClick:()=>we(D.id)}].map(({icon:ge,label:pe,onClick:Z})=>e(z,{as:"span",role:"button",tabIndex:0,"aria-label":pe,onClick:_e=>Ae(_e,Z),onKeyDown:_e=>{(_e.key==="Enter"||_e.key===" ")&&Ae(_e,Z)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:u},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:ge},pe))]})]})},D.id)}):e(jt,{isDisabled:!0,children:s("theme.noCustom")}),e(jt,{icon:e(Ud,{}),onClick:()=>O(),_hover:{bg:u},children:s("theme.createCustom")})]}),e(wi,{borderColor:h}),e(jt,{icon:e(Va,{}),onClick:()=>O(Ha[0]),_hover:{bg:u},children:s("theme.quickPreset")}),e(jt,{icon:e(Fd,{}),onClick:De,_hover:{bg:u},children:s("theme.export")}),e(jt,{icon:e(Hd,{}),onClick:()=>a.onOpen(),_hover:{bg:u},children:s("theme.import")}),e(jt,{icon:e(Bd,{}),onClick:A,_hover:{bg:u},children:s("theme.reset")})]})]})]}),n(Lt,{isOpen:i.isOpen,onClose:i.onClose,isCentered:!0,size:"xl",children:[e(wt,{bg:w,backdropFilter:"blur(4px)"}),n(Ut,{mx:4,bg:c,borderColor:h,borderWidth:"1px",color:m,children:[e(_t,{color:m,children:s(b?"theme.editThemeTitle":"theme.customTitle")}),e(Ot,{}),e(kt,{children:n(ue,{spacing:6,align:"stretch",children:[n(k,{children:[e(_,{color:g,children:s("theme.customName")}),e(ve,{placeholder:s("theme.customNamePlaceholder")||"",value:M.name,onChange:D=>ae(V=>({...V,name:D.target.value}))})]}),n($e,{columns:{base:1,md:2},spacing:4,children:[G("light"),G("dark")]}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(Ce,{spacing:4,children:[n(k,{children:[e(_,{color:g,children:s("theme.lightPrimary")}),e(ve,{type:"color",value:M.light.primary,onChange:D=>ae(V=>({...V,light:{...V.light,primary:D.target.value}}))}),e(nr,{color:g,children:s("theme.lightPrimaryHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.lightSurface")}),e(ve,{type:"color",value:M.light.surface,onChange:D=>ae(V=>({...V,light:{...V.light,surface:D.target.value}}))}),e(nr,{color:g,children:s("theme.lightSurfaceHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.lightBackground")}),e(ve,{type:"color",value:M.light.bg,onChange:D=>ae(V=>({...V,light:{...V.light,bg:D.target.value}}))})]})]}),n(Ce,{spacing:4,children:[n(k,{children:[e(_,{color:g,children:s("theme.darkPrimary")}),e(ve,{type:"color",value:M.dark.primary,onChange:D=>ae(V=>({...V,dark:{...V.dark,primary:D.target.value}}))}),e(nr,{color:g,children:s("theme.darkPrimaryHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.darkSurface")}),e(ve,{type:"color",value:M.dark.surface,onChange:D=>ae(V=>({...V,dark:{...V.dark,surface:D.target.value}}))}),e(nr,{color:g,children:s("theme.darkSurfaceHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.darkBackground")}),e(ve,{type:"color",value:M.dark.bg,onChange:D=>ae(V=>({...V,dark:{...V.dark,bg:D.target.value}}))})]})]})]}),n(z,{children:[n(R,{mb:2,children:[e(Va,{}),e(p,{fontWeight:"semibold",children:s("theme.presets")})]}),e($e,{columns:{base:1,md:3},spacing:3,children:Ha.map(D=>e(H,{size:"sm",variant:"outline",onClick:()=>ae({name:s(`theme.presets.${D.key}.name`),light:{...D.light},dark:{...D.dark}}),children:s(`theme.presets.${D.key}.name`)},D.key))})]})]})}),n(zt,{children:[e(H,{variant:"ghost",mr:3,onClick:i.onClose,children:s("cancel")}),e(H,{colorScheme:"primary",onClick:P,children:s(b?"theme.customUpdate":"theme.customSave")})]})]})]}),n(Lt,{isOpen:a.isOpen,onClose:a.onClose,size:"lg",isCentered:!0,children:[e(wt,{bg:w,backdropFilter:"blur(4px)"}),n(Ut,{mx:4,bg:c,borderColor:h,borderWidth:"1px",color:m,children:[e(_t,{color:m,children:s("theme.importTitle")}),e(Ot,{}),e(kt,{children:n(ue,{spacing:4,align:"stretch",children:[e(p,{fontSize:"sm",color:g,children:s("theme.importDescription")}),e(Cr,{rows:8,placeholder:s("theme.importPlaceholder")||"",value:C,onChange:D=>X(D.target.value),bg:"transparent",borderColor:h,color:m})]})}),n(zt,{children:[e(H,{variant:"ghost",mr:3,onClick:a.onClose,children:s("cancel")}),e(H,{colorScheme:"primary",onClick:ee,children:s("theme.importAction")})]})]})]})]})},Yd=xe.object({username:xe.string().min(1,"login.fieldRequired"),password:xe.string().min(1,"login.fieldRequired")}),Gd=ie("img",{baseStyle:{w:12,h:12}}),Xd=ie(gc,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Qd=ie(Fs,{baseStyle:{w:4,h:4}}),Zd=ie(Sa,{baseStyle:{w:4,h:4}}),Ka=()=>{var S,y;const[t,s]=d.exports.useState(""),[r,l]=d.exports.useState(!1),[o,i]=d.exports.useState(!1),a=fc(),{t:c}=Ke(),{colorMode:u}=Gr();let h=wa();const{register:m,formState:{errors:g},handleSubmit:w}=Br({resolver:_i(Yd)});d.exports.useEffect(()=>{Id(),h.pathname!=="/login"&&a("/login",{replace:!0})},[]);const v=N=>{s("");const I=new FormData;I.append("username",N.username),I.append("password",N.password),I.append("grant_type","password"),l(!0),Pe("/admin/token",{method:"post",body:I}).then(({access_token:M})=>{console.log("Token received:",M),Pd(M),a("/")}).catch(M=>{var ae,b;s(((b=(ae=M.response)==null?void 0:ae._data)==null?void 0:b.detail)||"Login failed")}).finally(()=>l(!1))};return e(ue,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(sn,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:n(pn,{children:[n(R,{justifyContent:"end",spacing:2,mb:6,children:[e(fl,{}),e(xl,{minimal:!0})]}),n(ue,{alignItems:"center",w:"full",spacing:4,children:[e(Gd,{src:ia,alt:c("appName")||"Rebecca",filter:u==="dark"?"brightness(0) invert(1)":"none"}),e(p,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(p,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(z,{w:"full",pt:"4",children:e("form",{onSubmit:w(v),children:n(ue,{spacing:4,children:[e(k,{children:e(er,{w:"full",placeholder:c("username"),...m("username"),error:c((S=g==null?void 0:g.username)==null?void 0:S.message)})}),n(k,{isInvalid:!!g.password,children:[n(Dr,{children:[e(ve,{w:"full",type:o?"text":"password",placeholder:c("password"),...m("password")}),e(Rr,{children:e(Ue,{"aria-label":o?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>i(!o),icon:o?e(Zd,{}):e(Qd,{})})})]}),e(Jr,{children:(y=g.password)==null?void 0:y.message})]}),t&&n(Er,{status:"error",rounded:"md",children:[e(zr,{}),e(wn,{children:t})]}),n(H,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(Xd,{marginRight:1}),c("login")]})]})})})]})})})},Qn={users:{create:!0,delete:!1,reset_usage:!1,revoke:!1,create_on_hold:!1,allow_unlimited_data:!1,allow_unlimited_expire:!1,allow_next_plan:!1,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},jd=async()=>await Pe("/admin"),fr=()=>{const{data:t,isError:s,isLoading:r,isSuccess:l,error:o}=Mr({queryFn:()=>jd()});return{userData:t?{...t,role:t.role||"standard",permissions:t.permissions||Qn}:{role:"standard",permissions:Qn,telegram_id:"",username:"",users_usage:0,status:"active",disabled_reason:null},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:s,getUserError:o}},fn={baseStyle:{w:5,h:5}},eu=ie(bc,fn),tu=ie(Ko,fn),ru=ie(yc,fn),Bi=ie(xc,fn),nu=ie(Sc,fn),su=ie(wc,fn),iu=ie(Di,fn),au=ie(Jo,fn),ou=ie(qo,fn),Ja=ie("img",{baseStyle:{w:8,h:8}}),qa=({collapsed:t,inDrawer:s=!1,onRequestExpand:r})=>{var ae;const{t:l}=Ke(),o=wa(),{colorMode:i}=Gr(),{userData:a,getUserIsSuccess:c}=fr(),u=d.exports.useMemo(()=>{switch(a.role){case"full_access":return l("admins.roles.fullAccess","Full access");case"sudo":return l("admins.roles.sudo","Sudo");case"standard":default:return l("admins.roles.standard","Standard")}},[l,a.role]),h=(ae=a.permissions)==null?void 0:ae.sections,m=Boolean(h==null?void 0:h.usage),g=Boolean(h==null?void 0:h.admins),w=Boolean(h==null?void 0:h.services),S=[...[h!=null&&h.hosts?{title:l("header.hostSettings"),url:"/hosts",icon:ru}:null,h!=null&&h.nodes?{title:l("header.nodeSettings"),url:"/node-settings",icon:nu}:null,h!=null&&h.integrations?{title:l("header.integrationSettings","Master Settings"),url:"/integrations",icon:Bi}:null,h!=null&&h.xray?{title:l("header.xraySettings"),url:"/xray-settings",icon:Bi}:null].filter(Boolean)];w&&S.unshift({title:l("services.menu","Services"),url:"/services",icon:au});const y=S.some(b=>o.pathname===b.url),[N,I]=d.exports.useState(y);d.exports.useEffect(()=>{y&&I(!0)},[y]);const M=[{title:l("dashboard"),url:"/",icon:eu},{title:l("users"),url:"/users",icon:tu}];return m&&M.push({title:l("usage.menu","Usage"),url:"/usage",icon:ou}),g&&M.push({title:l("admins","Admins"),url:"/admins",icon:su}),S.length>0&&M.push({title:l("header.settings"),icon:Bi,subItems:S}),e(z,{w:s?"full":t?"16":"60",h:s?"100%":"100vh",maxH:s?"100%":"100vh",bg:"surface.light",borderRight:s?void 0:"1px",borderColor:s?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:s?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:s?"relative":"fixed",top:s?void 0:"0",left:s?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:n(ue,{spacing:2,p:t?2:4,align:"stretch",h:"100%",justify:"space-between",children:[n(z,{flex:"1",overflowY:"auto",children:[t?e(R,{justify:"center",mb:6,children:e(pt,{label:"Rebecca",placement:"right",hasArrow:!0,children:e(Ja,{src:ia,alt:"Rebecca",filter:i==="dark"?"brightness(0) invert(1)":"none"})})}):n(R,{spacing:3,align:"center",mb:6,px:2,children:[e(Ja,{src:ia,alt:"Rebecca",filter:i==="dark"?"brightness(0) invert(1)":"none"}),e(p,{fontSize:"lg",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},children:l("menu")})]}),M.map(b=>{const F=b.url,C=typeof F=="string"&&o.pathname===F||typeof F=="string"&&F!=="/"&&o.pathname.startsWith(F)||b.subItems&&b.subItems.some(Y=>o.pathname===Y.url),X=b.icon;return e(z,{children:b.subItems?n(Ft,{children:[e(pt,{label:t?b.title:"",placement:"right",hasArrow:!0,children:n(R,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:C?"primary.50":"transparent",color:C?"primary.600":"gray.700",_dark:{bg:C?"primary.900":"transparent",color:C?"primary.200":"gray.300"},_hover:{bg:C?"primary.50":"gray.50",_dark:{bg:C?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>{t?(r&&r(),I(!0)):I(!N)},children:[n(R,{spacing:3,children:[e(X,{w:t?5:void 0,h:t?5:void 0}),!t&&e(p,{fontSize:"sm",fontWeight:C?"semibold":"normal",children:b.title})]}),!t&&e(iu,{transform:N?"rotate(180deg)":"rotate(0deg)"})]})}),!t&&e(rs,{in:N,animateOpacity:!0,children:e(ue,{align:"stretch",pl:6,spacing:1,mt:2,children:b.subItems.map(Y=>{const me=o.pathname===Y.url,O=Y.icon;return e(Ra,{to:Y.url,children:n(R,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:me?"primary.50":"transparent",color:me?"primary.600":"gray.700",_dark:{bg:me?"primary.900":"transparent",color:me?"primary.200":"gray.300"},_hover:{bg:me?"primary.50":"gray.50",_dark:{bg:me?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(O,{w:t?5:void 0,h:t?5:void 0}),e(p,{fontSize:"sm",fontWeight:me?"semibold":"normal",children:Y.title})]})},Y.url)})})})]}):b.url?e(Ra,{to:b.url,children:e(pt,{label:t?b.title:"",placement:"right",hasArrow:!0,children:n(R,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:C?"primary.50":"transparent",color:C?"primary.600":"gray.700",_dark:{bg:C?"primary.900":"transparent",color:C?"primary.200":"gray.300"},_hover:{bg:C?"primary.50":"gray.50",_dark:{bg:C?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(X,{w:t?5:void 0,h:t?5:void 0}),!t&&e(p,{fontSize:"sm",fontWeight:C?"semibold":"normal",children:b.title})]})})}):null},b.title)})]}),c&&a.username&&e(z,{px:t?2:3,py:2,borderTop:"1px",borderColor:"light-border",_dark:{borderColor:"whiteAlpha.200"},mt:4,children:t?e(pt,{label:`${a.username} \xB7 ${u}`,placement:"right",hasArrow:!0,children:e(z,{w:"8",h:"8",borderRadius:"full",bg:"primary.100",_dark:{bg:"primary.800"},display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",flexShrink:0,children:e(p,{fontSize:"sm",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},textAlign:"center",children:a.username.charAt(0).toUpperCase()})})}):n(ue,{align:"flex-start",spacing:1,children:[e(p,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:"username:"}),e(p,{fontSize:"sm",fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},noOfLines:1,children:a.username}),e(p,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:l("admins.roleLabel","Admin role")}),e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:u})]})})]})})},lu=()=>{const[t,s]=d.exports.useState(null);return Gr(),d.exports.useEffect(()=>{fetch("https://api.github.com/repos/rebeccapanel/Rebecca").then(l=>l.json()).then(l=>{l.stargazers_count&&s(l.stargazers_count)}).catch(()=>{})},[]),e(z,{as:"button",onClick:()=>{window.open("https://github.com/rebeccapanel/Rebecca","_blank","noopener,noreferrer")},px:3,py:1.5,borderRadius:"md",borderWidth:"1px",borderColor:"gray.300",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},_hover:{bg:"gray.50",borderColor:"gray.400",transform:"translateY(-1px)",boxShadow:"sm",_dark:{bg:"gray.700",borderColor:"gray.500"}},transition:"all 0.2s",cursor:"pointer","aria-label":"GitHub Stars",children:n(R,{spacing:2,align:"center",children:[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"})}),n(R,{spacing:1,px:1.5,py:.5,borderRadius:"full",bg:"gray.100",_dark:{bg:"gray.700"},children:[e(kc,{style:{width:"14px",height:"14px",color:"#fbbf24"}}),t!==null?e(p,{fontSize:"xs",fontWeight:"bold",color:"gray.700",_dark:{color:"gray.200"},lineHeight:"1",children:t>1e3?`${(t/1e3).toFixed(1)}k`:t}):e(p,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},lineHeight:"1",children:"..."})]})]})})},gi=vc,cu="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",Sl={base:cu,folder:"apple/64",ext:".png",className:"apple-emoji"},Vi=t=>{var s,r;return typeof t=="string"&&((r=(s=gi.test)==null?void 0:s.call(gi,t))!=null?r:!1)},du=t=>t.some(s=>{var r;return s.type==="characterData"?Vi((r=s.target)==null?void 0:r.data):s.type==="childList"?Array.from(s.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return Vi(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const o=l;return o.tagName==="IMG"&&o.classList.contains(Sl.className)?!1:Vi(o.textContent)}return!1}):!1}),uu=()=>{const t=wa();d.exports.useEffect(()=>{const s=document.getElementById("root");if(!s)return;const r=()=>{gi.parse(s,Sl)};r();const l=new MutationObserver(o=>{du(o)&&requestAnimationFrame(r)});return l.observe(s,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},wl={baseStyle:{w:4,h:4}},hu=ie(Cc,wl),pu=ie(Yo,wl);function mu(){const[t,s]=d.exports.useState(!1),r=_r({base:!0,md:!1}),l=qt();return uu(),n(ct,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(qa,{collapsed:t,onRequestExpand:()=>s(!1)}),n(ct,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[n(z,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(Ue,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():s(!t)},icon:e(pu,{})}),n(R,{spacing:2,children:[e(lu,{}),e(fl,{}),e(xl,{}),e(_c,{to:"/login",children:e(Ue,{size:"sm",variant:"outline","aria-label":"logout",icon:e(hu,{})})})]})]}),e(z,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(Dc,{})})]}),r&&n(Ac,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(wt,{}),e(Pc,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(kt,{p:0,children:e(qa,{collapsed:!1,inDrawer:!0})})})]})]})}const kl="rebecca-num-users-per-page",Ya=10,gu=()=>{const t=localStorage.getItem(kl)||Ya.toString();return parseInt(t)||Ya},fu=t=>localStorage.setItem(kl,t),vl="-created_at",bu=60*60*1e3,yu=t=>{const s={sort:t.sort||vl};return Object.keys(t).forEach(r=>{if(r==="sort")return;const l=t[r];l==null||l===""||(s[r]=l)}),s},xu=t=>JSON.stringify(Object.keys(t).sort().map(s=>[s,t[s]])),Su=(t,s={})=>{const r=yu(t),l=xu(r),{lastUsersFetchAt:o,usersCacheKey:i,users:a}=Ct.getState(),c=Date.now();return!s.force&&o&&i===l&&c-o<bu?Promise.resolve(a):(Ct.setState({loading:!0}),Pe("/users",{query:r}).then(u=>{var w,v;const h=(w=u.users_limit)!=null?w:null,m=(v=u.active_total)!=null?v:null,g=h!=null&&h>0&&m!==null?m>=h:!1;return Ct.setState({users:u,isUserLimitReached:g,lastUsersFetchAt:Date.now(),usersCacheKey:l}),u}).finally(()=>{Ct.setState({loading:!1})}))},Vs=()=>Pe("/inbounds").then(t=>{Ct.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{Ct.setState({loading:!1})}),Ct=ds(Ic((t,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,lastUsersFetchAt:null,usersCacheKey:null,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:gu(),sort:vl},inbounds:new Map,isEditingCore:!1,refetchUsers:(r=!1)=>{Su(s().filters,{force:r})},resetAllUsage:()=>Pe("/users/reset",{method:"POST"}).then(()=>{s().onResetAllUsage(!1),s().refetchUsers(!0)}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...s().filters,...r}}),s().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),Pe(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),s().refetchUsers(!0),pi.invalidateQueries(fi)})),createUser:r=>Pe("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),pi.invalidateQueries(fi)}),createUserWithService:r=>Pe("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),pi.invalidateQueries(fi)}),editUser:(r,l)=>Pe(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{s().onEditingUser(null),s().refetchUsers(!0)}),fetchUserUsage:(r,l)=>{for(const o in l)l[o]||delete l[o];return Pe(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>Pe(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),s().refetchUsers(!0)}),revokeSubscription:r=>Pe(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),s().refetchUsers(!0)}),onEditingCore:r=>t({isEditingCore:r})})));function tt(t,s=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,o=s<0?0:s,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(l)),c=parseFloat((t/Math.pow(l,a)).toFixed(o));return r?[c,i[a]]:`${c} ${i[a]}`}const Ga=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},wu=ie(Ko,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),ku=ie(Tc,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Xa=({title:t,content:s,icon:r})=>n(sn,{p:6,borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[n(R,{alignItems:"center",columnGap:"4",children:[e(z,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:r}),e(p,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(z,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:s})]}),fi="statistics-query-key",vu=t=>{var i;const{version:s}=Ct(),{userData:r}=fr(),{data:l}=Mr({queryKey:fi,queryFn:()=>Pe("/system"),refetchInterval:6e5,onSuccess:({version:a})=>{s!==a&&Ct.setState({version:a})}}),{t:o}=Ke();return n(R,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(Xa,{title:o("activeUsers"),content:l&&n(R,{alignItems:"flex-end",children:[e(p,{children:Ga(l.users_active)}),n(p,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Ga(l.total_user)]})]}),icon:e(wu,{})}),e(Xa,{title:o("UsersUsage"),content:tt((i=r.users_usage)!=null?i:0),icon:e(ku,{})})]})},Cu=()=>{const{t}=Ke();return e(ue,{spacing:6,align:"stretch",children:n(z,{children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(vu,{})]})})},Mn=({children:t,color:s})=>e(z,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(p,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:t})}),Gs=ie(on,{baseStyle:{w:5,h:5}}),_u=()=>{const[t,s]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:o}=Ct(),{t:i}=Ke(),a=Kt(),c=()=>{l(null)},u=()=>{r&&(s(!0),o(r).then(()=>{a({title:i("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(s.bind(null,!1)))};return n(Lt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(_t,{pt:6,children:e(Mn,{color:"red",children:e(Gs,{})})}),e(Ot,{mt:3}),n(kt,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),r&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ai,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:r.username})})})]}),n(zt,{display:"flex",children:[e(H,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(H,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(At,{size:"xs"}):void 0,children:i("delete")})]})]})]})},Du={search:"",limit:10,offset:0,sort:"username"},ln=ds((t,s)=>({admins:[],total:0,loading:!1,filters:Du,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=s(),o={...l,...r},i={};o.search&&(i.username=o.search),o.offset!==void 0&&(i.offset=o.offset),o.limit!==void 0&&(i.limit=o.limit),o.sort&&(o.sort==="data_usage"?i.sort="users_usage":o.sort==="data_limit"?i.sort="data_limit":i.sort=o.sort),t({loading:!0});try{const a=await Pe("/admins",{query:i}),{admins:c,total:u}=Array.isArray(a)?{admins:a,total:a.length}:{admins:a.admins||[],total:a.total||0};t(h=>{const m=h.adminInDetails?c.find(g=>{var w;return g.username===((w=h.adminInDetails)==null?void 0:w.username)})||h.adminInDetails:null;return{admins:c,total:u,adminInDetails:m}})}catch(a){console.error("Failed to fetch admins:",a),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),s().fetchAdmins()},async createAdmin(r){await Pe("/admin",{method:"POST",body:r}),await s().fetchAdmins()},async updateAdmin(r,l){await Pe(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await s().fetchAdmins()},async deleteAdmin(r){await Pe(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await s().fetchAdmins()},async resetUsage(r){await Pe(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await s().fetchAdmins()},async disableAdmin(r,l){await Pe(`/admin/${encodeURIComponent(r)}/disable`,{method:"POST",body:{reason:l}}),await s().fetchAdmins()},async enableAdmin(r){await Pe(`/admin/${encodeURIComponent(r)}/enable`,{method:"POST"}),await s().fetchAdmins()},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),Pi={baseStyle:{w:4,h:4}},Au=ie(Go,Pi),Pu=ie(fa,Pi),Iu=ie(Yr,Pi),Tu=ie(gn,Pi),Eu=Ec((t,s)=>{s==="users"?Ct.getState().onFilterChange({...Ct.getState().filters,offset:0,search:t}):ln.getState().onFilterChange({search:t,offset:0})},300),Cl=({for:t="users",...s})=>{var O,oe,P;const{loading:r,filters:l,onFilterChange:o,refetchUsers:i,onCreateUser:a}=Ct(),{loading:c,filters:u,onFilterChange:h,fetchAdmins:m,openAdminDialog:g}=ln(),{t:w}=Ke(),[v,S]=d.exports.useState(""),{userData:y}=fr(),I=!(y.role==="sudo"||y.role==="full_access")&&y.status==="disabled",M=Boolean(((oe=(O=y.permissions)==null?void 0:O.admin_management)==null?void 0:oe.can_edit)||y.role==="full_access"),ae=t==="users"?r:c,b=t==="users"?l:u,F=we=>{S(we.target.value),Eu(we.target.value,t)},C=()=>{S(""),t==="users"?o({...b,offset:0,search:""}):h({search:"",offset:0})},X=()=>{t==="users"?i(!0):m()},Y=()=>{if(t==="users"){if(I)return;a(!0)}else M&&g()},me=(P=_r({base:!0,sm:!1}))!=null?P:!1;return n(Hs,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...s,children:[e(an,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:n(R,{spacing:2,align:"center",w:"full",children:[n(Dr,{flex:"1",children:[e(Xo,{pointerEvents:"none",children:e(Au,{})}),e(ve,{placeholder:t==="users"?w("search"):w("admins.searchPlaceholder","Search admins..."),value:v,borderColor:"light-border",w:"full",onChange:F}),n(Rr,{children:[ae&&e(At,{size:"xs"}),b.search&&b.search.length>0&&e(Ue,{onClick:C,"aria-label":"clear",size:"xs",variant:"ghost",children:e(Pu,{})})]})]}),e(Ue,{"aria-label":"refresh",disabled:ae,onClick:X,size:me?"sm":"md",variant:me?"ghost":"outline",borderRadius:"full",minW:me?"36px":"40px",h:me?"36px":void 0,children:e(Iu,{className:ba({"animate-spin":ae})})})]})}),e(an,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(Ce,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:e(H,{colorScheme:"primary",size:me?"sm":"md",onClick:Y,isDisabled:t==="users"&&I||t==="admins"&&!M,px:me?3:5,leftIcon:me?void 0:e(Tu,{}),w:"auto",h:me?"36px":void 0,minW:me?"auto":"8.5rem",fontSize:me?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?w("createUser"):w("admins.addAdmin","Add admin")})})})]})},zu=ie(zc,{baseStyle:{w:4,h:4}}),Nu=ie(Nc,{baseStyle:{w:4,h:4}}),Qa=5;function Ru(t,s,r){if(r<Qa)throw new Error(`Must allow at least ${Qa} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,s-Math.floor(r/2))),o=new Array(r);for(let i=0;i<r;i+=1)o[i]=i+l;return typeof o[0]=="number"&&o[0]>0&&(o[0]=0,o[1]="prev-more"),o[o.length-1]<t-1&&(o[o.length-1]=t-1,o[o.length-2]="next-more"),o}const _l=({for:t="users"})=>{const{filters:s,onFilterChange:r,users:{total:l}}=Ct(),{filters:o,onFilterChange:i,total:a}=ln(),{t:c}=Ke(),{filters:u,total:h,onFilterChange:m}=d.exports.useMemo(()=>t==="admins"?{filters:o,total:a,onFilterChange:i}:{filters:s,total:l,onFilterChange:r},[t,o,a,i,s,l,r]),{limit:g,offset:w}=u,v=Number(g||10),S=Number(w||0),y=Math.floor(S/v),N=Math.ceil(h/v),I=Ru(N,y,7),M=C=>{m({...u,offset:C*v})},ae=C=>{const X=parseInt(C.target.value,10);m({...u,limit:X,offset:0}),t==="users"&&fu(C.target.value)},b=d.exports.useMemo(()=>y>0&&N>0,[y,N]),F=d.exports.useMemo(()=>y+1<N&&N>0,[y,N]);return h<=v&&y===0?null:n(R,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(z,{order:{base:2,md:1},children:n(R,{children:[n(st,{minW:"60px",value:String(v),onChange:ae,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(p,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),n(Qo,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(H,{leftIcon:e(zu,{}),onClick:()=>M(y-1),isDisabled:!b,children:c("previous")}),I.map(C=>typeof C=="string"?e(H,{children:"..."},C):e(H,{variant:C===y?"solid":"outline",onClick:()=>M(C),children:C+1},C)),e(H,{rightIcon:e(Nu,{}),onClick:()=>M(y+1),isDisabled:!F,children:c("next")})]})]})},Mu=Rc;const Za=ie(Mc),Lu=ie(ka,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Uu=ie(Zo,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Ou=ie(jo,{baseStyle:{w:5,h:5}}),Wu=()=>{const{QRcodeLinks:t,setQRCode:s,setSubLink:r,subscribeUrl:l}=Ct(),o=t!==null,[i,a]=d.exports.useState(0),{t:c}=Ke(),u=()=>{s(null),r(null)},h=String(l).startsWith("/")?window.location.origin+l:String(l);return n(Lt,{isOpen:o,onClose:u,children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(_t,{pt:6,children:e(Mn,{color:"primary",children:e(Ou,{color:"white"})})}),e(Ot,{mt:3}),t&&n(kt,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&n(ue,{children:[e(Za,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:h,bg:"white"}),e(p,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),n(z,{w:"300px",children:[e(Mu,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:a,onInit:()=>a(0),nextArrow:e(Ue,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(Lu,{})}),prevArrow:e(Ue,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(Uu,{})}),children:t.map((m,g)=>e(R,{children:e(Za,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"})},g))}),n(p,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},Fu=ie(Yr,{baseStyle:{w:5,h:5}}),Hu=()=>{const[t,s]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=Ct(),{t:o}=Ke(),i=Kt(),a=()=>{Ct.setState({resetUsageUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{i({title:o("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Lt,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(_t,{pt:6,children:e(Mn,{color:"blue",children:e(Fu,{})})}),e(Ot,{mt:3}),n(kt,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:o("resetUserUsage.title")}),r&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ai,{components:{b:e("b",{})},children:o("resetUserUsage.prompt",{username:r.username})})})]}),n(zt,{display:"flex",children:[e(H,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(H,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(At,{size:"xs"}):void 0,children:o("reset")})]})]})]})},Bu=ie(Yr,{baseStyle:{w:5,h:5}}),Vu=()=>{const[t,s]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=Ct(),{t:o}=Ke(),i=Kt(),a=()=>{Ct.setState({revokeSubscriptionUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{i({title:o("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Lt,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(_t,{pt:6,children:e(Mn,{color:"blue",children:e(Bu,{})})}),e(Ot,{mt:3}),n(kt,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:o("revokeUserSub.title")}),r&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ai,{components:{b:e("b",{})},children:o("revokeUserSub.prompt",{username:r.username})})})]}),n(zt,{display:"flex",children:[e(H,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(H,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(At,{size:"xs"}):void 0,children:o("revoke")})]})]})]})},Xs={baseStyle:{strokeWidth:"2px",w:4,h:4}},ja=ie(Lc,Xs),$u=ie(Uc,Xs),eo=ie(Oc,Xs),to=ie(el,Xs),Ku=ie(el,Xs),oa=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],En={active:{statusColor:"green",bandWidthColor:"primary",icon:ja},connected:{statusColor:"green",bandWidthColor:"primary",icon:ja},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:$u},expired:{statusColor:"orange",bandWidthColor:"orange",icon:to},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Ku},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:to},limited:{statusColor:"red",bandWidthColor:"red",icon:eo},error:{statusColor:"red",bandWidthColor:"red",icon:eo}},es=ds((t,s)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await Pe("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await Pe(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await Pe("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const o=await Pe(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:o}),await s().fetchServices(),o}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await Pe(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await s().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await Pe(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),Ju=async()=>Pe("/settings/telegram"),qu=async t=>Pe("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),_a=async()=>Pe("/settings/panel"),Yu=async t=>Pe("/settings/panel",{method:"PUT",body:JSON.stringify(t)}),Ii=t=>{let s={status:"",time:""};if(t){ze(t*1e3).utc().isAfter(ze().utc())?s.status="expires":s.status="expired";const r=[],l=ze.duration(ze(t*1e3).utc().diff(ze()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),s.time=r.join(", ")}return s},Gu=({value:t,onChange:s,placeholder:r="Select date",disabled:l=!1,minDate:o,quickSelects:i=[]})=>{const{isOpen:a,onOpen:c,onClose:u}=qt(),[h,m]=d.exports.useState(()=>t?ze(t):ze()),[g,w]=d.exports.useState({hour:t?ze(t).hour():12,minute:t?ze(t).minute():0});d.exports.useEffect(()=>{t&&(m(ze(t)),w({hour:ze(t).hour(),minute:ze(t).minute()}))},[t]);const v=()=>{t||(m(ze()),w({hour:12,minute:0})),u()},S=h.daysInMonth(),y=h.startOf("month").day(),N=ze(),I=t?ze(t):null,M=O=>{const oe=h.date(O).hour(g.hour).minute(g.minute).second(0).millisecond(0);o&&oe.isBefore(ze(o),"day")||s(oe.toDate())},ae=(O,oe)=>{if(w({hour:O,minute:oe}),t){const P=ze(t).hour(O).minute(oe);s(P.toDate())}},b=()=>{s(null),m(ze()),w({hour:12,minute:0}),u()},F=()=>m(h.subtract(1,"month")),C=()=>m(h.add(1,"month")),X=O=>{const P=(t?ze(t):ze()).add(O,"day");s(P.toDate())},Y=()=>{const O=[],oe=o?ze(o):null;for(let P=0;P<y;P++)O.push(e(an,{},`empty-${P}`));for(let P=1;P<=S;P++){const we=h.date(P),A=we.isSame(N,"day"),De=I==null?void 0:I.isSame(we,"day"),ee=oe&&we.isBefore(oe,"day");O.push(e(an,{children:e(H,{size:"xs",variant:"ghost",w:"full",h:"28px",minW:"28px",fontSize:"xs",fontWeight:A?"bold":"normal",bg:De?"primary.500":"transparent",color:De?"white":ee?"gray.500":"inherit",border:A?"1px solid":"none",borderColor:"primary.400",_hover:{bg:ee?"transparent":De?"primary.600":"gray.700"},onClick:()=>!ee&&M(P),isDisabled:!!ee,cursor:ee?"not-allowed":"pointer",children:P})},P))}return O},me=t?ze(t).format("YYYY/MM/DD HH:mm"):"";return n(us,{isOpen:a,onOpen:c,onClose:v,placement:"bottom-start",isLazy:!0,children:[e(hs,{children:e(ve,{value:me,placeholder:r,size:"sm",isReadOnly:!0,cursor:"pointer",isDisabled:l,onClick:c,bg:"transparent",_dark:{bg:"transparent"}})}),e(tl,{children:e(ps,{w:"auto",maxW:"min(90vw, 420px)",bg:"gray.900",borderColor:"gray.700",color:"white",_focus:{boxShadow:"none"},children:e(ms,{p:0,children:n(ct,{children:[n(ue,{spacing:1,align:"stretch",px:2,py:2,bg:"gray.800",minW:"100px",maxW:"110px",borderRight:"1px solid",borderColor:"gray.700",flexShrink:0,children:[e(H,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>X(1),_hover:{bg:"gray.700"},children:"+1 Day"}),e(H,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>X(30),_hover:{bg:"gray.700"},children:"+1 Month"}),e(H,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>X(90),_hover:{bg:"gray.700"},children:"+3 Months"}),e(H,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>X(180),_hover:{bg:"gray.700"},children:"+6 Months"}),e(H,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>X(365),_hover:{bg:"gray.700"},children:"+1 Year"}),e(H,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>X(1095),_hover:{bg:"gray.700"},children:"+3 Years"})]}),n(z,{flex:"1",p:2,children:[n(ct,{justify:"space-between",align:"center",mb:2,children:[n(R,{spacing:1,children:[e(Ue,{"aria-label":"Previous month",size:"xs",variant:"ghost",icon:e(Zo,{width:14,height:14}),onClick:F,_hover:{bg:"gray.700"}}),e(Ue,{"aria-label":"Next month",size:"xs",variant:"ghost",icon:e(ka,{width:14,height:14}),onClick:C,_hover:{bg:"gray.700"}})]}),e(p,{fontSize:"xs",fontWeight:"semibold",children:h.format("MMMM YYYY")})]}),e(Hs,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:1,children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(O=>e(an,{children:e(p,{fontSize:"2xs",textAlign:"center",color:"gray.400",fontWeight:"semibold",children:O})},O))}),e(Hs,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:2,children:Y()}),n(R,{spacing:2,justify:"center",pt:2,borderTop:"1px solid",borderColor:"gray.700",children:[e(p,{fontSize:"2xs",color:"gray.400",children:"Time:"}),e(ve,{type:"number",size:"xs",w:"45px",min:0,max:23,value:g.hour,onChange:O=>{const oe=Math.max(0,Math.min(23,parseInt(O.target.value)||0));ae(oe,g.minute)},textAlign:"center",fontSize:"xs"}),e(p,{fontSize:"xs",children:":"}),e(ve,{type:"number",size:"xs",w:"45px",min:0,max:59,value:g.minute,onChange:O=>{const oe=Math.max(0,Math.min(59,parseInt(O.target.value)||0));ae(g.hour,oe)},textAlign:"center",fontSize:"xs"})]}),n(R,{spacing:2,justify:"flex-end",mt:2,children:[e(H,{size:"xs",variant:"ghost",onClick:b,children:"Clear"}),e(H,{size:"xs",colorScheme:"primary",onClick:v,children:"Done"})]})]})]})})})})]})},Qs=d.exports.forwardRef((t,s)=>e(Wc,{...t,ref:s}));Qs.displayName="DatePicker";function Xu(t){const s=360/t,r=90,l=47,o=[];for(let i=0;i<t;i++){const a=i*s%360+140,c=Qu(a,r,l);o.push(c)}return o}function Qu(t,s,r){t/=360,s/=100,r/=100;let l,o,i;if(s===0)l=o=i=r;else{const c=(m,g,w)=>(w<0&&(w+=1),w>1&&(w-=1),w<.16666666666666666?m+(g-m)*6*w:w<.5?g:w<.6666666666666666?m+(g-m)*(.6666666666666666-w)*6:m),u=r<.5?r*(1+s):r+s-r*s,h=2*r-u;l=Math.round(c(h,u,t+1/3)*255),o=Math.round(c(h,u,t)*255),i=Math.round(c(h,u,t-1/3)*255)}const a=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${a(l)}${a(o)}${a(i)}`}const ro=({border:t,...s})=>{const{getInputProps:r,getRadioProps:l}=Bc(s),o=_r({base:"xs",md:"sm"});return n(z,{as:"label",children:[e("input",{...r()}),e(z,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:o,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},Zu=({onChange:t,defaultValue:s,...r})=>{const{t:l,i18n:o}=Ke();Gr();const i=_r({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),a={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=_r({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:h,setValue:m}=Fc({name:"filter",defaultValue:s,onChange:P=>{if(P==="custom")return;v(),i.indexOf(P)>=0?(N(l("userDialog.custom")),M(!1)):(N(l("userDialog.custom")+` (${P})`),M(!0));const we=Number(P.substring(0,P.length-1)),A=a[P[P.length-1]];t(P,{start:ze().utc().subtract(we,A).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:g,onOpen:w,onClose:v}=qt(),S=d.exports.useRef(null);Hc({ref:S,handler:v});const[y,N]=d.exports.useState(l("userDialog.custom")),[I,M]=d.exports.useState(!1),[ae,b]=d.exports.useState(0),F=_r({base:1,md:2}),C=_r({base:"xs",md:"sm"}),[X,Y]=d.exports.useState(null),[me,O]=d.exports.useState(null),oe=P=>{const[we,A]=P;me&&!A?(Y(null),O(null)):(Y(we),O(A),we&&A&&(v(),t("custom",{start:ze(we).format("YYYY-MM-DDT00:00:00"),end:ze(A).format("YYYY-MM-DDT23:59:59")})))};return n(ue,{...r,children:[ae==0&&n($e,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(P=>e(ro,{...h({value:P}),children:P},P)),e(z,{onClick:()=>{Y(null),O(null),w()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:C,px:3,py:1,bg:I?"primary.500":"unset",color:I?"white":"unset",borderColor:I?"primary.500":"unset",children:n(R,{children:[e(p,{children:y}),e(Os,{as:Ma,boxSize:"18px"})]})})]}),ae==1&&n(R,{onClick:w,cursor:"pointer",fontSize:C,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(p,{w:"full",color:X?"unset":"gray.500",children:X?ze(X).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(Os,{as:ka,boxSize:"18px"}),e(p,{w:"full",color:me?"unset":"gray.500",children:me?ze(me).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(Os,{as:Ma,boxSize:"18px"})]}),e(ue,{ref:S,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:n(Wn,{onChange:P=>b(P),children:[n(Fn,{children:[e(Vt,{fontSize:C,children:l("userDialog.relative")}),e(Vt,{fontSize:C,children:l("userDialog.absolute")})]}),n(Hn,{children:[e($t,{children:c.map(P=>e(ue,{alignItems:"start",pl:2,pr:2,children:n(R,{justifyItems:"flex-start",mb:4,children:[e(p,{fontSize:C,minW:"60px",children:l("userDialog."+P.title)}),P.options.map(we=>e(ro,{border:!0,...h({value:we}),children:we},we+".custom"))]})},P.title))}),e($t,{className:"datepicker-panel",children:e(ue,{children:e(Qs,{locale:o.language.toLocaleLowerCase(),selected:X,onChange:oe,startDate:X,endDate:me,selectsRange:!0,maxDate:new Date,monthsShown:F,peekNextMonth:!1,inline:!0})})})]})]})})]})};function ki(t,s,r=[],l=[]){const o=tt(r.reduce((i,a)=>i+=a,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${o}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:a,w:c})=>tt(c.config.series[a],1)},tooltip:{custom:({series:i,seriesIndex:a,dataPointIndex:c,w:u})=>{const h=tt(i[a],1),m=Math.max(i.reduce((w,v)=>w+=v),1),g=Math.round(i[a]/m*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[a]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[a]}: <b>${g}, ${h}</b>
            </div>
          `}},colors:Xu(r.length)}}}const ju=ie(Vc,{baseStyle:{w:5,h:5}}),eh=ie(kn,{baseStyle:{w:5,h:5}}),th=ie(qo,{baseStyle:{w:5,h:5}}),rh=ie($c,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});ie(Ci,{baseStyle:{w:4,h:4}});const nh=t=>{var r,l,o,i,a;const s=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(s),next_plan_data_limit:s!=null&&s.data_limit?Number((s.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(o=s==null?void 0:s.expire)!=null?o:null,next_plan_add_remaining_traffic:(i=s==null?void 0:s.add_remaining_traffic)!=null?i:!1,next_plan_fire_on_either:(a=s==null?void 0:s.fire_on_either)!=null?a:!0}},$i=()=>({data_limit:null,ip_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),vs={username:xe.string().min(1,{message:"Required"}),note:xe.string().nullable(),service_id:xe.union([xe.string(),xe.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),proxies:xe.record(xe.string(),xe.record(xe.string(),xe.any())).transform(t=>{const s=(r,l)=>{r&&r[l]===""&&delete r[l]};return s(t.vmess,"id"),s(t.vless,"id"),s(t.trojan,"password"),s(t.shadowsocks,"password"),s(t.shadowsocks,"method"),t}),data_limit:xe.string().min(0).or(xe.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:xe.number().nullable(),data_limit_reset_strategy:xe.string(),inbounds:xe.record(xe.string(),xe.array(xe.string())).transform(t=>(Object.keys(t).forEach(s=>{var r;Array.isArray(t[s])&&!((r=t[s])!=null&&r.length)&&delete t[s]}),t)),next_plan_enabled:xe.boolean().default(!1),next_plan_data_limit:xe.union([xe.string(),xe.number(),xe.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:Math.max(0,s)}),next_plan_expire:xe.union([xe.number(),xe.string(),xe.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),next_plan_add_remaining_traffic:xe.boolean().default(!1),next_plan_fire_on_either:xe.boolean().default(!0),ip_limit:xe.union([xe.number().min(0),xe.null()]).optional().transform(t=>typeof t!="number"?null:Number.isFinite(t)?t:null)},sh=xe.discriminatedUnion("status",[xe.object({status:xe.literal("active"),...vs}),xe.object({status:xe.literal("disabled"),...vs}),xe.object({status:xe.literal("limited"),...vs}),xe.object({status:xe.literal("expired"),...vs}),xe.object({status:xe.literal("on_hold"),on_hold_expire_duration:xe.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...vs})]),ih=()=>{var ir,ar,or,tr,lr,cr,re,ke,K;const{editingUser:t,isCreatingNewUser:s,onCreateUser:r,editUser:l,fetchUserUsage:o,onEditingUser:i,createUserWithService:a,onDeletingUser:c,users:u,isUserLimitReached:h}=Ct(),m=!!t,g=s||m,w=(ir=u.users_limit)!=null?ir:null,v=(ar=u.active_total)!=null?ar:null,S=h&&!m,[y,N]=d.exports.useState(!1),[I,M]=d.exports.useState(""),ae=Kt(),{t:b}=Ke(),{colorMode:F}=Gr(),C=Br({defaultValues:$i(),resolver:_i(sh)}),X=C.getValues("expire"),Y=C.getValues("next_plan_expire");function me(E){if(typeof E!="number"||E<=0)return null;const Ee=ze.unix(E).utc().local(),Be=ze(),Oe=Ee.diff(Be,"day",!0);return Number.isFinite(Oe)?Math.max(0,Math.round(Oe)):null}function O(E){return ze().add(E,"day").endOf("day").utc().unix()}const[oe,P]=d.exports.useState(()=>me(X)),[we,A]=d.exports.useState(()=>me(Y)),De=[{label:b("userDialog.quickSelectOneMonth","+1 month"),amount:1,unit:"month"},{label:b("userDialog.quickSelectThreeMonths","+3 months"),amount:3,unit:"month"},{label:b("userDialog.quickSelectOneYear","+1 year"),amount:1,unit:"year"}],ee=es(E=>E.services),Ae=es(E=>E.isLoading),{userData:Re,getUserIsSuccess:Me}=fr(),G=Boolean(Me&&(Re.role==="sudo"||Re.role==="full_access")),[D,V]=d.exports.useState(null),ge=ee.length>0,pe=D&&(or=ee.find(E=>E.id===D))!=null?or:null,Z=Boolean(t==null?void 0:t.service_id),_e=!G&&ee.length===1,te=G||ee.length!==1,le=te&&ee.length>0,B=!le,L=!G&&ee.length===0,{data:U}=Mr("panel-settings",_a,{enabled:g,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),j=Boolean(U==null?void 0:U.use_nobetci),[Te,qe]=d.exports.useState(!1),Qe=()=>{qe(E=>!E)};d.exports.useEffect(()=>{g&&es.getState().fetchServices()},[g]),d.exports.useEffect(()=>{var E,Ee;m?t!=null&&t.service_id?V(t.service_id):G?V(null):ee.length?V((Ee=(E=ee[0])==null?void 0:E.id)!=null?Ee:null):V(null):g||V(null)},[m,t,g,G,ee]),d.exports.useEffect(()=>{!m&&g&&ge&&V(E=>{var Ee,Be;return(Be=E!=null?E:(Ee=ee[0])==null?void 0:Ee.id)!=null?Be:null})},[ee,m,g,ge]),d.exports.useEffect(()=>{!m&&g&&!ge&&V(null)},[ge,m,g]),d.exports.useEffect(()=>{_e&&ee[0]&&V(E=>E!=null?E:ee[0].id)},[_e,ee]);const[T,ce]=Jt({control:C.control,name:["data_limit","status"]}),$=Jt({control:C.control,name:"next_plan_enabled"}),be=Jt({control:C.control,name:"expire"}),dt=Jt({control:C.control,name:"next_plan_data_limit"}),ut=Jt({control:C.control,name:"next_plan_expire"}),Q=Jt({control:C.control,name:"next_plan_add_remaining_traffic"}),W=Jt({control:C.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const E=me(be);P(Ee=>Ee===E?Ee:E)},[be]),d.exports.useEffect(()=>{const E=me(ut);A(Ee=>Ee===E?Ee:E)},[ut]);const Se=E=>{C.setValue("next_plan_enabled",E,{shouldDirty:!0}),E?(C.getValues("next_plan_data_limit")===null&&C.setValue("next_plan_data_limit",0,{shouldDirty:!1}),C.getValues("next_plan_add_remaining_traffic")===void 0&&C.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),C.getValues("next_plan_fire_on_either")===void 0&&C.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(C.setValue("next_plan_data_limit",null,{shouldDirty:!0}),C.setValue("next_plan_expire",null,{shouldDirty:!0}),A(null))},Le=b("userDialog.total"),[J,He]=d.exports.useState(ki(F,Le)),[se,fe]=d.exports.useState("1m"),Ie=E=>{o(t,E).then(Ee=>{const Be=[],Oe=[];for(const We in Ee.usages)Oe.push(Ee.usages[We].used_traffic),Be.push(Ee.usages[We].node_name);He(ki(F,Le,Oe,Be))})};d.exports.useEffect(()=>{if(t){const E=nh(t);C.reset(E),P(me(E.expire)),A(me(E.next_plan_expire)),Ie({start:ze().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const E=$i();C.reset(E),P(me(E.expire)),A(me(E.next_plan_expire))}},[t,m,g]);const Ve=E=>{var pr,Xr;if(S)return;N(!0),M(null);const{service_id:Ee,next_plan_enabled:Be,next_plan_data_limit:Oe,next_plan_expire:We,next_plan_add_remaining_traffic:ht,next_plan_fire_on_either:ot,proxies:Tt,inbounds:Yt,status:Gt,data_limit:dr,data_limit_reset_strategy:Lr,on_hold_expire_duration:lt,ip_limit:Pt,...Nt}=E,ur=Be&&Oe&&Oe>0?Number((Number(Oe)*1073741824).toFixed(5)):0,hr=Be?{data_limit:ur,expire:We!=null?We:0,add_remaining_traffic:ht,fire_on_either:ot}:null,Ur=typeof Pt=="number"&&Number.isFinite(Pt)&&Pt>0?Math.floor(Pt):0;if(!m){const Et=D!=null?D:_e&&(Xr=(pr=ee[0])==null?void 0:pr.id)!=null?Xr:null;if(!Et){M(b("userDialog.selectService","Please choose a service")),N(!1);return}const Or={username:E.username,service_id:Et,note:E.note,status:E.status==="active"||E.status==="disabled"||E.status==="on_hold"?E.status:"active",expire:E.expire,data_limit:E.data_limit,ip_limit:Ur,data_limit_reset_strategy:dr&&dr>0?Lr:"no_reset",on_hold_expire_duration:Gt==="on_hold"?lt:null};hr&&(Or.next_plan=hr),a(Or).then(()=>{ae({title:b("userDialog.userCreated",{username:E.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Ye()}).catch(Rt=>{var Ar,rr,ye,yr,Wr;(((Ar=Rt==null?void 0:Rt.response)==null?void 0:Ar.status)===409||((rr=Rt==null?void 0:Rt.response)==null?void 0:rr.status)===400)&&M((yr=(ye=Rt==null?void 0:Rt.response)==null?void 0:ye._data)==null?void 0:yr.detail),((Wr=Rt==null?void 0:Rt.response)==null?void 0:Wr.status)===422&&Object.keys(Rt.response._data.detail).forEach(Qr=>{M(Rt==null?void 0:Rt.response._data.detail[Qr]),C.setError(Qr,{type:"custom",message:Rt.response._data.detail[Qr]})})}).finally(()=>{N(!1)});return}const Zt={...Nt,data_limit:dr,ip_limit:Ur,data_limit_reset_strategy:dr&&dr>0?Lr:"no_reset",status:Gt==="active"||Gt==="disabled"||Gt==="on_hold"?Gt:"active",on_hold_expire_duration:Gt==="on_hold"?lt:null};hr?Zt.next_plan=hr:!Be&&(t==null?void 0:t.next_plan)&&(Zt.next_plan=null),t!=null&&t.service_id||(Tt&&Object.keys(Tt).length>0&&(Zt.proxies=Tt),Yt&&Object.keys(Yt).length>0&&(Zt.inbounds=Yt)),typeof D<"u"&&(D===null?G&&(Zt.service_id=null):D!==(t==null?void 0:t.service_id)&&(Zt.service_id=D)),l(t.username,Zt).then(()=>{ae({title:b("userDialog.userEdited",{username:E.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Ye()}).catch(Et=>{var Or,Rt,Ar,rr,ye;(((Or=Et==null?void 0:Et.response)==null?void 0:Or.status)===409||((Rt=Et==null?void 0:Et.response)==null?void 0:Rt.status)===400)&&M((rr=(Ar=Et==null?void 0:Et.response)==null?void 0:Ar._data)==null?void 0:rr.detail),((ye=Et==null?void 0:Et.response)==null?void 0:ye.status)===422&&Object.keys(Et.response._data.detail).forEach(yr=>{M(Et==null?void 0:Et.response._data.detail[yr]),C.setError(yr,{type:"custom",message:Et.response._data.detail[yr]})})}).finally(()=>{N(!1)})},Ye=()=>{C.reset($i()),P(null),A(null),r(!1),i(null),M(null),qe(!1),fe("1m"),V(null)},rt=()=>{Ct.setState({resetUsageUser:t})},Je=()=>{Ct.setState({revokeSubscriptionUser:t})},Ze=y||S,Wt=ce==="on_hold",[xt,sr]=d.exports.useState(!1),br=()=>{sr(!0);let E="";const Ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Be=Ee.length;let Oe=0;for(;Oe<6;)E+=Ee.charAt(Math.floor(Math.random()*Be)),Oe+=1;return E};return n(Lt,{isOpen:g,onClose:Ye,size:L?"lg":"2xl",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Kc,{...C,children:n(Ut,{mx:"3",position:"relative",overflow:"hidden",children:[e(Ot,{mt:3,disabled:y}),e(z,{pointerEvents:S?"none":"auto",filter:S?"blur(6px)":"none",transition:"filter 0.2s ease",children:n("form",{onSubmit:C.handleSubmit(Ve),children:[e(_t,{pt:6,children:n(R,{gap:2,children:[e(Mn,{color:"primary",children:m?e(eh,{color:"white"}):e(ju,{color:"white"})}),e(p,{fontWeight:"semibold",fontSize:"lg",children:b(m?"userDialog.editUserTitle":"createNewUser")})]})}),n(kt,{children:[m&&Z&&n(Er,{status:"info",mb:4,borderRadius:"md",children:[e(zr,{}),b("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(tr=t==null?void 0:t.service_name)!=null?tr:""})]}),n(Hs,{templateColumns:{base:"repeat(1, 1fr)",md:le?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...B?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(an,{children:n(ue,{justifyContent:"space-between",children:[n(ct,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(ct,{flexDirection:"row",w:"full",gap:2,children:n(k,{mb:"10px",isInvalid:!!((lr=C.formState.errors.username)!=null&&lr.message),children:[e(_,{children:b("username")}),n(R,{align:"flex-end",children:[e(z,{flex:"1",minW:"0",children:n(Dr,{size:"sm",children:[e(ve,{type:"text",borderRadius:"6px",placeholder:b("username"),isDisabled:Ze||m,...C.register("username")}),!m&&e(Rr,{width:"auto",pr:1,children:e(Ue,{"aria-label":b("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(Si,{width:18}),onClick:()=>{const E=br();C.setValue("username",E,{shouldDirty:!0}),setTimeout(()=>{sr(!1)},350)},isLoading:xt,isDisabled:Ze})})]})}),m&&e(R,{px:1,children:e(ft,{name:"status",control:C.control,render:({field:E})=>e(pt,{placement:"top",label:"status: "+b(`status.${E.value}`),textTransform:"capitalize",children:e(z,{children:e(mt,{colorScheme:"primary",isChecked:E.value==="active",onChange:Ee=>{Ee.target.checked?E.onChange("active"):E.onChange("disabled")}})})})})})]}),e(Jr,{children:(cr=C.formState.errors.username)==null?void 0:cr.message})]})}),n(Ce,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[n(k,{flex:"1",children:[e(_,{children:b("userDialog.dataLimit")}),e(ft,{control:C.control,name:"data_limit",render:({field:E})=>{var Ee;return e(er,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:E.onChange,disabled:Ze,error:(Ee=C.formState.errors.data_limit)==null?void 0:Ee.message,value:E.value?String(E.value):""})}})]}),j&&n(k,{flex:"1",children:[n(_,{display:"flex",alignItems:"center",gap:2,children:[b("userDialog.ipLimitLabel","IP limit"),e(pt,{hasArrow:!0,placement:"top",label:b("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(ie.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(rl,{width:16,height:16})})})]}),e(ft,{control:C.control,name:"ip_limit",rules:{validate:E=>E==null?!0:typeof E!="number"||Number.isNaN(E)?b("userDialog.ipLimitValidation","Enter a valid non-negative number"):E>=0?!0:b("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:E})=>{var Ee;return e(er,{size:"sm",borderRadius:"6px",placeholder:b("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof E.value=="number"&&E.value>0?String(E.value):"",onChange:Be=>{const Oe=Be.target.value;if(!Oe.trim()||Oe.trim()==="-"){E.onChange(null);return}const We=Number(Oe);Number.isNaN(We)||E.onChange(We<0?0:Math.floor(We))},disabled:Ze,error:(Ee=C.formState.errors.ip_limit)==null?void 0:Ee.message})}})]})]}),e(rs,{in:!!(T&&T>0),animateOpacity:!0,style:{width:"100%"},children:n(k,{height:"66px",children:[e(_,{children:b("userDialog.periodicUsageReset")}),e(ft,{control:C.control,name:"data_limit_reset_strategy",render:({field:E})=>e(st,{size:"sm",...E,disabled:Ze,bg:Ze?"gray.100":"transparent",_dark:{bg:Ze?"gray.600":"transparent"},sx:{option:{backgroundColor:F==="dark"?"#222C3B":"white"}},children:oa.map(Ee=>e("option",{value:Ee.value,children:b("userDialog.resetStrategy"+Ee.title)},Ee.value))})})]})}),n(k,{mb:"10px",isInvalid:!Wt&&Boolean(C.formState.errors.expire),children:[n(ct,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(_,{mb:0,children:Wt?b("userDialog.onHoldExpireDuration"):b("userDialog.expiryDaysLabel","Expires in (days)")}),!m&&e(ft,{name:"status",control:C.control,render:({field:E})=>{const Ee=E.value==="on_hold";return n(R,{spacing:2,align:"center",children:[e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.onHold")}),e(mt,{colorScheme:"primary",isChecked:Ee,onChange:Be=>{Be.target.checked?E.onChange("on_hold"):(E.onChange("active"),C.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:Ze})]})}})]}),Wt?e(ft,{control:C.control,name:"on_hold_expire_duration",render:({field:E})=>{var Ee;return e(er,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Be=>{C.setValue("expire",null);const Oe=Be.target.value;if(!Oe){E.onChange(null);return}const We=Number(Oe);Number.isNaN(We)||We<0||E.onChange(Math.round(We))},disabled:Ze,error:(Ee=C.formState.errors.on_hold_expire_duration)==null?void 0:Ee.message,value:E.value?String(E.value):""})}}):n(Ft,{children:[e(ft,{name:"expire",control:C.control,render:({field:E})=>{const{status:Ee,time:Be}=Ii(E.value),Oe=E.value?ze.unix(E.value).toDate():null,We=ht=>{if(!ht){E.onChange(null),C.setValue("on_hold_expire_duration",null,{shouldDirty:!1});return}const ot=ze(ht).utc().unix();C.setValue("on_hold_expire_duration",null,{shouldDirty:!1}),E.onChange(ot)};return n(z,{children:[e(Gu,{value:Oe,onChange:We,placeholder:b("userDialog.selectExpiryDate","Select expiration date"),disabled:Ze,minDate:new Date,quickSelects:De.map(ht=>({label:ht.label,onClick:()=>{const ot=ze().add(ht.amount,ht.unit).endOf("day");We(ot.toDate())}}))}),E.value?e(nr,{children:b(Ee,{time:Be})}):null]})}}),e(Jr,{children:(re=C.formState.errors.expire)==null?void 0:re.message})]})]}),n(z,{mb:"10px",children:[n(R,{justify:"space-between",align:"center",children:[e(_,{mb:0,children:b("userDialog.nextPlanTitle","Next plan")}),e(mt,{colorScheme:"primary",isChecked:$,onChange:E=>Se(E.target.checked),isDisabled:Ze})]}),e(p,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:b("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(rs,{in:$,animateOpacity:!0,style:{width:"100%"},children:n(ue,{align:"stretch",spacing:3,mt:3,children:[n(k,{children:[e(_,{fontSize:"sm",children:b("userDialog.nextPlanDataLimit","Next plan data limit")}),e(er,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",disabled:Ze,value:dt!==null&&typeof dt<"u"?String(dt):"",onChange:E=>{const Ee=E.target.value;if(!Ee){C.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Be=Number(Ee);Number.isNaN(Be)||C.setValue("next_plan_data_limit",Math.max(0,Be),{shouldDirty:!0})}})]}),n(k,{children:[e(_,{fontSize:"sm",children:b("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(ft,{control:C.control,name:"next_plan_expire",render:({field:E})=>{const Ee=Be=>{if(!Be){A(null),E.onChange(null);return}const Oe=Number(Be);if(Number.isNaN(Oe)||Oe<0)return;const We=Math.min(Math.round(Oe),3650);A(We);const ht=O(We);E.onChange(ht)};return e(er,{endAdornment:b("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof we=="number"?String(we):"",onChange:Be=>Ee(Be.target.value),disabled:Ze})}})]}),n(R,{justify:"space-between",children:[e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(mt,{size:"sm",colorScheme:"primary",isChecked:Boolean(Q),onChange:E=>C.setValue("next_plan_add_remaining_traffic",E.target.checked,{shouldDirty:!0}),isDisabled:Ze})]}),n(R,{justify:"space-between",children:[e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(mt,{size:"sm",colorScheme:"primary",isChecked:Boolean(W),onChange:E=>C.setValue("next_plan_fire_on_either",E.target.checked,{shouldDirty:!0}),isDisabled:Ze})]})]})})]}),n(k,{mb:"10px",isInvalid:!!C.formState.errors.note,children:[e(_,{children:b("userDialog.note")}),e(Cr,{...C.register("note")}),e(Jr,{children:(K=(ke=C.formState.errors)==null?void 0:ke.note)==null?void 0:K.message})]})]}),I&&n(Er,{status:"error",display:{base:"none",md:"flex"},children:[e(zr,{}),I]})]})}),te&&e(an,{mt:le?0:4,children:n(k,{isRequired:!m,children:[e(_,{children:b("userDialog.selectServiceLabel","Service")}),Ae?n(R,{spacing:2,py:4,children:[e(At,{size:"sm"}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:b("loading")})]}):ge?n(ue,{align:"stretch",spacing:3,children:[m&&G&&n(z,{role:"button",tabIndex:Ze?-1:0,"aria-pressed":D===null,onKeyDown:E=>{Ze||(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),V(null))},onClick:()=>{Ze||V(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:D===null?"primary.500":"gray.200",bg:D===null?"primary.50":"transparent",cursor:Ze?"not-allowed":"pointer",pointerEvents:Ze?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ze?{}:{borderColor:D===null?"primary.500":"gray.300"},_dark:{borderColor:D===null?"primary.400":"gray.700",bg:D===null?"primary.900":"transparent"},children:[e(p,{fontWeight:"semibold",children:b("userDialog.noServiceOption","No service")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:b("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),ee.map(E=>{const Ee=D===E.id;return e(z,{role:"button",tabIndex:Ze?-1:0,"aria-pressed":Ee,onKeyDown:Be=>{Ze||(Be.key==="Enter"||Be.key===" ")&&(Be.preventDefault(),V(E.id))},onClick:()=>{Ze||V(E.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:Ee?"primary.500":"gray.200",bg:Ee?"primary.50":"transparent",cursor:Ze?"not-allowed":"pointer",pointerEvents:Ze?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ze?{}:{borderColor:Ee?"primary.500":"gray.300"},_dark:{borderColor:Ee?"primary.400":"gray.700",bg:Ee?"primary.900":"transparent"},children:n(R,{justify:"space-between",align:"flex-start",children:[n(ue,{align:"flex-start",spacing:0,children:[e(p,{fontWeight:"semibold",children:E.name}),E.description&&e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:E.description})]}),e(p,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:b("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:E.host_count,users:E.user_count})})]})},E.id)})]}):n(Er,{status:"warning",borderRadius:"md",children:[e(zr,{}),b("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),pe&&e(nr,{mt:2,children:b("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:pe.host_count,users:pe.user_count})})]})}),m&&Te&&e(an,{pt:6,colSpan:{base:1,md:te?2:1},children:n(ue,{gap:4,children:[e(Zu,{defaultValue:se,onChange:(E,Ee)=>{fe(E),Ie(Ee)}}),e(z,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(nn,{options:J.options,series:J.series,type:"donut"})})]})})]}),I&&n(Er,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(zr,{}),I]})]}),e(zt,{mt:"3",children:n(R,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(R,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:m&&n(Ft,{children:[e(pt,{label:b("delete"),placement:"top",children:e(Ue,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),Ye()},children:e(Gs,{})})}),e(pt,{label:b("userDialog.usage"),placement:"top",children:e(Ue,{"aria-label":"usage",size:"sm",onClick:Qe,children:e(th,{})})}),e(H,{onClick:rt,size:"sm",children:b("userDialog.resetUsage")}),e(H,{onClick:Je,size:"sm",children:b("userDialog.revokeSubscription")})]})}),e(R,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(H,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:y?e(At,{size:"xs"}):void 0,disabled:Ze,children:b(m?"userDialog.editUser":"createUser")})})]})})]})}),S&&n(ct,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(Mn,{color:"primary",children:e(rh,{})}),e(p,{fontSize:"xl",fontWeight:"semibold",children:b("userDialog.limitReachedTitle")}),e(p,{fontSize:"md",maxW:"sm",children:w&&w>0?b("userDialog.limitReachedBody",{limit:w,active:v!=null?v:w}):b("userDialog.limitReachedContent")})]})]})})]})},ah=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),oh=t=>{if(!t)return null;const s=new Date(`${t}Z`);return Math.floor(s.getTime()/1e3)},no=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=oh(t);return!t||r===null?e(z,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-r<=60?e(z,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(z,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},lh=t=>{if(!t)return null;const s=new Date(t+"Z");return Math.floor(s.getTime()/1e3)},so=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=lh(t),l=r?s-r:null,o=r?Ii(r):{status:"",time:"Not Connected Yet"};return e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${o.time} ago`:o.time})},Ki=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=Ke(),a=Ii(t),c=En[s].icon;return n(Ft,{children:[n(Hr,{colorScheme:En[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),l&&n(p,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&i(`status.${s}`),o&&`: ${o}`]})]}),l&&t&&e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},ch=ie(ah),gs={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},dh=ie(nl,gs),uh=ie(Di,gs),io=ie(Ci,gs),hh=ie(sl,gs),ph=ie(jo,gs),mh=ie(kn,gs),gh=ie(Di,{baseStyle:{width:"15px",height:"15px"}}),fh=ie(Jc,{baseStyle:{width:{base:16,md:20},height:{base:16,md:20}}}),bh=t=>{for(var s=0;s<oa.length;s++){const r=oa[s];if(r.value==t)return r.title}return"No"},yh=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o}=t,i=r===0||r===null;return e(R,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:n(p,{children:[tt(s)," /"," ",i?e(p,{as:"span",fontFamily:"system-ui",children:"\u221E"}):tt(r)]})})},ao=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o,...i}=t,a=r===0||r===null,c=!a&&s/r*100>=100;return n(Ft,{children:[e(qc,{orientation:"horizontal",value:a?100:Math.min(s/r*100,100),colorScheme:c?"red":"primary",...i,children:e(Yc,{h:"6px",borderRadius:"full",children:e(Gc,{borderRadius:"full"})})}),n(R,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[n(p,{children:[tt(s)," /"," ",a?e(p,{as:"span",fontFamily:"system-ui",children:"\u221E"}):tt(r)+(l&&l!=="no_reset"?" "+un("userDialog.resetStrategy"+bh(l)):"")]}),n(p,{children:[un("usersTable.total"),": ",tt(o)]})]})]})},Cs=({sort:t,column:s})=>t.includes(s)?e(gh,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,xh=t=>{const{filters:s,users:{users:r,total:l},onEditingUser:o,onFilterChange:i,loading:a}=Ct(),{t:c}=Ke(),[u,h]=d.exports.useState(void 0),m=_r({base:!1,md:!0}),{userData:g}=fr(),w=g.role==="sudo"||g.role==="full_access",v=Boolean(!w&&g.status==="disabled"),S=g.disabled_reason,y=r.length!==l,N=s.limit||10,I=b=>{let F=s.sort;F.includes(b)?F.startsWith("-")?F="-created_at":F="-"+b:F=b,i({sort:F})},M=b=>{i({status:b.target.value.length>0?b.target.value:void 0})},ae=b=>{h(b===u?void 0:b)};return n(z,{position:"relative",children:[n(z,{id:"users-table",overflowX:{base:"unset",md:"unset"},filter:v?"blur(4px)":void 0,pointerEvents:v?"none":void 0,"aria-hidden":v?!0:void 0,children:[e(il,{allowMultiple:!0,display:{base:"block",md:"none"},index:u,children:n(Rn,{orientation:"vertical",zIndex:"docked",...t,children:[e(tn,{zIndex:"docked",position:"relative",children:n(Dt,{children:[e(Fe,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:I.bind(null,"username"),children:n(R,{children:[e("span",{children:c("users")}),e(Cs,{sort:s.sort,column:"username"})]})}),e(Fe,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:n(R,{spacing:0,position:"relative",children:[n(p,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[c("usersTable.status"),s.status?": "+s.status:""]}),n(st,{value:s.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Ft,{}),_focusVisible:{border:"0 !important"},onChange:M,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Fe,{minW:"100px",cursor:"pointer",pr:0,onClick:I.bind(null,"used_traffic"),children:n(R,{children:[e("span",{children:c("usersTable.dataUsage")}),e(Cs,{sort:s.sort,column:"used_traffic"})]})}),e(Fe,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),n(qr,{children:[!m&&(a?Array.from({length:N}).map((b,F)=>n(d.exports.Fragment,{children:[n(Dt,{children:[e(Ne,{borderBottom:0,minW:"100px",pl:4,pr:4,children:e(ni,{noOfLines:1,width:"40%"})}),e(Ne,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Vn,{height:"16px",width:"64px"})}),e(Ne,{borderBottom:0,minW:"100px",pr:0,children:e(Vn,{height:"16px",width:"120px"})}),e(Ne,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Vn,{height:"16px",width:"16px"})})]}),e(Dt,{className:"collapsible",children:e(Ne,{p:0,colSpan:4,children:e(z,{px:6,py:3,children:e(ni,{noOfLines:3})})})})]},"skeleton-"+F)):r==null?void 0:r.map((b,F)=>{var C;return n(d.exports.Fragment,{children:[n(Dt,{onClick:ae.bind(null,F),cursor:"pointer",children:[e(Ne,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:n("div",{className:"flex-status",children:[e(no,{lastOnline:b.online_at}),e(p,{isTruncated:!0,children:b.username})]})}),e(Ne,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Ki,{compact:!0,showDetail:!1,expiryDate:b.expire,status:b.status})}),e(Ne,{borderBottom:0,minW:"100px",pr:0,children:e(yh,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:En[b.status].bandWidthColor})}),e(Ne,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(uh,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:u===F?"rotate(180deg)":"0deg"})})]}),e(Dt,{className:"collapsible",onClick:ae.bind(null,F),children:e(Ne,{p:0,colSpan:4,children:n(al,{border:0,children:[e(ol,{display:"none"}),e(ll,{border:0,cursor:"pointer",px:6,py:3,children:n(ue,{justifyContent:"space-between",spacing:"4",children:[n(ue,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(p,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.dataUsage")}),e(z,{width:"full",minW:"230px",children:e(ao,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:En[b.status].bandWidthColor})})]}),n(ue,{alignItems:"flex-start",w:"full",spacing:1,children:[e(p,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.service","Service")}),e(p,{fontSize:"sm",color:b.service_name?"gray.700":"gray.500",_dark:{color:b.service_name?"gray.200":"gray.500"},children:(C=b.service_name)!=null?C:c("usersTable.defaultService","Default")})]}),n(R,{w:"full",justifyContent:"space-between",children:[n(z,{width:"full",children:[e(Ki,{compact:!0,expiryDate:b.expire,status:b.status}),e(so,{lastOnline:b.online_at})]}),n(R,{children:[e(oo,{user:b}),e(pt,{label:c("userDialog.editUser"),placement:"top",children:e(Ue,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:X=>{X.stopPropagation(),o(b)},children:e(mh,{})})})]})]})]})})]})})})]},b.username)})),!a&&!m&&r.length===0&&e(Dt,{children:e(Ne,{colSpan:4,border:0,children:e(lo,{isFiltered:y,isCreateDisabled:v})})})]})]})}),n(Rn,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(tn,{position:"relative",zIndex:"docked",children:n(Dt,{children:[e(Fe,{minW:"140px",cursor:"pointer",onClick:I.bind(null,"username"),children:n(R,{children:[e("span",{children:c("username")}),e(Cs,{sort:s.sort,column:"username"})]})}),e(Fe,{width:"400px",minW:"150px",cursor:"pointer",children:n(R,{position:"relative",gap:"5px",children:[n(p,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),s.status?": "+s.status:""]}),e(p,{children:"/"}),e(Cs,{sort:s.sort,column:"expire"}),e(R,{onClick:I.bind(null,"expire"),children:e(p,{children:"Sort by expire"})}),n(st,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Ft,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:M,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Fe,{minW:"150px",children:e("span",{children:c("usersTable.service","Service")})}),e(Fe,{width:"350px",minW:"230px",cursor:"pointer",onClick:I.bind(null,"used_traffic"),children:n(R,{children:[e("span",{children:c("usersTable.dataUsage")}),e(Cs,{sort:s.sort,column:"used_traffic"})]})}),e(Fe,{width:"200px",minW:"180px"})]})}),n(qr,{children:[m&&(a?Array.from({length:N}).map((b,F)=>n(Dt,{children:[e(Ne,{minW:"140px",children:e(ni,{noOfLines:1,width:"40%"})}),e(Ne,{width:"400px",minW:"150px",children:e(Vn,{height:"16px",width:"120px"})}),e(Ne,{minW:"150px",children:e(ni,{noOfLines:1,width:"60%"})}),e(Ne,{width:"350px",minW:"230px",children:e(Vn,{height:"16px",width:"200px"})}),e(Ne,{width:"200px",minW:"180px",children:e(Vn,{height:"16px",width:"64px"})})]},"skeleton-desktop-"+F)):r==null?void 0:r.map((b,F)=>{var C;return n(Dt,{className:ba("interactive",{"last-row":F===r.length-1}),onClick:()=>o(b),children:[e(Ne,{minW:"140px",children:n("div",{className:"flex-status",children:[e(no,{lastOnline:b.online_at}),b.username,e(so,{lastOnline:b.online_at})]})}),e(Ne,{width:"400px",minW:"150px",children:e(Ki,{expiryDate:b.expire,status:b.status})}),e(Ne,{minW:"150px",children:e(p,{fontSize:"sm",color:b.service_name?"gray.700":"gray.500",_dark:{color:b.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(C=b.service_name)!=null?C:c("usersTable.defaultService","Default")})}),e(Ne,{width:"350px",minW:"230px",children:e(ao,{totalUsedTraffic:b.lifetime_used_traffic,dataLimitResetStrategy:b.data_limit_reset_strategy,used:b.used_traffic,total:b.data_limit,colorScheme:En[b.status].bandWidthColor})}),e(Ne,{width:"200px",minW:"180px",children:e(oo,{user:b})})]},b.username)})),!a&&r.length==0&&e(Dt,{children:e(Ne,{colSpan:5,children:e(lo,{isFiltered:y,isCreateDisabled:v})})})]})]})]}),v&&n(ct,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",textAlign:"center",px:6,py:8,bg:"rgba(255, 255, 255, 0.85)",_dark:{bg:"rgba(15, 23, 42, 0.9)"},zIndex:"overlay",children:[e(fh,{color:"red.400",mb:6}),e(p,{fontSize:"xl",fontWeight:"bold",mb:3,children:c("usersTable.adminDisabledTitle","Your account is disabled")}),e(p,{maxW:"480px",color:"gray.600",_dark:{color:"gray.200"},children:S||c("usersTable.adminDisabledDescription","Please contact the sudo admin to regain access.")})]})]})},oo=({user:t})=>{const{setQRCode:s,setSubLink:r}=Ct(),l=t.links.join(`\r
`),i=(u=>u?u.startsWith("/")?window.location.origin+u:u:"")(t.subscription_url),[a,c]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{a[1]&&setTimeout(()=>{c([-1,!1])},1e3)},[a]),n(R,{justifyContent:"flex-end",onClick:u=>{u.preventDefault(),u.stopPropagation()},children:[e(La,{text:i,onCopy:()=>{c([0,!0])},children:e("div",{children:e(pt,{label:a[0]==0&&a[1]?un("usersTable.copied"):un("usersTable.copyLink"),placement:"top",children:e(Ue,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:a[0]==0&&a[1]?e(io,{}):e(hh,{})})})})}),e(La,{text:l,onCopy:()=>{c([1,!0])},children:e("div",{children:e(pt,{label:a[0]==1&&a[1]?un("usersTable.copied"):un("usersTable.copyConfigs"),placement:"top",children:e(Ue,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:a[0]==1&&a[1]?e(io,{}):e(dh,{})})})})}),e(pt,{label:"QR Code",placement:"top",children:e(Ue,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(t.links),r(i)},children:e(ph,{})})})]})},lo=({isFiltered:t,isCreateDisabled:s})=>{const{onCreateUser:r}=Ct(),l=()=>{s||r(!0)};return n(z,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(ch,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(p,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?un("usersTable.noUserMatched"):un("usersTable.noUser")}),!t&&e(H,{size:"sm",colorScheme:"primary",onClick:l,isDisabled:s,children:un("createUser")})]})},Sh=()=>{const{t}=Ke();return d.exports.useEffect(()=>{Ct.getState().refetchUsers(),Vs()},[]),n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(Cl,{}),e(xh,{}),e(_l,{}),e(ih,{}),e(_u,{}),e(Wu,{}),e(Hu,{}),e(Vu,{})]})},Ht=(t,s,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return s({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Bt=(t,s)=>s({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),wh=[{key:"create",label:"admins.permissions.createUser"},{key:"delete",label:"admins.permissions.deleteUser"},{key:"reset_usage",label:"admins.permissions.resetUsage"},{key:"revoke",label:"admins.permissions.revoke"},{key:"create_on_hold",label:"admins.permissions.createOnHold"},{key:"allow_unlimited_data",label:"admins.permissions.unlimitedData"},{key:"allow_unlimited_expire",label:"admins.permissions.unlimitedExpire"},{key:"allow_next_plan",label:"admins.permissions.nextPlan"}],kh=[{key:"can_view",label:"admins.permissions.viewAdmins"},{key:"can_edit",label:"admins.permissions.editAdmins"},{key:"can_manage_sudo",label:"admins.permissions.manageSudo"}],vh=[{key:"usage",label:"admins.sections.usage"},{key:"admins",label:"admins.sections.admins"},{key:"services",label:"admins.sections.services"},{key:"hosts",label:"admins.sections.hosts"},{key:"nodes",label:"admins.sections.nodes"},{key:"integrations",label:"admins.sections.integrations"},{key:"xray",label:"admins.sections.xray"}],Dl=({value:t,onChange:s,maxDataLimitValue:r,onMaxDataLimitChange:l,maxDataLimitError:o,showReset:i=!1,onReset:a})=>{const{t:c}=Ke(),u=(m,g)=>{const[w,v]=m,S={...t,[w]:{...t[w],[v]:g}};s(S)},h=m=>{l==null||l(m.target.value)};return n(Ce,{spacing:6,children:[n(R,{justify:"space-between",align:"center",children:[e(p,{fontWeight:"semibold",children:c("admins.permissions.userCapabilities","User capabilities")}),i&&a&&e(H,{size:"xs",variant:"ghost",onClick:a,children:c("admins.permissions.resetToDefaults","Reset to defaults")})]}),e($e,{columns:{base:1,md:2},spacing:3,children:wh.map(({key:m,label:g})=>n(R,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(p,{fontSize:"sm",children:c(g)}),e(mt,{isChecked:Boolean(t.users[m]),onChange:w=>u(["users",m],w.target.checked)})]},m))}),n(k,{isInvalid:Boolean(o),children:[e(_,{children:c("admins.permissions.maxDataPerUser","Max per user data (GB)")}),e(ve,{type:"number",min:"0",step:"1",placeholder:c("admins.permissions.maxDataHint","Leave empty for unlimited"),value:r,onChange:h}),o?e(Jr,{children:o}):e(nr,{children:c("admins.permissions.maxDataDescription","Applies when this admin creates or edits users.")})]}),n(Ce,{spacing:3,children:[e(p,{fontWeight:"semibold",children:c("admins.permissions.manageAdminsTitle","Admin management")}),e($e,{columns:{base:1,md:2},spacing:3,children:kh.map(({key:m,label:g})=>n(R,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(p,{fontSize:"sm",children:c(g)}),e(mt,{isChecked:Boolean(t.admin_management[m]),onChange:w=>u(["admin_management",m],w.target.checked)})]},m))})]}),n(Ce,{spacing:3,children:[e(p,{fontWeight:"semibold",children:c("admins.permissions.sectionAccess","Section access")}),e($e,{columns:{base:1,md:2},spacing:3,children:vh.map(({key:m,label:g})=>n(R,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(p,{fontSize:"sm",children:c(g)}),e(mt,{isChecked:Boolean(t.sections[m]),onChange:w=>u(["sections",m],w.target.checked)})]},m))})]})]})},Al=({isOpen:t,onClose:s,admin:r})=>{var v,S;const{t:l}=Ke(),o=Kt(),i=ln(y=>y.updateAdmin),[a,c]=d.exports.useState((v=r==null?void 0:r.permissions)!=null?v:Qn),[u,h]=d.exports.useState(""),[m,g]=d.exports.useState(!1);d.exports.useEffect(()=>{var y;r?(c((y=r.permissions)!=null?y:Qn),h(r.permissions.users.max_data_limit_per_user?String(Math.floor(r.permissions.users.max_data_limit_per_user/(1024*1024*1024))):"")):(c(Qn),h(""))},[r,t]);const w=async()=>{if(!!r){g(!0);try{await i(r.username,{permissions:a}),Bt(l("admins.permissions.updateSuccess","Permissions updated"),o),s()}catch(y){Ht(y,o)}finally{g(!1)}}};return n(Lt,{isOpen:t,onClose:s,size:"lg",children:[e(wt,{}),n(Ut,{children:[e(_t,{children:l("admins.permissions.modalTitle",{defaultValue:"Edit permissions for {{username}}",username:(S=r==null?void 0:r.username)!=null?S:""})}),e(Ot,{}),e(kt,{children:e(Dl,{value:a,onChange:c,showReset:!0,onReset:()=>c(Qn),maxDataLimitValue:u,onMaxDataLimitChange:y=>{h(y);const N=Number(y);c(I=>({...I,users:{...I.users,max_data_limit_per_user:!y||Number.isNaN(N)?null:Math.max(0,N)*1024*1024*1024}}))}})}),n(zt,{children:[e(H,{variant:"ghost",mr:3,onClick:s,children:l("cancel")}),e(H,{colorScheme:"primary",onClick:w,isLoading:m,isDisabled:!r,children:l("save","Save")})]})]})]})},Ms=1024*1024*1024,Ch={standard:{users:{create:!0,delete:!1,reset_usage:!1,revoke:!1,create_on_hold:!1,allow_unlimited_data:!1,allow_unlimited_expire:!1,allow_next_plan:!1,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},sudo:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!1},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}},full_access:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!0},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}}},Dn=t=>JSON.parse(JSON.stringify(Ch[t])),_h=t=>t&&t>0?String(Math.floor(t/Ms)):"",Dh=xe.object({users:xe.object({create:xe.boolean(),delete:xe.boolean(),reset_usage:xe.boolean(),revoke:xe.boolean(),create_on_hold:xe.boolean(),allow_unlimited_data:xe.boolean(),allow_unlimited_expire:xe.boolean(),allow_next_plan:xe.boolean(),max_data_limit_per_user:xe.number().nullable()}),admin_management:xe.object({can_view:xe.boolean(),can_edit:xe.boolean(),can_manage_sudo:xe.boolean()}),sections:xe.object({usage:xe.boolean(),admins:xe.boolean(),services:xe.boolean(),hosts:xe.boolean(),nodes:xe.boolean(),integrations:xe.boolean(),xray:xe.boolean()})}),Ah=()=>{var G,D,V,ge,pe,Z,_e;const{t}=Ke(),s=Kt(),{admins:r,adminInDialog:l,isAdminDialogOpen:o,closeAdminDialog:i,createAdmin:a,updateAdmin:c}=ln(),u=d.exports.useMemo(()=>{var te;return l?(te=r.find(le=>le.username===l.username))!=null?te:l:null},[l,r]),h=d.exports.useMemo(()=>u?"edit":"create",[u]),m=d.exports.useMemo(()=>xe.object({username:h==="create"?xe.string().trim().min(3,{message:t("admins.validation.usernameMin")}):xe.string().optional(),password:xe.string().trim().optional().transform(le=>le===""?void 0:le).refine(le=>!le||le.length>=6,t("admins.validation.passwordMin")),telegram_id:xe.string().trim().optional().transform(le=>le===""?void 0:le).refine(le=>le===void 0||/^\d+$/.test(le),t("admins.validation.telegramNumeric")),role:xe.enum(["standard","sudo","full_access"]).optional(),data_limit:xe.string().trim().optional().transform(le=>le===""?void 0:le).refine(le=>le===void 0||/^\d+$/.test(le),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:xe.string().trim().optional().transform(le=>le===""?void 0:le).refine(le=>le===void 0||/^\d+$/.test(le),t("admins.validation.usersLimitNumeric","Users limit must be a number")),maxDataLimitPerUserGb:xe.string().trim().optional().transform(le=>le===""?void 0:le),permissions:Dh}).superRefine((le,B)=>{h==="create"&&!le.password&&B.addIssue({code:xe.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[h,t]),g=Br({resolver:_i(m),defaultValues:{username:"",password:"",telegram_id:"",role:"standard",permissions:Dn("standard"),maxDataLimitPerUserGb:"",data_limit:"",users_limit:""}}),{register:w,handleSubmit:v,reset:S,formState:y,setValue:N,watch:I,setError:M}=g,[ae,b]=d.exports.useState(!1),[F,C]=d.exports.useState(!1),X=d.exports.useCallback(te=>{var L;const le="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",B=le.length;if(typeof window<"u"&&((L=window.crypto)==null?void 0:L.getRandomValues)){const U=new Uint32Array(te);return window.crypto.getRandomValues(U),Array.from(U,j=>le[j%B]).join("")}return Array.from({length:te},()=>{const U=Math.floor(Math.random()*B);return le[U]}).join("")},[]),Y=d.exports.useCallback(()=>{if(h==="edit")return;const te=X(8);N("username",te,{shouldDirty:!0,shouldValidate:!0})},[X,h,N]),me=d.exports.useCallback(()=>{const te=X(12);N("password",te,{shouldDirty:!0,shouldValidate:!0})},[X,N]),{errors:O,isSubmitting:oe}=y,P=I("role"),we=I("permissions"),A=(G=I("maxDataLimitPerUserGb"))!=null?G:"",De=d.exports.useCallback(()=>{const te=P!=null?P:"standard";N("permissions",Dn(te),{shouldDirty:!0}),N("maxDataLimitPerUserGb","",{shouldDirty:!0})},[N,P]),ee=d.exports.useCallback(te=>{N("permissions",te,{shouldDirty:!0})},[N]),Ae=d.exports.useCallback(te=>{N("maxDataLimitPerUserGb",te,{shouldDirty:!0})},[N]);d.exports.useEffect(()=>{w("maxDataLimitPerUserGb"),w("permissions")},[w]),d.exports.useEffect(()=>{var te,le,B;if(o){const L=(te=u==null?void 0:u.role)!=null?te:"standard",U=u&&(le=JSON.parse(JSON.stringify(u.permissions)))!=null?le:Dn(L);S({username:(B=u==null?void 0:u.username)!=null?B:"",password:"",telegram_id:(u==null?void 0:u.telegram_id)!==void 0&&(u==null?void 0:u.telegram_id)!==null?String(u.telegram_id):"",role:L,permissions:U,maxDataLimitPerUserGb:_h(U.users.max_data_limit_per_user),data_limit:(u==null?void 0:u.data_limit)!==void 0&&(u==null?void 0:u.data_limit)!==null?String(Math.floor(u.data_limit/Ms)):"",users_limit:(u==null?void 0:u.users_limit)!==void 0&&(u==null?void 0:u.users_limit)!==null?String(u.users_limit):""})}},[u,o,S]),d.exports.useEffect(()=>{o||C(!1)},[o]);const Re=v(async te=>{var L,U,j,Te,qe;const le=(L=te.role)!=null?L:"standard";let B;if(h==="create"){const Qe=JSON.parse(JSON.stringify((U=te.permissions)!=null?U:Dn(le))),T=(j=te.maxDataLimitPerUserGb)==null?void 0:j.trim();if(T){const ce=Number(T);if(Number.isNaN(ce)||ce<0){M("maxDataLimitPerUserGb",{type:"manual",message:t("admins.validation.invalidMaxDataLimit","Enter a positive number or leave empty.")});return}Qe.users.max_data_limit_per_user=ce===0?null:Math.round(ce*Ms)}else Qe.users.max_data_limit_per_user=null;B=Qe}if(h==="edit"&&u){const Qe=(Te=u.active_users)!=null?Te:0;if(te.users_limit){const T=Number(te.users_limit);if(!Number.isNaN(T)&&T>0&&T<Qe){M("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:Qe})});return}}}try{if(h==="create"){const Qe={username:te.username.trim(),password:(qe=te.password)!=null?qe:"",role:le,permissions:B!=null?B:Dn(le),telegram_id:te.telegram_id?Number(te.telegram_id):void 0,data_limit:te.data_limit?Number(te.data_limit)*Ms:void 0,users_limit:te.users_limit?Number(te.users_limit):void 0};await a(Qe),Bt(t("admins.createSuccess","Admin created"),s)}else if(u){const Qe={role:le,telegram_id:te.telegram_id?Number(te.telegram_id):void 0,data_limit:te.data_limit?Number(te.data_limit)*Ms:void 0,users_limit:te.users_limit?Number(te.users_limit):void 0};te.password&&(Qe.password=te.password),await c(u.username,Qe),Bt(t("admins.updateSuccess","Admin updated"),s)}i()}catch(Qe){Ht(Qe,s,g)}}),Me=n(ue,{spacing:4,align:"stretch",children:[n(k,{isInvalid:!!O.username,children:[e(_,{children:t("username")}),n(Dr,{children:[e(ve,{placeholder:t("admins.usernamePlaceholder","Admin username"),...w("username"),isDisabled:h==="edit"}),h==="create"&&e(Rr,{children:e(Ue,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(Si,{width:20}),onClick:Y})})]}),e(Jr,{children:(D=O.username)==null?void 0:D.message})]}),n(k,{isInvalid:!!O.password,children:[e(_,{children:t("password")}),n(R,{spacing:2,children:[n(Dr,{children:[e(ve,{placeholder:t("admins.passwordPlaceholder","Password"),type:ae?"text":"password",...w("password")}),e(Rr,{children:e(Ue,{"aria-label":ae?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:ae?e(Sa,{width:16}):e(Fs,{width:16}),onClick:()=>b(!ae)})})]}),e(Ue,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(Si,{width:20}),onClick:me})]}),e(Jr,{children:(V=O.password)==null?void 0:V.message}),h==="edit"&&e(p,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),n(k,{children:[e(_,{children:t("admins.roleLabel","Admin role")}),e(Bs,{value:P!=null?P:"standard",onChange:te=>N("role",te,{shouldDirty:!0}),children:n(ue,{align:"flex-start",spacing:2,children:[n(Tr,{value:"standard",children:[e(p,{fontWeight:"medium",children:t("admins.roles.standard","Standard")}),e(nr,{m:0,children:t("admins.roles.standardDescription","Can manage own users with limited privileges.")})]}),n(Tr,{value:"sudo",children:[e(p,{fontWeight:"medium",children:t("admins.roles.sudo","Sudo")}),e(nr,{m:0,children:t("admins.roles.sudoDescription","Extended access to settings and other admins.")})]}),n(Tr,{value:"full_access",children:[e(p,{fontWeight:"medium",children:t("admins.roles.fullAccess","Full access")}),e(nr,{m:0,children:t("admins.roles.fullAccessDescription","Complete control, including other sudo admins.")})]})]})})]}),h==="edit"&&e(H,{alignSelf:"flex-start",onClick:()=>C(!0),variant:"outline",children:t("admins.editPermissionsButton","Edit permissions")}),n(k,{isInvalid:!!O.telegram_id,children:[e(_,{children:t("admins.telegramId","Telegram ID")}),e(ve,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...w("telegram_id")}),e(Jr,{children:(ge=O.telegram_id)==null?void 0:ge.message})]}),n(k,{isInvalid:!!O.data_limit,children:[e(_,{children:t("admins.dataLimit","Data Limit (GB)")}),e(ve,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...w("data_limit")}),e(Jr,{children:(pe=O.data_limit)==null?void 0:pe.message}),e(p,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),n(k,{isInvalid:!!O.users_limit,children:[e(_,{children:t("admins.usersLimit","Users Limit")}),e(ve,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...w("users_limit")}),e(Jr,{children:(Z=O.users_limit)==null?void 0:Z.message}),e(p,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]});return n(Ft,{children:[n(Lt,{isOpen:o,onClose:i,size:"lg",children:[e(wt,{}),n(Ut,{children:[e(_t,{children:h==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Ot,{}),e(kt,{children:h==="create"?n(Wn,{colorScheme:"primary",isFitted:!0,variant:"enclosed",children:[n(Fn,{children:[e(Vt,{children:t("admins.detailsTabLabel","Details")}),e(Vt,{children:t("admins.permissionsTabLabel","Permissions")})]}),n(Hn,{children:[e($t,{px:0,children:Me}),e($t,{px:0,children:e(Dl,{value:we!=null?we:Dn(P!=null?P:"standard"),onChange:ee,showReset:!0,onReset:De,maxDataLimitValue:A,onMaxDataLimitChange:Ae,maxDataLimitError:(_e=O.maxDataLimitPerUserGb)==null?void 0:_e.message})})]})]}):Me}),e(zt,{children:n(R,{spacing:3,children:[e(H,{variant:"ghost",onClick:i,children:t("cancel")}),e(H,{colorScheme:"primary",onClick:Re,isLoading:oe,children:h==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]}),e(Al,{isOpen:F,onClose:()=>C(!1),admin:u})]})},Ph=()=>{var W,Se,Le;const{t}=Ke(),s=Kt(),{userData:r}=fr(),l=at("gray.50","whiteAlpha.100"),o=at("primary.50","primary.900"),i=at("surface.light","surface.dark"),a=at("light-border","gray.700"),{admins:c,loading:u,total:h,filters:m,onFilterChange:g,fetchAdmins:w,deleteAdmin:v,resetUsage:S,disableAdmin:y,enableAdmin:N,openAdminDialog:I,openAdminDetails:M,adminInDetails:ae}=ln(),b=d.exports.useRef(null),F=d.exports.useRef(null),{isOpen:C,onOpen:X,onClose:Y}=qt(),{isOpen:me,onOpen:O,onClose:oe}=qt(),{isOpen:P,onOpen:we,onClose:A}=qt(),[De,ee]=d.exports.useState(null),[Ae,Re]=d.exports.useState(null),[Me,G]=d.exports.useState(""),[D,V]=d.exports.useState(null),[ge,pe]=d.exports.useState(null),Z=r.username,_e=r.role==="full_access",te=(W=r.permissions)==null?void 0:W.admin_management,le=Boolean((te==null?void 0:te.can_edit)||_e),B=Boolean((te==null?void 0:te.can_manage_sudo)||_e),L=J=>J.username===Z?!0:J.role==="full_access"||!le?!1:J.role==="sudo"?B:!0,U=J=>{if(J==="data_usage"||J==="data_limit"){const He=m.sort===J?`-${J}`:J;g({sort:He,offset:0})}else{const He=m.sort===J?`-${J}`:m.sort===`-${J}`?void 0:J;g({sort:He,offset:0})}},j=J=>{ee(J),X()},Te=async()=>{if(!!De)try{await v(De.username),Bt(t("admins.deleteSuccess","Admin removed"),s),Y(),ee(null)}catch(J){Ht(J,s)}},qe=async J=>{V({type:"reset",username:J.username});try{await S(J.username),Bt(t("admins.resetUsageSuccess","Usage reset"),s),w()}catch(He){Ht(He,s)}finally{V(null)}},Qe=J=>{Re(J),G(""),O()},T=()=>{oe(),Re(null),G("")},ce=J=>{pe(J),we()},$=()=>{pe(null),A()},be=async()=>{if(!Ae)return;const J=Me.trim();if(!(J.length<3)){V({type:"disableAdmin",username:Ae.username});try{await y(Ae.username,J),Bt(t("admins.disableAdminSuccess","Admin disabled"),s),T(),w()}catch(He){Ht(He,s)}finally{V(null)}}},dt=async J=>{V({type:"enableAdmin",username:J.username});try{await N(J.username),Bt(t("admins.enableAdminSuccess","Admin re-enabled"),s),w()}catch(He){Ht(He,s)}finally{V(null)}},ut=({column:J})=>{var fe,Ie,Ve,Ye,rt;let He=!1,se=!1;return J==="data"?(He=((fe=m.sort)==null?void 0:fe.includes("data_usage"))||((Ie=m.sort)==null?void 0:Ie.includes("data_limit")),se=He&&((Ve=m.sort)==null?void 0:Ve.startsWith("-"))):(He=(Ye=m.sort)==null?void 0:Ye.includes(J),se=He&&((rt=m.sort)==null?void 0:rt.startsWith("-"))),e(Di,{style:{width:"1rem",height:"1rem",opacity:He?1:0,transform:He&&!se?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},Q=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return u&&!c.length?e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(At,{})}):h?n(Ft,{children:[e(z,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:n(Rn,{variant:"simple",size:"sm",minW:"640px",children:[e(tn,{children:e(Dt,{children:Q.map(J=>e(Fe,{onClick:()=>J.key==="username"||J.key==="users_count"||J.key==="data"?U(J.key):void 0,cursor:J.key==="username"||J.key==="users_count"||J.key==="data"?"pointer":"default",textAlign:J.key==="actions"?"right":"left",children:n(R,{justify:J.key==="actions"?"flex-end":"flex-start",children:[e(p,{children:J.label}),J.key==="data"?n(bi,{children:[e(yi,{as:Ue,size:"xs",variant:"ghost",icon:e(ut,{column:"data"})}),n(xi,{children:[e(jt,{onClick:()=>U("data_usage"),children:t("admins.sortByUsage")}),e(jt,{onClick:()=>U("data_limit"),children:t("admins.sortByLimit")})]})]}):J.key==="username"||J.key==="users_count"?e(ut,{column:J.key}):null]})},J.key))})}),e(qr,{children:c.map(J=>{var Ze,Wt;const He=(ae==null?void 0:ae.username)===J.username,se=J.users_limit&&J.users_limit>0?String(J.users_limit):"\u221E",fe=`${(Ze=J.active_users)!=null?Ze:0}/${se}`,Ie=L(J),Ve=Ie&&J.username!==Z,Ye=Ve&&J.status!=="disabled",rt=Ve&&J.status==="disabled",Je=Ve;return n(Dt,{onClick:()=>M(J),cursor:"pointer",bg:He?o:void 0,_hover:{bg:l},transition:"background-color 0.15s ease-in-out",children:[n(Ne,{children:[e(p,{fontWeight:"medium",children:J.username}),J.role!=="standard"&&e(Hr,{colorScheme:J.role==="full_access"?"orange":"purple",fontSize:"xs",mt:1,children:J.role==="full_access"?t("admins.roles.fullAccess","Full access"):t("admins.roles.sudo","Sudo")}),J.status==="disabled"&&e(Hr,{colorScheme:"red",fontSize:"xs",mt:1,children:t("admins.disabledLabel","Disabled")}),J.status==="disabled"&&J.disabled_reason&&e(p,{fontSize:"xs",color:"red.400",mt:1,children:J.disabled_reason})]}),e(Ne,{children:n(p,{whiteSpace:"nowrap",children:[tt((Wt=J.users_usage)!=null?Wt:0,2)," /"," ",J.data_limit?tt(J.data_limit,2):"-"]})}),e(Ne,{children:n(Ce,{spacing:0,children:[e(p,{fontSize:"xs",color:"gray.500",children:t("users")}),e(p,{fontWeight:"semibold",children:fe})]})}),e(Ne,{textAlign:"right",children:n(bi,{children:[e(yi,{as:Ue,icon:e(Xc,{width:20}),variant:"ghost",isDisabled:!Ie&&!Ve,onClick:xt=>xt.stopPropagation()}),n(xi,{onClick:xt=>xt.stopPropagation(),children:[Ie&&n(Ft,{children:[e(jt,{icon:e(kn,{width:20}),onClick:xt=>{xt.stopPropagation(),I(J)},children:t("edit")}),e(jt,{icon:e(cl,{width:20}),onClick:xt=>{xt.stopPropagation(),ce(J)},children:t("admins.editPermissionsButton","Edit permissions")}),e(jt,{icon:e(Yr,{width:20}),onClick:xt=>{xt.stopPropagation(),qe(J)},isDisabled:(D==null?void 0:D.username)===J.username&&(D==null?void 0:D.type)==="reset",children:t("admins.resetUsage")})]}),(Ye||rt||Je)&&Ie&&e(wi,{}),Ye&&e(jt,{icon:e(Qc,{width:20}),onClick:xt=>{xt.stopPropagation(),Qe(J)},isDisabled:(D==null?void 0:D.username)===J.username&&(D==null?void 0:D.type)==="disableAdmin",children:t("admins.disableAdmin","Disable admin")}),rt&&e(jt,{icon:e(Zc,{width:20}),onClick:xt=>{xt.stopPropagation(),dt(J)},isDisabled:(D==null?void 0:D.username)===J.username&&(D==null?void 0:D.type)==="enableAdmin",children:t("admins.enableAdmin","Enable admin")}),Je&&(Ye||rt)&&e(wi,{}),Je&&e(jt,{color:"red.500",icon:e(on,{width:20}),onClick:xt=>{xt.stopPropagation(),j(J)},children:t("delete")})]})]})})]},J.username)})})]})}),e(ns,{isOpen:C,leastDestructiveRef:b,onClose:Y,children:e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(ss,{bg:i,borderWidth:"1px",borderColor:a,children:[e(_t,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(kt,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(Se=De==null?void 0:De.username)!=null?Se:""})}),n(zt,{children:[e(H,{ref:b,onClick:Y,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(H,{colorScheme:"red",onClick:Te,ml:3,children:t("delete")})]})]})})}),e(ns,{isOpen:me,leastDestructiveRef:F,onClose:T,children:e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(ss,{bg:i,borderWidth:"1px",borderColor:a,children:[e(_t,{fontSize:"lg",fontWeight:"bold",children:t("admins.disableAdminTitle","Disable admin")}),n(kt,{children:[e(p,{mb:3,children:t("admins.disableAdminMessage","All users owned by {{username}} will be disabled. Provide a reason for this action.",{username:(Le=Ae==null?void 0:Ae.username)!=null?Le:""})}),e(Cr,{value:Me,onChange:J=>G(J.target.value),placeholder:t("admins.disableAdminReasonPlaceholder","Reason for disabling")})]}),n(zt,{children:[e(H,{ref:F,onClick:T,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(H,{colorScheme:"red",onClick:be,ml:3,isDisabled:Me.trim().length<3,isLoading:(D==null?void 0:D.type)==="disableAdmin"&&(D==null?void 0:D.username)===(Ae==null?void 0:Ae.username),children:t("admins.disableAdminConfirm","Disable admin")})]})]})})}),e(Al,{isOpen:P,onClose:$,admin:ge})]}):e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(p,{children:t("admins.noAdmins")})})},Ih=(t,s)=>!t||t<=0?s!=null?s:"\u221E":`${t}`,Ji=(t,s)=>!t||t<=0?s!=null?s:"\u221E":tt(t,2),Th=()=>{var I,M,ae,b,F,C,X,Y,me,O;const{t}=Ke(),{isAdminDetailsOpen:s,adminInDetails:r,closeAdminDetails:l}=ln(oe=>({isAdminDetailsOpen:oe.isAdminDetailsOpen,adminInDetails:oe.adminInDetails,closeAdminDetails:oe.closeAdminDetails})),o=at("gray.50","whiteAlpha.50"),i=(I=r==null?void 0:r.active_users)!=null?I:0,a=(M=r==null?void 0:r.users_limit)!=null?M:null,c=t("admins.details.unlimited","Unlimited"),u=a&&a>0?String(a):c,h=(ae=r==null?void 0:r.users_count)!=null?ae:0,m=(b=r==null?void 0:r.limited_users)!=null?b:0,g=(F=r==null?void 0:r.expired_users)!=null?F:0,w=(C=r==null?void 0:r.online_users)!=null?C:0,v=(X=r==null?void 0:r.users_usage)!=null?X:0,S=(Y=r==null?void 0:r.data_limit)!=null?Y:null,y=S&&S>0?Math.max(S-v,0):null,N=(me=r==null?void 0:r.lifetime_usage)!=null?me:null;return n(Lt,{isCentered:!0,isOpen:s,onClose:l,scrollBehavior:"inside",size:"xl",children:[e(wt,{}),n(Ut,{children:[e(_t,{bg:o,children:n(Ce,{spacing:1,children:[n(R,{spacing:2,children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:(O=r==null?void 0:r.username)!=null?O:t("admins.details.title","Admin details")}),r&&e(Hr,{fontSize:"xs",px:2,py:.5,borderRadius:"full",colorScheme:r.role==="full_access"?"orange":r.role==="sudo"?"purple":"gray",children:r.role==="full_access"?t("admins.roles.fullAccess","Full access"):r.role==="sudo"?t("admins.roles.sudo","Sudo"):t("admins.roles.standard","Standard")})]}),r&&e(p,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:i,limit:u})})]})}),e(Ot,{}),e(kt,{children:r?n(Ce,{spacing:8,children:[n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),n($e,{columns:{base:2,md:3},spacing:4,children:[e(en,{label:t("admins.details.activeLabel","Active"),value:String(i)}),e(en,{label:t("admins.details.onlineLabel","Online"),value:String(w)}),e(en,{label:t("admins.details.limitedLabel","Limited"),value:String(m)}),e(en,{label:t("admins.details.expiredLabel","Expired"),value:String(g)}),e(en,{label:t("admins.details.totalUsers","Total users"),value:String(h)}),e(en,{label:t("admins.details.usersLimit","Users limit"),value:Ih(a,c)})]})]}),n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),n($e,{columns:{base:2,md:4},spacing:4,children:[e(en,{label:t("admins.details.used","Used"),value:tt(v,2)}),e(en,{label:t("admins.details.limit","Limit"),value:Ji(S,c)}),e(en,{label:t("admins.details.remaining","Remaining"),value:Ji(y,c)}),e(en,{label:t("admins.details.lifetime","Lifetime usage"),value:Ji(N,void 0)})]})]})]}):e(z,{py:8,children:e(p,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(zt,{children:e(H,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},en=({label:t,value:s})=>n(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(p,{fontWeight:"semibold",children:s})]}),Eh=()=>{var i;const{t}=Ke(),s=ln(a=>a.fetchAdmins),{userData:r,getUserIsSuccess:l}=fr(),o=l&&Boolean((i=r.permissions)==null?void 0:i.sections.admins);return d.exports.useEffect(()=>{o&&s()},[s,o]),o?n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(Cl,{for:"admins"}),e(Ph,{}),e(_l,{for:"admins"}),e(Ah,{}),e(Th,{})]}):n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(p,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},Pl=ds(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),Pe("/hosts").then(s=>t({hosts:s})).finally(()=>t({isLoading:!1}))},setHosts:s=>(t({isPostLoading:!0}),Pe("/hosts",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})}))})),zh=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Nh=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],Rh=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],Mh=ie(kn,{baseStyle:{w:4,h:4}}),Il=ie(gn,{baseStyle:{w:4,h:4}}),Tl=ie(Yo,{baseStyle:{w:4,h:4}}),Lh=ie(Js,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),Uh=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],ts=()=>{const{t}=Ke();return n(us,{isLazy:!0,placement:"right",children:[e(hs,{children:e(z,{mt:"-1",children:e(Lh,{})})}),e(tl,{children:n(ps,{maxW:"xs",fontSize:"xs",children:[e(qs,{}),e(ul,{}),e(ms,{children:n(z,{pr:5,lineHeight:"1.4",children:[e(p,{mb:2,children:t("hostsDialog.desc")}),Uh.map(({token:s,labelKey:r})=>n(p,{mt:1,children:[e(Hr,{mr:2,children:s}),t(r)]},s))]})})]})})]})},El=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Fr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,rn=t=>(t!=null?t:"").trim(),_s=(t,s=!1)=>typeof t=="boolean"?t:s,Oh=(t,s)=>{var r,l,o,i,a,c,u,h;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(o=t.address)!=null?o:"",sort:(i=t.sort)!=null?i:s,port:(a=t.port)!=null?a:null,path:rn(t.path),sni:rn(t.sni),host:rn(t.host),mux_enable:_s(t.mux_enable),allowinsecure:_s(t.allowinsecure),is_disabled:_s(t.is_disabled,!1),fragment_setting:rn(t.fragment_setting),noise_setting:rn(t.noise_setting),random_user_agent:_s(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(h=t.fingerprint)!=null?h:"",use_sni_as_host:_s(t.use_sni_as_host)}},la=t=>{var s,r;return{id:(s=t.id)!=null?s:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},co=t=>{var s,r;return{...t,id:(s=t.id)!=null?s:null,port:(r=t.port)!=null?r:null,path:rn(t.path),sni:rn(t.sni),host:rn(t.host),fragment_setting:rn(t.fragment_setting),noise_setting:rn(t.noise_setting)}},zl=t=>{const s=co(t.data),r=co(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(s)!==JSON.stringify(r)},Wh=t=>{var s;return{id:(s=t.id)!=null?s:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},Ls=t=>[...t].sort((s,r)=>{const l=Fr(s.data.sort)-Fr(r.data.sort);return l!==0?l:s.data.remark.localeCompare(r.data.remark)}),Fh=t=>{const s=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((o,i)=>{const a=Oh(o,i),c=a.id!=null?`host-${a.id}`:El();s.push({uid:c,inboundTag:r,initialInboundTag:r,data:la(a),original:la(a)})})}),Ls(s)},Nl=t=>{const s=new Map;t.forEach(l=>{var i;const o=(i=s.get(l.inboundTag))!=null?i:[];o.push(l.data),s.set(l.inboundTag,o)});const r={};return s.forEach((l,o)=>{r[o]=l.map(i=>Wh(i)).sort((i,a)=>Fr(i.sort)-Fr(a.sort))}),r},qi=(t,s)=>{const r=Nl(t),l=Array.from(new Set(s)),o={};return l.forEach(i=>{var a;o[i]=(a=r[i])!=null?a:[]}),o},Hh=({host:t,inboundOptions:s,orderIndex:r,onToggleActive:l,onEdit:o,onDelete:i,saving:a,deleting:c})=>{const{t:u}=Ke(),h=s.find(v=>v.value===t.inboundTag),m=!t.data.is_disabled,g=zl(t),w=t.data.remark||u("hostsPage.untitledHost");return e(sn,{borderWidth:"1px",borderColor:g?"primary.400":"gray.200",_dark:{borderColor:g?"primary.300":"gray.700",bg:g?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>o(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:n(pn,{as:Ce,spacing:4,children:[n(R,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(ue,{align:"flex-start",spacing:1,flex:"1",children:[e(pt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(p,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:w})}),n(R,{spacing:2,flexWrap:"wrap",children:[e(yt,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),h&&e(yt,{colorScheme:"purple",size:"sm",children:`${h.value} (${h.protocol.toUpperCase()} - ${h.network})`}),typeof t.data.port=="number"&&e(yt,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),g&&e(yt,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),n(R,{spacing:2,children:[e(mt,{size:"sm",colorScheme:"primary",isChecked:m,onChange:v=>{v.stopPropagation(),l(t.uid,v.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(m?"hostsPage.enabled":"hostsPage.disabled")})]})]}),n(ue,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(p,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&n(p,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&n(p,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),n(R,{justify:"space-between",children:[e(H,{size:"sm",variant:"outline",leftIcon:e(Mh,{}),onClick:v=>{v.stopPropagation(),o(t.uid)},isLoading:a,children:u("hostsPage.edit")}),e(Ue,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:v=>{v.stopPropagation(),i(t.uid)},icon:e(Gs,{}),isLoading:c})]})]})})},Bh=({host:t,index:s})=>{const{t:r}=Ke(),l=jc(),o=t.data.remark||r("hostsPage.untitledHost"),i=d.exports.useCallback(a=>{a.pointerType==="mouse"&&a.button!==0||(a.preventDefault(),l.start(a))},[l]);return e(dl.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:n(R,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(pt,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(Ue,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(Tl,{}),cursor:"grab",onPointerDown:i,style:{touchAction:"none"}})}),e(yt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:s+1})}),n(ue,{align:"flex-start",spacing:0,flex:"1",children:[e(pt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(p,{fontWeight:"medium",noOfLines:1,maxW:"full",children:o})}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Vh=({host:t,inboundOptions:s,isOpen:r,onClose:l,onChange:o,onChangeInbound:i,onSave:a,onReset:c,onDelete:u,saving:h,deleting:m})=>{var S;const{t:g}=Ke();if(!t)return null;const w=s.find(y=>y.value===t.inboundTag),v=zl(t);return n(Lt,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,children:[e(wt,{}),n(Ut,{children:[e(Ot,{}),e(_t,{pb:1,children:n(ue,{align:"stretch",spacing:1,children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||g("hostsPage.untitledHost")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||g("hostsPage.noAddress")}),w&&e(yt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${w.value} (${w.protocol.toUpperCase()} - ${w.network})`})]})}),e(kt,{children:n(ue,{align:"stretch",spacing:5,children:[n(sn,{variant:"outline",children:[e(Zn,{pb:2,children:e(p,{fontWeight:"semibold",children:g("hostsPage.section.general")})}),e(pn,{pt:0,children:n(ue,{align:"stretch",spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.remark")}),n(Dr,{children:[e(ve,{value:t.data.remark,onChange:y=>o(t.uid,"remark",y.target.value)}),e(Rr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ts,{})})]})]}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsPage.inboundLabel")}),e(st,{value:t.inboundTag,onChange:y=>i(t.uid,y.target.value),children:s.map(y=>e("option",{value:y.value,children:y.label},y.value))})]}),n(k,{children:[e(_,{children:g("hostsDialog.sort")}),e(Nn,{value:t.data.sort,allowMouseWheel:!0,onChange:(y,N)=>o(t.uid,"sort",Number.isNaN(N)?t.data.sort:N),children:e(zn,{})})]})]}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.address")}),n(Dr,{children:[e(ve,{value:t.data.address,onChange:y=>o(t.uid,"address",y.target.value)}),e(Rr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ts,{})})]})]}),n(k,{children:[e(_,{children:g("hostsDialog.port")}),e(Nn,{value:(S=t.data.port)!=null?S:"",allowMouseWheel:!0,onChange:(y,N)=>o(t.uid,"port",Number.isNaN(N)?null:N),children:e(zn,{})})]})]}),n(k,{children:[e(_,{children:g("hostsDialog.path")}),e(ve,{value:t.data.path,onChange:y=>o(t.uid,"path",y.target.value),placeholder:"/"})]})]})})]}),n(sn,{variant:"outline",children:[e(Zn,{pb:2,children:e(p,{fontWeight:"semibold",children:g("hostsPage.section.security")})}),e(pn,{pt:0,children:n(ue,{align:"stretch",spacing:4,children:[n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.sni")}),e(ve,{value:t.data.sni,onChange:y=>o(t.uid,"sni",y.target.value)})]}),n(k,{children:[e(_,{children:g("hostsDialog.host")}),n(Dr,{children:[e(ve,{value:t.data.host,onChange:y=>o(t.uid,"host",y.target.value)}),e(Rr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ts,{})})]})]})]}),n($e,{columns:{base:1,md:3},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.security")}),e(st,{value:t.data.security,onChange:y=>o(t.uid,"security",y.target.value),children:zh.map(y=>e("option",{value:y.value,children:y.title},y.value))})]}),n(k,{children:[e(_,{children:g("hostsDialog.alpn")}),e(st,{value:t.data.alpn,onChange:y=>o(t.uid,"alpn",y.target.value),children:Nh.map(y=>e("option",{value:y.value,children:y.title},y.value))})]}),n(k,{children:[e(_,{children:g("hostsDialog.fingerprint")}),e(st,{value:t.data.fingerprint,onChange:y=>o(t.uid,"fingerprint",y.target.value),children:Rh.map(y=>e("option",{value:y.value,children:y.title},y.value))})]})]})]})})]}),n(sn,{variant:"outline",children:[e(Zn,{pb:2,children:e(p,{fontWeight:"semibold",children:g("hostsPage.section.advanced")})}),e(pn,{pt:0,children:n(ue,{align:"stretch",spacing:4,children:[n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.fragment")}),e(ve,{value:t.data.fragment_setting,onChange:y=>o(t.uid,"fragment_setting",y.target.value)})]}),n(k,{children:[e(_,{children:g("hostsDialog.noise")}),e(ve,{value:t.data.noise_setting,onChange:y=>o(t.uid,"noise_setting",y.target.value)})]})]}),n(Ce,{direction:{base:"column",md:"row"},spacing:4,children:[e(Nr,{isChecked:t.data.allowinsecure,onChange:y=>o(t.uid,"allowinsecure",y.target.checked),children:g("hostsDialog.allowinsecure")}),e(Nr,{isChecked:t.data.mux_enable,onChange:y=>o(t.uid,"mux_enable",y.target.checked),children:g("hostsDialog.muxEnable")}),e(Nr,{isChecked:t.data.random_user_agent,onChange:y=>o(t.uid,"random_user_agent",y.target.checked),children:g("hostsDialog.randomUserAgent")}),e(Nr,{isChecked:t.data.use_sni_as_host,onChange:y=>o(t.uid,"use_sni_as_host",y.target.checked),children:g("hostsDialog.useSniAsHost")})]})]})})]})]})}),n(zt,{justifyContent:"space-between",children:[e(H,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(Gs,{}),onClick:()=>u(t.uid),isLoading:m,children:g("hostsPage.delete")}),n(R,{spacing:3,children:[e(H,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!v||h,children:g("hostsPage.reset")}),e(H,{size:"sm",colorScheme:"primary",onClick:()=>a(t.uid),isDisabled:!v,isLoading:h,children:g("hostsPage.save")})]})]})]})]})},$h=({isOpen:t,onClose:s,inboundOptions:r,onSubmit:l,isSubmitting:o,defaultSort:i})=>{var g,w,v,S;const{t:a}=Ke(),c=d.exports.useRef(null),[u,h]=d.exports.useState({inboundTag:(w=(g=r[0])==null?void 0:g.value)!=null?w:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var y,N;t&&(h({inboundTag:(N=(y=r[0])==null?void 0:y.value)!=null?N:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var I;return(I=c.current)==null?void 0:I.focus()},150))},[i,r,t]);const m=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return n(Lt,{isOpen:t,onClose:s,size:"lg",initialFocusRef:c,children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ut,{children:[e(_t,{children:n(R,{spacing:3,children:[e(Il,{}),e(p,{fontWeight:"semibold",children:a("hostsPage.create.title")})]})}),e(Ot,{mt:2}),n(kt,{as:ue,align:"stretch",spacing:4,pt:2,children:[e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:a("hostsPage.create.description")}),n(k,{children:[e(_,{children:a("hostsPage.inboundLabel")}),e(st,{value:u.inboundTag,onChange:y=>h(N=>({...N,inboundTag:y.target.value})),children:r.map(y=>e("option",{value:y.value,children:y.label},y.value))})]}),n(k,{isRequired:!0,children:[e(_,{children:a("hostsDialog.remark")}),n(Dr,{children:[e(ve,{ref:c,value:u.remark,onChange:y=>h(N=>({...N,remark:y.target.value}))}),e(Rr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ts,{})})]})]}),n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{isRequired:!0,children:[e(_,{children:a("hostsDialog.address")}),n(Dr,{children:[e(ve,{value:u.address,onChange:y=>h(N=>({...N,address:y.target.value}))}),e(Rr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ts,{})})]})]}),n(k,{children:[e(_,{children:a("hostsDialog.port")}),e(Nn,{value:(v=u.port)!=null?v:"",onChange:(y,N)=>h(I=>({...I,port:Number.isNaN(N)?null:N})),children:e(zn,{})})]})]}),n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("hostsDialog.path")}),e(ve,{value:u.path,onChange:y=>h(N=>({...N,path:y.target.value}))})]}),n(k,{children:[e(_,{children:a("hostsDialog.sni")}),e(ve,{value:u.sni,onChange:y=>h(N=>({...N,sni:y.target.value}))})]})]}),n(k,{children:[e(_,{children:a("hostsDialog.host")}),n(Dr,{children:[e(ve,{value:u.host,onChange:y=>h(N=>({...N,host:y.target.value}))}),e(Rr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ts,{})})]})]}),n(k,{children:[e(_,{children:a("hostsDialog.sort")}),e(Nn,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(y,N)=>h(I=>({...I,sort:Number.isNaN(N)?I.sort:N})),children:e(zn,{})})]}),e(z,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:a("hostsPage.create.sortHint",{value:(S=u.sort)!=null?S:i})})]}),n(zt,{gap:2,children:[e(H,{variant:"ghost",onClick:s,children:a("hostsPage.cancel")}),e(H,{colorScheme:"primary",onClick:m,isLoading:o,children:a("hostsPage.create.submit")})]})]})]})},Kh=()=>{var ut;const{t}=Ke(),s=Kt(),{hosts:r,fetchHosts:l,isLoading:o,isPostLoading:i,setHosts:a}=Pl(),{inbounds:c}=Ct(),[u,h]=d.exports.useState([]),m=d.exports.useRef([]),g=d.exports.useCallback(Q=>{typeof Q=="function"?h(W=>{const Se=Q(W);return m.current=Se,Se}):(m.current=Q,h(Q))},[]),[w,v]=d.exports.useState(null),[S,y]=d.exports.useState(!1),[N,I]=d.exports.useState(!1),[M,ae]=d.exports.useState(null),[b,F]=d.exports.useState(null),[C,X]=d.exports.useState(null),[Y,me]=d.exports.useState(null),O=d.exports.useRef(null),[oe,P]=d.exports.useState(!1),we=d.exports.useRef(!1),[A,De]=d.exports.useState(!1),[ee,Ae]=d.exports.useState(!1),[Re,Me]=d.exports.useState(null);d.exports.useEffect(()=>{l()},[l]),d.exports.useEffect(()=>{c.size||Vs()},[c]),d.exports.useEffect(()=>{const Q=Fh(r);g(Q)},[r,g]),d.exports.useEffect(()=>{if(Y){const Q=m.current.find(W=>W.inboundTag===Y.inboundTag&&W.data.remark.trim()===Y.remark&&W.data.address.trim()===Y.address);Q&&(v(Q.uid),me(null))}},[u,Y]),d.exports.useEffect(()=>{w&&!m.current.some(Q=>Q.uid===w)&&!Y&&v(null)},[u,w,Y]);const G=d.exports.useCallback(Q=>{we.current=Q,P(Q)},[]);d.exports.useEffect(()=>{ee||(Me(null),G(!1))},[S,ee,G]),d.exports.useEffect(()=>{if(!ee||!Re)return;const Q=new Set(m.current.map(Se=>Se.uid));Re.every(Se=>Q.has(Se.uid))||(Me(null),G(!1))},[u,ee,G,Re]);const D=d.exports.useMemo(()=>{const Q=[];return c.forEach(W=>{W.forEach(Se=>{Q.push({label:`${Se.tag} (${Se.protocol.toUpperCase()} - ${Se.network})`,value:Se.tag,protocol:Se.protocol,network:Se.network})})}),Q.sort((W,Se)=>W.label.localeCompare(Se.label))},[c]),V=d.exports.useMemo(()=>m.current.filter(Q=>!Q.data.is_disabled).sort((Q,W)=>Fr(Q.data.sort)-Fr(W.data.sort)),[u]),ge=d.exports.useMemo(()=>[...m.current].sort((Q,W)=>Fr(Q.data.sort)-Fr(W.data.sort)),[u]),pe=d.exports.useMemo(()=>S?ge:V,[V,ge,S]);d.exports.useEffect(()=>{ee&&Me(Q=>Q!=null?Q:[...V])},[V,ee]);const Z=ee?Re!=null?Re:V:pe,_e=d.exports.useMemo(()=>{const Q=new Map;return Z.forEach((W,Se)=>Q.set(W.uid,Se)),Q},[Z]),te=w&&(ut=m.current.find(Q=>Q.uid===w))!=null?ut:null,le=(Q,W,Se)=>{g(Le=>Ls(Le.map(J=>J.uid===Q?{...J,data:{...J.data,[W]:Se}}:J)))},B=(Q,W)=>{g(Se=>Ls(Se.map(Le=>Le.uid===Q?{...Le,inboundTag:W}:Le)))},L=d.exports.useCallback(async()=>{if(!ee||A)return!1;const Q=V,W=Re!=null?Re:Q;if(!(W.length!==Q.length||W.some((Ve,Ye)=>{var rt;return Ve.uid!==((rt=Q[Ye])==null?void 0:rt.uid)}))||!Re||W.length===0)return Ae(!1),Me(null),G(!1),!0;const Le=W.map(Ve=>Ve.uid),J=new Map;Le.forEach((Ve,Ye)=>J.set(Ve,Ye));const He=m.current,se=m.current.filter(Ve=>J.has(Ve.uid)).sort((Ve,Ye)=>{var rt,Je;return((rt=J.get(Ve.uid))!=null?rt:Number.MAX_SAFE_INTEGER)-((Je=J.get(Ye.uid))!=null?Je:Number.MAX_SAFE_INTEGER)}),fe=m.current.filter(Ve=>!J.has(Ve.uid)).sort((Ve,Ye)=>Fr(Ve.data.sort)-Fr(Ye.data.sort)),Ie=[...se,...fe].map((Ve,Ye)=>({...Ve,data:{...Ve.data,sort:Ye},original:{...Ve.original,sort:Ye}}));g(Ie),Me(Ie.filter(Ve=>!Ve.data.is_disabled)),De(!0);try{const Ve=Nl(Ie);return await a(Ve),await l(),G(!1),Ae(!1),Me(null),s({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{g(He);const Ye=He.filter(rt=>!rt.data.is_disabled).sort((rt,Je)=>Fr(rt.data.sort)-Fr(Je.data.sort));return Me(Ye),G(!0),s({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{De(!1)}},[g,V,l,ee,A,a,G,t,s,Re]),U=d.exports.useCallback(Q=>{if(!ee||!Q.length)return;const W=Re!=null?Re:V;!(Q.length!==W.length||Q.some((Le,J)=>{var He;return Le.uid!==((He=W[J])==null?void 0:He.uid)}))||(Me(Q),we.current||G(!0))},[V,ee,G,Re]),j=d.exports.useCallback(()=>{Me([...V]),G(!1),Ae(!0)},[V,G]),Te=d.exports.useCallback(()=>{Ae(!1),Me(null),G(!1)},[G]),qe=d.exports.useCallback(()=>{L()},[L]),Qe=async Q=>{const W=m.current.find(Se=>Se.uid===Q);if(!!W){ae(Q),me({inboundTag:W.inboundTag,remark:W.data.remark.trim(),address:W.data.address.trim()});try{const Se=qi(m.current,[W.inboundTag,W.initialInboundTag]);await a(Se),await l(),s({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"})}catch{s({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{ae(null)}}},T=Q=>{g(W=>Ls(W.map(Se=>Se.uid===Q?{...Se,inboundTag:Se.initialInboundTag,data:la(Se.original)}:Se)))},ce=(Q,W)=>{le(Q,"is_disabled",!W),W||y(!0)},$=Q=>{X(Q)},be=async()=>{if(!C)return;const Q=m.current.find(W=>W.uid===C);if(!!Q){F(C);try{const W=m.current.filter(Le=>Le.uid!==C);g(W);const Se=qi(W,[Q.inboundTag,Q.initialInboundTag]);await a(Se),await l(),s({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),w===C&&v(null)}catch{s({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{F(null),X(null)}}},dt=async Q=>{const W=m.current.length?Math.max(...m.current.map(Se=>Se.data.sort))+1:0;ae("create"),me({inboundTag:Q.inboundTag,remark:Q.remark.trim(),address:Q.address.trim()});try{const Se={uid:El(),inboundTag:Q.inboundTag,initialInboundTag:Q.inboundTag,data:{id:null,remark:Q.remark,address:Q.address,sort:Number.isFinite(Q.sort)?Q.sort:W,port:Q.port,path:Q.path,sni:Q.sni,host:Q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:Q.remark,address:Q.address,sort:Number.isFinite(Q.sort)?Q.sort:W,port:Q.port,path:Q.path,sni:Q.sni,host:Q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},Le=Ls([...m.current,Se]);g(Le);const J=qi(Le,[Q.inboundTag]);await a(J),await l(),s({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),I(!1)}catch{s({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{ae(null)}};return n(ue,{align:"stretch",spacing:4,children:[ee?n(ue,{align:"stretch",spacing:2,children:[n(R,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(p,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),n(R,{spacing:2,children:[e(H,{variant:"ghost",onClick:Te,isDisabled:A,children:t("hostsPage.cancel")}),e(H,{colorScheme:"primary",onClick:qe,isLoading:A,isDisabled:!oe&&!A,children:t("hostsPage.saveOrder")})]})]}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),A?n(R,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(At,{size:"xs"}),e(p,{children:t("hostsPage.orderSaving")})]}):oe?e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):n(R,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(R,{spacing:3,children:[e(H,{colorScheme:"primary",size:"sm",onClick:()=>I(!0),leftIcon:e(Il,{}),isDisabled:!D.length,children:t("hostsPage.addHost")}),e(mt,{isChecked:S,onChange:Q=>y(Q.target.checked),children:t("hostsPage.showDisabled")})]}),e(H,{size:"sm",variant:"outline",leftIcon:e(Tl,{}),onClick:j,isDisabled:o||!V.length,children:t("hostsPage.enterSort")})]}),o?e(R,{justify:"center",py:10,children:e(At,{})}):Z.length===0?e(z,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(p,{children:t("hostsPage.emptyState")})}):ee?e(dl.Group,{axis:"y",values:Z,onReorder:U,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:Z.map((Q,W)=>e(Bh,{host:Q,index:W},Q.uid))}):e($e,{columns:{base:1,md:2,xl:3},spacing:4,children:pe.map((Q,W)=>{var Se;return e(Hh,{host:Q,inboundOptions:D,orderIndex:(Se=_e.get(Q.uid))!=null?Se:W,onToggleActive:ce,onEdit:v,onDelete:$,saving:M===Q.uid&&i,deleting:b===Q.uid&&i},Q.uid)})}),e($h,{isOpen:N,onClose:()=>I(!1),inboundOptions:D,onSubmit:dt,isSubmitting:M==="create"&&i,defaultSort:m.current.length?Math.max(...m.current.map(Q=>Q.data.sort))+1:0}),e(Vh,{host:te,inboundOptions:D,isOpen:Boolean(te),onClose:()=>v(null),onChange:le,onChangeInbound:B,onSave:Qe,onReset:T,onDelete:$,saving:!!te&&M===te.uid&&i,deleting:!!te&&b===te.uid&&i}),e(ns,{isOpen:Boolean(C),leastDestructiveRef:O,onClose:()=>X(null),children:e(wt,{children:n(ss,{children:[e(_t,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(kt,{children:t("hostsPage.deleteConfirmation")}),n(zt,{children:[e(H,{ref:O,onClick:()=>X(null),children:t("hostsPage.cancel")}),e(H,{colorScheme:"red",onClick:be,ml:3,isLoading:Boolean(b),children:t("hostsPage.delete")})]})]})})})]})},Jh=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),uo=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(Jh(t))}catch{}return""},qh=t=>{if(typeof t!="string"||t.length===0)return"";const s=globalThis.Wireguard;if(s!=null&&s.generateKeypair)try{const r=s.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class Pr{static isEmpty(s){return s==null?!0:typeof s=="string"?s.trim().length===0:Array.isArray(s)?s.length===0:typeof s=="object"?Object.keys(s).length===0:!1}static isArrEmpty(s){return!Array.isArray(s)||s.length===0}}const he=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),Rl=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const Yh=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),Gh=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const Xh=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Yi=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class vt{static toJsonArray(s){return s.map(r=>r.toJson())}static fromJson(s){return new vt}toJson(){return{}}toString(s=!0){const r=this.toJson();return s?JSON.stringify(r,null,2):JSON.stringify(r)}}class mn extends vt{constructor(r="none",l="",o=""){super();q(this,"type");q(this,"host");q(this,"path");this.type=r,this.host=l,this.path=o}static fromJson(r={}){var o,i,a,c,u,h,m,g,w,v;const l=r==null?void 0:r.header;if(!l)return new mn;if(l.type==="http"&&l.request){const S=((i=(o=l.request)==null?void 0:o.headers)==null?void 0:i.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(c=(a=l.request)==null?void 0:a.headers)==null?void 0:c.Host)!=null?u:"",y=((h=l.request)==null?void 0:h.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(g=(m=l.request)==null?void 0:m.path)!=null?g:"";return new mn((w=l.type)!=null?w:"http",S,y)}return new mn((v=l.type)!=null?v:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:Pr.isEmpty(this.host)?[]:this.host.split(",")},path:Pr.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class as extends vt{constructor(r=1350,l=50,o=5,i=20,a=!1,c=2,u=2,h="none",m=""){super();q(this,"mtu");q(this,"tti");q(this,"upCap");q(this,"downCap");q(this,"congestion");q(this,"readBuffer");q(this,"writeBuffer");q(this,"type");q(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=o!=null?o:5,this.downCap=i!=null?i:20,this.congestion=Boolean(a),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=h!=null?h:"none",this.seed=m!=null?m:""}static fromJson(r={}){var l,o,i;return new as(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(o=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?o:"none",(i=r==null?void 0:r.seed)!=null?i:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class Ln extends vt{constructor(r="/",l="",o=0){super();q(this,"path");q(this,"host");q(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=o!=null?o:0}static fromJson(r={}){var l,o,i;return new Ln((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.heartbeatPeriod)!=null?i:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class Un extends vt{constructor(r="",l="",o=!1){super();q(this,"serviceName");q(this,"authority");q(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(o)}static fromJson(r={}){var l,o;return new Un((l=r==null?void 0:r.serviceName)!=null?l:"",(o=r==null?void 0:r.authority)!=null?o:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class os extends vt{constructor(r="/",l=""){super();q(this,"path");q(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,o;return new os((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"")}toJson(){return{path:this.path,host:this.host}}}class ls extends vt{constructor(r="/",l="",o="",i=!1,a="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,h,m,g,w,v;super();q(this,"path");q(this,"host");q(this,"mode");q(this,"noGRPCHeader");q(this,"scMinPostsIntervalMs");q(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=o!=null?o:"",this.noGRPCHeader=Boolean(i),this.scMinPostsIntervalMs=a!=null?a:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(h=c==null?void 0:c.maxConnections)!=null?h:0,cMaxReuseTimes:(m=c==null?void 0:c.cMaxReuseTimes)!=null?m:0,hMaxRequestTimes:(g=c==null?void 0:c.hMaxRequestTimes)!=null?g:"600-900",hMaxReusableSecs:(w=c==null?void 0:c.hMaxReusableSecs)!=null?w:"1800-3000",hKeepAlivePeriod:(v=c==null?void 0:c.hKeepAlivePeriod)!=null?v:0}}static fromJson(r={}){var l,o,i,a;return new ls((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.mode)!=null?i:"",Boolean(r==null?void 0:r.noGRPCHeader),(a=r==null?void 0:r.scMinPostsIntervalMs)!=null?a:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class On extends vt{constructor(r="",l=[],o="",i=!1,a=""){super();q(this,"serverName");q(this,"alpn");q(this,"fingerprint");q(this,"allowInsecure");q(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=o!=null?o:"",this.allowInsecure=Boolean(i),this.echConfigList=a!=null?a:""}static fromJson(r={}){var l,o,i;return new On((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(o=r==null?void 0:r.fingerprint)!=null?o:"",Boolean(r==null?void 0:r.allowInsecure),(i=r==null?void 0:r.echConfigList)!=null?i:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class cs extends vt{constructor(r="",l="",o="",i="",a="",c=""){super();q(this,"publicKey");q(this,"fingerprint");q(this,"serverName");q(this,"shortId");q(this,"spiderX");q(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=o!=null?o:"",this.shortId=i!=null?i:"",this.spiderX=a!=null?a:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var l,o,i,a,c,u;return new cs((l=r==null?void 0:r.publicKey)!=null?l:"",(o=r==null?void 0:r.fingerprint)!=null?o:"",(i=r==null?void 0:r.serverName)!=null?i:"",(a=r==null?void 0:r.shortId)!=null?a:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class $s extends vt{constructor(r="",l=!1,o=0,i=!1,a=!1,c=Yi.NONE){super();q(this,"dialerProxy");q(this,"tcpFastOpen");q(this,"tcpKeepAliveInterval");q(this,"tcpMptcp");q(this,"penetrate");q(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=o!=null?o:0,this.tcpMptcp=Boolean(i),this.penetrate=Boolean(a),this.addressPortStrategy=c!=null?c:Yi.NONE}static fromJson(r={}){var l,o,i;return!r||Object.keys(r).length===0?new $s:new $s((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(o=r==null?void 0:r.tcpKeepAliveInterval)!=null?o:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(i=r==null?void 0:r.addressPortStrategy)!=null?i:Yi.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class Sn extends vt{constructor(r="tcp",l="none",o=new On,i=new cs,a=new mn,c=new as,u=new Ln,h=new Un,m=new os,g=new ls,w){super();q(this,"network");q(this,"security");q(this,"tls");q(this,"reality");q(this,"tcp");q(this,"kcp");q(this,"ws");q(this,"grpc");q(this,"httpupgrade");q(this,"xhttp");q(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=o,this.reality=i,this.tcp=a,this.kcp=c,this.ws=u,this.grpc=h,this.httpupgrade=m,this.xhttp=g,this.sockopt=w}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new $s:void 0}static fromJson(r={}){var l,o;return new Sn((l=r==null?void 0:r.network)!=null?l:"tcp",(o=r==null?void 0:r.security)!=null?o:"none",On.fromJson(r==null?void 0:r.tlsSettings),cs.fromJson(r==null?void 0:r.realitySettings),mn.fromJson(r==null?void 0:r.tcpSettings),as.fromJson(r==null?void 0:r.kcpSettings),Ln.fromJson(r==null?void 0:r.wsSettings),Un.fromJson(r==null?void 0:r.grpcSettings),os.fromJson(r==null?void 0:r.httpupgradeSettings),ls.fromJson(r==null?void 0:r.xhttpSettings),$s.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class Ks extends vt{constructor(r=!1,l=8,o=16,i="reject"){super();q(this,"enabled");q(this,"concurrency");q(this,"xudpConcurrency");q(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=o!=null?o:16,this.xudpProxyUDP443=i!=null?i:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new Ks:new Ks(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var hn,Kr;const je=class extends vt{constructor(r="",l=he.VLESS,o=je.Settings.getSettings(he.VLESS),i=new Sn,a,c=new Ks){super();q(this,"tag");q(this,"_protocol");q(this,"settings");q(this,"stream");q(this,"sendThrough");q(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:he.VLESS,this.settings=o!=null?o:je.Settings.getSettings(this._protocol),this.stream=i,this.sendThrough=a,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=je.Settings.getSettings(r),this.stream=new Sn}canEnableTls(){return[he.VMess,he.VLESS,he.Trojan,he.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===he.VLESS:!1}canEnableReality(){return[he.VLESS,he.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[he.VMess,he.VLESS,he.Trojan,he.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[he.VMess,he.VLESS,he.Trojan,he.Shadowsocks,he.HTTP,he.Socks].includes(this.protocol)}hasVnext(){return[he.VMess,he.VLESS].includes(this.protocol)}hasServers(){return[he.Trojan,he.Shadowsocks,he.Socks,he.HTTP].includes(this.protocol)}hasAddressPort(){return[he.DNS,he.VMess,he.VLESS,he.Trojan,he.Shadowsocks,he.Socks,he.HTTP].includes(this.protocol)}hasUsername(){return[he.Socks,he.HTTP].includes(this.protocol)}static fromJson(r={}){var l,o,i,a;return new je((l=r==null?void 0:r.tag)!=null?l:"",(o=r==null?void 0:r.protocol)!=null?o:he.VLESS,je.Settings.fromProtocol((i=r==null?void 0:r.protocol)!=null?i:he.VLESS,r==null?void 0:r.settings),Sn.fromJson(r==null?void 0:r.streamSettings),(a=r==null?void 0:r.sendThrough)!=null?a:"",Ks.fromJson(r==null?void 0:r.mux))}toJson(){var l,o;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof vt?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(o=this.mux)!=null&&o.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const o=l[0].toLowerCase();try{switch(o){case he.VMess:return je.fromVmessLink(JSON.parse(uo(l[1])));case he.VLESS:case he.Trojan:case"ss":return je.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var a,c,u,h,m,g,w,v,S,y,N,I,M,ae,b,F,C,X,Y,me,O,oe,P;if(!r)return null;const l=new Sn((a=r==null?void 0:r.net)!=null?a:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),o=r==null?void 0:r.net;o==="tcp"?l.tcp=new mn((u=r==null?void 0:r.type)!=null?u:"none",(h=r==null?void 0:r.host)!=null?h:"",(m=r==null?void 0:r.path)!=null?m:""):o==="kcp"?(l.kcp=new as,l.kcp.type=(g=r==null?void 0:r.type)!=null?g:"none",l.kcp.seed=(w=r==null?void 0:r.path)!=null?w:""):o==="ws"?l.ws=new Ln((v=r==null?void 0:r.path)!=null?v:"/",(S=r==null?void 0:r.host)!=null?S:""):o==="grpc"?l.grpc=new Un((y=r==null?void 0:r.path)!=null?y:"",(N=r==null?void 0:r.authority)!=null?N:"",(r==null?void 0:r.type)==="multi"):o==="httpupgrade"?l.httpupgrade=new os((I=r==null?void 0:r.path)!=null?I:"/",(M=r==null?void 0:r.host)!=null?M:""):o==="xhttp"&&(l.xhttp=new ls((ae=r==null?void 0:r.path)!=null?ae:"/",(b=r==null?void 0:r.host)!=null?b:"",(F=r==null?void 0:r.mode)!=null?F:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new On((C=r==null?void 0:r.sni)!=null?C:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(X=r==null?void 0:r.fp)!=null?X:"",Boolean(r==null?void 0:r.allowInsecure)));const i=Number((Y=r==null?void 0:r.port)!=null?Y:0);return Number.isNaN(i)?null:new je((me=r==null?void 0:r.ps)!=null?me:"",he.VMess,new je.VmessSettings((O=r==null?void 0:r.add)!=null?O:"",i,(oe=r==null?void 0:r.id)!=null?oe:"",(P=r==null?void 0:r.scy)!=null?P:""),l)}static fromParamLink(r){var F,C,X,Y,me,O,oe,P,we,A,De,ee,Ae,Re,Me,G,D,V,ge,pe,Z;let l;try{l=new URL(r)}catch{return null}const o=(F=l.searchParams.get("type"))!=null?F:"tcp",i=(C=l.searchParams.get("security"))!=null?C:"none",a=new Sn(o,i),c=(X=l.searchParams.get("headerType"))!=null?X:void 0,u=(Y=l.searchParams.get("host"))!=null?Y:void 0,h=(me=l.searchParams.get("path"))!=null?me:void 0,m=(O=l.searchParams.get("mode"))!=null?O:void 0;if(o==="tcp"||o==="none"?a.tcp=new mn(c!=null?c:"none",u!=null?u:"",h!=null?h:""):o==="kcp"?(a.kcp=new as,a.kcp.type=c!=null?c:"none",a.kcp.seed=h!=null?h:""):o==="ws"?a.ws=new Ln(h!=null?h:"/",u!=null?u:""):o==="grpc"?a.grpc=new Un((oe=l.searchParams.get("serviceName"))!=null?oe:"",(P=l.searchParams.get("authority"))!=null?P:"",l.searchParams.get("mode")==="multi"):o==="httpupgrade"?a.httpupgrade=new os(h!=null?h:"/",u!=null?u:""):o==="xhttp"&&(a.xhttp=new ls(h!=null?h:"/",u!=null?u:"",m!=null?m:"")),i==="tls"){const _e=(we=l.searchParams.get("fp"))!=null?we:"none",te=l.searchParams.get("alpn"),le=l.searchParams.get("allowInsecure"),B=(A=l.searchParams.get("sni"))!=null?A:"",L=(De=l.searchParams.get("ech"))!=null?De:"";a.tls=new On(B,te?te.split(","):[],_e,le==="1",L)}if(i==="reality"){const _e=(ee=l.searchParams.get("pbk"))!=null?ee:"",te=(Ae=l.searchParams.get("fp"))!=null?Ae:"",le=(Re=l.searchParams.get("sni"))!=null?Re:"",B=(Me=l.searchParams.get("sid"))!=null?Me:"",L=(G=l.searchParams.get("spx"))!=null?G:"",U=(D=l.searchParams.get("pqv"))!=null?D:"";a.reality=new cs(_e,te,le,B,L,U)}const g=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,w=r.match(g);if(!w)return null;let[,v,S,y,N]=w,I=Number(N);Number.isNaN(I)&&(I=0),v==="ss"&&(v=he.Shadowsocks,S=uo(S));let M=null;switch(v){case he.VLESS:{const _e=(V=l.searchParams.get("encryption"))!=null?V:"none";M=new je.VLESSSettings(y,I,S,(ge=l.searchParams.get("flow"))!=null?ge:"",_e);break}case he.Trojan:M=new je.TrojanSettings(y,I,S);break;case he.Shadowsocks:{const _e=S.split(":"),te=(pe=_e.shift())!=null?pe:"";M=new je.ShadowsocksSettings(y,I,_e.join(":"),te,!0);break}default:return null}const ae=decodeURIComponent((Z=l.hash)!=null?Z:""),b=ae.length>1?ae.substring(1):`out-${v}-${I}`;return new je(b,v,M,a)}};let Qt=je;q(Qt,"Settings",class extends vt{constructor(o){super();q(this,"protocol");this.protocol=o}static getSettings(o){switch(o){case he.Freedom:return new je.FreedomSettings;case he.Blackhole:return new je.BlackholeSettings;case he.DNS:return new je.DNSSettings;case he.VMess:return new je.VmessSettings;case he.VLESS:return new je.VLESSSettings;case he.Trojan:return new je.TrojanSettings;case he.Shadowsocks:return new je.ShadowsocksSettings;case he.Socks:return new je.SocksSettings;case he.HTTP:return new je.HttpSettings;case he.Wireguard:return new je.WireguardSettings;default:return null}}static fromProtocol(o,i){switch(o){case he.Freedom:return je.FreedomSettings.fromJson(i);case he.Blackhole:return je.BlackholeSettings.fromJson(i);case he.DNS:return je.DNSSettings.fromJson(i);case he.VMess:return je.VmessSettings.fromJson(i);case he.VLESS:return je.VLESSSettings.fromJson(i);case he.Trojan:return je.TrojanSettings.fromJson(i);case he.Shadowsocks:return je.ShadowsocksSettings.fromJson(i);case he.Socks:return je.SocksSettings.fromJson(i);case he.HTTP:return je.HttpSettings.fromJson(i);case he.Wireguard:return je.WireguardSettings.fromJson(i);default:return null}}toJson(){return{}}}),q(Qt,"FreedomSettings",(hn=class extends vt{constructor(o="",i="",a={},c=[]){super();q(this,"domainStrategy");q(this,"redirect");q(this,"fragment");q(this,"noises");this.domainStrategy=o!=null?o:"",this.redirect=i!=null?i:"",this.fragment=a!=null?a:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new je.FreedomSettings.Noise)}delNoise(o){this.noises.splice(o,1)}static fromJson(o={}){var i,a;return new hn((i=o==null?void 0:o.domainStrategy)!=null?i:"",(a=o==null?void 0:o.redirect)!=null?a:"",o!=null&&o.fragment?hn.Fragment.fromJson(o.fragment):{},Array.isArray(o==null?void 0:o.noises)?o.noises.map(c=>hn.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:Pr.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:Pr.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:vt.toJsonArray(this.noises)}}},q(hn,"Fragment",class Ml extends vt{constructor(a="1-3",c="",u="",h=""){super();q(this,"packets");q(this,"length");q(this,"interval");q(this,"maxSplit");this.packets=a!=null?a:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=h!=null?h:""}static fromJson(a={}){var c,u,h,m;return new Ml((c=a==null?void 0:a.packets)!=null?c:"1-3",(u=a==null?void 0:a.length)!=null?u:"",(h=a==null?void 0:a.interval)!=null?h:"",(m=a==null?void 0:a.maxSplit)!=null?m:"")}}),q(hn,"Noise",class Ll extends vt{constructor(a="rand",c="10-20",u="10-16",h="ip"){super();q(this,"type");q(this,"packet");q(this,"delay");q(this,"applyTo");this.type=a!=null?a:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=h!=null?h:"ip"}static fromJson(a={}){var c,u,h,m;return new Ll((c=a==null?void 0:a.type)!=null?c:"rand",(u=a==null?void 0:a.packet)!=null?u:"10-20",(h=a==null?void 0:a.delay)!=null?h:"10-16",(m=a==null?void 0:a.applyTo)!=null?m:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),hn)),q(Qt,"BlackholeSettings",class Ul extends vt{constructor(o){super();q(this,"type");this.type=o}static fromJson(o={}){var i;return new Ul((i=o==null?void 0:o.response)==null?void 0:i.type)}toJson(){return{response:Pr.isEmpty(this.type)?void 0:{type:this.type}}}}),q(Qt,"DNSSettings",class Ol extends vt{constructor(o="udp",i="",a=53,c="reject",u=[]){super();q(this,"network");q(this,"address");q(this,"port");q(this,"nonIPQuery");q(this,"blockTypes");this.network=o!=null?o:"udp",this.address=i!=null?i:"",this.port=a!=null?a:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(o={}){var i,a,c,u;return new Ol((i=o==null?void 0:o.network)!=null?i:"udp",(a=o==null?void 0:o.address)!=null?a:"",(c=o==null?void 0:o.port)!=null?c:53,(u=o==null?void 0:o.nonIPQuery)!=null?u:"reject",Array.isArray(o==null?void 0:o.blockTypes)?o.blockTypes:[])}}),q(Qt,"VmessSettings",class extends vt{constructor(o="",i=0,a="",c=""){super();q(this,"address");q(this,"port");q(this,"id");q(this,"security");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.security=c!=null?c:""}static fromJson(o={}){var c,u,h,m;if(Pr.isArrEmpty(o==null?void 0:o.vnext))return new je.VmessSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new je.VmessSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(h=a==null?void 0:a.id)!=null?h:"",(m=a==null?void 0:a.security)!=null?m:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),q(Qt,"VLESSSettings",class extends vt{constructor(o="",i=0,a="",c="",u=""){super();q(this,"address");q(this,"port");q(this,"id");q(this,"flow");q(this,"encryption");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(o={}){var c,u,h,m,g;if(Pr.isArrEmpty(o==null?void 0:o.vnext))return new je.VLESSSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new je.VLESSSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(h=a==null?void 0:a.id)!=null?h:"",(m=a==null?void 0:a.flow)!=null?m:"",(g=a==null?void 0:a.encryption)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),q(Qt,"TrojanSettings",class extends vt{constructor(o="",i=0,a=""){super();q(this,"address");q(this,"port");q(this,"password");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:""}static fromJson(o={}){var a,c,u;if(Pr.isArrEmpty(o==null?void 0:o.servers))return new je.TrojanSettings;const i=o.servers[0];return new je.TrojanSettings((a=i==null?void 0:i.address)!=null?a:"",(c=i==null?void 0:i.port)!=null?c:0,(u=i==null?void 0:i.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),q(Qt,"ShadowsocksSettings",class extends vt{constructor(o="",i=0,a="",c="",u,h){super();q(this,"address");q(this,"port");q(this,"password");q(this,"method");q(this,"uot");q(this,"UoTVersion");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=h}static fromJson(o={}){var c,u,h,m;let i=o==null?void 0:o.servers;Pr.isArrEmpty(i)&&(i=[{}]);const a=i[0];return new je.ShadowsocksSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(h=a==null?void 0:a.password)!=null?h:"",(m=a==null?void 0:a.method)!=null?m:"",a==null?void 0:a.uot,a==null?void 0:a.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),q(Qt,"SocksSettings",class extends vt{constructor(o="",i=0,a="",c=""){super();q(this,"address");q(this,"port");q(this,"user");q(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,h,m,g;let i=o==null?void 0:o.servers;Pr.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new je.SocksSettings((u=a==null?void 0:a.address)!=null?u:"",(h=a==null?void 0:a.port)!=null?h:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Pr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),q(Qt,"HttpSettings",class extends vt{constructor(o="",i=0,a="",c=""){super();q(this,"address");q(this,"port");q(this,"user");q(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,h,m,g;let i=o==null?void 0:o.servers;Pr.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new je.HttpSettings((u=a==null?void 0:a.address)!=null?u:"",(h=a==null?void 0:a.port)!=null?h:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Pr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),q(Qt,"WireguardSettings",(Kr=class extends vt{constructor(o=1420,i="",a=[""],c=2,u="",h="",m=[new Kr.Peer],g=!1){super();q(this,"mtu");q(this,"secretKey");q(this,"pubKey");q(this,"address");q(this,"workers");q(this,"domainStrategy");q(this,"reserved");q(this,"peers");q(this,"noKernelTun");this.mtu=o!=null?o:1420,this.secretKey=i!=null?i:"",this.pubKey=this.secretKey.length>0?qh(this.secretKey):"",this.address=Array.isArray(a)?a.join(","):a!=null?a:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(h)?h.join(","):h!=null?h:"",this.peers=m!=null?m:[new Kr.Peer],this.noKernelTun=Boolean(g)}addPeer(){this.peers.push(new Kr.Peer)}delPeer(o){this.peers.splice(o,1)}static fromJson(o={}){var i,a,c,u,h,m,g;return new Kr((i=o==null?void 0:o.mtu)!=null?i:1420,(a=o==null?void 0:o.secretKey)!=null?a:"",(c=o==null?void 0:o.address)!=null?c:[""],(u=o==null?void 0:o.workers)!=null?u:2,(h=o==null?void 0:o.domainStrategy)!=null?h:"",(m=o==null?void 0:o.reserved)!=null?m:"",Array.isArray(o==null?void 0:o.peers)?o.peers.map(w=>Kr.Peer.fromJson(w)):[new Kr.Peer],(g=o==null?void 0:o.noKernelTun)!=null?g:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:Xh.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(o=>Number(o)).filter(o=>!Number.isNaN(o)):void 0,peers:vt.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},q(Kr,"Peer",class extends vt{constructor(a="",c="",u=["0.0.0.0/0","::/0"],h="",m=0){super();q(this,"publicKey");q(this,"psk");q(this,"allowedIPs");q(this,"endpoint");q(this,"keepAlive");this.publicKey=a!=null?a:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=h!=null?h:"",this.keepAlive=m!=null?m:0}static fromJson(a={}){var c,u,h,m;return new je.WireguardSettings.Peer((c=a==null?void 0:a.publicKey)!=null?c:"",(u=a==null?void 0:a.preSharedKey)!=null?u:"",Array.isArray(a==null?void 0:a.allowedIPs)?a.allowedIPs:["0.0.0.0/0","::/0"],(h=a==null?void 0:a.endpoint)!=null?h:"",(m=a==null?void 0:a.keepAlive)!=null?m:0)}toJson(){var a;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(a=this.allowedIPs)!=null&&a.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),Kr));class Tn{static sizeFormat(s){if(s<=0||Number.isNaN(s))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,o=s;for(;o>=1024&&l<r.length-1;)o/=1024,l++;return`${o.toFixed(2)} ${r[l]}`}}const Qh=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(Gh);const Zh=Object.values(Yh),Da=["vmess","vless","trojan","shadowsocks","http","socks"],jh=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp","xhttp"],ep=["none","tls","reality"],Gi=t=>t.split(/[\n,]/).map(s=>s.trim()).filter(Boolean),Xi=t=>t&&t.length?t.join(`
`):"",Kn=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",Wl=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),tp=t=>{if(!t)return 0;const s=Number(t);return!Number.isNaN(s)&&s>0?s:t.trim()},vr=t=>(Object.keys(t).forEach(s=>{const r=t[s];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[s]}),t),ho=()=>({user:"",pass:""}),ca=()=>({name:"",value:""}),po=t=>{var s,r;return{user:(s=t==null?void 0:t.user)!=null?s:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},mo=t=>{var s,r;return vr({user:(s=t.user)==null?void 0:s.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},Pn=t=>{if(t===""||t===null||typeof t>"u")return;const s=Number(t);return Number.isFinite(s)?s:void 0},rp=t=>{if(!t.sockoptEnabled)return;const s=t.sockopt,r={acceptProxyProtocol:s.acceptProxyProtocol,tcpFastOpen:s.tcpFastOpen,mark:Pn(s.mark),tproxy:s.tproxy||void 0,tcpMptcp:s.tcpMptcp,penetrate:s.penetrate,domainStrategy:s.domainStrategy||void 0,tcpMaxSeg:Pn(s.tcpMaxSeg),dialerProxy:s.dialerProxy||void 0,tcpKeepAliveInterval:Pn(s.tcpKeepAliveInterval),tcpKeepAliveIdle:Pn(s.tcpKeepAliveIdle),tcpUserTimeout:Pn(s.tcpUserTimeout),tcpcongestion:s.tcpcongestion||void 0,V6Only:s.V6Only,tcpWindowClamp:Pn(s.tcpWindowClamp),interface:s.interfaceName||void 0};return vr(r)},da=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",tlsRawSettings:{},realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",xhttpHost:"",xhttpPath:"/",xhttpHeaders:[ca()],xhttpMode:"auto",xhttpScMaxBufferedPosts:"30",xhttpScMaxEachPostBytes:"1000000",xhttpScStreamUpServerSecs:"20-80",xhttpPaddingBytes:"100-1000",xhttpNoSSEHeader:!1,vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:Wl(),httpAccounts:[ho()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[ho()],socksUdpEnabled:!1,socksUdpIp:""}),np=t=>{var s,r,l,o,i,a,c;return{dest:(r=(s=t==null?void 0:t.dest)==null?void 0:s.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(o=t==null?void 0:t.type)!=null?o:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(i=t==null?void 0:t.alpn)!=null?i:"",xver:(c=(a=t==null?void 0:t.xver)==null?void 0:a.toString())!=null?c:""}},go=t=>{var r,l,o;const s={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(o=t.type)==null?void 0:o.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(s.alpn=t.alpn.split(",").map(i=>i.trim()).filter(Boolean)),vr(s)},sp=t=>{var h,m,g,w,v,S,y,N,I,M,ae,b,F,C,X,Y,me,O,oe,P,we,A,De,ee,Ae,Re,Me,G,D,V,ge,pe,Z,_e,te,le,B,L,U,j,Te,qe,Qe,T,ce,$,be,dt,ut,Q,W,Se,Le,J,He,se,fe,Ie,Ve,Ye,rt,Je,Ze,Wt,xt,sr,br,ir,ar,or,tr,lr,cr,re,ke,K,E,Ee,Be,Oe,We,ht,ot,Tt,Yt,Gt,dr,Lr;const s=Da.includes(t.protocol)?t.protocol:"vless",r=da(s),l=(h=t.settings)!=null?h:{},o=(m=t.sniffing)!=null?m:{},i=(g=t.streamSettings)!=null?g:{},a=(w=i.tlsSettings)!=null?w:{},c=i.tlsSettings!==void 0&&i.tlsSettings!==null?JSON.parse(JSON.stringify(i.tlsSettings)):{},u=(v=i.realitySettings)!=null?v:{};return{...r,tag:(S=t.tag)!=null?S:"",listen:(y=t.listen)!=null?y:"",port:(I=(N=t.port)==null?void 0:N.toString())!=null?I:"",disableInsecureEncryption:Boolean((M=l.disableInsecureEncryption)!=null?M:r.disableInsecureEncryption),vlessDecryption:(ae=l.decryption)!=null?ae:r.vlessDecryption,vlessEncryption:(b=l.encryption)!=null?b:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map(lt=>np(lt)):r.fallbacks,shadowsocksNetwork:(F=l.network)!=null?F:r.shadowsocksNetwork,sniffingEnabled:Boolean((C=o.enabled)!=null?C:r.sniffingEnabled),sniffingDestinations:Array.isArray(o.destOverride)&&o.destOverride.length?o.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((X=o.routeOnly)!=null?X:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((Y=o.metadataOnly)!=null?Y:r.sniffingMetadataOnly),streamNetwork:(me=i.network)!=null?me:r.streamNetwork,streamSecurity:(O=i.security)!=null?O:r.streamSecurity,tlsServerName:(oe=a.serverName)!=null?oe:r.tlsServerName,tlsAlpn:Array.isArray(a.alpn)?a.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((P=a.allowInsecure)!=null?P:r.tlsAllowInsecure),tlsFingerprint:(we=a.fingerprint)!=null?we:r.tlsFingerprint,tlsRawSettings:c,realityPrivateKey:(A=u.privateKey)!=null?A:r.realityPrivateKey,realityServerNames:Xi(u.serverNames),realityShortIds:Xi(u.shortIds),realityDest:(De=u.dest)!=null?De:r.realityDest,realitySpiderX:(ee=u.spiderX)!=null?ee:r.realitySpiderX,realityXver:(Re=(Ae=u.xver)==null?void 0:Ae.toString())!=null?Re:r.realityXver,wsPath:(G=(Me=i==null?void 0:i.wsSettings)==null?void 0:Me.path)!=null?G:r.wsPath,wsHost:(ge=(V=(D=i==null?void 0:i.wsSettings)==null?void 0:D.headers)==null?void 0:V.Host)!=null?ge:r.wsHost,tcpHeaderType:(_e=(Z=(pe=i==null?void 0:i.tcpSettings)==null?void 0:pe.header)==null?void 0:Z.type)!=null?_e:r.tcpHeaderType,tcpHttpHosts:Xi((L=(B=(le=(te=i==null?void 0:i.tcpSettings)==null?void 0:te.header)==null?void 0:le.request)==null?void 0:B.headers)==null?void 0:L.Host),tcpHttpPath:Array.isArray((Te=(j=(U=i==null?void 0:i.tcpSettings)==null?void 0:U.header)==null?void 0:j.request)==null?void 0:Te.path)?i.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(Qe=(qe=i==null?void 0:i.grpcSettings)==null?void 0:qe.serviceName)!=null?Qe:r.grpcServiceName,grpcAuthority:(ce=(T=i==null?void 0:i.grpcSettings)==null?void 0:T.authority)!=null?ce:r.grpcAuthority,grpcMultiMode:Boolean((be=($=i==null?void 0:i.grpcSettings)==null?void 0:$.multiMode)!=null?be:r.grpcMultiMode),kcpHeaderType:(Q=(ut=(dt=i==null?void 0:i.kcpSettings)==null?void 0:dt.header)==null?void 0:ut.type)!=null?Q:r.kcpHeaderType,kcpSeed:(Se=(W=i==null?void 0:i.kcpSettings)==null?void 0:W.seed)!=null?Se:r.kcpSeed,quicSecurity:(J=(Le=i==null?void 0:i.quicSettings)==null?void 0:Le.security)!=null?J:r.quicSecurity,quicKey:(se=(He=i==null?void 0:i.quicSettings)==null?void 0:He.key)!=null?se:r.quicKey,quicHeaderType:(Ve=(Ie=(fe=i==null?void 0:i.quicSettings)==null?void 0:fe.header)==null?void 0:Ie.type)!=null?Ve:r.quicHeaderType,httpupgradePath:(rt=(Ye=i==null?void 0:i.httpupgradeSettings)==null?void 0:Ye.path)!=null?rt:r.httpupgradePath,httpupgradeHost:(Ze=(Je=i==null?void 0:i.httpupgradeSettings)==null?void 0:Je.host)!=null?Ze:r.httpupgradeHost,splithttpPath:(xt=(Wt=i==null?void 0:i.splithttpSettings)==null?void 0:Wt.path)!=null?xt:r.splithttpPath,splithttpHost:(br=(sr=i==null?void 0:i.splithttpSettings)==null?void 0:sr.host)!=null?br:r.splithttpHost,xhttpHost:(ar=(ir=i==null?void 0:i.xhttpSettings)==null?void 0:ir.host)!=null?ar:r.xhttpHost,xhttpPath:(tr=(or=i==null?void 0:i.xhttpSettings)==null?void 0:or.path)!=null?tr:r.xhttpPath,xhttpHeaders:(lr=i==null?void 0:i.xhttpSettings)!=null&&lr.headers?lp(i.xhttpSettings.headers):r.xhttpHeaders,xhttpMode:(re=(cr=i==null?void 0:i.xhttpSettings)==null?void 0:cr.mode)!=null?re:r.xhttpMode,xhttpScMaxBufferedPosts:(E=(K=(ke=i==null?void 0:i.xhttpSettings)==null?void 0:ke.scMaxBufferedPosts)==null?void 0:K.toString())!=null?E:r.xhttpScMaxBufferedPosts,xhttpScMaxEachPostBytes:(Oe=(Be=(Ee=i==null?void 0:i.xhttpSettings)==null?void 0:Ee.scMaxEachPostBytes)==null?void 0:Be.toString())!=null?Oe:r.xhttpScMaxEachPostBytes,xhttpScStreamUpServerSecs:(ot=(ht=(We=i==null?void 0:i.xhttpSettings)==null?void 0:We.scStreamUpServerSecs)==null?void 0:ht.toString())!=null?ot:r.xhttpScStreamUpServerSecs,xhttpPaddingBytes:(Yt=(Tt=i==null?void 0:i.xhttpSettings)==null?void 0:Tt.xPaddingBytes)!=null?Yt:r.xhttpPaddingBytes,xhttpNoSSEHeader:Boolean((dr=(Gt=i==null?void 0:i.xhttpSettings)==null?void 0:Gt.noSSEHeader)!=null?dr:r.xhttpNoSSEHeader),vlessSelectedAuth:(Lr=l.selectedAuth)!=null?Lr:r.vlessSelectedAuth,sockoptEnabled:Boolean(i==null?void 0:i.sockopt),sockopt:(()=>{var Nt,ur,hr,Ur,Zt,pr;const lt=Wl(),Pt=(Nt=i==null?void 0:i.sockopt)!=null?Nt:{};return lt.acceptProxyProtocol=Boolean(Pt.acceptProxyProtocol),lt.tcpFastOpen=Boolean(Pt.tcpFastOpen),lt.mark=Kn(Pt.mark),lt.tproxy=(ur=Pt.tproxy)!=null?ur:lt.tproxy,lt.tcpMptcp=Boolean(Pt.tcpMptcp),lt.penetrate=Boolean(Pt.penetrate),lt.domainStrategy=(hr=Pt.domainStrategy)!=null?hr:lt.domainStrategy,lt.tcpMaxSeg=Kn(Pt.tcpMaxSeg),lt.dialerProxy=(Ur=Pt.dialerProxy)!=null?Ur:lt.dialerProxy,lt.tcpKeepAliveInterval=Kn(Pt.tcpKeepAliveInterval),lt.tcpKeepAliveIdle=Kn(Pt.tcpKeepAliveIdle),lt.tcpUserTimeout=Kn(Pt.tcpUserTimeout),lt.tcpcongestion=(Zt=Pt.tcpcongestion)!=null?Zt:lt.tcpcongestion,lt.V6Only=Boolean(Pt.V6Only),lt.tcpWindowClamp=Kn(Pt.tcpWindowClamp),lt.interfaceName=(pr=Pt.interface)!=null?pr:lt.interfaceName,lt})(),httpAccounts:s==="http"&&Array.isArray(l.accounts)?l.accounts.map(lt=>po(lt)):r.httpAccounts,httpAllowTransparent:s==="http"&&typeof l.allowTransparent=="boolean"?l.allowTransparent:r.httpAllowTransparent,socksAuth:s==="socks"&&l.auth==="password"?"password":r.socksAuth,socksAccounts:s==="socks"&&Array.isArray(l.accounts)?l.accounts.map(lt=>po(lt)):r.socksAccounts,socksUdpEnabled:s==="socks"&&typeof l.udp=="boolean"?l.udp:r.socksUdpEnabled,socksUdpIp:s==="socks"&&l.ip!==void 0&&l.ip!==null?String(l.ip):r.socksUdpIp}},ip=t=>{var l,o,i,a;const s={network:t.streamNetwork,security:t.streamSecurity};if(t.streamNetwork==="ws"&&(s.wsSettings=vr({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?s.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:Gi(t.tcpHttpHosts)}:{}}}}:s.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(s.grpcSettings=vr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(s.kcpSettings=vr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(s.quicSettings=vr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(s.httpupgradeSettings=vr({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(s.splithttpSettings=vr({path:t.splithttpPath,host:t.splithttpHost})),t.streamNetwork==="xhttp"&&(s.xhttpSettings=vr({path:t.xhttpPath,host:t.xhttpHost,headers:cp(t.xhttpHeaders),mode:t.xhttpMode,scMaxBufferedPosts:Pn(t.xhttpScMaxBufferedPosts),scMaxEachPostBytes:((l=t.xhttpScMaxEachPostBytes)==null?void 0:l.trim())||void 0,scStreamUpServerSecs:((o=t.xhttpScStreamUpServerSecs)==null?void 0:o.trim())||void 0,xPaddingBytes:((i=t.xhttpPaddingBytes)==null?void 0:i.trim())||void 0,noSSEHeader:t.xhttpNoSSEHeader||void 0})),t.streamSecurity==="tls"){const c=t.tlsRawSettings&&typeof t.tlsRawSettings=="object"?{...t.tlsRawSettings}:{};c.serverName=t.tlsServerName||void 0,c.alpn=(a=t.tlsAlpn)!=null&&a.length?t.tlsAlpn:void 0,c.allowInsecure=t.tlsAllowInsecure,c.fingerprint=t.tlsFingerprint||void 0,s.tlsSettings=vr(c)}t.streamSecurity==="reality"&&(s.realitySettings=vr({privateKey:t.realityPrivateKey||void 0,serverNames:Gi(t.realityServerNames),shortIds:Gi(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=rp(t);return r&&(s.sockopt=r),vr(s)},ap=t=>{const s={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(s.clients=[]),t.protocol){case"vmess":s.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":s.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(s.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(s.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(go).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(go).filter(r=>Object.keys(r).length));break;case"shadowsocks":s.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(mo).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r),t.httpAllowTransparent&&(s.allowTransparent=!0);break}case"socks":{if(s.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(mo).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r)}s.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(s.ip=t.socksUdpIp.trim());break}}return s},op=t=>{const r=t.protocol!=="http"&&t.protocol!=="socks"?ip(t):void 0,l={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:tp(t.port),protocol:t.protocol,settings:ap(t)};return r&&(l.streamSettings=r),t.sniffingEnabled&&(l.sniffing=vr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly})),l},lp=t=>{if(!t)return[ca()];const s=[];return Object.entries(t).forEach(([r,l])=>{var o;Array.isArray(l)?l.forEach(i=>{var a;return s.push({name:r,value:(a=i==null?void 0:i.toString())!=null?a:""})}):s.push({name:r,value:(o=l==null?void 0:l.toString())!=null?o:""})}),s.length?s:[ca()]},cp=t=>{const s={};return t.forEach(({name:r,value:l})=>{const o=r==null?void 0:r.trim(),i=l==null?void 0:l.trim();!o||!i||(s[o]=i)}),Object.keys(s).length?s:void 0};class ua{static gf(s){const r=new Float64Array(16);if(s)for(let l=0;l<s.length;++l)r[l]=s[l];return r}static pack(s,r){let l;const o=this.gf(),i=this.gf();for(let a=0;a<16;++a)i[a]=r[a];this.carry(i),this.carry(i),this.carry(i);for(let a=0;a<2;++a){o[0]=i[0]-65517;for(let c=1;c<15;++c)o[c]=i[c]-65535-(o[c-1]>>16&1),o[c-1]&=65535;o[15]=i[15]-32767-(o[14]>>16&1),l=o[15]>>16&1,o[14]&=65535,this.cswap(i,o,1-l)}for(let a=0;a<16;++a)s[2*a]=i[a]&255,s[2*a+1]=i[a]>>8}static carry(s){for(let r=0;r<16;++r)s[(r+1)%16]+=(r<15?1:38)*Math.floor(s[r]/65536),s[r]&=65535}static cswap(s,r,l){const o=~(l-1);for(let i=0;i<16;++i){const a=o&(s[i]^r[i]);s[i]^=a,r[i]^=a}}static add(s,r,l){for(let o=0;o<16;++o)s[o]=r[o]+l[o]|0}static subtract(s,r,l){for(let o=0;o<16;++o)s[o]=r[o]-l[o]|0}static multmod(s,r,l){const o=new Float64Array(31);for(let i=0;i<16;++i)for(let a=0;a<16;++a)o[i+a]+=r[i]*l[a];for(let i=0;i<15;++i)o[i]+=38*o[i+16];for(let i=0;i<16;++i)s[i]=o[i];this.carry(s),this.carry(s)}static invert(s,r){const l=this.gf();for(let o=0;o<16;++o)l[o]=r[o];for(let o=253;o>=0;--o)this.multmod(l,l,l),o!==2&&o!==4&&this.multmod(l,l,r);for(let o=0;o<16;++o)s[o]=l[o]}static clamp(s){s[31]=s[31]&127|64,s[0]&=248}static generatePublicKey(s){let r;const l=new Uint8Array(32),o=this.gf([1]),i=this.gf([9]),a=this.gf(),c=this.gf([1]),u=this.gf(),h=this.gf(),m=this.gf([56129,1]),g=this.gf([9]);for(let w=0;w<32;++w)l[w]=s[w];this.clamp(l);for(let w=254;w>=0;--w)r=l[w>>>3]>>>(w&7)&1,this.cswap(o,i,r),this.cswap(a,c,r),this.add(u,o,a),this.subtract(o,o,a),this.add(a,i,c),this.subtract(i,i,c),this.multmod(c,u,u),this.multmod(h,o,o),this.multmod(o,a,o),this.multmod(a,i,u),this.add(u,o,a),this.subtract(o,o,a),this.multmod(i,o,o),this.subtract(a,c,h),this.multmod(o,a,m),this.add(o,o,c),this.multmod(a,a,o),this.multmod(o,c,h),this.multmod(c,i,g),this.multmod(i,u,u),this.cswap(o,i,r),this.cswap(a,c,r);return this.invert(a,a),this.multmod(o,o,a),this.pack(l,o),l}static generatePresharedKey(){const s=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(s),s}static generatePrivateKey(){const s=this.generatePresharedKey();return this.clamp(s),s}static encodeBase64(s,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let o=0;o<4;++o)s[o]=l[o]+65+(25-l[o]>>8&6)-(51-l[o]>>8&75)-(61-l[o]>>8&15)+(62-l[o]>>8&3)}static keyToBase64(s){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),s.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([s[r*3+0],s[r*3+1],0])),l[43]=61,Array.from(l).map(o=>String.fromCharCode(o)).join("")}static keyFromBase64(s){const r=globalThis.atob(s),l=new Uint8Array(r.length);for(let o=0;o<r.length;o++)l[o]=r.charCodeAt(o);return l}static generateKeypair(s=""){const r=s.length>0?this.keyFromBase64(s):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:s.length>0?s:this.keyToBase64(r)}}}const vi=t=>ua.generateKeypair(t!=null?t:""),dp=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:ua.generateKeypair.bind(ua)})},up=async()=>Pe("/xray/vlessenc"),et=d.exports.forwardRef((t,s)=>e(ve,{size:"sm",ref:s,...t}));et.displayName="InboundFormInput";const In=d.exports.forwardRef((t,s)=>e(st,{size:"sm",ref:s,...t}));In.displayName="InboundFormSelect";const Us=d.exports.forwardRef((t,s)=>e(Cr,{size:"sm",resize:"vertical",ref:s,...t}));Us.displayName="InboundFormTextarea";const fo=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),hp=t=>{const s=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!s)return"";const r=s.length%4;return r===0?s:`${s}${"=".repeat(4-r)}`},pp=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],mp=["bbr","cubic","reno"],gp=["off","redirect","tproxy"],fp=["auto","packet-up","stream-up","stream-one"],bp=({isOpen:t,mode:s,initialValue:r,isSubmitting:l,onClose:o,onSubmit:i})=>{var Se,Le,J,He;const{t:a}=Ke(),c=Kt(),[u,h]=d.exports.useState([]),[m,g]=d.exports.useState(!1),w=Br({defaultValues:da()}),{control:v,register:S,handleSubmit:y,reset:N,watch:I}=w,{fields:M,append:ae,remove:b}=Xn({control:v,name:"fallbacks"}),{fields:F,append:C,remove:X}=Xn({control:v,name:"httpAccounts"}),{fields:Y,append:me,remove:O}=Xn({control:v,name:"socksAccounts"}),{fields:oe,append:P,remove:we}=Xn({control:v,name:"xhttpHeaders"}),A=Jt({control:v,name:"protocol"})||I("protocol"),De=Jt({control:v,name:"streamNetwork"})||I("streamNetwork"),ee=Jt({control:v,name:"streamSecurity"})||I("streamSecurity"),Ae=(Se=Jt({control:v,name:"sniffingEnabled"}))!=null?Se:I("sniffingEnabled"),Re=Jt({control:v,name:"realityPrivateKey"})||I("realityPrivateKey"),Me=Jt({control:v,name:"tcpHeaderType"})||I("tcpHeaderType"),G=(Le=Jt({control:v,name:"sockoptEnabled"}))!=null?Le:!1,D=Jt({control:v,name:"vlessSelectedAuth"})||"",V=Jt({control:v,name:"socksAuth"})||I("socksAuth")||"noauth",ge=(He=(J=Jt({control:v,name:"socksUdpEnabled"}))!=null?J:I("socksUdpEnabled"))!=null?He:!1,pe=Jt({control:v,name:"xhttpMode"})||I("xhttpMode")||"auto",Z=A!=="http"&&A!=="socks",_e=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),te=d.exports.useMemo(()=>{const se=[..._e,...u.map(Ie=>Ie.label)].filter(Boolean);return Array.from(new Set(se)).map(Ie=>({label:Ie,value:Ie}))},[_e,u]);d.exports.useEffect(()=>{if(t)if(r){const se=sp(r);N(se)}else N(da())},[r,N,t]);const le=d.exports.useCallback((se,fe)=>n(k,{children:[e(_,{children:fe}),e(ft,{control:v,name:`sockopt.${se}`,render:({field:Ie})=>{const Ve=typeof Ie.value=="number"||typeof Ie.value=="string"?Ie.value:void 0;return e(Nn,{min:0,value:Ve!=null?Ve:"",onChange:Ye=>Ie.onChange(Ye),children:e(zn,{})})}})]}),[v]),B=d.exports.useCallback((se,fe)=>n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:fe}),e(ft,{control:v,name:`sockopt.${se}`,render:({field:Ie})=>e(mt,{isChecked:typeof Ie.value=="boolean"?Ie.value:Boolean(Ie.value),onChange:Ve=>Ie.onChange(Ve.target.checked)})})]}),[v]),L=d.exports.useCallback((se,fe,Ie)=>n(k,{children:[e(_,{children:fe}),e(et,{...S(`sockopt.${se}`),placeholder:Ie})]}),[S]),U=A==="vless"||A==="trojan",j=at("gray.200","gray.700"),Te=async se=>{await i(se)},qe=d.exports.useCallback(()=>{try{const{privateKey:se}=vi();w.setValue("realityPrivateKey",fo(se),{shouldDirty:!0})}catch(se){c({status:"error",title:a("inbounds.reality.generateError","Unable to generate key pair"),description:se instanceof Error?se.message:void 0})}},[w,c,a]),Qe=d.exports.useCallback(()=>{try{const se=typeof window>"u"?void 0:window.crypto;if(!(se!=null&&se.getRandomValues))throw new Error("Crypto API is not available in this environment.");const fe=new Uint8Array(4);se.getRandomValues(fe);const Ie=Array.from(fe).map(rt=>rt.toString(16).padStart(2,"0")).join(""),Ye=(w.getValues("realityShortIds")||"").split(/[\s,]+/).map(rt=>rt.trim()).filter(Boolean);Ye.push(Ie),w.setValue("realityShortIds",Ye.join(`
`),{shouldDirty:!0})}catch(se){c({status:"error",title:a("inbounds.reality.shortIdError","Unable to generate short ID"),description:se instanceof Error?se.message:void 0})}},[w,c,a]),T=d.exports.useMemo(()=>{const se=hp(Re);if(!se)return"";try{const{publicKey:fe}=vi(se);return fo(fe)}catch{return""}},[Re]),ce=()=>ae({dest:"",path:"",type:"",alpn:"",xver:""}),$=d.exports.useCallback(async()=>{var se;g(!0);try{const fe=await up(),Ie=(se=fe==null?void 0:fe.auths)!=null?se:[];return h(Ie),Ie}catch(fe){return console.error(fe),c({status:"error",title:a("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{g(!1)}},[c,a]),be=d.exports.useCallback(async()=>u.length?u:$(),[$,u]),dt=d.exports.useCallback((se,fe)=>{var Ve,Ye;const Ie=fe.find(rt=>rt.label===se);if(!Ie){c({status:"warning",title:a("inbounds.vless.authNotFound","Authentication block not available")});return}w.setValue("vlessDecryption",(Ve=Ie.decryption)!=null?Ve:"",{shouldDirty:!0}),w.setValue("vlessEncryption",(Ye=Ie.encryption)!=null?Ye:"",{shouldDirty:!0})},[w,a,c]),ut=d.exports.useCallback(async se=>{if(!se){w.setValue("vlessDecryption","",{shouldDirty:!0}),w.setValue("vlessEncryption","",{shouldDirty:!0});return}const fe=await be();fe.length&&dt(se,fe)},[dt,be,w]),Q=d.exports.useCallback(async()=>{const se=w.getValues("vlessSelectedAuth");if(!se){c({status:"info",title:a("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const fe=await $();fe.length&&dt(se,fe)},[dt,$,w,a,c]),W=d.exports.useCallback(()=>{w.setValue("vlessSelectedAuth","",{shouldDirty:!0}),w.setValue("vlessDecryption","",{shouldDirty:!0}),w.setValue("vlessEncryption","",{shouldDirty:!0})},[w]);return d.exports.useEffect(()=>{t&&A==="vless"&&be()},[A,be,t]),n(Lt,{isOpen:t,onClose:o,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(wt,{}),n(Ut,{maxW:{base:"95vw",md:"4xl"},children:[e(_t,{children:s==="create"?a("inbounds.add","Add inbound"):a("inbounds.edit","Edit inbound")}),e(Ot,{}),e(kt,{children:n(ue,{align:"stretch",spacing:6,children:[n(Ce,{spacing:4,borderWidth:"1px",borderColor:j,borderRadius:"lg",p:4,children:[n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.tag","Tag")}),e(et,{...S("tag",{required:!0}),isDisabled:s==="edit"})]}),n(k,{children:[e(_,{children:a("inbounds.listen","Listen address")}),e(et,{placeholder:"0.0.0.0",...S("listen")})]})]}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.port","Port")}),e(et,{placeholder:"443",...S("port",{required:!0})})]}),n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.protocol","Protocol")}),e(In,{...S("protocol",{required:!0}),isDisabled:s==="edit",children:Da.map(se=>e("option",{value:se,children:se.toUpperCase()},se))})]})]}),A==="vmess"&&n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(mt,{...S("disableInsecureEncryption")})]}),A==="shadowsocks"&&n(k,{children:[e(_,{children:a("inbounds.shadowsocks.network","Allowed networks")}),e(et,{...S("shadowsocksNetwork")})]}),A==="vless"&&n(Ce,{spacing:3,children:[e(ft,{control:v,name:"vlessSelectedAuth",render:({field:se})=>n(k,{children:[e(_,{children:a("inbounds.vless.authentication","Authentication")}),n(st,{placeholder:a("inbounds.vless.authPlaceholder","Select authentication"),value:se.value||"",onChange:async fe=>{const Ie=fe.target.value;se.onChange(Ie),await ut(Ie)},children:[e("option",{value:"",children:a("common.none","None")}),te.map(fe=>e("option",{value:fe.value,children:fe.label},fe.value))]})]})}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.vless.decryption","Decryption")}),e(et,{...S("vlessDecryption")})]}),n(k,{children:[e(_,{children:a("inbounds.vless.encryption","Encryption")}),e(et,{...S("vlessEncryption")})]})]}),n(R,{spacing:3,children:[e(H,{size:"sm",onClick:Q,isLoading:m,isDisabled:!D,children:a("inbounds.vless.getKeys","Get new keys")}),e(H,{size:"sm",variant:"ghost",onClick:W,children:a("inbounds.vless.clearKeys","Clear")})]})]}),A==="http"&&n(Ce,{spacing:3,children:[n(ct,{justify:"space-between",align:"center",children:[e(p,{fontWeight:"medium",children:a("inbounds.http.accounts","HTTP accounts")}),e(H,{size:"xs",onClick:()=>C({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),n(Ce,{spacing:3,children:[F.map((se,fe)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:j,p:3,children:[n(ct,{justify:"space-between",align:"center",mb:3,children:[n(p,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",fe+1]}),e(H,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>X(fe),children:a("hostsPage.delete","Delete")})]}),n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("username","Username")}),e(et,{...S(`httpAccounts.${fe}.user`)})]}),n(k,{children:[e(_,{children:a("password","Password")}),e(et,{...S(`httpAccounts.${fe}.pass`)})]})]})]},se.id)),!F.length&&e(p,{fontSize:"sm",color:"gray.500",children:a("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.http.allowTransparent","Allow transparent proxy")}),e(mt,{...S("httpAllowTransparent")})]})]}),A==="socks"&&n(Ce,{spacing:3,children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.socks.udp","Enable UDP")}),e(mt,{...S("socksUdpEnabled")})]}),ge&&n(k,{children:[e(_,{children:a("inbounds.socks.udpIp","UDP bind IP")}),e(et,{...S("socksUdpIp"),placeholder:"127.0.0.1"})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.socks.auth","Require authentication")}),e(ft,{control:v,name:"socksAuth",render:({field:se})=>e(mt,{isChecked:se.value==="password",onChange:fe=>se.onChange(fe.target.checked?"password":"noauth")})})]}),V==="password"&&n(Ce,{spacing:3,children:[n(ct,{justify:"space-between",align:"center",children:[e(p,{fontWeight:"medium",children:a("inbounds.socks.accounts","SOCKS accounts")}),e(H,{size:"xs",onClick:()=>me({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),Y.map((se,fe)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:j,p:3,children:[n(ct,{justify:"space-between",align:"center",mb:3,children:[n(p,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",fe+1]}),e(H,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>O(fe),children:a("hostsPage.delete","Delete")})]}),n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("username","Username")}),e(et,{...S(`socksAccounts.${fe}.user`)})]}),n(k,{children:[e(_,{children:a("password","Password")}),e(et,{...S(`socksAccounts.${fe}.pass`)})]})]})]},se.id)),!Y.length&&e(p,{fontSize:"sm",color:"gray.500",children:a("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),Z&&n(Ce,{spacing:4,borderWidth:"1px",borderColor:j,borderRadius:"lg",p:4,children:[n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.network","Network")}),e(In,{...S("streamNetwork"),children:jh.map(se=>e("option",{value:se,children:se},se))})]}),n(k,{children:[e(_,{children:a("inbounds.security","Security")}),e(In,{...S("streamSecurity"),children:ep.map(se=>e("option",{value:se,children:se},se))})]})]}),De==="ws"&&n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.ws.path","WebSocket path")}),e(et,{...S("wsPath"),placeholder:"/ws"})]}),n(k,{children:[e(_,{children:a("inbounds.ws.host","WebSocket host header")}),e(et,{...S("wsHost")})]})]}),De==="tcp"&&n(Ce,{spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.tcp.headerType","TCP header type")}),n(In,{...S("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),Me==="http"&&n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.tcp.host","HTTP host list")}),e(Us,{...S("tcpHttpHosts"),placeholder:"example.com"})]}),n(k,{children:[e(_,{children:a("inbounds.tcp.path","HTTP path")}),e(et,{...S("tcpHttpPath")})]})]})]}),De==="grpc"&&n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.grpc.serviceName","Service name")}),e(et,{...S("grpcServiceName")})]}),n(k,{children:[e(_,{children:a("inbounds.grpc.authority","Authority")}),e(et,{...S("grpcAuthority")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.grpc.multiMode","Multi mode")}),e(mt,{...S("grpcMultiMode")})]})]}),De==="kcp"&&n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.kcp.headerType","mKCP header")}),e(et,{...S("kcpHeaderType")})]}),n(k,{children:[e(_,{children:a("inbounds.kcp.seed","mKCP seed")}),e(et,{...S("kcpSeed")})]})]}),De==="quic"&&n($e,{columns:{base:1,md:3},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.quic.security","QUIC security")}),e(et,{...S("quicSecurity")})]}),n(k,{children:[e(_,{children:a("inbounds.quic.key","QUIC key")}),e(et,{...S("quicKey")})]}),n(k,{children:[e(_,{children:a("inbounds.quic.headerType","QUIC header type")}),e(et,{...S("quicHeaderType")})]})]}),De==="httpupgrade"&&n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.httpUpgrade.path","Path")}),e(et,{...S("httpupgradePath")})]}),n(k,{children:[e(_,{children:a("inbounds.httpUpgrade.host","Host")}),e(et,{...S("httpupgradeHost")})]})]}),De==="splithttp"&&n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.splitHttp.path","Path")}),e(et,{...S("splithttpPath")})]}),n(k,{children:[e(_,{children:a("inbounds.splitHttp.host","Host")}),e(et,{...S("splithttpHost")})]})]}),De==="xhttp"&&n(Ce,{spacing:3,children:[n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.xhttp.host","Host")}),e(et,{...S("xhttpHost"),placeholder:"example.com"})]}),n(k,{children:[e(_,{children:a("inbounds.xhttp.path","Path")}),e(et,{...S("xhttpPath"),placeholder:"/"})]})]}),n(Ce,{spacing:2,children:[n(ct,{justify:"space-between",align:"center",children:[e(p,{fontWeight:"medium",children:a("inbounds.xhttp.headers","Custom headers")}),e(H,{size:"xs",onClick:()=>P({name:"",value:""}),children:a("inbounds.accounts.add","Add")})]}),oe.map((se,fe)=>n(R,{spacing:2,align:"flex-start",children:[e(k,{children:e(et,{...S(`xhttpHeaders.${fe}.name`),placeholder:a("inbounds.xhttp.headerName","Header name")})}),e(k,{children:e(et,{...S(`xhttpHeaders.${fe}.value`),placeholder:a("inbounds.xhttp.headerValue","Header value")})}),e(H,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>we(fe),children:a("hostsPage.delete","Delete")})]},se.id))]}),n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.xhttp.mode","Mode")}),e(In,{...S("xhttpMode"),children:fp.map(se=>e("option",{value:se,children:se},se))})]}),n(k,{children:[e(_,{children:a("inbounds.xhttp.paddingBytes","Padding bytes")}),e(et,{...S("xhttpPaddingBytes"),placeholder:"100-1000"})]})]}),pe==="packet-up"&&n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.xhttp.maxBuffered","Max buffered upload")}),e(et,{...S("xhttpScMaxBufferedPosts"),placeholder:"30"})]}),n(k,{children:[e(_,{children:a("inbounds.xhttp.maxUploadBytes","Max upload size (bytes)")}),e(et,{...S("xhttpScMaxEachPostBytes"),placeholder:"1000000"})]})]}),pe==="stream-up"&&n(k,{children:[e(_,{children:a("inbounds.xhttp.streamUp","Stream-up server seconds")}),e(et,{...S("xhttpScStreamUpServerSecs"),placeholder:"20-80"})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.xhttp.noSSE","Disable SSE header")}),e(mt,{...S("xhttpNoSSEHeader")})]})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.sockopt.enable","Enable sockopt")}),e(ft,{control:v,name:"sockoptEnabled",render:({field:se})=>e(mt,{isChecked:Boolean(se.value),onChange:fe=>se.onChange(fe.target.checked)})})]}),e(rs,{in:Boolean(G),animateOpacity:!0,children:n(Ce,{spacing:4,borderWidth:"1px",borderColor:j,borderRadius:"md",p:4,mt:2,children:[n($e,{columns:{base:1,md:2},spacing:3,children:[le("mark",a("inbounds.sockopt.routeMark","Route mark")),le("tcpKeepAliveInterval",a("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),le("tcpKeepAliveIdle",a("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),le("tcpMaxSeg",a("inbounds.sockopt.tcpMaxSeg","TCP max segment")),le("tcpUserTimeout",a("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),le("tcpWindowClamp",a("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),n($e,{columns:{base:1,md:2},spacing:3,children:[L("dialerProxy",a("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),L("interfaceName",a("inbounds.sockopt.interfaceName","Interface name"))]}),n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.sockopt.domainStrategy","Domain strategy")}),e(ft,{control:v,name:"sockopt.domainStrategy",render:({field:se})=>n(st,{...se,children:[e("option",{value:"",children:a("common.none","None")}),pp.map(fe=>e("option",{value:fe,children:fe},fe))]})})]}),n(k,{children:[e(_,{children:a("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(ft,{control:v,name:"sockopt.tcpcongestion",render:({field:se})=>n(st,{...se,children:[e("option",{value:"",children:a("common.none","None")}),mp.map(fe=>e("option",{value:fe,children:fe},fe))]})})]}),n(k,{children:[e(_,{children:a("inbounds.sockopt.tproxy","TProxy")}),e(ft,{control:v,name:"sockopt.tproxy",render:({field:se})=>e(st,{...se,children:gp.map(fe=>e("option",{value:fe,children:fe},fe))})})]})]}),n($e,{columns:{base:1,md:2},spacing:3,children:[B("acceptProxyProtocol",a("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),B("tcpFastOpen",a("inbounds.sockopt.tcpFastOpen","TCP fast open")),B("tcpMptcp",a("inbounds.sockopt.tcpMptcp","Multipath TCP")),B("penetrate",a("inbounds.sockopt.penetrate","Penetrate")),B("V6Only",a("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),ee==="tls"&&n(Ce,{spacing:4,borderWidth:"1px",borderColor:j,borderRadius:"lg",p:4,children:[n(k,{children:[e(_,{children:a("inbounds.tls.serverName","Server name (SNI)")}),e(et,{...S("tlsServerName"),placeholder:"example.com"})]}),n(k,{children:[e(_,{children:a("inbounds.tls.fingerprint","uTLS fingerprint")}),n(In,{...S("tlsFingerprint"),children:[e("option",{value:"",children:a("common.none","None")}),Zh.map(se=>e("option",{value:se,children:se},se))]})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.tls.allowInsecure","Allow insecure")}),e(mt,{...S("tlsAllowInsecure")})]})]}),ee==="reality"&&n(Ce,{spacing:4,borderWidth:"1px",borderColor:j,borderRadius:"lg",p:4,children:[n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.reality.privateKey","Reality private key")}),e(Us,{rows:3,...S("realityPrivateKey",{required:!0})}),e(H,{size:"xs",mt:2,variant:"outline",onClick:qe,alignSelf:"flex-start",children:a("inbounds.reality.generateKeys","Generate key pair")})]}),n(k,{children:[e(_,{children:a("inbounds.reality.publicKey","Reality public key")}),e(et,{value:T,isReadOnly:!0,placeholder:a("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.reality.serverNames","Server names")}),e(Us,{rows:2,...S("realityServerNames"),placeholder:"domain.com"}),e(z,{fontSize:"sm",color:"gray.500",children:a("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),n(k,{children:[e(_,{children:a("inbounds.reality.dest","Destination (host:port)")}),e(et,{...S("realityDest"),placeholder:"example.com:443"})]})]}),n(k,{children:[e(_,{children:a("inbounds.reality.shortIds","Short IDs")}),e(Us,{rows:2,...S("realityShortIds")}),e(H,{size:"xs",mt:2,variant:"outline",onClick:Qe,alignSelf:"flex-start",children:a("inbounds.reality.generateShortId","Generate short ID")}),e(z,{fontSize:"sm",color:"gray.500",children:a("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.reality.spiderX","SpiderX")}),e(et,{...S("realitySpiderX")})]}),n(k,{children:[e(_,{children:a("inbounds.reality.xver","Xver")}),e(et,{...S("realityXver")})]})]})]}),U&&n(Ce,{spacing:3,borderWidth:"1px",borderColor:j,borderRadius:"lg",p:4,children:[n(ct,{align:"center",justify:"space-between",children:[e(z,{fontWeight:"medium",children:a("inbounds.fallbacks","Fallbacks")}),e(H,{size:"xs",onClick:ce,children:a("inbounds.fallbacks.add","Add fallback")})]}),M.length===0?e(p,{fontSize:"sm",color:"gray.500",children:a("inbounds.fallbacks.empty","No fallbacks configured yet.")}):M.map((se,fe)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:j,p:3,children:[n(ct,{justify:"space-between",align:"center",mb:3,children:[n(p,{fontWeight:"semibold",children:[a("inbounds.fallbacks.type","Fallback")," #",fe+1]}),e(H,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>b(fe),children:a("hostsPage.delete","Delete")})]}),n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.fallbacks.dest","Destination (host:port)")}),e(et,{placeholder:"example.com:443",...S(`fallbacks.${fe}.dest`)})]}),n(k,{children:[e(_,{children:a("inbounds.fallbacks.path","Path")}),e(et,{...S(`fallbacks.${fe}.path`),placeholder:"/"})]}),n(k,{children:[e(_,{children:a("inbounds.fallbacks.type","Type")}),e(et,{...S(`fallbacks.${fe}.type`),placeholder:"none"})]}),n(k,{children:[e(_,{children:a("inbounds.fallbacks.alpn","ALPN")}),e(et,{...S(`fallbacks.${fe}.alpn`),placeholder:"h2,http/1.1"})]}),n(k,{children:[e(_,{children:"Xver"}),e(et,{...S(`fallbacks.${fe}.xver`),placeholder:"0"})]})]})]},se.id))]}),n(Ce,{spacing:4,borderWidth:"1px",borderColor:j,borderRadius:"lg",p:4,children:[n(ct,{align:"center",justify:"space-between",children:[n(R,{spacing:2,children:[e(z,{fontWeight:"medium",children:a("inbounds.sniffing","Sniffing")}),e(pt,{label:a("inbounds.sniffingHint","It is recommended to keep the default."),children:e(rl,{width:16,height:16})})]}),e(mt,{...S("sniffingEnabled")})]}),Ae&&n(Ce,{spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.sniffingDestinations","Protocols to sniff")}),e(ft,{control:v,name:"sniffingDestinations",render:({field:se})=>{var fe;return e(ui,{value:(fe=se.value)!=null?fe:[],onChange:se.onChange,children:e(R,{spacing:4,children:Qh.map(Ie=>e(Nr,{value:Ie.value,children:Ie.label},Ie.value))})})}})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.sniffingRouteOnly","Route only")}),e(mt,{...S("sniffingRouteOnly")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.sniffingMetadataOnly","Metadata only")}),e(mt,{...S("sniffingMetadataOnly")})]})]})]})]})}),n(zt,{children:[e(H,{variant:"ghost",mr:3,onClick:o,children:a("hostsPage.cancel","Cancel")}),e(H,{colorScheme:"primary",isLoading:l,onClick:y(Te),children:s==="create"?a("common.create","Create"):a("common.save","Save")})]})]})]})},yp=()=>{const{t}=Ke(),s=Kt(),[r,l]=d.exports.useState([]),[o,i]=d.exports.useState(!0),[a,c]=d.exports.useState(!1),[u,h]=d.exports.useState(null),[m,g]=d.exports.useState({protocol:"all",search:""}),[w,v]=d.exports.useState(null),{isOpen:S,onOpen:y,onClose:N}=qt(),[I,M]=d.exports.useState("create"),ae=_r({base:!1,md:!0}),b=d.exports.useCallback(()=>{i(!0),h(null),Pe("/inbounds/full").then(O=>{l(O||[])}).catch(()=>{h(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>i(!1))},[t]);d.exports.useEffect(()=>{b()},[b]);const F=d.exports.useMemo(()=>{const O=m.search.trim().toLowerCase();return r.filter(oe=>{var P;return m.protocol!=="all"&&oe.protocol!==m.protocol?!1:O?oe.tag.toLowerCase().includes(O)||((P=oe.port)==null?void 0:P.toString().includes(O)):!0})},[r,m]),C=()=>{M("create"),v(null),y()},X=O=>{M("edit"),v(O),y()},Y=async O=>{var oe;c(!0);try{const P=op(O),we=I==="create"?"/inbounds":`/inbounds/${encodeURIComponent(P.tag)}`;await Pe(we,{method:I==="create"?"POST":"PUT",body:P}),s({status:"success",title:I==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),Vs(),await b(),N()}catch(P){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((oe=P==null?void 0:P.data)==null?void 0:oe.detail)||(P==null?void 0:P.message)})}finally{c(!1)}},me=async O=>{var P;const oe=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:O.tag});if(!!window.confirm(oe)){c(!0);try{await Pe(`/inbounds/${encodeURIComponent(O.tag)}`,{method:"DELETE"}),s({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),Vs(),await b()}catch(we){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((P=we==null?void 0:we.data)==null?void 0:P.detail)||(we==null?void 0:we.message)})}finally{c(!1)}}};return n(Ce,{spacing:4,children:[n(ct,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(ve,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:m.search,onChange:O=>g(oe=>({...oe,search:O.target.value}))}),n(R,{spacing:3,children:[n(st,{width:"180px",value:m.protocol,onChange:O=>g(oe=>({...oe,protocol:O.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),Da.map(O=>e("option",{value:O,children:O.toUpperCase()},O))]}),e(H,{leftIcon:e(gn,{width:18,height:18}),onClick:C,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&n(Er,{status:"error",children:[e(zr,{}),u]}),o?e(ct,{justify:"center",py:10,children:e(At,{})}):F.length===0?e(z,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):ae?e(z,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:n(Rn,{variant:"simple",size:"sm",children:[e(tn,{bg:"gray.50",_dark:{bg:"gray.900"},children:n(Dt,{children:[e(Fe,{children:t("inbounds.tag","Tag")}),e(Fe,{children:t("inbounds.protocol","Protocol")}),e(Fe,{children:t("inbounds.portLabel","Port")}),e(Fe,{children:t("inbounds.network","Network")}),e(Fe,{children:t("inbounds.security","Security")}),e(Fe,{children:t("inbounds.sniffing","Sniffing")}),e(Fe,{width:"120px",children:t("actions","Actions")})]})}),e(qr,{children:F.map(O=>{var P;const oe=O.streamSettings||{};return n(Dt,{children:[n(Ne,{children:[e(p,{fontWeight:"semibold",children:O.tag}),O.listen&&e(p,{fontSize:"sm",color:"gray.500",children:O.listen})]}),e(Ne,{children:e(yt,{colorScheme:"purple",children:O.protocol})}),e(Ne,{children:O.port}),e(Ne,{children:oe.network||"\u2014"}),e(Ne,{children:oe.security&&oe.security!=="none"?e(yt,{colorScheme:"blue",children:oe.security}):"\u2014"}),e(Ne,{children:(P=O.sniffing)!=null&&P.enabled?e(yt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(yt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Ne,{children:n(R,{spacing:2,children:[e(Ue,{"aria-label":t("common.edit","Edit"),icon:e(kn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>X(O)}),e(Ue,{"aria-label":t("common.delete","Delete"),icon:e(on,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>me(O),isLoading:a})]})})]},O.tag)})})]})}):e(Ce,{spacing:3,children:F.map(O=>{var P;const oe=O.streamSettings||{};return n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(ct,{justify:"space-between",align:"center",mb:2,children:[n(z,{children:[e(p,{fontWeight:"semibold",children:O.tag}),n(p,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",O.port]})]}),n(R,{spacing:2,children:[e(Ue,{"aria-label":t("common.edit","Edit"),icon:e(kn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>X(O)}),e(Ue,{"aria-label":t("common.delete","Delete"),icon:e(on,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>me(O),isLoading:a})]})]}),n(Ce,{spacing:2,children:[n(R,{spacing:2,wrap:"wrap",children:[e(yt,{colorScheme:"purple",children:O.protocol}),oe.network&&e(yt,{children:oe.network}),oe.security&&oe.security!=="none"&&e(yt,{colorScheme:"blue",children:oe.security})]}),n(R,{spacing:2,wrap:"wrap",children:[(P=O.sniffing)!=null&&P.enabled?e(yt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(yt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),O.listen&&e(yt,{size:"sm",colorScheme:"gray",children:O.listen})]})]})]},O.tag)})}),e(bp,{isOpen:S,mode:I,initialValue:w,isSubmitting:a,onClose:N,onSubmit:Y})]})},xp=()=>{var o;const{t}=Ke(),{userData:s,getUserIsSuccess:r}=fr();return r&&Boolean((o=s.permissions)==null?void 0:o.sections.hosts)?n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),n(Wn,{colorScheme:"primary",isLazy:!0,children:[n(Fn,{children:[e(Vt,{children:n(R,{spacing:2,children:[e(Os,{as:sl,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(Vt,{children:n(R,{spacing:2,children:[e(Os,{as:Jo,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),n(Hn,{children:[e($t,{px:0,children:n(ue,{spacing:4,align:"stretch",children:[e(p,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(yp,{})]})}),e($t,{px:0,children:n(ue,{spacing:4,align:"stretch",children:[e(p,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Kh,{})]})})]})]})]}):n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("hostsPage.noPermission","You do not have permission to manage host or inbound settings.")})]})},Sp=xe.object({name:xe.string().min(1),address:xe.string().min(1),port:xe.number().min(1).or(xe.string().transform(t=>parseFloat(t))),api_port:xe.number().min(1).or(xe.string().transform(t=>parseFloat(t))),xray_version:xe.string().nullable().optional(),node_service_version:xe.string().nullable().optional(),id:xe.number().nullable().optional(),status:xe.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:xe.string().nullable().optional(),add_as_new_host:xe.boolean().optional(),usage_coefficient:xe.number().or(xe.string().transform(t=>parseFloat(t))),data_limit:xe.number().nullable().optional(),uplink:xe.number().nullable().optional(),downlink:xe.number().nullable().optional(),use_nobetci:xe.boolean().optional(),nobetci_port:xe.number().nullable().optional()}),si=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",node_service_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,nobetci_port:null}),kr="fetch-nodes-query-key",Aa=()=>{const{isEditingNodes:t}=Ct();return Mr({queryKey:kr,queryFn:Zs.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Zs=ds((t,s)=>({nodes:[],addNode(r){return Pe("/node",{method:"POST",body:r})},fetchNodes(){return Pe("/nodes")},fetchNodesUsage(r){return Pe("/nodes/usage",{query:r})},updateNode(r){return Pe(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return Pe(`/node/${r.id}/reconnect`,{method:"POST"})},restartNodeService(r){return Pe(`/node/${r.id}/service/restart`,{method:"POST"})},updateNodeService(r){return Pe(`/node/${r.id}/service/update`,{method:"POST"})},resetNodeUsage(r){return Pe(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return Pe("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return Pe("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return Pe(`/node/${(r=s().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),bo=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=Ke(),a=Ii(t),c=En[s].icon;return n(Ft,{children:[n(Hr,{colorScheme:En[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),l&&n(p,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[s&&i(`nodeModal.status.${s}`),o&&`: ${o}`]})]}),l&&t&&e(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},wp=ie(Fs,{baseStyle:{w:4,h:4}}),kp=ie(Sa,{baseStyle:{w:4,h:4}}),vp=ie(ed,{baseStyle:{w:4,h:4}}),Cp=ie(xa,{baseStyle:{w:4,h:4}}),yo=1024*1024*1024,_p=51031,An=t=>{if(t&&typeof t=="object"&&"message"in t){const s=t.message;return typeof s=="string"?s:void 0}},xo=({isOpen:t,onClose:s,node:r,mutate:l,isLoading:o,isAddMode:i=!1})=>{var we,A,De,ee,Ae,Re,Me,G,D,V,ge,pe,Z,_e,te,le,B;const{t:a}=Ke(),c=Kt(),[u,h]=d.exports.useState(i),{fetchNodesUsage:m}=Zs(),[g,w]=d.exports.useState(null),{data:v,isLoading:S}=Mr({queryKey:"node-settings",queryFn:()=>Pe("/node/settings")}),{data:y}=Mr({queryKey:"panel-settings",queryFn:_a,staleTime:5*60*1e3}),N=(we=y==null?void 0:y.use_nobetci)!=null?we:!0,I=L=>{if(L==null)return null;const U=L/yo;return Number.isFinite(U)?Math.round(U*100)/100:null},M=L=>L==null?null:Math.round(L*yo),ae=i?{...si(),add_as_new_host:!1}:{...si(),...r,add_as_new_host:!1},b=Br({resolver:_i(Sp),defaultValues:{...ae,data_limit:I((A=ae.data_limit)!=null?A:null)}}),F=(De=v==null?void 0:v.certificate)!=null?De:"",{onCopy:C,hasCopied:X}=hl(F),Y=b.watch("use_nobetci");d.exports.useEffect(()=>{if(!N||!Y){b.getValues("nobetci_port")!==null&&b.setValue("nobetci_port",null);return}const L=b.getValues("nobetci_port");(L==null||L==="")&&b.setValue("nobetci_port",_p)},[Y,b,N]),d.exports.useEffect(()=>{y&&!y.use_nobetci&&(b.getValues("use_nobetci")&&b.setValue("use_nobetci",!1),b.getValues("nobetci_port")!==null&&b.setValue("nobetci_port",null))},[y,b]),d.exports.useEffect(()=>{var L;if(t){const U=i?{...si(),add_as_new_host:!1}:{...si(),...r,add_as_new_host:!1};b.reset({...U,data_limit:I((L=U.data_limit)!=null?L:null)}),h(i&&!!F)}},[t,i,r,b,F]),d.exports.useEffect(()=>{!i&&r&&t?m({start:ze().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(L=>{const U=L.usages[r.id];U&&w({uplink:U.uplink,downlink:U.downlink})}):w(null)},[r,i,t,m]);const me=b.handleSubmit(L=>{var j;const U={...L,data_limit:M((j=L.data_limit)!=null?j:null)};l(U)}),O=()=>{!F||(C(),c({title:a("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},oe=()=>{if(!F)return;const L=new Blob([F],{type:"text/plain"}),U=URL.createObjectURL(L),j=document.createElement("a");j.href=U,j.download="ssl_client_cert.pem",j.click(),URL.revokeObjectURL(U)},P=()=>{h(!1),w(null),s()};return n(Lt,{isOpen:t,onClose:P,size:"lg",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",as:"form",onSubmit:me,children:[e(_t,{pt:6,children:e(p,{fontWeight:"semibold",fontSize:"lg",children:a(i?"nodes.addNewRebeccaNode":"nodes.editNode")})}),e(Ot,{mt:3}),e(kt,{children:n(Ce,{spacing:6,children:[!i&&g&&n(Ce,{spacing:2,children:[e(p,{fontWeight:"medium",children:a("nodes.usage")}),n(R,{children:[n(yt,{colorScheme:"green",children:[a("nodes.uplink"),": ",Tn.sizeFormat(g.uplink)]}),n(yt,{colorScheme:"blue",children:[a("nodes.downlink"),": ",Tn.sizeFormat(g.downlink)]})]})]}),i&&n(Ce,{spacing:3,children:[n(R,{justify:"space-between",align:"center",children:[e(p,{fontWeight:"medium",children:a("nodes.certificate")}),n(R,{spacing:2,children:[e(H,{size:"xs",variant:"outline",leftIcon:e(vp,{}),onClick:O,isDisabled:!F,children:a(X?"copied":"copy")}),e(H,{size:"xs",variant:"outline",leftIcon:e(Cp,{}),onClick:oe,isDisabled:!F,children:a("nodes.download-certificate")}),e(pt,{placement:"top",label:a(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(Ue,{"aria-label":a(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>h(L=>!L),size:"xs",variant:"ghost",children:u?e(kp,{}):e(wp,{})})})]})]}),e(rs,{in:u&&!!F,animateOpacity:!0,children:e(z,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:F||(S?a("loading"):"")})}),!F&&!S&&e(p,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:a("nodes.certificateUnavailable","Certificate not available.")})]}),n(Ce,{spacing:4,children:[n($e,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(er,{label:a("nodes.nodeName"),size:"sm",placeholder:"Rebecca-S2",...b.register("name"),error:An((Ae=(ee=b.formState)==null?void 0:ee.errors)==null?void 0:Ae.name)})}),e(k,{children:e(er,{label:a("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...b.register("address"),error:An((Me=(Re=b.formState)==null?void 0:Re.errors)==null?void 0:Me.address)})})]}),n($e,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(er,{label:a("nodes.nodePort"),size:"sm",placeholder:"62050",...b.register("port"),error:An((D=(G=b.formState)==null?void 0:G.errors)==null?void 0:D.port)})}),e(k,{children:e(er,{label:a("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...b.register("api_port"),error:An((ge=(V=b.formState)==null?void 0:V.errors)==null?void 0:ge.api_port)})})]}),e(k,{children:e(er,{label:a("nodes.usageCoefficient"),size:"sm",placeholder:"1",...b.register("usage_coefficient"),error:An((Z=(pe=b.formState)==null?void 0:pe.errors)==null?void 0:Z.usage_coefficient)})}),n(k,{children:[e(er,{label:a("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:a("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...b.register("data_limit",{setValueAs:L=>{if(L===""||L===null||L===void 0)return null;const U=Number(L);return Number.isFinite(U)?U:Number.NaN},validate:L=>L==null?!0:Number.isNaN(L)?a("nodes.dataLimitValidation","Data limit must be a valid number"):L>=0||a("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:An((te=(_e=b.formState)==null?void 0:_e.errors)==null?void 0:te.data_limit)}),e(p,{fontSize:"xs",color:"gray.500",mt:1,children:a("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),N&&n(Ft,{children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("nodes.useNobetci","Enable Nobetci integration")}),e(ft,{control:b.control,name:"use_nobetci",render:({field:L})=>e(mt,{isChecked:Boolean(L.value),onChange:U=>L.onChange(U.target.checked)})})]}),e(rs,{in:Boolean(Y),animateOpacity:!0,children:n(k,{mt:Y?2:0,children:[e(er,{label:a("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...b.register("nobetci_port",{setValueAs:L=>{if(L===""||L===null||L===void 0)return null;const U=Number(L);return Number.isFinite(U)?U:Number.NaN},validate:L=>Y?L==null?a("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(L)?a("nodes.nobetciPortInvalid","Enter a valid port number"):L>=1&&L<=65535?!0:a("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:An((B=(le=b.formState)==null?void 0:le.errors)==null?void 0:B.nobetci_port)}),e(p,{fontSize:"xs",color:"gray.500",mt:1,children:a("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]})]}),i&&e(z,{children:e(Nr,{...b.register("add_as_new_host"),children:a("nodes.addHostForEveryInbound")})})]})}),n(zt,{gap:3,children:[e(H,{variant:"outline",onClick:P,children:a("cancel")}),e(H,{type:"submit",colorScheme:"primary",isLoading:o,children:a(i?"nodes.addNode":"nodes.editNode")})]})]})]})},Dp=({deleteCallback:t})=>{const{deleteNode:s,deletingNode:r,setDeletingNode:l}=Zs(),{t:o}=Ke(),i=Kt(),a=va(),c=()=>{l(null)},{isLoading:u,mutate:h}=Ir(s,{onSuccess:()=>{Bt(o("deleteNode.deleteSuccess",{name:r&&r.name}),i),l(null),a.invalidateQueries(kr),t&&t()},onError:m=>{Ht(m,i)}});return n(Lt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(_t,{pt:6,children:e(Mn,{color:"red",children:e(Gs,{})})}),e(Ot,{mt:3}),n(kt,{children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:o("deleteNode.title")}),r&&e(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Ai,{components:{b:e("b",{})},children:o("deleteNode.prompt",{name:r.name})})})]}),n(zt,{display:"flex",children:[e(H,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(H,{size:"sm",w:"full",colorScheme:"red",onClick:()=>h(),leftIcon:u?e(At,{size:"xs"}):void 0,children:o("delete")})]})]})]})},Ap=10,Pp=({isOpen:t,title:s,description:r,currentVersion:l,allowPersist:o=!1,isSubmitting:i,onSubmit:a,onClose:c})=>{const{t:u}=Ke(),[h,m]=d.exports.useState(""),[g,w]=d.exports.useState(!1),[v,S]=d.exports.useState(null),y=Mr(["core-xray-releases"],()=>Pe("/core/xray/releases",{query:{limit:Ap}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(m(l||""),w(!1),S(null))},[t,l]);const N=d.exports.useMemo(()=>{var F,C;return(C=(F=y.data)==null?void 0:F.tags)!=null?C:[]},[y.data]),I=F=>{m(F.target.value)},M=F=>{m(F.target.value)},ae=async()=>{if(!h){S(u("validation.required"));return}try{S(null),await a({version:h,persist:o?g:void 0})}catch(F){F instanceof Error?S(F.message):S(u("core.generalErrorMessage"))}},b=y.isLoading;return n(Lt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(wt,{}),n(Ut,{children:[e(_t,{children:s}),e(Ot,{}),e(kt,{children:n(Ce,{spacing:4,children:[r&&e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),n(k,{children:[e(_,{children:u("nodes.coreVersionDialog.latestReleases")}),e(st,{placeholder:u(b?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:h&&N.includes(h)?h:"",onChange:I,isDisabled:b||N.length===0,size:"sm",children:N.map(F=>e("option",{value:F,children:F},F))}),b&&n(Ce,{direction:"row",align:"center",spacing:2,mt:2,children:[e(At,{size:"sm"}),e(p,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),y.isError&&e(p,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),n(k,{isRequired:!0,children:[e(_,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(ve,{value:h,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:M,size:"sm"}),e(p,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),o&&e(Nr,{isChecked:g,onChange:F=>w(F.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),v&&n(Er,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(zr,{}),e(wn,{children:v})]})]})}),n(zt,{children:[e(H,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(H,{colorScheme:"primary",onClick:ae,isLoading:i,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},So="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",Ip=ie(pl,{baseStyle:{w:3.5,h:3.5}}),Tp=ie(gn,{baseStyle:{w:3.5,h:3.5}}),Ep=ie(Yr,{baseStyle:{w:4,h:4}}),zp=({isOpen:t,title:s,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:o,onSubmit:i,onClose:a})=>{const{t:c}=Ke(),[u,h]=d.exports.useState("template"),[m,g]=d.exports.useState(So),[w,v]=d.exports.useState(""),[S,y]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[N,I]=d.exports.useState(!0),[M,ae]=d.exports.useState(!1),[b,F]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(h("template"),g(o||So),v(""),y([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),I(!0),ae(!1),F(null))},[t,o]);const C=Mr(["geo-templates",m],()=>Pe("/core/geo/templates",{query:m?{index_url:m}:void 0}),{enabled:t&&u==="template"&&Boolean(m),staleTime:10*60*1e3}),X=d.exports.useMemo(()=>{var A,De;return(De=(A=C.data)==null?void 0:A.templates)!=null?De:[]},[C.data]);d.exports.useEffect(()=>{X.length>0&&v(A=>A||X[0].name)},[X]);const Y=at("gray.50","whiteAlpha.50"),me=()=>{y(A=>[...A,{name:"",url:""}])},O=(A,De,ee)=>{y(Ae=>Ae.map((Re,Me)=>Me===A?{...Re,[De]:ee}:Re))},oe=A=>{y(De=>De.filter((ee,Ae)=>Ae!==A))},P=async()=>{const A=u==="manual"?S.filter(ee=>ee.name.trim()&&ee.url.trim()):[];if(u==="template"){if(!m.trim()){F(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!w){F(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(A.length===0){F(c("nodes.geoDialog.errors.missingFiles"));return}if(A.find(Ae=>!Ae.name.trim()||!Ae.url.trim())){F(c("nodes.geoDialog.errors.invalidFile"));return}}F(null);const De=u==="manual"?A:[];try{await i({mode:u,templateIndexUrl:m.trim(),templateName:w,files:De,persistEnv:N,applyToNodes:M})}catch(ee){const Ae=ee instanceof Error?ee.message:c("nodes.geoDialog.genericError");F(Ae)}},we=()=>n(Ce,{spacing:3,bg:Y,p:4,borderRadius:"md",children:[S.map((A,De)=>n(z,{borderWidth:"1px",borderRadius:"md",p:3,children:[n($e,{columns:{base:1,md:2},spacing:3,children:[n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(ve,{size:"sm",value:A.name,placeholder:"geosite.dat",onChange:ee=>O(De,"name",ee.target.value)})]}),n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(ve,{size:"sm",value:A.url,placeholder:"https://example.com/geosite.dat",onChange:ee=>O(De,"url",ee.target.value)})]})]}),e(R,{justify:"flex-end",mt:3,children:e(pt,{label:c("nodes.geoDialog.removeFile"),children:e(Ue,{"aria-label":"remove file",icon:e(Ip,{}),variant:"ghost",size:"sm",onClick:()=>oe(De),isDisabled:S.length<=1})})})]},`manual-file-${De}`)),e(H,{onClick:me,leftIcon:e(Tp,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return n(Lt,{isOpen:t,onClose:a,size:"xl",isCentered:!0,children:[e(wt,{}),n(Ut,{children:[e(_t,{children:s}),e(Ot,{}),e(kt,{children:n(Ce,{spacing:4,children:[n(k,{as:"fieldset",children:[e(_,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(Bs,{value:u,onChange:A=>h(A),children:n(R,{spacing:4,children:[e(Tr,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Tr,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?n(Ce,{spacing:3,children:[n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(ve,{size:"sm",value:m,onChange:A=>g(A.target.value)})]}),n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),n(R,{align:"center",spacing:2,children:[e(st,{size:"sm",flex:1,value:w,onChange:A=>v(A.target.value),isDisabled:C.isLoading||!X.length,placeholder:C.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:X.map(A=>e("option",{value:A.name,children:A.name},A.name))}),e(pt,{label:c("nodes.geoDialog.refreshTemplates"),children:e(Ue,{"aria-label":"refresh templates",icon:e(Ep,{}),size:"sm",variant:"outline",onClick:()=>C.refetch(),isLoading:C.isFetching,isDisabled:!m.trim()})})]})]}),C.isError&&n(Er,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(zr,{}),e(wn,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):we(),l&&n(Ce,{spacing:2,children:[e(Nr,{isChecked:N,onChange:A=>I(A.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(Nr,{isChecked:M,onChange:A=>ae(A.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(p,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),b&&n(Er,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(zr,{}),e(wn,{children:b})]})]})}),n(zt,{children:[e(H,{variant:"ghost",mr:3,onClick:a,children:c("cancel")}),e(H,{colorScheme:"primary",onClick:P,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};ze.extend(Ys);const Np=ie(gn,{baseStyle:{w:4,h:4}}),Rp=ie(on,{baseStyle:{w:4,h:4}}),Mp=ie(kn,{baseStyle:{w:4,h:4}}),wo=ie(Yr,{baseStyle:{w:4,h:4}}),Lp=ie(Go,{baseStyle:{w:4,h:4}}),Fl=1024**3,Up=t=>{if(t==null)return"";const s=t/Fl;return Number.isFinite(s)?(Math.round(s*100)/100).toString():""},ko=t=>{const s=t.trim();if(!s)return null;const r=Number(s);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*Fl)},Op=()=>{var xs,Ss,ws,ks,f,x,ne,Ge,it,Xe,St,xr,Cn,bn;const{t}=Ke(),{onEditingNodes:s}=Ct(),r=Ct(de=>de.isEditingNodes),{data:l,isLoading:o,error:i,refetch:a,isFetching:c}=Aa(),{addNode:u,updateNode:h,reconnectNode:m,restartNodeService:g,updateNodeService:w,resetNodeUsage:v,updateMasterNode:S,resetMasterUsage:y,setDeletingNode:N}=Zs(),I=va(),M=Kt(),{userData:ae,getUserIsSuccess:b}=fr();if(!(b&&Boolean((xs=ae.permissions)==null?void 0:xs.sections.nodes)))return n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("nodes.title","Nodes")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.noPermission","You do not have permission to manage nodes.")})]});const[C,X]=d.exports.useState(null),[Y,me]=d.exports.useState(!1),[O,oe]=d.exports.useState(""),[P,we]=d.exports.useState(null),[A,De]=d.exports.useState(null),[ee,Ae]=d.exports.useState(null),[Re,Me]=d.exports.useState(null),[G,D]=d.exports.useState(!1),[V,ge]=d.exports.useState(!1),[pe,Z]=d.exports.useState(!1),[_e,te]=d.exports.useState(null),[le,B]=d.exports.useState({}),[L,U]=d.exports.useState(null),[j,Te]=d.exports.useState(null),[qe,Qe]=d.exports.useState(null),[T,ce]=d.exports.useState(null),{isOpen:$,onOpen:be,onClose:dt}=qt(),ut=d.exports.useRef(null),[Q,W]=d.exports.useState(""),[Se,Le]=d.exports.useState(!1),{isOpen:J,onOpen:He,onClose:se}=qt(),fe=d.exports.useRef(null),{data:Ie,isLoading:Ve,refetch:Ye,error:rt}=Mr(["core-stats"],()=>Pe("/core"),{refetchOnWindowFocus:!1}),{data:Je,isLoading:Ze,error:Wt,refetch:xt}=Mr(["master-node-state"],()=>Pe("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(s(!0),()=>{s(!1)}),[s]),d.exports.useEffect(()=>{var gt,nt;if(!Je)return;if(Se){const bt=ko(Q),It=(gt=Je.data_limit)!=null?gt:null;if(bt!==It)return}const de=Up((nt=Je.data_limit)!=null?nt:null);W(de),Se&&Le(!1)},[Je,Se,Q]);const{isLoading:sr,mutate:br}=Ir(u,{onSuccess:()=>{Bt(t("nodes.addNodeSuccess"),M),I.invalidateQueries(kr),me(!1)},onError:de=>{Ht(de,M)}}),{isLoading:ir,mutate:ar}=Ir(h,{onSuccess:()=>{Bt(t("nodes.nodeUpdated"),M),I.invalidateQueries(kr),X(null)},onError:de=>{Ht(de,M)}}),{isLoading:or,mutate:tr}=Ir(m,{onSuccess:()=>{I.invalidateQueries(kr)}}),{mutate:lr,isLoading:cr}=Ir(h,{onSuccess:()=>{I.invalidateQueries(kr)},onError:de=>{Ht(de,M)},onSettled:(de,gt,nt)=>{(nt==null?void 0:nt.id)!=null&&B(bt=>{const It={...bt};return delete It[nt.id],It}),te(null)}}),{isLoading:re,mutate:ke}=Ir(v,{onSuccess:()=>{Bt(t("nodes.resetUsageSuccess","Node usage reset"),M),I.invalidateQueries(kr)},onError:de=>{Ht(de,M)},onSettled:()=>{U(null),Te(null),dt()}}),{mutate:K,isLoading:E}=Ir(g,{onMutate:de=>{var gt;Qe((gt=de.id)!=null?gt:null)},onSuccess:()=>{Bt(t("nodes.restartServiceTriggered","Node restart requested"),M),I.invalidateQueries(kr)},onError:de=>{Ht(de,M)},onSettled:()=>{Qe(null)}}),{mutate:Ee,isLoading:Be}=Ir(w,{onMutate:de=>{var gt;ce((gt=de.id)!=null?gt:null)},onSuccess:()=>{Bt(t("nodes.updateServiceTriggered","Node update requested"),M),I.invalidateQueries(kr)},onError:de=>{Ht(de,M)},onSettled:()=>{ce(null)}}),{isLoading:Oe,mutate:We}=Ir(S,{onSuccess:()=>{Bt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),M),xt(),Le(!1)},onError:de=>{Ht(de,M)}}),{isLoading:ht,mutate:ot}=Ir(y,{onSuccess:()=>{Bt(t("nodes.resetMasterUsageSuccess","Master usage reset"),M),xt(),se()},onError:de=>{Ht(de,M)}}),Tt=d.exports.useMemo(()=>ko(Q),[Q]),Yt=(Ss=Je==null?void 0:Je.data_limit)!=null?Ss:null,Gt=Tt===void 0,dr=Tt!==void 0&&Tt!==Yt,Lr=Ve||Ze,lt=d.exports.useMemo(()=>{if(rt instanceof Error)return rt.message;if(typeof rt=="string")return rt;if(Wt instanceof Error)return Wt.message;if(typeof Wt=="string")return Wt},[rt,Wt]),Pt=(ws=Je==null?void 0:Je.total_usage)!=null?ws:0,Nt=(ks=Je==null?void 0:Je.data_limit)!=null?ks:null,ur=(f=Je==null?void 0:Je.remaining_data)!=null?f:null,hr=Je!=null&&Je.updated_at?ze(Je.updated_at).local().format("YYYY-MM-DD HH:mm"):null,Ur=(x=Je==null?void 0:Je.status)!=null?x:"error",Zt=tt(Pt,2),pr=Nt!==null&&Nt>0?tt(Nt,2):t("nodes.unlimited","Unlimited"),Xr=ur!=null?tt(ur,2):null,Et=de=>{Le(!0),W(de)},Or=()=>{if(Gt||Tt===void 0){Ht(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),M);return}We({data_limit:Tt!=null?Tt:null})},Rt=()=>{Le(!0),W(""),We({data_limit:null})},Ar=()=>{He()},rr=de=>{if(!(de!=null&&de.id))return;const gt=de.status!=="disabled",nt=gt?"disabled":"connecting",bt=de.id;te(bt),B(It=>({...It,[bt]:!gt})),lr({...de,status:nt})},ye=de=>{!(de!=null&&de.id)||(Te(de),be())},yr=de=>{if(!(de!=null&&de.id))return;const gt=de.name||de.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.restartServiceConfirm","Send a restart request to {{name}}? Services will be interrupted briefly.",{name:gt}))||K(de)},Wr=de=>{if(!(de!=null&&de.id))return;const gt=de.name||de.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.updateServiceConfirm","Send an update request to {{name}}? The node will download updates and restart.",{name:gt}))||Ee(de)},Qr=()=>{!(j!=null&&j.id)||(U(j.id),ke(j))},vn=()=>{Te(null),dt()},cn=()=>we(null),fs=()=>De(null),Ti=async({version:de,persist:gt})=>{var nt;if(!!P){if(P.type==="master"){D(!0);try{await Pe("/core/xray/update",{method:"POST",body:{version:de,persist_env:Boolean(gt)}}),Bt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:de}),M),await Promise.all([Ye(),I.invalidateQueries(kr)]),cn()}catch(bt){Ht(bt,M)}finally{D(!1)}return}if(P.type==="bulk"){const bt=(l!=null?l:[]).filter(It=>It.id!=null&&It.status==="connected");if(bt.length===0){M({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}ge(!0);try{const It=[];for(const _n of bt)try{await Pe(`/node/${_n.id}/xray/update`,{method:"POST",body:{version:de}}),It.push({status:"fulfilled",node:_n})}catch(Ui){It.push({status:"rejected",node:_n}),Ht(Ui,M)}const Vr=It.filter(_n=>_n.status==="fulfilled").length,Zr=It.length-Vr,jr=It.length;Vr>0&&Bt(t("nodes.coreVersionDialog.bulkSuccess",{success:Vr,total:jr}),M),Zr>0&&M({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:Zr,total:jr}),status:"error",isClosable:!0,position:"top",duration:4e3}),I.invalidateQueries(kr),cn()}finally{ge(!1)}return}if(P.type==="node"){const bt=P.node;if(!(bt!=null&&bt.id))return;Ae(bt.id);try{await Pe(`/node/${bt.id}/xray/update`,{method:"POST",body:{version:de}}),Bt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(nt=bt.name)!=null?nt:t("nodes.unnamedNode","Unnamed node"),version:de}),M),I.invalidateQueries(kr),cn()}catch(It){Ht(It,M)}finally{Ae(null)}}}},Ei=async de=>{var nt;if(!A)return;const gt={mode:de.mode,template_index_url:de.templateIndexUrl,template_name:de.templateName,files:de.files,persist_env:de.persistEnv};if(A.type==="master"){Z(!0);try{await Pe("/core/geo/update",{method:"POST",body:gt}),Bt(t("nodes.geoDialog.masterUpdateSuccess"),M),fs()}catch(bt){Ht(bt,M)}finally{Z(!1)}return}if(A.type==="node"){const bt=A.node;if(!(bt!=null&&bt.id))return;Me(bt.id);try{await Pe(`/node/${bt.id}/geo/update`,{method:"POST",body:gt}),Bt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(nt=bt.name)!=null?nt:t("nodes.unnamedNode","Unnamed node")}),M),I.invalidateQueries(kr),fs()}catch(It){Ht(It,M)}finally{Me(null)}}},js=d.exports.useMemo(()=>{if(!l)return[];const de=O.trim().toLowerCase();return de?l.filter(gt=>{var Vr,Zr,jr;const nt=((Vr=gt.name)!=null?Vr:"").toLowerCase(),bt=((Zr=gt.address)!=null?Zr:"").toLowerCase(),It=((jr=gt.xray_version)!=null?jr:"").toLowerCase();return nt.includes(de)||bt.includes(de)||It.includes(de)}):l},[l,O]),ei=d.exports.useMemo(()=>(l!=null?l:[]).some(de=>de.id!=null&&de.status==="connected"),[l]),ti=d.exports.useMemo(()=>{if(!!i){if(i instanceof Error)return i.message;if(typeof i=="string")return i;if(typeof i=="object"&&"message"in i){const de=i.message;if(typeof de=="string")return de}return t("errorOccurred")}},[i,t]),zi=Boolean(ti),bs=t("nodes.masterNode","Master"),ys=O.trim().toLowerCase(),Ni=!ys||bs.toLowerCase().includes(ys)||((ne=Ie==null?void 0:Ie.version)!=null?ne:"").toLowerCase().includes(ys),dn=(P==null?void 0:P.type)==="master"?G:(P==null?void 0:P.type)==="node"?P.node.id!=null&&ee===P.node.id:(P==null?void 0:P.type)==="bulk"?V:!1,Bn=(A==null?void 0:A.type)==="master"?pe:(A==null?void 0:A.type)==="node"?A.node.id!=null&&Re===A.node.id:!1,Ri=(P==null?void 0:P.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(P==null?void 0:P.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(P==null?void 0:P.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Ge=P.node.name)!=null?Ge:t("nodes.unnamedNode","Unnamed node")}):"",Mi=(P==null?void 0:P.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(P==null?void 0:P.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(P==null?void 0:P.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(it=P.node.name)!=null?it:t("nodes.unnamedNode","Unnamed node")}):"",Li=(P==null?void 0:P.type)==="master"?(Xe=Ie==null?void 0:Ie.version)!=null?Xe:"":(P==null?void 0:P.type)==="node"&&(St=P.node.xray_version)!=null?St:"",ri=(A==null?void 0:A.type)==="master"?t("nodes.geoDialog.masterTitle"):(A==null?void 0:A.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(xr=A.node.name)!=null?xr:t("nodes.unnamedNode","Unnamed node")}):"";return n(ue,{spacing:6,align:"stretch",children:[n(Ce,{spacing:1,children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),zi&&n(Er,{status:"error",borderRadius:"md",children:[e(zr,{}),e(wn,{children:ti})]}),n(Ce,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(p,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),n(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[n(R,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[n(Dr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(Xo,{pointerEvents:"none",children:e(Lp,{color:"gray.400"})}),e(ve,{value:O,onChange:de=>oe(de.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(pt,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(Ue,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(wo,{}),variant:"ghost",size:"sm",onClick:()=>a(),isLoading:c})})]}),n(Ce,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(H,{variant:"outline",size:"sm",onClick:()=>we({type:"bulk"}),isDisabled:!ei,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(H,{leftIcon:e(Np,{}),colorScheme:"primary",size:"sm",onClick:()=>me(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),o?e($e,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((de,gt)=>e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:n(ue,{spacing:3,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${gt}`))}):n($e,{columns:{base:1,md:2,xl:3},spacing:4,children:[Ni&&e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:Lr?n(ue,{spacing:3,align:"center",justify:"center",children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):lt?n(ue,{spacing:3,align:"stretch",children:[e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:lt}),e(H,{size:"sm",variant:"outline",onClick:()=>{Ye(),xt()},children:t("refresh","Refresh")})]}):Je?n(ue,{align:"stretch",spacing:4,children:[n(Ce,{spacing:2,children:[n(R,{spacing:3,align:"center",flexWrap:"wrap",children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:bs}),e(yt,{colorScheme:"purple",size:"sm",children:Ie!=null&&Ie.version?`Xray ${Ie.version}`:t("nodes.versionUnknown","Version unknown")})]}),n(R,{spacing:2,align:"center",children:[e(bo,{status:Ur,compact:!0}),Je.limit_exceeded&&e(yt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Ie!=null&&Ie.started?t("nodes.masterStartedAt",{date:ze(Ie.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),Je.message&&n(Er,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(zr,{}),e(wn,{fontSize:"sm",children:Je.message})]}),e(jn,{}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(p,{fontWeight:"medium",children:Zt})]}),n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(p,{fontWeight:"medium",children:pr})]}),Xr&&n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(p,{fontWeight:"medium",children:Xr})]}),hr&&n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(p,{fontWeight:"medium",children:hr})]})]}),n(Ce,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[n(Dr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(ve,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:Q,onChange:de=>Et(de.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(Rr,{pointerEvents:"none",children:e(p,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(H,{colorScheme:"primary",size:"sm",onClick:Or,isDisabled:!dr||Gt||Oe,isLoading:Oe,children:t("save","Save")}),e(H,{variant:"ghost",size:"sm",onClick:Rt,isDisabled:Nt===null||Oe,isLoading:Oe&&Nt===null,children:t("nodes.clearDataLimit","Clear limit")})]}),Gt&&e(p,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),n(Ce,{direction:{base:"column",sm:"row"},spacing:2,children:[e(H,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>we({type:"master"}),isLoading:G,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(H,{size:"sm",variant:"outline",onClick:()=>De({type:"master"}),isLoading:pe,children:t("nodes.geoDialog.updateMasterButton")}),e(H,{size:"sm",variant:"outline",colorScheme:"red",onClick:Ar,isLoading:ht,children:t("nodes.resetUsage","Reset usage")})]})]}):n(ue,{spacing:3,align:"stretch",children:[e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(H,{size:"sm",variant:"outline",onClick:()=>{Ye(),xt()},children:t("refresh","Refresh")})]})},"master-node"),js.length>0?js.map(de=>{var Ia,Ta,Ea,za;const gt=de.status||"error",nt=de==null?void 0:de.id,bt=gt!=="disabled"&&gt!=="limited",It=nt!=null?le[nt]:void 0,Vr=It!=null?It:bt,Zr=nt!=null&&_e===nt&&cr,jr=nt!=null&&ee===nt,_n=nt!=null&&Re===nt,Ui=E&&nt!=null&&qe===nt,Jl=Be&&nt!=null&&T===nt,Pa=e(bo,{status:gt,compact:!0}),ql=gt==="error"&&de.message?e(pt,{label:de.message,hasArrow:!0,placement:"top",openDelay:300,children:e(z,{as:"span",children:Pa})}):Pa;return e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:n(ue,{align:"stretch",spacing:4,children:[n(Ce,{spacing:2,children:[n(R,{spacing:3,align:"center",flexWrap:"wrap",children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:de.name||t("nodes.unnamedNode","Unnamed node")}),e(mt,{size:"sm",colorScheme:"primary",isChecked:Vr,onChange:()=>rr(de),isDisabled:Zr,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),de.status==="error"&&e(H,{size:"sm",variant:"outline",leftIcon:e(wo,{}),onClick:()=>tr(de),isLoading:or,children:t("nodes.reconnect")})]}),n(R,{spacing:2,flexWrap:"wrap",children:[ql,n(R,{spacing:1,align:"center",children:[e(yt,{colorScheme:"blue",size:"sm",children:de.xray_version?`Xray ${de.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(yt,{colorScheme:"green",size:"sm",children:de.node_service_version?t("nodes.nodeServiceVersionTag",{version:de.node_service_version}):t("nodes.nodeServiceVersionUnknown","Node version unknown")}),e(H,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>nt&&we({type:"node",node:de}),isLoading:jr,isDisabled:!nt,children:t("nodes.updateCoreAction")})]}),e(H,{size:"xs",variant:"ghost",onClick:()=>nt&&De({type:"node",node:de}),isLoading:_n,isDisabled:!nt,children:t("nodes.updateGeoAction","Update geo")}),e(H,{size:"xs",variant:"ghost",colorScheme:"orange",onClick:()=>yr(de),isLoading:Ui,isDisabled:!nt,children:t("nodes.restartServiceAction","Restart node service")}),e(H,{size:"xs",variant:"ghost",colorScheme:"teal",onClick:()=>Wr(de),isLoading:Jl,isDisabled:!nt,children:t("nodes.updateServiceAction","Update node service")}),e(H,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ye(de),isLoading:re&&nt!=null&&L===nt,isDisabled:!nt,children:t("nodes.resetUsage","Reset usage")})]}),gt==="limited"&&e(p,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(jn,{}),n($e,{columns:{base:1,sm:2},spacingY:2,children:[n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(p,{fontWeight:"medium",children:de.address})]}),n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(p,{fontWeight:"medium",children:de.port})]}),n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(p,{fontWeight:"medium",children:de.api_port})]}),n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(p,{fontWeight:"medium",children:de.usage_coefficient})]}),n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(p,{fontWeight:"medium",children:tt(((Ia=de.uplink)!=null?Ia:0)+((Ta=de.downlink)!=null?Ta:0),2)})]}),n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(p,{fontWeight:"medium",children:de.data_limit!=null&&de.data_limit>0?tt(de.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(jn,{}),n(R,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[n(p,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(Ea=de.id)!=null?Ea:"-"]}),n(Qo,{size:"sm",variant:"ghost",children:[e(Ue,{"aria-label":t("edit"),icon:e(Mp,{}),onClick:()=>X(de)}),e(Ue,{"aria-label":t("delete"),icon:e(Rp,{}),colorScheme:"red",onClick:()=>N(de)})]})]})]})},(za=de.id)!=null?za:de.name)}):e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(Pp,{isOpen:Boolean(P),onClose:cn,onSubmit:Ti,currentVersion:Li,title:Ri,description:Mi,allowPersist:(P==null?void 0:P.type)==="master",isSubmitting:dn}),e(zp,{isOpen:Boolean(A),onClose:fs,onSubmit:Ei,title:ri,showMasterOptions:(A==null?void 0:A.type)==="master",isSubmitting:Bn}),e(ns,{isOpen:$,leastDestructiveRef:ut,onClose:vn,children:e(wt,{children:n(ss,{children:[e(_t,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(kt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(bn=(Cn=j==null?void 0:j.name)!=null?Cn:j==null?void 0:j.address)!=null?bn:t("nodes.thisNode","this node")})}),n(zt,{children:[e(H,{ref:ut,onClick:vn,children:t("cancel","Cancel")}),e(H,{colorScheme:"red",onClick:Qr,ml:3,isLoading:re,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(ns,{isOpen:J,leastDestructiveRef:fe,onClose:se,children:e(wt,{children:n(ss,{children:[e(_t,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(kt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:bs})}),n(zt,{children:[e(H,{ref:fe,onClick:se,children:t("cancel","Cancel")}),e(H,{colorScheme:"red",onClick:()=>ot(),ml:3,isLoading:ht,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(xo,{isOpen:Y,onClose:()=>me(!1),mutate:br,isLoading:sr,isAddMode:!0}),e(xo,{isOpen:!!C,onClose:()=>X(null),node:C||void 0,mutate:ar,isLoading:ir}),e(Dp,{deleteCallback:()=>I.invalidateQueries(kr)})]})},Wp=ds(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([Pe("/core").then(({version:s,started:r,logs_websocket:l})=>{t({version:s,started:r,logs_websocket:l})}).catch(s=>{throw console.error("Error fetching /core:",s),s}),Pe("/core/config").then(s=>{t({config:s})}).catch(s=>{throw console.error("Error fetching /core/config:",s),s})])}finally{t({isLoading:!1})}},updateConfig:s=>(t({isPostLoading:!0}),Pe("/core/config",{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>Pe("/core/restart",{method:"POST"})}));const ha=d.exports.forwardRef(({json:t,onChange:s,mode:r="code"},l)=>{const{colorMode:o}=Gr(),i=d.exports.useRef(null),a=d.exports.useRef(null),c=d.exports.useRef(s),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=s},[s]);const h=d.exports.useCallback(v=>{u.current=v,c.current(v)},[]);d.exports.useEffect(()=>{if(!i.current)return;const v=new td(i.current,{mode:r,onChangeText:h,statusBar:!1,mainMenuBar:!1,theme:o==="dark"?"ace/theme/one_dark":"ace/theme/github"});a.current=v;const S=v.aceEditor;S&&(S.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),S.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?v.setText(t):t!==void 0&&v.set(t)}catch{typeof t=="string"&&v.updateText(t)}return()=>{v.destroy(),a.current=null}},[]),d.exports.useEffect(()=>{const v=a.current;if(!v)return;const y=(I=>{if(I==null)return"";if(typeof I=="string")return I;try{return JSON.stringify(I,null,2)}catch{return""}})(t);if(y===null)return;if(u.current!==null){let I=u.current;try{I=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,I===y)return}let N=null;try{N=v.getText()}catch{N=null}if(N!==y)if(typeof t=="string")try{v.updateText(y)}catch{v.setText(y)}else{const I=t==null?{}:t;try{v.update(I)}catch{v.set(I)}}},[t]),d.exports.useEffect(()=>{const v=a.current;if(!!v)try{v.getMode&&v.getMode()!==r?v.setMode(r):v.getMode||v.setMode(r)}catch{v.setMode(r)}},[r]),d.exports.useEffect(()=>{var S;const v=(S=a.current)==null?void 0:S.aceEditor;!v||v.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github")},[o]);const m=at("gray.300","whiteAlpha.300"),g=at("surface.light","surface.dark"),w=at("sm","none");return e(z,{ref:l,border:"1px solid",borderColor:m,bg:g,borderRadius:"lg",h:"full",boxShadow:w,overflow:"hidden",children:e(z,{height:"full",ref:i})})}),Fp=ie(Js,{baseStyle:{w:4,h:4}}),Hp=ie(nl,{baseStyle:{w:4,h:4}}),Hl=({triggerLabel:t,title:s,children:r})=>{const l=_r({base:!0,md:!1});return n(us,{placement:l?"bottom":"right",isLazy:!0,children:[e(hs,{children:e(H,{size:"xs",variant:"outline",children:t!=null?t:e(Fp,{})})}),n(ps,{children:[e(qs,{}),e(ul,{}),s&&e(rd,{fontWeight:"semibold",children:s}),e(ms,{children:r})]})]})},Bp=({chips:t,color:s="blue"})=>{const r=t[0],l=t.slice(1);return n(R,{spacing:2,align:"center",children:[r?e(yt,{size:"sm",colorScheme:s,children:r}):e(p,{color:"gray.400",children:"-"}),l.length>0&&e(Hl,{triggerLabel:n(yt,{size:"sm",children:["+",l.length]}),title:"Details",children:e(ue,{align:"stretch",children:t.map((o,i)=>e(R,{justify:"space-between",children:e(p,{children:o})},i))})})]})},Vp=({text:t,label:s})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:o}=hl(t!=null?t:"");return e(R,{spacing:2,align:"center",children:e(Hl,{triggerLabel:r,title:s,children:n(ue,{align:"stretch",children:[e(p,{wordBreak:"break-all",children:t}),n(R,{children:[e(Ue,{"aria-label":"copy",size:"sm",icon:e(Hp,{}),onClick:o}),e(p,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},vo=500,$p=t=>{try{let s=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(s.protocol==="https:"?"wss://":"ws://")+$o([s.host+s.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+is()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}},Bl=({showTitle:t=!0})=>{var X;const{t:s}=Ke(),{userData:r,getUserIsSuccess:l}=fr();if(!(l&&Boolean((X=r.permissions)==null?void 0:X.sections.xray)))return n(ue,{spacing:4,align:"stretch",children:[t&&e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("xrayLogs.title","Xray logs")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:s("xrayLogs.noPermission","You do not have permission to view Xray logs.")})]});const{data:i}=Aa(),[a,c]=d.exports.useState(""),[u,h]=d.exports.useState([]),m=d.exports.useRef(null),[g,w]=d.exports.useState(!0),{colorMode:v}=Gr(),S=Y=>{if(Y!==a){if(!Y){c(""),h([]);return}c(Y),h([])}},y=d.exports.useCallback(nd.exports.debounce(Y=>{h(me=>me.length>=vo?[...me.slice(me.length-vo+1),Y]:[...me,Y])},50),[]);d.exports.useEffect(()=>()=>{y.cancel()},[y]);const{readyState:N}=sd($p(a),{onMessage:Y=>{var me;y((me=Y.data)!=null?me:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const Y=m.current;if(!Y)return;const me=()=>{const oe=Y.scrollHeight-Y.scrollTop-Y.clientHeight<=32;w(oe)};return Y.addEventListener("scroll",me),me(),()=>{Y.removeEventListener("scroll",me)}},[]),d.exports.useEffect(()=>{g&&m.current&&(m.current.scrollTop=m.current.scrollHeight)},[u,g]);const I=d.exports.useMemo(()=>{const Y=v==="dark";return{error:{bg:Y?"rgba(248, 113, 113, 0.16)":"red.50",color:Y?"#fed7d7":"#c53030",border:Y?"#f87171":"#feb2b2"},warn:{bg:Y?"rgba(251, 191, 36, 0.18)":"orange.50",color:Y?"#fefcbf":"#975a16",border:Y?"#fbbf24":"#f6ad55"},info:{bg:Y?"rgba(96, 165, 250, 0.18)":"blue.50",color:Y?"#bfdbfe":"#1a56db",border:Y?"#60a5fa":"#63b3ed"},debug:{bg:Y?"rgba(148, 163, 184, 0.16)":"gray.100",color:Y?"#e2e8f0":"#1f2933",border:Y?"#94a3b8":"#cbd5e1"},default:{bg:Y?"rgba(30, 64, 175, 0.1)":"gray.50",color:Y?"#e2e8f0":"#1f2933",border:Y?"#475569":"#e2e8f0"}}},[v]),M=at("#f5f7fb","#1f2329"),ae=at("gray.200","gray.600"),b=at("gray.500","gray.400"),F=at("white","gray.700"),C=Y=>/error|failed|exception/i.test(Y)?"error":/warn/i.test(Y)?"warn":/info/i.test(Y)?"info":/debug/i.test(Y)?"debug":"default";return n(ue,{spacing:6,align:"stretch",children:[t&&e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("header.xrayLogs")}),n(Ce,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[n(Ce,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(i==null?void 0:i[0])&&n(st,{size:"sm",w:{base:"full",sm:"auto"},bg:F,onChange:Y=>S(Y.target.value),value:a,children:[e("option",{value:"",children:s("core.master")}),i.map(Y=>e("option",{value:String(Y.id),children:s(Y.name)},Y.address))]}),e(p,{fontSize:"sm",color:b,children:s(`core.socket.${N}`)})]}),e(p,{fontSize:"xs",color:b,children:g?s("core.autoScrollOn","Auto-scroll: On"):s("core.autoScrollOff","Auto-scroll: Off")})]}),e(z,{border:"1px solid",borderColor:ae,bg:M,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:m,fontFamily:"mono",fontSize:"sm",children:e(ue,{align:"stretch",spacing:2,children:u.map((Y,me)=>{var P;const O=C(Y),oe=(P=I[O])!=null?P:I.default;return e(z,{bg:oe.bg,color:oe.color,borderLeftWidth:3,borderLeftColor:oe.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(ie.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:Y})},`${Y}-${me}`)})})})]})},Kp=ie(gn),Jp=ie(pl),mr={tag:"",protocol:he.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:Rl.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},Jn=t=>{const s={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case he.VMess:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case he.VLESS:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case he.Trojan:s.servers=[{address:r,port:l,password:t.password||void 0}];break;case he.Shadowsocks:s.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case he.Socks:case he.HTTP:s.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case he.Freedom:s.domainStrategy=t.freedomStrategy||void 0;break;case he.Blackhole:s.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case he.DNS:s.network=t.dnsNetwork,s.address=t.dnsAddress||void 0,s.port=Number(t.dnsPort)||void 0;break;case he.Wireguard:s.secretKey=t.wireguardSecret||void 0,s.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,s.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const o=new Sn;o.network=t.network,o.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?o.tcp=new mn(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?o.ws=new Ln(t.wsPath,t.wsHost,0):t.network==="grpc"&&(o.grpc=new Un(t.grpcServiceName,"",!1)),t.tlsEnabled&&(o.tls=new On(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(o.reality=new cs(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const a=new Qt(t.tag,t.protocol,s,o,void 0).toJson();return a.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(a.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),a},qp=({isOpen:t,onClose:s,mode:r,initialOutbound:l,onSubmitOutbound:o})=>{const{t:i}=Ke(),a=Kt(),c=at("gray.50","whiteAlpha.100"),{control:u,register:h,reset:m,handleSubmit:g,watch:w,getValues:v,setValue:S,formState:{isValid:y}}=Br({defaultValues:mr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{h("tlsEnabled"),h("realityEnabled")},[h]);const{fields:N,append:I,remove:M}=Xn({control:u,name:"wireguardPeers"}),ae=w("protocol"),b=w("network"),F=w("tlsEnabled"),C=w("realityEnabled"),X=w("tcpType"),Y=w("muxEnabled"),me=i("validation.required",{defaultValue:"Required"}),O=i("validation.invalidPort",{defaultValue:"Invalid port"}),oe=ae||he.VLESS,P=![he.Freedom,he.Blackhole,he.DNS,he.Wireguard].includes(oe),we=[he.VMess,he.VLESS].includes(oe),A=[he.Trojan,he.Shadowsocks].includes(oe),De=oe===he.Shadowsocks,ee=oe===he.DNS,Ae=Jt({control:u}),[Re,Me]=d.exports.useState(0),[G,D]=d.exports.useState(()=>Jn(mr)),[V,ge]=d.exports.useState(()=>JSON.stringify(Jn(mr),null,2)),[pe,Z]=d.exports.useState(null),[_e,te]=d.exports.useState(""),le=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;Me(0),Z(null),te("");const T=l?L(l):mr;le.current=!0,m(T);const ce=Jn(T);D(ce),ge(JSON.stringify(ce,null,2))},[l,t,m]),d.exports.useEffect(()=>{if(!Ae)return;if(le.current){le.current=!1;return}const T=Jn(Ae);D(T);const ce=JSON.stringify(T,null,2);ge($=>$===ce?$:ce),Z(null)},[Ae]);const B=d.exports.useMemo(()=>[he.VLESS,he.VMess,he.Trojan,he.Shadowsocks,he.Socks,he.HTTP,he.Freedom,he.Blackhole,he.DNS,he.Wireguard],[]),L=T=>{var dt,ut,Q,W,Se,Le,J,He,se,fe,Ie,Ve,Ye,rt,Je,Ze,Wt,xt,sr,br,ir,ar,or,tr,lr,cr,re,ke,K,E,Ee,Be,Oe,We,ht,ot,Tt,Yt,Gt,dr,Lr,lt,Pt,Nt,ur,hr,Ur,Zt,pr,Xr,Et,Or,Rt,Ar,rr;const ce=Qt.fromJson(T),$={...mr,tag:(dt=T==null?void 0:T.tag)!=null?dt:"",protocol:(ce==null?void 0:ce.protocol)||mr.protocol,sendThrough:(ut=T==null?void 0:T.sendThrough)!=null?ut:"",muxEnabled:Boolean((Q=T==null?void 0:T.mux)==null?void 0:Q.enabled),muxConcurrency:Number((Se=(W=T==null?void 0:T.mux)==null?void 0:W.concurrency)!=null?Se:mr.muxConcurrency)},be=ce==null?void 0:ce.stream;switch($.network=(Le=be==null?void 0:be.network)!=null?Le:mr.network,$.tlsEnabled=(be==null?void 0:be.security)==="tls",$.realityEnabled=(be==null?void 0:be.security)==="reality",$.tlsServerName=(He=(J=be==null?void 0:be.tls)==null?void 0:J.serverName)!=null?He:"",$.realityPublicKey=(fe=(se=be==null?void 0:be.reality)==null?void 0:se.publicKey)!=null?fe:"",$.realityShortId=(Ve=(Ie=be==null?void 0:be.reality)==null?void 0:Ie.shortId)!=null?Ve:"",(be==null?void 0:be.network)==="tcp"&&be.tcp&&($.tcpType=be.tcp.type,$.tcpHost=(Ye=be.tcp.host)!=null?Ye:"",$.tcpPath=(rt=be.tcp.path)!=null?rt:""),(be==null?void 0:be.network)==="ws"&&be.ws&&($.wsHost=(Je=be.ws.host)!=null?Je:"",$.wsPath=(Ze=be.ws.path)!=null?Ze:""),(be==null?void 0:be.network)==="grpc"&&be.grpc&&($.grpcServiceName=(Wt=be.grpc.serviceName)!=null?Wt:""),ce!=null&&ce.hasAddressPort()&&($.address=(ir=(br=(xt=ce.settings)==null?void 0:xt.address)!=null?br:(sr=T==null?void 0:T.settings)==null?void 0:sr.address)!=null?ir:"",$.port=Number((lr=(tr=(ar=ce.settings)==null?void 0:ar.port)!=null?tr:(or=T==null?void 0:T.settings)==null?void 0:or.port)!=null?lr:mr.port)),$.protocol){case he.VMess:{const ye=ce.settings;$.id=(cr=ye==null?void 0:ye.id)!=null?cr:"",$.vnextEncryption=(re=ye==null?void 0:ye.security)!=null?re:mr.vnextEncryption,$.address=(ke=ye==null?void 0:ye.address)!=null?ke:$.address,$.port=Number((K=ye==null?void 0:ye.port)!=null?K:$.port);break}case he.VLESS:{const ye=ce.settings;$.id=(E=ye==null?void 0:ye.id)!=null?E:"",$.flow=(Ee=ye==null?void 0:ye.flow)!=null?Ee:"",$.encryption=(Be=ye==null?void 0:ye.encryption)!=null?Be:$.encryption,$.address=(Oe=ye==null?void 0:ye.address)!=null?Oe:$.address,$.port=Number((We=ye==null?void 0:ye.port)!=null?We:$.port);break}case he.Trojan:{const ye=ce.settings;$.password=(ht=ye==null?void 0:ye.password)!=null?ht:"",$.address=(ot=ye==null?void 0:ye.address)!=null?ot:$.address,$.port=Number((Tt=ye==null?void 0:ye.port)!=null?Tt:$.port);break}case he.Shadowsocks:{const ye=ce.settings;$.password=(Yt=ye==null?void 0:ye.password)!=null?Yt:"",$.method=(Gt=ye==null?void 0:ye.method)!=null?Gt:mr.method,$.address=(dr=ye==null?void 0:ye.address)!=null?dr:$.address,$.port=Number((Lr=ye==null?void 0:ye.port)!=null?Lr:$.port);break}case he.Socks:case he.HTTP:{const ye=($.protocol===he.Socks,ce.settings);$.user=(lt=ye==null?void 0:ye.user)!=null?lt:"",$.pass=(Pt=ye==null?void 0:ye.pass)!=null?Pt:"",$.address=(Nt=ye==null?void 0:ye.address)!=null?Nt:$.address,$.port=Number((ur=ye==null?void 0:ye.port)!=null?ur:$.port);break}case he.DNS:{const ye=ce.settings;$.dnsNetwork=(hr=ye==null?void 0:ye.network)!=null?hr:mr.dnsNetwork,$.dnsAddress=(Ur=ye==null?void 0:ye.address)!=null?Ur:"",$.dnsPort=Number((Zt=ye==null?void 0:ye.port)!=null?Zt:mr.dnsPort);break}case he.Freedom:{const ye=ce.settings;$.freedomStrategy=(pr=ye==null?void 0:ye.domainStrategy)!=null?pr:"";break}case he.Blackhole:{const ye=ce.settings;$.blackholeResponse=(Xr=ye==null?void 0:ye.type)!=null?Xr:"";break}case he.Wireguard:{const ye=ce.settings;$.wireguardSecret=(Et=ye==null?void 0:ye.secretKey)!=null?Et:"",$.wireguardAddress=(Or=ye==null?void 0:ye.address)!=null?Or:"";const yr=(Ar=(Rt=ye==null?void 0:ye.peers)==null?void 0:Rt.map(Wr=>{var Qr,vn,cn;return{publicKey:(Qr=Wr.publicKey)!=null?Qr:"",allowedIPs:Array.isArray(Wr.allowedIPs)?Wr.allowedIPs.join(","):"",endpoint:(vn=Wr.endpoint)!=null?vn:"",keepAlive:Number((cn=Wr.keepAlive)!=null?cn:0)}}))!=null?Ar:[];$.wireguardPeers=yr.length>0?yr:mr.wireguardPeers;break}}return((rr=T==null?void 0:T.mux)==null?void 0:rr.concurrency)!=null&&($.muxConcurrency=Number(T.mux.concurrency)),(!$.wireguardPeers||$.wireguardPeers.length===0)&&($.wireguardPeers=mr.wireguardPeers),$},U=T=>{ge(T);try{const ce=JSON.parse(T);Z(null),D(ce),le.current=!0;const $=L(ce);m($)}catch(ce){Z(ce.message)}},j=()=>{const T=_e.trim();if(!T){Z(i("pages.outbound.configEmpty","Please paste a config link"));return}const ce=Qt.fromLink(T);if(!ce){Z(i("pages.outbound.invalidConfig","Unsupported or invalid config link")),a({status:"error",duration:2500,position:"top",title:i("pages.outbound.configParseFailedTitle","Conversion failed"),description:i("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const $=ce.toJson(),be=JSON.stringify($,null,2);te(""),U(be),a({status:"success",duration:2e3,position:"top",title:i("pages.outbound.configConvertedTitle","Config converted"),description:i("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},Te=g(async T=>{var $;const ce=Jn(T);try{await o(ce),a({title:r==="edit"?i("pages.xray.outbound.updated","Outbound updated"):i("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),s()}catch(be){a({title:(($=be==null?void 0:be.data)==null?void 0:$.detail)||(be==null?void 0:be.message)||i("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),qe=()=>{s()},Qe=T=>{if(Me(T),T===1){const ce=Jn(v());D(ce);const $=JSON.stringify(ce,null,2);ge(be=>be===$?be:$),Z(null)}};return n(Lt,{size:"4xl",isOpen:t,onClose:qe,scrollBehavior:"inside",children:[e(wt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),n(Ut,{as:"form",onSubmit:Te,children:[e(_t,{children:r==="edit"?i("pages.xray.outbound.editOutbound","Edit Outbound"):i("pages.xray.outbound.addOutbound")}),e(Ot,{}),e(kt,{children:n(Wn,{variant:"enclosed",colorScheme:"primary",index:Re,onChange:Qe,children:[n(Fn,{children:[e(Vt,{children:i("form")}),e(Vt,{children:i("json")})]}),n(Hn,{children:[e($t,{children:n(ue,{spacing:6,align:"stretch",children:[n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.basicSettings","Basic settings")}),n(ue,{spacing:3,align:"stretch",children:[n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.outbound.tag")}),e(ve,{size:"sm",placeholder:"outbound-tag",...h("tag",{required:me})})]}),n(R,{children:[n(k,{isRequired:!0,children:[e(_,{children:i("protocol")}),e(st,{size:"sm",...h("protocol"),children:B.map(T=>e("option",{value:T,children:T},T))})]}),n(k,{children:[e(_,{children:i("pages.xray.outbound.sendThrough")}),e(ve,{size:"sm",placeholder:"0.0.0.0",...h("sendThrough")})]})]})]})]}),P&&n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.endpoint","Endpoint")}),n(ue,{spacing:3,align:"stretch",children:[n(k,{isRequired:P,children:[e(_,{children:i("pages.outbound.address","Address")}),e(ve,{size:"sm",placeholder:"example.com",...h("address",{required:P?me:!1})})]}),n(R,{children:[n(k,{isRequired:P,children:[e(_,{children:i("pages.outbound.port","Port")}),e(ve,{size:"sm",type:"number",min:1,max:65535,...h("port",{required:P?me:!1,valueAsNumber:!0,min:{value:1,message:O},max:{value:65535,message:O}})})]}),we?n(k,{isRequired:we,children:[e(_,{children:"ID"}),e(ve,{size:"sm",placeholder:"UUID",...h("id",{required:we?me:!1})})]}):A?n(k,{isRequired:A,children:[e(_,{children:i("password")}),e(ve,{size:"sm",placeholder:"password",...h("password",{required:A?me:!1})})]}):n(k,{children:[e(_,{children:i("username")}),e(ve,{size:"sm",placeholder:"username",...h("user")})]})]}),oe===he.Shadowsocks&&n(k,{isRequired:De,children:[e(_,{children:i("pages.outbound.method","Method")}),e(st,{size:"sm",...h("method",{required:De?me:!1}),children:Object.values(Rl).map(T=>e("option",{value:T,children:T},T))})]}),oe===he.VLESS&&n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.encryption","Encryption")}),e(ve,{size:"sm",placeholder:"none",...h("encryption")})]}),n(k,{children:[e(_,{children:"Flow"}),e(ve,{size:"sm",placeholder:"xtls-rprx-vision",...h("flow")})]})]}),oe===he.VMess&&n(k,{children:[e(_,{children:i("pages.outbound.security","User security")}),e(ve,{size:"sm",placeholder:"auto",...h("vnextEncryption")})]})]})]}),oe===he.DNS&&n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.dnsSettings","DNS settings")}),n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.network")}),n(st,{size:"sm",...h("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),n(k,{isRequired:ee,children:[e(_,{children:i("pages.outbound.port")}),e(ve,{size:"sm",type:"number",min:1,max:65535,...h("dnsPort",{required:ee?me:!1,valueAsNumber:!0,min:{value:1,message:O},max:{value:65535,message:O}})})]})]}),n(k,{mt:3,isRequired:ee,children:[e(_,{children:i("pages.outbound.address")}),e(ve,{size:"sm",placeholder:"8.8.8.8",...h("dnsAddress",{required:ee?me:!1})})]})]}),oe===he.Freedom&&n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.freedom","Freedom options")}),n(k,{children:[e(_,{children:i("pages.outbound.strategy","Strategy")}),e(ve,{size:"sm",placeholder:"UseIP",...h("freedomStrategy")})]})]}),oe===he.Blackhole&&n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.blackhole","Blackhole options")}),n(k,{children:[e(_,{children:i("pages.outbound.response")}),e(ve,{size:"sm",placeholder:"none",...h("blackholeResponse")})]})]}),oe===he.Wireguard&&n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.wireguard","Wireguard")}),n(ue,{spacing:3,align:"stretch",children:[n(k,{children:[e(_,{children:i("pages.outbound.secretKey","Secret key")}),e(ve,{size:"sm",...h("wireguardSecret")})]}),n(k,{children:[e(_,{children:i("pages.outbound.address")}),e(ve,{size:"sm",placeholder:"10.0.0.1/32",...h("wireguardAddress")})]}),n(ue,{spacing:3,align:"stretch",children:[n(R,{justify:"space-between",children:[e(p,{fontWeight:"semibold",children:i("pages.outbound.peer","Peers")}),e(Ue,{size:"sm","aria-label":i("add"),icon:e(Kp,{boxSize:3}),onClick:()=>I({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),N.map((T,ce)=>n(z,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.publicKey","Public key")}),e(ve,{size:"sm",...h(`wireguardPeers.${ce}.publicKey`)})]}),N.length>1&&e(Ue,{mt:6,size:"sm","aria-label":i("delete"),icon:e(Jp,{boxSize:3}),onClick:()=>M(ce)})]}),n(R,{mt:2,children:[n(k,{children:[e(_,{children:i("pages.outbound.allowedIPs","Allowed IPs")}),e(ve,{size:"sm",...h(`wireguardPeers.${ce}.allowedIPs`)})]}),n(k,{children:[e(_,{children:i("pages.outbound.endpoint","Endpoint")}),e(ve,{size:"sm",...h(`wireguardPeers.${ce}.endpoint`)})]})]}),n(k,{mt:2,children:[e(_,{children:i("pages.outbound.keepAlive","Keep alive")}),e(ve,{size:"sm",type:"number",...h(`wireguardPeers.${ce}.keepAlive`,{valueAsNumber:!0})})]})]},T.id))]})]})]}),n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.transport","Transport")}),n(ue,{spacing:3,align:"stretch",children:[n(k,{children:[e(_,{children:i("pages.outbound.network")}),n(st,{size:"sm",...h("network"),onChange:T=>{h("network").onChange(T)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),b==="tcp"&&n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.tcpHeader","Header")}),n(st,{size:"sm",...h("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),X==="http"&&n(Ft,{children:[n(k,{children:[e(_,{children:i("host")}),e(ve,{size:"sm",...h("tcpHost")})]}),n(k,{children:[e(_,{children:i("path")}),e(ve,{size:"sm",...h("tcpPath")})]})]})]}),b==="ws"&&n(R,{children:[n(k,{children:[e(_,{children:i("host")}),e(ve,{size:"sm",...h("wsHost")})]}),n(k,{children:[e(_,{children:i("path")}),e(ve,{size:"sm",...h("wsPath")})]})]}),b==="grpc"&&n(k,{children:[e(_,{children:i("serviceName")}),e(ve,{size:"sm",...h("grpcServiceName")})]})]})]}),n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.security")}),n(R,{children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"TLS"}),e(mt,{size:"sm",isChecked:F,onChange:T=>{const ce=T.target.checked;S("tlsEnabled",ce),ce&&S("realityEnabled",!1)}})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"Reality"}),e(mt,{size:"sm",isChecked:C,onChange:T=>{const ce=T.target.checked;S("realityEnabled",ce),ce&&S("tlsEnabled",!1)}})]})]}),F&&n(k,{mt:3,children:[e(_,{children:"SNI"}),e(ve,{size:"sm",placeholder:"example.com",...h("tlsServerName")})]}),C&&n(ue,{spacing:3,align:"stretch",mt:3,children:[n(k,{children:[e(_,{children:"SNI"}),e(ve,{size:"sm",...h("tlsServerName")})]}),n(k,{children:[e(_,{children:i("pages.outbound.publicKey")}),e(ve,{size:"sm",...h("realityPublicKey")})]}),n(k,{children:[e(_,{children:i("pages.outbound.shortId")}),e(ve,{size:"sm",...h("realityShortId")})]})]})]}),n(z,{children:[e(p,{fontWeight:"semibold",mb:3,children:i("pages.outbound.mux")}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:i("pages.outbound.enableMux")}),e(mt,{size:"sm",...h("muxEnabled")})]}),Y&&n(k,{mt:3,children:[e(_,{children:i("pages.outbound.concurrency")}),e(ve,{size:"sm",type:"number",...h("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e($t,{children:n(ue,{align:"stretch",spacing:3,children:[n(k,{children:[e(_,{children:i("pages.outbound.configToJson","Config to JSON")}),n(R,{align:"start",spacing:3,children:[e(Cr,{value:_e,onChange:T=>te(T.target.value),placeholder:i("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(H,{size:"sm",colorScheme:"primary",onClick:j,children:i("pages.outbound.convertConfig","Convert")})]})]}),e(z,{height:"420px",children:e(ha,{json:G,onChange:U})}),pe&&e(p,{fontSize:"sm",color:"red.500",children:pe})]})})]})]})}),n(zt,{gap:3,children:[e(H,{variant:"outline",onClick:qe,children:i("cancel")}),e(H,{colorScheme:"primary",type:"submit",isDisabled:!y,children:i(r==="edit"?"save":"add")})]})]})]})},Yp=["tcp","udp","http","quic","grpc"],Gp=["http","tls","bittorrent","quic"],Xp=["field","chained"],Qp=["","hybrid","linear"],Vl={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},qn=t=>Array.isArray(t)?t.join(", "):"",Yn=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean),Zp=t=>{var r,l,o,i;if(!t)return{...Vl};const s=t.attrs?Object.entries(t.attrs).map(([a,c])=>({key:a,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(o=t.outboundTag)!=null?o:"",balancerTag:(i=t.balancerTag)!=null?i:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:qn(t.source),sourcePort:qn(t.sourcePort),domain:qn(t.domain),ip:qn(t.ip),user:qn(t.user),port:qn(t.port),attrs:s}},jp=t=>{const s={};t.type&&(s.type=t.type),t.domainMatcher&&(s.domainMatcher=t.domainMatcher),t.outboundTag&&(s.outboundTag=t.outboundTag),t.balancerTag&&(s.balancerTag=t.balancerTag),t.inboundTags.length&&(s.inboundTag=t.inboundTags),t.networks.length&&(s.network=t.networks),t.protocols.length&&(s.protocol=t.protocols);const r=Yn(t.sourceIps);r.length&&(s.source=r);const l=Yn(t.sourcePort);l.length&&(s.sourcePort=l);const o=Yn(t.domain);o.length&&(s.domain=o);const i=Yn(t.ip);i.length&&(s.ip=i);const a=Yn(t.user);a.length&&(s.user=a);const c=Yn(t.port);if(c.length&&(s.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:h,value:m})=>{!h.trim()||(u[h.trim()]=m)}),Object.keys(u).length&&(s.attrs=u)}return s.type||(s.type="field"),s},em=({isOpen:t,mode:s,initialRule:r,availableInboundTags:l,availableOutboundTags:o,availableBalancerTags:i,onSubmit:a,onClose:c})=>{const{t:u}=Ke(),h=at("white","gray.900"),{control:m,register:g,handleSubmit:w,reset:v,formState:{isSubmitting:S}}=Br({defaultValues:Vl}),{fields:y,append:N,remove:I}=Xn({control:m,name:"attrs"});d.exports.useEffect(()=>{t&&v(Zp(r))},[t,r,v]);const M=()=>N({key:"",value:""}),ae=()=>{c()},b=w(C=>{const X=jp(C);a(X),ae()}),F=d.exports.useMemo(()=>s==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[s,u]);return n(Lt,{isOpen:t,onClose:ae,size:"xl",scrollBehavior:"inside",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{as:"form",onSubmit:b,bg:h,children:[e(_t,{children:F}),e(Ot,{}),e(kt,{children:n(Ce,{spacing:5,children:[n(k,{children:[e(_,{children:u("pages.xray.rules.type","Rule Type")}),e(st,{...g("type"),size:"sm",children:Xp.map(C=>e("option",{value:C,children:C||u("core.none","None")},C))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(st,{...g("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:o.map(C=>e("option",{value:C,children:C},C))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(st,{...g("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:i.map(C=>e("option",{value:C,children:C},C))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(ft,{control:m,name:"inboundTags",render:({field:C})=>e(ui,{...C,children:e(hi,{spacing:3,children:l.map(X=>e(Ws,{children:e(Nr,{value:X,children:X})},X))})})})]}),e(jn,{}),n(k,{children:[e(_,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(st,{...g("domainMatcher"),size:"sm",children:Qp.map(C=>e("option",{value:C,children:C||u("core.default","Default")},C||"empty"))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.network","Network")}),e(ft,{control:m,name:"networks",render:({field:C})=>e(ui,{...C,children:e(hi,{spacing:3,children:Yp.map(X=>e(Ws,{children:e(Nr,{value:X,children:X})},X))})})})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.protocol","Protocol")}),e(ft,{control:m,name:"protocols",render:({field:C})=>e(ui,{...C,children:e(hi,{spacing:3,children:Gp.map(X=>e(Ws,{children:e(Nr,{value:X,children:X})},X))})})})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.source","Source IPs")}),e(Cr,{...g("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(Cr,{...g("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.ip","Destination IPs")}),e(Cr,{...g("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.domain","Domains")}),e(Cr,{...g("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.user","Users")}),e(Cr,{...g("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.port","Ports")}),e(Cr,{...g("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(jn,{}),n(z,{children:[n(k,{children:[e(_,{children:u("pages.xray.rules.attrs","Attributes")}),e(H,{onClick:M,size:"xs",leftIcon:e(gn,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),n(Ce,{spacing:2,mt:3,children:[y.length===0&&e(p,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),y.map((C,X)=>n(R,{spacing:2,align:"flex-start",children:[e(ve,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...g(`attrs.${X}.key`)}),e(ve,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...g(`attrs.${X}.value`)}),e(Ue,{"aria-label":"Remove attribute",icon:e(fa,{width:16}),size:"sm",variant:"ghost",onClick:()=>I(X)})]},C.id))]})]})]})}),n(zt,{gap:3,children:[e(H,{variant:"outline",onClick:ae,children:u("cancel")}),e(H,{colorScheme:"primary",type:"submit",isLoading:S,children:s==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},tm=({isOpen:t,onClose:s,form:r,setBalancersData:l,balancerIndex:o})=>{const{t:i}=Ke(),a=Br({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=a.handleSubmit(u=>{const h={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},m=r.getValues("config.routing.balancers")||[];o!==void 0?m[o]=h:m.push(h),r.setValue("config.routing.balancers",m,{shouldDirty:!0}),l(m.map((g,w)=>{var v;return{key:w,tag:g.tag||"",strategy:((v=g.strategy)==null?void 0:v.type)||"random",selector:g.selector||[],fallbackTag:g.fallbackTag||""}})),s()});return n(Lt,{isOpen:t,onClose:s,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(_t,{pt:6,children:e(p,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Ot,{mt:3}),e(kt,{children:e("form",{onSubmit:c,children:n(ue,{spacing:4,children:[n(k,{children:[e(_,{children:i("pages.xray.balancer.tag")}),e(ve,{...a.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),n(k,{children:[e(_,{children:i("pages.xray.balancer.balancerStrategy")}),e(st,{...a.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),n(k,{children:[e(_,{children:i("pages.xray.balancer.balancerSelectors")}),e(ve,{...a.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),n(k,{children:[e(_,{children:i("pages.xray.balancer.fallbackTag")}),e(ve,{...a.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(H,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},rm=({isOpen:t,onClose:s,form:r,setDnsServers:l,dnsIndex:o})=>{const{t:i}=Ke(),a=Br({defaultValues:{address:"",domains:"",expectIPs:""}}),c=a.handleSubmit(u=>{const h={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},m=r.getValues("config.dns.servers")||[];o!==void 0?m[o]=h:m.push(h),r.setValue("config.dns.servers",m,{shouldDirty:!0}),l(m),s()});return n(Lt,{isOpen:t,onClose:s,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(_t,{pt:6,children:e(p,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Ot,{mt:3}),e(kt,{children:e("form",{onSubmit:c,children:n(ue,{spacing:4,children:[n(k,{children:[e(_,{children:i("pages.xray.dns.address")}),e(ve,{...a.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),n(k,{children:[e(_,{children:i("pages.xray.dns.domains")}),e(ve,{...a.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),n(k,{children:[e(_,{children:i("pages.xray.dns.expectIPs")}),e(ve,{...a.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(H,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},nm=({isOpen:t,onClose:s,form:r,setFakeDns:l,fakeDnsIndex:o})=>{const{t:i}=Ke(),a=Br({defaultValues:{ipPool:"",poolSize:""}}),c=a.handleSubmit(u=>{const h={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},m=r.getValues("config.fakedns")||[];o!==void 0?m[o]=h:m.push(h),r.setValue("config.fakedns",m.length>0?m:null,{shouldDirty:!0}),l(m),s()});return n(Lt,{isOpen:t,onClose:s,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(_t,{pt:6,children:e(p,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Ot,{mt:3}),e(kt,{children:e("form",{onSubmit:c,children:n(ue,{spacing:4,children:[n(k,{children:[e(_,{children:i("pages.xray.fakedns.ipPool")}),e(ve,{...a.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),n(k,{children:[e(_,{children:i("pages.xray.fakedns.poolSize")}),e(ve,{...a.register("poolSize"),size:"sm",placeholder:"100"})]}),e(H,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},pa={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Co=t=>{var u,h,m,g,w,v,S,y,N,I,M,ae,b;if(!t)return{...pa};const s=(u=t.settings)!=null?u:{},l=(h=(Array.isArray(s.peers)?s.peers:[])[0])!=null?h:{},o=Array.isArray(s.address)?s.address:[],i=(g=(m=o.find(F=>typeof F=="string"&&F.endsWith("/32")))==null?void 0:m.replace("/32",""))!=null?g:"",a=(v=(w=o.find(F=>typeof F=="string"&&F.endsWith("/128")))==null?void 0:w.replace("/128",""))!=null?v:"",c=Array.isArray(s.reserved)?s.reserved.filter(F=>Number.isFinite(Number(F))).join(","):"";return{tag:(S=t.tag)!=null?S:"warp",privateKey:(N=(y=s.secretKey)!=null?y:s.privateKey)!=null?N:"",publicKey:(I=l.publicKey)!=null?I:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:i,addressV6:a,reserved:c,mtu:(M=s.mtu)!=null?M:1420,domainStrategy:(ae=s.domainStrategy)!=null?ae:"ForceIP",notes:typeof t.notes=="string"?t.notes:(b=s.notes)!=null?b:""}},sm=t=>{const s=[];t.addressV4.trim()&&s.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&s.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(i=>Number(i.trim())).filter(i=>Number.isFinite(i)),o=Qt.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:s,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?o.notes=t.notes.trim():delete o.notes,o},im=t=>{if(!t)return[];try{const s=atob(t);return Array.from(s).map(r=>r.charCodeAt(0))}catch{return[]}},am=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const s=t;return s.host?s.port?`${s.host}:${s.port}`:s.host:""}return""},om=(t,s)=>{var h,m,g,w,v,S,y,N,I,M,ae;if(!t||!(s!=null&&s.config))return null;const r=s.config,l=[],o=(m=(h=r.interface)==null?void 0:h.addresses)!=null?m:{};o.v4&&l.push(`${o.v4}/32`),o.v6&&l.push(`${o.v6}/128`);const a=(g=(Array.isArray(r.peers)?r.peers:[])[0])!=null?g:{},c=(v=(w=a.allowed_ips)!=null?w:a.allowedIPs)!=null?v:["0.0.0.0/0","::/0"];return Qt.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(y=(S=r.interface)==null?void 0:S.mtu)!=null?y:1420,secretKey:t.private_key,address:l,reserved:im(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(I=(N=a.public_key)!=null?N:t.public_key)!=null?I:"",endpoint:am(a.endpoint),allowedIPs:c,keepAlive:(ae=(M=a.keep_alive)!=null?M:a.keepAlive)!=null?ae:0}]}})},_o=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},Qi=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":Tn.sizeFormat(t),gr=({label:t,value:s})=>{const r=at("gray.500","gray.400");return n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(p,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:s||"-"})]})},lm=({isOpen:t,onClose:s,initialOutbound:r,onSave:l,onDelete:o})=>{var _e,te,le,B,L;const{t:i}=Ke(),a=Kt(),[c,u]=d.exports.useState({...pa}),[h,m]=d.exports.useState(null),[g,w]=d.exports.useState(null),[v,S]=d.exports.useState(null),[y,N]=d.exports.useState(""),[I,M]=d.exports.useState(!1),[ae,b]=d.exports.useState(!1),[F,C]=d.exports.useState(!1),[X,Y]=d.exports.useState(!1),[me,O]=d.exports.useState(!1);d.exports.useEffect(()=>{dp()},[]);const oe=d.exports.useCallback(async()=>{var U,j;M(!0);try{const Te=await Pe("/core/warp",{method:"GET"});m((U=Te.account)!=null?U:null),w(null),S(null)}catch(Te){a({title:i("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((j=Te==null?void 0:Te.data)==null?void 0:j.detail)||(Te==null?void 0:Te.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{M(!1)}},[a,i]);d.exports.useEffect(()=>{t&&oe().catch(()=>{})},[t,oe]),d.exports.useEffect(()=>{t&&u(Co(r))},[r,t]),d.exports.useEffect(()=>{var U;N((U=h==null?void 0:h.license_key)!=null?U:"")},[h]);const P=(U,j)=>{u(Te=>({...Te,[U]:j}))},we=at("gray.600","gray.300"),A=at("gray.200","whiteAlpha.200"),De=()=>{const U=vi();P("privateKey",U.privateKey),P("publicKey",U.publicKey),a({title:i("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},ee=()=>{const U=Array.from({length:3},()=>Math.floor(Math.random()*256));P("reserved",U.join(","))},Ae=d.exports.useCallback((U,j)=>{if(!U||!j){S(null);return}const Te=om(U,j);Te&&(S(Te),u(Co(Te.toJson())))},[]),Re=async()=>{var U;b(!0);try{const j=vi(),Te=await Pe("/core/warp/register",{method:"POST",body:{private_key:j.privateKey,public_key:j.publicKey}});m(Te.account),w(Te.config),Ae(Te.account,Te.config),a({title:i("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(j){a({title:i("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((U=j==null?void 0:j.data)==null?void 0:U.detail)||(j==null?void 0:j.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{b(!1)}},Me=async()=>{var U;if(!h){a({title:i("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}Y(!0);try{const j=await Pe("/core/warp/config",{method:"GET"});w(j.config),Ae(h,j.config),a({title:i("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(j){a({title:i("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((U=j==null?void 0:j.data)==null?void 0:U.detail)||(j==null?void 0:j.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{Y(!1)}},G=async()=>{var U;if(!!y.trim()){C(!0);try{const j=await Pe("/core/warp/license",{method:"POST",body:{license_key:y.trim()}});m(j.account),a({title:i("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(j){a({title:i("pages.xray.warp.licenseFailed","Failed to update license."),description:((U=j==null?void 0:j.data)==null?void 0:U.detail)||(j==null?void 0:j.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{C(!1)}}},D=async()=>{var U;O(!0);try{await Pe("/core/warp",{method:"DELETE"}),m(null),w(null),S(null),o(),a({title:i("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(j){a({title:i("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((U=j==null?void 0:j.data)==null?void 0:U.detail)||(j==null?void 0:j.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{O(!1)}},V=()=>{if(!v)return;const U=v.toJson();l(U),a({title:i("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},ge=()=>{o(),u({...pa}),a({title:i("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},pe=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){a({title:i("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const U=sm(c);l(U),s()},Z=d.exports.useMemo(()=>Boolean(r),[r]);return n(Lt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),n(Ut,{children:[e(_t,{children:i("pages.xray.warp.manage","Manage WARP")}),e(Ot,{}),e(kt,{children:n(ue,{spacing:5,align:"stretch",children:[n(Er,{status:"info",borderRadius:"md",children:[e(zr,{}),e(wn,{children:i("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(z,{borderWidth:"1px",borderColor:A,borderRadius:"lg",p:4,children:h?n(ue,{spacing:4,align:"stretch",children:[n($e,{columns:{base:1,md:2},spacing:4,children:[e(gr,{label:i("pages.xray.warp.accessToken","Access token"),value:h.access_token||"-"}),e(gr,{label:i("pages.xray.warp.deviceId","Device ID"),value:h.device_id||"-"}),e(gr,{label:i("pages.xray.warp.licenseKey","License key"),value:h.license_key||"-"}),e(gr,{label:i("pages.xray.warp.privateKey","Private key"),value:h.private_key||"-"}),e(gr,{label:i("pages.xray.warp.registeredAt","Registered at"),value:_o(h.created_at)}),e(gr,{label:i("pages.xray.warp.updatedAt","Updated at"),value:_o(h.updated_at)})]}),n(R,{spacing:3,flexWrap:"wrap",children:[e(H,{variant:"outline",onClick:Me,isLoading:X,children:i("pages.xray.warp.fetchInfo","Refresh info")}),e(H,{variant:"ghost",colorScheme:"red",onClick:D,isLoading:me,children:i("pages.xray.warp.removeAccount","Remove account")})]})]}):n(ue,{spacing:3,align:"stretch",children:[e(p,{fontSize:"sm",color:we,children:i("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(H,{colorScheme:"primary",onClick:Re,isLoading:ae||I,children:i("pages.xray.warp.registerAction","Create WARP device")})]})}),h&&n(z,{borderWidth:"1px",borderColor:A,borderRadius:"lg",p:4,children:[e(p,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.licenseSection","WARP+/License key")}),n(R,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(ve,{value:y,onChange:U=>N(U.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(H,{colorScheme:"primary",onClick:G,isLoading:F,isDisabled:!y.trim(),children:i("pages.xray.warp.updateLicense","Update license")})]}),e(p,{fontSize:"xs",color:we,mt:2,children:i("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),n(z,{borderWidth:"1px",borderColor:A,borderRadius:"lg",p:4,children:[n(R,{justify:"space-between",align:"center",mb:2,children:[e(p,{fontWeight:"semibold",children:i("pages.xray.warp.remoteConfig","Remote configuration")}),g?e(Hr,{colorScheme:g.enabled?"green":"yellow",children:g.enabled?i("core.active","Active"):i("core.pending","Pending")}):e(Hr,{colorScheme:"gray",children:i("core.empty","Empty")})]}),g?n(Ce,{spacing:4,children:[n($e,{columns:{base:1,md:2},spacing:4,children:[e(gr,{label:i("core.name","Name"),value:(_e=g.name)!=null?_e:"-"}),e(gr,{label:i("core.model","Model"),value:(te=g.model)!=null?te:"-"}),e(gr,{label:i("core.status","Status"),value:g.enabled?i("core.enabled","Enabled"):i("core.disabled","Disabled")}),e(gr,{label:i("core.id","ID"),value:(le=g.id)!=null?le:"-"})]}),g.account&&n(Ft,{children:[e(jn,{}),n($e,{columns:{base:1,md:3},spacing:4,children:[e(gr,{label:i("core.type","Type"),value:(B=g.account.account_type)!=null?B:"-"}),e(gr,{label:i("core.role","Role"),value:(L=g.account.role)!=null?L:"-"}),e(gr,{label:i("pages.xray.warp.premiumData","WARP+ data"),value:Qi(g.account.premium_data)}),e(gr,{label:i("core.quota","Quota"),value:Qi(g.account.quota)}),e(gr,{label:i("core.usage","Usage"),value:Qi(g.account.usage)})]})]}),n(R,{spacing:3,flexWrap:"wrap",children:[e(H,{colorScheme:"primary",onClick:V,isDisabled:!v,children:i("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(H,{variant:"ghost",onClick:()=>w(null),children:i("core.reset","Reset")})]})]}):e(p,{fontSize:"sm",color:we,children:i("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),n(z,{borderWidth:"1px",borderColor:A,borderRadius:"lg",p:4,children:[e(p,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.manualTitle","Manual outbound")}),n(Ce,{spacing:4,children:[n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.outbound.tag","Tag")}),e(ve,{size:"sm",value:c.tag,onChange:U=>P("tag",U.target.value),placeholder:"warp"})]}),n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.warp.privateKey")}),e(Cr,{size:"sm",value:c.privateKey,onChange:U=>P("privateKey",U.target.value),rows:2})]}),n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.warp.publicKey")}),e(Cr,{size:"sm",value:c.publicKey,onChange:U=>P("publicKey",U.target.value),rows:2})]}),n(k,{children:[e(H,{size:"sm",colorScheme:"primary",onClick:De,children:i("pages.xray.warp.generateKeys","Generate Keys")}),e(p,{fontSize:"xs",color:we,mt:1,children:i("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.warp.endpoint")}),e(ve,{size:"sm",value:c.endpoint,onChange:U=>P("endpoint",U.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.addressV4","Client IPv4")}),e(ve,{size:"sm",value:c.addressV4,onChange:U=>P("addressV4",U.target.value),placeholder:"172.16.0.2"}),e(nr,{children:i("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.addressV6","Client IPv6")}),e(ve,{size:"sm",value:c.addressV6,onChange:U=>P("addressV6",U.target.value),placeholder:"2606:4700:****:****::****"})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.reserved")}),e(ve,{size:"sm",value:c.reserved,onChange:U=>P("reserved",U.target.value),placeholder:"0,0,0"}),e(nr,{children:i("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(H,{size:"xs",mt:2,variant:"ghost",onClick:ee,children:i("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.mtu","MTU")}),e(Nn,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(U,j)=>P("mtu",j||1420),children:e(zn,{})})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.notes","Notes (optional)")}),e(Cr,{size:"sm",rows:2,value:c.notes,onChange:U=>P("notes",U.target.value)})]})]})]})]})}),n(zt,{display:"flex",justifyContent:"space-between",children:[Z?e(H,{colorScheme:"red",variant:"outline",onClick:ge,children:i("delete")}):e("span",{}),n(R,{spacing:3,children:[e(H,{variant:"ghost",onClick:s,children:i("cancel")}),e(H,{colorScheme:"primary",onClick:pe,children:i(Z?"save":"add")})]})]})]})]})},Ds=ie(gn,{baseStyle:{w:3.5,h:3.5}}),As=ie(on,{baseStyle:{w:4,h:4}}),Ps=ie(kn,{baseStyle:{w:4,h:4}}),Do=ie(ml,{baseStyle:{w:4,h:4}}),Ao=ie(gl,{baseStyle:{w:4,h:4}}),Po=ie(Yr,{baseStyle:{w:4,h:4}}),cm=ie(id,{baseStyle:{w:4,h:4}}),dm=ie(ad,{baseStyle:{w:4,h:4}}),um=ie(cl,{baseStyle:{w:4,h:4}}),hm=ie(od,{baseStyle:{w:4,h:4}}),pm=ie(ya,{baseStyle:{w:4,h:4}}),mm=ie(ld,{baseStyle:{w:4,h:4}}),gm=ie(cd,{baseStyle:{w:4,h:4}}),fm=ie(dd,{baseStyle:{w:4,h:4}}),bm=ie(ud,{baseStyle:{w:4,h:4}}),Io=ie(hd,{baseStyle:{w:4,h:4}}),Is={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},ii=t=>JSON.stringify(t!=null?t:{}),To=t=>Array.isArray(t)?t.join(","):t!=null?t:"",ym=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],Zi=({title:t,children:s})=>{const r=at("gray.50","whiteAlpha.100"),l=at("gray.200","whiteAlpha.300");return n(z,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(z,{bg:r,px:{base:3,md:4},py:2,children:e(p,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(z,{overflowX:"auto",children:e(Rn,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(qr,{children:s})})})]})},$r=({label:t,controlId:s,children:r})=>{const l=at("gray.700","whiteAlpha.800");return n(Dt,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Ne,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(_,{htmlFor:s,mb:{base:2,md:0},color:l,children:t})}),e(Ne,{py:3,display:{base:"block",md:"table-cell"},children:e(k,{id:s,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(s)})})]})},Ts=({children:t})=>{const s=at("gray.200","whiteAlpha.200"),r=at("white","blackAlpha.400"),l=at("sm","none");return e(z,{borderWidth:"1px",borderColor:s,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(z,{overflowX:"auto",children:t})})},Es=({children:t,...s})=>{const r=at("gray.50","whiteAlpha.100"),l=at("gray.200","whiteAlpha.300"),o=at("gray.300","whiteAlpha.300"),i=at("gray.100","whiteAlpha.200"),a=at("gray.50","whiteAlpha.100");return e(Rn,{size:"sm",w:"full",...s,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:o,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:i,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:a}},children:t})},xm=()=>{var ri,xs,Ss,ws,ks;const{t}=Ke(),{fetchCoreSettings:s,updateConfig:r,isLoading:l,config:o,isPostLoading:i,restartCore:a}=Wp(),{userData:c,getUserIsSuccess:u}=fr();if(!(u&&Boolean((ri=c.permissions)==null?void 0:ri.sections.xray)))return n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.xraySettings","Xray settings")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("xraySettings.noPermission","You do not have permission to manage Xray settings.")})]});const{onEditingCore:m}=Ct(),g=Kt(),{isOpen:w,onOpen:v,onClose:S}=qt(),{isOpen:y,onOpen:N,onClose:I}=qt(),{isOpen:M,onOpen:ae,onClose:b}=qt(),{isOpen:F,onOpen:C,onClose:X}=qt(),{isOpen:Y,onOpen:me,onClose:O}=qt(),{isOpen:oe,onOpen:P,onClose:we}=qt(),A=Br({defaultValues:{config:o||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),De=d.exports.useRef(ii(A.getValues("config"))),ee=Jt({control:A.control,name:"config"}),Ae=d.exports.useMemo(()=>ii(ee)!==De.current,[ee]),[Re,Me]=d.exports.useState([]),[G,D]=d.exports.useState([]),[V,ge]=d.exports.useState([]),[pe,Z]=d.exports.useState([]),[_e,te]=d.exports.useState([]),[le,B]=d.exports.useState([]),[L,U]=d.exports.useState(null),[j,Te]=d.exports.useState(null),[qe,Qe]=d.exports.useState(!1),[T,ce]=d.exports.useState("xraySetting"),[$,be]=d.exports.useState(""),dt=_r({base:!0,md:!1}),[ut,Q]=d.exports.useState(0),[W,Se]=d.exports.useState(""),[Le,J]=d.exports.useState(""),He=d.exports.useCallback(f=>f.map((x,ne)=>{var Ge,it;return{key:`${ne}-${(it=(Ge=x.tag)!=null?Ge:x.protocol)!=null?it:"outbound"}`,...x}}),[]),se=d.exports.useCallback(f=>{Me(He(f))},[He]),fe=d.exports.useCallback(()=>{const f=A.getValues("config.outbounds");return Array.isArray(f)?JSON.parse(JSON.stringify(f)):[]},[A]),Ie=d.exports.useCallback(f=>{A.setValue("config.outbounds",f,{shouldDirty:!0}),se(f),Q(x=>x+1)},[A,se]),Ve=d.exports.useCallback(f=>f.map((x,ne)=>{var Ge,it,Xe,St,xr,Cn,bn,de,gt,nt,bt,It,Vr,Zr,jr;return{key:`${ne}-${(it=(Ge=x.outboundTag)!=null?Ge:x.balancerTag)!=null?it:"rule"}`,source:(Xe=x.source)!=null?Xe:[],sourcePort:(St=x.sourcePort)!=null?St:[],network:(xr=x.network)!=null?xr:[],protocol:(Cn=x.protocol)!=null?Cn:[],attrs:x.attrs?JSON.stringify(x.attrs,null,2):"",ip:(bn=x.ip)!=null?bn:[],domain:(de=x.domain)!=null?de:[],port:(gt=x.port)!=null?gt:[],inboundTag:(nt=x.inboundTag)!=null?nt:[],user:(bt=x.user)!=null?bt:[],outboundTag:(It=x.outboundTag)!=null?It:"",balancerTag:(Vr=x.balancerTag)!=null?Vr:"",type:(Zr=x.type)!=null?Zr:"field",domainMatcher:(jr=x.domainMatcher)!=null?jr:""}}),[]),Ye=d.exports.useCallback(f=>{D(Ve(f))},[Ve]),rt=d.exports.useCallback(f=>{A.setValue("config.routing.rules",f,{shouldDirty:!0}),Ye(f),Q(x=>x+1)},[A,Ye]),Je=d.exports.useCallback(()=>{const f=A.getValues("config.routing.rules");return Array.isArray(f)?JSON.parse(JSON.stringify(f)):[]},[A]);d.exports.useEffect(()=>{const f=()=>{Qe(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",f),()=>{document.removeEventListener("fullscreenchange",f)}},[]),d.exports.useEffect(()=>(m(!0),s().then(()=>{console.log("Core settings fetched successfully")}).catch(f=>{g({title:t("core.errorFetchingConfig"),description:f.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>m(!1)),[s,m,g,t]),d.exports.useEffect(()=>{var f,x,ne,Ge;o&&(A.reset({config:o}),De.current=ii(o),se((o==null?void 0:o.outbounds)||[]),Ye(((f=o==null?void 0:o.routing)==null?void 0:f.rules)||[]),ge(((ne=(x=o==null?void 0:o.routing)==null?void 0:x.balancers)==null?void 0:ne.map((it,Xe)=>{var St;return{key:Xe,tag:it.tag||"",strategy:((St=it.strategy)==null?void 0:St.type)||"random",selector:it.selector||[],fallbackTag:it.fallbackTag||""}}))||[]),Z(((Ge=o==null?void 0:o.dns)==null?void 0:Ge.servers)||[]),te((o==null?void 0:o.fakedns)||[]),be(o!=null&&o.observatory?"observatory":o!=null&&o.burstObservatory?"burstObservatory":""),Q(it=>it+1))},[o,A,se,Ye]);const{mutate:Ze,isLoading:Wt}=Ir(a,{onSuccess:()=>{g({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:f=>{var x,ne;g({title:t("core.generalErrorMessage"),description:((ne=(x=f.response)==null?void 0:x.data)==null?void 0:ne.detail)||f.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),xt=A.handleSubmit(({config:f})=>{r(f).then(()=>{A.reset({config:f}),De.current=ii(f),g({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(x=>{let ne=t("core.generalErrorMessage");typeof x.response._data.detail=="object"&&(ne=x.response._data.detail[Object.keys(x.response._data.detail)[0]]),typeof x.response._data.detail=="string"&&(ne=x.response._data.detail),g({title:ne,status:"error",isClosable:!0,position:"top",duration:3e3})})}),sr=async()=>{const f=await Pe("/panel/xray/getOutboundsTraffic");f!=null&&f.success&&B(f.obj)},br=()=>{Te(null),S()},ir=()=>{Te(null),v()},ar=f=>{Te(f),v()},or=f=>{const x=fe();f<0||f>=x.length||(x.splice(f,1),Ie(x))},tr=(f,x)=>{const ne=fe();if(f<0||f>=ne.length||x<0||x>=ne.length)return;const[Ge]=ne.splice(f,1);ne.splice(x,0,Ge),Ie(ne)},lr=f=>{tr(f,f-1)},cr=f=>{tr(f,f+1)},re=()=>{U(null),N()},ke=f=>{U(f),N()},K=f=>{const x=Je();x.splice(f,1),rt(x)},E=(f,x)=>{const ne=Je();if(f<0||f>=ne.length||x<0||x>=ne.length)return;const[Ge]=ne.splice(f,1);ne.splice(x,0,Ge),rt(ne)},Ee=f=>{const x=Je();L!==null&&L>=0&&L<x.length?x[L]=f:x.push(f),rt(x),U(null)},Be=()=>{U(null),I()},Oe=()=>{ae()},We=f=>{ae()},ht=f=>{const x=[...V],ne=x.splice(f,1)[0];A.setValue("config.routing.balancers",x,{shouldDirty:!0}),ge(x);const Ge={...A.getValues("config")};Ge.observatory&&(Ge.observatory.subjectSelector=Ge.observatory.subjectSelector.filter(it=>it!==ne.tag)),Ge.burstObservatory&&(Ge.burstObservatory.subjectSelector=Ge.burstObservatory.subjectSelector.filter(it=>it!==ne.tag)),A.setValue("config",Ge,{shouldDirty:!0})},ot=()=>{C()},Tt=f=>{C()},Yt=f=>{const x=[...pe];x.splice(f,1),A.setValue("config.dns.servers",x,{shouldDirty:!0}),Z(x)},Gt=()=>{me()},dr=f=>{me()},Lr=f=>{const x=[..._e];x.splice(f,1),A.setValue("config.fakedns",x.length>0?x:null,{shouldDirty:!0}),te(x)},lt=f=>{var x,ne,Ge,it,Xe;switch(f.protocol){case"vmess":case"vless":return((x=f.settings.vnext)==null?void 0:x.map(St=>`${St.address}:${St.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((ne=f.settings.servers)==null?void 0:ne.map(St=>`${St.address}:${St.port}`))||[];case"dns":return[`${(Ge=f.settings)==null?void 0:Ge.address}:${(it=f.settings)==null?void 0:it.port}`];case"wireguard":return((Xe=f.settings.peers)==null?void 0:Xe.map(St=>St.endpoint))||[];default:return[]}},Pt=f=>{const x=le.find(ne=>ne.tag===f.tag);return x?`${Tn.sizeFormat(x.up)} / ${Tn.sizeFormat(x.down)}`:`${Tn.sizeFormat(0)} / ${Tn.sizeFormat(0)}`},Nt=d.exports.useMemo(()=>Array.isArray(ee==null?void 0:ee.outbounds)?ee.outbounds:[],[ee]),ur=d.exports.useMemo(()=>{var f;return Array.isArray((f=ee==null?void 0:ee.routing)==null?void 0:f.rules)?ee.routing.rules:[]},[ee]),hr=d.exports.useMemo(()=>{var f;return Array.from(new Set(((f=ee==null?void 0:ee.inbounds)!=null?f:[]).map(x=>x==null?void 0:x.tag).filter(x=>Boolean(x))))},[ee]),Ur=d.exports.useMemo(()=>Array.from(new Set(Nt.map(f=>f==null?void 0:f.tag).filter(f=>Boolean(f)))),[Nt]),Zt=d.exports.useMemo(()=>{var f,x;return Array.from(new Set(((x=(f=ee==null?void 0:ee.routing)==null?void 0:f.balancers)!=null?x:[]).map(ne=>ne==null?void 0:ne.tag).filter(ne=>Boolean(ne))))},[ee]),pr=d.exports.useMemo(()=>Nt.length===0?-1:Nt.findIndex(f=>(f==null?void 0:f.protocol)==="freedom"),[Nt]),Xr=d.exports.useMemo(()=>{var x,ne;if(pr<0)return"";const f=Nt[pr];return(ne=(x=f==null?void 0:f.settings)==null?void 0:x.domainStrategy)!=null?ne:""},[pr,Nt]),Et=f=>{const x=A.getValues("config")||{},ne=Array.isArray(x.outbounds)?JSON.parse(JSON.stringify(x.outbounds)):[],Ge=ne.findIndex(St=>(St==null?void 0:St.protocol)==="freedom");if(Ge===-1)return;const it={...ne[Ge]},Xe={...it.settings||{}};f?Xe.domainStrategy=f:delete Xe.domainStrategy,it.settings=Xe,ne[Ge]=it,A.setValue("config.outbounds",ne,{shouldDirty:!0}),Me(ne.map((St,xr)=>({key:xr,...St}))),Q(St=>St+1)},Or=d.exports.useMemo(()=>{var f;return(f=Nt.find(x=>(x==null?void 0:x.tag)==="warp"))!=null?f:null},[Nt]),Ar=d.exports.useMemo(()=>Nt.findIndex(f=>(f==null?void 0:f.tag)==="warp"),[Nt])!==-1,rr=d.exports.useMemo(()=>{const f=ur.find(x=>x.outboundTag==="warp");return Array.isArray(f==null?void 0:f.domain)?f.domain:[]},[ur]),ye=f=>{const x=f.map(Xe=>Xe.trim()).filter((Xe,St,xr)=>Xe.length>0&&xr.indexOf(Xe)===St),ne=Je(),Ge=ne.findIndex(Xe=>Xe.outboundTag==="warp");if(x.length===0){Ge!==-1&&(ne.splice(Ge,1),rt(ne));return}const it={type:"field",outboundTag:"warp",domain:x};Ge!==-1?ne[Ge]={...ne[Ge],...it}:ne.push(it),rt(ne)},yr=f=>{const x=f.trim();!x||rr.includes(x)||ye([...rr,x])},Wr=f=>{ye(rr.filter(x=>x!==f))},Qr=at("white","blackAlpha.400"),vn=at("gray.200","whiteAlpha.200"),cn=at("gray.600","gray.300"),fs=f=>{var it;const x=fe(),ne=(it=f.tag)!=null?it:"warp",Ge=x.findIndex(Xe=>(Xe==null?void 0:Xe.tag)===ne);Ge>=0?x[Ge]=f:x.push(f),Ie(x)},Ti=()=>{const f=fe(),x=f.findIndex(ne=>(ne==null?void 0:ne.tag)==="warp");x!==-1&&(f.splice(x,1),Ie(f),ye([]),Se(""),J(""))},Ei=f=>{const x=fe();j!==null&&j>=0&&j<x.length?x[j]=f:x.push(f),Ie(x),Te(null)},js=()=>{we()},ei=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{Qe(!1)}).catch(f=>{console.error("Error exiting fullscreen:",f)}):document.documentElement.requestFullscreen().then(()=>{Qe(!0)}).catch(f=>{console.error("Error entering fullscreen:",f)})},ti=()=>{var x,ne,Ge,it;const f=A.getValues("config")||{};switch(T){case"inboundSettings":return JSON.stringify((x=f.inbounds)!=null?x:[],null,2);case"outboundSettings":return JSON.stringify((ne=f.outbounds)!=null?ne:[],null,2);case"routingRuleSettings":return JSON.stringify((it=(Ge=f.routing)==null?void 0:Ge.rules)!=null?it:[],null,2);case"xraySetting":default:return JSON.stringify(f!=null?f:{},null,2)}},zi=f=>{var x,ne,Ge,it;try{const Xe=JSON.parse(f),St={...A.getValues("config")||{}};switch(T){case"inboundSettings":St.inbounds=Xe;break;case"outboundSettings":St.outbounds=Xe,se(Xe);break;case"routingRuleSettings":St.routing||(St.routing={}),St.routing.rules=Xe,Ye(Xe);break;case"xraySetting":default:A.setValue("config",Xe,{shouldDirty:!0}),se((Xe==null?void 0:Xe.outbounds)||[]),Ye(((x=Xe==null?void 0:Xe.routing)==null?void 0:x.rules)||[]),ge(((Ge=(ne=Xe==null?void 0:Xe.routing)==null?void 0:ne.balancers)==null?void 0:Ge.map((xr,Cn)=>{var bn;return{key:Cn,tag:xr.tag||"",strategy:((bn=xr.strategy)==null?void 0:bn.type)||"random",selector:xr.selector||[],fallbackTag:xr.fallbackTag||""}}))||[]),Z(((it=Xe==null?void 0:Xe.dns)==null?void 0:it.servers)||[]),te((Xe==null?void 0:Xe.fakedns)||[]);return}A.setValue("config",St,{shouldDirty:!0})}catch{}},bs=()=>{var x,ne;const f=A.getValues("config")||{};return $==="observatory"?JSON.stringify((x=f.observatory)!=null?x:{},null,2):$==="burstObservatory"?JSON.stringify((ne=f.burstObservatory)!=null?ne:{},null,2):""},ys=f=>{try{const x=JSON.parse(f),ne={...A.getValues("config")||{}};$==="observatory"&&(ne.observatory=x),$==="burstObservatory"&&(ne.burstObservatory=x),A.setValue("config",ne,{shouldDirty:!0})}catch{}},Ni=f=>!f&&f!==0?[]:Array.isArray(f)?f.map(x=>typeof x=="string"?x.trim():String(x)).filter(Boolean):typeof f=="string"?f.split(",").map(x=>x.trim()).filter(Boolean):[String(f)],dn=(f,x="blue")=>{const ne=Ni(f);return ne.length?e(Bp,{chips:ne,color:x}):e(p,{color:"gray.400",children:"-"})},Bn=f=>{if(f==null||f===""||typeof f=="string"&&!f.trim())return e(p,{color:"gray.400",children:"-"});const x=typeof f=="string"?f:String(f);return x.length>30?e(Vp,{text:x,label:t("details")}):e(p,{children:x})},Ri=f=>{if(!f)return e(p,{color:"gray.400",children:"-"});try{const x=JSON.parse(f);if(x&&typeof x=="object"&&!Array.isArray(x)){const ne=Object.entries(x);return ne.length?e(z,{display:"flex",flexWrap:"wrap",gap:"1",children:ne.map(([Ge,it])=>e(yt,{colorScheme:"purple",size:"sm",children:`${Ge}: ${String(it)}`},Ge))}):e(p,{color:"gray.400",children:"-"})}}catch{}return e(p,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:f})},Mi=bs(),Li=ti();return n(ue,{spacing:6,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(p,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(Ce,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:n(Ce,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(H,{size:"sm",colorScheme:"primary",isLoading:i,isDisabled:!Ae||i,onClick:xt,w:{base:"full",sm:"auto"},children:t("core.save")}),e(H,{size:"sm",leftIcon:e(Po,{}),isLoading:Wt,onClick:()=>Ze(),variant:"outline",w:{base:"full",sm:"auto"},children:t(Wt?"core.restarting":"core.restartCore")})]})}),n(Wn,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[n(Fn,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(Vt,{children:n(R,{spacing:2,align:"center",children:[e(um,{}),e(p,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(Vt,{children:n(R,{spacing:2,align:"center",children:[e(hm,{}),e(p,{as:"span",children:t("pages.xray.Routings")})]})}),e(Vt,{children:n(R,{spacing:2,align:"center",children:[e(pm,{}),e(p,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(Vt,{children:n(R,{spacing:2,align:"center",children:[e(mm,{}),e(p,{as:"span",children:t("pages.xray.Balancers")})]})}),e(Vt,{children:n(R,{spacing:2,align:"center",children:[e(gm,{}),e(p,{as:"span",children:t("DNS")})]})}),e(Vt,{children:n(R,{spacing:2,align:"center",children:[e(fm,{}),e(p,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(Vt,{children:n(R,{spacing:2,align:"center",children:[e(bm,{}),e(p,{as:"span",children:t("pages.xray.logs")})]})})]}),n(Hn,{children:[e($t,{children:n(ue,{spacing:4,align:"stretch",children:[n(Zi,{title:t("pages.xray.generalConfigs"),children:[e($r,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:f=>n(st,{id:f,size:"sm",maxW:"220px",value:Xr,onChange:x=>Et(x.target.value),isDisabled:pr===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(x=>e("option",{value:x,children:x},x))]})}),e($r,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:f=>e(ft,{name:"config.routing.domainStrategy",control:A.control,render:({field:x})=>e(st,{...x,id:f,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(ne=>e("option",{value:ne,children:ne},ne))})})})]}),e(z,{borderWidth:"1px",borderColor:vn,borderRadius:"lg",bg:Qr,p:{base:3,md:4},children:n(ue,{align:"stretch",spacing:3,children:[n(R,{justify:"space-between",align:"center",children:[e(p,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(H,{variant:"outline",size:"sm",leftIcon:e(Io,{}),onClick:P,children:Ar?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(p,{fontSize:"sm",color:cn,children:t("pages.xray.warpRoutingDesc")}),n(hi,{children:[rr.length===0&&e(Ws,{children:e(yt,{colorScheme:"gray",variant:"subtle",children:e(Ua,{children:t("core.empty","Empty")})})}),rr.map(f=>e(Ws,{children:n(yt,{colorScheme:"primary",borderRadius:"full",children:[e(Ua,{children:f}),e(pd,{"aria-label":t("core.remove"),onClick:()=>Wr(f)})]})},f))]}),n(R,{spacing:3,flexWrap:"wrap",children:[e(st,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:W,onChange:f=>{const{value:x}=f.target;x&&yr(x),Se("")},children:ym.map(f=>e("option",{value:f.value,children:f.label},f.value))}),n(R,{spacing:2,maxW:"320px",flex:"1",children:[e(ve,{size:"sm",value:Le,onChange:f=>J(f.target.value),placeholder:"geosite:google"}),e(H,{size:"sm",colorScheme:"primary",onClick:()=>{yr(Le),J("")},isDisabled:!Le.trim(),children:t("core.add")})]})]})]})}),n(Zi,{title:t("pages.xray.statistics"),children:[e($r,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:f=>e(ft,{name:"config.policy.system.statsInboundUplink",control:A.control,render:({field:x})=>e(mt,{id:f,isChecked:!!x.value,onChange:ne=>x.onChange(ne.target.checked)})})}),e($r,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:f=>e(ft,{name:"config.policy.system.statsInboundDownlink",control:A.control,render:({field:x})=>e(mt,{id:f,isChecked:!!x.value,onChange:ne=>x.onChange(ne.target.checked)})})}),e($r,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:f=>e(ft,{name:"config.policy.system.statsOutboundUplink",control:A.control,render:({field:x})=>e(mt,{id:f,isChecked:!!x.value,onChange:ne=>x.onChange(ne.target.checked)})})}),e($r,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:f=>e(ft,{name:"config.policy.system.statsOutboundDownlink",control:A.control,render:({field:x})=>e(mt,{id:f,isChecked:!!x.value,onChange:ne=>x.onChange(ne.target.checked)})})})]}),n(Zi,{title:t("pages.xray.logConfigs"),children:[e($r,{label:t("pages.xray.logLevel"),controlId:"log-level",children:f=>e(ft,{name:"config.log.loglevel",control:A.control,render:({field:x})=>e(st,{...x,id:f,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(ne=>e("option",{value:ne,children:ne},ne))})})}),e($r,{label:t("pages.xray.accessLog"),controlId:"access-log",children:f=>e(ft,{name:"config.log.access",control:A.control,render:({field:x})=>n(st,{...x,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(ne=>e("option",{value:ne,children:ne},ne))]})})}),e($r,{label:t("pages.xray.errorLog"),controlId:"error-log",children:f=>e(ft,{name:"config.log.error",control:A.control,render:({field:x})=>n(st,{...x,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(ne=>e("option",{value:ne,children:ne},ne))]})})}),e($r,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:f=>e(ft,{name:"config.log.maskAddress",control:A.control,render:({field:x})=>n(st,{...x,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(ne=>e("option",{value:ne,children:ne},ne))]})})}),e($r,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:f=>e(ft,{name:"config.log.dnsLog",control:A.control,render:({field:x})=>e(mt,{id:f,isChecked:!!x.value,onChange:ne=>x.onChange(ne.target.checked)})})})]})]})}),e($t,{children:n(ue,{spacing:4,align:"stretch",children:[e(H,{leftIcon:e(Ds,{}),...Is,onClick:re,children:t("pages.xray.rules.add")}),e(Ts,{children:n(Es,{minW:"1100px",children:[n(tn,{children:[n(Dt,{children:[e(Fe,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(Fe,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(Fe,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(Fe,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(Fe,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(Fe,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(Fe,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(Fe,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),n(Dt,{children:[e(Fe,{children:t("IP",{defaultValue:"IP"})}),e(Fe,{children:t("port",{defaultValue:"Port"})}),e(Fe,{children:t("network",{defaultValue:"Network"})}),e(Fe,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(Fe,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(Fe,{children:t("IP",{defaultValue:"IP"})}),e(Fe,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(Fe,{children:t("port",{defaultValue:"Port"})}),e(Fe,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(Fe,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),n(qr,{children:[G.length===0&&e(Dt,{children:e(Ne,{colSpan:14,children:e(p,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),G.map((f,x)=>n(Dt,{children:[e(Ne,{children:n(ue,{align:"flex-start",spacing:1,children:[e(p,{fontWeight:"semibold",children:x+1}),n(R,{spacing:1,children:[e(Ue,{"aria-label":"move up",icon:e(Do,{}),size:"xs",variant:"ghost",isDisabled:x===0,onClick:()=>E(x,x-1)}),e(Ue,{"aria-label":"move down",icon:e(Ao,{}),size:"xs",variant:"ghost",isDisabled:x===G.length-1,onClick:()=>E(x,x+1)})]})]})}),e(Ne,{children:dn(f.source,"blue")}),e(Ne,{children:Bn(f.sourcePort)}),e(Ne,{children:dn(f.network,"purple")}),e(Ne,{children:dn(f.protocol,"green")}),e(Ne,{children:Ri(f.attrs)}),e(Ne,{children:dn(f.ip,"blue")}),e(Ne,{children:dn(f.domain,"blue")}),e(Ne,{children:Bn(f.port)}),e(Ne,{children:dn(f.inboundTag,"teal")}),e(Ne,{children:dn(f.user,"cyan")}),e(Ne,{children:Bn(f.outboundTag)}),e(Ne,{children:Bn(f.balancerTag)}),e(Ne,{children:n(R,{spacing:1,children:[e(Ue,{"aria-label":"edit",icon:e(Ps,{}),size:"xs",variant:"ghost",onClick:()=>ke(x)}),e(Ue,{"aria-label":"delete",icon:e(As,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>K(x)})]})})]},f.key))]})]})})]})}),e($t,{children:n(ue,{spacing:4,align:"stretch",children:[n(R,{children:[e(H,{leftIcon:e(Ds,{}),...Is,onClick:ir,children:t("pages.xray.outbound.addOutbound")}),e(H,{leftIcon:e(Io,{}),size:"xs",variant:"ghost",onClick:P,children:Ar?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(H,{leftIcon:e(Po,{}),size:"xs",variant:"ghost",onClick:sr,children:t("refresh")})]}),e(Ts,{children:n(Es,{minW:"880px",children:[e(tn,{children:n(Dt,{children:[e(Fe,{children:"#"}),e(Fe,{children:t("pages.xray.outbound.tag")}),e(Fe,{children:t("protocol")}),e(Fe,{children:t("pages.xray.outbound.address")}),e(Fe,{children:t("pages.inbounds.traffic")})]})}),e(qr,{children:Re.map((f,x)=>{var ne,Ge,it;return n(Dt,{children:[e(Ne,{children:n(R,{children:[e(p,{children:x+1}),e(Ue,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(Do,{}),size:"xs",variant:"ghost",isDisabled:x===0,onClick:()=>lr(x)}),e(Ue,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(Ao,{}),size:"xs",variant:"ghost",isDisabled:x===Re.length-1,onClick:()=>cr(x)}),e(Ue,{"aria-label":"edit",icon:e(Ps,{}),size:"xs",variant:"ghost",onClick:()=>ar(x)}),e(Ue,{"aria-label":"delete",icon:e(As,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>or(x)})]})}),e(Ne,{children:f.tag}),n(Ne,{children:[e(yt,{colorScheme:"purple",children:f.protocol}),["vmess","vless","trojan","shadowsocks"].includes(f.protocol)&&n(Ft,{children:[e(yt,{colorScheme:"blue",children:(ne=f.streamSettings)==null?void 0:ne.network}),((Ge=f.streamSettings)==null?void 0:Ge.security)==="tls"&&e(yt,{colorScheme:"green",children:"tls"}),((it=f.streamSettings)==null?void 0:it.security)==="reality"&&e(yt,{colorScheme:"green",children:"reality"})]})]}),e(Ne,{children:lt(f).map(Xe=>e(p,{children:Xe},Xe))}),e(Ne,{children:e(yt,{colorScheme:"green",children:Pt(f)})})]},f.key)})})]})})]})}),e($t,{children:n(ue,{spacing:4,align:"stretch",children:[e(H,{leftIcon:e(Ds,{}),...Is,onClick:Oe,children:t("pages.xray.balancer.addBalancer")}),e(Ts,{children:n(Es,{minW:"680px",children:[e(tn,{children:n(Dt,{children:[e(Fe,{children:"#"}),e(Fe,{children:t("pages.xray.balancer.tag")}),e(Fe,{children:t("pages.xray.balancer.balancerStrategy")}),e(Fe,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(qr,{children:V.map((f,x)=>n(Dt,{children:[e(Ne,{children:n(R,{children:[e(p,{children:x+1}),e(Ue,{"aria-label":"edit",icon:e(Ps,{}),size:"xs",variant:"ghost",onClick:()=>We()}),e(Ue,{"aria-label":"delete",icon:e(As,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ht(x)})]})}),e(Ne,{children:f.tag}),e(Ne,{children:e(yt,{colorScheme:f.strategy==="random"?"purple":"green",children:f.strategy==="random"?"Random":f.strategy==="roundRobin"?"Round Robin":f.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Ne,{children:f.selector.map(ne=>e(yt,{colorScheme:"blue",m:1,children:ne},ne))})]},f.key))})]})}),(((xs=A.getValues("config"))==null?void 0:xs.observatory)||((Ss=A.getValues("config"))==null?void 0:Ss.burstObservatory))&&n(ue,{spacing:3,align:"stretch",children:[e(Bs,{onChange:f=>{be(f),Q(x=>x+1)},value:$,children:n(R,{spacing:3,children:[((ws=A.getValues("config"))==null?void 0:ws.observatory)&&e(Tr,{value:"observatory",children:"Observatory"}),((ks=A.getValues("config"))==null?void 0:ks.burstObservatory)&&e(Tr,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(z,{h:"300px",children:e(ha,{json:Mi,onChange:f=>ys(f)},`obs-${$}-${ut}`)})]})]})}),e($t,{children:n(ue,{spacing:4,align:"stretch",children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{children:t("pages.xray.dns.enable")}),e(ft,{name:"config.dns",control:A.control,render:({field:f})=>e(mt,{isChecked:!!f.value,onChange:x=>{const ne={...A.getValues("config")};x.target.checked?ne.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete ne.dns,delete ne.fakedns),A.setValue("config",ne,{shouldDirty:!0}),Z([]),te([])}})})]}),pe.length>0&&n(Ft,{children:[e(H,{leftIcon:e(Ds,{}),...Is,onClick:ot,children:t("pages.xray.dns.add")}),e(Ts,{children:n(Es,{minW:"720px",children:[e(tn,{children:n(Dt,{children:[e(Fe,{children:"#"}),e(Fe,{children:t("pages.xray.outbound.address")}),e(Fe,{children:t("pages.xray.dns.domains")}),e(Fe,{children:t("pages.xray.dns.expectIPs")})]})}),e(qr,{children:pe.map((f,x)=>n(Dt,{children:[e(Ne,{children:n(R,{children:[e(p,{children:x+1}),e(Ue,{"aria-label":"edit",icon:e(Ps,{}),size:"xs",variant:"ghost",onClick:()=>Tt()}),e(Ue,{"aria-label":"delete",icon:e(As,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Yt(x)})]})}),e(Ne,{children:typeof f=="object"?f.address:f}),e(Ne,{children:typeof f=="object"?To(f.domains):""}),e(Ne,{children:typeof f=="object"?To(f.expectIPs):""})]},x))})]})})]}),_e.length>0&&n(Ft,{children:[e(H,{leftIcon:e(Ds,{}),...Is,onClick:Gt,children:t("pages.xray.fakedns.add")}),e(Ts,{children:n(Es,{minW:"520px",children:[e(tn,{children:n(Dt,{children:[e(Fe,{children:"#"}),e(Fe,{children:t("pages.xray.fakedns.ipPool")}),e(Fe,{children:t("pages.xray.fakedns.poolSize")})]})}),e(qr,{children:_e.map((f,x)=>n(Dt,{children:[e(Ne,{children:n(R,{children:[e(p,{children:x+1}),e(Ue,{"aria-label":"edit",icon:e(Ps,{}),size:"xs",variant:"ghost",onClick:()=>dr()}),e(Ue,{"aria-label":"delete",icon:e(As,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Lr(x)})]})}),e(Ne,{children:f.ipPool}),e(Ne,{children:f.poolSize})]},x))})]})})]})]})}),e($t,{children:n(ue,{spacing:4,align:"stretch",children:[n(z,{px:2,children:[e(p,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(p,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(z,{px:2,children:e(Bs,{onChange:f=>{ce(f),Q(x=>x+1)},value:T,children:n(R,{spacing:3,wrap:"wrap",children:[e(Tr,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Tr,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Tr,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Tr,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),n(z,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(Ue,{position:qe?"fixed":"absolute",top:2,right:2,"aria-label":qe?"Exit Full Screen":"Full Screen",icon:qe?e(dm,{}):e(cm,{}),onClick:ei,zIndex:qe?1101:10}),e(z,{w:qe?"100vw":"100%",h:qe?"100vh":"100%",position:qe?"fixed":"relative",top:qe?0:"auto",left:qe?0:"auto",zIndex:qe?1e3:"auto",children:e(ha,{json:Li,onChange:f=>{zi(f)}},`advanced-${T}-${ut}`)}),qe&&dt&&e(H,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:ei,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e($t,{children:e(z,{children:e(Bl,{showTitle:!1})})})]})]}),e(qp,{isOpen:w,onClose:br,mode:j!==null?"edit":"create",initialOutbound:j!==null?Nt[j]:null,onSubmitOutbound:Ei}),e(em,{isOpen:y,mode:L!==null?"edit":"create",initialRule:L!==null&&ur[L]||null,availableInboundTags:hr,availableOutboundTags:Ur,availableBalancerTags:Zt,onSubmit:Ee,onClose:Be}),e(lm,{isOpen:oe,onClose:js,initialOutbound:Or,onSave:fs,onDelete:Ti}),e(tm,{isOpen:M,onClose:b,form:A,setBalancersData:ge}),e(rm,{isOpen:F,onClose:X,form:A,setDnsServers:Z}),e(nm,{isOpen:Y,onClose:O,form:A,setFakeDns:te})]})},Sm=({isOpen:t,onClose:s,onSubmit:r,isSaving:l,allHosts:o,allAdmins:i,initialService:a})=>{var ee,Ae,Re,Me;const{t:c}=Ke(),[u,h]=d.exports.useState((ee=a==null?void 0:a.name)!=null?ee:""),[m,g]=d.exports.useState((Ae=a==null?void 0:a.description)!=null?Ae:""),[w,v]=d.exports.useState((Re=a==null?void 0:a.admin_ids)!=null?Re:[]),[S,y]=d.exports.useState((Me=a==null?void 0:a.hosts.map(G=>G.id))!=null?Me:[]),[N,I]=d.exports.useState(""),[M,ae]=d.exports.useState(""),[b,F]=d.exports.useState(null),C=Kt();d.exports.useEffect(()=>{var G,D,V,ge;t&&(h((G=a==null?void 0:a.name)!=null?G:""),g((D=a==null?void 0:a.description)!=null?D:""),v((V=a==null?void 0:a.admin_ids)!=null?V:[]),y((ge=a==null?void 0:a.hosts.map(pe=>pe.id))!=null?ge:[]),I(""),ae(""))},[t,a]);const X=d.exports.useMemo(()=>new Map(o.map(G=>[G.id,G])),[o]),Y=d.exports.useMemo(()=>o.filter(G=>!S.includes(G.id)&&!G.isDisabled),[o,S]),me=d.exports.useMemo(()=>{const G=M.trim().toLowerCase();return G?Y.filter(D=>{const V=D.label.toLowerCase(),ge=D.inboundTag.toLowerCase(),pe=D.protocol.toLowerCase();return V.includes(G)||ge.includes(G)||pe.includes(G)}):Y},[Y,M]),O=d.exports.useMemo(()=>{const G=N.trim().toLowerCase();return G?i.filter(D=>D.username.toLowerCase().includes(G)):i},[N,i]),oe=d.exports.useMemo(()=>new Set(w),[w]),P=G=>{v(D=>D.includes(G)?D.filter(V=>V!==G):[...D,G])},we=G=>{y(D=>D.includes(G)?D.filter(V=>V!==G):[...D,G])},A=(G,D)=>{y(V=>{const ge=V.indexOf(G);if(ge===-1)return V;const pe=D==="up"?ge-1:ge+1;if(pe<0||pe>=V.length)return V;const Z=[...V];return[Z[ge],Z[pe]]=[Z[pe],Z[ge]],Z})},De=async()=>{if(!u.trim()){C({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!S.length){C({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const G=S.map((D,V)=>({host_id:D,sort:V}));await r({name:u.trim(),description:(m==null?void 0:m.trim())||null,admin_ids:w,hosts:G},a==null?void 0:a.id)};return n(Lt,{isOpen:t,onClose:s,size:"5xl",children:[e(wt,{}),n(Ut,{children:[e(_t,{children:a?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Ot,{}),e(kt,{children:n(Ce,{spacing:6,children:[n(R,{spacing:4,children:[e(er,{label:c("services.fields.name","Name"),value:u,onChange:G=>h(G.target.value),maxLength:128,isRequired:!0}),e(er,{label:c("services.fields.description","Description"),value:m!=null?m:"",onChange:G=>g(G.target.value),maxLength:256})]}),n(z,{children:[e(p,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),n(Ce,{spacing:3,children:[e(er,{value:N,onChange:G=>I(G.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(ue,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:i.length===0?e(p,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):O.length===0?e(p,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):O.map(G=>{const D=oe.has(G.id);return e(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:D?"primary.400":"gray.200",bg:D?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:D?"primary.300":"gray.600",bg:D?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>P(G.id),onKeyDown:V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),P(G.id))},role:"button",tabIndex:0,children:n(ct,{align:"center",justify:"space-between",children:[e(p,{fontWeight:"medium",children:G.username}),D&&e(Hr,{colorScheme:"primary",children:c("services.selected","Selected")})]})},G.id)})})]}),e(p,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),n(Hs,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(an,{children:n(sn,{variant:"outline",h:"full",children:[e(Zn,{children:e(p,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(pn,{children:n(Ce,{spacing:3,children:[e(er,{value:M,onChange:G=>ae(G.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(ue,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:Y.length===0?e(p,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):me.length===0?e(p,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):me.map(G=>n(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:b===G.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>F(G.id),onMouseLeave:()=>F(null),onClick:()=>we(G.id),children:[e(p,{fontWeight:"medium",children:G.label}),n(p,{fontSize:"sm",color:"gray.500",children:[G.protocol.toUpperCase()," - ",G.inboundTag]})]},G.id))})]})})]})}),e(an,{children:n(sn,{variant:"outline",h:"full",children:[e(Zn,{children:e(p,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(pn,{children:n(ue,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[S.length===0&&e(p,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),S.map((G,D)=>{const V=X.get(G);return V?e(md.div,{layout:!0,children:n(ct,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[n(z,{children:[n(R,{spacing:2,align:"center",children:[e(p,{fontWeight:"medium",children:V.label}),V.isDisabled&&e(Hr,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),n(p,{fontSize:"sm",color:"gray.500",children:[V.protocol.toUpperCase()," - ",V.inboundTag]})]}),n(R,{spacing:1,children:[e(pt,{label:c("services.moveUp","Move up"),children:e(Ue,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(ml,{width:16}),onClick:()=>A(G,"up"),isDisabled:D===0})}),e(pt,{label:c("services.moveDown","Move down"),children:e(Ue,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(gl,{width:16}),onClick:()=>A(G,"down"),isDisabled:D===S.length-1})}),e(pt,{label:c("services.removeHost","Remove host"),children:e(Ue,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(on,{width:16}),onClick:()=>we(G)})})]})]})},G):null})]})})]})})]})]})}),e(zt,{children:n(R,{justify:"flex-end",w:"full",children:[e(H,{onClick:s,children:c("cancel")}),e(H,{colorScheme:"primary",onClick:De,isLoading:l,children:c(a?"saveChanges":"create")})]})})]})]})},wm=()=>{var qe,Qe;const{t}=Ke(),s=Kt(),{userData:r,getUserIsSuccess:l}=fr(),o=l&&Boolean((qe=r.permissions)==null?void 0:qe.sections.services),i=es(),a=ln(),c=Pl(),{inbounds:u,refetchUsers:h}=Ct(),m=qt(),[g,w]=d.exports.useState(null);d.exports.useEffect(()=>{!l||!o||(i.fetchServices(),a.fetchAdmins({limit:500,offset:0}),Vs(),c.fetchHosts())},[l,o]);const v=d.exports.useMemo(()=>a.admins.slice().sort((T,ce)=>T.username.localeCompare(ce.username)).map(T=>({id:T.id,username:T.username})),[a.admins]),S=d.exports.useMemo(()=>{var ce,$;const T=[];for(const[be,dt]of Object.entries(c.hosts)){const ut=(ce=Array.from(u.values()).flat().find(W=>W.tag===be))!=null?ce:null,Q=($=ut==null?void 0:ut.protocol)!=null?$:"unknown";dt.forEach(W=>{W.id!=null&&T.push({id:W.id,label:W.remark,inboundTag:be,protocol:Q,isDisabled:Boolean(W.is_disabled)})})}return T},[c.hosts,u]),y=()=>{w(null),m.onOpen()},N=async T=>{try{const ce=await i.fetchServiceDetail(T);w(ce),m.onOpen()}catch{s({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},I=async(T,ce)=>{var $,be;try{ce?(await i.updateService(ce,T),s({status:"success",title:t("services.updated","Service updated")})):(await i.createService(T),s({status:"success",title:t("services.created","Service created")})),h(!0),m.onClose()}catch(dt){s({status:"error",title:(be=($=dt==null?void 0:dt.data)==null?void 0:$.detail)!=null?be:t("services.saveFailed","Failed to save service")})}},M=async T=>{var ce,$;try{const be=await i.fetchServiceDetail(T);Re(be),le()}catch(be){s({status:"error",title:($=(ce=be==null?void 0:be.data)==null?void 0:ce.detail)!=null?$:t("services.deleteFailed","Unable to delete service")})}},ae=async T=>{var ce,$;try{await i.resetServiceUsage(T),s({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(be){s({status:"error",title:($=(ce=be==null?void 0:be.data)==null?void 0:ce.detail)!=null?$:t("services.resetFailed","Failed to reset usage")})}},[b,F]=d.exports.useState(null),[C,X]=d.exports.useState(!1),{isOpen:Y,onOpen:me,onClose:O}=qt(),oe=d.exports.useRef(null),P=T=>{F(T),me()},we=async()=>{if(b!=null){X(!0);try{await ae(b)}finally{X(!1),O()}}},A=b!=null?(Qe=i.services.find(T=>T.id===b))==null?void 0:Qe.name:void 0,De=()=>{Re(null),B()},ee=async()=>{var ce,$;if(!Ae)return;const T={mode:Ae.user_count?Me:"delete_users",unlink_admins:D};if(T.mode==="transfer_users"){if(!ge){s({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}T.target_service_id=ge}_e(!0);try{await i.deleteService(Ae.id,T),s({status:"success",title:t("services.deleted","Service removed")}),h(!0),De()}catch(be){s({status:"error",title:($=(ce=be==null?void 0:be.data)==null?void 0:ce.detail)!=null?$:t("services.deleteFailed","Unable to delete service")})}finally{_e(!1)}},[Ae,Re]=d.exports.useState(null),[Me,G]=d.exports.useState("delete_users"),[D,V]=d.exports.useState(!1),[ge,pe]=d.exports.useState(null),[Z,_e]=d.exports.useState(!1),{isOpen:te,onOpen:le,onClose:B}=qt(),L=d.exports.useMemo(()=>Ae?i.services.filter(T=>T.id!==Ae.id):i.services,[Ae,i.services]);d.exports.useEffect(()=>{Ae&&(G("delete_users"),V(Ae.admin_ids.length>0),pe(null))},[Ae]),d.exports.useEffect(()=>{Me==="delete_users"&&pe(null)},[Me]);const U=T=>e(al,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:ce})=>n(Ft,{children:[n(ol,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[n(z,{flex:"1",textAlign:"left",children:[e(p,{fontWeight:"semibold",children:T.name}),T.description&&e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:ce?3:1,mt:1,children:T.description})]}),n(ue,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[n(R,{spacing:1,children:[n(p,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(p,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:T.host_count})]}),n(R,{spacing:1,children:[n(p,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(p,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:T.user_count})]})]}),e(gd,{})]}),e(ll,{pt:0,pb:4,children:n(Ce,{spacing:4,children:[n($e,{columns:2,spacing:3,children:[n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(p,{fontWeight:"semibold",children:tt(T.used_traffic)})]}),n(z,{children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(p,{fontWeight:"semibold",children:tt(T.lifetime_used_traffic)})]})]}),n(Ce,{spacing:2,children:[e(p,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),n(R,{spacing:2,flexWrap:"wrap",children:[e(pt,{label:t("services.view","View"),children:e(Ue,{"aria-label":"View",icon:e(Fs,{width:18}),size:"sm",variant:"outline",onClick:$=>{$.stopPropagation(),i.fetchServiceDetail(T.id)}})}),e(pt,{label:t("services.edit","Edit"),children:e(Ue,{"aria-label":"Edit",icon:e(sa,{width:18}),size:"sm",variant:"outline",onClick:$=>{$.stopPropagation(),N(T.id)},isDisabled:!o})}),e(pt,{label:t("services.resetUsage","Reset usage"),children:e(Ue,{"aria-label":"Reset usage",icon:e(Yr,{width:18}),size:"sm",variant:"outline",onClick:$=>{$.stopPropagation(),P(T.id)},isDisabled:!o})}),e(pt,{label:t("services.delete","Delete"),children:e(Ue,{"aria-label":"Delete",icon:e(on,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:$=>{$.stopPropagation(),M(T.id)},isDisabled:!o})})]})]})]})})]})},`service-accordion-${T.id}`),j=T=>n(Dt,{children:[e(Ne,{children:n(ue,{align:"start",spacing:0,children:[e(p,{fontWeight:"semibold",children:T.name}),T.description&&e(p,{fontSize:"sm",color:"gray.500",children:T.description})]})}),e(Ne,{children:T.host_count}),e(Ne,{children:T.user_count}),e(Ne,{children:tt(T.used_traffic)}),e(Ne,{children:tt(T.lifetime_used_traffic)}),e(Ne,{children:n(R,{spacing:2,children:[e(pt,{label:t("services.view","View"),children:e(Ue,{"aria-label":"View",icon:e(Fs,{width:18}),size:"sm",variant:"ghost",onClick:()=>i.fetchServiceDetail(T.id)})}),o&&n(Ft,{children:[e(pt,{label:t("services.edit","Edit"),children:e(Ue,{"aria-label":"Edit",icon:e(sa,{width:18}),size:"sm",variant:"ghost",onClick:()=>N(T.id)})}),e(pt,{label:t("services.resetUsage","Reset usage"),children:e(Ue,{"aria-label":"Reset usage",icon:e(Yr,{width:18}),size:"sm",variant:"ghost",onClick:()=>P(T.id)})}),e(pt,{label:t("services.delete","Delete"),children:e(Ue,{"aria-label":"Delete",icon:e(on,{width:18}),size:"sm",variant:"ghost",onClick:()=>M(T.id)})})]})]})})]},T.id),Te=i.serviceDetail;return l?o?n(ue,{spacing:4,align:"stretch",children:[n(ct,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[n(z,{children:[e(p,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(p,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),o&&e(H,{leftIcon:e(gn,{width:18}),colorScheme:"primary",onClick:y,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(sn,{variant:"outline",children:e(pn,{children:i.isLoading?e(ct,{justify:"center",py:10,children:e(At,{})}):n(Ft,{children:[e(il,{allowToggle:!0,display:{base:"block",md:"none"},children:i.services.map(U)}),e(z,{display:{base:"none",md:"block"},overflowX:"auto",children:n(Rn,{variant:"simple",children:[e(tn,{children:n(Dt,{children:[e(Fe,{children:t("services.columns.name","Name")}),e(Fe,{children:t("services.columns.hosts","Hosts")}),e(Fe,{children:t("services.columns.users","Users")}),e(Fe,{children:t("services.columns.usage","Usage")}),e(Fe,{children:t("services.columns.lifetime","Lifetime")}),e(Fe,{children:t("services.columns.actions","Actions")})]})}),e(qr,{children:i.services.map(j)})]})})]})})}),Te&&n(sn,{variant:"outline",children:[e(Zn,{children:n(ct,{justify:"space-between",align:"center",children:[n(z,{children:[e(p,{fontWeight:"semibold",children:Te.name}),Te.description&&e(p,{fontSize:"sm",color:"gray.500",children:Te.description})]}),e(Hr,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:Te.user_count})})]})}),e(pn,{children:n($e,{columns:{base:1,md:2},spacing:6,children:[n(z,{children:[e(p,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(Ce,{spacing:2,children:Te.admins.length===0?e(p,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):Te.admins.map(T=>n(ct,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(p,{fontWeight:"medium",children:T.username}),n(p,{fontSize:"sm",color:"gray.500",children:[tt(T.used_traffic)," /"," ",tt(T.lifetime_used_traffic)]})]},T.id))})]}),n(z,{children:[e(p,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(Ce,{spacing:2,children:Te.hosts.map(T=>n(ct,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[n(z,{children:[e(p,{fontWeight:"medium",children:T.remark}),n(p,{fontSize:"sm",color:"gray.500",children:[T.inbound_protocol.toUpperCase()," - ",T.inbound_tag]})]}),n(Hr,{colorScheme:"gray",children:["#",T.sort+1]})]},T.id))})]})]})})]}),e(ns,{isOpen:Y,leastDestructiveRef:oe,onClose:O,isCentered:!0,motionPreset:"slideInBottom",children:e(wt,{children:n(ss,{mx:{base:4,sm:0},children:[e(_t,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(kt,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:A!=null?A:t("services.thisService","this service")})}),n(zt,{children:[e(H,{ref:oe,onClick:O,children:t("cancel","Cancel")}),e(H,{colorScheme:"primary",ml:3,onClick:we,isLoading:C,children:t("services.resetUsage","Reset usage")})]})]})})}),n(Lt,{isOpen:te,onClose:De,size:"lg",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ut,{children:[n(_t,{children:[t("services.deleteDialogTitle","Delete Service"),Ae?` \u2013 ${Ae.name}`:""]}),e(Ot,{}),e(kt,{children:Ae?n(ue,{align:"stretch",spacing:4,children:[e(p,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:Ae.name})}),Ae.admin_ids.length>0?e(Nr,{isChecked:D,onChange:T=>V(T.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(p,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),Ae.user_count>0?n(ue,{align:"stretch",spacing:3,children:[e(p,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:Ae.user_count})}),e(Bs,{value:Me,onChange:T=>G(T),children:n(Ce,{align:"flex-start",spacing:2,children:[e(Tr,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Tr,{value:"transfer_users",isDisabled:L.length===0,children:L.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),Me==="transfer_users"&&L.length>0&&n(k,{isRequired:!0,children:[e(_,{children:t("services.selectTargetService","Target service")}),e(st,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:ge!=null?ge:"",onChange:T=>pe(T.target.value?Number(T.target.value):null),children:L.map(T=>e("option",{value:T.id,children:T.name},T.id))}),e(nr,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):n(Er,{status:"info",borderRadius:"md",children:[e(zr,{}),e(wn,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(p,{children:t("services.loading","Loading...")})}),n(zt,{gap:3,children:[e(H,{variant:"ghost",onClick:De,children:t("cancel","Cancel")}),e(H,{colorScheme:"red",onClick:ee,isLoading:Z,isDisabled:Boolean((Ae==null?void 0:Ae.user_count)&&Me==="transfer_users"&&L.length>0&&!ge),children:t("services.delete","Delete")})]})]})]}),e(Sm,{isOpen:m.isOpen,onClose:m.onClose,onSubmit:I,isSaving:i.isSaving,allHosts:S,allAdmins:v,initialService:g!=null?g:void 0})]}):n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(p,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(ct,{justify:"center",align:"center",h:"full",py:10,children:e(At,{})})};ze.extend(Ys);const Eo=ie(Js,{baseStyle:{w:4,h:4}}),km=ie(Ca,{baseStyle:{w:4,h:4}}),vm={key:"30d",label:"30d",amount:30,unit:"day"},Cm=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=ze.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},zo=t=>ze(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",No=t=>ze(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",ai=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return ze.utc(r).valueOf()},Ro=t=>{const s=t.unit==="hour"?"hour":"day",r=ze().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},_m=(t,s)=>{const r=ze(t),l=ze(s),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Dm=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>tt(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>tt(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Am=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>tt(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Pm=()=>{var Z,_e,te,le;const{t}=Ke(),{colorMode:s}=Gr(),{admins:r}=ln(),l="auto-end",o=(Z=_r({base:"bottom",md:"auto-end"}))!=null?Z:l,[i,a]=d.exports.useState([]),[c,u]=d.exports.useState([]),[h,m]=d.exports.useState(null),[g,w]=d.exports.useState([]),[v,S]=d.exports.useState(!1),y=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),N=(_e=y.find(B=>B.key==="30d"))!=null?_e:vm,[I,M]=d.exports.useState(()=>Ro(N)),[ae,b]=d.exports.useState(N.key),[F,C]=d.exports.useState(null),[X,Y]=d.exports.useState([]),[me,O]=d.exports.useState(!1),[oe,P]=d.exports.useState(!1),[we,A]=d.exports.useState([I.start,I.end]);d.exports.useMemo(()=>{var B;return(B=c.find(L=>L.id===h))!=null?B:null},[c,h]);const De=d.exports.useMemo(()=>{if(!h)return i;const B=new Set(g.map(U=>U.username).filter(U=>Boolean(U))),L=i.filter(U=>B.has(U.username));return L.length?L:i},[i,h,g]),ee=d.exports.useMemo(()=>g.reduce((B,L)=>B+(L.used_traffic||0),0),[g]),Ae=d.exports.useMemo(()=>g.map(B=>B.used_traffic||0),[g]),Re=d.exports.useMemo(()=>g.map(B=>B.username||t("services.unassignedAdmin","Unassigned")),[g,t]),Me=d.exports.useMemo(()=>Am(s,Re),[s,Re]);d.exports.useEffect(()=>{oe||A([I.start,I.end])},[oe,I.start,I.end]),d.exports.useEffect(()=>{let B=!1;return(async()=>{var U;try{const j=await Pe("/v2/services",{query:{limit:500}});if(B||!j)return;const Te=(U=j.services)!=null?U:[];u(Te),m(qe=>qe!==null?qe:Te.length?Te[0].id:null)}catch{B||u([])}})(),()=>{B=!0}},[]),d.exports.useEffect(()=>{if(!h){w([]);return}let B=!1;return S(!0),Pe(`/v2/services/${h}/usage/admins`,{query:{start:zo(I.start),end:No(I.end)}}).then(L=>{var U;B||!L||w((U=L.admins)!=null?U:[])}).catch(()=>{B||w([])}).finally(()=>{B||S(!1)}),()=>{B=!0}},[h,I.start,I.end,I.unit]),d.exports.useEffect(()=>{let B=!1;return(async()=>{try{const U=await Pe("/admins");if(B)return;Array.isArray(U)?a(U):a(U.admins||[])}catch(U){console.error("Failed to load all admins:",U),a(r||[])}})(),()=>{B=!0}},[r]),d.exports.useEffect(()=>{if(!F)return;let B=!1;O(!0);const L=I.unit==="hour",U={start:zo(I.start),end:No(I.end)};L&&(U.granularity="hour");const j=L?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:F,endpoint:j,query:U}),Pe(`/admin/${encodeURIComponent(F)}/usage/${j}`,{query:U}).then(Te=>{if(B)return;const qe=Array.isArray(Te==null?void 0:Te.usages)?Te.usages:[];console.debug("AdminsUsage: response usages",{length:qe.length,endpoint:j});let Qe;if(L){const T=new Map;qe.forEach($=>{var ut,Q;const be=typeof($==null?void 0:$.date)=="string"?$.date:"";if(!be)return;const dt=(ut=T.get(be))!=null?ut:0;T.set(be,dt+Number((Q=$==null?void 0:$.used_traffic)!=null?Q:0))});const ce=Array.from(T.entries());ce.sort(($,be)=>{const[dt]=$,[ut]=be;return ai(dt)-ai(ut)}),Qe=ce.map(([$,be])=>({date:$,used_traffic:be}))}else{const T=qe.map(ce=>{var $,be;return{date:($=ce==null?void 0:ce.date)!=null?$:"",used_traffic:Number((be=ce==null?void 0:ce.used_traffic)!=null?be:0)}});T.sort((ce,$)=>ai(ce.date)-ai($.date)),Qe=T}Y(Qe)}).catch(Te=>{B||(console.error("Error fetching admin usage:",Te),Y([]))}).finally(()=>{B||O(!1)}),()=>{B=!0}},[F,I]),d.exports.useEffect(()=>{if(!De||De.length===0)return;De.some(L=>L.username===F)||C(De[0].username)},[De,F]),d.exports.useEffect(()=>{const B=y.find(L=>L.key===I.key);b(B?B.key:"custom")},[I,y]);const G=d.exports.useMemo(()=>X.map(B=>Cm(B.date)),[X]),D=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:X.map(B=>B.used_traffic)}],[X,t]),V=d.exports.useMemo(()=>({options:Dm(s,G),series:D}),[s,G,D]),ge=d.exports.useMemo(()=>X.reduce((B,L)=>B+Number(L.used_traffic||0),0),[X]),pe=d.exports.useMemo(()=>{const B=ze(I.start).format("YYYY-MM-DD"),L=ze(I.end).format("YYYY-MM-DD");return B===L?B:`${B} - ${L}`},[I.start,I.end]);return n(ue,{spacing:4,align:"stretch",children:[n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(Ce,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[n(ue,{align:"start",spacing:1,children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),n(Ce,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(st,{value:h!=null?h:"",onChange:B=>{const L=Number(B.target.value);m(Number.isNaN(L)?null:L)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(B=>e("option",{value:B.id,children:B.name},B.id))}),n(R,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(Eo,{}),n(p,{children:[t("services.totalUsage","Total"),":"," ",e(ie.span,{fontWeight:"medium",children:tt(ee,2)})]})]})]})]}),n(Ce,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:v?n(ue,{spacing:3,py:8,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):g.length&&ee>0?e(nn,{type:"donut",height:320,options:Me,series:Ae}):e(p,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(ue,{flex:"1",align:"stretch",spacing:2,children:g.length?g.map(B=>{var Te;const L=B.username||t("services.unassignedAdmin","Unassigned"),U=Boolean(B.username),j=F===B.username&&U;return e(H,{size:"sm",variant:j?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{U&&B.username&&C(B.username)},isDisabled:!U,children:n(R,{justify:"space-between",w:"full",children:[e(p,{children:L}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:tt(B.used_traffic||0,2)})]})},`${(Te=B.admin_id)!=null?Te:"na"}-${L}`)}):e(p,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[n(R,{spacing:2,align:"center",children:[e(p,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(pt,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(Eo,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),n(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(ie.span,{fontWeight:"medium",children:F!=null?F:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(ie.span,{fontWeight:"medium",children:tt(ge||0,2)})]})]}),n(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ce,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:y.map(B=>e(H,{size:"sm",onClick:()=>{b(B.key),M(Ro(B))},variant:ae===B.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:B.label},B.key))}),n(Ce,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[n(us,{placement:o,isOpen:oe,onClose:()=>{P(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(hs,{children:e(H,{size:"sm",variant:"outline",leftIcon:e(km,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(oe){P(!1);return}A([I.start,I.end]),P(!0)},children:pe})}),n(ps,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(qs,{}),n(ms,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(Qs,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(te=we[0])!=null?te:void 0,endDate:(le=we[1])!=null?le:void 0,calendarClassName:"usage-range-datepicker",onChange:B=>{const[L,U]=B!=null?B:[null,null];if(A([L,U]),L&&U){const j=_m(L,U);b("custom"),M(j),P(!1)}}})}),e(p,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(st,{value:F!=null?F:"",onChange:B=>C(B.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!De.length,children:De.map(B=>e("option",{value:B.username,children:B.username},B.username))})]})]})]}),e(z,{mt:6,children:me?n(ue,{spacing:3,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):V.series&&V.series.length?e(nn,{options:V.options,series:V.series,type:"area",height:360}):e(p,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};ze.extend(Ys);const Im=ie(Ca,{baseStyle:{w:4,h:4}}),ji=ie(Js,{baseStyle:{w:4,h:4}}),ea=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],Mo=t=>{const s=t.unit==="hour"?"hour":"day",r=ze().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},Tm=(t,s)=>{const r=ze(t),l=ze(s),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Lo=t=>ze(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Uo=t=>ze(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Oo=(t,s)=>{if(!t)return t;const r=ze.utc(t);return r.isValid()?s==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},Wo=(t,s,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>tt(Number(o)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>tt(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Em=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>tt(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),zm=({services:t,selectedServiceId:s})=>{var ce,$,be,dt,ut,Q;const{t:r}=Ke(),{colorMode:l}=Gr(),o="auto-end",i=(ce=_r({base:"bottom",md:"auto-end"}))!=null?ce:o,a=d.exports.useMemo(()=>t.map(W=>({id:W.id,name:W.name})),[t]),c=d.exports.useMemo(()=>s||(a.length?a[0].id:null),[s,a]),u=($=ea.find(W=>W.key==="30d"))!=null?$:ea[0],[h,m]=d.exports.useState(c),[g,w]=d.exports.useState(()=>Mo(u)),[v,S]=d.exports.useState(u.key),[y,N]=d.exports.useState([null,null]),[I,M]=d.exports.useState(!1),[ae,b]=d.exports.useState([]),[F,C]=d.exports.useState("day"),[X,Y]=d.exports.useState([]),[me,O]=d.exports.useState(!1),[oe,P]=d.exports.useState(!1),[we,A]=d.exports.useState(null),[De,ee]=d.exports.useState([]),[Ae,Re]=d.exports.useState("day"),[Me,G]=d.exports.useState(""),[D,V]=d.exports.useState(!1);d.exports.useEffect(()=>{m(c)},[c]),d.exports.useEffect(()=>{if(!h){b([]),Y([]),ee([]),A(null),G("");return}const W={start:Lo(g.start),end:Uo(g.end)},Se=g.unit==="hour"?"hour":"day";let Le=!1;return O(!0),Pe(`/v2/services/${h}/usage/timeseries`,{query:{...W,granularity:Se}}).then(J=>{var He,se;Le||!J||(b((He=J.points)!=null?He:[]),C((se=J.granularity)!=null?se:Se))}).catch(()=>{Le||(b([]),C(Se))}).finally(()=>{Le||O(!1)}),P(!0),Pe(`/v2/services/${h}/usage/admins`,{query:W}).then(J=>{var He;Le||!J||Y((He=J.admins)!=null?He:[])}).catch(()=>{Le||Y([])}).finally(()=>{Le||P(!1)}),()=>{Le=!0}},[h,g.start,g.end,g.unit]),d.exports.useEffect(()=>{if(!h){A(null),ee([]),G("");return}if(!X.length){A(null);return}A(W=>{var He,se;const Se=X.map(fe=>fe.admin_id);if(W===null){if(Se.includes(null))return W}else if(Se.includes(W))return W;const Le=X.find(fe=>(fe.used_traffic||0)>0);if(Le)return(He=Le.admin_id)!=null?He:null;const J=X[0];return(se=J==null?void 0:J.admin_id)!=null?se:null})},[X,h]),d.exports.useEffect(()=>{if(!h){ee([]),G(""),Re("day");return}if(we===void 0)return;if(!X.length&&we===null){ee([]),G("");return}const W=g.unit==="hour"?"hour":"day",Se=we===null?"null":Number.isFinite(we)?String(we):"null";let Le=!1;return V(!0),Pe(`/v2/services/${h}/usage/admin-timeseries`,{query:{start:Lo(g.start),end:Uo(g.end),granularity:W,admin_id:Se}}).then(J=>{var He,se,fe;Le||!J||(ee((He=J.points)!=null?He:[]),Re((se=J.granularity)!=null?se:W),G((fe=J.username)!=null?fe:""))}).catch(()=>{Le||(ee([]),G(""),Re(W))}).finally(()=>{Le||V(!1)}),()=>{Le=!0}},[X,g.end,g.start,g.unit,we,h]);const ge=d.exports.useMemo(()=>{const W=ze(g.start).format("YYYY-MM-DD"),Se=ze(g.end).format("YYYY-MM-DD");return`${W} \u2013 ${Se}`},[g.start,g.end]),pe=d.exports.useMemo(()=>ae.map(W=>Oo(W.timestamp,F)),[ae,F]),Z=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ae.map(W=>W.used_traffic)}],[ae,r]),_e=d.exports.useMemo(()=>Wo(l,pe,r("services.usageYAxis","Usage")),[pe,l,r]),te=d.exports.useMemo(()=>X.map(W=>({value:W.admin_id===null?"null":String(W.admin_id),label:W.username||r("services.unassignedAdmin","Unassigned")})),[X,r]),le=d.exports.useMemo(()=>{var Se,Le;const W=we===null?"null":String(we);return(Le=(Se=te.find(J=>J.value===W))==null?void 0:Se.label)!=null?Le:we===null?r("services.unassignedAdmin","Unassigned"):""},[te,we,r]),B=d.exports.useMemo(()=>De.map(W=>Oo(W.timestamp,Ae)),[De,Ae]),L=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:De.map(W=>W.used_traffic)}],[De,r]),U=d.exports.useMemo(()=>Wo(l,B,r("services.usageYAxis","Usage")),[B,l,r]),j=d.exports.useMemo(()=>De.reduce((W,Se)=>W+(Se.used_traffic||0),0),[De]),Te=d.exports.useMemo(()=>X.map(W=>W.used_traffic),[X]),qe=d.exports.useMemo(()=>X.map(W=>W.username||r("services.unassignedAdmin","Unassigned")),[X,r]),Qe=d.exports.useMemo(()=>Em(l,qe),[l,qe]),T=d.exports.useMemo(()=>X.reduce((W,Se)=>W+(Se.used_traffic||0),0),[X]);return a.length===0?n(ue,{spacing:2,align:"stretch",mt:4,children:[e(p,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(z,{borderWidth:"1px",borderRadius:"md",p:6,children:e(p,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):n(ue,{spacing:4,align:"stretch",children:[n(R,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(p,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),n(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(st,{value:h!=null?h:"",onChange:W=>m(Number(W.target.value)||null),minW:{md:"220px"},children:a.map(W=>e("option",{value:W.id,children:W.name},W.id))}),e(Ce,{direction:{base:"column",sm:"row"},spacing:2,children:ea.map(W=>e(H,{size:"sm",variant:v===W.key?"solid":"outline",colorScheme:"primary",onClick:()=>{S(W.key),w(Mo(W))},children:W.label},W.key))}),n(us,{placement:i,isOpen:I,onClose:()=>M(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(hs,{children:e(H,{size:"sm",variant:"outline",leftIcon:e(Im,{}),onClick:()=>{N([g.start,g.end]),M(W=>!W)},children:ge})}),n(ps,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(qs,{}),n(ms,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(Qs,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(be=y[0])!=null?be:void 0,endDate:(dt=y[1])!=null?dt:void 0,calendarClassName:"usage-range-datepicker",onChange:W=>{const[Se,Le]=W!=null?W:[null,null];if(N([Se,Le]),Se&&Le){const J=Tm(Se,Le);S("custom"),w(J),M(!1)}}})}),e(p,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(R,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(p,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),n(R,{fontSize:"sm",color:"gray.500",children:[e(ji,{}),n(p,{children:[r("services.totalUsage","Total")," ",e(ie.span,{fontWeight:"medium",children:tt(ae.reduce((W,Se)=>W+(Se.used_traffic||0),0),2)})]})]})]}),e(z,{mt:4,children:me?n(ue,{spacing:3,py:10,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):ae.length?e(nn,{type:"area",height:360,options:_e,series:Z}):e(p,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(pt,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(p,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(ji,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),n(p,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(ie.span,{fontWeight:"medium",children:le||Me||"-"})," ",r("services.totalUsage","Total"),":"," ",e(ie.span,{fontWeight:"medium",children:tt(j||0,2)})]})]}),e(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(st,{size:"sm",minW:{md:"200px"},value:we===null?"null":String(we),onChange:W=>{const Se=W.target.value;if(Se==="null"){A(null);return}const Le=Number(Se);A(Number.isNaN(Le)?null:Le)},isDisabled:te.length===0,children:te.map(W=>e("option",{value:W.value,children:W.label},W.value))})})]}),e(z,{mt:4,children:D?n(ue,{spacing:3,py:10,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(Q=(ut=L[0])==null?void 0:ut.data)!=null&&Q.length?e(nn,{type:"area",height:360,options:U,series:L}):e(p,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(R,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(p,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),n(R,{fontSize:"sm",color:"gray.500",children:[e(ji,{}),n(p,{children:[r("services.totalUsage","Total")," ",e(ie.span,{fontWeight:"medium",children:tt(T,2)})]})]})]}),n(Ce,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:oe?n(ue,{spacing:3,py:8,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):X.length&&T>0?e(nn,{type:"donut",height:320,options:Qe,series:Te}):e(p,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(ue,{flex:"1",align:"stretch",spacing:2,children:X.length?X.map(W=>{var Se;return n(R,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(p,{fontWeight:"medium",children:W.username||r("services.unassignedAdmin","Unassigned")}),e(p,{fontSize:"sm",color:"gray.500",children:tt(W.used_traffic||0,2)})]},`${(Se=W.admin_id)!=null?Se:"na"}-${W.username}`)}):e(p,{color:"gray.500",children:r("noData")})})]})]})]})};ze.extend(Ys);const Nm=ie(Ca,{baseStyle:{w:4,h:4}}),oi=ie(Js,{baseStyle:{w:4,h:4}}),zs={key:"30d",label:"30d",amount:30,unit:"day"},Fo=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=ze.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},Ns=t=>ze(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Rs=t=>ze(t).utc().format("YYYY-MM-DDTHH:mm:ss"),xn=t=>{const s=t.unit==="hour"?"hour":"day",r=ze().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},li=(t,s)=>{const r=ze(t),l=ze(s),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Ho=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>tt(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>tt(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},ci=({presets:t,range:s,onPresetChange:r,onCustomChange:l})=>{var S,y,N;const{t:o}=Ke(),i="auto-end",a=(S=_r({base:"bottom",md:"auto-end"}))!=null?S:i,c=ze(s.start).format("YYYY-MM-DD"),u=ze(s.end).format("YYYY-MM-DD"),h=c===u?c:`${c} - ${u}`,[m,g]=d.exports.useState(!1),[w,v]=d.exports.useState([s.start,s.end]);return d.exports.useEffect(()=>{m||v([s.start,s.end])},[m,s.start,s.end]),n(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ce,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(I=>e(H,{size:"sm",onClick:()=>r(I.key),colorScheme:"primary",variant:s.key===I.key?"solid":"outline",w:{base:"full",sm:"auto"},children:I.label},I.key))}),n(us,{placement:a,isOpen:m,onClose:()=>{g(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(hs,{children:e(H,{size:"sm",variant:"outline",leftIcon:e(Nm,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(m){g(!1);return}v([s.start,s.end]),g(!0)},children:h})}),n(ps,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(qs,{}),n(ms,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(Qs,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(y=w[0])!=null?y:void 0,endDate:(N=w[1])!=null?N:void 0,calendarClassName:"usage-range-datepicker",onChange:I=>{const[M,ae]=I!=null?I:[null,null];v([M,ae]),M&&ae&&(l(M,ae),g(!1))}})}),e(p,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},Rm=()=>{var xt,sr,br,ir,ar,or,tr,lr,cr;const{t}=Ke(),s=Kt(),{colorMode:r}=Gr(),{data:l}=Aa(),{fetchNodesUsage:o}=Zs(),{userData:i}=fr(),a=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(sr=(xt=a.find(re=>re.key==="30d"))!=null?xt:a[0])!=null?sr:zs,[u,h]=d.exports.useState(()=>xn(c)),[m,g]=d.exports.useState([]),[w,v]=d.exports.useState(!1),[S,y]=d.exports.useState(()=>xn(c)),[N,I]=d.exports.useState(null),[M,ae]=d.exports.useState(!1),[b,F]=d.exports.useState([]),[C,X]=d.exports.useState(null),[Y,me]=d.exports.useState(()=>xn(c)),[O,oe]=d.exports.useState(()=>xn(c)),[P,we]=d.exports.useState([]),[A,De]=d.exports.useState(null),[ee,Ae]=d.exports.useState(null),[Re,Me]=d.exports.useState([]),[G,D]=d.exports.useState([]),[V,ge]=d.exports.useState(!1),[pe,Z]=d.exports.useState(null),[_e,te]=d.exports.useState(!1),[le,B]=d.exports.useState([]),[L,U]=d.exports.useState(null),j=d.exports.useCallback(re=>re?(Array.isArray(re)?re:Object.values(re)).map(K=>{var E,Ee,Be,Oe;return{nodeId:Number((E=K==null?void 0:K.node_id)!=null?E:0),nodeName:(Ee=K==null?void 0:K.node_name)!=null?Ee:t("nodes.unknownNode","Unknown"),total:Number((Be=K==null?void 0:K.uplink)!=null?Be:0)+Number((Oe=K==null?void 0:K.downlink)!=null?Oe:0)}}):[],[t]),Te=d.exports.useCallback(re=>{var K;const ke=(K=a.find(E=>E.key===re))!=null?K:zs;h(xn(ke))},[a]),qe=d.exports.useCallback((re,ke)=>{const K=li(re,ke);h(K)},[]),Qe=d.exports.useCallback(re=>{var K;const ke=(K=a.find(E=>E.key===re))!=null?K:zs;y(xn(ke))},[a]),T=d.exports.useCallback((re,ke)=>{const K=li(re,ke);y(K)},[]),ce=d.exports.useCallback(re=>{var K;const ke=(K=a.find(E=>E.key===re))!=null?K:zs;oe(xn(ke))},[a]),$=d.exports.useCallback((re,ke)=>{const K=li(re,ke);oe(K)},[]),be=d.exports.useCallback(re=>{var K;const ke=(K=a.find(E=>E.key===re))!=null?K:zs;me(xn(ke))},[a]),dt=d.exports.useCallback((re,ke)=>{const K=li(re,ke);me(K)},[]),ut=d.exports.useMemo(()=>m.reduce((re,ke)=>re+ke.total,0),[m]),Q=d.exports.useMemo(()=>{const re=m.map(K=>K.total),ke=m.map(K=>K.nodeName);return ki(r,`${t("userDialog.total")} ${tt(ut||0,2)}`,re,ke)},[r,m,t,ut]),W=d.exports.useMemo(()=>b.map(re=>Fo(re.date)),[b]),Se=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:b.map(re=>re.used_traffic)}],[b,t]),Le=d.exports.useMemo(()=>b.reduce((re,ke)=>re+ke.used_traffic,0),[b]),J=d.exports.useMemo(()=>({options:Ho(r,W),series:Se}),[r,W,Se]),He=d.exports.useMemo(()=>G.reduce((re,ke)=>re+ke.total,0),[G]),se=d.exports.useMemo(()=>{const re=G.map(K=>K.total),ke=G.map(K=>K.nodeName);return ki(r,`${t("userDialog.total")} ${tt(He||0,2)}`,re,ke)},[G,r,t,He]),fe=d.exports.useMemo(()=>le.map(re=>Fo(re.date)),[le]),Ie=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:le.map(re=>re.used_traffic)}],[le,t]),Ve=d.exports.useMemo(()=>le.reduce((re,ke)=>re+ke.used_traffic,0),[le]),Ye=d.exports.useMemo(()=>({options:Ho(r,fe),series:Ie}),[r,fe,Ie]),rt=d.exports.useMemo(()=>{const re=[],ke=new Set;return m.forEach(K=>{K.nodeId>0&&!ke.has(K.nodeId)&&(ke.add(K.nodeId),re.push({value:K.nodeId,label:K.nodeName}))}),Array.isArray(l)&&l.forEach(K=>{(K==null?void 0:K.id)&&!ke.has(K.id)&&(ke.add(K.id),re.push({value:K.id,label:K.name}))}),re.sort((K,E)=>K.label.localeCompare(E.label))},[m,l]),Je=d.exports.useMemo(()=>{const re=[],ke=new Set;return Re.forEach(K=>{ke.has(K.nodeId)||(ke.add(K.nodeId),re.push({value:K.nodeId,label:K.nodeName}))}),ke.has(0)||re.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(K=>{(K==null?void 0:K.id)&&!ke.has(K.id)&&(ke.add(K.id),re.push({value:K.id,label:K.name}))}),re.sort((K,E)=>K.label.localeCompare(E.label))},[Re,l,t]),Ze=d.exports.useMemo(()=>P.map(re=>({value:re,label:re})),[P]),Wt=d.exports.useMemo(()=>{const re=new Map;return Array.isArray(l)&&l.forEach(ke=>{(ke==null?void 0:ke.id)!=null&&re.set(ke.id,ke.name)}),re},[l]);return d.exports.useEffect(()=>{let re=!1;return v(!0),o({start:Ns(u.start),end:Rs(u.end)}).then(ke=>{if(re)return;const K=j(ke==null?void 0:ke.usages);g(K)}).catch(ke=>{re||(console.error("Error fetching usage data:",ke),g([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||v(!1)}),()=>{re=!0}},[o,u,j,s,t]),d.exports.useEffect(()=>{var ke;const re=Boolean((ke=i.permissions)==null?void 0:ke.admin_management.can_view)||i.role==="full_access";!(i!=null&&i.username)||(De(K=>K!=null?K:i.username),Ae(K=>K!=null?K:i.username),re||we([i.username]))},[i]),d.exports.useEffect(()=>{var K;const re=Boolean((K=i==null?void 0:i.permissions)==null?void 0:K.admin_management.can_view)||(i==null?void 0:i.role)==="full_access";if(!(i!=null&&i.username)||!re)return;let ke=!1;return Pe("/admins").then(E=>{if(ke)return;const Be=(Array.isArray(E)?E:Array.isArray(E==null?void 0:E.admins)?E.admins:[]).map(We=>We==null?void 0:We.username).filter(We=>typeof We=="string"),Oe=Array.from(new Set(Be)).sort((We,ht)=>We.localeCompare(ht));if(!Oe.length&&(i==null?void 0:i.username)){we([i.username]);return}we(Oe),De(We=>{var ht,ot;return We&&Oe.includes(We)?We:(ot=(ht=Oe[0])!=null?ht:We)!=null?ot:null}),Ae(We=>{var ht,ot;return We&&Oe.includes(We)?We:(ot=(ht=Oe[0])!=null?ht:We)!=null?ot:null})}).catch(E=>{console.error("Error fetching admins:",E)}),()=>{ke=!0}},[(br=i==null?void 0:i.permissions)==null?void 0:br.admin_management,i==null?void 0:i.role,i==null?void 0:i.username]),d.exports.useEffect(()=>{var ke,K;if(N!==null)return;const re=(ke=m.filter(E=>E.nodeId>0).sort((E,Ee)=>Ee.total-E.total)[0])==null?void 0:ke.nodeId;if(re&&re>0){I(re);return}if(Array.isArray(l)&&l.length){const E=(K=l[0])==null?void 0:K.id;E&&I(E)}},[N,m,l]),d.exports.useEffect(()=>{Z(null)},[A]),d.exports.useEffect(()=>{if(!A){Me([]),Z(null);return}let re=!1;const ke={start:Ns(O.start),end:Rs(O.end)};return Pe(`/admin/${encodeURIComponent(A)}/usage/nodes`,{query:ke}).then(K=>{if(re)return;const E=j(K==null?void 0:K.usages);Me(E),Z(Ee=>{var Oe,We,ht;if(Ee!==null)return Ee;const Be=(Oe=E.filter(ot=>ot.nodeId!==0).sort((ot,Tt)=>Tt.total-ot.total)[0])==null?void 0:Oe.nodeId;return typeof Be=="number"?Be:(ht=(We=E[0])==null?void 0:We.nodeId)!=null?ht:0})}).catch(K=>{re||(console.error("Error fetching daily admin nodes:",K),Me([]),Z(null),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{re=!0}},[A,O,j,s,t]),d.exports.useEffect(()=>{if(!ee){D([]),ge(!1);return}let re=!1;return ge(!0),Pe(`/admin/${encodeURIComponent(ee)}/usage/nodes`,{query:{start:Ns(Y.start),end:Rs(Y.end)}}).then(ke=>{if(re)return;const K=j(ke==null?void 0:ke.usages);D(K)}).catch(ke=>{re||(console.error("Error fetching admin totals nodes:",ke),D([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||ge(!1)}),()=>{re=!0}},[ee,Y,j,s,t]),d.exports.useEffect(()=>{if(N===null){F([]),X(null);return}let re=!1;ae(!0);const ke={start:Ns(S.start),end:Rs(S.end)};return S.unit==="hour"&&(ke.granularity="hour"),Pe(`/node/${N}/usage/daily`,{query:ke}).then(K=>{var Oe,We,ht;if(re)return;const Ee=(Array.isArray(K==null?void 0:K.usages)?K.usages:[]).map(ot=>{var Tt,Yt;return{date:(Tt=ot==null?void 0:ot.date)!=null?Tt:"",used_traffic:Number((Yt=ot==null?void 0:ot.used_traffic)!=null?Yt:0)}});F(Ee);const Be=(We=(Oe=K==null?void 0:K.node_name)!=null?Oe:Wt.get(N))!=null?We:t("nodes.unknownNode","Unknown");X({nodeName:Be,nodeId:(ht=K==null?void 0:K.node_id)!=null?ht:N})}).catch(K=>{re||(console.error("Error fetching node daily usage:",K),F([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||ae(!1)}),()=>{re=!0}},[N,S,Wt,s,t]),d.exports.useEffect(()=>{if(!A){B([]),U(null);return}if(pe===null){B([]),U(null);return}let re=!1;te(!0);const ke={start:Ns(O.start),end:Rs(O.end)};return pe!=null&&(ke.node_id=pe),O.unit==="hour"&&(ke.granularity="hour"),Pe(`/admin/${encodeURIComponent(A)}/usage/chart`,{query:ke}).then(K=>{var Be,Oe,We,ht;if(re)return;const Ee=(Array.isArray(K==null?void 0:K.usages)?K.usages:[]).map(ot=>{var Tt,Yt;return{date:(Tt=ot==null?void 0:ot.date)!=null?Tt:"",used_traffic:Number((Yt=ot==null?void 0:ot.used_traffic)!=null?Yt:0)}});B(Ee),U({nodeName:(We=(Oe=K==null?void 0:K.node_name)!=null?Oe:(Be=Je.find(ot=>ot.value===pe))==null?void 0:Be.label)!=null?We:null,nodeId:(ht=K==null?void 0:K.node_id)!=null?ht:pe})}).catch(K=>{re||(console.error("Error fetching admin usage chart:",K),B([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||te(!1)}),()=>{re=!0}},[A,pe,O,Je,t,s]),n(ue,{spacing:6,align:"stretch",children:[n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(pt,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(p,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(oi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:tt(ut||0,2)})]})]}),e(ci,{presets:a,range:u,onPresetChange:Te,onCustomChange:qe})]}),e(z,{mt:6,children:w?n(ue,{spacing:3,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Q.series.length?e(nn,{options:Q.options,series:Q.series,type:"donut",height:360}):e(p,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(pt,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(p,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(oi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(ie.span,{fontWeight:"medium",children:(ir=C==null?void 0:C.nodeName)!=null?ir:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:tt(Le||0,2)})]})]}),n(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(st,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:N!=null?N:"",onChange:re=>{const ke=re.target.value;if(!ke){I(null);return}const K=Number(ke);I(Number.isFinite(K)&&K>0?K:null)},placeholder:t("nodes.selectNode","Select node"),children:rt.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(ci,{presets:a,range:S,onPresetChange:Qe,onCustomChange:T})]})]}),e(z,{mt:6,children:M?n(ue,{spacing:3,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(or=(ar=Se[0])==null?void 0:ar.data)!=null&&or.length?e(nn,{options:J.options,series:J.series,type:"area",height:360}):e(p,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(Ce,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(pt,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(p,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(oi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ie.span,{fontWeight:"medium",children:A!=null?A:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(ie.span,{fontWeight:"medium",children:(tr=L==null?void 0:L.nodeName)!=null?tr:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:tt(Ve||0,2)})]})]}),n(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(st,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:A!=null?A:"",onChange:re=>De(re.target.value||null),isDisabled:Ze.length===0,children:Ze.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(st,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:pe!=null?pe:"",onChange:re=>{const ke=re.target.value;if(ke===""){Z(null);return}const K=Number(ke);Z(Number.isNaN(K)?null:K)},placeholder:t("nodes.selectNode","Select node"),children:Je.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(ci,{presets:a,range:O,onPresetChange:ce,onCustomChange:$})]})]}),e(z,{mt:6,children:_e?n(ue,{spacing:3,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(cr=(lr=Ie[0])==null?void 0:lr.data)!=null&&cr.length?e(nn,{options:Ye.options,series:Ye.series,type:"area",height:360}):e(p,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(Ce,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(pt,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(p,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(oi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ie.span,{fontWeight:"medium",children:ee!=null?ee:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:tt(He||0,2)})]})]}),n(Ce,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(st,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:ee!=null?ee:"",onChange:re=>Ae(re.target.value||null),isDisabled:Ze.length===0,children:Ze.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(ci,{presets:a,range:Y,onPresetChange:be,onCustomChange:dt})]})]}),e(z,{mt:6,children:V?n(ue,{spacing:3,children:[e(At,{}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):se.series.length?e(nn,{options:se.options,series:se.series,type:"donut",height:360}):e(p,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},Mm=()=>{var a;const{t}=Ke(),{userData:s,getUserIsSuccess:r}=fr(),l=Boolean(r&&((a=s.permissions)==null?void 0:a.sections.usage)),o=es(c=>c.services),i=es(c=>c.fetchServices);return d.exports.useEffect(()=>{l&&i({limit:500})},[i,l]),r?l?n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),n(Wn,{variant:"enclosed",colorScheme:"primary",children:[n(Fn,{children:[e(Vt,{children:t("usage.tabs.services","Services")}),e(Vt,{children:t("usage.tabs.admins","Admins")}),e(Vt,{children:t("usage.tabs.nodes","Nodes")})]}),n(Hn,{children:[e($t,{px:0,children:e(zm,{services:o})}),e($t,{px:0,children:e(Pm,{})}),e($t,{px:0,children:e(Rm,{})})]})]})]}):n(ue,{spacing:4,align:"stretch",children:[e(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(ct,{justify:"center",align:"center",py:10,children:e(At,{})})},$l="__dot__",ma=t=>t.replace(/\./g,$l),Gn=t=>t.replace(new RegExp($l,"g"),"."),Lm=t=>{const s={},r=(l,o)=>{if(o!==void 0){if(typeof o=="boolean"){s[Gn(l)]=o;return}if(typeof o=="string"){if(o==="")return;o==="true"||o==="false"?s[Gn(l)]=o==="true":s[Gn(l)]=Boolean(o);return}if(typeof o=="number"){s[Gn(l)]=o!==0;return}if(Array.isArray(o)){s[Gn(l)]=o.length>0;return}if(o&&typeof o=="object"){Object.entries(o).forEach(([i,a])=>{const c=l?`${l}.${i}`:i;r(c,a)});return}s[Gn(l)]=Boolean(o)}};return Object.entries(t).forEach(([l,o])=>{r(l,o)}),s},Kl=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],Um=Kl.flatMap(t=>t.events.map(s=>s.key)),Bo=ie(Yr,{baseStyle:{w:4,h:4}}),Vo=ie(fd,{baseStyle:{w:4,h:4}}),ta=t=>{var l,o,i,a;const s={};Object.entries(t.forum_topics||{}).forEach(([c,u])=>{var h;s[c]={title:(h=u.title)!=null?h:"",topic_id:u.topic_id!=null?String(u.topic_id):""}});const r={};return Um.forEach(c=>{var m;const u=ma(c),h=(m=t.event_toggles)==null?void 0:m[c];r[u]=h===void 0?!0:Boolean(h)}),Object.entries(t.event_toggles||{}).forEach(([c,u])=>{const h=ma(c);h in r||(r[h]=Boolean(u))}),{api_token:(l=t.api_token)!=null?l:"",use_telegram:(o=t.use_telegram)!=null?o:!0,proxy_url:(i=t.proxy_url)!=null?i:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(a=t.default_vless_flow)!=null?a:"",forum_topics:s,event_toggles:r}},ra=({disabled:t,message:s,children:r})=>n(z,{position:"relative",children:[e(z,{pointerEvents:t?"none":"auto",filter:t?"blur(1.2px)":"none",opacity:t?.55:1,transition:"all 0.2s ease",children:r}),t&&e(ct,{position:"absolute",inset:0,align:"center",justify:"center",textAlign:"center",fontWeight:"semibold",color:"white",px:6,borderRadius:"inherit",bg:"blackAlpha.400",backdropFilter:"blur(2px)",children:e(p,{children:s})})]}),Om=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(s=>s.length>0).map(s=>Number(s)).filter(s=>Number.isFinite(s)),Wm=()=>{var G,D,V,ge,pe;const{t}=Ke(),s=Kt(),{userData:r,getUserIsSuccess:l}=fr();if(!(l&&Boolean((G=r.permissions)==null?void 0:G.sections.integrations)))return n(ue,{spacing:4,align:"stretch",children:[e(yn,{size:"lg",children:t("header.integrationSettings","Integration settings")}),e(p,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("integrations.noPermission","You do not have permission to manage integration settings.")})]});const i=va(),{data:a,isLoading:c,refetch:u}=Mr("telegram-settings",Ju,{refetchOnWindowFocus:!1}),{data:h,isLoading:m,refetch:g}=Mr("panel-settings",_a,{refetchOnWindowFocus:!1}),w=Mr("maintenance-info",()=>Pe("/maintenance/info"),{refetchOnWindowFocus:!1}),[v,S]=d.exports.useState((D=h==null?void 0:h.use_nobetci)!=null?D:!1),[y,N]=d.exports.useState(!1),[I,M]=d.exports.useState(!1),ae=d.exports.useRef(null);d.exports.useEffect(()=>{h&&S(h.use_nobetci)},[h]);const{register:b,control:F,handleSubmit:C,reset:X,watch:Y,formState:{isDirty:me}}=Br({defaultValues:ta(a!=null?a:{api_token:null,use_telegram:!0,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{a&&X(ta(a))},[a,X]);const O=Ir(qu,{onSuccess:Z=>{X(ta(Z)),i.setQueryData("telegram-settings",Z),s({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),oe=Ir(Yu,{onSuccess:Z=>{S(Z.use_nobetci),i.setQueryData("panel-settings",Z),s({title:t("settings.panel.saved","Panel settings saved"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),P=Z=>{const _e=Lm(Z.event_toggles||{}),te={api_token:Z.api_token.trim()||null,use_telegram:Z.use_telegram,proxy_url:Z.proxy_url.trim()||null,admin_chat_ids:Om(Z.admin_chat_ids),logs_chat_id:Z.logs_chat_id.trim()?Number(Z.logs_chat_id.trim()):null,logs_chat_is_forum:Z.logs_chat_is_forum,default_vless_flow:Z.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(Z.forum_topics||{}).map(([le,B])=>[le,{title:B.title,topic_id:B.topic_id.trim()?Number(B.topic_id.trim()):void 0}])),event_toggles:_e};O.mutate(te)},we=Z=>{if(!Z)return`rebecca-backup-${Date.now()}.zip`;const _e=Z.split(";");for(const te of _e){const le=te.trim();if(le.toLowerCase().startsWith("filename="))return le.split("=",1)[1].trim().replace(/(^\"|\"$)/g,"")||`rebecca-backup-${Date.now()}.zip`}return`rebecca-backup-${Date.now()}.zip`},A=async()=>{N(!0);try{const Z=is(),_e=await fetch("/api/maintenance/backup/export",{method:"GET",headers:Z?{Authorization:`Bearer ${Z}`}:void 0});if(!_e.ok)throw new Error(await _e.text());const te=await _e.blob(),le=we(_e.headers.get("content-disposition")),B=window.URL.createObjectURL(te),L=document.createElement("a");L.href=B,L.download=le,document.body.appendChild(L),L.click(),document.body.removeChild(L),window.URL.revokeObjectURL(B),Bt(t("settings.panel.backupDownloadSuccess"),s)}catch(Z){Ht(Z,s)}finally{N(!1)}},De=async Z=>{var te;const _e=(te=Z.target.files)==null?void 0:te[0];if(!!_e){M(!0);try{const le=is(),B=new FormData;B.append("file",_e);const L=await fetch("/api/maintenance/backup/import",{method:"POST",headers:le?{Authorization:`Bearer ${le}`}:void 0,body:B});if(!L.ok)throw new Error(await L.text());Bt(t("settings.panel.backupUploadSuccess"),s)}catch(le){Ht(le,s)}finally{M(!1),Z.target.value=""}}},ee=Y("forum_topics"),Ae=Y("use_telegram"),Re=t("settings.telegram.disabledOverlay","Telegram bot is disabled. Enable it to edit these settings."),Me=()=>{var Z;(Z=ae.current)==null||Z.click()};return n(z,{px:{base:4,md:8},py:{base:6,md:8},children:[e(yn,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),n(Wn,{colorScheme:"primary",children:[n(Fn,{children:[e(Vt,{children:t("settings.panel.tabTitle","Panel")}),e(Vt,{children:t("settings.telegram","Telegram")}),e(Vt,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),n(Hn,{children:[e($t,{px:{base:0,md:2},children:m&&h===void 0?e(ct,{align:"center",justify:"center",py:12,children:e(At,{size:"lg"})}):n(Ce,{spacing:6,align:"stretch",children:[e(p,{fontSize:"sm",color:"gray.500",children:t("settings.panel.description","Control dashboard-specific behaviors that affect all admins.")}),e(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(ct,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(yn,{size:"sm",mb:1,children:t("settings.panel.useNobetciTitle","Enable Nobetci integration")}),e(p,{fontSize:"sm",color:"gray.500",children:t("settings.panel.useNobetciDescription","Show Nobetci options when creating or editing nodes.")})]}),e(mt,{isChecked:v,onChange:Z=>S(Z.target.checked),isDisabled:oe.isLoading||m})]})}),n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(ct,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(yn,{size:"sm",mb:1,children:t("settings.panel.maintenanceTitle","Maintenance status")}),e(p,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceDescription","Inspect which container images are currently used by the panel and node.")})]}),e(H,{variant:"outline",size:"sm",leftIcon:e(Yr,{width:16,height:16}),onClick:()=>w.refetch(),isLoading:w.isFetching,children:t("actions.refresh","Refresh")})]}),e(Ce,{spacing:2,mt:4,children:w.isLoading&&!w.data?e(ct,{align:"center",justify:"center",py:4,children:e(At,{size:"sm"})}):n(Ft,{children:[n(z,{children:[e(p,{fontWeight:"semibold",children:t("settings.panel.panelVersion","Panel image")}),e(p,{fontSize:"sm",color:"gray.500",children:(ge=(V=w.data)==null?void 0:V.panel)!=null&&ge.image?`${w.data.panel.image}${w.data.panel.tag?` (${w.data.panel.tag})`:""}`:t("settings.panel.versionUnknown","Unknown")})]}),n(z,{children:[e(p,{fontWeight:"semibold",children:t("settings.panel.nodeVersion","Node image")}),e(p,{fontSize:"sm",color:"gray.500",children:(pe=w.data)!=null&&pe.node?w.data.node.image?`${w.data.node.image}${w.data.node.tag?` (${w.data.node.tag})`:""}`:t("settings.panel.versionUnknown","Unknown"):t("settings.panel.nodeVersionUnavailable","Node deployment not detected")})]})]})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(ct,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(yn,{size:"sm",mb:1,children:t("settings.panel.backupTitle","Backup & Restore")}),e(p,{fontSize:"sm",color:"gray.500",children:t("settings.panel.backupDescription","Create or restore backups directly through the maintenance service.")})]}),n(Ce,{spacing:3,direction:{base:"column",md:"row"},children:[e(H,{leftIcon:e(xa,{width:16,height:16}),onClick:A,isLoading:y,children:t("settings.panel.backupDownload","Download backup")}),e(H,{leftIcon:e(ya,{width:16,height:16}),onClick:Me,isLoading:I,children:t("settings.panel.backupUpload","Restore backup")})]})]}),e("input",{ref:ae,type:"file",accept:".zip,.tar.gz",style:{display:"none"},onChange:De})]}),n(ct,{gap:3,justify:"flex-end",children:[e(H,{variant:"outline",leftIcon:e(Bo,{}),onClick:()=>g(),isDisabled:oe.isLoading,children:t("actions.refresh","Refresh")}),e(H,{colorScheme:"primary",leftIcon:e(Vo,{}),onClick:()=>oe.mutate({use_nobetci:v}),isLoading:oe.isLoading,isDisabled:oe.isLoading||h===void 0||v===h.use_nobetci,children:t("settings.save","Save Settings")})]})]})}),e($t,{px:{base:0,md:2},children:c&&!a?e(ct,{align:"center",justify:"center",py:12,children:e(At,{size:"lg"})}):e("form",{onSubmit:C(P),children:n(ue,{align:"stretch",spacing:6,children:[e(p,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),n(ct,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(yn,{size:"sm",mb:1,children:t("settings.telegram.enableBot","Enable Telegram bot")}),e(p,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.enableBotDescription","Turn the bot on or off without clearing the API token.")})]}),e(ft,{control:F,name:"use_telegram",render:({field:Z})=>e(mt,{isChecked:Z.value,onChange:_e=>Z.onChange(_e.target.checked)})})]}),e(ra,{disabled:!Ae,message:Re,children:e(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:n($e,{columns:{base:1,md:2},spacing:6,children:[n(k,{children:[e(_,{children:t("settings.telegram.apiToken","Bot API Token")}),e(ve,{placeholder:"123456:ABC",...b("api_token")})]}),n(k,{children:[e(_,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(ve,{placeholder:"socks5://user:pass@host:port",...b("proxy_url")})]}),n(k,{children:[e(_,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(ve,{placeholder:"12345, 67890",...b("admin_chat_ids")}),e(nr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),n(k,{children:[e(_,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(ve,{placeholder:"-100123456789",...b("logs_chat_id")}),e(nr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(ft,{control:F,name:"logs_chat_is_forum",render:({field:Z})=>e(mt,{id:"logs_chat_is_forum",isChecked:Z.value,onChange:Z.onChange})})]}),n(k,{children:[e(_,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(ve,{placeholder:"xtls-rprx-vision",...b("default_vless_flow")})]})]})})}),e(ra,{disabled:!Ae,message:Re,children:n(z,{children:[e(yn,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),ee&&Object.keys(ee).length>0?e(Ce,{spacing:4,children:Object.entries(ee).map(([Z])=>n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(p,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",Z]}),n($e,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:t("settings.telegram.topicTitle","Topic Title")}),e(ve,{...b(`forum_topics.${Z}.title`)})]}),n(k,{children:[e(_,{children:t("settings.telegram.topicId","Topic ID")}),e(ve,{type:"number",...b(`forum_topics.${Z}.topic_id`)}),e(nr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},Z))}):e(p,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]})}),e(ra,{disabled:!Ae,message:Re,children:n(z,{children:[e(yn,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(p,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(Ce,{spacing:4,children:Kl.map(Z=>n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(p,{fontWeight:"semibold",mb:3,children:t(Z.titleKey,Z.defaultTitle)}),e($e,{columns:{base:1,md:2},spacing:4,children:Z.events.map(_e=>n(k,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[n(z,{flex:"1",children:[e(p,{fontWeight:"medium",children:t(_e.labelKey,_e.defaultLabel)}),e(p,{fontSize:"sm",color:"gray.500",children:t(_e.hintKey,_e.defaultHint)})]}),e(ft,{control:F,name:`event_toggles.${ma(_e.key)}`,render:({field:te})=>e(mt,{isChecked:Boolean(te.value),onChange:le=>te.onChange(le.target.checked)})})]},_e.key))})]},Z.key))})]})}),n(ct,{gap:3,justify:"flex-end",children:[e(H,{variant:"outline",leftIcon:e(Bo,{}),onClick:()=>u(),isDisabled:O.isLoading,children:t("actions.refresh","Refresh")}),e(H,{colorScheme:"primary",leftIcon:e(Vo,{}),type:"submit",isLoading:O.isLoading,isDisabled:!me&&!O.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e($t,{children:e(p,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},Fm=async()=>{try{const t=is();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const s=await Pe("/admin",{headers:{Authorization:`Bearer ${t}`}});if(s&&typeof s=="object"&&"error"in s)throw new Error(`API error: ${s.error||"Unknown error"}`);return s}catch(t){throw console.error("Loader error:",t),t}},Hm=bd([{path:"/",element:e(mu,{}),errorElement:e(Ka,{}),loader:Fm,children:[{index:!0,element:e(Cu,{})},{path:"users",element:e(Sh,{})},{path:"admins",element:e(Eh,{})},{path:"usage",element:e(Mm,{})},{path:"services",element:e(wm,{})},{path:"hosts",element:e(xp,{})},{path:"node-settings",element:e(Op,{})},{path:"integrations",element:e(Wm,{})},{path:"xray-settings",element:e(xm,{})},{path:"xray-logs",element:e(Bl,{})}]},{path:"/login/",element:e(Ka,{})}]);function Bm(){return e(yd,{router:Hm})}ze.extend(xd);ze.extend(Sd);ze.extend(Ys);ze.extend(wd);ze.extend(kd);mi(vd.get()||"light");Cd.createRoot(document.getElementById("root")).render(e(na.StrictMode,{children:e(_d,{theme:Ad,children:e(Dd,{client:pi,children:e(Bm,{})})})}));
