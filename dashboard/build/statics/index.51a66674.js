var Ml=Object.defineProperty;var Ol=(t,s,r)=>s in t?Ml(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var $=(t,s,r)=>(Ol(t,typeof s!="symbol"?s+"":s,r),r);import{i as ni,B as Wl,a as Fl,b as Hl,j as Lo,d as $e,U as oa,z as Bl,r as Vl,f as $l,Q as Kl,e as Jl,m as Et,$ as ql,c as ee,X as la,R as Gi,N as In,I as xe,g as Pn,h as n,F as w,k as e,l as _,n as xr,o as Yl,p as ca,q as Lt,s as Gl,t as Ql,u as Xl,v as Zl,w as Pr,x as Qr,L as jl,C as yi,y as Je,A as nt,M as di,D as ui,E as Le,G as hi,H as tr,J as U,K as ec,T as h,S as tc,P as rc,O as Qi,V as tn,W as pi,Y as da,Z as ua,_ as nc,a0 as Ht,a1 as $r,a2 as Gt,a3 as d,a4 as _a,a5 as T,a6 as mi,a7 as Rt,a8 as vt,a9 as Ut,aa as At,ab as zt,ac as Ct,ad as ue,ae as Ke,af as ke,ag as Lr,ah as K,ai as Nt,aj as _r,ak as Pe,al as sc,am as Ps,an as ha,ao as ic,ap as pa,aq as Mr,ar as en,as as ln,at as Dr,au as Ar,av as bn,aw as Si,ax as Tr,ay as ac,az as Mo,aA as oc,aB as lc,aC as cc,aD as dc,aE as xi,aF as Oo,aG as Wo,aH as st,aI as Xn,aJ as Da,aK as uc,aL as hc,aM as pc,aN as Fo,aO as Sr,aP as ot,aQ as mc,aR as gc,aS as Ho,aT as Bo,aU as ns,aV as fc,aW as bc,aX as ki,aY as Dt,aZ as Vo,a_ as Vr,a$ as dn,b0 as yc,b1 as ma,b2 as Dn,b3 as $o,b4 as Sc,b5 as xc,b6 as tt,b7 as Ko,b8 as kc,b9 as wc,ba as Jo,bb as vc,bc as qo,bd as Cc,be as _c,bf as Dc,bg as Yo,bh as Ac,bi as Ic,bj as Pc,bk as As,bl as Aa,bm as ss,bn as is,bo as Bt,bp as as,bq as Vt,br as Tc,bs as Ec,bt as yn,bu as Nc,bv as Ft,bw as zc,bx as ut,by as dt,bz as Go,bA as jr,bB as rn,bC as Qo,bD as Xo,bE as Zo,bF as Tn,bG as Xr,bH as _t,bI as He,bJ as Br,bK as Ne,bL as Qs,bM as Wn,bN as jo,bO as el,bP as tl,bQ as Ia,bR as an,bS as Rc,bT as Uc,bU as Lc,bV as Mc,bW as Oc,bX as Wc,bY as Ts,bZ as Es,b_ as Us,b$ as rl,c0 as gt,c1 as Fc,c2 as qn,c3 as Ir,c4 as Ls,c5 as Ms,c6 as Hc,c7 as Os,c8 as Ws,c9 as nl,ca as Fs,cb as Jn,cc as si,cd as Bc,ce as sl,cf as ga,cg as Cr,ch as il,ci as gi,cj as Gr,ck as Hs,cl as Yn,cm as Vc,cn as $c,co as Kc,cp as Jc,cq as ii,cr as Is,cs as al,ct as ol,cu as qc,cv as Yc,cw as Gc,cx as Qc,cy as Xc,cz as Zc,cA as jc,cB as ed,cC as td,cD as Pa,cE as rd,cF as nd,cG as sd,cH as fa,cI as id,cJ as kn,cK as ad,cL as od,cM as ld,cN as cd,cO as dd,cP as ud,cQ as hd,cR as pd,cS as md,cT as gd}from"./vendor.9578cc89.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();ni.use(Wl).use(Fl).use(Hl).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:Lo(["/","statics/locales/{{lng}}.json"])}},function(t,s){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",ni.language),$e.locale(ni.language)});ni.on("languageChanged",t=>{console.log("Language changed to:",t),$e.locale(t)});oa("zh-cn",Bl);oa("ru",Vl);oa("fa",$l);const ai=new Kl,oi=(t,s)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:s||"#f6f8ff"},o=s||l[t]||l.default;r==null||r.setAttribute("content",o)},fd=Jl({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:Et("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:Et("surface.light","surface.dark")(t),borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Et("lg","dark-lg")(t)},item:{_hover:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Et("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:Et("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:Et("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:Et("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const Zn=()=>localStorage.getItem("token"),bd=t=>{localStorage.setItem("token",t)},yd=()=>{localStorage.removeItem("token")},Sd=ql.create({baseURL:"https://bot.mazholl.com:8585/api"}),xd=(t,s={})=>(Zn()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${Zn()}`}),Sd(t,s)),_e=xd,kd=ee(la,{baseStyle:{w:4,h:4}}),Yt=Gi.forwardRef(({disabled:t,step:s,label:r,className:l,startAdornment:o,endAdornment:a,type:i="text",placeholder:c,onChange:u,onBlur:p,name:m,value:g,onClick:A,error:D,clearable:k=!1,...x},v)=>{var I;const C=()=>{u&&u({target:{value:"",name:m}})},{size:R="md"}=x,ie=i=="number"?In:xe,b=i=="number"?Pn:Gi.Fragment,M=i=="number"?{keepWithinRange:!0,precision:5,format:W=>isNaN(parseFloat(String(W)))||Number(parseFloat(String(W)).toFixed(5))===0?W:Number(parseFloat(String(W)).toFixed(5)),min:(I=x.min)!=null?I:0,step:s,name:m,type:i,placeholder:c,onBlur:p,onClick:A,disabled:t,flexGrow:1,size:R,onChange:(W,ve)=>{!u||u({target:{value:W,valueAsNumber:ve,name:m}})}}:{};return n(w,{isInvalid:!!D,children:[r&&e(_,{children:r}),n(xr,{size:R,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[o&&e(Yl,{children:o}),n(b,{...M,children:[e(ie,{name:m,ref:v,step:s,className:ca(l),type:i,placeholder:c,onChange:i==="number"?void 0:u,onBlur:p,value:i==="number"?void 0:g,onClick:A,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...x,roundedLeft:o?"0":"md",roundedRight:a?"0":"md"}),i=="number"&&e(Lt,{children:n(Gl,{children:[e(Ql,{}),e(Xl,{})]})})]}),a&&e(Zl,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:a}),k&&g&&g.length&&e(Pr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:C,cursor:"pointer",children:e(kd,{})})]}),!!D&&e(Qr,{children:D})]})}),Xi="/statics/logo.e8dba2f4.svg",wd=ee(jl,{baseStyle:{w:4,h:4}}),vd=ee(yi,{baseStyle:{w:4,h:4}}),ll=({actions:t})=>{const{i18n:s}=Je(),r=nt("surface.light","surface.dark"),l=nt("blackAlpha.50","whiteAlpha.100"),o=nt("blackAlpha.200","whiteAlpha.200"),a=nt("gray.800","gray.100"),i=u=>{s.changeLanguage(u)};return n(di,{placement:"bottom-end",children:[e(ui,{as:Le,size:"sm",variant:"outline",icon:e(wd,{}),position:"relative"}),e(hi,{minW:"160px",zIndex:9999,bg:r,borderColor:o,color:a,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:p,flag:m})=>e(tr,{fontSize:"sm",onClick:()=>i(u),_hover:{bg:l},children:n(U,{justify:"space-between",w:"full",children:[n(U,{spacing:2,children:[e(ec,{countryCode:m,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:p})]}),s.language===u&&e(vd,{})]})},u))})]})},Ta="rb-theme",Ea="rb-custom-themes",Cd=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],Na=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],za=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],gr={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},fr={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Ti=.14,Ei=.22,Ra=ee(yi,{baseStyle:{w:4,h:4}}),_d=ee(tc,{baseStyle:{w:4,h:4}}),Dd=ee(rc,{baseStyle:{w:4,h:4}}),Ad=ee(Qi,{baseStyle:{w:4,h:4}}),Id=ee(tn,{baseStyle:{w:4,h:4}}),Ua=ee(pi,{baseStyle:{w:4,h:4}}),Pd=ee(da,{baseStyle:{w:4,h:4}}),Td=ee(ua,{baseStyle:{w:4,h:4}}),Ed=ee(nc,{baseStyle:{w:4,h:4}}),cl=(t,s=0,r=1)=>Math.min(r,Math.max(s,t)),Zi=t=>{const s=t.replace("#",""),r=parseInt(s,16);if(s.length===3){const l=r>>8&15,o=r>>4&15,a=r&15;return{r:l<<4|l,g:o<<4|o,b:a<<4|a}}return{r:r>>16&255,g:r>>8&255,b:r&255}},dl=(t,s,r)=>{const l=o=>o.toString(16).padStart(2,"0");return`#${l(t)}${l(s)}${l(r)}`},Nd=(t,s,r)=>{t/=255,s/=255,r/=255;const l=Math.max(t,s,r),o=Math.min(t,s,r);let a=0,i=0;const c=(l+o)/2;if(l!==o){const u=l-o;switch(i=c>.5?u/(2-l-o):u/(l+o),l){case t:a=(s-r)/u+(s<r?6:0);break;case s:a=(r-t)/u+2;break;default:a=(t-s)/u+4}a/=6}return{h:a,s:i,l:c}},zd=(t,s,r)=>{let l,o,a;if(s===0)l=o=a=r;else{const i=(p,m,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?p+(m-p)*6*g:g<.5?m:g<.6666666666666666?p+(m-p)*(.6666666666666666-g)*6:p),c=r<.5?r*(1+s):r+s-r*s,u=2*r-c;l=i(u,c,t+1/3),o=i(u,c,t),a=i(u,c,t-1/3)}return{r:Math.round(l*255),g:Math.round(o*255),b:Math.round(a*255)}},Ni=t=>{try{const{r:s,g:r,b:l}=Zi(t),{h:o,s:a,l:i}=Nd(s,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[p,m])=>{const{r:g,g:A,b:D}=zd(o,a,cl(i+m));return u[`--primary-${p}`]=dl(g,A,D),u},{})}catch{return{}}},Rd=(t,s,r)=>{const l=cl(r,0,1),o=Zi(t),a=Zi(s),i=(c,u)=>Math.round(c*(1-l)+u*l);return dl(i(o.r,a.r),i(o.g,a.g),i(o.b,a.b))},Fn=(t,s,r,l)=>{try{return Rd(t,s,r)}catch{return l}},Ud=()=>{const t=document.documentElement;Cd.forEach(s=>t.style.removeProperty(s)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},Ld=(t,s)=>{const r=document.documentElement;Object.entries(t).forEach(([l,o])=>r.style.setProperty(l,o)),r.style.setProperty("--bg-light",s.bgLight),r.style.setProperty("--bg-dark",s.bgDark),r.style.setProperty("--surface-light",s.surfaceLight),r.style.setProperty("--surface-dark",s.surfaceDark)},zi=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},La=()=>({name:"",light:{...gr},dark:{...fr}}),Jt=(t,s)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:s,ul=({minimal:t=!1})=>{const{t:s}=Je(),r=Ht(),{colorMode:l,toggleColorMode:o}=$r(),a=Gt(),i=Gt(),c=nt("surface.light","surface.dark"),u=nt("blackAlpha.50","whiteAlpha.100"),p=nt("blackAlpha.200","whiteAlpha.200"),m=nt("gray.800","gray.100"),g=nt("gray.600","gray.300"),A=nt("blackAlpha.400","blackAlpha.700"),D=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:g}}),[g]),[k,x]=d.exports.useState(()=>{try{return localStorage.getItem(Ta)||"default"}catch{return"default"}}),[v,C]=d.exports.useState(()=>{try{const y=localStorage.getItem(Ea);if(!y)return[];const E=JSON.parse(y);return Array.isArray(E)?E.map(ae=>{var de,ze,it,he,ce,oe;const re=Jt(((de=ae.light)==null?void 0:de.primary)||gr.primary,gr.primary),Ce=Jt(((ze=ae.light)==null?void 0:ze.bg)||gr.bg,gr.bg),Te=Fn(Ce,re,Ti,gr.surface),Re=Jt(((it=ae.light)==null?void 0:it.surface)||Te,Te),Me=Jt(((he=ae.dark)==null?void 0:he.primary)||fr.primary,fr.primary),H=Jt(((ce=ae.dark)==null?void 0:ce.bg)||fr.bg,fr.bg),B=Fn(H,Me,Ei,fr.surface),O=Jt(((oe=ae.dark)==null?void 0:oe.surface)||B,B);return{id:ae.id||zi(),name:ae.name||"Custom",light:{primary:re,bg:Ce,surface:Re},dark:{primary:Me,bg:H,surface:O}}}):[]}catch{return[]}}),[R,ie]=d.exports.useState(La),[b,M]=d.exports.useState(null),[I,W]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(Ea,JSON.stringify(v))}catch{}},[v]),d.exports.useEffect(()=>{try{localStorage.setItem(Ta,k)}catch{}},[k]),d.exports.useEffect(()=>{k.startsWith("custom:")&&(v.some(E=>`custom:${E.id}`===k)||x("default"))},[k,v]),d.exports.useEffect(()=>{const y=document.documentElement;Array.from(y.classList).filter(ae=>ae.startsWith("rb-theme-")).forEach(ae=>y.classList.remove(ae)),Ud();const E=Na.find(ae=>ae.key===k);if(E){E.className&&y.classList.add(E.className),oi(E.key);return}if(k.startsWith("custom:")){const ae=v.find(Te=>`custom:${Te.id}`===k);if(!ae)return;const re=l==="dark"?ae.dark:ae.light,Ce=Ni(re.primary);Ld(Ce,{bgLight:ae.light.bg,bgDark:ae.dark.bg,surfaceLight:ae.light.surface,surfaceDark:ae.dark.surface}),oi("custom",l==="dark"?ae.dark.bg:ae.light.bg)}else oi("default")},[k,v,l]);const ve=d.exports.useCallback(y=>{y.colorModeTarget&&l!==y.colorModeTarget&&o(),x(y.key)},[l,o]),Z=y=>{x(`custom:${y}`)},te=y=>{M(null),ie(y?{name:s(`theme.presets.${y.key}.name`),light:{...y.light},dark:{...y.dark}}:La()),a.onOpen()},z=y=>{M(y.id),ie({name:y.name,light:{...y.light},dark:{...y.dark}}),a.onOpen()},j=()=>{const y=R.name.trim()||s("theme.untitled"),E=Jt(R.light.primary,gr.primary),ae=Jt(R.light.bg,gr.bg),re=Fn(ae,E,Ti,gr.surface),Ce=Jt(R.light.surface,re),Te=Jt(R.dark.primary,fr.primary),Re=Jt(R.dark.bg,fr.bg),Me=Fn(Re,Te,Ei,fr.surface),H=Jt(R.dark.surface,Me),B={id:b||zi(),name:y,light:{primary:E,bg:ae,surface:Ce},dark:{primary:Te,bg:Re,surface:H}};C(O=>b?O.map(de=>de.id===b?B:de):[...O,B]),x(`custom:${B.id}`),a.onClose(),M(null),r({status:"success",title:s("theme.customSaved")})},pe=y=>{C(E=>E.filter(ae=>ae.id!==y)),k===`custom:${y}`&&x("default"),r({status:"info",title:s("theme.customDeleted")})},Y=()=>{x("default"),r({status:"info",title:s("theme.resetSuccess")})},Q=async()=>{if(!v.length){r({status:"warning",title:s("theme.exportEmpty")});return}const y=v.map(({id:ae,...re})=>re),E=JSON.stringify(y,null,2);try{await navigator.clipboard.writeText(E),r({status:"success",title:s("theme.exportSuccess")})}catch{try{const ae=new Blob([E],{type:"application/json"}),re=URL.createObjectURL(ae),Ce=document.createElement("a");Ce.href=re,Ce.download="rebecca-themes.json",Ce.click(),URL.revokeObjectURL(re),r({status:"success",title:s("theme.exportSuccessDownload")})}catch{r({status:"error",title:s("theme.exportError")})}}},P=()=>{try{const y=JSON.parse(I),ae=(Array.isArray(y)?y:[y]).map(re=>{var ze,it,he,ce,oe,V;const Ce=Jt(((ze=re==null?void 0:re.light)==null?void 0:ze.primary)||gr.primary,gr.primary),Te=Jt(((it=re==null?void 0:re.light)==null?void 0:it.bg)||gr.bg,gr.bg),Re=Fn(Te,Ce,Ti,gr.surface),Me=Jt(((he=re==null?void 0:re.light)==null?void 0:he.surface)||Re,Re),H=Jt(((ce=re==null?void 0:re.dark)==null?void 0:ce.primary)||fr.primary,fr.primary),B=Jt(((oe=re==null?void 0:re.dark)==null?void 0:oe.bg)||fr.bg,fr.bg),O=Fn(B,H,Ei,fr.surface),de=Jt(((V=re==null?void 0:re.dark)==null?void 0:V.surface)||O,O);return{id:zi(),name:(re==null?void 0:re.name)||"Custom",light:{primary:Ce,bg:Te,surface:Me},dark:{primary:H,bg:B,surface:de}}}).filter(re=>re.name);if(!ae.length){r({status:"warning",title:s("theme.importError")});return}C(re=>[...re,...ae]),i.onClose(),W(""),r({status:"success",title:s("theme.importSuccess")})}catch{r({status:"error",title:s("theme.importError")})}},me=d.exports.useCallback((y,E)=>{y.preventDefault(),y.stopPropagation(),E()},[]),Ie=d.exports.useMemo(()=>Ni(R.light.primary),[R.light.primary]),De=d.exports.useMemo(()=>Ni(R.dark.primary),[R.dark.primary]),L=y=>{const E=R[y],ae=y==="dark"?De:Ie,re=ae["--primary-500"]||E.primary,Ce=ae["--primary-300"]||ae["--primary-400"]||re,Te=y==="dark"?"whiteAlpha.900":"gray.800",Re=y==="dark"?"whiteAlpha.700":"gray.600",Me=y==="dark"?"whiteAlpha.200":"blackAlpha.200",H=y==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(T,{borderWidth:"1px",borderRadius:"md",bg:E.bg,p:4,borderColor:Me,children:n(ke,{spacing:3,children:[e(h,{fontWeight:"semibold",color:Te,children:s(y==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(T,{borderRadius:"lg",bg:E.surface,p:4,borderWidth:"1px",borderColor:Me,children:n(ke,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:Te,children:s("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:Re,children:s("theme.previewSampleBody")}),e(K,{size:"sm",bg:re,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:s("theme.previewSampleAction")}),n(U,{spacing:2,pt:2,children:[e(T,{flex:"1",h:"2",borderRadius:"full",bg:Ce,opacity:.8}),e(T,{flex:"1",h:"2",borderRadius:"full",bg:re,opacity:.9})]})]})}),n(U,{spacing:1,pt:1,flexWrap:"wrap",children:[e(T,{w:6,h:6,borderRadius:"sm",bg:E.bg,borderWidth:"1px",borderColor:H}),e(T,{w:6,h:6,borderRadius:"sm",bg:E.surface,borderWidth:"1px",borderColor:H}),Object.entries(ae).map(([B,O])=>e(T,{w:6,h:6,borderRadius:"sm",bg:O,borderWidth:"1px",borderColor:H,title:B},B))]})]})})};return n(Lt,{children:[n(di,{placement:"bottom-end",children:[e(ui,{as:Le,size:"sm",variant:"outline",icon:e(_d,{}),position:"relative"}),n(hi,{minW:"260px",zIndex:9999,bg:c,color:m,borderColor:p,children:[e(_a,{title:s("theme.builtIn"),sx:D,children:Na.map(y=>{const E=k===y.key;return e(tr,{onClick:()=>ve(y),_hover:{bg:u},children:n(U,{justify:"space-between",w:"full",children:[n(U,{children:[e(T,{w:"4",h:"3",bg:y.accent,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:s(`theme.${y.key}`)})]}),E&&e(Ra,{})]})},y.key)})}),!t&&n(Lt,{children:[e(mi,{borderColor:p}),n(_a,{title:s("theme.customGroup"),sx:D,children:[v.length?v.map(y=>{const E=k===`custom:${y.id}`;return e(tr,{onClick:()=>Z(y.id),_hover:{bg:u},children:n(U,{justify:"space-between",w:"full",children:[n(U,{children:[e(T,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${y.light.surface}, ${y.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:y.name})]}),n(U,{spacing:1,children:[E&&e(Ra,{}),[{icon:e(Ad,{}),label:s("theme.edit"),onClick:()=>z(y)},{icon:e(Id,{}),label:s("theme.delete"),onClick:()=>pe(y.id)}].map(({icon:ae,label:re,onClick:Ce})=>e(T,{as:"span",role:"button",tabIndex:0,"aria-label":re,onClick:Te=>me(Te,Ce),onKeyDown:Te=>{(Te.key==="Enter"||Te.key===" ")&&me(Te,Ce)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:u},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:ae},re))]})]})},y.id)}):e(tr,{isDisabled:!0,children:s("theme.noCustom")}),e(tr,{icon:e(Dd,{}),onClick:()=>te(),_hover:{bg:u},children:s("theme.createCustom")})]}),e(mi,{borderColor:p}),e(tr,{icon:e(Ua,{}),onClick:()=>te(za[0]),_hover:{bg:u},children:s("theme.quickPreset")}),e(tr,{icon:e(Pd,{}),onClick:Q,_hover:{bg:u},children:s("theme.export")}),e(tr,{icon:e(Td,{}),onClick:()=>i.onOpen(),_hover:{bg:u},children:s("theme.import")}),e(tr,{icon:e(Ed,{}),onClick:Y,_hover:{bg:u},children:s("theme.reset")})]})]})]}),n(Rt,{isOpen:a.isOpen,onClose:a.onClose,isCentered:!0,size:"xl",children:[e(vt,{bg:A,backdropFilter:"blur(4px)"}),n(Ut,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:m,children:[e(At,{color:m,children:s(b?"theme.editThemeTitle":"theme.customTitle")}),e(zt,{}),e(Ct,{children:n(ue,{spacing:6,align:"stretch",children:[n(w,{children:[e(_,{color:g,children:s("theme.customName")}),e(xe,{placeholder:s("theme.customNamePlaceholder")||"",value:R.name,onChange:y=>ie(E=>({...E,name:y.target.value}))})]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[L("light"),L("dark")]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(ke,{spacing:4,children:[n(w,{children:[e(_,{color:g,children:s("theme.lightPrimary")}),e(xe,{type:"color",value:R.light.primary,onChange:y=>ie(E=>({...E,light:{...E.light,primary:y.target.value}}))}),e(Lr,{color:g,children:s("theme.lightPrimaryHint")})]}),n(w,{children:[e(_,{color:g,children:s("theme.lightSurface")}),e(xe,{type:"color",value:R.light.surface,onChange:y=>ie(E=>({...E,light:{...E.light,surface:y.target.value}}))}),e(Lr,{color:g,children:s("theme.lightSurfaceHint")})]}),n(w,{children:[e(_,{color:g,children:s("theme.lightBackground")}),e(xe,{type:"color",value:R.light.bg,onChange:y=>ie(E=>({...E,light:{...E.light,bg:y.target.value}}))})]})]}),n(ke,{spacing:4,children:[n(w,{children:[e(_,{color:g,children:s("theme.darkPrimary")}),e(xe,{type:"color",value:R.dark.primary,onChange:y=>ie(E=>({...E,dark:{...E.dark,primary:y.target.value}}))}),e(Lr,{color:g,children:s("theme.darkPrimaryHint")})]}),n(w,{children:[e(_,{color:g,children:s("theme.darkSurface")}),e(xe,{type:"color",value:R.dark.surface,onChange:y=>ie(E=>({...E,dark:{...E.dark,surface:y.target.value}}))}),e(Lr,{color:g,children:s("theme.darkSurfaceHint")})]}),n(w,{children:[e(_,{color:g,children:s("theme.darkBackground")}),e(xe,{type:"color",value:R.dark.bg,onChange:y=>ie(E=>({...E,dark:{...E.dark,bg:y.target.value}}))})]})]})]}),n(T,{children:[n(U,{mb:2,children:[e(Ua,{}),e(h,{fontWeight:"semibold",children:s("theme.presets")})]}),e(Ke,{columns:{base:1,md:3},spacing:3,children:za.map(y=>e(K,{size:"sm",variant:"outline",onClick:()=>ie({name:s(`theme.presets.${y.key}.name`),light:{...y.light},dark:{...y.dark}}),children:s(`theme.presets.${y.key}.name`)},y.key))})]})]})}),n(Nt,{children:[e(K,{variant:"ghost",mr:3,onClick:a.onClose,children:s("cancel")}),e(K,{colorScheme:"primary",onClick:j,children:s(b?"theme.customUpdate":"theme.customSave")})]})]})]}),n(Rt,{isOpen:i.isOpen,onClose:i.onClose,size:"lg",isCentered:!0,children:[e(vt,{bg:A,backdropFilter:"blur(4px)"}),n(Ut,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:m,children:[e(At,{color:m,children:s("theme.importTitle")}),e(zt,{}),e(Ct,{children:n(ue,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:g,children:s("theme.importDescription")}),e(_r,{rows:8,placeholder:s("theme.importPlaceholder")||"",value:I,onChange:y=>W(y.target.value),bg:"transparent",borderColor:p,color:m})]})}),n(Nt,{children:[e(K,{variant:"ghost",mr:3,onClick:i.onClose,children:s("cancel")}),e(K,{colorScheme:"primary",onClick:P,children:s("theme.importAction")})]})]})]})]})},Md=Pe.object({username:Pe.string().min(1,"login.fieldRequired"),password:Pe.string().min(1,"login.fieldRequired")}),Od=ee("img",{baseStyle:{w:12,h:12}}),Wd=ee(sc,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Fd=ee(Ps,{baseStyle:{w:4,h:4}}),Hd=ee(ha,{baseStyle:{w:4,h:4}}),Ma=()=>{var k,x;const[t,s]=d.exports.useState(""),[r,l]=d.exports.useState(!1),[o,a]=d.exports.useState(!1),i=ic(),{t:c}=Je(),{colorMode:u}=$r();let p=pa();const{register:m,formState:{errors:g},handleSubmit:A}=Mr({resolver:Si(Md)});d.exports.useEffect(()=>{yd(),p.pathname!=="/login"&&i("/login",{replace:!0})},[]);const D=v=>{s("");const C=new FormData;C.append("username",v.username),C.append("password",v.password),C.append("grant_type","password"),l(!0),_e("/admin/token",{method:"post",body:C}).then(({access_token:R})=>{console.log("Token received:",R),bd(R),i("/")}).catch(R=>{var ie,b;s(((b=(ie=R.response)==null?void 0:ie._data)==null?void 0:b.detail)||"Login failed")}).finally(()=>l(!1))};return e(ue,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(en,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:n(ln,{children:[n(U,{justifyContent:"end",spacing:2,mb:6,children:[e(ll,{}),e(ul,{minimal:!0})]}),n(ue,{alignItems:"center",w:"full",spacing:4,children:[e(Od,{src:Xi,alt:c("appName")||"Rebecca",filter:u==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(T,{w:"full",pt:"4",children:e("form",{onSubmit:A(D),children:n(ue,{spacing:4,children:[e(w,{children:e(Yt,{w:"full",placeholder:c("username"),...m("username"),error:c((k=g==null?void 0:g.username)==null?void 0:k.message)})}),n(w,{isInvalid:!!g.password,children:[n(xr,{children:[e(xe,{w:"full",type:o?"text":"password",placeholder:c("password"),...m("password")}),e(Pr,{children:e(Le,{"aria-label":o?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>a(!o),icon:o?e(Hd,{}):e(Fd,{})})})]}),e(Qr,{children:(x=g.password)==null?void 0:x.message})]}),t&&n(Dr,{status:"error",rounded:"md",children:[e(Ar,{}),e(bn,{children:t})]}),n(K,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(Wd,{marginRight:1}),c("login")]})]})})})]})})})},Bd=async()=>await _e("/admin"),Un=()=>{const{data:t,isError:s,isLoading:r,isSuccess:l,error:o}=Tr({queryFn:()=>Bd()});return{userData:t||{is_sudo:!1,telegram_id:"",username:"",users_usage:0},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:s,getUserError:o}},un={baseStyle:{w:5,h:5}},Vd=ee(ac,un),$d=ee(Mo,un),Kd=ee(oc,un),Ri=ee(lc,un),Jd=ee(cc,un),qd=ee(dc,un),Yd=ee(xi,un),Gd=ee(Oo,un),Qd=ee(Wo,un),Oa=ee("img",{baseStyle:{w:8,h:8}}),Wa=({collapsed:t,inDrawer:s=!1,onRequestExpand:r})=>{const{t:l}=Je(),o=pa(),{colorMode:a}=$r(),{userData:i,getUserIsSuccess:c}=Un(),u=c&&i.is_sudo,m=[...[{title:l("header.hostSettings"),url:"/hosts",icon:Kd},{title:l("header.nodeSettings"),url:"/node-settings",icon:Jd},{title:l("header.integrationSettings","Master Settings"),url:"/integrations",icon:Ri},{title:l("header.xraySettings"),url:"/xray-settings",icon:Ri}]];u&&m.unshift({title:l("services.menu","Services"),url:"/services",icon:Gd});const g=m.some(x=>o.pathname===x.url),[A,D]=d.exports.useState(g);d.exports.useEffect(()=>{g&&D(!0)},[g]);const k=[{title:l("dashboard"),url:"/",icon:Vd},{title:l("users"),url:"/users",icon:$d}];return u&&(k.push({title:l("usage.menu","Usage"),url:"/usage",icon:Qd}),k.push({title:l("admins","Admins"),url:"/admins",icon:qd}),k.push({title:l("header.settings"),icon:Ri,subItems:m})),e(T,{w:s?"full":t?"16":"60",h:s?"100%":"100vh",maxH:s?"100%":"100vh",bg:"surface.light",borderRight:s?void 0:"1px",borderColor:s?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:s?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:s?"relative":"fixed",top:s?void 0:"0",left:s?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:n(ue,{spacing:2,p:t?2:4,align:"stretch",h:"100%",justify:"space-between",children:[n(T,{flex:"1",overflowY:"auto",children:[t?e(U,{justify:"center",mb:6,children:e(st,{label:"Rebecca",placement:"right",hasArrow:!0,children:e(Oa,{src:Xi,alt:"Rebecca",filter:a==="dark"?"brightness(0) invert(1)":"none"})})}):n(U,{spacing:3,align:"center",mb:6,px:2,children:[e(Oa,{src:Xi,alt:"Rebecca",filter:a==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"lg",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},children:l("menu")})]}),k.map(x=>{const v=x.url,C=typeof v=="string"&&o.pathname===v||typeof v=="string"&&v!=="/"&&o.pathname.startsWith(v)||x.subItems&&x.subItems.some(ie=>o.pathname===ie.url),R=x.icon;return e(T,{children:x.subItems?n(Lt,{children:[e(st,{label:t?x.title:"",placement:"right",hasArrow:!0,children:n(U,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:C?"primary.50":"transparent",color:C?"primary.600":"gray.700",_dark:{bg:C?"primary.900":"transparent",color:C?"primary.200":"gray.300"},_hover:{bg:C?"primary.50":"gray.50",_dark:{bg:C?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>{t?(r&&r(),D(!0)):D(!A)},children:[n(U,{spacing:3,children:[e(R,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:C?"semibold":"normal",children:x.title})]}),!t&&e(Yd,{transform:A?"rotate(180deg)":"rotate(0deg)"})]})}),!t&&e(Xn,{in:A,animateOpacity:!0,children:e(ue,{align:"stretch",pl:6,spacing:1,mt:2,children:x.subItems.map(ie=>{const b=o.pathname===ie.url,M=ie.icon;return e(Da,{to:ie.url,children:n(U,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:b?"primary.50":"transparent",color:b?"primary.600":"gray.700",_dark:{bg:b?"primary.900":"transparent",color:b?"primary.200":"gray.300"},_hover:{bg:b?"primary.50":"gray.50",_dark:{bg:b?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(M,{w:t?5:void 0,h:t?5:void 0}),e(h,{fontSize:"sm",fontWeight:b?"semibold":"normal",children:ie.title})]})},ie.url)})})})]}):x.url?e(Da,{to:x.url,children:e(st,{label:t?x.title:"",placement:"right",hasArrow:!0,children:n(U,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:C?"primary.50":"transparent",color:C?"primary.600":"gray.700",_dark:{bg:C?"primary.900":"transparent",color:C?"primary.200":"gray.300"},_hover:{bg:C?"primary.50":"gray.50",_dark:{bg:C?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(R,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:C?"semibold":"normal",children:x.title})]})})}):null},x.title)})]}),c&&i.username&&e(T,{px:t?2:3,py:2,borderTop:"1px",borderColor:"light-border",_dark:{borderColor:"whiteAlpha.200"},mt:4,children:t?e(st,{label:i.username,placement:"right",hasArrow:!0,children:e(T,{w:"8",h:"8",borderRadius:"full",bg:"primary.100",_dark:{bg:"primary.800"},display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",flexShrink:0,children:e(h,{fontSize:"sm",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},textAlign:"center",children:i.username.charAt(0).toUpperCase()})})}):n(ue,{align:"flex-start",spacing:0,children:[e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:"username:"}),e(h,{fontSize:"sm",fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},noOfLines:1,children:i.username})]})})]})})},Xd=()=>{const[t,s]=d.exports.useState(null);return $r(),d.exports.useEffect(()=>{fetch("https://api.github.com/repos/rebeccapanel/Rebecca").then(l=>l.json()).then(l=>{l.stargazers_count&&s(l.stargazers_count)}).catch(()=>{})},[]),e(T,{as:"button",onClick:()=>{window.open("https://github.com/rebeccapanel/Rebecca","_blank","noopener,noreferrer")},px:3,py:1.5,borderRadius:"md",borderWidth:"1px",borderColor:"gray.300",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},_hover:{bg:"gray.50",borderColor:"gray.400",transform:"translateY(-1px)",boxShadow:"sm",_dark:{bg:"gray.700",borderColor:"gray.500"}},transition:"all 0.2s",cursor:"pointer","aria-label":"GitHub Stars",children:n(U,{spacing:2,align:"center",children:[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"})}),n(U,{spacing:1,px:1.5,py:.5,borderRadius:"full",bg:"gray.100",_dark:{bg:"gray.700"},children:[e(uc,{style:{width:"14px",height:"14px",color:"#fbbf24"}}),t!==null?e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.700",_dark:{color:"gray.200"},lineHeight:"1",children:t>1e3?`${(t/1e3).toFixed(1)}k`:t}):e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},lineHeight:"1",children:"..."})]})]})})},li=hc,Zd="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",hl={base:Zd,folder:"apple/64",ext:".png",className:"apple-emoji"},Ui=t=>{var s,r;return typeof t=="string"&&((r=(s=li.test)==null?void 0:s.call(li,t))!=null?r:!1)},jd=t=>t.some(s=>{var r;return s.type==="characterData"?Ui((r=s.target)==null?void 0:r.data):s.type==="childList"?Array.from(s.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return Ui(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const o=l;return o.tagName==="IMG"&&o.classList.contains(hl.className)?!1:Ui(o.textContent)}return!1}):!1}),eu=()=>{const t=pa();d.exports.useEffect(()=>{const s=document.getElementById("root");if(!s)return;const r=()=>{li.parse(s,hl)};r();const l=new MutationObserver(o=>{jd(o)&&requestAnimationFrame(r)});return l.observe(s,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},pl={baseStyle:{w:4,h:4}},tu=ee(pc,pl),ru=ee(Fo,pl);function nu(){const[t,s]=d.exports.useState(!1),r=Sr({base:!0,md:!1}),l=Gt();return eu(),n(ot,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(Wa,{collapsed:t,onRequestExpand:()=>s(!1)}),n(ot,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[n(T,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(Le,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():s(!t)},icon:e(ru,{})}),n(U,{spacing:2,children:[e(Xd,{}),e(ll,{}),e(ul,{}),e(mc,{to:"/login",children:e(Le,{size:"sm",variant:"outline","aria-label":"logout",icon:e(tu,{})})})]})]}),e(T,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(gc,{})})]}),r&&n(Ho,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(vt,{}),e(Bo,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(Ct,{p:0,children:e(Wa,{collapsed:!1,inDrawer:!0})})})]})]})}const ml="rebecca-num-users-per-page",Fa=10,su=()=>{const t=localStorage.getItem(ml)||Fa.toString();return parseInt(t)||Fa},iu=t=>localStorage.setItem(ml,t),au=60*60*1e3,ou=t=>{const s={};return Object.keys(t).forEach(r=>{const l=t[r];l==null||l===""||(s[r]=l)}),s},lu=t=>JSON.stringify(Object.keys(t).sort().map(s=>[s,t[s]])),cu=(t,s={})=>{const r=ou(t),l=lu(r),{lastUsersFetchAt:o,usersCacheKey:a,users:i}=wt.getState(),c=Date.now();return!s.force&&o&&a===l&&c-o<au?Promise.resolve(i):(wt.setState({loading:!0}),_e("/users",{query:r}).then(u=>{var A,D;const p=(A=u.users_limit)!=null?A:null,m=(D=u.active_total)!=null?D:null,g=p!=null&&p>0&&m!==null?m>=p:!1;return wt.setState({users:u,isUserLimitReached:g,lastUsersFetchAt:Date.now(),usersCacheKey:l}),u}).finally(()=>{wt.setState({loading:!1})}))},Ns=()=>_e("/inbounds").then(t=>{wt.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{wt.setState({loading:!1})}),wt=ns(fc((t,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,lastUsersFetchAt:null,usersCacheKey:null,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:su(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:(r=!1)=>{cu(s().filters,{force:r})},resetAllUsage:()=>_e("/users/reset",{method:"POST"}).then(()=>{s().onResetAllUsage(!1),s().refetchUsers(!0)}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...s().filters,...r}}),s().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),_e(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),s().refetchUsers(!0),ai.invalidateQueries(ci)})),createUser:r=>_e("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),ai.invalidateQueries(ci)}),createUserWithService:r=>_e("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),ai.invalidateQueries(ci)}),editUser:(r,l)=>_e(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{s().onEditingUser(null),s().refetchUsers(!0)}),fetchUserUsage:(r,l)=>{for(const o in l)l[o]||delete l[o];return _e(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>_e(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),s().refetchUsers(!0)}),revokeSubscription:r=>_e(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),s().refetchUsers(!0)}),onEditingCore:r=>t({isEditingCore:r})})));function je(t,s=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,o=s<0?0:s,a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(t)/Math.log(l)),c=parseFloat((t/Math.pow(l,i)).toFixed(o));return r?[c,a[i]]:`${c} ${a[i]}`}const Ha=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},du=ee(Mo,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),uu=ee(bc,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Ba=({title:t,content:s,icon:r})=>n(en,{p:6,borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[n(U,{alignItems:"center",columnGap:"4",children:[e(T,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:r}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(T,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:s})]}),ci="statistics-query-key",hu=t=>{var a;const{version:s}=wt(),{userData:r}=Un(),{data:l}=Tr({queryKey:ci,queryFn:()=>_e("/system"),refetchInterval:6e5,onSuccess:({version:i})=>{s!==i&&wt.setState({version:i})}}),{t:o}=Je();return n(U,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(Ba,{title:o("activeUsers"),content:l&&n(U,{alignItems:"flex-end",children:[e(h,{children:Ha(l.users_active)}),n(h,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Ha(l.total_user)]})]}),icon:e(du,{})}),e(Ba,{title:o("UsersUsage"),content:je((a=r.users_usage)!=null?a:0),icon:e(uu,{})})]})},pu=()=>{const{t}=Je();return e(ue,{spacing:6,align:"stretch",children:n(T,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(hu,{})]})})},En=({children:t,color:s})=>e(T,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(h,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:t})}),Bs=ee(tn,{baseStyle:{w:5,h:5}}),mu=()=>{const[t,s]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:o}=wt(),{t:a}=Je(),i=Ht(),c=()=>{l(null)},u=()=>{r&&(s(!0),o(r).then(()=>{i({title:a("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(s.bind(null,!1)))};return n(Rt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"red",children:e(Bs,{})})}),e(zt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:a("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:a("deleteUser.prompt",{username:r.username})})})]}),n(Nt,{display:"flex",children:[e(K,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(K,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(Dt,{size:"xs"}):void 0,children:a("delete")})]})]})]})},gu={search:"",limit:10,offset:0,sort:"username"},hn=ns((t,s)=>({admins:[],total:0,loading:!1,filters:gu,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=s(),o={...l,...r},a={};o.search&&(a.username=o.search),o.offset!==void 0&&(a.offset=o.offset),o.limit!==void 0&&(a.limit=o.limit),o.sort&&(o.sort==="data_usage"?a.sort="users_usage":o.sort==="data_limit"?a.sort="data_limit":a.sort=o.sort),t({loading:!0});try{const i=await _e("/admins",{query:a}),{admins:c,total:u}=Array.isArray(i)?{admins:i,total:i.length}:{admins:i.admins||[],total:i.total||0};t(p=>{const m=p.adminInDetails?c.find(g=>{var A;return g.username===((A=p.adminInDetails)==null?void 0:A.username)})||p.adminInDetails:null;return{admins:c,total:u,adminInDetails:m}})}catch(i){console.error("Failed to fetch admins:",i),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),s().fetchAdmins()},async createAdmin(r){await _e("/admin",{method:"POST",body:r}),await s().fetchAdmins()},async updateAdmin(r,l){await _e(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await s().fetchAdmins()},async deleteAdmin(r){await _e(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await s().fetchAdmins()},async resetUsage(r){await _e(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await s().fetchAdmins()},async disableUsers(r){await _e(`/admin/${encodeURIComponent(r)}/users/disable`,{method:"POST"})},async activateUsers(r){await _e(`/admin/${encodeURIComponent(r)}/users/activate`,{method:"POST"})},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),wi={baseStyle:{w:4,h:4}},fu=ee(Vo,wi),bu=ee(la,wi),yu=ee(Vr,wi),Su=ee(dn,wi),xu=yc((t,s)=>{s==="users"?wt.getState().onFilterChange({...wt.getState().filters,offset:0,search:t}):hn.getState().onFilterChange({search:t,offset:0})},300),gl=({for:t="users",...s})=>{var I;const{loading:r,filters:l,onFilterChange:o,refetchUsers:a,onCreateUser:i}=wt(),{loading:c,filters:u,onFilterChange:p,fetchAdmins:m,openAdminDialog:g}=hn(),{t:A}=Je(),[D,k]=d.exports.useState(""),x=t==="users"?r:c,v=t==="users"?l:u,C=W=>{k(W.target.value),xu(W.target.value,t)},R=()=>{k(""),t==="users"?o({...v,offset:0,search:""}):p({search:"",offset:0})},ie=()=>{t==="users"?a(!0):m()},b=()=>{t==="users"?i(!0):g()},M=(I=Sr({base:!0,sm:!1}))!=null?I:!1;return n(ma,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...s,children:[e(Dn,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:n(U,{spacing:2,align:"center",w:"full",children:[n(xr,{flex:"1",children:[e($o,{pointerEvents:"none",children:e(fu,{})}),e(xe,{placeholder:t==="users"?A("search"):A("admins.searchPlaceholder","Search admins..."),value:D,borderColor:"light-border",w:"full",onChange:C}),n(Pr,{children:[x&&e(Dt,{size:"xs"}),v.search&&v.search.length>0&&e(Le,{onClick:R,"aria-label":"clear",size:"xs",variant:"ghost",children:e(bu,{})})]})]}),e(Le,{"aria-label":"refresh",disabled:x,onClick:ie,size:M?"sm":"md",variant:M?"ghost":"outline",borderRadius:"full",minW:M?"36px":"40px",h:M?"36px":void 0,children:e(yu,{className:ca({"animate-spin":x})})})]})}),e(Dn,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(ke,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:e(K,{colorScheme:"primary",size:M?"sm":"md",onClick:b,px:M?3:5,leftIcon:M?void 0:e(Su,{}),w:"auto",h:M?"36px":void 0,minW:M?"auto":"8.5rem",fontSize:M?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?A("createUser"):A("admins.addAdmin","Add admin")})})})]})},ku=ee(Sc,{baseStyle:{w:4,h:4}}),wu=ee(xc,{baseStyle:{w:4,h:4}}),Va=5;function vu(t,s,r){if(r<Va)throw new Error(`Must allow at least ${Va} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,s-Math.floor(r/2))),o=new Array(r);for(let a=0;a<r;a+=1)o[a]=a+l;return typeof o[0]=="number"&&o[0]>0&&(o[0]=0,o[1]="prev-more"),o[o.length-1]<t-1&&(o[o.length-1]=t-1,o[o.length-2]="next-more"),o}const fl=({for:t="users"})=>{const{filters:s,onFilterChange:r,users:{total:l}}=wt(),{filters:o,onFilterChange:a,total:i}=hn(),{t:c}=Je(),{filters:u,total:p,onFilterChange:m}=d.exports.useMemo(()=>t==="admins"?{filters:o,total:i,onFilterChange:a}:{filters:s,total:l,onFilterChange:r},[t,o,i,a,s,l,r]),{limit:g,offset:A}=u,D=Number(g||10),k=Number(A||0),x=Math.floor(k/D),v=Math.ceil(p/D),C=vu(v,x,7),R=I=>{m({...u,offset:I*D})},ie=I=>{const W=parseInt(I.target.value,10);m({...u,limit:W,offset:0}),t==="users"&&iu(I.target.value)},b=d.exports.useMemo(()=>x>0&&v>0,[x,v]),M=d.exports.useMemo(()=>x+1<v&&v>0,[x,v]);return p<=D&&x===0?null:n(U,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(T,{order:{base:2,md:1},children:n(U,{children:[n(tt,{minW:"60px",value:String(D),onChange:ie,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),n(Ko,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(K,{leftIcon:e(ku,{}),onClick:()=>R(x-1),isDisabled:!b,children:c("previous")}),C.map(I=>typeof I=="string"?e(K,{children:"..."},I):e(K,{variant:I===x?"solid":"outline",onClick:()=>R(I),children:I+1},I)),e(K,{rightIcon:e(wu,{}),onClick:()=>R(x+1),isDisabled:!M,children:c("next")})]})]})},Cu=kc;const $a=ee(wc),_u=ee(Jo,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Du=ee(vc,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Au=ee(qo,{baseStyle:{w:5,h:5}}),Iu=()=>{const{QRcodeLinks:t,setQRCode:s,setSubLink:r,subscribeUrl:l}=wt(),o=t!==null,[a,i]=d.exports.useState(0),{t:c}=Je(),u=()=>{s(null),r(null)},p=String(l).startsWith("/")?window.location.origin+l:String(l);return n(Rt,{isOpen:o,onClose:u,children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(At,{pt:6,children:e(En,{color:"primary",children:e(Au,{color:"white"})})}),e(zt,{mt:3}),t&&n(Ct,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&n(ue,{children:[e($a,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),n(T,{w:"300px",children:[e(Cu,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:i,onInit:()=>i(0),nextArrow:e(Le,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(_u,{})}),prevArrow:e(Le,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(Du,{})}),children:t.map((m,g)=>e(U,{children:e($a,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"})},g))}),n(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[a+1," / ",t.length]})]})]})]})]})},Pu=ee(Vr,{baseStyle:{w:5,h:5}}),Tu=()=>{const[t,s]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=wt(),{t:o}=Je(),a=Ht(),i=()=>{wt.setState({resetUsageUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{a({title:o("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:o("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Rt,{isCentered:!0,isOpen:!!r,onClose:i,size:"sm",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"blue",children:e(Pu,{})})}),e(zt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:o("resetUserUsage.prompt",{username:r.username})})})]}),n(Nt,{display:"flex",children:[e(K,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(K,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Dt,{size:"xs"}):void 0,children:o("reset")})]})]})]})},Eu=ee(Vr,{baseStyle:{w:5,h:5}}),Nu=()=>{const[t,s]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=wt(),{t:o}=Je(),a=Ht(),i=()=>{wt.setState({revokeSubscriptionUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{a({title:o("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{a({title:o("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Rt,{isCentered:!0,isOpen:!!r,onClose:i,size:"sm",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"blue",children:e(Eu,{})})}),e(zt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:o("revokeUserSub.prompt",{username:r.username})})})]}),n(Nt,{display:"flex",children:[e(K,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(K,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Dt,{size:"xs"}):void 0,children:o("revoke")})]})]})]})},Vs={baseStyle:{strokeWidth:"2px",w:4,h:4}},Ka=ee(Cc,Vs),zu=ee(_c,Vs),Ja=ee(Dc,Vs),qa=ee(Yo,Vs),Ru=ee(Yo,Vs),ji=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],An={active:{statusColor:"green",bandWidthColor:"primary",icon:Ka},connected:{statusColor:"green",bandWidthColor:"primary",icon:Ka},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:zu},expired:{statusColor:"orange",bandWidthColor:"orange",icon:qa},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Ru},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:qa},limited:{statusColor:"red",bandWidthColor:"red",icon:Ja},error:{statusColor:"red",bandWidthColor:"red",icon:Ja}},Gn=ns((t,s)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await _e("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await _e(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await _e("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const o=await _e(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:o}),await s().fetchServices(),o}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await _e(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await s().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await _e(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),Uu=async()=>_e("/settings/telegram"),Lu=async t=>_e("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),ba=async()=>_e("/settings/panel"),Mu=async t=>_e("/settings/panel",{method:"PUT",body:JSON.stringify(t)}),vi=t=>{let s={status:"",time:""};if(t){$e(t*1e3).utc().isAfter($e().utc())?s.status="expires":s.status="expired";const r=[],l=$e.duration($e(t*1e3).utc().diff($e()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),s.time=r.join(", ")}return s},$s=d.exports.forwardRef((t,s)=>e(Ac,{...t,ref:s}));$s.displayName="DatePicker";function Ou(t){const s=360/t,r=90,l=47,o=[];for(let a=0;a<t;a++){const i=a*s%360+140,c=Wu(i,r,l);o.push(c)}return o}function Wu(t,s,r){t/=360,s/=100,r/=100;let l,o,a;if(s===0)l=o=a=r;else{const c=(m,g,A)=>(A<0&&(A+=1),A>1&&(A-=1),A<.16666666666666666?m+(g-m)*6*A:A<.5?g:A<.6666666666666666?m+(g-m)*(.6666666666666666-A)*6:m),u=r<.5?r*(1+s):r+s-r*s,p=2*r-u;l=Math.round(c(p,u,t+1/3)*255),o=Math.round(c(p,u,t)*255),a=Math.round(c(p,u,t-1/3)*255)}const i=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${i(l)}${i(o)}${i(a)}`}const Ya=({border:t,...s})=>{const{getInputProps:r,getRadioProps:l}=Tc(s),o=Sr({base:"xs",md:"sm"});return n(T,{as:"label",children:[e("input",{...r()}),e(T,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:o,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},Fu=({onChange:t,defaultValue:s,...r})=>{const{t:l,i18n:o}=Je();$r();const a=Sr({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),i={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=Sr({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:p,setValue:m}=Ic({name:"filter",defaultValue:s,onChange:j=>{if(j==="custom")return;D(),a.indexOf(j)>=0?(v(l("userDialog.custom")),R(!1)):(v(l("userDialog.custom")+` (${j})`),R(!0));const pe=Number(j.substring(0,j.length-1)),Y=i[j[j.length-1]];t(j,{start:$e().utc().subtract(pe,Y).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:g,onOpen:A,onClose:D}=Gt(),k=d.exports.useRef(null);Pc({ref:k,handler:D});const[x,v]=d.exports.useState(l("userDialog.custom")),[C,R]=d.exports.useState(!1),[ie,b]=d.exports.useState(0),M=Sr({base:1,md:2}),I=Sr({base:"xs",md:"sm"}),[W,ve]=d.exports.useState(null),[Z,te]=d.exports.useState(null),z=j=>{const[pe,Y]=j;Z&&!Y?(ve(null),te(null)):(ve(pe),te(Y),pe&&Y&&(D(),t("custom",{start:$e(pe).format("YYYY-MM-DDT00:00:00"),end:$e(Y).format("YYYY-MM-DDT23:59:59")})))};return n(ue,{...r,children:[ie==0&&n(Ke,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[a.map(j=>e(Ya,{...p({value:j}),children:j},j)),e(T,{onClick:()=>{ve(null),te(null),A()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:I,px:3,py:1,bg:C?"primary.500":"unset",color:C?"white":"unset",borderColor:C?"primary.500":"unset",children:n(U,{children:[e(h,{children:x}),e(As,{as:Aa,boxSize:"18px"})]})})]}),ie==1&&n(U,{onClick:A,cursor:"pointer",fontSize:I,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:W?"unset":"gray.500",children:W?$e(W).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(As,{as:Jo,boxSize:"18px"}),e(h,{w:"full",color:Z?"unset":"gray.500",children:Z?$e(Z).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(As,{as:Aa,boxSize:"18px"})]}),e(ue,{ref:k,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:n(ss,{onChange:j=>b(j),children:[n(is,{children:[e(Bt,{fontSize:I,children:l("userDialog.relative")}),e(Bt,{fontSize:I,children:l("userDialog.absolute")})]}),n(as,{children:[e(Vt,{children:c.map(j=>e(ue,{alignItems:"start",pl:2,pr:2,children:n(U,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:I,minW:"60px",children:l("userDialog."+j.title)}),j.options.map(pe=>e(Ya,{border:!0,...p({value:pe}),children:pe},pe+".custom"))]})},j.title))}),e(Vt,{className:"datepicker-panel",children:e(ue,{children:e($s,{locale:o.language.toLocaleLowerCase(),selected:W,onChange:z,startDate:W,endDate:Z,selectsRange:!0,maxDate:new Date,monthsShown:M,peekNextMonth:!1,inline:!0})})})]})]})})]})};function fi(t,s,r=[],l=[]){const o=je(r.reduce((a,i)=>a+=i,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${o}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(a,{seriesIndex:i,w:c})=>je(c.config.series[i],1)},tooltip:{custom:({series:a,seriesIndex:i,dataPointIndex:c,w:u})=>{const p=je(a[i],1),m=Math.max(a.reduce((A,D)=>A+=D),1),g=Math.round(a[i]/m*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[i]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[i]}: <b>${g}, ${p}</b>
            </div>
          `}},colors:Ou(r.length)}}}const Hu=ee(Ec,{baseStyle:{w:5,h:5}}),Bu=ee(yn,{baseStyle:{w:5,h:5}}),Vu=ee(Wo,{baseStyle:{w:5,h:5}}),$u=ee(Nc,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});ee(yi,{baseStyle:{w:4,h:4}});const Ku=t=>{var r,l,o,a,i;const s=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(s),next_plan_data_limit:s!=null&&s.data_limit?Number((s.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(o=s==null?void 0:s.expire)!=null?o:null,next_plan_add_remaining_traffic:(a=s==null?void 0:s.add_remaining_traffic)!=null?a:!1,next_plan_fire_on_either:(i=s==null?void 0:s.fire_on_either)!=null?i:!0}},Li=()=>({data_limit:null,ip_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),ps={username:Pe.string().min(1,{message:"Required"}),note:Pe.string().nullable(),service_id:Pe.union([Pe.string(),Pe.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),proxies:Pe.record(Pe.string(),Pe.record(Pe.string(),Pe.any())).transform(t=>{const s=(r,l)=>{r&&r[l]===""&&delete r[l]};return s(t.vmess,"id"),s(t.vless,"id"),s(t.trojan,"password"),s(t.shadowsocks,"password"),s(t.shadowsocks,"method"),t}),data_limit:Pe.string().min(0).or(Pe.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:Pe.number().nullable(),data_limit_reset_strategy:Pe.string(),inbounds:Pe.record(Pe.string(),Pe.array(Pe.string())).transform(t=>(Object.keys(t).forEach(s=>{var r;Array.isArray(t[s])&&!((r=t[s])!=null&&r.length)&&delete t[s]}),t)),next_plan_enabled:Pe.boolean().default(!1),next_plan_data_limit:Pe.union([Pe.string(),Pe.number(),Pe.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:Math.max(0,s)}),next_plan_expire:Pe.union([Pe.number(),Pe.string(),Pe.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),next_plan_add_remaining_traffic:Pe.boolean().default(!1),next_plan_fire_on_either:Pe.boolean().default(!0),ip_limit:Pe.union([Pe.number().min(0),Pe.null()]).optional().transform(t=>typeof t!="number"?null:Number.isFinite(t)?t:null)},Ju=Pe.discriminatedUnion("status",[Pe.object({status:Pe.literal("active"),...ps}),Pe.object({status:Pe.literal("disabled"),...ps}),Pe.object({status:Pe.literal("limited"),...ps}),Pe.object({status:Pe.literal("expired"),...ps}),Pe.object({status:Pe.literal("on_hold"),on_hold_expire_duration:Pe.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...ps})]),qu=()=>{var nr,Qt,sr,ir,Xt,ar,J,be,G;const{editingUser:t,isCreatingNewUser:s,onCreateUser:r,editUser:l,fetchUserUsage:o,onEditingUser:a,createUserWithService:i,onDeletingUser:c,users:u,isUserLimitReached:p}=wt(),m=!!t,g=s||m,A=(nr=u.users_limit)!=null?nr:null,D=(Qt=u.active_total)!=null?Qt:null,k=p&&!m,[x,v]=d.exports.useState(!1),[C,R]=d.exports.useState(""),ie=Ht(),{t:b}=Je(),{colorMode:M}=$r(),I=Mr({defaultValues:Li(),resolver:Si(Ju)}),W=I.getValues("expire"),ve=I.getValues("next_plan_expire");function Z(N){if(typeof N!="number"||N<=0)return null;const we=$e.unix(N).utc().local(),Ee=$e(),Fe=we.diff(Ee,"day",!0);return Number.isFinite(Fe)?Math.max(0,Math.round(Fe)):null}function te(N){return $e().add(N,"day").endOf("day").utc().unix()}const[z,j]=d.exports.useState(()=>Z(W)),[pe,Y]=d.exports.useState(()=>Z(ve)),Q=Gn(N=>N.services),P=Gn(N=>N.isLoading),{userData:me,getUserIsSuccess:Ie}=Un(),De=Boolean(Ie&&me.is_sudo),[L,y]=d.exports.useState(null),E=Q.length>0,ae=L&&(sr=Q.find(N=>N.id===L))!=null?sr:null,re=Boolean(t==null?void 0:t.service_id),Ce=!De&&Q.length===1,Te=De||Q.length!==1,Re=Te&&Q.length>0,Me=!Re,H=!De&&Q.length===0,{data:B}=Tr("panel-settings",ba,{enabled:g,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),O=Boolean(B==null?void 0:B.use_nobetci),[de,ze]=d.exports.useState(!1),it=()=>{ze(N=>!N)};d.exports.useEffect(()=>{g&&Gn.getState().fetchServices()},[g]),d.exports.useEffect(()=>{var N,we;m?t!=null&&t.service_id?y(t.service_id):De?y(null):Q.length?y((we=(N=Q[0])==null?void 0:N.id)!=null?we:null):y(null):g||y(null)},[m,t,g,De,Q]),d.exports.useEffect(()=>{!m&&g&&E&&y(N=>{var we,Ee;return(Ee=N!=null?N:(we=Q[0])==null?void 0:we.id)!=null?Ee:null})},[Q,m,g,E]),d.exports.useEffect(()=>{!m&&g&&!E&&y(null)},[E,m,g]),d.exports.useEffect(()=>{Ce&&Q[0]&&y(N=>N!=null?N:Q[0].id)},[Ce,Q]);const[he,ce]=Ft({control:I.control,name:["data_limit","status"]}),oe=Ft({control:I.control,name:"next_plan_enabled"}),V=Ft({control:I.control,name:"expire"}),ye=Ft({control:I.control,name:"next_plan_data_limit"}),ht=Ft({control:I.control,name:"next_plan_expire"}),ft=Ft({control:I.control,name:"next_plan_add_remaining_traffic"}),q=Ft({control:I.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const N=Z(V);j(we=>we===N?we:N)},[V]),d.exports.useEffect(()=>{const N=Z(ht);Y(we=>we===N?we:N)},[ht]);const F=N=>{I.setValue("next_plan_enabled",N,{shouldDirty:!0}),N?(I.getValues("next_plan_data_limit")===null&&I.setValue("next_plan_data_limit",0,{shouldDirty:!1}),I.getValues("next_plan_add_remaining_traffic")===void 0&&I.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),I.getValues("next_plan_fire_on_either")===void 0&&I.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(I.setValue("next_plan_data_limit",null,{shouldDirty:!0}),I.setValue("next_plan_expire",null,{shouldDirty:!0}),Y(null))},Se=b("userDialog.total"),[Ue,We]=d.exports.useState(fi(M,Se)),[Be,le]=d.exports.useState("1m"),ge=N=>{o(t,N).then(we=>{const Ee=[],Fe=[];for(const Xe in we.usages)Fe.push(we.usages[Xe].used_traffic),Ee.push(we.usages[Xe].node_name);We(fi(M,Se,Fe,Ee))})};d.exports.useEffect(()=>{if(t){const N=Ku(t);I.reset(N),j(Z(N.expire)),Y(Z(N.next_plan_expire)),ge({start:$e().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const N=Li();I.reset(N),j(Z(N.expire)),Y(Z(N.next_plan_expire))}},[t,m,g]);const Oe=N=>{var zr,nn;if(k)return;v(!0),R(null);const{service_id:we,next_plan_enabled:Ee,next_plan_data_limit:Fe,next_plan_expire:Xe,next_plan_add_remaining_traffic:bt,next_plan_fire_on_either:ct,proxies:Pt,inbounds:Mt,status:Zt,data_limit:jt,data_limit_reset_strategy:Er,on_hold_expire_duration:Ve,ip_limit:St,...Nr}=N,Or=Ee&&Fe&&Fe>0?Number((Number(Fe)*1073741824).toFixed(5)):0,hr=Ee?{data_limit:Or,expire:Xe!=null?Xe:0,add_remaining_traffic:bt,fire_on_either:ct}:null,or=typeof St=="number"&&Number.isFinite(St)&&St>0?Math.floor(St):0;if(!m){const Tt=L!=null?L:Ce&&(nn=(zr=Q[0])==null?void 0:zr.id)!=null?nn:null;if(!Tt){R(b("userDialog.selectService","Please choose a service")),v(!1);return}const kr={username:N.username,service_id:Tt,note:N.note,status:N.status==="active"||N.status==="disabled"||N.status==="on_hold"?N.status:"active",expire:N.expire,data_limit:N.data_limit,ip_limit:or,data_limit_reset_strategy:jt&&jt>0?Er:"no_reset",on_hold_expire_duration:Zt==="on_hold"?Ve:null};hr&&(kr.next_plan=hr),i(kr).then(()=>{ie({title:b("userDialog.userCreated",{username:N.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Ae()}).catch(xt=>{var pr,wr,Rr,fe,Kr;(((pr=xt==null?void 0:xt.response)==null?void 0:pr.status)===409||((wr=xt==null?void 0:xt.response)==null?void 0:wr.status)===400)&&R((fe=(Rr=xt==null?void 0:xt.response)==null?void 0:Rr._data)==null?void 0:fe.detail),((Kr=xt==null?void 0:xt.response)==null?void 0:Kr.status)===422&&Object.keys(xt.response._data.detail).forEach(er=>{R(xt==null?void 0:xt.response._data.detail[er]),I.setError(er,{type:"custom",message:xt.response._data.detail[er]})})}).finally(()=>{v(!1)});return}const Kt={...Nr,data_limit:jt,ip_limit:or,data_limit_reset_strategy:jt&&jt>0?Er:"no_reset",status:Zt==="active"||Zt==="disabled"||Zt==="on_hold"?Zt:"active",on_hold_expire_duration:Zt==="on_hold"?Ve:null};hr?Kt.next_plan=hr:!Ee&&(t==null?void 0:t.next_plan)&&(Kt.next_plan=null),t!=null&&t.service_id||(Pt&&Object.keys(Pt).length>0&&(Kt.proxies=Pt),Mt&&Object.keys(Mt).length>0&&(Kt.inbounds=Mt)),typeof L<"u"&&(L===null?De&&(Kt.service_id=null):L!==(t==null?void 0:t.service_id)&&(Kt.service_id=L)),l(t.username,Kt).then(()=>{ie({title:b("userDialog.userEdited",{username:N.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Ae()}).catch(Tt=>{var kr,xt,pr,wr,Rr;(((kr=Tt==null?void 0:Tt.response)==null?void 0:kr.status)===409||((xt=Tt==null?void 0:Tt.response)==null?void 0:xt.status)===400)&&R((wr=(pr=Tt==null?void 0:Tt.response)==null?void 0:pr._data)==null?void 0:wr.detail),((Rr=Tt==null?void 0:Tt.response)==null?void 0:Rr.status)===422&&Object.keys(Tt.response._data.detail).forEach(fe=>{R(Tt==null?void 0:Tt.response._data.detail[fe]),I.setError(fe,{type:"custom",message:Tt.response._data.detail[fe]})})}).finally(()=>{v(!1)})},Ae=()=>{I.reset(Li()),j(null),Y(null),r(!1),a(null),R(null),ze(!1),le("1m"),y(null)},lt=()=>{wt.setState({resetUsageUser:t})},pt=()=>{wt.setState({revokeSubscriptionUser:t})},Ge=x||k,$t=ce==="on_hold",[dr,rr]=d.exports.useState(!1),ur=()=>{rr(!0);let N="";const we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ee=we.length;let Fe=0;for(;Fe<6;)N+=we.charAt(Math.floor(Math.random()*Ee)),Fe+=1;return N};return n(Rt,{isOpen:g,onClose:Ae,size:H?"lg":"2xl",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(zc,{...I,children:n(Ut,{mx:"3",position:"relative",overflow:"hidden",children:[e(zt,{mt:3,disabled:x}),e(T,{pointerEvents:k?"none":"auto",filter:k?"blur(6px)":"none",transition:"filter 0.2s ease",children:n("form",{onSubmit:I.handleSubmit(Oe),children:[e(At,{pt:6,children:n(U,{gap:2,children:[e(En,{color:"primary",children:m?e(Bu,{color:"white"}):e(Hu,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:b(m?"userDialog.editUserTitle":"createNewUser")})]})}),n(Ct,{children:[m&&re&&n(Dr,{status:"info",mb:4,borderRadius:"md",children:[e(Ar,{}),b("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(ir=t==null?void 0:t.service_name)!=null?ir:""})]}),n(ma,{templateColumns:{base:"repeat(1, 1fr)",md:Re?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...Me?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(Dn,{children:n(ue,{justifyContent:"space-between",children:[n(ot,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(ot,{flexDirection:"row",w:"full",gap:2,children:n(w,{mb:"10px",isInvalid:!!((Xt=I.formState.errors.username)!=null&&Xt.message),children:[e(_,{children:b("username")}),n(U,{align:"flex-end",children:[e(T,{flex:"1",minW:"0",children:n(xr,{size:"sm",children:[e(xe,{type:"text",borderRadius:"6px",placeholder:b("username"),isDisabled:Ge||m,...I.register("username")}),!m&&e(Pr,{width:"auto",pr:1,children:e(Le,{"aria-label":b("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(pi,{width:18}),onClick:()=>{const N=ur();I.setValue("username",N,{shouldDirty:!0}),setTimeout(()=>{rr(!1)},350)},isLoading:dr,isDisabled:Ge})})]})}),m&&e(U,{px:1,children:e(ut,{name:"status",control:I.control,render:({field:N})=>e(st,{placement:"top",label:"status: "+b(`status.${N.value}`),textTransform:"capitalize",children:e(T,{children:e(dt,{colorScheme:"primary",isChecked:N.value==="active",onChange:we=>{we.target.checked?N.onChange("active"):N.onChange("disabled")}})})})})})]}),e(Qr,{children:(ar=I.formState.errors.username)==null?void 0:ar.message})]})}),n(ke,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[n(w,{flex:"1",children:[e(_,{children:b("userDialog.dataLimit")}),e(ut,{control:I.control,name:"data_limit",render:({field:N})=>{var we;return e(Yt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:N.onChange,disabled:Ge,error:(we=I.formState.errors.data_limit)==null?void 0:we.message,value:N.value?String(N.value):""})}})]}),O&&n(w,{flex:"1",children:[n(_,{display:"flex",alignItems:"center",gap:2,children:[b("userDialog.ipLimitLabel","IP limit"),e(st,{hasArrow:!0,placement:"top",label:b("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(ee.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(Go,{width:16,height:16})})})]}),e(ut,{control:I.control,name:"ip_limit",rules:{validate:N=>N==null?!0:typeof N!="number"||Number.isNaN(N)?b("userDialog.ipLimitValidation","Enter a valid non-negative number"):N>=0?!0:b("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:N})=>{var we;return e(Yt,{size:"sm",borderRadius:"6px",placeholder:b("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof N.value=="number"&&N.value>0?String(N.value):"",onChange:Ee=>{const Fe=Ee.target.value;if(!Fe.trim()||Fe.trim()==="-"){N.onChange(null);return}const Xe=Number(Fe);Number.isNaN(Xe)||N.onChange(Xe<0?0:Math.floor(Xe))},disabled:Ge,error:(we=I.formState.errors.ip_limit)==null?void 0:we.message})}})]})]}),e(Xn,{in:!!(he&&he>0),animateOpacity:!0,style:{width:"100%"},children:n(w,{height:"66px",children:[e(_,{children:b("userDialog.periodicUsageReset")}),e(ut,{control:I.control,name:"data_limit_reset_strategy",render:({field:N})=>e(tt,{size:"sm",...N,disabled:Ge,bg:Ge?"gray.100":"transparent",_dark:{bg:Ge?"gray.600":"transparent"},sx:{option:{backgroundColor:M==="dark"?"#222C3B":"white"}},children:ji.map(we=>e("option",{value:we.value,children:b("userDialog.resetStrategy"+we.title)},we.value))})})]})}),n(w,{mb:"10px",isInvalid:!$t&&Boolean(I.formState.errors.expire),children:[n(ot,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(_,{mb:0,children:$t?b("userDialog.onHoldExpireDuration"):b("userDialog.expiryDaysLabel","Expires in (days)")}),!m&&e(ut,{name:"status",control:I.control,render:({field:N})=>{const we=N.value==="on_hold";return n(U,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.onHold")}),e(dt,{colorScheme:"primary",isChecked:we,onChange:Ee=>{Ee.target.checked?N.onChange("on_hold"):(N.onChange("active"),I.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:Ge})]})}})]}),$t?e(ut,{control:I.control,name:"on_hold_expire_duration",render:({field:N})=>{var we;return e(Yt,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Ee=>{I.setValue("expire",null);const Fe=Ee.target.value;if(!Fe){N.onChange(null);return}const Xe=Number(Fe);Number.isNaN(Xe)||Xe<0||N.onChange(Math.round(Xe))},disabled:Ge,error:(we=I.formState.errors.on_hold_expire_duration)==null?void 0:we.message,value:N.value?String(N.value):""})}}):n(Lt,{children:[e(ut,{name:"expire",control:I.control,render:({field:N})=>{var Xe;const{status:we,time:Ee}=vi(N.value),Fe=bt=>{if(!bt){j(null),N.onChange(null);return}const ct=Number(bt);if(Number.isNaN(ct)||ct<0)return;const Pt=Math.min(Math.round(ct),3650);j(Pt),I.setValue("on_hold_expire_duration",null,{shouldDirty:!1});const Mt=te(Pt);N.onChange(Mt)};return n(T,{flex:"1",minW:"180px",children:[e(Yt,{endAdornment:b("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof z=="number"?String(z):"",onChange:bt=>Fe(bt.target.value),disabled:Ge,error:(Xe=I.formState.errors.expire)==null?void 0:Xe.message}),N.value?e(Lr,{children:b(we,{time:Ee})}):null]})}}),e(Qr,{children:(J=I.formState.errors.expire)==null?void 0:J.message})]})]}),n(T,{mb:"10px",children:[n(U,{justify:"space-between",align:"center",children:[e(_,{mb:0,children:b("userDialog.nextPlanTitle","Next plan")}),e(dt,{colorScheme:"primary",isChecked:oe,onChange:N=>F(N.target.checked),isDisabled:Ge})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:b("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(Xn,{in:oe,animateOpacity:!0,style:{width:"100%"},children:n(ue,{align:"stretch",spacing:3,mt:3,children:[n(w,{children:[e(_,{fontSize:"sm",children:b("userDialog.nextPlanDataLimit","Next plan data limit")}),e(Yt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",disabled:Ge,value:ye!==null&&typeof ye<"u"?String(ye):"",onChange:N=>{const we=N.target.value;if(!we){I.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Ee=Number(we);Number.isNaN(Ee)||I.setValue("next_plan_data_limit",Math.max(0,Ee),{shouldDirty:!0})}})]}),n(w,{children:[e(_,{fontSize:"sm",children:b("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(ut,{control:I.control,name:"next_plan_expire",render:({field:N})=>{const we=Ee=>{if(!Ee){Y(null),N.onChange(null);return}const Fe=Number(Ee);if(Number.isNaN(Fe)||Fe<0)return;const Xe=Math.min(Math.round(Fe),3650);Y(Xe);const bt=te(Xe);N.onChange(bt)};return e(Yt,{endAdornment:b("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof pe=="number"?String(pe):"",onChange:Ee=>we(Ee.target.value),disabled:Ge})}})]}),n(U,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(dt,{size:"sm",colorScheme:"primary",isChecked:Boolean(ft),onChange:N=>I.setValue("next_plan_add_remaining_traffic",N.target.checked,{shouldDirty:!0}),isDisabled:Ge})]}),n(U,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(dt,{size:"sm",colorScheme:"primary",isChecked:Boolean(q),onChange:N=>I.setValue("next_plan_fire_on_either",N.target.checked,{shouldDirty:!0}),isDisabled:Ge})]})]})})]}),n(w,{mb:"10px",isInvalid:!!I.formState.errors.note,children:[e(_,{children:b("userDialog.note")}),e(_r,{...I.register("note")}),e(Qr,{children:(G=(be=I.formState.errors)==null?void 0:be.note)==null?void 0:G.message})]})]}),C&&n(Dr,{status:"error",display:{base:"none",md:"flex"},children:[e(Ar,{}),C]})]})}),Te&&e(Dn,{mt:Re?0:4,children:n(w,{isRequired:!m,children:[e(_,{children:b("userDialog.selectServiceLabel","Service")}),P?n(U,{spacing:2,py:4,children:[e(Dt,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:b("loading")})]}):E?n(ue,{align:"stretch",spacing:3,children:[m&&De&&n(T,{role:"button",tabIndex:Ge?-1:0,"aria-pressed":L===null,onKeyDown:N=>{Ge||(N.key==="Enter"||N.key===" ")&&(N.preventDefault(),y(null))},onClick:()=>{Ge||y(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:L===null?"primary.500":"gray.200",bg:L===null?"primary.50":"transparent",cursor:Ge?"not-allowed":"pointer",pointerEvents:Ge?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ge?{}:{borderColor:L===null?"primary.500":"gray.300"},_dark:{borderColor:L===null?"primary.400":"gray.700",bg:L===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:b("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:b("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),Q.map(N=>{const we=L===N.id;return e(T,{role:"button",tabIndex:Ge?-1:0,"aria-pressed":we,onKeyDown:Ee=>{Ge||(Ee.key==="Enter"||Ee.key===" ")&&(Ee.preventDefault(),y(N.id))},onClick:()=>{Ge||y(N.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:we?"primary.500":"gray.200",bg:we?"primary.50":"transparent",cursor:Ge?"not-allowed":"pointer",pointerEvents:Ge?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:Ge?{}:{borderColor:we?"primary.500":"gray.300"},_dark:{borderColor:we?"primary.400":"gray.700",bg:we?"primary.900":"transparent"},children:n(U,{justify:"space-between",align:"flex-start",children:[n(ue,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:N.name}),N.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:N.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:b("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:N.host_count,users:N.user_count})})]})},N.id)})]}):n(Dr,{status:"warning",borderRadius:"md",children:[e(Ar,{}),b("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),ae&&e(Lr,{mt:2,children:b("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:ae.host_count,users:ae.user_count})})]})}),m&&de&&e(Dn,{pt:6,colSpan:{base:1,md:Te?2:1},children:n(ue,{gap:4,children:[e(Fu,{defaultValue:Be,onChange:(N,we)=>{le(N),ge(we)}}),e(T,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(jr,{options:Ue.options,series:Ue.series,type:"donut"})})]})})]}),C&&n(Dr,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(Ar,{}),C]})]}),e(Nt,{mt:"3",children:n(U,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(U,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:m&&n(Lt,{children:[e(st,{label:b("delete"),placement:"top",children:e(Le,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),Ae()},children:e(Bs,{})})}),e(st,{label:b("userDialog.usage"),placement:"top",children:e(Le,{"aria-label":"usage",size:"sm",onClick:it,children:e(Vu,{})})}),e(K,{onClick:lt,size:"sm",children:b("userDialog.resetUsage")}),e(K,{onClick:pt,size:"sm",children:b("userDialog.revokeSubscription")})]})}),e(U,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(K,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:x?e(Dt,{size:"xs"}):void 0,disabled:Ge,children:b(m?"userDialog.editUser":"createUser")})})]})})]})}),k&&n(ot,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(En,{color:"primary",children:e($u,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:b("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:A&&A>0?b("userDialog.limitReachedBody",{limit:A,active:D!=null?D:A}):b("userDialog.limitReachedContent")})]})]})})]})},Yu=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Gu=t=>{if(!t)return null;const s=new Date(`${t}Z`);return Math.floor(s.getTime()/1e3)},Ga=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=Gu(t);return!t||r===null?e(T,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-r<=60?e(T,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(T,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Qu=t=>{if(!t)return null;const s=new Date(t+"Z");return Math.floor(s.getTime()/1e3)},Qa=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=Qu(t),l=r?s-r:null,o=r?vi(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${o.time} ago`:o.time})},Mi=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:a}=Je(),i=vi(t),c=An[s].icon;return n(Lt,{children:[n(rn,{colorScheme:An[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&a(`status.${s}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(i.status,{time:i.time})})]})},Xu=ee(Yu),os={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Zu=ee(Qo,os),ju=ee(xi,os),Xa=ee(yi,os),eh=ee(Xo,os),th=ee(qo,os),rh=ee(yn,os),nh=ee(xi,{baseStyle:{width:"15px",height:"15px"}}),sh=t=>{for(var s=0;s<ji.length;s++){const r=ji[s];if(r.value==t)return r.title}return"No"},ih=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o}=t,a=r===0||r===null;return e(U,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:n(h,{children:[je(s)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):je(r)]})})},Za=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o,...a}=t,i=r===0||r===null,c=!i&&s/r*100>=100;return n(Lt,{children:[e(Rc,{orientation:"horizontal",value:i?100:Math.min(s/r*100,100),colorScheme:c?"red":"primary",...a,children:e(Uc,{h:"6px",borderRadius:"full",children:e(Lc,{borderRadius:"full"})})}),n(U,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[n(h,{children:[je(s)," /"," ",i?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):je(r)+(l&&l!=="no_reset"?" "+an("userDialog.resetStrategy"+sh(l)):"")]}),n(h,{children:[an("usersTable.total"),": ",je(o)]})]})]})},ms=({sort:t,column:s})=>t.includes(s)?e(nh,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,ah=t=>{const{filters:s,users:{users:r,total:l},onEditingUser:o,onFilterChange:a,loading:i}=wt(),{t:c}=Je(),[u,p]=d.exports.useState(void 0),m=Sr({base:!1,md:!0}),g=r.length!==l,A=s.limit||10,D=v=>{let C=s.sort;C.includes(v)?C.startsWith("-")?C="-created_at":C="-"+v:C=v,a({sort:C})},k=v=>{a({status:v.target.value.length>0?v.target.value:void 0})},x=v=>{p(v===u?void 0:v)};return n(T,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(Zo,{allowMultiple:!0,display:{base:"block",md:"none"},index:u,children:n(Tn,{orientation:"vertical",zIndex:"docked",...t,children:[e(Xr,{zIndex:"docked",position:"relative",children:n(_t,{children:[e(He,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:D.bind(null,"username"),children:n(U,{children:[e("span",{children:c("users")}),e(ms,{sort:s.sort,column:"username"})]})}),e(He,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:n(U,{spacing:0,position:"relative",children:[n(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[c("usersTable.status"),s.status?": "+s.status:""]}),n(tt,{value:s.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Lt,{}),_focusVisible:{border:"0 !important"},onChange:k,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(He,{minW:"100px",cursor:"pointer",pr:0,onClick:D.bind(null,"used_traffic"),children:n(U,{children:[e("span",{children:c("usersTable.dataUsage")}),e(ms,{sort:s.sort,column:"used_traffic"})]})}),e(He,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),n(Br,{children:[!m&&(i?Array.from({length:A}).map((v,C)=>n(d.exports.Fragment,{children:[n(_t,{children:[e(Ne,{borderBottom:0,minW:"100px",pl:4,pr:4,children:e(Qs,{noOfLines:1,width:"40%"})}),e(Ne,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Wn,{height:"16px",width:"64px"})}),e(Ne,{borderBottom:0,minW:"100px",pr:0,children:e(Wn,{height:"16px",width:"120px"})}),e(Ne,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Wn,{height:"16px",width:"16px"})})]}),e(_t,{className:"collapsible",children:e(Ne,{p:0,colSpan:4,children:e(T,{px:6,py:3,children:e(Qs,{noOfLines:3})})})})]},"skeleton-"+C)):r==null?void 0:r.map((v,C)=>{var R;return n(d.exports.Fragment,{children:[n(_t,{onClick:x.bind(null,C),cursor:"pointer",children:[e(Ne,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:n("div",{className:"flex-status",children:[e(Ga,{lastOnline:v.online_at}),e(h,{isTruncated:!0,children:v.username})]})}),e(Ne,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Mi,{compact:!0,showDetail:!1,expiryDate:v.expire,status:v.status})}),e(Ne,{borderBottom:0,minW:"100px",pr:0,children:e(ih,{totalUsedTraffic:v.lifetime_used_traffic,dataLimitResetStrategy:v.data_limit_reset_strategy,used:v.used_traffic,total:v.data_limit,colorScheme:An[v.status].bandWidthColor})}),e(Ne,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(ju,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:u===C?"rotate(180deg)":"0deg"})})]}),e(_t,{className:"collapsible",onClick:x.bind(null,C),children:e(Ne,{p:0,colSpan:4,children:n(jo,{border:0,children:[e(el,{display:"none"}),e(tl,{border:0,cursor:"pointer",px:6,py:3,children:n(ue,{justifyContent:"space-between",spacing:"4",children:[n(ue,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.dataUsage")}),e(T,{width:"full",minW:"230px",children:e(Za,{totalUsedTraffic:v.lifetime_used_traffic,dataLimitResetStrategy:v.data_limit_reset_strategy,used:v.used_traffic,total:v.data_limit,colorScheme:An[v.status].bandWidthColor})})]}),n(ue,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.service","Service")}),e(h,{fontSize:"sm",color:v.service_name?"gray.700":"gray.500",_dark:{color:v.service_name?"gray.200":"gray.500"},children:(R=v.service_name)!=null?R:c("usersTable.defaultService","Default")})]}),n(U,{w:"full",justifyContent:"space-between",children:[n(T,{width:"full",children:[e(Mi,{compact:!0,expiryDate:v.expire,status:v.status}),e(Qa,{lastOnline:v.online_at})]}),n(U,{children:[e(ja,{user:v}),e(st,{label:c("userDialog.editUser"),placement:"top",children:e(Le,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:ie=>{ie.stopPropagation(),o(v)},children:e(rh,{})})})]})]})]})})]})})})]},v.username)})),!i&&!m&&r.length===0&&e(_t,{children:e(Ne,{colSpan:4,border:0,children:e(eo,{isFiltered:g})})})]})]})}),n(Tn,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(Xr,{position:"relative",zIndex:"docked",children:n(_t,{children:[e(He,{minW:"140px",cursor:"pointer",onClick:D.bind(null,"username"),children:n(U,{children:[e("span",{children:c("username")}),e(ms,{sort:s.sort,column:"username"})]})}),e(He,{width:"400px",minW:"150px",cursor:"pointer",children:n(U,{position:"relative",gap:"5px",children:[n(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),s.status?": "+s.status:""]}),e(h,{children:"/"}),e(ms,{sort:s.sort,column:"expire"}),e(U,{onClick:D.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),n(tt,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Lt,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:k,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(He,{minW:"150px",children:e("span",{children:c("usersTable.service","Service")})}),e(He,{width:"350px",minW:"230px",cursor:"pointer",onClick:D.bind(null,"used_traffic"),children:n(U,{children:[e("span",{children:c("usersTable.dataUsage")}),e(ms,{sort:s.sort,column:"used_traffic"})]})}),e(He,{width:"200px",minW:"180px"})]})}),n(Br,{children:[m&&(i?Array.from({length:A}).map((v,C)=>n(_t,{children:[e(Ne,{minW:"140px",children:e(Qs,{noOfLines:1,width:"40%"})}),e(Ne,{width:"400px",minW:"150px",children:e(Wn,{height:"16px",width:"120px"})}),e(Ne,{minW:"150px",children:e(Qs,{noOfLines:1,width:"60%"})}),e(Ne,{width:"350px",minW:"230px",children:e(Wn,{height:"16px",width:"200px"})}),e(Ne,{width:"200px",minW:"180px",children:e(Wn,{height:"16px",width:"64px"})})]},"skeleton-desktop-"+C)):r==null?void 0:r.map((v,C)=>{var R;return n(_t,{className:ca("interactive",{"last-row":C===r.length-1}),onClick:()=>o(v),children:[e(Ne,{minW:"140px",children:n("div",{className:"flex-status",children:[e(Ga,{lastOnline:v.online_at}),v.username,e(Qa,{lastOnline:v.online_at})]})}),e(Ne,{width:"400px",minW:"150px",children:e(Mi,{expiryDate:v.expire,status:v.status})}),e(Ne,{minW:"150px",children:e(h,{fontSize:"sm",color:v.service_name?"gray.700":"gray.500",_dark:{color:v.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(R=v.service_name)!=null?R:c("usersTable.defaultService","Default")})}),e(Ne,{width:"350px",minW:"230px",children:e(Za,{totalUsedTraffic:v.lifetime_used_traffic,dataLimitResetStrategy:v.data_limit_reset_strategy,used:v.used_traffic,total:v.data_limit,colorScheme:An[v.status].bandWidthColor})}),e(Ne,{width:"200px",minW:"180px",children:e(ja,{user:v})})]},v.username)})),!i&&r.length==0&&e(_t,{children:e(Ne,{colSpan:5,children:e(eo,{isFiltered:g})})})]})]})]})},ja=({user:t})=>{const{setQRCode:s,setSubLink:r}=wt(),l=t.links.join(`\r
`),a=(u=>u?u.startsWith("/")?window.location.origin+u:u:"")(t.subscription_url),[i,c]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{i[1]&&setTimeout(()=>{c([-1,!1])},1e3)},[i]),n(U,{justifyContent:"flex-end",onClick:u=>{u.preventDefault(),u.stopPropagation()},children:[e(Ia,{text:a,onCopy:()=>{c([0,!0])},children:e("div",{children:e(st,{label:i[0]==0&&i[1]?an("usersTable.copied"):an("usersTable.copyLink"),placement:"top",children:e(Le,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:i[0]==0&&i[1]?e(Xa,{}):e(eh,{})})})})}),e(Ia,{text:l,onCopy:()=>{c([1,!0])},children:e("div",{children:e(st,{label:i[0]==1&&i[1]?an("usersTable.copied"):an("usersTable.copyConfigs"),placement:"top",children:e(Le,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:i[0]==1&&i[1]?e(Xa,{}):e(Zu,{})})})})}),e(st,{label:"QR Code",placement:"top",children:e(Le,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(t.links),r(a)},children:e(th,{})})})]})},eo=({isFiltered:t})=>{const{onCreateUser:s}=wt();return n(T,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Xu,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?an("usersTable.noUserMatched"):an("usersTable.noUser")}),!t&&e(K,{size:"sm",colorScheme:"primary",onClick:()=>s(!0),children:an("createUser")})]})},oh=()=>{const{t}=Je();return d.exports.useEffect(()=>{wt.getState().refetchUsers(),Ns()},[]),n(ue,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(gl,{}),e(ah,{}),e(fl,{}),e(qu,{}),e(mu,{}),e(Iu,{}),e(Tu,{}),e(Nu,{})]})},Wt=(t,s,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return s({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Ot=(t,s)=>s({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),lh=()=>{var te,z,j,pe,Y;const{t}=Je(),s=Ht(),{adminInDialog:r,isAdminDialogOpen:l,closeAdminDialog:o,createAdmin:a,updateAdmin:i}=hn(),c=d.exports.useMemo(()=>r?"edit":"create",[r]),u=d.exports.useMemo(()=>Pe.object({username:c==="create"?Pe.string().trim().min(3,{message:t("admins.validation.usernameMin")}):Pe.string().optional(),password:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>!P||P.length>=6,t("admins.validation.passwordMin")),telegram_id:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>P===void 0||/^\d+$/.test(P),t("admins.validation.telegramNumeric")),is_sudo:Pe.boolean().optional(),data_limit:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>P===void 0||/^\d+$/.test(P),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:Pe.string().trim().optional().transform(P=>P===""?void 0:P).refine(P=>P===void 0||/^\d+$/.test(P),t("admins.validation.usersLimitNumeric","Users limit must be a number"))}).superRefine((P,me)=>{c==="create"&&!P.password&&me.addIssue({code:Pe.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[c,t]),p=Mr({resolver:Si(u),defaultValues:{username:"",password:"",telegram_id:"",is_sudo:!1,data_limit:"",users_limit:""}}),{register:m,handleSubmit:g,reset:A,formState:D,setValue:k,watch:x,setError:v}=p,C=m("is_sudo"),[R,ie]=d.exports.useState(!1),b=d.exports.useCallback(Q=>{var Ie;const P="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",me=P.length;if(typeof window<"u"&&((Ie=window.crypto)==null?void 0:Ie.getRandomValues)){const De=new Uint32Array(Q);return window.crypto.getRandomValues(De),Array.from(De,L=>P[L%me]).join("")}return Array.from({length:Q},()=>{const De=Math.floor(Math.random()*me);return P[De]}).join("")},[]),M=d.exports.useCallback(()=>{if(c==="edit")return;const Q=b(8);k("username",Q,{shouldDirty:!0,shouldValidate:!0})},[b,c,k]),I=d.exports.useCallback(()=>{const Q=b(12);k("password",Q,{shouldDirty:!0,shouldValidate:!0})},[b,k]),{errors:W,isSubmitting:ve}=D;d.exports.useEffect(()=>{var Q,P;l&&A({username:(Q=r==null?void 0:r.username)!=null?Q:"",password:"",telegram_id:(r==null?void 0:r.telegram_id)!==void 0&&(r==null?void 0:r.telegram_id)!==null?String(r.telegram_id):"",is_sudo:(P=r==null?void 0:r.is_sudo)!=null?P:!1,data_limit:(r==null?void 0:r.data_limit)!==void 0&&(r==null?void 0:r.data_limit)!==null?String(Math.floor(r.data_limit/(1024*1024*1024))):"",users_limit:(r==null?void 0:r.users_limit)!==void 0&&(r==null?void 0:r.users_limit)!==null?String(r.users_limit):""})},[r,l,A]);const Z=g(async Q=>{var P,me,Ie,De;if(c==="edit"&&r){const L=(P=r.active_users)!=null?P:0;if(Q.users_limit){const y=Number(Q.users_limit);if(!Number.isNaN(y)&&y>0&&y<L){v("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:L})});return}}}try{if(c==="create"){const L={username:Q.username.trim(),password:(me=Q.password)!=null?me:"",is_sudo:(Ie=Q.is_sudo)!=null?Ie:!1,telegram_id:Q.telegram_id?Number(Q.telegram_id):void 0,data_limit:Q.data_limit?Number(Q.data_limit)*1024*1024*1024:void 0,users_limit:Q.users_limit?Number(Q.users_limit):void 0};await a(L),Ot(t("admins.createSuccess","Admin created"),s)}else if(r){const L={is_sudo:(De=Q.is_sudo)!=null?De:!1,telegram_id:Q.telegram_id?Number(Q.telegram_id):void 0,data_limit:Q.data_limit?Number(Q.data_limit)*1024*1024*1024:void 0,users_limit:Q.users_limit?Number(Q.users_limit):void 0};Q.password&&(L.password=Q.password),await i(r.username,L),Ot(t("admins.updateSuccess","Admin updated"),s)}o()}catch(L){Wt(L,s,p)}});return n(Rt,{isOpen:l,onClose:o,size:"lg",children:[e(vt,{}),n(Ut,{children:[e(At,{children:c==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(zt,{}),e(Ct,{children:n(ue,{spacing:4,align:"stretch",children:[n(w,{isInvalid:!!W.username,children:[e(_,{children:t("username")}),n(xr,{children:[e(xe,{placeholder:t("admins.usernamePlaceholder","Admin username"),...m("username"),isDisabled:c==="edit"}),c==="create"&&e(Pr,{children:e(Le,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(pi,{width:20}),onClick:M})})]}),e(Qr,{children:(te=W.username)==null?void 0:te.message})]}),n(w,{isInvalid:!!W.password,children:[e(_,{children:t("password")}),n(U,{spacing:2,children:[n(xr,{children:[e(xe,{placeholder:t("admins.passwordPlaceholder","Password"),type:R?"text":"password",...m("password")}),e(Pr,{children:e(Le,{"aria-label":R?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:R?e(ha,{width:16}):e(Ps,{width:16}),onClick:()=>ie(!R)})})]}),e(Le,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(pi,{width:20}),onClick:I})]}),e(Qr,{children:(z=W.password)==null?void 0:z.message}),c==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),e(w,{display:"flex",alignItems:"center",children:n(ue,{align:"start",spacing:1,w:"full",children:[n(U,{justify:"space-between",w:"full",children:[e(_,{htmlFor:"is_sudo",mb:"0",children:t("admins.sudoAccess","Sudo access")}),e(dt,{id:"is_sudo",isChecked:x("is_sudo"),onChange:Q=>k("is_sudo",Q.target.checked,{shouldDirty:!0}),onBlur:C.onBlur,ref:C.ref})]}),e(h,{fontSize:"xs",color:"gray.500",children:t("admins.sudoDescription","Sudo admins can manage other admins.")})]})}),n(w,{isInvalid:!!W.telegram_id,children:[e(_,{children:t("admins.telegramId","Telegram ID")}),e(xe,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...m("telegram_id")}),e(Qr,{children:(j=W.telegram_id)==null?void 0:j.message})]}),n(w,{isInvalid:!!W.data_limit,children:[e(_,{children:t("admins.dataLimit","Data Limit (GB)")}),e(xe,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...m("data_limit")}),e(Qr,{children:(pe=W.data_limit)==null?void 0:pe.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),n(w,{isInvalid:!!W.users_limit,children:[e(_,{children:t("admins.usersLimit","Users Limit")}),e(xe,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...m("users_limit")}),e(Qr,{children:(Y=W.users_limit)==null?void 0:Y.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})}),e(Nt,{children:n(U,{spacing:3,children:[e(K,{variant:"ghost",onClick:o,children:t("cancel")}),e(K,{colorScheme:"primary",onClick:Z,isLoading:ve,children:c==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]})},ch=()=>{var Q;const{t}=Je(),s=Ht(),r=nt("gray.50","whiteAlpha.100"),l=nt("primary.50","primary.900"),{admins:o,loading:a,total:i,filters:c,onFilterChange:u,fetchAdmins:p,deleteAdmin:m,resetUsage:g,disableUsers:A,activateUsers:D,openAdminDialog:k,openAdminDetails:x,adminInDetails:v}=hn(),C=d.exports.useRef(null),{isOpen:R,onOpen:ie,onClose:b}=Gt(),[M,I]=d.exports.useState(null),[W,ve]=d.exports.useState(null),Z=P=>{if(P==="data_usage"||P==="data_limit"){const me=c.sort===P?`-${P}`:P;u({sort:me,offset:0})}else{const me=c.sort===P?`-${P}`:c.sort===`-${P}`?void 0:P;u({sort:me,offset:0})}},te=P=>{I(P),ie()},z=async()=>{if(!!M)try{await m(M.username),Ot(t("admins.deleteSuccess","Admin removed"),s),b(),I(null)}catch(P){Wt(P,s)}},j=async(P,me)=>{ve({type:P,username:me.username});try{P==="reset"?(await g(me.username),Ot(t("admins.resetUsageSuccess","Usage reset"),s)):P==="disable"?(await A(me.username),Ot(t("admins.disableUsersSuccess","Users disabled"),s)):P==="activate"&&(await D(me.username),Ot(t("admins.activateUsersSuccess","Users activated"),s)),p()}catch(Ie){Wt(Ie,s)}finally{ve(null)}},pe=({column:P})=>{var De,L,y,E,ae;let me=!1,Ie=!1;return P==="data"?(me=((De=c.sort)==null?void 0:De.includes("data_usage"))||((L=c.sort)==null?void 0:L.includes("data_limit")),Ie=me&&((y=c.sort)==null?void 0:y.startsWith("-"))):(me=(E=c.sort)==null?void 0:E.includes(P),Ie=me&&((ae=c.sort)==null?void 0:ae.startsWith("-"))),e(xi,{style:{width:"1rem",height:"1rem",opacity:me?1:0,transform:me&&!Ie?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},Y=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return a&&!o.length?e(T,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(Dt,{})}):i?n(Lt,{children:[e(T,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:n(Tn,{variant:"simple",size:"sm",minW:"640px",children:[e(Xr,{children:e(_t,{children:Y.map(P=>e(He,{onClick:()=>P.key==="username"||P.key==="users_count"||P.key==="data"?Z(P.key):void 0,cursor:P.key==="username"||P.key==="users_count"||P.key==="data"?"pointer":"default",textAlign:P.key==="actions"?"right":"left",children:n(U,{justify:P.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:P.label}),P.key==="data"?n(di,{children:[e(ui,{as:Le,size:"xs",variant:"ghost",icon:e(pe,{column:"data"})}),n(hi,{children:[e(tr,{onClick:()=>Z("data_usage"),children:t("admins.sortByUsage")}),e(tr,{onClick:()=>Z("data_limit"),children:t("admins.sortByLimit")})]})]}):P.key==="username"||P.key==="users_count"?e(pe,{column:P.key}):null]})},P.key))})}),e(Br,{children:o.map(P=>{var L,y;const me=(v==null?void 0:v.username)===P.username,Ie=P.users_limit&&P.users_limit>0?String(P.users_limit):"\u221E",De=`${(L=P.active_users)!=null?L:0}/${Ie}`;return n(_t,{onClick:()=>x(P),cursor:"pointer",bg:me?l:void 0,_hover:{bg:r},transition:"background-color 0.15s ease-in-out",children:[n(Ne,{children:[e(h,{fontWeight:"medium",children:P.username}),P.is_sudo&&e(rn,{colorScheme:"purple",fontSize:"xs",mt:1,children:t("sudo")})]}),e(Ne,{children:n(h,{whiteSpace:"nowrap",children:[je((y=P.users_usage)!=null?y:0,2)," /"," ",P.data_limit?je(P.data_limit,2):"-"]})}),e(Ne,{children:n(ke,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:De})]})}),e(Ne,{textAlign:"right",children:n(di,{children:[e(ui,{as:Le,icon:e(Mc,{width:20}),variant:"ghost",onClick:E=>E.stopPropagation()}),n(hi,{onClick:E=>E.stopPropagation(),children:[e(tr,{icon:e(yn,{width:20}),onClick:E=>{E.stopPropagation(),k(P)},children:t("edit")}),e(tr,{icon:e(Vr,{width:20}),onClick:E=>{E.stopPropagation(),j("reset",P)},isDisabled:(W==null?void 0:W.username)===P.username,children:t("admins.resetUsage")}),e(mi,{}),e(tr,{icon:e(Oc,{width:20}),onClick:E=>{E.stopPropagation(),j("activate",P)},isDisabled:(W==null?void 0:W.username)===P.username,children:t("admins.activateUsers")}),e(tr,{icon:e(Wc,{width:20}),onClick:E=>{E.stopPropagation(),j("disable",P)},isDisabled:(W==null?void 0:W.username)===P.username,children:t("admins.disableUsers")}),e(mi,{}),e(tr,{color:"red.500",icon:e(tn,{width:20}),onClick:E=>{E.stopPropagation(),te(P)},children:t("delete")})]})]})})]},P.username)})})]})}),e(Ts,{isOpen:R,leastDestructiveRef:C,onClose:b,children:e(vt,{children:n(Es,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(Ct,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(Q=M==null?void 0:M.username)!=null?Q:""})}),n(Nt,{children:[e(K,{ref:C,onClick:b,children:t("cancel")}),e(K,{colorScheme:"red",onClick:z,ml:3,children:t("delete")})]})]})})})]}):e(T,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},dh=(t,s)=>!t||t<=0?s!=null?s:"\u221E":`${t}`,Oi=(t,s)=>!t||t<=0?s!=null?s:"\u221E":je(t,2),uh=()=>{var C,R,ie,b,M,I,W,ve,Z,te;const{t}=Je(),{isAdminDetailsOpen:s,adminInDetails:r,closeAdminDetails:l}=hn(z=>({isAdminDetailsOpen:z.isAdminDetailsOpen,adminInDetails:z.adminInDetails,closeAdminDetails:z.closeAdminDetails})),o=nt("gray.50","whiteAlpha.50"),a=(C=r==null?void 0:r.active_users)!=null?C:0,i=(R=r==null?void 0:r.users_limit)!=null?R:null,c=t("admins.details.unlimited","Unlimited"),u=i&&i>0?String(i):c,p=(ie=r==null?void 0:r.users_count)!=null?ie:0,m=(b=r==null?void 0:r.limited_users)!=null?b:0,g=(M=r==null?void 0:r.expired_users)!=null?M:0,A=(I=r==null?void 0:r.online_users)!=null?I:0,D=(W=r==null?void 0:r.users_usage)!=null?W:0,k=(ve=r==null?void 0:r.data_limit)!=null?ve:null,x=k&&k>0?Math.max(k-D,0):null,v=(Z=r==null?void 0:r.lifetime_usage)!=null?Z:null;return n(Ho,{isOpen:s,placement:"right",size:"md",onClose:l,children:[e(vt,{}),n(Bo,{children:[e(zt,{}),e(At,{bg:o,children:n(ke,{spacing:1,children:[n(U,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(te=r==null?void 0:r.username)!=null?te:t("admins.details.title","Admin details")}),(r==null?void 0:r.is_sudo)&&e(T,{as:"span",fontSize:"xs",px:2,py:.5,borderRadius:"full",bg:"purple.500",color:"white",children:t("admins.sudoBadge","Sudo")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:a,limit:u})})]})}),e(Ct,{children:r?n(ke,{spacing:8,children:[n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),n(Ke,{columns:{base:2,md:3},spacing:4,children:[e(Yr,{label:t("admins.details.activeLabel","Active"),value:String(a)}),e(Yr,{label:t("admins.details.onlineLabel","Online"),value:String(A)}),e(Yr,{label:t("admins.details.limitedLabel","Limited"),value:String(m)}),e(Yr,{label:t("admins.details.expiredLabel","Expired"),value:String(g)}),e(Yr,{label:t("admins.details.totalUsers","Total users"),value:String(p)}),e(Yr,{label:t("admins.details.usersLimit","Users limit"),value:dh(i,c)})]})]}),n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),n(Ke,{columns:{base:2,md:4},spacing:4,children:[e(Yr,{label:t("admins.details.used","Used"),value:je(D,2)}),e(Yr,{label:t("admins.details.limit","Limit"),value:Oi(k,c)}),e(Yr,{label:t("admins.details.remaining","Remaining"),value:Oi(x,c)}),e(Yr,{label:t("admins.details.lifetime","Lifetime usage"),value:Oi(v,void 0)})]})]})]}):e(T,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(Nt,{children:e(K,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},Yr=({label:t,value:s})=>n(T,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:s})]}),hh=()=>{const{t}=Je(),s=hn(a=>a.fetchAdmins),{userData:r,getUserIsSuccess:l}=Un(),o=l&&r.is_sudo;return d.exports.useEffect(()=>{o&&s()},[s,o]),o?n(ue,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(gl,{for:"admins"}),e(ch,{}),e(fl,{for:"admins"}),e(lh,{}),e(uh,{})]}):n(ue,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},bl=ns(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),_e("/hosts").then(s=>t({hosts:s})).finally(()=>t({isLoading:!1}))},setHosts:s=>(t({isPostLoading:!0}),_e("/hosts",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})}))})),ph=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],mh=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],gh=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],fh=ee(yn,{baseStyle:{w:4,h:4}}),yl=ee(dn,{baseStyle:{w:4,h:4}}),Sl=ee(Fo,{baseStyle:{w:4,h:4}}),bh=ee(Us,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),yh=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],Qn=()=>{const{t}=Je();return n(Ls,{isLazy:!0,placement:"right",children:[e(Ms,{children:e(T,{mt:"-1",children:e(bh,{})})}),e(Hc,{children:n(Os,{maxW:"xs",fontSize:"xs",children:[e(Ws,{}),e(nl,{}),e(Fs,{children:n(T,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),yh.map(({token:s,labelKey:r})=>n(h,{mt:1,children:[e(rn,{mr:2,children:s}),t(r)]},s))]})})]})})]})},xl=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Ur=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,Zr=t=>(t!=null?t:"").trim(),gs=(t,s=!1)=>typeof t=="boolean"?t:s,Sh=(t,s)=>{var r,l,o,a,i,c,u,p;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(o=t.address)!=null?o:"",sort:(a=t.sort)!=null?a:s,port:(i=t.port)!=null?i:null,path:Zr(t.path),sni:Zr(t.sni),host:Zr(t.host),mux_enable:gs(t.mux_enable),allowinsecure:gs(t.allowinsecure),is_disabled:gs(t.is_disabled,!1),fragment_setting:Zr(t.fragment_setting),noise_setting:Zr(t.noise_setting),random_user_agent:gs(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:gs(t.use_sni_as_host)}},ea=t=>{var s,r;return{id:(s=t.id)!=null?s:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},to=t=>{var s,r;return{...t,id:(s=t.id)!=null?s:null,port:(r=t.port)!=null?r:null,path:Zr(t.path),sni:Zr(t.sni),host:Zr(t.host),fragment_setting:Zr(t.fragment_setting),noise_setting:Zr(t.noise_setting)}},kl=t=>{const s=to(t.data),r=to(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(s)!==JSON.stringify(r)},xh=t=>{var s;return{id:(s=t.id)!=null?s:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},_s=t=>[...t].sort((s,r)=>{const l=Ur(s.data.sort)-Ur(r.data.sort);return l!==0?l:s.data.remark.localeCompare(r.data.remark)}),kh=t=>{const s=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((o,a)=>{const i=Sh(o,a),c=i.id!=null?`host-${i.id}`:xl();s.push({uid:c,inboundTag:r,initialInboundTag:r,data:ea(i),original:ea(i)})})}),_s(s)},wl=t=>{const s=new Map;t.forEach(l=>{var a;const o=(a=s.get(l.inboundTag))!=null?a:[];o.push(l.data),s.set(l.inboundTag,o)});const r={};return s.forEach((l,o)=>{r[o]=l.map(a=>xh(a)).sort((a,i)=>Ur(a.sort)-Ur(i.sort))}),r},Wi=(t,s)=>{const r=wl(t),l=Array.from(new Set(s)),o={};return l.forEach(a=>{var i;o[a]=(i=r[a])!=null?i:[]}),o},wh=({host:t,inboundOptions:s,orderIndex:r,onToggleActive:l,onEdit:o,onDelete:a,saving:i,deleting:c})=>{const{t:u}=Je(),p=s.find(D=>D.value===t.inboundTag),m=!t.data.is_disabled,g=kl(t),A=t.data.remark||u("hostsPage.untitledHost");return e(en,{borderWidth:"1px",borderColor:g?"primary.400":"gray.200",_dark:{borderColor:g?"primary.300":"gray.700",bg:g?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>o(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:n(ln,{as:ke,spacing:4,children:[n(U,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(ue,{align:"flex-start",spacing:1,flex:"1",children:[e(st,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:A})}),n(U,{spacing:2,flexWrap:"wrap",children:[e(gt,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),p&&e(gt,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(gt,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),g&&e(gt,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),n(U,{spacing:2,children:[e(dt,{size:"sm",colorScheme:"primary",isChecked:m,onChange:D=>{D.stopPropagation(),l(t.uid,D.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(m?"hostsPage.enabled":"hostsPage.disabled")})]})]}),n(ue,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),n(U,{justify:"space-between",children:[e(K,{size:"sm",variant:"outline",leftIcon:e(fh,{}),onClick:D=>{D.stopPropagation(),o(t.uid)},isLoading:i,children:u("hostsPage.edit")}),e(Le,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:D=>{D.stopPropagation(),a(t.uid)},icon:e(Bs,{}),isLoading:c})]})]})})},vh=({host:t,index:s})=>{const{t:r}=Je(),l=Fc(),o=t.data.remark||r("hostsPage.untitledHost"),a=d.exports.useCallback(i=>{i.pointerType==="mouse"&&i.button!==0||(i.preventDefault(),l.start(i))},[l]);return e(rl.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:n(U,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(st,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(Le,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(Sl,{}),cursor:"grab",onPointerDown:a,style:{touchAction:"none"}})}),e(gt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:s+1})}),n(ue,{align:"flex-start",spacing:0,flex:"1",children:[e(st,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:o})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Ch=({host:t,inboundOptions:s,isOpen:r,onClose:l,onChange:o,onChangeInbound:a,onSave:i,onReset:c,onDelete:u,saving:p,deleting:m})=>{var k;const{t:g}=Je();if(!t)return null;const A=s.find(x=>x.value===t.inboundTag),D=kl(t);return n(Rt,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,children:[e(vt,{}),n(Ut,{children:[e(zt,{}),e(At,{pb:1,children:n(ue,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||g("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||g("hostsPage.noAddress")}),A&&e(gt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${A.value} (${A.protocol.toUpperCase()} - ${A.network})`})]})}),e(Ct,{children:n(ue,{align:"stretch",spacing:5,children:[n(en,{variant:"outline",children:[e(qn,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.general")})}),e(ln,{pt:0,children:n(ue,{align:"stretch",spacing:4,children:[n(w,{children:[e(_,{children:g("hostsDialog.remark")}),n(xr,{children:[e(xe,{value:t.data.remark,onChange:x=>o(t.uid,"remark",x.target.value)}),e(Pr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:g("hostsPage.inboundLabel")}),e(tt,{value:t.inboundTag,onChange:x=>a(t.uid,x.target.value),children:s.map(x=>e("option",{value:x.value,children:x.label},x.value))})]}),n(w,{children:[e(_,{children:g("hostsDialog.sort")}),e(Pn,{value:t.data.sort,allowMouseWheel:!0,onChange:(x,v)=>o(t.uid,"sort",Number.isNaN(v)?t.data.sort:v),children:e(In,{})})]})]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:g("hostsDialog.address")}),n(xr,{children:[e(xe,{value:t.data.address,onChange:x=>o(t.uid,"address",x.target.value)}),e(Pr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(w,{children:[e(_,{children:g("hostsDialog.port")}),e(Pn,{value:(k=t.data.port)!=null?k:"",allowMouseWheel:!0,onChange:(x,v)=>o(t.uid,"port",Number.isNaN(v)?null:v),children:e(In,{})})]})]}),n(w,{children:[e(_,{children:g("hostsDialog.path")}),e(xe,{value:t.data.path,onChange:x=>o(t.uid,"path",x.target.value),placeholder:"/"})]})]})})]}),n(en,{variant:"outline",children:[e(qn,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.security")})}),e(ln,{pt:0,children:n(ue,{align:"stretch",spacing:4,children:[n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:g("hostsDialog.sni")}),e(xe,{value:t.data.sni,onChange:x=>o(t.uid,"sni",x.target.value)})]}),n(w,{children:[e(_,{children:g("hostsDialog.host")}),n(xr,{children:[e(xe,{value:t.data.host,onChange:x=>o(t.uid,"host",x.target.value)}),e(Pr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]})]}),n(Ke,{columns:{base:1,md:3},spacing:4,children:[n(w,{children:[e(_,{children:g("hostsDialog.security")}),e(tt,{value:t.data.security,onChange:x=>o(t.uid,"security",x.target.value),children:ph.map(x=>e("option",{value:x.value,children:x.title},x.value))})]}),n(w,{children:[e(_,{children:g("hostsDialog.alpn")}),e(tt,{value:t.data.alpn,onChange:x=>o(t.uid,"alpn",x.target.value),children:mh.map(x=>e("option",{value:x.value,children:x.title},x.value))})]}),n(w,{children:[e(_,{children:g("hostsDialog.fingerprint")}),e(tt,{value:t.data.fingerprint,onChange:x=>o(t.uid,"fingerprint",x.target.value),children:gh.map(x=>e("option",{value:x.value,children:x.title},x.value))})]})]})]})})]}),n(en,{variant:"outline",children:[e(qn,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.advanced")})}),e(ln,{pt:0,children:n(ue,{align:"stretch",spacing:4,children:[n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:g("hostsDialog.fragment")}),e(xe,{value:t.data.fragment_setting,onChange:x=>o(t.uid,"fragment_setting",x.target.value)})]}),n(w,{children:[e(_,{children:g("hostsDialog.noise")}),e(xe,{value:t.data.noise_setting,onChange:x=>o(t.uid,"noise_setting",x.target.value)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:4,children:[e(Ir,{isChecked:t.data.allowinsecure,onChange:x=>o(t.uid,"allowinsecure",x.target.checked),children:g("hostsDialog.allowinsecure")}),e(Ir,{isChecked:t.data.mux_enable,onChange:x=>o(t.uid,"mux_enable",x.target.checked),children:g("hostsDialog.muxEnable")}),e(Ir,{isChecked:t.data.random_user_agent,onChange:x=>o(t.uid,"random_user_agent",x.target.checked),children:g("hostsDialog.randomUserAgent")}),e(Ir,{isChecked:t.data.use_sni_as_host,onChange:x=>o(t.uid,"use_sni_as_host",x.target.checked),children:g("hostsDialog.useSniAsHost")})]})]})})]})]})}),n(Nt,{justifyContent:"space-between",children:[e(K,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(Bs,{}),onClick:()=>u(t.uid),isLoading:m,children:g("hostsPage.delete")}),n(U,{spacing:3,children:[e(K,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!D||p,children:g("hostsPage.reset")}),e(K,{size:"sm",colorScheme:"primary",onClick:()=>i(t.uid),isDisabled:!D,isLoading:p,children:g("hostsPage.save")})]})]})]})]})},_h=({isOpen:t,onClose:s,inboundOptions:r,onSubmit:l,isSubmitting:o,defaultSort:a})=>{var g,A,D,k;const{t:i}=Je(),c=d.exports.useRef(null),[u,p]=d.exports.useState({inboundTag:(A=(g=r[0])==null?void 0:g.value)!=null?A:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var x,v;t&&(p({inboundTag:(v=(x=r[0])==null?void 0:x.value)!=null?v:"",remark:"",address:"",sort:a!=null?a:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var C;return(C=c.current)==null?void 0:C.focus()},150))},[a,r,t]);const m=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return n(Rt,{isOpen:t,onClose:s,size:"lg",initialFocusRef:c,children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ut,{children:[e(At,{children:n(U,{spacing:3,children:[e(yl,{}),e(h,{fontWeight:"semibold",children:i("hostsPage.create.title")})]})}),e(zt,{mt:2}),n(Ct,{as:ue,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:i("hostsPage.create.description")}),n(w,{children:[e(_,{children:i("hostsPage.inboundLabel")}),e(tt,{value:u.inboundTag,onChange:x=>p(v=>({...v,inboundTag:x.target.value})),children:r.map(x=>e("option",{value:x.value,children:x.label},x.value))})]}),n(w,{isRequired:!0,children:[e(_,{children:i("hostsDialog.remark")}),n(xr,{children:[e(xe,{ref:c,value:u.remark,onChange:x=>p(v=>({...v,remark:x.target.value}))}),e(Pr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{isRequired:!0,children:[e(_,{children:i("hostsDialog.address")}),n(xr,{children:[e(xe,{value:u.address,onChange:x=>p(v=>({...v,address:x.target.value}))}),e(Pr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(w,{children:[e(_,{children:i("hostsDialog.port")}),e(Pn,{value:(D=u.port)!=null?D:"",onChange:(x,v)=>p(C=>({...C,port:Number.isNaN(v)?null:v})),children:e(In,{})})]})]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("hostsDialog.path")}),e(xe,{value:u.path,onChange:x=>p(v=>({...v,path:x.target.value}))})]}),n(w,{children:[e(_,{children:i("hostsDialog.sni")}),e(xe,{value:u.sni,onChange:x=>p(v=>({...v,sni:x.target.value}))})]})]}),n(w,{children:[e(_,{children:i("hostsDialog.host")}),n(xr,{children:[e(xe,{value:u.host,onChange:x=>p(v=>({...v,host:x.target.value}))}),e(Pr,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(w,{children:[e(_,{children:i("hostsDialog.sort")}),e(Pn,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(x,v)=>p(C=>({...C,sort:Number.isNaN(v)?C.sort:v})),children:e(In,{})})]}),e(T,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:i("hostsPage.create.sortHint",{value:(k=u.sort)!=null?k:a})})]}),n(Nt,{gap:2,children:[e(K,{variant:"ghost",onClick:s,children:i("hostsPage.cancel")}),e(K,{colorScheme:"primary",onClick:m,isLoading:o,children:i("hostsPage.create.submit")})]})]})]})},Dh=()=>{var ft;const{t}=Je(),s=Ht(),{hosts:r,fetchHosts:l,isLoading:o,isPostLoading:a,setHosts:i}=bl(),{inbounds:c}=wt(),[u,p]=d.exports.useState([]),m=d.exports.useRef([]),g=d.exports.useCallback(q=>{typeof q=="function"?p(F=>{const Se=q(F);return m.current=Se,Se}):(m.current=q,p(q))},[]),[A,D]=d.exports.useState(null),[k,x]=d.exports.useState(!1),[v,C]=d.exports.useState(!1),[R,ie]=d.exports.useState(null),[b,M]=d.exports.useState(null),[I,W]=d.exports.useState(null),[ve,Z]=d.exports.useState(null),te=d.exports.useRef(null),[z,j]=d.exports.useState(!1),pe=d.exports.useRef(!1),[Y,Q]=d.exports.useState(!1),[P,me]=d.exports.useState(!1),[Ie,De]=d.exports.useState(null);d.exports.useEffect(()=>{l()},[l]),d.exports.useEffect(()=>{c.size||Ns()},[c]),d.exports.useEffect(()=>{const q=kh(r);g(q)},[r,g]),d.exports.useEffect(()=>{if(ve){const q=m.current.find(F=>F.inboundTag===ve.inboundTag&&F.data.remark.trim()===ve.remark&&F.data.address.trim()===ve.address);q&&(D(q.uid),Z(null))}},[u,ve]),d.exports.useEffect(()=>{A&&!m.current.some(q=>q.uid===A)&&!ve&&D(null)},[u,A,ve]);const L=d.exports.useCallback(q=>{pe.current=q,j(q)},[]);d.exports.useEffect(()=>{P||(De(null),L(!1))},[k,P,L]),d.exports.useEffect(()=>{if(!P||!Ie)return;const q=new Set(m.current.map(Se=>Se.uid));Ie.every(Se=>q.has(Se.uid))||(De(null),L(!1))},[u,P,L,Ie]);const y=d.exports.useMemo(()=>{const q=[];return c.forEach(F=>{F.forEach(Se=>{q.push({label:`${Se.tag} (${Se.protocol.toUpperCase()} - ${Se.network})`,value:Se.tag,protocol:Se.protocol,network:Se.network})})}),q.sort((F,Se)=>F.label.localeCompare(Se.label))},[c]),E=d.exports.useMemo(()=>m.current.filter(q=>!q.data.is_disabled).sort((q,F)=>Ur(q.data.sort)-Ur(F.data.sort)),[u]),ae=d.exports.useMemo(()=>[...m.current].sort((q,F)=>Ur(q.data.sort)-Ur(F.data.sort)),[u]),re=d.exports.useMemo(()=>k?ae:E,[E,ae,k]);d.exports.useEffect(()=>{P&&De(q=>q!=null?q:[...E])},[E,P]);const Ce=P?Ie!=null?Ie:E:re,Te=d.exports.useMemo(()=>{const q=new Map;return Ce.forEach((F,Se)=>q.set(F.uid,Se)),q},[Ce]),Re=A&&(ft=m.current.find(q=>q.uid===A))!=null?ft:null,Me=(q,F,Se)=>{g(Ue=>_s(Ue.map(We=>We.uid===q?{...We,data:{...We.data,[F]:Se}}:We)))},H=(q,F)=>{g(Se=>_s(Se.map(Ue=>Ue.uid===q?{...Ue,inboundTag:F}:Ue)))},B=d.exports.useCallback(async()=>{if(!P||Y)return!1;const q=E,F=Ie!=null?Ie:q;if(!(F.length!==q.length||F.some((Ae,lt)=>{var pt;return Ae.uid!==((pt=q[lt])==null?void 0:pt.uid)}))||!Ie||F.length===0)return me(!1),De(null),L(!1),!0;const Ue=F.map(Ae=>Ae.uid),We=new Map;Ue.forEach((Ae,lt)=>We.set(Ae,lt));const Be=m.current,le=m.current.filter(Ae=>We.has(Ae.uid)).sort((Ae,lt)=>{var pt,Ge;return((pt=We.get(Ae.uid))!=null?pt:Number.MAX_SAFE_INTEGER)-((Ge=We.get(lt.uid))!=null?Ge:Number.MAX_SAFE_INTEGER)}),ge=m.current.filter(Ae=>!We.has(Ae.uid)).sort((Ae,lt)=>Ur(Ae.data.sort)-Ur(lt.data.sort)),Oe=[...le,...ge].map((Ae,lt)=>({...Ae,data:{...Ae.data,sort:lt},original:{...Ae.original,sort:lt}}));g(Oe),De(Oe.filter(Ae=>!Ae.data.is_disabled)),Q(!0);try{const Ae=wl(Oe);return await i(Ae),await l(),L(!1),me(!1),De(null),s({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{g(Be);const lt=Be.filter(pt=>!pt.data.is_disabled).sort((pt,Ge)=>Ur(pt.data.sort)-Ur(Ge.data.sort));return De(lt),L(!0),s({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{Q(!1)}},[g,E,l,P,Y,i,L,t,s,Ie]),O=d.exports.useCallback(q=>{if(!P||!q.length)return;const F=Ie!=null?Ie:E;!(q.length!==F.length||q.some((Ue,We)=>{var Be;return Ue.uid!==((Be=F[We])==null?void 0:Be.uid)}))||(De(q),pe.current||L(!0))},[E,P,L,Ie]),de=d.exports.useCallback(()=>{De([...E]),L(!1),me(!0)},[E,L]),ze=d.exports.useCallback(()=>{me(!1),De(null),L(!1)},[L]),it=d.exports.useCallback(()=>{B()},[B]),he=async q=>{const F=m.current.find(Se=>Se.uid===q);if(!!F){ie(q),Z({inboundTag:F.inboundTag,remark:F.data.remark.trim(),address:F.data.address.trim()});try{const Se=Wi(m.current,[F.inboundTag,F.initialInboundTag]);await i(Se),await l(),s({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"})}catch{s({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{ie(null)}}},ce=q=>{g(F=>_s(F.map(Se=>Se.uid===q?{...Se,inboundTag:Se.initialInboundTag,data:ea(Se.original)}:Se)))},oe=(q,F)=>{Me(q,"is_disabled",!F),F||x(!0)},V=q=>{W(q)},ye=async()=>{if(!I)return;const q=m.current.find(F=>F.uid===I);if(!!q){M(I);try{const F=m.current.filter(Ue=>Ue.uid!==I);g(F);const Se=Wi(F,[q.inboundTag,q.initialInboundTag]);await i(Se),await l(),s({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),A===I&&D(null)}catch{s({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{M(null),W(null)}}},ht=async q=>{const F=m.current.length?Math.max(...m.current.map(Se=>Se.data.sort))+1:0;ie("create"),Z({inboundTag:q.inboundTag,remark:q.remark.trim(),address:q.address.trim()});try{const Se={uid:xl(),inboundTag:q.inboundTag,initialInboundTag:q.inboundTag,data:{id:null,remark:q.remark,address:q.address,sort:Number.isFinite(q.sort)?q.sort:F,port:q.port,path:q.path,sni:q.sni,host:q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:q.remark,address:q.address,sort:Number.isFinite(q.sort)?q.sort:F,port:q.port,path:q.path,sni:q.sni,host:q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},Ue=_s([...m.current,Se]);g(Ue);const We=Wi(Ue,[q.inboundTag]);await i(We),await l(),s({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),C(!1)}catch{s({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{ie(null)}};return n(ue,{align:"stretch",spacing:4,children:[P?n(ue,{align:"stretch",spacing:2,children:[n(U,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),n(U,{spacing:2,children:[e(K,{variant:"ghost",onClick:ze,isDisabled:Y,children:t("hostsPage.cancel")}),e(K,{colorScheme:"primary",onClick:it,isLoading:Y,isDisabled:!z&&!Y,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),Y?n(U,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(Dt,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):z?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):n(U,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(U,{spacing:3,children:[e(K,{colorScheme:"primary",size:"sm",onClick:()=>C(!0),leftIcon:e(yl,{}),isDisabled:!y.length,children:t("hostsPage.addHost")}),e(dt,{isChecked:k,onChange:q=>x(q.target.checked),children:t("hostsPage.showDisabled")})]}),e(K,{size:"sm",variant:"outline",leftIcon:e(Sl,{}),onClick:de,isDisabled:o||!E.length,children:t("hostsPage.enterSort")})]}),o?e(U,{justify:"center",py:10,children:e(Dt,{})}):Ce.length===0?e(T,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t("hostsPage.emptyState")})}):P?e(rl.Group,{axis:"y",values:Ce,onReorder:O,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:Ce.map((q,F)=>e(vh,{host:q,index:F},q.uid))}):e(Ke,{columns:{base:1,md:2,xl:3},spacing:4,children:re.map((q,F)=>{var Se;return e(wh,{host:q,inboundOptions:y,orderIndex:(Se=Te.get(q.uid))!=null?Se:F,onToggleActive:oe,onEdit:D,onDelete:V,saving:R===q.uid&&a,deleting:b===q.uid&&a},q.uid)})}),e(_h,{isOpen:v,onClose:()=>C(!1),inboundOptions:y,onSubmit:ht,isSubmitting:R==="create"&&a,defaultSort:m.current.length?Math.max(...m.current.map(q=>q.data.sort))+1:0}),e(Ch,{host:Re,inboundOptions:y,isOpen:Boolean(Re),onClose:()=>D(null),onChange:Me,onChangeInbound:H,onSave:he,onReset:ce,onDelete:V,saving:!!Re&&R===Re.uid&&a,deleting:!!Re&&b===Re.uid&&a}),e(Ts,{isOpen:Boolean(I),leastDestructiveRef:te,onClose:()=>W(null),children:e(vt,{children:n(Es,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(Ct,{children:t("hostsPage.deleteConfirmation")}),n(Nt,{children:[e(K,{ref:te,onClick:()=>W(null),children:t("hostsPage.cancel")}),e(K,{colorScheme:"red",onClick:ye,ml:3,isLoading:Boolean(b),children:t("hostsPage.delete")})]})]})})})]})},Ah=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),ro=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(Ah(t))}catch{}return""},Ih=t=>{if(typeof t!="string"||t.length===0)return"";const s=globalThis.Wireguard;if(s!=null&&s.generateKeypair)try{const r=s.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class vr{static isEmpty(s){return s==null?!0:typeof s=="string"?s.trim().length===0:Array.isArray(s)?s.length===0:typeof s=="object"?Object.keys(s).length===0:!1}static isArrEmpty(s){return!Array.isArray(s)||s.length===0}}const se=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),vl=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const Ph=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),Th=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const Eh=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Fi=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class kt{static toJsonArray(s){return s.map(r=>r.toJson())}static fromJson(s){return new kt}toJson(){return{}}toString(s=!0){const r=this.toJson();return s?JSON.stringify(r,null,2):JSON.stringify(r)}}class cn extends kt{constructor(r="none",l="",o=""){super();$(this,"type");$(this,"host");$(this,"path");this.type=r,this.host=l,this.path=o}static fromJson(r={}){var o,a,i,c,u,p,m,g,A,D;const l=r==null?void 0:r.header;if(!l)return new cn;if(l.type==="http"&&l.request){const k=((a=(o=l.request)==null?void 0:o.headers)==null?void 0:a.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(c=(i=l.request)==null?void 0:i.headers)==null?void 0:c.Host)!=null?u:"",x=((p=l.request)==null?void 0:p.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(g=(m=l.request)==null?void 0:m.path)!=null?g:"";return new cn((A=l.type)!=null?A:"http",k,x)}return new cn((D=l.type)!=null?D:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:vr.isEmpty(this.host)?[]:this.host.split(",")},path:vr.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class jn extends kt{constructor(r=1350,l=50,o=5,a=20,i=!1,c=2,u=2,p="none",m=""){super();$(this,"mtu");$(this,"tti");$(this,"upCap");$(this,"downCap");$(this,"congestion");$(this,"readBuffer");$(this,"writeBuffer");$(this,"type");$(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=o!=null?o:5,this.downCap=a!=null?a:20,this.congestion=Boolean(i),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=p!=null?p:"none",this.seed=m!=null?m:""}static fromJson(r={}){var l,o,a;return new jn(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(o=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?o:"none",(a=r==null?void 0:r.seed)!=null?a:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class Nn extends kt{constructor(r="/",l="",o=0){super();$(this,"path");$(this,"host");$(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=o!=null?o:0}static fromJson(r={}){var l,o,a;return new Nn((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(a=r==null?void 0:r.heartbeatPeriod)!=null?a:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class zn extends kt{constructor(r="",l="",o=!1){super();$(this,"serviceName");$(this,"authority");$(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(o)}static fromJson(r={}){var l,o;return new zn((l=r==null?void 0:r.serviceName)!=null?l:"",(o=r==null?void 0:r.authority)!=null?o:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class es extends kt{constructor(r="/",l=""){super();$(this,"path");$(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,o;return new es((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"")}toJson(){return{path:this.path,host:this.host}}}class ts extends kt{constructor(r="/",l="",o="",a=!1,i="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,p,m,g,A,D;super();$(this,"path");$(this,"host");$(this,"mode");$(this,"noGRPCHeader");$(this,"scMinPostsIntervalMs");$(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=o!=null?o:"",this.noGRPCHeader=Boolean(a),this.scMinPostsIntervalMs=i!=null?i:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(m=c==null?void 0:c.cMaxReuseTimes)!=null?m:0,hMaxRequestTimes:(g=c==null?void 0:c.hMaxRequestTimes)!=null?g:"600-900",hMaxReusableSecs:(A=c==null?void 0:c.hMaxReusableSecs)!=null?A:"1800-3000",hKeepAlivePeriod:(D=c==null?void 0:c.hKeepAlivePeriod)!=null?D:0}}static fromJson(r={}){var l,o,a,i;return new ts((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(a=r==null?void 0:r.mode)!=null?a:"",Boolean(r==null?void 0:r.noGRPCHeader),(i=r==null?void 0:r.scMinPostsIntervalMs)!=null?i:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class Rn extends kt{constructor(r="",l=[],o="",a=!1,i=""){super();$(this,"serverName");$(this,"alpn");$(this,"fingerprint");$(this,"allowInsecure");$(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=o!=null?o:"",this.allowInsecure=Boolean(a),this.echConfigList=i!=null?i:""}static fromJson(r={}){var l,o,a;return new Rn((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(o=r==null?void 0:r.fingerprint)!=null?o:"",Boolean(r==null?void 0:r.allowInsecure),(a=r==null?void 0:r.echConfigList)!=null?a:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class rs extends kt{constructor(r="",l="",o="",a="",i="",c=""){super();$(this,"publicKey");$(this,"fingerprint");$(this,"serverName");$(this,"shortId");$(this,"spiderX");$(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=o!=null?o:"",this.shortId=a!=null?a:"",this.spiderX=i!=null?i:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var l,o,a,i,c,u;return new rs((l=r==null?void 0:r.publicKey)!=null?l:"",(o=r==null?void 0:r.fingerprint)!=null?o:"",(a=r==null?void 0:r.serverName)!=null?a:"",(i=r==null?void 0:r.shortId)!=null?i:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class zs extends kt{constructor(r="",l=!1,o=0,a=!1,i=!1,c=Fi.NONE){super();$(this,"dialerProxy");$(this,"tcpFastOpen");$(this,"tcpKeepAliveInterval");$(this,"tcpMptcp");$(this,"penetrate");$(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=o!=null?o:0,this.tcpMptcp=Boolean(a),this.penetrate=Boolean(i),this.addressPortStrategy=c!=null?c:Fi.NONE}static fromJson(r={}){var l,o,a;return!r||Object.keys(r).length===0?new zs:new zs((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(o=r==null?void 0:r.tcpKeepAliveInterval)!=null?o:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(a=r==null?void 0:r.addressPortStrategy)!=null?a:Fi.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class fn extends kt{constructor(r="tcp",l="none",o=new Rn,a=new rs,i=new cn,c=new jn,u=new Nn,p=new zn,m=new es,g=new ts,A){super();$(this,"network");$(this,"security");$(this,"tls");$(this,"reality");$(this,"tcp");$(this,"kcp");$(this,"ws");$(this,"grpc");$(this,"httpupgrade");$(this,"xhttp");$(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=o,this.reality=a,this.tcp=i,this.kcp=c,this.ws=u,this.grpc=p,this.httpupgrade=m,this.xhttp=g,this.sockopt=A}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new zs:void 0}static fromJson(r={}){var l,o;return new fn((l=r==null?void 0:r.network)!=null?l:"tcp",(o=r==null?void 0:r.security)!=null?o:"none",Rn.fromJson(r==null?void 0:r.tlsSettings),rs.fromJson(r==null?void 0:r.realitySettings),cn.fromJson(r==null?void 0:r.tcpSettings),jn.fromJson(r==null?void 0:r.kcpSettings),Nn.fromJson(r==null?void 0:r.wsSettings),zn.fromJson(r==null?void 0:r.grpcSettings),es.fromJson(r==null?void 0:r.httpupgradeSettings),ts.fromJson(r==null?void 0:r.xhttpSettings),zs.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class Rs extends kt{constructor(r=!1,l=8,o=16,a="reject"){super();$(this,"enabled");$(this,"concurrency");$(this,"xudpConcurrency");$(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=o!=null?o:16,this.xudpProxyUDP443=a!=null?a:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new Rs:new Rs(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var on,Hr;const Qe=class extends kt{constructor(r="",l=se.VLESS,o=Qe.Settings.getSettings(se.VLESS),a=new fn,i,c=new Rs){super();$(this,"tag");$(this,"_protocol");$(this,"settings");$(this,"stream");$(this,"sendThrough");$(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:se.VLESS,this.settings=o!=null?o:Qe.Settings.getSettings(this._protocol),this.stream=a,this.sendThrough=i,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=Qe.Settings.getSettings(r),this.stream=new fn}canEnableTls(){return[se.VMess,se.VLESS,se.Trojan,se.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===se.VLESS:!1}canEnableReality(){return[se.VLESS,se.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[se.VMess,se.VLESS,se.Trojan,se.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[se.VMess,se.VLESS,se.Trojan,se.Shadowsocks,se.HTTP,se.Socks].includes(this.protocol)}hasVnext(){return[se.VMess,se.VLESS].includes(this.protocol)}hasServers(){return[se.Trojan,se.Shadowsocks,se.Socks,se.HTTP].includes(this.protocol)}hasAddressPort(){return[se.DNS,se.VMess,se.VLESS,se.Trojan,se.Shadowsocks,se.Socks,se.HTTP].includes(this.protocol)}hasUsername(){return[se.Socks,se.HTTP].includes(this.protocol)}static fromJson(r={}){var l,o,a,i;return new Qe((l=r==null?void 0:r.tag)!=null?l:"",(o=r==null?void 0:r.protocol)!=null?o:se.VLESS,Qe.Settings.fromProtocol((a=r==null?void 0:r.protocol)!=null?a:se.VLESS,r==null?void 0:r.settings),fn.fromJson(r==null?void 0:r.streamSettings),(i=r==null?void 0:r.sendThrough)!=null?i:"",Rs.fromJson(r==null?void 0:r.mux))}toJson(){var l,o;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof kt?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(o=this.mux)!=null&&o.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const o=l[0].toLowerCase();try{switch(o){case se.VMess:return Qe.fromVmessLink(JSON.parse(ro(l[1])));case se.VLESS:case se.Trojan:case"ss":return Qe.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var i,c,u,p,m,g,A,D,k,x,v,C,R,ie,b,M,I,W,ve,Z,te,z,j;if(!r)return null;const l=new fn((i=r==null?void 0:r.net)!=null?i:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),o=r==null?void 0:r.net;o==="tcp"?l.tcp=new cn((u=r==null?void 0:r.type)!=null?u:"none",(p=r==null?void 0:r.host)!=null?p:"",(m=r==null?void 0:r.path)!=null?m:""):o==="kcp"?(l.kcp=new jn,l.kcp.type=(g=r==null?void 0:r.type)!=null?g:"none",l.kcp.seed=(A=r==null?void 0:r.path)!=null?A:""):o==="ws"?l.ws=new Nn((D=r==null?void 0:r.path)!=null?D:"/",(k=r==null?void 0:r.host)!=null?k:""):o==="grpc"?l.grpc=new zn((x=r==null?void 0:r.path)!=null?x:"",(v=r==null?void 0:r.authority)!=null?v:"",(r==null?void 0:r.type)==="multi"):o==="httpupgrade"?l.httpupgrade=new es((C=r==null?void 0:r.path)!=null?C:"/",(R=r==null?void 0:r.host)!=null?R:""):o==="xhttp"&&(l.xhttp=new ts((ie=r==null?void 0:r.path)!=null?ie:"/",(b=r==null?void 0:r.host)!=null?b:"",(M=r==null?void 0:r.mode)!=null?M:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new Rn((I=r==null?void 0:r.sni)!=null?I:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(W=r==null?void 0:r.fp)!=null?W:"",Boolean(r==null?void 0:r.allowInsecure)));const a=Number((ve=r==null?void 0:r.port)!=null?ve:0);return Number.isNaN(a)?null:new Qe((Z=r==null?void 0:r.ps)!=null?Z:"",se.VMess,new Qe.VmessSettings((te=r==null?void 0:r.add)!=null?te:"",a,(z=r==null?void 0:r.id)!=null?z:"",(j=r==null?void 0:r.scy)!=null?j:""),l)}static fromParamLink(r){var M,I,W,ve,Z,te,z,j,pe,Y,Q,P,me,Ie,De,L,y,E,ae,re,Ce;let l;try{l=new URL(r)}catch{return null}const o=(M=l.searchParams.get("type"))!=null?M:"tcp",a=(I=l.searchParams.get("security"))!=null?I:"none",i=new fn(o,a),c=(W=l.searchParams.get("headerType"))!=null?W:void 0,u=(ve=l.searchParams.get("host"))!=null?ve:void 0,p=(Z=l.searchParams.get("path"))!=null?Z:void 0,m=(te=l.searchParams.get("mode"))!=null?te:void 0;if(o==="tcp"||o==="none"?i.tcp=new cn(c!=null?c:"none",u!=null?u:"",p!=null?p:""):o==="kcp"?(i.kcp=new jn,i.kcp.type=c!=null?c:"none",i.kcp.seed=p!=null?p:""):o==="ws"?i.ws=new Nn(p!=null?p:"/",u!=null?u:""):o==="grpc"?i.grpc=new zn((z=l.searchParams.get("serviceName"))!=null?z:"",(j=l.searchParams.get("authority"))!=null?j:"",l.searchParams.get("mode")==="multi"):o==="httpupgrade"?i.httpupgrade=new es(p!=null?p:"/",u!=null?u:""):o==="xhttp"&&(i.xhttp=new ts(p!=null?p:"/",u!=null?u:"",m!=null?m:"")),a==="tls"){const Te=(pe=l.searchParams.get("fp"))!=null?pe:"none",Re=l.searchParams.get("alpn"),Me=l.searchParams.get("allowInsecure"),H=(Y=l.searchParams.get("sni"))!=null?Y:"",B=(Q=l.searchParams.get("ech"))!=null?Q:"";i.tls=new Rn(H,Re?Re.split(","):[],Te,Me==="1",B)}if(a==="reality"){const Te=(P=l.searchParams.get("pbk"))!=null?P:"",Re=(me=l.searchParams.get("fp"))!=null?me:"",Me=(Ie=l.searchParams.get("sni"))!=null?Ie:"",H=(De=l.searchParams.get("sid"))!=null?De:"",B=(L=l.searchParams.get("spx"))!=null?L:"",O=(y=l.searchParams.get("pqv"))!=null?y:"";i.reality=new rs(Te,Re,Me,H,B,O)}const g=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,A=r.match(g);if(!A)return null;let[,D,k,x,v]=A,C=Number(v);Number.isNaN(C)&&(C=0),D==="ss"&&(D=se.Shadowsocks,k=ro(k));let R=null;switch(D){case se.VLESS:{const Te=(E=l.searchParams.get("encryption"))!=null?E:"none";R=new Qe.VLESSSettings(x,C,k,(ae=l.searchParams.get("flow"))!=null?ae:"",Te);break}case se.Trojan:R=new Qe.TrojanSettings(x,C,k);break;case se.Shadowsocks:{const Te=k.split(":"),Re=(re=Te.shift())!=null?re:"";R=new Qe.ShadowsocksSettings(x,C,Te.join(":"),Re,!0);break}default:return null}const ie=decodeURIComponent((Ce=l.hash)!=null?Ce:""),b=ie.length>1?ie.substring(1):`out-${D}-${C}`;return new Qe(b,D,R,i)}};let qt=Qe;$(qt,"Settings",class extends kt{constructor(o){super();$(this,"protocol");this.protocol=o}static getSettings(o){switch(o){case se.Freedom:return new Qe.FreedomSettings;case se.Blackhole:return new Qe.BlackholeSettings;case se.DNS:return new Qe.DNSSettings;case se.VMess:return new Qe.VmessSettings;case se.VLESS:return new Qe.VLESSSettings;case se.Trojan:return new Qe.TrojanSettings;case se.Shadowsocks:return new Qe.ShadowsocksSettings;case se.Socks:return new Qe.SocksSettings;case se.HTTP:return new Qe.HttpSettings;case se.Wireguard:return new Qe.WireguardSettings;default:return null}}static fromProtocol(o,a){switch(o){case se.Freedom:return Qe.FreedomSettings.fromJson(a);case se.Blackhole:return Qe.BlackholeSettings.fromJson(a);case se.DNS:return Qe.DNSSettings.fromJson(a);case se.VMess:return Qe.VmessSettings.fromJson(a);case se.VLESS:return Qe.VLESSSettings.fromJson(a);case se.Trojan:return Qe.TrojanSettings.fromJson(a);case se.Shadowsocks:return Qe.ShadowsocksSettings.fromJson(a);case se.Socks:return Qe.SocksSettings.fromJson(a);case se.HTTP:return Qe.HttpSettings.fromJson(a);case se.Wireguard:return Qe.WireguardSettings.fromJson(a);default:return null}}toJson(){return{}}}),$(qt,"FreedomSettings",(on=class extends kt{constructor(o="",a="",i={},c=[]){super();$(this,"domainStrategy");$(this,"redirect");$(this,"fragment");$(this,"noises");this.domainStrategy=o!=null?o:"",this.redirect=a!=null?a:"",this.fragment=i!=null?i:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new Qe.FreedomSettings.Noise)}delNoise(o){this.noises.splice(o,1)}static fromJson(o={}){var a,i;return new on((a=o==null?void 0:o.domainStrategy)!=null?a:"",(i=o==null?void 0:o.redirect)!=null?i:"",o!=null&&o.fragment?on.Fragment.fromJson(o.fragment):{},Array.isArray(o==null?void 0:o.noises)?o.noises.map(c=>on.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:vr.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:vr.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:kt.toJsonArray(this.noises)}}},$(on,"Fragment",class Cl extends kt{constructor(i="1-3",c="",u="",p=""){super();$(this,"packets");$(this,"length");$(this,"interval");$(this,"maxSplit");this.packets=i!=null?i:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=p!=null?p:""}static fromJson(i={}){var c,u,p,m;return new Cl((c=i==null?void 0:i.packets)!=null?c:"1-3",(u=i==null?void 0:i.length)!=null?u:"",(p=i==null?void 0:i.interval)!=null?p:"",(m=i==null?void 0:i.maxSplit)!=null?m:"")}}),$(on,"Noise",class _l extends kt{constructor(i="rand",c="10-20",u="10-16",p="ip"){super();$(this,"type");$(this,"packet");$(this,"delay");$(this,"applyTo");this.type=i!=null?i:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(i={}){var c,u,p,m;return new _l((c=i==null?void 0:i.type)!=null?c:"rand",(u=i==null?void 0:i.packet)!=null?u:"10-20",(p=i==null?void 0:i.delay)!=null?p:"10-16",(m=i==null?void 0:i.applyTo)!=null?m:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),on)),$(qt,"BlackholeSettings",class Dl extends kt{constructor(o){super();$(this,"type");this.type=o}static fromJson(o={}){var a;return new Dl((a=o==null?void 0:o.response)==null?void 0:a.type)}toJson(){return{response:vr.isEmpty(this.type)?void 0:{type:this.type}}}}),$(qt,"DNSSettings",class Al extends kt{constructor(o="udp",a="",i=53,c="reject",u=[]){super();$(this,"network");$(this,"address");$(this,"port");$(this,"nonIPQuery");$(this,"blockTypes");this.network=o!=null?o:"udp",this.address=a!=null?a:"",this.port=i!=null?i:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(o={}){var a,i,c,u;return new Al((a=o==null?void 0:o.network)!=null?a:"udp",(i=o==null?void 0:o.address)!=null?i:"",(c=o==null?void 0:o.port)!=null?c:53,(u=o==null?void 0:o.nonIPQuery)!=null?u:"reject",Array.isArray(o==null?void 0:o.blockTypes)?o.blockTypes:[])}}),$(qt,"VmessSettings",class extends kt{constructor(o="",a=0,i="",c=""){super();$(this,"address");$(this,"port");$(this,"id");$(this,"security");this.address=o!=null?o:"",this.port=a!=null?a:0,this.id=i!=null?i:"",this.security=c!=null?c:""}static fromJson(o={}){var c,u,p,m;if(vr.isArrEmpty(o==null?void 0:o.vnext))return new Qe.VmessSettings;const a=o.vnext[0],i=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Qe.VmessSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=i==null?void 0:i.id)!=null?p:"",(m=i==null?void 0:i.security)!=null?m:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),$(qt,"VLESSSettings",class extends kt{constructor(o="",a=0,i="",c="",u=""){super();$(this,"address");$(this,"port");$(this,"id");$(this,"flow");$(this,"encryption");this.address=o!=null?o:"",this.port=a!=null?a:0,this.id=i!=null?i:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(o={}){var c,u,p,m,g;if(vr.isArrEmpty(o==null?void 0:o.vnext))return new Qe.VLESSSettings;const a=o.vnext[0],i=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Qe.VLESSSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=i==null?void 0:i.id)!=null?p:"",(m=i==null?void 0:i.flow)!=null?m:"",(g=i==null?void 0:i.encryption)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),$(qt,"TrojanSettings",class extends kt{constructor(o="",a=0,i=""){super();$(this,"address");$(this,"port");$(this,"password");this.address=o!=null?o:"",this.port=a!=null?a:0,this.password=i!=null?i:""}static fromJson(o={}){var i,c,u;if(vr.isArrEmpty(o==null?void 0:o.servers))return new Qe.TrojanSettings;const a=o.servers[0];return new Qe.TrojanSettings((i=a==null?void 0:a.address)!=null?i:"",(c=a==null?void 0:a.port)!=null?c:0,(u=a==null?void 0:a.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),$(qt,"ShadowsocksSettings",class extends kt{constructor(o="",a=0,i="",c="",u,p){super();$(this,"address");$(this,"port");$(this,"password");$(this,"method");$(this,"uot");$(this,"UoTVersion");this.address=o!=null?o:"",this.port=a!=null?a:0,this.password=i!=null?i:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=p}static fromJson(o={}){var c,u,p,m;let a=o==null?void 0:o.servers;vr.isArrEmpty(a)&&(a=[{}]);const i=a[0];return new Qe.ShadowsocksSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=i==null?void 0:i.password)!=null?p:"",(m=i==null?void 0:i.method)!=null?m:"",i==null?void 0:i.uot,i==null?void 0:i.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),$(qt,"SocksSettings",class extends kt{constructor(o="",a=0,i="",c=""){super();$(this,"address");$(this,"port");$(this,"user");$(this,"pass");this.address=o!=null?o:"",this.port=a!=null?a:0,this.user=i!=null?i:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,m,g;let a=o==null?void 0:o.servers;vr.isArrEmpty(a)&&(a=[{users:[{}]}]);const i=a[0],c=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Qe.SocksSettings((u=i==null?void 0:i.address)!=null?u:"",(p=i==null?void 0:i.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:vr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),$(qt,"HttpSettings",class extends kt{constructor(o="",a=0,i="",c=""){super();$(this,"address");$(this,"port");$(this,"user");$(this,"pass");this.address=o!=null?o:"",this.port=a!=null?a:0,this.user=i!=null?i:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,m,g;let a=o==null?void 0:o.servers;vr.isArrEmpty(a)&&(a=[{users:[{}]}]);const i=a[0],c=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Qe.HttpSettings((u=i==null?void 0:i.address)!=null?u:"",(p=i==null?void 0:i.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:vr.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),$(qt,"WireguardSettings",(Hr=class extends kt{constructor(o=1420,a="",i=[""],c=2,u="",p="",m=[new Hr.Peer],g=!1){super();$(this,"mtu");$(this,"secretKey");$(this,"pubKey");$(this,"address");$(this,"workers");$(this,"domainStrategy");$(this,"reserved");$(this,"peers");$(this,"noKernelTun");this.mtu=o!=null?o:1420,this.secretKey=a!=null?a:"",this.pubKey=this.secretKey.length>0?Ih(this.secretKey):"",this.address=Array.isArray(i)?i.join(","):i!=null?i:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=m!=null?m:[new Hr.Peer],this.noKernelTun=Boolean(g)}addPeer(){this.peers.push(new Hr.Peer)}delPeer(o){this.peers.splice(o,1)}static fromJson(o={}){var a,i,c,u,p,m,g;return new Hr((a=o==null?void 0:o.mtu)!=null?a:1420,(i=o==null?void 0:o.secretKey)!=null?i:"",(c=o==null?void 0:o.address)!=null?c:[""],(u=o==null?void 0:o.workers)!=null?u:2,(p=o==null?void 0:o.domainStrategy)!=null?p:"",(m=o==null?void 0:o.reserved)!=null?m:"",Array.isArray(o==null?void 0:o.peers)?o.peers.map(A=>Hr.Peer.fromJson(A)):[new Hr.Peer],(g=o==null?void 0:o.noKernelTun)!=null?g:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:Eh.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(o=>Number(o)).filter(o=>!Number.isNaN(o)):void 0,peers:kt.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},$(Hr,"Peer",class extends kt{constructor(i="",c="",u=["0.0.0.0/0","::/0"],p="",m=0){super();$(this,"publicKey");$(this,"psk");$(this,"allowedIPs");$(this,"endpoint");$(this,"keepAlive");this.publicKey=i!=null?i:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=m!=null?m:0}static fromJson(i={}){var c,u,p,m;return new Qe.WireguardSettings.Peer((c=i==null?void 0:i.publicKey)!=null?c:"",(u=i==null?void 0:i.preSharedKey)!=null?u:"",Array.isArray(i==null?void 0:i.allowedIPs)?i.allowedIPs:["0.0.0.0/0","::/0"],(p=i==null?void 0:i.endpoint)!=null?p:"",(m=i==null?void 0:i.keepAlive)!=null?m:0)}toJson(){var i;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(i=this.allowedIPs)!=null&&i.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),Hr));class _n{static sizeFormat(s){if(s<=0||Number.isNaN(s))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,o=s;for(;o>=1024&&l<r.length-1;)o/=1024,l++;return`${o.toFixed(2)} ${r[l]}`}}const Nh=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(Th);const zh=Object.values(Ph),ya=["vmess","vless","trojan","shadowsocks","http","socks"],Rh=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp","xhttp"],Uh=["none","tls","reality"],Hi=t=>t.split(/[\n,]/).map(s=>s.trim()).filter(Boolean),Bi=t=>t&&t.length?t.join(`
`):"",Hn=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",Il=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),Lh=t=>{if(!t)return 0;const s=Number(t);return!Number.isNaN(s)&&s>0?s:t.trim()},yr=t=>(Object.keys(t).forEach(s=>{const r=t[s];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[s]}),t),no=()=>({user:"",pass:""}),ta=()=>({name:"",value:""}),so=t=>{var s,r;return{user:(s=t==null?void 0:t.user)!=null?s:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},io=t=>{var s,r;return yr({user:(s=t.user)==null?void 0:s.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},vn=t=>{if(t===""||t===null||typeof t>"u")return;const s=Number(t);return Number.isFinite(s)?s:void 0},Mh=t=>{if(!t.sockoptEnabled)return;const s=t.sockopt,r={acceptProxyProtocol:s.acceptProxyProtocol,tcpFastOpen:s.tcpFastOpen,mark:vn(s.mark),tproxy:s.tproxy||void 0,tcpMptcp:s.tcpMptcp,penetrate:s.penetrate,domainStrategy:s.domainStrategy||void 0,tcpMaxSeg:vn(s.tcpMaxSeg),dialerProxy:s.dialerProxy||void 0,tcpKeepAliveInterval:vn(s.tcpKeepAliveInterval),tcpKeepAliveIdle:vn(s.tcpKeepAliveIdle),tcpUserTimeout:vn(s.tcpUserTimeout),tcpcongestion:s.tcpcongestion||void 0,V6Only:s.V6Only,tcpWindowClamp:vn(s.tcpWindowClamp),interface:s.interfaceName||void 0};return yr(r)},ra=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",xhttpHost:"",xhttpPath:"/",xhttpHeaders:[ta()],xhttpMode:"auto",xhttpScMaxBufferedPosts:"30",xhttpScMaxEachPostBytes:"1000000",xhttpScStreamUpServerSecs:"20-80",xhttpPaddingBytes:"100-1000",xhttpNoSSEHeader:!1,vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:Il(),httpAccounts:[no()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[no()],socksUdpEnabled:!1,socksUdpIp:""}),Oh=t=>{var s,r,l,o,a,i,c;return{dest:(r=(s=t==null?void 0:t.dest)==null?void 0:s.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(o=t==null?void 0:t.type)!=null?o:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(a=t==null?void 0:t.alpn)!=null?a:"",xver:(c=(i=t==null?void 0:t.xver)==null?void 0:i.toString())!=null?c:""}},ao=t=>{var r,l,o;const s={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(o=t.type)==null?void 0:o.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(s.alpn=t.alpn.split(",").map(a=>a.trim()).filter(Boolean)),yr(s)},Wh=t=>{var u,p,m,g,A,D,k,x,v,C,R,ie,b,M,I,W,ve,Z,te,z,j,pe,Y,Q,P,me,Ie,De,L,y,E,ae,re,Ce,Te,Re,Me,H,B,O,de,ze,it,he,ce,oe,V,ye,ht,ft,q,F,Se,Ue,We,Be,le,ge,Oe,Ae,lt,pt,Ge,$t,dr,rr,ur,nr,Qt,sr,ir,Xt,ar,J,be,G,N,we,Ee,Fe,Xe,bt,ct,Pt,Mt,Zt,jt,Er;const s=ya.includes(t.protocol)?t.protocol:"vless",r=ra(s),l=(u=t.settings)!=null?u:{},o=(p=t.sniffing)!=null?p:{},a=(m=t.streamSettings)!=null?m:{},i=(g=a.tlsSettings)!=null?g:{},c=(A=a.realitySettings)!=null?A:{};return{...r,tag:(D=t.tag)!=null?D:"",listen:(k=t.listen)!=null?k:"",port:(v=(x=t.port)==null?void 0:x.toString())!=null?v:"",disableInsecureEncryption:Boolean((C=l.disableInsecureEncryption)!=null?C:r.disableInsecureEncryption),vlessDecryption:(R=l.decryption)!=null?R:r.vlessDecryption,vlessEncryption:(ie=l.encryption)!=null?ie:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map(Ve=>Oh(Ve)):r.fallbacks,shadowsocksNetwork:(b=l.network)!=null?b:r.shadowsocksNetwork,sniffingEnabled:Boolean((M=o.enabled)!=null?M:r.sniffingEnabled),sniffingDestinations:Array.isArray(o.destOverride)&&o.destOverride.length?o.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((I=o.routeOnly)!=null?I:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((W=o.metadataOnly)!=null?W:r.sniffingMetadataOnly),streamNetwork:(ve=a.network)!=null?ve:r.streamNetwork,streamSecurity:(Z=a.security)!=null?Z:r.streamSecurity,tlsServerName:(te=i.serverName)!=null?te:r.tlsServerName,tlsAlpn:Array.isArray(i.alpn)?i.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((z=i.allowInsecure)!=null?z:r.tlsAllowInsecure),tlsFingerprint:(j=i.fingerprint)!=null?j:r.tlsFingerprint,realityPrivateKey:(pe=c.privateKey)!=null?pe:r.realityPrivateKey,realityServerNames:Bi(c.serverNames),realityShortIds:Bi(c.shortIds),realityDest:(Y=c.dest)!=null?Y:r.realityDest,realitySpiderX:(Q=c.spiderX)!=null?Q:r.realitySpiderX,realityXver:(me=(P=c.xver)==null?void 0:P.toString())!=null?me:r.realityXver,wsPath:(De=(Ie=a==null?void 0:a.wsSettings)==null?void 0:Ie.path)!=null?De:r.wsPath,wsHost:(E=(y=(L=a==null?void 0:a.wsSettings)==null?void 0:L.headers)==null?void 0:y.Host)!=null?E:r.wsHost,tcpHeaderType:(Ce=(re=(ae=a==null?void 0:a.tcpSettings)==null?void 0:ae.header)==null?void 0:re.type)!=null?Ce:r.tcpHeaderType,tcpHttpHosts:Bi((H=(Me=(Re=(Te=a==null?void 0:a.tcpSettings)==null?void 0:Te.header)==null?void 0:Re.request)==null?void 0:Me.headers)==null?void 0:H.Host),tcpHttpPath:Array.isArray((de=(O=(B=a==null?void 0:a.tcpSettings)==null?void 0:B.header)==null?void 0:O.request)==null?void 0:de.path)?a.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(it=(ze=a==null?void 0:a.grpcSettings)==null?void 0:ze.serviceName)!=null?it:r.grpcServiceName,grpcAuthority:(ce=(he=a==null?void 0:a.grpcSettings)==null?void 0:he.authority)!=null?ce:r.grpcAuthority,grpcMultiMode:Boolean((V=(oe=a==null?void 0:a.grpcSettings)==null?void 0:oe.multiMode)!=null?V:r.grpcMultiMode),kcpHeaderType:(ft=(ht=(ye=a==null?void 0:a.kcpSettings)==null?void 0:ye.header)==null?void 0:ht.type)!=null?ft:r.kcpHeaderType,kcpSeed:(F=(q=a==null?void 0:a.kcpSettings)==null?void 0:q.seed)!=null?F:r.kcpSeed,quicSecurity:(Ue=(Se=a==null?void 0:a.quicSettings)==null?void 0:Se.security)!=null?Ue:r.quicSecurity,quicKey:(Be=(We=a==null?void 0:a.quicSettings)==null?void 0:We.key)!=null?Be:r.quicKey,quicHeaderType:(Oe=(ge=(le=a==null?void 0:a.quicSettings)==null?void 0:le.header)==null?void 0:ge.type)!=null?Oe:r.quicHeaderType,httpupgradePath:(lt=(Ae=a==null?void 0:a.httpupgradeSettings)==null?void 0:Ae.path)!=null?lt:r.httpupgradePath,httpupgradeHost:(Ge=(pt=a==null?void 0:a.httpupgradeSettings)==null?void 0:pt.host)!=null?Ge:r.httpupgradeHost,splithttpPath:(dr=($t=a==null?void 0:a.splithttpSettings)==null?void 0:$t.path)!=null?dr:r.splithttpPath,splithttpHost:(ur=(rr=a==null?void 0:a.splithttpSettings)==null?void 0:rr.host)!=null?ur:r.splithttpHost,xhttpHost:(Qt=(nr=a==null?void 0:a.xhttpSettings)==null?void 0:nr.host)!=null?Qt:r.xhttpHost,xhttpPath:(ir=(sr=a==null?void 0:a.xhttpSettings)==null?void 0:sr.path)!=null?ir:r.xhttpPath,xhttpHeaders:(Xt=a==null?void 0:a.xhttpSettings)!=null&&Xt.headers?Vh(a.xhttpSettings.headers):r.xhttpHeaders,xhttpMode:(J=(ar=a==null?void 0:a.xhttpSettings)==null?void 0:ar.mode)!=null?J:r.xhttpMode,xhttpScMaxBufferedPosts:(N=(G=(be=a==null?void 0:a.xhttpSettings)==null?void 0:be.scMaxBufferedPosts)==null?void 0:G.toString())!=null?N:r.xhttpScMaxBufferedPosts,xhttpScMaxEachPostBytes:(Fe=(Ee=(we=a==null?void 0:a.xhttpSettings)==null?void 0:we.scMaxEachPostBytes)==null?void 0:Ee.toString())!=null?Fe:r.xhttpScMaxEachPostBytes,xhttpScStreamUpServerSecs:(ct=(bt=(Xe=a==null?void 0:a.xhttpSettings)==null?void 0:Xe.scStreamUpServerSecs)==null?void 0:bt.toString())!=null?ct:r.xhttpScStreamUpServerSecs,xhttpPaddingBytes:(Mt=(Pt=a==null?void 0:a.xhttpSettings)==null?void 0:Pt.xPaddingBytes)!=null?Mt:r.xhttpPaddingBytes,xhttpNoSSEHeader:Boolean((jt=(Zt=a==null?void 0:a.xhttpSettings)==null?void 0:Zt.noSSEHeader)!=null?jt:r.xhttpNoSSEHeader),vlessSelectedAuth:(Er=l.selectedAuth)!=null?Er:r.vlessSelectedAuth,sockoptEnabled:Boolean(a==null?void 0:a.sockopt),sockopt:(()=>{var Nr,Or,hr,or,Kt,zr;const Ve=Il(),St=(Nr=a==null?void 0:a.sockopt)!=null?Nr:{};return Ve.acceptProxyProtocol=Boolean(St.acceptProxyProtocol),Ve.tcpFastOpen=Boolean(St.tcpFastOpen),Ve.mark=Hn(St.mark),Ve.tproxy=(Or=St.tproxy)!=null?Or:Ve.tproxy,Ve.tcpMptcp=Boolean(St.tcpMptcp),Ve.penetrate=Boolean(St.penetrate),Ve.domainStrategy=(hr=St.domainStrategy)!=null?hr:Ve.domainStrategy,Ve.tcpMaxSeg=Hn(St.tcpMaxSeg),Ve.dialerProxy=(or=St.dialerProxy)!=null?or:Ve.dialerProxy,Ve.tcpKeepAliveInterval=Hn(St.tcpKeepAliveInterval),Ve.tcpKeepAliveIdle=Hn(St.tcpKeepAliveIdle),Ve.tcpUserTimeout=Hn(St.tcpUserTimeout),Ve.tcpcongestion=(Kt=St.tcpcongestion)!=null?Kt:Ve.tcpcongestion,Ve.V6Only=Boolean(St.V6Only),Ve.tcpWindowClamp=Hn(St.tcpWindowClamp),Ve.interfaceName=(zr=St.interface)!=null?zr:Ve.interfaceName,Ve})(),httpAccounts:s==="http"&&Array.isArray(l.accounts)?l.accounts.map(Ve=>so(Ve)):r.httpAccounts,httpAllowTransparent:s==="http"&&typeof l.allowTransparent=="boolean"?l.allowTransparent:r.httpAllowTransparent,socksAuth:s==="socks"&&l.auth==="password"?"password":r.socksAuth,socksAccounts:s==="socks"&&Array.isArray(l.accounts)?l.accounts.map(Ve=>so(Ve)):r.socksAccounts,socksUdpEnabled:s==="socks"&&typeof l.udp=="boolean"?l.udp:r.socksUdpEnabled,socksUdpIp:s==="socks"&&l.ip!==void 0&&l.ip!==null?String(l.ip):r.socksUdpIp}},Fh=t=>{var l,o,a,i;const s={network:t.streamNetwork,security:t.streamSecurity};t.streamNetwork==="ws"&&(s.wsSettings=yr({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?s.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:Hi(t.tcpHttpHosts)}:{}}}}:s.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(s.grpcSettings=yr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(s.kcpSettings=yr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(s.quicSettings=yr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(s.httpupgradeSettings=yr({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(s.splithttpSettings=yr({path:t.splithttpPath,host:t.splithttpHost})),t.streamNetwork==="xhttp"&&(s.xhttpSettings=yr({path:t.xhttpPath,host:t.xhttpHost,headers:$h(t.xhttpHeaders),mode:t.xhttpMode,scMaxBufferedPosts:vn(t.xhttpScMaxBufferedPosts),scMaxEachPostBytes:((l=t.xhttpScMaxEachPostBytes)==null?void 0:l.trim())||void 0,scStreamUpServerSecs:((o=t.xhttpScStreamUpServerSecs)==null?void 0:o.trim())||void 0,xPaddingBytes:((a=t.xhttpPaddingBytes)==null?void 0:a.trim())||void 0,noSSEHeader:t.xhttpNoSSEHeader||void 0})),t.streamSecurity==="tls"&&(s.tlsSettings=yr({serverName:t.tlsServerName||void 0,alpn:(i=t.tlsAlpn)!=null&&i.length?t.tlsAlpn:void 0,allowInsecure:t.tlsAllowInsecure||void 0,fingerprint:t.tlsFingerprint||void 0})),t.streamSecurity==="reality"&&(s.realitySettings=yr({privateKey:t.realityPrivateKey||void 0,serverNames:Hi(t.realityServerNames),shortIds:Hi(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=Mh(t);return r&&(s.sockopt=r),yr(s)},Hh=t=>{const s={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(s.clients=[]),t.protocol){case"vmess":s.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":s.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(s.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(s.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(ao).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(ao).filter(r=>Object.keys(r).length));break;case"shadowsocks":s.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(io).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r),t.httpAllowTransparent&&(s.allowTransparent=!0);break}case"socks":{if(s.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(io).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r)}s.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(s.ip=t.socksUdpIp.trim());break}}return s},Bh=t=>{const r=t.protocol!=="http"&&t.protocol!=="socks"?Fh(t):void 0,l={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:Lh(t.port),protocol:t.protocol,settings:Hh(t)};return r&&(l.streamSettings=r),t.sniffingEnabled&&(l.sniffing=yr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly})),l},Vh=t=>{if(!t)return[ta()];const s=[];return Object.entries(t).forEach(([r,l])=>{var o;Array.isArray(l)?l.forEach(a=>{var i;return s.push({name:r,value:(i=a==null?void 0:a.toString())!=null?i:""})}):s.push({name:r,value:(o=l==null?void 0:l.toString())!=null?o:""})}),s.length?s:[ta()]},$h=t=>{const s={};return t.forEach(({name:r,value:l})=>{const o=r==null?void 0:r.trim(),a=l==null?void 0:l.trim();!o||!a||(s[o]=a)}),Object.keys(s).length?s:void 0};class na{static gf(s){const r=new Float64Array(16);if(s)for(let l=0;l<s.length;++l)r[l]=s[l];return r}static pack(s,r){let l;const o=this.gf(),a=this.gf();for(let i=0;i<16;++i)a[i]=r[i];this.carry(a),this.carry(a),this.carry(a);for(let i=0;i<2;++i){o[0]=a[0]-65517;for(let c=1;c<15;++c)o[c]=a[c]-65535-(o[c-1]>>16&1),o[c-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),l=o[15]>>16&1,o[14]&=65535,this.cswap(a,o,1-l)}for(let i=0;i<16;++i)s[2*i]=a[i]&255,s[2*i+1]=a[i]>>8}static carry(s){for(let r=0;r<16;++r)s[(r+1)%16]+=(r<15?1:38)*Math.floor(s[r]/65536),s[r]&=65535}static cswap(s,r,l){const o=~(l-1);for(let a=0;a<16;++a){const i=o&(s[a]^r[a]);s[a]^=i,r[a]^=i}}static add(s,r,l){for(let o=0;o<16;++o)s[o]=r[o]+l[o]|0}static subtract(s,r,l){for(let o=0;o<16;++o)s[o]=r[o]-l[o]|0}static multmod(s,r,l){const o=new Float64Array(31);for(let a=0;a<16;++a)for(let i=0;i<16;++i)o[a+i]+=r[a]*l[i];for(let a=0;a<15;++a)o[a]+=38*o[a+16];for(let a=0;a<16;++a)s[a]=o[a];this.carry(s),this.carry(s)}static invert(s,r){const l=this.gf();for(let o=0;o<16;++o)l[o]=r[o];for(let o=253;o>=0;--o)this.multmod(l,l,l),o!==2&&o!==4&&this.multmod(l,l,r);for(let o=0;o<16;++o)s[o]=l[o]}static clamp(s){s[31]=s[31]&127|64,s[0]&=248}static generatePublicKey(s){let r;const l=new Uint8Array(32),o=this.gf([1]),a=this.gf([9]),i=this.gf(),c=this.gf([1]),u=this.gf(),p=this.gf(),m=this.gf([56129,1]),g=this.gf([9]);for(let A=0;A<32;++A)l[A]=s[A];this.clamp(l);for(let A=254;A>=0;--A)r=l[A>>>3]>>>(A&7)&1,this.cswap(o,a,r),this.cswap(i,c,r),this.add(u,o,i),this.subtract(o,o,i),this.add(i,a,c),this.subtract(a,a,c),this.multmod(c,u,u),this.multmod(p,o,o),this.multmod(o,i,o),this.multmod(i,a,u),this.add(u,o,i),this.subtract(o,o,i),this.multmod(a,o,o),this.subtract(i,c,p),this.multmod(o,i,m),this.add(o,o,c),this.multmod(i,i,o),this.multmod(o,c,p),this.multmod(c,a,g),this.multmod(a,u,u),this.cswap(o,a,r),this.cswap(i,c,r);return this.invert(i,i),this.multmod(o,o,i),this.pack(l,o),l}static generatePresharedKey(){const s=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(s),s}static generatePrivateKey(){const s=this.generatePresharedKey();return this.clamp(s),s}static encodeBase64(s,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let o=0;o<4;++o)s[o]=l[o]+65+(25-l[o]>>8&6)-(51-l[o]>>8&75)-(61-l[o]>>8&15)+(62-l[o]>>8&3)}static keyToBase64(s){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),s.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([s[r*3+0],s[r*3+1],0])),l[43]=61,Array.from(l).map(o=>String.fromCharCode(o)).join("")}static keyFromBase64(s){const r=globalThis.atob(s),l=new Uint8Array(r.length);for(let o=0;o<r.length;o++)l[o]=r.charCodeAt(o);return l}static generateKeypair(s=""){const r=s.length>0?this.keyFromBase64(s):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:s.length>0?s:this.keyToBase64(r)}}}const bi=t=>na.generateKeypair(t!=null?t:""),Kh=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:na.generateKeypair.bind(na)})},Jh=async()=>_e("/xray/vlessenc"),Ze=d.exports.forwardRef((t,s)=>e(xe,{size:"sm",ref:s,...t}));Ze.displayName="InboundFormInput";const Cn=d.exports.forwardRef((t,s)=>e(tt,{size:"sm",ref:s,...t}));Cn.displayName="InboundFormSelect";const Ds=d.exports.forwardRef((t,s)=>e(_r,{size:"sm",resize:"vertical",ref:s,...t}));Ds.displayName="InboundFormTextarea";const oo=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),qh=t=>{const s=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!s)return"";const r=s.length%4;return r===0?s:`${s}${"=".repeat(4-r)}`},Yh=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],Gh=["bbr","cubic","reno"],Qh=["off","redirect","tproxy"],Xh=["auto","packet-up","stream-up","stream-one"],Zh=({isOpen:t,mode:s,initialValue:r,isSubmitting:l,onClose:o,onSubmit:a})=>{var Se,Ue,We,Be;const{t:i}=Je(),c=Ht(),[u,p]=d.exports.useState([]),[m,g]=d.exports.useState(!1),A=Mr({defaultValues:ra()}),{control:D,register:k,handleSubmit:x,reset:v,watch:C}=A,{fields:R,append:ie,remove:b}=Jn({control:D,name:"fallbacks"}),{fields:M,append:I,remove:W}=Jn({control:D,name:"httpAccounts"}),{fields:ve,append:Z,remove:te}=Jn({control:D,name:"socksAccounts"}),{fields:z,append:j,remove:pe}=Jn({control:D,name:"xhttpHeaders"}),Y=Ft({control:D,name:"protocol"})||C("protocol"),Q=Ft({control:D,name:"streamNetwork"})||C("streamNetwork"),P=Ft({control:D,name:"streamSecurity"})||C("streamSecurity"),me=(Se=Ft({control:D,name:"sniffingEnabled"}))!=null?Se:C("sniffingEnabled"),Ie=Ft({control:D,name:"realityPrivateKey"})||C("realityPrivateKey"),De=Ft({control:D,name:"tcpHeaderType"})||C("tcpHeaderType"),L=(Ue=Ft({control:D,name:"sockoptEnabled"}))!=null?Ue:!1,y=Ft({control:D,name:"vlessSelectedAuth"})||"",E=Ft({control:D,name:"socksAuth"})||C("socksAuth")||"noauth",ae=(Be=(We=Ft({control:D,name:"socksUdpEnabled"}))!=null?We:C("socksUdpEnabled"))!=null?Be:!1,re=Ft({control:D,name:"xhttpMode"})||C("xhttpMode")||"auto",Ce=Y!=="http"&&Y!=="socks",Te=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),Re=d.exports.useMemo(()=>{const le=[...Te,...u.map(Oe=>Oe.label)].filter(Boolean);return Array.from(new Set(le)).map(Oe=>({label:Oe,value:Oe}))},[Te,u]);d.exports.useEffect(()=>{if(t)if(r){const le=Wh(r);v(le)}else v(ra())},[r,v,t]);const Me=d.exports.useCallback((le,ge)=>n(w,{children:[e(_,{children:ge}),e(ut,{control:D,name:`sockopt.${le}`,render:({field:Oe})=>{const Ae=typeof Oe.value=="number"||typeof Oe.value=="string"?Oe.value:void 0;return e(Pn,{min:0,value:Ae!=null?Ae:"",onChange:lt=>Oe.onChange(lt),children:e(In,{})})}})]}),[D]),H=d.exports.useCallback((le,ge)=>n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:ge}),e(ut,{control:D,name:`sockopt.${le}`,render:({field:Oe})=>e(dt,{isChecked:typeof Oe.value=="boolean"?Oe.value:Boolean(Oe.value),onChange:Ae=>Oe.onChange(Ae.target.checked)})})]}),[D]),B=d.exports.useCallback((le,ge,Oe)=>n(w,{children:[e(_,{children:ge}),e(Ze,{...k(`sockopt.${le}`),placeholder:Oe})]}),[k]),O=Y==="vless"||Y==="trojan",de=nt("gray.200","gray.700"),ze=async le=>{await a(le)},it=d.exports.useCallback(()=>{try{const{privateKey:le}=bi();A.setValue("realityPrivateKey",oo(le),{shouldDirty:!0})}catch(le){c({status:"error",title:i("inbounds.reality.generateError","Unable to generate key pair"),description:le instanceof Error?le.message:void 0})}},[A,c,i]),he=d.exports.useCallback(()=>{try{const le=typeof window>"u"?void 0:window.crypto;if(!(le!=null&&le.getRandomValues))throw new Error("Crypto API is not available in this environment.");const ge=new Uint8Array(4);le.getRandomValues(ge);const Oe=Array.from(ge).map(pt=>pt.toString(16).padStart(2,"0")).join(""),lt=(A.getValues("realityShortIds")||"").split(/[\s,]+/).map(pt=>pt.trim()).filter(Boolean);lt.push(Oe),A.setValue("realityShortIds",lt.join(`
`),{shouldDirty:!0})}catch(le){c({status:"error",title:i("inbounds.reality.shortIdError","Unable to generate short ID"),description:le instanceof Error?le.message:void 0})}},[A,c,i]),ce=d.exports.useMemo(()=>{const le=qh(Ie);if(!le)return"";try{const{publicKey:ge}=bi(le);return oo(ge)}catch{return""}},[Ie]),oe=()=>ie({dest:"",path:"",type:"",alpn:"",xver:""}),V=d.exports.useCallback(async()=>{var le;g(!0);try{const ge=await Jh(),Oe=(le=ge==null?void 0:ge.auths)!=null?le:[];return p(Oe),Oe}catch(ge){return console.error(ge),c({status:"error",title:i("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{g(!1)}},[c,i]),ye=d.exports.useCallback(async()=>u.length?u:V(),[V,u]),ht=d.exports.useCallback((le,ge)=>{var Ae,lt;const Oe=ge.find(pt=>pt.label===le);if(!Oe){c({status:"warning",title:i("inbounds.vless.authNotFound","Authentication block not available")});return}A.setValue("vlessDecryption",(Ae=Oe.decryption)!=null?Ae:"",{shouldDirty:!0}),A.setValue("vlessEncryption",(lt=Oe.encryption)!=null?lt:"",{shouldDirty:!0})},[A,i,c]),ft=d.exports.useCallback(async le=>{if(!le){A.setValue("vlessDecryption","",{shouldDirty:!0}),A.setValue("vlessEncryption","",{shouldDirty:!0});return}const ge=await ye();ge.length&&ht(le,ge)},[ht,ye,A]),q=d.exports.useCallback(async()=>{const le=A.getValues("vlessSelectedAuth");if(!le){c({status:"info",title:i("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const ge=await V();ge.length&&ht(le,ge)},[ht,V,A,i,c]),F=d.exports.useCallback(()=>{A.setValue("vlessSelectedAuth","",{shouldDirty:!0}),A.setValue("vlessDecryption","",{shouldDirty:!0}),A.setValue("vlessEncryption","",{shouldDirty:!0})},[A]);return d.exports.useEffect(()=>{t&&Y==="vless"&&ye()},[Y,ye,t]),n(Rt,{isOpen:t,onClose:o,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(vt,{}),n(Ut,{maxW:{base:"95vw",md:"4xl"},children:[e(At,{children:s==="create"?i("inbounds.add","Add inbound"):i("inbounds.edit","Edit inbound")}),e(zt,{}),e(Ct,{children:n(ue,{align:"stretch",spacing:6,children:[n(ke,{spacing:4,borderWidth:"1px",borderColor:de,borderRadius:"lg",p:4,children:[n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{isRequired:!0,children:[e(_,{children:i("inbounds.tag","Tag")}),e(Ze,{...k("tag",{required:!0}),isDisabled:s==="edit"})]}),n(w,{children:[e(_,{children:i("inbounds.listen","Listen address")}),e(Ze,{placeholder:"0.0.0.0",...k("listen")})]})]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{isRequired:!0,children:[e(_,{children:i("inbounds.port","Port")}),e(Ze,{placeholder:"443",...k("port",{required:!0})})]}),n(w,{isRequired:!0,children:[e(_,{children:i("inbounds.protocol","Protocol")}),e(Cn,{...k("protocol",{required:!0}),isDisabled:s==="edit",children:ya.map(le=>e("option",{value:le,children:le.toUpperCase()},le))})]})]}),Y==="vmess"&&n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(dt,{...k("disableInsecureEncryption")})]}),Y==="shadowsocks"&&n(w,{children:[e(_,{children:i("inbounds.shadowsocks.network","Allowed networks")}),e(Ze,{...k("shadowsocksNetwork")})]}),Y==="vless"&&n(ke,{spacing:3,children:[e(ut,{control:D,name:"vlessSelectedAuth",render:({field:le})=>n(w,{children:[e(_,{children:i("inbounds.vless.authentication","Authentication")}),n(tt,{placeholder:i("inbounds.vless.authPlaceholder","Select authentication"),value:le.value||"",onChange:async ge=>{const Oe=ge.target.value;le.onChange(Oe),await ft(Oe)},children:[e("option",{value:"",children:i("common.none","None")}),Re.map(ge=>e("option",{value:ge.value,children:ge.label},ge.value))]})]})}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:i("inbounds.vless.decryption","Decryption")}),e(Ze,{...k("vlessDecryption")})]}),n(w,{children:[e(_,{children:i("inbounds.vless.encryption","Encryption")}),e(Ze,{...k("vlessEncryption")})]})]}),n(U,{spacing:3,children:[e(K,{size:"sm",onClick:q,isLoading:m,isDisabled:!y,children:i("inbounds.vless.getKeys","Get new keys")}),e(K,{size:"sm",variant:"ghost",onClick:F,children:i("inbounds.vless.clearKeys","Clear")})]})]}),Y==="http"&&n(ke,{spacing:3,children:[n(ot,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:i("inbounds.http.accounts","HTTP accounts")}),e(K,{size:"xs",onClick:()=>I({user:"",pass:""}),children:i("inbounds.accounts.add","Add account")})]}),n(ke,{spacing:3,children:[M.map((le,ge)=>n(T,{borderWidth:"1px",borderRadius:"md",borderColor:de,p:3,children:[n(ot,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[i("inbounds.accounts.label","Account")," #",ge+1]}),e(K,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>W(ge),children:i("hostsPage.delete","Delete")})]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("username","Username")}),e(Ze,{...k(`httpAccounts.${ge}.user`)})]}),n(w,{children:[e(_,{children:i("password","Password")}),e(Ze,{...k(`httpAccounts.${ge}.pass`)})]})]})]},le.id)),!M.length&&e(h,{fontSize:"sm",color:"gray.500",children:i("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.http.allowTransparent","Allow transparent proxy")}),e(dt,{...k("httpAllowTransparent")})]})]}),Y==="socks"&&n(ke,{spacing:3,children:[n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.socks.udp","Enable UDP")}),e(dt,{...k("socksUdpEnabled")})]}),ae&&n(w,{children:[e(_,{children:i("inbounds.socks.udpIp","UDP bind IP")}),e(Ze,{...k("socksUdpIp"),placeholder:"127.0.0.1"})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.socks.auth","Require authentication")}),e(ut,{control:D,name:"socksAuth",render:({field:le})=>e(dt,{isChecked:le.value==="password",onChange:ge=>le.onChange(ge.target.checked?"password":"noauth")})})]}),E==="password"&&n(ke,{spacing:3,children:[n(ot,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:i("inbounds.socks.accounts","SOCKS accounts")}),e(K,{size:"xs",onClick:()=>Z({user:"",pass:""}),children:i("inbounds.accounts.add","Add account")})]}),ve.map((le,ge)=>n(T,{borderWidth:"1px",borderRadius:"md",borderColor:de,p:3,children:[n(ot,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[i("inbounds.accounts.label","Account")," #",ge+1]}),e(K,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>te(ge),children:i("hostsPage.delete","Delete")})]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("username","Username")}),e(Ze,{...k(`socksAccounts.${ge}.user`)})]}),n(w,{children:[e(_,{children:i("password","Password")}),e(Ze,{...k(`socksAccounts.${ge}.pass`)})]})]})]},le.id)),!ve.length&&e(h,{fontSize:"sm",color:"gray.500",children:i("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),Ce&&n(ke,{spacing:4,borderWidth:"1px",borderColor:de,borderRadius:"lg",p:4,children:[n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:i("inbounds.network","Network")}),e(Cn,{...k("streamNetwork"),children:Rh.map(le=>e("option",{value:le,children:le},le))})]}),n(w,{children:[e(_,{children:i("inbounds.security","Security")}),e(Cn,{...k("streamSecurity"),children:Uh.map(le=>e("option",{value:le,children:le},le))})]})]}),Q==="ws"&&n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:i("inbounds.ws.path","WebSocket path")}),e(Ze,{...k("wsPath"),placeholder:"/ws"})]}),n(w,{children:[e(_,{children:i("inbounds.ws.host","WebSocket host header")}),e(Ze,{...k("wsHost")})]})]}),Q==="tcp"&&n(ke,{spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.tcp.headerType","TCP header type")}),n(Cn,{...k("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),De==="http"&&n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.tcp.host","HTTP host list")}),e(Ds,{...k("tcpHttpHosts"),placeholder:"example.com"})]}),n(w,{children:[e(_,{children:i("inbounds.tcp.path","HTTP path")}),e(Ze,{...k("tcpHttpPath")})]})]})]}),Q==="grpc"&&n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.grpc.serviceName","Service name")}),e(Ze,{...k("grpcServiceName")})]}),n(w,{children:[e(_,{children:i("inbounds.grpc.authority","Authority")}),e(Ze,{...k("grpcAuthority")})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.grpc.multiMode","Multi mode")}),e(dt,{...k("grpcMultiMode")})]})]}),Q==="kcp"&&n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.kcp.headerType","mKCP header")}),e(Ze,{...k("kcpHeaderType")})]}),n(w,{children:[e(_,{children:i("inbounds.kcp.seed","mKCP seed")}),e(Ze,{...k("kcpSeed")})]})]}),Q==="quic"&&n(Ke,{columns:{base:1,md:3},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.quic.security","QUIC security")}),e(Ze,{...k("quicSecurity")})]}),n(w,{children:[e(_,{children:i("inbounds.quic.key","QUIC key")}),e(Ze,{...k("quicKey")})]}),n(w,{children:[e(_,{children:i("inbounds.quic.headerType","QUIC header type")}),e(Ze,{...k("quicHeaderType")})]})]}),Q==="httpupgrade"&&n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.httpUpgrade.path","Path")}),e(Ze,{...k("httpupgradePath")})]}),n(w,{children:[e(_,{children:i("inbounds.httpUpgrade.host","Host")}),e(Ze,{...k("httpupgradeHost")})]})]}),Q==="splithttp"&&n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.splitHttp.path","Path")}),e(Ze,{...k("splithttpPath")})]}),n(w,{children:[e(_,{children:i("inbounds.splitHttp.host","Host")}),e(Ze,{...k("splithttpHost")})]})]}),Q==="xhttp"&&n(ke,{spacing:3,children:[n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.xhttp.host","Host")}),e(Ze,{...k("xhttpHost"),placeholder:"example.com"})]}),n(w,{children:[e(_,{children:i("inbounds.xhttp.path","Path")}),e(Ze,{...k("xhttpPath"),placeholder:"/"})]})]}),n(ke,{spacing:2,children:[n(ot,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:i("inbounds.xhttp.headers","Custom headers")}),e(K,{size:"xs",onClick:()=>j({name:"",value:""}),children:i("inbounds.accounts.add","Add")})]}),z.map((le,ge)=>n(U,{spacing:2,align:"flex-start",children:[e(w,{children:e(Ze,{...k(`xhttpHeaders.${ge}.name`),placeholder:i("inbounds.xhttp.headerName","Header name")})}),e(w,{children:e(Ze,{...k(`xhttpHeaders.${ge}.value`),placeholder:i("inbounds.xhttp.headerValue","Header value")})}),e(K,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>pe(ge),children:i("hostsPage.delete","Delete")})]},le.id))]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.xhttp.mode","Mode")}),e(Cn,{...k("xhttpMode"),children:Xh.map(le=>e("option",{value:le,children:le},le))})]}),n(w,{children:[e(_,{children:i("inbounds.xhttp.paddingBytes","Padding bytes")}),e(Ze,{...k("xhttpPaddingBytes"),placeholder:"100-1000"})]})]}),re==="packet-up"&&n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.xhttp.maxBuffered","Max buffered upload")}),e(Ze,{...k("xhttpScMaxBufferedPosts"),placeholder:"30"})]}),n(w,{children:[e(_,{children:i("inbounds.xhttp.maxUploadBytes","Max upload size (bytes)")}),e(Ze,{...k("xhttpScMaxEachPostBytes"),placeholder:"1000000"})]})]}),re==="stream-up"&&n(w,{children:[e(_,{children:i("inbounds.xhttp.streamUp","Stream-up server seconds")}),e(Ze,{...k("xhttpScStreamUpServerSecs"),placeholder:"20-80"})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.xhttp.noSSE","Disable SSE header")}),e(dt,{...k("xhttpNoSSEHeader")})]})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.sockopt.enable","Enable sockopt")}),e(ut,{control:D,name:"sockoptEnabled",render:({field:le})=>e(dt,{isChecked:Boolean(le.value),onChange:ge=>le.onChange(ge.target.checked)})})]}),e(Xn,{in:Boolean(L),animateOpacity:!0,children:n(ke,{spacing:4,borderWidth:"1px",borderColor:de,borderRadius:"md",p:4,mt:2,children:[n(Ke,{columns:{base:1,md:2},spacing:3,children:[Me("mark",i("inbounds.sockopt.routeMark","Route mark")),Me("tcpKeepAliveInterval",i("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),Me("tcpKeepAliveIdle",i("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),Me("tcpMaxSeg",i("inbounds.sockopt.tcpMaxSeg","TCP max segment")),Me("tcpUserTimeout",i("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),Me("tcpWindowClamp",i("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[B("dialerProxy",i("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),B("interfaceName",i("inbounds.sockopt.interfaceName","Interface name"))]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.sockopt.domainStrategy","Domain strategy")}),e(ut,{control:D,name:"sockopt.domainStrategy",render:({field:le})=>n(tt,{...le,children:[e("option",{value:"",children:i("common.none","None")}),Yh.map(ge=>e("option",{value:ge,children:ge},ge))]})})]}),n(w,{children:[e(_,{children:i("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(ut,{control:D,name:"sockopt.tcpcongestion",render:({field:le})=>n(tt,{...le,children:[e("option",{value:"",children:i("common.none","None")}),Gh.map(ge=>e("option",{value:ge,children:ge},ge))]})})]}),n(w,{children:[e(_,{children:i("inbounds.sockopt.tproxy","TProxy")}),e(ut,{control:D,name:"sockopt.tproxy",render:({field:le})=>e(tt,{...le,children:Qh.map(ge=>e("option",{value:ge,children:ge},ge))})})]})]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[H("acceptProxyProtocol",i("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),H("tcpFastOpen",i("inbounds.sockopt.tcpFastOpen","TCP fast open")),H("tcpMptcp",i("inbounds.sockopt.tcpMptcp","Multipath TCP")),H("penetrate",i("inbounds.sockopt.penetrate","Penetrate")),H("V6Only",i("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),P==="tls"&&n(ke,{spacing:4,borderWidth:"1px",borderColor:de,borderRadius:"lg",p:4,children:[n(w,{children:[e(_,{children:i("inbounds.tls.serverName","Server name (SNI)")}),e(Ze,{...k("tlsServerName"),placeholder:"example.com"})]}),n(w,{children:[e(_,{children:i("inbounds.tls.fingerprint","uTLS fingerprint")}),n(Cn,{...k("tlsFingerprint"),children:[e("option",{value:"",children:i("common.none","None")}),zh.map(le=>e("option",{value:le,children:le},le))]})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.tls.allowInsecure","Allow insecure")}),e(dt,{...k("tlsAllowInsecure")})]})]}),P==="reality"&&n(ke,{spacing:4,borderWidth:"1px",borderColor:de,borderRadius:"lg",p:4,children:[n(w,{isRequired:!0,children:[e(_,{children:i("inbounds.reality.privateKey","Reality private key")}),e(Ds,{rows:3,...k("realityPrivateKey",{required:!0})}),e(K,{size:"xs",mt:2,variant:"outline",onClick:it,alignSelf:"flex-start",children:i("inbounds.reality.generateKeys","Generate key pair")})]}),n(w,{children:[e(_,{children:i("inbounds.reality.publicKey","Reality public key")}),e(Ze,{value:ce,isReadOnly:!0,placeholder:i("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:i("inbounds.reality.serverNames","Server names")}),e(Ds,{rows:2,...k("realityServerNames"),placeholder:"domain.com"}),e(T,{fontSize:"sm",color:"gray.500",children:i("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),n(w,{children:[e(_,{children:i("inbounds.reality.dest","Destination (host:port)")}),e(Ze,{...k("realityDest"),placeholder:"example.com:443"})]})]}),n(w,{children:[e(_,{children:i("inbounds.reality.shortIds","Short IDs")}),e(Ds,{rows:2,...k("realityShortIds")}),e(K,{size:"xs",mt:2,variant:"outline",onClick:he,alignSelf:"flex-start",children:i("inbounds.reality.generateShortId","Generate short ID")}),e(T,{fontSize:"sm",color:"gray.500",children:i("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:i("inbounds.reality.spiderX","SpiderX")}),e(Ze,{...k("realitySpiderX")})]}),n(w,{children:[e(_,{children:i("inbounds.reality.xver","Xver")}),e(Ze,{...k("realityXver")})]})]})]}),O&&n(ke,{spacing:3,borderWidth:"1px",borderColor:de,borderRadius:"lg",p:4,children:[n(ot,{align:"center",justify:"space-between",children:[e(T,{fontWeight:"medium",children:i("inbounds.fallbacks","Fallbacks")}),e(K,{size:"xs",onClick:oe,children:i("inbounds.fallbacks.add","Add fallback")})]}),R.length===0?e(h,{fontSize:"sm",color:"gray.500",children:i("inbounds.fallbacks.empty","No fallbacks configured yet.")}):R.map((le,ge)=>n(T,{borderWidth:"1px",borderRadius:"md",borderColor:de,p:3,children:[n(ot,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[i("inbounds.fallbacks.type","Fallback")," #",ge+1]}),e(K,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>b(ge),children:i("hostsPage.delete","Delete")})]}),n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.fallbacks.dest","Destination (host:port)")}),e(Ze,{placeholder:"example.com:443",...k(`fallbacks.${ge}.dest`)})]}),n(w,{children:[e(_,{children:i("inbounds.fallbacks.path","Path")}),e(Ze,{...k(`fallbacks.${ge}.path`),placeholder:"/"})]}),n(w,{children:[e(_,{children:i("inbounds.fallbacks.type","Type")}),e(Ze,{...k(`fallbacks.${ge}.type`),placeholder:"none"})]}),n(w,{children:[e(_,{children:i("inbounds.fallbacks.alpn","ALPN")}),e(Ze,{...k(`fallbacks.${ge}.alpn`),placeholder:"h2,http/1.1"})]}),n(w,{children:[e(_,{children:"Xver"}),e(Ze,{...k(`fallbacks.${ge}.xver`),placeholder:"0"})]})]})]},le.id))]}),n(ke,{spacing:4,borderWidth:"1px",borderColor:de,borderRadius:"lg",p:4,children:[n(ot,{align:"center",justify:"space-between",children:[n(U,{spacing:2,children:[e(T,{fontWeight:"medium",children:i("inbounds.sniffing","Sniffing")}),e(st,{label:i("inbounds.sniffingHint","It is recommended to keep the default."),children:e(Go,{width:16,height:16})})]}),e(dt,{...k("sniffingEnabled")})]}),me&&n(ke,{spacing:3,children:[n(w,{children:[e(_,{children:i("inbounds.sniffingDestinations","Protocols to sniff")}),e(ut,{control:D,name:"sniffingDestinations",render:({field:le})=>{var ge;return e(si,{value:(ge=le.value)!=null?ge:[],onChange:le.onChange,children:e(U,{spacing:4,children:Nh.map(Oe=>e(Ir,{value:Oe.value,children:Oe.label},Oe.value))})})}})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.sniffingRouteOnly","Route only")}),e(dt,{...k("sniffingRouteOnly")})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("inbounds.sniffingMetadataOnly","Metadata only")}),e(dt,{...k("sniffingMetadataOnly")})]})]})]})]})}),n(Nt,{children:[e(K,{variant:"ghost",mr:3,onClick:o,children:i("hostsPage.cancel","Cancel")}),e(K,{colorScheme:"primary",isLoading:l,onClick:x(ze),children:s==="create"?i("common.create","Create"):i("common.save","Save")})]})]})]})},jh=()=>{const{t}=Je(),s=Ht(),[r,l]=d.exports.useState([]),[o,a]=d.exports.useState(!0),[i,c]=d.exports.useState(!1),[u,p]=d.exports.useState(null),[m,g]=d.exports.useState({protocol:"all",search:""}),[A,D]=d.exports.useState(null),{isOpen:k,onOpen:x,onClose:v}=Gt(),[C,R]=d.exports.useState("create"),ie=Sr({base:!1,md:!0}),b=d.exports.useCallback(()=>{a(!0),p(null),_e("/inbounds/full").then(te=>{l(te||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>a(!1))},[t]);d.exports.useEffect(()=>{b()},[b]);const M=d.exports.useMemo(()=>{const te=m.search.trim().toLowerCase();return r.filter(z=>{var j;return m.protocol!=="all"&&z.protocol!==m.protocol?!1:te?z.tag.toLowerCase().includes(te)||((j=z.port)==null?void 0:j.toString().includes(te)):!0})},[r,m]),I=()=>{R("create"),D(null),x()},W=te=>{R("edit"),D(te),x()},ve=async te=>{var z;c(!0);try{const j=Bh(te),pe=C==="create"?"/inbounds":`/inbounds/${encodeURIComponent(j.tag)}`;await _e(pe,{method:C==="create"?"POST":"PUT",body:j}),s({status:"success",title:C==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),Ns(),await b(),v()}catch(j){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((z=j==null?void 0:j.data)==null?void 0:z.detail)||(j==null?void 0:j.message)})}finally{c(!1)}},Z=async te=>{var j;const z=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:te.tag});if(!!window.confirm(z)){c(!0);try{await _e(`/inbounds/${encodeURIComponent(te.tag)}`,{method:"DELETE"}),s({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),Ns(),await b()}catch(pe){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((j=pe==null?void 0:pe.data)==null?void 0:j.detail)||(pe==null?void 0:pe.message)})}finally{c(!1)}}};return n(ke,{spacing:4,children:[n(ot,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(xe,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:m.search,onChange:te=>g(z=>({...z,search:te.target.value}))}),n(U,{spacing:3,children:[n(tt,{width:"180px",value:m.protocol,onChange:te=>g(z=>({...z,protocol:te.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),ya.map(te=>e("option",{value:te,children:te.toUpperCase()},te))]}),e(K,{leftIcon:e(dn,{width:18,height:18}),onClick:I,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&n(Dr,{status:"error",children:[e(Ar,{}),u]}),o?e(ot,{justify:"center",py:10,children:e(Dt,{})}):M.length===0?e(T,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):ie?e(T,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:n(Tn,{variant:"simple",size:"sm",children:[e(Xr,{bg:"gray.50",_dark:{bg:"gray.900"},children:n(_t,{children:[e(He,{children:t("inbounds.tag","Tag")}),e(He,{children:t("inbounds.protocol","Protocol")}),e(He,{children:t("inbounds.portLabel","Port")}),e(He,{children:t("inbounds.network","Network")}),e(He,{children:t("inbounds.security","Security")}),e(He,{children:t("inbounds.sniffing","Sniffing")}),e(He,{width:"120px",children:t("actions","Actions")})]})}),e(Br,{children:M.map(te=>{var j;const z=te.streamSettings||{};return n(_t,{children:[n(Ne,{children:[e(h,{fontWeight:"semibold",children:te.tag}),te.listen&&e(h,{fontSize:"sm",color:"gray.500",children:te.listen})]}),e(Ne,{children:e(gt,{colorScheme:"purple",children:te.protocol})}),e(Ne,{children:te.port}),e(Ne,{children:z.network||"\u2014"}),e(Ne,{children:z.security&&z.security!=="none"?e(gt,{colorScheme:"blue",children:z.security}):"\u2014"}),e(Ne,{children:(j=te.sniffing)!=null&&j.enabled?e(gt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(gt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Ne,{children:n(U,{spacing:2,children:[e(Le,{"aria-label":t("common.edit","Edit"),icon:e(yn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>W(te)}),e(Le,{"aria-label":t("common.delete","Delete"),icon:e(tn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>Z(te),isLoading:i})]})})]},te.tag)})})]})}):e(ke,{spacing:3,children:M.map(te=>{var j;const z=te.streamSettings||{};return n(T,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(ot,{justify:"space-between",align:"center",mb:2,children:[n(T,{children:[e(h,{fontWeight:"semibold",children:te.tag}),n(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",te.port]})]}),n(U,{spacing:2,children:[e(Le,{"aria-label":t("common.edit","Edit"),icon:e(yn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>W(te)}),e(Le,{"aria-label":t("common.delete","Delete"),icon:e(tn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>Z(te),isLoading:i})]})]}),n(ke,{spacing:2,children:[n(U,{spacing:2,wrap:"wrap",children:[e(gt,{colorScheme:"purple",children:te.protocol}),z.network&&e(gt,{children:z.network}),z.security&&z.security!=="none"&&e(gt,{colorScheme:"blue",children:z.security})]}),n(U,{spacing:2,wrap:"wrap",children:[(j=te.sniffing)!=null&&j.enabled?e(gt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(gt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),te.listen&&e(gt,{size:"sm",colorScheme:"gray",children:te.listen})]})]})]},te.tag)})}),e(Zh,{isOpen:k,mode:C,initialValue:A,isSubmitting:i,onClose:v,onSubmit:ve})]})},ep=()=>{const{t}=Je();return n(ue,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),n(ss,{colorScheme:"primary",isLazy:!0,children:[n(is,{children:[e(Bt,{children:n(U,{spacing:2,children:[e(As,{as:Xo,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(Bt,{children:n(U,{spacing:2,children:[e(As,{as:Oo,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),n(as,{children:[e(Vt,{px:0,children:n(ue,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(jh,{})]})}),e(Vt,{px:0,children:n(ue,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Dh,{})]})})]})]})]})},tp=Pe.object({name:Pe.string().min(1),address:Pe.string().min(1),port:Pe.number().min(1).or(Pe.string().transform(t=>parseFloat(t))),api_port:Pe.number().min(1).or(Pe.string().transform(t=>parseFloat(t))),xray_version:Pe.string().nullable().optional(),node_service_version:Pe.string().nullable().optional(),id:Pe.number().nullable().optional(),status:Pe.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:Pe.string().nullable().optional(),add_as_new_host:Pe.boolean().optional(),usage_coefficient:Pe.number().or(Pe.string().transform(t=>parseFloat(t))),data_limit:Pe.number().nullable().optional(),uplink:Pe.number().nullable().optional(),downlink:Pe.number().nullable().optional(),use_nobetci:Pe.boolean().optional(),nobetci_port:Pe.number().nullable().optional()}),Xs=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",node_service_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,nobetci_port:null}),br="fetch-nodes-query-key",Sa=()=>{const{isEditingNodes:t}=wt();return Tr({queryKey:br,queryFn:Ks.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Ks=ns((t,s)=>({nodes:[],addNode(r){return _e("/node",{method:"POST",body:r})},fetchNodes(){return _e("/nodes")},fetchNodesUsage(r){return _e("/nodes/usage",{query:r})},updateNode(r){return _e(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return _e(`/node/${r.id}/reconnect`,{method:"POST"})},restartNodeService(r){return _e(`/node/${r.id}/service/restart`,{method:"POST"})},updateNodeService(r){return _e(`/node/${r.id}/service/update`,{method:"POST"})},resetNodeUsage(r){return _e(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return _e("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return _e("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return _e(`/node/${(r=s().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),lo=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:a}=Je(),i=vi(t),c=An[s].icon;return n(Lt,{children:[n(rn,{colorScheme:An[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[s&&a(`nodeModal.status.${s}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a(i.status,{time:i.time})})]})},rp=ee(Ps,{baseStyle:{w:4,h:4}}),np=ee(ha,{baseStyle:{w:4,h:4}}),sp=ee(Bc,{baseStyle:{w:4,h:4}}),ip=ee(ua,{baseStyle:{w:4,h:4}}),co=1024*1024*1024,ap=51031,wn=t=>{if(t&&typeof t=="object"&&"message"in t){const s=t.message;return typeof s=="string"?s:void 0}},uo=({isOpen:t,onClose:s,node:r,mutate:l,isLoading:o,isAddMode:a=!1})=>{var pe,Y,Q,P,me,Ie,De,L,y,E,ae,re,Ce,Te,Re,Me,H;const{t:i}=Je(),c=Ht(),[u,p]=d.exports.useState(a),{fetchNodesUsage:m}=Ks(),[g,A]=d.exports.useState(null),{data:D,isLoading:k}=Tr({queryKey:"node-settings",queryFn:()=>_e("/node/settings")}),{data:x}=Tr({queryKey:"panel-settings",queryFn:ba,staleTime:5*60*1e3}),v=(pe=x==null?void 0:x.use_nobetci)!=null?pe:!0,C=B=>{if(B==null)return null;const O=B/co;return Number.isFinite(O)?Math.round(O*100)/100:null},R=B=>B==null?null:Math.round(B*co),ie=a?{...Xs(),add_as_new_host:!1}:{...Xs(),...r,add_as_new_host:!1},b=Mr({resolver:Si(tp),defaultValues:{...ie,data_limit:C((Y=ie.data_limit)!=null?Y:null)}}),M=(Q=D==null?void 0:D.certificate)!=null?Q:"",{onCopy:I,hasCopied:W}=sl(M),ve=b.watch("use_nobetci");d.exports.useEffect(()=>{if(!v||!ve){b.getValues("nobetci_port")!==null&&b.setValue("nobetci_port",null);return}const B=b.getValues("nobetci_port");(B==null||B==="")&&b.setValue("nobetci_port",ap)},[ve,b,v]),d.exports.useEffect(()=>{x&&!x.use_nobetci&&(b.getValues("use_nobetci")&&b.setValue("use_nobetci",!1),b.getValues("nobetci_port")!==null&&b.setValue("nobetci_port",null))},[x,b]),d.exports.useEffect(()=>{var B;if(t){const O=a?{...Xs(),add_as_new_host:!1}:{...Xs(),...r,add_as_new_host:!1};b.reset({...O,data_limit:C((B=O.data_limit)!=null?B:null)}),p(a&&!!M)}},[t,a,r,b,M]),d.exports.useEffect(()=>{!a&&r&&t?m({start:$e().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(B=>{const O=B.usages[r.id];O&&A({uplink:O.uplink,downlink:O.downlink})}):A(null)},[r,a,t,m]);const Z=b.handleSubmit(B=>{var de;const O={...B,data_limit:R((de=B.data_limit)!=null?de:null)};l(O)}),te=()=>{!M||(I(),c({title:i("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},z=()=>{if(!M)return;const B=new Blob([M],{type:"text/plain"}),O=URL.createObjectURL(B),de=document.createElement("a");de.href=O,de.download="ssl_client_cert.pem",de.click(),URL.revokeObjectURL(O)},j=()=>{p(!1),A(null),s()};return n(Rt,{isOpen:t,onClose:j,size:"lg",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",as:"form",onSubmit:Z,children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(a?"nodes.addNewRebeccaNode":"nodes.editNode")})}),e(zt,{mt:3}),e(Ct,{children:n(ke,{spacing:6,children:[!a&&g&&n(ke,{spacing:2,children:[e(h,{fontWeight:"medium",children:i("nodes.usage")}),n(U,{children:[n(gt,{colorScheme:"green",children:[i("nodes.uplink"),": ",_n.sizeFormat(g.uplink)]}),n(gt,{colorScheme:"blue",children:[i("nodes.downlink"),": ",_n.sizeFormat(g.downlink)]})]})]}),a&&n(ke,{spacing:3,children:[n(U,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:i("nodes.certificate")}),n(U,{spacing:2,children:[e(K,{size:"xs",variant:"outline",leftIcon:e(sp,{}),onClick:te,isDisabled:!M,children:i(W?"copied":"copy")}),e(K,{size:"xs",variant:"outline",leftIcon:e(ip,{}),onClick:z,isDisabled:!M,children:i("nodes.download-certificate")}),e(st,{placement:"top",label:i(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(Le,{"aria-label":i(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p(B=>!B),size:"xs",variant:"ghost",children:u?e(np,{}):e(rp,{})})})]})]}),e(Xn,{in:u&&!!M,animateOpacity:!0,children:e(T,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:M||(k?i("loading"):"")})}),!M&&!k&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:i("nodes.certificateUnavailable","Certificate not available.")})]}),n(ke,{spacing:4,children:[n(Ke,{columns:{base:1,md:2},spacing:4,children:[e(w,{children:e(Yt,{label:i("nodes.nodeName"),size:"sm",placeholder:"Rebecca-S2",...b.register("name"),error:wn((me=(P=b.formState)==null?void 0:P.errors)==null?void 0:me.name)})}),e(w,{children:e(Yt,{label:i("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...b.register("address"),error:wn((De=(Ie=b.formState)==null?void 0:Ie.errors)==null?void 0:De.address)})})]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[e(w,{children:e(Yt,{label:i("nodes.nodePort"),size:"sm",placeholder:"62050",...b.register("port"),error:wn((y=(L=b.formState)==null?void 0:L.errors)==null?void 0:y.port)})}),e(w,{children:e(Yt,{label:i("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...b.register("api_port"),error:wn((ae=(E=b.formState)==null?void 0:E.errors)==null?void 0:ae.api_port)})})]}),e(w,{children:e(Yt,{label:i("nodes.usageCoefficient"),size:"sm",placeholder:"1",...b.register("usage_coefficient"),error:wn((Ce=(re=b.formState)==null?void 0:re.errors)==null?void 0:Ce.usage_coefficient)})}),n(w,{children:[e(Yt,{label:i("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:i("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...b.register("data_limit",{setValueAs:B=>{if(B===""||B===null||B===void 0)return null;const O=Number(B);return Number.isFinite(O)?O:Number.NaN},validate:B=>B==null?!0:Number.isNaN(B)?i("nodes.dataLimitValidation","Data limit must be a valid number"):B>=0||i("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:wn((Re=(Te=b.formState)==null?void 0:Te.errors)==null?void 0:Re.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:i("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),v&&n(Lt,{children:[n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:i("nodes.useNobetci","Enable Nobetci integration")}),e(ut,{control:b.control,name:"use_nobetci",render:({field:B})=>e(dt,{isChecked:Boolean(B.value),onChange:O=>B.onChange(O.target.checked)})})]}),e(Xn,{in:Boolean(ve),animateOpacity:!0,children:n(w,{mt:ve?2:0,children:[e(Yt,{label:i("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...b.register("nobetci_port",{setValueAs:B=>{if(B===""||B===null||B===void 0)return null;const O=Number(B);return Number.isFinite(O)?O:Number.NaN},validate:B=>ve?B==null?i("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(B)?i("nodes.nobetciPortInvalid","Enter a valid port number"):B>=1&&B<=65535?!0:i("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:wn((H=(Me=b.formState)==null?void 0:Me.errors)==null?void 0:H.nobetci_port)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:i("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]})]}),a&&e(T,{children:e(Ir,{...b.register("add_as_new_host"),children:i("nodes.addHostForEveryInbound")})})]})}),n(Nt,{gap:3,children:[e(K,{variant:"outline",onClick:j,children:i("cancel")}),e(K,{type:"submit",colorScheme:"primary",isLoading:o,children:i(a?"nodes.addNode":"nodes.editNode")})]})]})]})},op=({deleteCallback:t})=>{const{deleteNode:s,deletingNode:r,setDeletingNode:l}=Ks(),{t:o}=Je(),a=Ht(),i=ga(),c=()=>{l(null)},{isLoading:u,mutate:p}=Cr(s,{onSuccess:()=>{Ot(o("deleteNode.deleteSuccess",{name:r&&r.name}),a),l(null),i.invalidateQueries(br),t&&t()},onError:m=>{Wt(m,a)}});return n(Rt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"red",children:e(Bs,{})})}),e(zt,{mt:3}),n(Ct,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:o("deleteNode.prompt",{name:r.name})})})]}),n(Nt,{display:"flex",children:[e(K,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(K,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:u?e(Dt,{size:"xs"}):void 0,children:o("delete")})]})]})]})},lp=10,cp=({isOpen:t,title:s,description:r,currentVersion:l,allowPersist:o=!1,isSubmitting:a,onSubmit:i,onClose:c})=>{const{t:u}=Je(),[p,m]=d.exports.useState(""),[g,A]=d.exports.useState(!1),[D,k]=d.exports.useState(null),x=Tr(["core-xray-releases"],()=>_e("/core/xray/releases",{query:{limit:lp}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(m(l||""),A(!1),k(null))},[t,l]);const v=d.exports.useMemo(()=>{var M,I;return(I=(M=x.data)==null?void 0:M.tags)!=null?I:[]},[x.data]),C=M=>{m(M.target.value)},R=M=>{m(M.target.value)},ie=async()=>{if(!p){k(u("validation.required"));return}try{k(null),await i({version:p,persist:o?g:void 0})}catch(M){M instanceof Error?k(M.message):k(u("core.generalErrorMessage"))}},b=x.isLoading;return n(Rt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(vt,{}),n(Ut,{children:[e(At,{children:s}),e(zt,{}),e(Ct,{children:n(ke,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),n(w,{children:[e(_,{children:u("nodes.coreVersionDialog.latestReleases")}),e(tt,{placeholder:u(b?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&v.includes(p)?p:"",onChange:C,isDisabled:b||v.length===0,size:"sm",children:v.map(M=>e("option",{value:M,children:M},M))}),b&&n(ke,{direction:"row",align:"center",spacing:2,mt:2,children:[e(Dt,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),x.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),n(w,{isRequired:!0,children:[e(_,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(xe,{value:p,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:R,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),o&&e(Ir,{isChecked:g,onChange:M=>A(M.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),D&&n(Dr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Ar,{}),e(bn,{children:D})]})]})}),n(Nt,{children:[e(K,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(K,{colorScheme:"primary",onClick:ie,isLoading:a,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},ho="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",dp=ee(il,{baseStyle:{w:3.5,h:3.5}}),up=ee(dn,{baseStyle:{w:3.5,h:3.5}}),hp=ee(Vr,{baseStyle:{w:4,h:4}}),pp=({isOpen:t,title:s,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:o,onSubmit:a,onClose:i})=>{const{t:c}=Je(),[u,p]=d.exports.useState("template"),[m,g]=d.exports.useState(ho),[A,D]=d.exports.useState(""),[k,x]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[v,C]=d.exports.useState(!0),[R,ie]=d.exports.useState(!1),[b,M]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),g(o||ho),D(""),x([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),C(!0),ie(!1),M(null))},[t,o]);const I=Tr(["geo-templates",m],()=>_e("/core/geo/templates",{query:m?{index_url:m}:void 0}),{enabled:t&&u==="template"&&Boolean(m),staleTime:10*60*1e3}),W=d.exports.useMemo(()=>{var Y,Q;return(Q=(Y=I.data)==null?void 0:Y.templates)!=null?Q:[]},[I.data]);d.exports.useEffect(()=>{W.length>0&&D(Y=>Y||W[0].name)},[W]);const ve=nt("gray.50","whiteAlpha.50"),Z=()=>{x(Y=>[...Y,{name:"",url:""}])},te=(Y,Q,P)=>{x(me=>me.map((Ie,De)=>De===Y?{...Ie,[Q]:P}:Ie))},z=Y=>{x(Q=>Q.filter((P,me)=>me!==Y))},j=async()=>{const Y=u==="manual"?k.filter(P=>P.name.trim()&&P.url.trim()):[];if(u==="template"){if(!m.trim()){M(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!A){M(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(Y.length===0){M(c("nodes.geoDialog.errors.missingFiles"));return}if(Y.find(me=>!me.name.trim()||!me.url.trim())){M(c("nodes.geoDialog.errors.invalidFile"));return}}M(null);const Q=u==="manual"?Y:[];try{await a({mode:u,templateIndexUrl:m.trim(),templateName:A,files:Q,persistEnv:v,applyToNodes:R})}catch(P){const me=P instanceof Error?P.message:c("nodes.geoDialog.genericError");M(me)}},pe=()=>n(ke,{spacing:3,bg:ve,p:4,borderRadius:"md",children:[k.map((Y,Q)=>n(T,{borderWidth:"1px",borderRadius:"md",p:3,children:[n(Ke,{columns:{base:1,md:2},spacing:3,children:[n(w,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(xe,{size:"sm",value:Y.name,placeholder:"geosite.dat",onChange:P=>te(Q,"name",P.target.value)})]}),n(w,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(xe,{size:"sm",value:Y.url,placeholder:"https://example.com/geosite.dat",onChange:P=>te(Q,"url",P.target.value)})]})]}),e(U,{justify:"flex-end",mt:3,children:e(st,{label:c("nodes.geoDialog.removeFile"),children:e(Le,{"aria-label":"remove file",icon:e(dp,{}),variant:"ghost",size:"sm",onClick:()=>z(Q),isDisabled:k.length<=1})})})]},`manual-file-${Q}`)),e(K,{onClick:Z,leftIcon:e(up,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return n(Rt,{isOpen:t,onClose:i,size:"xl",isCentered:!0,children:[e(vt,{}),n(Ut,{children:[e(At,{children:s}),e(zt,{}),e(Ct,{children:n(ke,{spacing:4,children:[n(w,{as:"fieldset",children:[e(_,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(gi,{value:u,onChange:Y=>p(Y),children:n(U,{spacing:4,children:[e(Gr,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Gr,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?n(ke,{spacing:3,children:[n(w,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(xe,{size:"sm",value:m,onChange:Y=>g(Y.target.value)})]}),n(w,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),n(U,{align:"center",spacing:2,children:[e(tt,{size:"sm",flex:1,value:A,onChange:Y=>D(Y.target.value),isDisabled:I.isLoading||!W.length,placeholder:I.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:W.map(Y=>e("option",{value:Y.name,children:Y.name},Y.name))}),e(st,{label:c("nodes.geoDialog.refreshTemplates"),children:e(Le,{"aria-label":"refresh templates",icon:e(hp,{}),size:"sm",variant:"outline",onClick:()=>I.refetch(),isLoading:I.isFetching,isDisabled:!m.trim()})})]})]}),I.isError&&n(Dr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Ar,{}),e(bn,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):pe(),l&&n(ke,{spacing:2,children:[e(Ir,{isChecked:v,onChange:Y=>C(Y.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(Ir,{isChecked:R,onChange:Y=>ie(Y.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),b&&n(Dr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Ar,{}),e(bn,{children:b})]})]})}),n(Nt,{children:[e(K,{variant:"ghost",mr:3,onClick:i,children:c("cancel")}),e(K,{colorScheme:"primary",onClick:j,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};$e.extend(Hs);const mp=ee(dn,{baseStyle:{w:4,h:4}}),gp=ee(tn,{baseStyle:{w:4,h:4}}),fp=ee(yn,{baseStyle:{w:4,h:4}}),po=ee(Vr,{baseStyle:{w:4,h:4}}),bp=ee(Vo,{baseStyle:{w:4,h:4}}),Pl=1024**3,yp=t=>{if(t==null)return"";const s=t/Pl;return Number.isFinite(s)?(Math.round(s*100)/100).toString():""},mo=t=>{const s=t.trim();if(!s)return null;const r=Number(s);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*Pl)},Sp=()=>{var ds,us,hs,f,S,X,qe,rt,Ye,yt,mr,Sn,mn;const{t}=Je(),{onEditingNodes:s}=wt(),r=wt(ne=>ne.isEditingNodes),{data:l,isLoading:o,error:a,refetch:i,isFetching:c}=Sa(),{addNode:u,updateNode:p,reconnectNode:m,restartNodeService:g,updateNodeService:A,resetNodeUsage:D,updateMasterNode:k,resetMasterUsage:x,setDeletingNode:v}=Ks(),C=ga(),R=Ht(),[ie,b]=d.exports.useState(null),[M,I]=d.exports.useState(!1),[W,ve]=d.exports.useState(""),[Z,te]=d.exports.useState(null),[z,j]=d.exports.useState(null),[pe,Y]=d.exports.useState(null),[Q,P]=d.exports.useState(null),[me,Ie]=d.exports.useState(!1),[De,L]=d.exports.useState(!1),[y,E]=d.exports.useState(!1),[ae,re]=d.exports.useState(null),[Ce,Te]=d.exports.useState({}),[Re,Me]=d.exports.useState(null),[H,B]=d.exports.useState(null),[O,de]=d.exports.useState(null),[ze,it]=d.exports.useState(null),{isOpen:he,onOpen:ce,onClose:oe}=Gt(),V=d.exports.useRef(null),[ye,ht]=d.exports.useState(""),[ft,q]=d.exports.useState(!1),{isOpen:F,onOpen:Se,onClose:Ue}=Gt(),We=d.exports.useRef(null),{data:Be,isLoading:le,refetch:ge,error:Oe}=Tr(["core-stats"],()=>_e("/core"),{refetchOnWindowFocus:!1}),{data:Ae,isLoading:lt,error:pt,refetch:Ge}=Tr(["master-node-state"],()=>_e("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(s(!0),()=>{s(!1)}),[s]),d.exports.useEffect(()=>{var at,et;if(!Ae)return;if(ft){const mt=mo(ye),It=(at=Ae.data_limit)!=null?at:null;if(mt!==It)return}const ne=yp((et=Ae.data_limit)!=null?et:null);ht(ne),ft&&q(!1)},[Ae,ft,ye]);const{isLoading:$t,mutate:dr}=Cr(u,{onSuccess:()=>{Ot(t("nodes.addNodeSuccess"),R),C.invalidateQueries(br),I(!1)},onError:ne=>{Wt(ne,R)}}),{isLoading:rr,mutate:ur}=Cr(p,{onSuccess:()=>{Ot(t("nodes.nodeUpdated"),R),C.invalidateQueries(br),b(null)},onError:ne=>{Wt(ne,R)}}),{isLoading:nr,mutate:Qt}=Cr(m,{onSuccess:()=>{C.invalidateQueries(br)}}),{mutate:sr,isLoading:ir}=Cr(p,{onSuccess:()=>{C.invalidateQueries(br)},onError:ne=>{Wt(ne,R)},onSettled:(ne,at,et)=>{(et==null?void 0:et.id)!=null&&Te(mt=>{const It={...mt};return delete It[et.id],It}),re(null)}}),{isLoading:Xt,mutate:ar}=Cr(D,{onSuccess:()=>{Ot(t("nodes.resetUsageSuccess","Node usage reset"),R),C.invalidateQueries(br)},onError:ne=>{Wt(ne,R)},onSettled:()=>{Me(null),B(null),oe()}}),{mutate:J,isLoading:be}=Cr(g,{onMutate:ne=>{var at;de((at=ne.id)!=null?at:null)},onSuccess:()=>{Ot(t("nodes.restartServiceTriggered","Node restart requested"),R),C.invalidateQueries(br)},onError:ne=>{Wt(ne,R)},onSettled:()=>{de(null)}}),{mutate:G,isLoading:N}=Cr(A,{onMutate:ne=>{var at;it((at=ne.id)!=null?at:null)},onSuccess:()=>{Ot(t("nodes.updateServiceTriggered","Node update requested"),R),C.invalidateQueries(br)},onError:ne=>{Wt(ne,R)},onSettled:()=>{it(null)}}),{isLoading:we,mutate:Ee}=Cr(k,{onSuccess:()=>{Ot(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),R),Ge(),q(!1)},onError:ne=>{Wt(ne,R)}}),{isLoading:Fe,mutate:Xe}=Cr(x,{onSuccess:()=>{Ot(t("nodes.resetMasterUsageSuccess","Master usage reset"),R),Ge(),Ue()},onError:ne=>{Wt(ne,R)}}),bt=d.exports.useMemo(()=>mo(ye),[ye]),ct=(ds=Ae==null?void 0:Ae.data_limit)!=null?ds:null,Pt=bt===void 0,Mt=bt!==void 0&&bt!==ct,Zt=le||lt,jt=d.exports.useMemo(()=>{if(Oe instanceof Error)return Oe.message;if(typeof Oe=="string")return Oe;if(pt instanceof Error)return pt.message;if(typeof pt=="string")return pt},[Oe,pt]),Er=(us=Ae==null?void 0:Ae.total_usage)!=null?us:0,Ve=(hs=Ae==null?void 0:Ae.data_limit)!=null?hs:null,St=(f=Ae==null?void 0:Ae.remaining_data)!=null?f:null,Nr=Ae!=null&&Ae.updated_at?$e(Ae.updated_at).local().format("YYYY-MM-DD HH:mm"):null,Or=(S=Ae==null?void 0:Ae.status)!=null?S:"error",hr=je(Er,2),or=Ve!==null&&Ve>0?je(Ve,2):t("nodes.unlimited","Unlimited"),Kt=St!=null?je(St,2):null,zr=ne=>{q(!0),ht(ne)},nn=()=>{if(Pt||bt===void 0){Wt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),R);return}Ee({data_limit:bt!=null?bt:null})},Tt=()=>{q(!0),ht(""),Ee({data_limit:null})},kr=()=>{Se()},xt=ne=>{if(!(ne!=null&&ne.id))return;const at=ne.status!=="disabled",et=at?"disabled":"connecting",mt=ne.id;re(mt),Te(It=>({...It,[mt]:!at})),sr({...ne,status:et})},pr=ne=>{!(ne!=null&&ne.id)||(B(ne),ce())},wr=ne=>{if(!(ne!=null&&ne.id))return;const at=ne.name||ne.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.restartServiceConfirm","Send a restart request to {{name}}? Services will be interrupted briefly.",{name:at}))||J(ne)},Rr=ne=>{if(!(ne!=null&&ne.id))return;const at=ne.name||ne.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.updateServiceConfirm","Send an update request to {{name}}? The node will download updates and restart.",{name:at}))||G(ne)},fe=()=>{!(H!=null&&H.id)||(Me(H.id),ar(H))},Kr=()=>{B(null),oe()},er=()=>te(null),pn=()=>j(null),Ln=async({version:ne,persist:at})=>{var et;if(!!Z){if(Z.type==="master"){Ie(!0);try{await _e("/core/xray/update",{method:"POST",body:{version:ne,persist_env:Boolean(at)}}),Ot(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:ne}),R),await Promise.all([ge(),C.invalidateQueries(br)]),er()}catch(mt){Wt(mt,R)}finally{Ie(!1)}return}if(Z.type==="bulk"){const mt=(l!=null?l:[]).filter(It=>It.id!=null&&It.status==="connected");if(mt.length===0){R({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}L(!0);try{const It=[];for(const xn of mt)try{await _e(`/node/${xn.id}/xray/update`,{method:"POST",body:{version:ne}}),It.push({status:"fulfilled",node:xn})}catch(Pi){It.push({status:"rejected",node:xn}),Wt(Pi,R)}const Wr=It.filter(xn=>xn.status==="fulfilled").length,Jr=It.length-Wr,qr=It.length;Wr>0&&Ot(t("nodes.coreVersionDialog.bulkSuccess",{success:Wr,total:qr}),R),Jr>0&&R({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:Jr,total:qr}),status:"error",isClosable:!0,position:"top",duration:4e3}),C.invalidateQueries(br),er()}finally{L(!1)}return}if(Z.type==="node"){const mt=Z.node;if(!(mt!=null&&mt.id))return;Y(mt.id);try{await _e(`/node/${mt.id}/xray/update`,{method:"POST",body:{version:ne}}),Ot(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(et=mt.name)!=null?et:t("nodes.unnamedNode","Unnamed node"),version:ne}),R),C.invalidateQueries(br),er()}catch(It){Wt(It,R)}finally{Y(null)}}}},Mn=async ne=>{var et;if(!z)return;const at={mode:ne.mode,template_index_url:ne.templateIndexUrl,template_name:ne.templateName,files:ne.files,persist_env:ne.persistEnv};if(z.type==="master"){E(!0);try{await _e("/core/geo/update",{method:"POST",body:at}),Ot(t("nodes.geoDialog.masterUpdateSuccess"),R),pn()}catch(mt){Wt(mt,R)}finally{E(!1)}return}if(z.type==="node"){const mt=z.node;if(!(mt!=null&&mt.id))return;P(mt.id);try{await _e(`/node/${mt.id}/geo/update`,{method:"POST",body:at}),Ot(t("nodes.geoDialog.nodeUpdateSuccess",{name:(et=mt.name)!=null?et:t("nodes.unnamedNode","Unnamed node")}),R),C.invalidateQueries(br),pn()}catch(It){Wt(It,R)}finally{P(null)}}},Js=d.exports.useMemo(()=>{if(!l)return[];const ne=W.trim().toLowerCase();return ne?l.filter(at=>{var Wr,Jr,qr;const et=((Wr=at.name)!=null?Wr:"").toLowerCase(),mt=((Jr=at.address)!=null?Jr:"").toLowerCase(),It=((qr=at.xray_version)!=null?qr:"").toLowerCase();return et.includes(ne)||mt.includes(ne)||It.includes(ne)}):l},[l,W]),qs=d.exports.useMemo(()=>(l!=null?l:[]).some(ne=>ne.id!=null&&ne.status==="connected"),[l]),Ys=d.exports.useMemo(()=>{if(!!a){if(a instanceof Error)return a.message;if(typeof a=="string")return a;if(typeof a=="object"&&"message"in a){const ne=a.message;if(typeof ne=="string")return ne}return t("errorOccurred")}},[a,t]),Ci=Boolean(Ys),ls=t("nodes.masterNode","Master"),cs=W.trim().toLowerCase(),_i=!cs||ls.toLowerCase().includes(cs)||((X=Be==null?void 0:Be.version)!=null?X:"").toLowerCase().includes(cs),sn=(Z==null?void 0:Z.type)==="master"?me:(Z==null?void 0:Z.type)==="node"?Z.node.id!=null&&pe===Z.node.id:(Z==null?void 0:Z.type)==="bulk"?De:!1,On=(z==null?void 0:z.type)==="master"?y:(z==null?void 0:z.type)==="node"?z.node.id!=null&&Q===z.node.id:!1,Di=(Z==null?void 0:Z.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(Z==null?void 0:Z.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(Z==null?void 0:Z.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(qe=Z.node.name)!=null?qe:t("nodes.unnamedNode","Unnamed node")}):"",Ai=(Z==null?void 0:Z.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(Z==null?void 0:Z.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(Z==null?void 0:Z.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(rt=Z.node.name)!=null?rt:t("nodes.unnamedNode","Unnamed node")}):"",Ii=(Z==null?void 0:Z.type)==="master"?(Ye=Be==null?void 0:Be.version)!=null?Ye:"":(Z==null?void 0:Z.type)==="node"&&(yt=Z.node.xray_version)!=null?yt:"",Gs=(z==null?void 0:z.type)==="master"?t("nodes.geoDialog.masterTitle"):(z==null?void 0:z.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(mr=z.node.name)!=null?mr:t("nodes.unnamedNode","Unnamed node")}):"";return n(ue,{spacing:6,align:"stretch",children:[n(ke,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),Ci&&n(Dr,{status:"error",borderRadius:"md",children:[e(Ar,{}),e(bn,{children:Ys})]}),n(ke,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[n(U,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[n(xr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e($o,{pointerEvents:"none",children:e(bp,{color:"gray.400"})}),e(xe,{value:W,onChange:ne=>ve(ne.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(st,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(Le,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(po,{}),variant:"ghost",size:"sm",onClick:()=>i(),isLoading:c})})]}),n(ke,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(K,{variant:"outline",size:"sm",onClick:()=>te({type:"bulk"}),isDisabled:!qs,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(K,{leftIcon:e(mp,{}),colorScheme:"primary",size:"sm",onClick:()=>I(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),o?e(Ke,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((ne,at)=>e(T,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:n(ue,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${at}`))}):n(Ke,{columns:{base:1,md:2,xl:3},spacing:4,children:[_i&&e(T,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:Zt?n(ue,{spacing:3,align:"center",justify:"center",children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):jt?n(ue,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:jt}),e(K,{size:"sm",variant:"outline",onClick:()=>{ge(),Ge()},children:t("refresh","Refresh")})]}):Ae?n(ue,{align:"stretch",spacing:4,children:[n(ke,{spacing:2,children:[n(U,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:ls}),e(gt,{colorScheme:"purple",size:"sm",children:Be!=null&&Be.version?`Xray ${Be.version}`:t("nodes.versionUnknown","Version unknown")})]}),n(U,{spacing:2,align:"center",children:[e(lo,{status:Or,compact:!0}),Ae.limit_exceeded&&e(gt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Be!=null&&Be.started?t("nodes.masterStartedAt",{date:$e(Be.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),Ae.message&&n(Dr,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(Ar,{}),e(bn,{fontSize:"sm",children:Ae.message})]}),e(Yn,{}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:hr})]}),n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:or})]}),Kt&&n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:Kt})]}),Nr&&n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:Nr})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[n(xr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(xe,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:ye,onChange:ne=>zr(ne.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(Pr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(K,{colorScheme:"primary",size:"sm",onClick:nn,isDisabled:!Mt||Pt||we,isLoading:we,children:t("save","Save")}),e(K,{variant:"ghost",size:"sm",onClick:Tt,isDisabled:Ve===null||we,isLoading:we&&Ve===null,children:t("nodes.clearDataLimit","Clear limit")})]}),Pt&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),n(ke,{direction:{base:"column",sm:"row"},spacing:2,children:[e(K,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>te({type:"master"}),isLoading:me,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(K,{size:"sm",variant:"outline",onClick:()=>j({type:"master"}),isLoading:y,children:t("nodes.geoDialog.updateMasterButton")}),e(K,{size:"sm",variant:"outline",colorScheme:"red",onClick:kr,isLoading:Fe,children:t("nodes.resetUsage","Reset usage")})]})]}):n(ue,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(K,{size:"sm",variant:"outline",onClick:()=>{ge(),Ge()},children:t("refresh","Refresh")})]})},"master-node"),Js.length>0?Js.map(ne=>{var ka,wa,va,Ca;const at=ne.status||"error",et=ne==null?void 0:ne.id,mt=at!=="disabled"&&at!=="limited",It=et!=null?Ce[et]:void 0,Wr=It!=null?It:mt,Jr=et!=null&&ae===et&&ir,qr=et!=null&&pe===et,xn=et!=null&&Q===et,Pi=be&&et!=null&&O===et,Ul=N&&et!=null&&ze===et,xa=e(lo,{status:at,compact:!0}),Ll=at==="error"&&ne.message?e(st,{label:ne.message,hasArrow:!0,placement:"top",openDelay:300,children:e(T,{as:"span",children:xa})}):xa;return e(T,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:n(ue,{align:"stretch",spacing:4,children:[n(ke,{spacing:2,children:[n(U,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:ne.name||t("nodes.unnamedNode","Unnamed node")}),e(dt,{size:"sm",colorScheme:"primary",isChecked:Wr,onChange:()=>xt(ne),isDisabled:Jr,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),ne.status==="error"&&e(K,{size:"sm",variant:"outline",leftIcon:e(po,{}),onClick:()=>Qt(ne),isLoading:nr,children:t("nodes.reconnect")})]}),n(U,{spacing:2,flexWrap:"wrap",children:[Ll,n(U,{spacing:1,align:"center",children:[e(gt,{colorScheme:"blue",size:"sm",children:ne.xray_version?`Xray ${ne.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(gt,{colorScheme:"green",size:"sm",children:ne.node_service_version?t("nodes.nodeServiceVersionTag",{version:ne.node_service_version}):t("nodes.nodeServiceVersionUnknown","Node version unknown")}),e(K,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>et&&te({type:"node",node:ne}),isLoading:qr,isDisabled:!et,children:t("nodes.updateCoreAction")})]}),e(K,{size:"xs",variant:"ghost",onClick:()=>et&&j({type:"node",node:ne}),isLoading:xn,isDisabled:!et,children:t("nodes.updateGeoAction","Update geo")}),e(K,{size:"xs",variant:"ghost",colorScheme:"orange",onClick:()=>wr(ne),isLoading:Pi,isDisabled:!et,children:t("nodes.restartServiceAction","Restart node service")}),e(K,{size:"xs",variant:"ghost",colorScheme:"teal",onClick:()=>Rr(ne),isLoading:Ul,isDisabled:!et,children:t("nodes.updateServiceAction","Update node service")}),e(K,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>pr(ne),isLoading:Xt&&et!=null&&Re===et,isDisabled:!et,children:t("nodes.resetUsage","Reset usage")})]}),at==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(Yn,{}),n(Ke,{columns:{base:1,sm:2},spacingY:2,children:[n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:ne.address})]}),n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:ne.port})]}),n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:ne.api_port})]}),n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:ne.usage_coefficient})]}),n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:je(((ka=ne.uplink)!=null?ka:0)+((wa=ne.downlink)!=null?wa:0),2)})]}),n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:ne.data_limit!=null&&ne.data_limit>0?je(ne.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(Yn,{}),n(U,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[n(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(va=ne.id)!=null?va:"-"]}),n(Ko,{size:"sm",variant:"ghost",children:[e(Le,{"aria-label":t("edit"),icon:e(fp,{}),onClick:()=>b(ne)}),e(Le,{"aria-label":t("delete"),icon:e(gp,{}),colorScheme:"red",onClick:()=>v(ne)})]})]})]})},(Ca=ne.id)!=null?Ca:ne.name)}):e(T,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(cp,{isOpen:Boolean(Z),onClose:er,onSubmit:Ln,currentVersion:Ii,title:Di,description:Ai,allowPersist:(Z==null?void 0:Z.type)==="master",isSubmitting:sn}),e(pp,{isOpen:Boolean(z),onClose:pn,onSubmit:Mn,title:Gs,showMasterOptions:(z==null?void 0:z.type)==="master",isSubmitting:On}),e(Ts,{isOpen:he,leastDestructiveRef:V,onClose:Kr,children:e(vt,{children:n(Es,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(Ct,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(mn=(Sn=H==null?void 0:H.name)!=null?Sn:H==null?void 0:H.address)!=null?mn:t("nodes.thisNode","this node")})}),n(Nt,{children:[e(K,{ref:V,onClick:Kr,children:t("cancel","Cancel")}),e(K,{colorScheme:"red",onClick:fe,ml:3,isLoading:Xt,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Ts,{isOpen:F,leastDestructiveRef:We,onClose:Ue,children:e(vt,{children:n(Es,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(Ct,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:ls})}),n(Nt,{children:[e(K,{ref:We,onClick:Ue,children:t("cancel","Cancel")}),e(K,{colorScheme:"red",onClick:()=>Xe(),ml:3,isLoading:Fe,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(uo,{isOpen:M,onClose:()=>I(!1),mutate:dr,isLoading:$t,isAddMode:!0}),e(uo,{isOpen:!!ie,onClose:()=>b(null),node:ie||void 0,mutate:ur,isLoading:rr}),e(op,{deleteCallback:()=>C.invalidateQueries(br)})]})},xp=ns(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([_e("/core").then(({version:s,started:r,logs_websocket:l})=>{t({version:s,started:r,logs_websocket:l})}).catch(s=>{throw console.error("Error fetching /core:",s),s}),_e("/core/config").then(s=>{t({config:s})}).catch(s=>{throw console.error("Error fetching /core/config:",s),s})])}finally{t({isLoading:!1})}},updateConfig:s=>(t({isPostLoading:!0}),_e("/core/config",{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>_e("/core/restart",{method:"POST"})}));const sa=d.exports.forwardRef(({json:t,onChange:s,mode:r="code"},l)=>{const{colorMode:o}=$r(),a=d.exports.useRef(null),i=d.exports.useRef(null),c=d.exports.useRef(s),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=s},[s]);const p=d.exports.useCallback(D=>{u.current=D,c.current(D)},[]);d.exports.useEffect(()=>{if(!a.current)return;const D=new Vc(a.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:o==="dark"?"ace/theme/one_dark":"ace/theme/github"});i.current=D;const k=D.aceEditor;k&&(k.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),k.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?D.setText(t):t!==void 0&&D.set(t)}catch{typeof t=="string"&&D.updateText(t)}return()=>{D.destroy(),i.current=null}},[]),d.exports.useEffect(()=>{const D=i.current;if(!D)return;const x=(C=>{if(C==null)return"";if(typeof C=="string")return C;try{return JSON.stringify(C,null,2)}catch{return""}})(t);if(x===null)return;if(u.current!==null){let C=u.current;try{C=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,C===x)return}let v=null;try{v=D.getText()}catch{v=null}if(v!==x)if(typeof t=="string")try{D.updateText(x)}catch{D.setText(x)}else{const C=t==null?{}:t;try{D.update(C)}catch{D.set(C)}}},[t]),d.exports.useEffect(()=>{const D=i.current;if(!!D)try{D.getMode&&D.getMode()!==r?D.setMode(r):D.getMode||D.setMode(r)}catch{D.setMode(r)}},[r]),d.exports.useEffect(()=>{var k;const D=(k=i.current)==null?void 0:k.aceEditor;!D||D.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github")},[o]);const m=nt("gray.300","whiteAlpha.300"),g=nt("surface.light","surface.dark"),A=nt("sm","none");return e(T,{ref:l,border:"1px solid",borderColor:m,bg:g,borderRadius:"lg",h:"full",boxShadow:A,overflow:"hidden",children:e(T,{height:"full",ref:a})})}),kp=ee(Us,{baseStyle:{w:4,h:4}}),wp=ee(Qo,{baseStyle:{w:4,h:4}}),Tl=({triggerLabel:t,title:s,children:r})=>{const l=Sr({base:!0,md:!1});return n(Ls,{placement:l?"bottom":"right",isLazy:!0,children:[e(Ms,{children:e(K,{size:"xs",variant:"outline",children:t!=null?t:e(kp,{})})}),n(Os,{children:[e(Ws,{}),e(nl,{}),s&&e($c,{fontWeight:"semibold",children:s}),e(Fs,{children:r})]})]})},vp=({chips:t,color:s="blue"})=>{const r=t[0],l=t.slice(1);return n(U,{spacing:2,align:"center",children:[r?e(gt,{size:"sm",colorScheme:s,children:r}):e(h,{color:"gray.400",children:"-"}),l.length>0&&e(Tl,{triggerLabel:n(gt,{size:"sm",children:["+",l.length]}),title:"Details",children:e(ue,{align:"stretch",children:t.map((o,a)=>e(U,{justify:"space-between",children:e(h,{children:o})},a))})})]})},Cp=({text:t,label:s})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:o}=sl(t!=null?t:"");return e(U,{spacing:2,align:"center",children:e(Tl,{triggerLabel:r,title:s,children:n(ue,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),n(U,{children:[e(Le,{"aria-label":"copy",size:"sm",icon:e(wp,{}),onClick:o}),e(h,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},go=500,_p=t=>{try{let s=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(s.protocol==="https:"?"wss://":"ws://")+Lo([s.host+s.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+Zn()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}},El=({showTitle:t=!0})=>{const{t:s}=Je(),{data:r}=Sa(),[l,o]=d.exports.useState(""),[a,i]=d.exports.useState([]),c=d.exports.useRef(null),[u,p]=d.exports.useState(!0),{colorMode:m}=$r(),g=b=>{if(b!==l){if(!b){o(""),i([]);return}o(b),i([])}},A=d.exports.useCallback(Kc.exports.debounce(b=>{i(M=>M.length>=go?[...M.slice(M.length-go+1),b]:[...M,b])},50),[]);d.exports.useEffect(()=>()=>{A.cancel()},[A]);const{readyState:D}=Jc(_p(l),{onMessage:b=>{var M;A((M=b.data)!=null?M:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const b=c.current;if(!b)return;const M=()=>{const W=b.scrollHeight-b.scrollTop-b.clientHeight<=32;p(W)};return b.addEventListener("scroll",M),M(),()=>{b.removeEventListener("scroll",M)}},[]),d.exports.useEffect(()=>{u&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[a,u]);const k=d.exports.useMemo(()=>{const b=m==="dark";return{error:{bg:b?"rgba(248, 113, 113, 0.16)":"red.50",color:b?"#fed7d7":"#c53030",border:b?"#f87171":"#feb2b2"},warn:{bg:b?"rgba(251, 191, 36, 0.18)":"orange.50",color:b?"#fefcbf":"#975a16",border:b?"#fbbf24":"#f6ad55"},info:{bg:b?"rgba(96, 165, 250, 0.18)":"blue.50",color:b?"#bfdbfe":"#1a56db",border:b?"#60a5fa":"#63b3ed"},debug:{bg:b?"rgba(148, 163, 184, 0.16)":"gray.100",color:b?"#e2e8f0":"#1f2933",border:b?"#94a3b8":"#cbd5e1"},default:{bg:b?"rgba(30, 64, 175, 0.1)":"gray.50",color:b?"#e2e8f0":"#1f2933",border:b?"#475569":"#e2e8f0"}}},[m]),x=nt("#f5f7fb","#1f2329"),v=nt("gray.200","gray.600"),C=nt("gray.500","gray.400"),R=nt("white","gray.700"),ie=b=>/error|failed|exception/i.test(b)?"error":/warn/i.test(b)?"warn":/info/i.test(b)?"info":/debug/i.test(b)?"debug":"default";return n(ue,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("header.xrayLogs")}),n(ke,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[n(ke,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(r==null?void 0:r[0])&&n(tt,{size:"sm",w:{base:"full",sm:"auto"},bg:R,onChange:b=>g(b.target.value),value:l,children:[e("option",{value:"",children:s("core.master")}),r.map(b=>e("option",{value:String(b.id),children:s(b.name)},b.address))]}),e(h,{fontSize:"sm",color:C,children:s(`core.socket.${D}`)})]}),e(h,{fontSize:"xs",color:C,children:u?s("core.autoScrollOn","Auto-scroll: On"):s("core.autoScrollOff","Auto-scroll: Off")})]}),e(T,{border:"1px solid",borderColor:v,bg:x,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:c,fontFamily:"mono",fontSize:"sm",children:e(ue,{align:"stretch",spacing:2,children:a.map((b,M)=>{var ve;const I=ie(b),W=(ve=k[I])!=null?ve:k.default;return e(T,{bg:W.bg,color:W.color,borderLeftWidth:3,borderLeftColor:W.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(ee.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:b})},`${b}-${M}`)})})})]})},Dp=ee(dn),Ap=ee(il),lr={tag:"",protocol:se.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:vl.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},Bn=t=>{const s={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case se.VMess:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case se.VLESS:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case se.Trojan:s.servers=[{address:r,port:l,password:t.password||void 0}];break;case se.Shadowsocks:s.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case se.Socks:case se.HTTP:s.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case se.Freedom:s.domainStrategy=t.freedomStrategy||void 0;break;case se.Blackhole:s.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case se.DNS:s.network=t.dnsNetwork,s.address=t.dnsAddress||void 0,s.port=Number(t.dnsPort)||void 0;break;case se.Wireguard:s.secretKey=t.wireguardSecret||void 0,s.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,s.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const o=new fn;o.network=t.network,o.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?o.tcp=new cn(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?o.ws=new Nn(t.wsPath,t.wsHost,0):t.network==="grpc"&&(o.grpc=new zn(t.grpcServiceName,"",!1)),t.tlsEnabled&&(o.tls=new Rn(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(o.reality=new rs(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const i=new qt(t.tag,t.protocol,s,o,void 0).toJson();return i.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(i.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),i},Ip=({isOpen:t,onClose:s,mode:r,initialOutbound:l,onSubmitOutbound:o})=>{const{t:a}=Je(),i=Ht(),c=nt("gray.50","whiteAlpha.100"),{control:u,register:p,reset:m,handleSubmit:g,watch:A,getValues:D,setValue:k,formState:{isValid:x}}=Mr({defaultValues:lr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:v,append:C,remove:R}=Jn({control:u,name:"wireguardPeers"}),ie=A("protocol"),b=A("network"),M=A("tlsEnabled"),I=A("realityEnabled"),W=A("tcpType"),ve=A("muxEnabled"),Z=a("validation.required",{defaultValue:"Required"}),te=a("validation.invalidPort",{defaultValue:"Invalid port"}),z=ie||se.VLESS,j=![se.Freedom,se.Blackhole,se.DNS,se.Wireguard].includes(z),pe=[se.VMess,se.VLESS].includes(z),Y=[se.Trojan,se.Shadowsocks].includes(z),Q=z===se.Shadowsocks,P=z===se.DNS,me=Ft({control:u}),[Ie,De]=d.exports.useState(0),[L,y]=d.exports.useState(()=>Bn(lr)),[E,ae]=d.exports.useState(()=>JSON.stringify(Bn(lr),null,2)),[re,Ce]=d.exports.useState(null),[Te,Re]=d.exports.useState(""),Me=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;De(0),Ce(null),Re("");const ce=l?B(l):lr;Me.current=!0,m(ce);const oe=Bn(ce);y(oe),ae(JSON.stringify(oe,null,2))},[l,t,m]),d.exports.useEffect(()=>{if(!me)return;if(Me.current){Me.current=!1;return}const ce=Bn(me);y(ce);const oe=JSON.stringify(ce,null,2);ae(V=>V===oe?V:oe),Ce(null)},[me]);const H=d.exports.useMemo(()=>[se.VLESS,se.VMess,se.Trojan,se.Shadowsocks,se.Socks,se.HTTP,se.Freedom,se.Blackhole,se.DNS,se.Wireguard],[]),B=ce=>{var ht,ft,q,F,Se,Ue,We,Be,le,ge,Oe,Ae,lt,pt,Ge,$t,dr,rr,ur,nr,Qt,sr,ir,Xt,ar,J,be,G,N,we,Ee,Fe,Xe,bt,ct,Pt,Mt,Zt,jt,Er,Ve,St,Nr,Or,hr,or,Kt,zr,nn,Tt,kr,xt,pr,wr,Rr;const oe=qt.fromJson(ce),V={...lr,tag:(ht=ce==null?void 0:ce.tag)!=null?ht:"",protocol:(oe==null?void 0:oe.protocol)||lr.protocol,sendThrough:(ft=ce==null?void 0:ce.sendThrough)!=null?ft:"",muxEnabled:Boolean((q=ce==null?void 0:ce.mux)==null?void 0:q.enabled),muxConcurrency:Number((Se=(F=ce==null?void 0:ce.mux)==null?void 0:F.concurrency)!=null?Se:lr.muxConcurrency)},ye=oe==null?void 0:oe.stream;switch(V.network=(Ue=ye==null?void 0:ye.network)!=null?Ue:lr.network,V.tlsEnabled=(ye==null?void 0:ye.security)==="tls",V.realityEnabled=(ye==null?void 0:ye.security)==="reality",V.tlsServerName=(Be=(We=ye==null?void 0:ye.tls)==null?void 0:We.serverName)!=null?Be:"",V.realityPublicKey=(ge=(le=ye==null?void 0:ye.reality)==null?void 0:le.publicKey)!=null?ge:"",V.realityShortId=(Ae=(Oe=ye==null?void 0:ye.reality)==null?void 0:Oe.shortId)!=null?Ae:"",(ye==null?void 0:ye.network)==="tcp"&&ye.tcp&&(V.tcpType=ye.tcp.type,V.tcpHost=(lt=ye.tcp.host)!=null?lt:"",V.tcpPath=(pt=ye.tcp.path)!=null?pt:""),(ye==null?void 0:ye.network)==="ws"&&ye.ws&&(V.wsHost=(Ge=ye.ws.host)!=null?Ge:"",V.wsPath=($t=ye.ws.path)!=null?$t:""),(ye==null?void 0:ye.network)==="grpc"&&ye.grpc&&(V.grpcServiceName=(dr=ye.grpc.serviceName)!=null?dr:""),oe!=null&&oe.hasAddressPort()&&(V.address=(Qt=(nr=(rr=oe.settings)==null?void 0:rr.address)!=null?nr:(ur=ce==null?void 0:ce.settings)==null?void 0:ur.address)!=null?Qt:"",V.port=Number((ar=(Xt=(sr=oe.settings)==null?void 0:sr.port)!=null?Xt:(ir=ce==null?void 0:ce.settings)==null?void 0:ir.port)!=null?ar:lr.port)),V.protocol){case se.VMess:{const fe=oe.settings;V.id=(J=fe==null?void 0:fe.id)!=null?J:"",V.vnextEncryption=(be=fe==null?void 0:fe.security)!=null?be:lr.vnextEncryption,V.address=(G=fe==null?void 0:fe.address)!=null?G:V.address,V.port=Number((N=fe==null?void 0:fe.port)!=null?N:V.port);break}case se.VLESS:{const fe=oe.settings;V.id=(we=fe==null?void 0:fe.id)!=null?we:"",V.flow=(Ee=fe==null?void 0:fe.flow)!=null?Ee:"",V.encryption=(Fe=fe==null?void 0:fe.encryption)!=null?Fe:V.encryption,V.address=(Xe=fe==null?void 0:fe.address)!=null?Xe:V.address,V.port=Number((bt=fe==null?void 0:fe.port)!=null?bt:V.port);break}case se.Trojan:{const fe=oe.settings;V.password=(ct=fe==null?void 0:fe.password)!=null?ct:"",V.address=(Pt=fe==null?void 0:fe.address)!=null?Pt:V.address,V.port=Number((Mt=fe==null?void 0:fe.port)!=null?Mt:V.port);break}case se.Shadowsocks:{const fe=oe.settings;V.password=(Zt=fe==null?void 0:fe.password)!=null?Zt:"",V.method=(jt=fe==null?void 0:fe.method)!=null?jt:lr.method,V.address=(Er=fe==null?void 0:fe.address)!=null?Er:V.address,V.port=Number((Ve=fe==null?void 0:fe.port)!=null?Ve:V.port);break}case se.Socks:case se.HTTP:{const fe=(V.protocol===se.Socks,oe.settings);V.user=(St=fe==null?void 0:fe.user)!=null?St:"",V.pass=(Nr=fe==null?void 0:fe.pass)!=null?Nr:"",V.address=(Or=fe==null?void 0:fe.address)!=null?Or:V.address,V.port=Number((hr=fe==null?void 0:fe.port)!=null?hr:V.port);break}case se.DNS:{const fe=oe.settings;V.dnsNetwork=(or=fe==null?void 0:fe.network)!=null?or:lr.dnsNetwork,V.dnsAddress=(Kt=fe==null?void 0:fe.address)!=null?Kt:"",V.dnsPort=Number((zr=fe==null?void 0:fe.port)!=null?zr:lr.dnsPort);break}case se.Freedom:{const fe=oe.settings;V.freedomStrategy=(nn=fe==null?void 0:fe.domainStrategy)!=null?nn:"";break}case se.Blackhole:{const fe=oe.settings;V.blackholeResponse=(Tt=fe==null?void 0:fe.type)!=null?Tt:"";break}case se.Wireguard:{const fe=oe.settings;V.wireguardSecret=(kr=fe==null?void 0:fe.secretKey)!=null?kr:"",V.wireguardAddress=(xt=fe==null?void 0:fe.address)!=null?xt:"";const Kr=(wr=(pr=fe==null?void 0:fe.peers)==null?void 0:pr.map(er=>{var pn,Ln,Mn;return{publicKey:(pn=er.publicKey)!=null?pn:"",allowedIPs:Array.isArray(er.allowedIPs)?er.allowedIPs.join(","):"",endpoint:(Ln=er.endpoint)!=null?Ln:"",keepAlive:Number((Mn=er.keepAlive)!=null?Mn:0)}}))!=null?wr:[];V.wireguardPeers=Kr.length>0?Kr:lr.wireguardPeers;break}}return((Rr=ce==null?void 0:ce.mux)==null?void 0:Rr.concurrency)!=null&&(V.muxConcurrency=Number(ce.mux.concurrency)),(!V.wireguardPeers||V.wireguardPeers.length===0)&&(V.wireguardPeers=lr.wireguardPeers),V},O=ce=>{ae(ce);try{const oe=JSON.parse(ce);Ce(null),y(oe),Me.current=!0;const V=B(oe);m(V)}catch(oe){Ce(oe.message)}},de=()=>{const ce=Te.trim();if(!ce){Ce(a("pages.outbound.configEmpty","Please paste a config link"));return}const oe=qt.fromLink(ce);if(!oe){Ce(a("pages.outbound.invalidConfig","Unsupported or invalid config link")),i({status:"error",duration:2500,position:"top",title:a("pages.outbound.configParseFailedTitle","Conversion failed"),description:a("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const V=oe.toJson(),ye=JSON.stringify(V,null,2);Re(""),O(ye),i({status:"success",duration:2e3,position:"top",title:a("pages.outbound.configConvertedTitle","Config converted"),description:a("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},ze=g(async ce=>{var V;const oe=Bn(ce);try{await o(oe),i({title:r==="edit"?a("pages.xray.outbound.updated","Outbound updated"):a("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),s()}catch(ye){i({title:((V=ye==null?void 0:ye.data)==null?void 0:V.detail)||(ye==null?void 0:ye.message)||a("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),it=()=>{s()},he=ce=>{if(De(ce),ce===1){const oe=Bn(D());y(oe);const V=JSON.stringify(oe,null,2);ae(ye=>ye===V?ye:V),Ce(null)}};return n(Rt,{size:"4xl",isOpen:t,onClose:it,scrollBehavior:"inside",children:[e(vt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),n(Ut,{as:"form",onSubmit:ze,children:[e(At,{children:r==="edit"?a("pages.xray.outbound.editOutbound","Edit Outbound"):a("pages.xray.outbound.addOutbound")}),e(zt,{}),e(Ct,{children:n(ss,{variant:"enclosed",colorScheme:"primary",index:Ie,onChange:he,children:[n(is,{children:[e(Bt,{children:a("form")}),e(Bt,{children:a("json")})]}),n(as,{children:[e(Vt,{children:n(ue,{spacing:6,align:"stretch",children:[n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.basicSettings","Basic settings")}),n(ue,{spacing:3,align:"stretch",children:[n(w,{isRequired:!0,children:[e(_,{children:a("pages.xray.outbound.tag")}),e(xe,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:Z})})]}),n(U,{children:[n(w,{isRequired:!0,children:[e(_,{children:a("protocol")}),e(tt,{size:"sm",...p("protocol"),children:H.map(ce=>e("option",{value:ce,children:ce},ce))})]}),n(w,{children:[e(_,{children:a("pages.xray.outbound.sendThrough")}),e(xe,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),j&&n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.endpoint","Endpoint")}),n(ue,{spacing:3,align:"stretch",children:[n(w,{isRequired:j,children:[e(_,{children:a("pages.outbound.address","Address")}),e(xe,{size:"sm",placeholder:"example.com",...p("address",{required:j?Z:!1})})]}),n(U,{children:[n(w,{isRequired:j,children:[e(_,{children:a("pages.outbound.port","Port")}),e(xe,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:j?Z:!1,valueAsNumber:!0,min:{value:1,message:te},max:{value:65535,message:te}})})]}),pe?n(w,{isRequired:pe,children:[e(_,{children:"ID"}),e(xe,{size:"sm",placeholder:"UUID",...p("id",{required:pe?Z:!1})})]}):Y?n(w,{isRequired:Y,children:[e(_,{children:a("password")}),e(xe,{size:"sm",placeholder:"password",...p("password",{required:Y?Z:!1})})]}):n(w,{children:[e(_,{children:a("username")}),e(xe,{size:"sm",placeholder:"username",...p("user")})]})]}),z===se.Shadowsocks&&n(w,{isRequired:Q,children:[e(_,{children:a("pages.outbound.method","Method")}),e(tt,{size:"sm",...p("method",{required:Q?Z:!1}),children:Object.values(vl).map(ce=>e("option",{value:ce,children:ce},ce))})]}),z===se.VLESS&&n(U,{children:[n(w,{children:[e(_,{children:a("pages.outbound.encryption","Encryption")}),e(xe,{size:"sm",placeholder:"none",...p("encryption")})]}),n(w,{children:[e(_,{children:"Flow"}),e(xe,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),z===se.VMess&&n(w,{children:[e(_,{children:a("pages.outbound.security","User security")}),e(xe,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),z===se.DNS&&n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.dnsSettings","DNS settings")}),n(U,{children:[n(w,{children:[e(_,{children:a("pages.outbound.network")}),n(tt,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),n(w,{isRequired:P,children:[e(_,{children:a("pages.outbound.port")}),e(xe,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:P?Z:!1,valueAsNumber:!0,min:{value:1,message:te},max:{value:65535,message:te}})})]})]}),n(w,{mt:3,isRequired:P,children:[e(_,{children:a("pages.outbound.address")}),e(xe,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:P?Z:!1})})]})]}),z===se.Freedom&&n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.freedom","Freedom options")}),n(w,{children:[e(_,{children:a("pages.outbound.strategy","Strategy")}),e(xe,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),z===se.Blackhole&&n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.blackhole","Blackhole options")}),n(w,{children:[e(_,{children:a("pages.outbound.response")}),e(xe,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),z===se.Wireguard&&n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.wireguard","Wireguard")}),n(ue,{spacing:3,align:"stretch",children:[n(w,{children:[e(_,{children:a("pages.outbound.secretKey","Secret key")}),e(xe,{size:"sm",...p("wireguardSecret")})]}),n(w,{children:[e(_,{children:a("pages.outbound.address")}),e(xe,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),n(ue,{spacing:3,align:"stretch",children:[n(U,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:a("pages.outbound.peer","Peers")}),e(Le,{size:"sm","aria-label":a("add"),icon:e(Dp,{boxSize:3}),onClick:()=>C({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),v.map((ce,oe)=>n(T,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[n(U,{children:[n(w,{children:[e(_,{children:a("pages.outbound.publicKey","Public key")}),e(xe,{size:"sm",...p(`wireguardPeers.${oe}.publicKey`)})]}),v.length>1&&e(Le,{mt:6,size:"sm","aria-label":a("delete"),icon:e(Ap,{boxSize:3}),onClick:()=>R(oe)})]}),n(U,{mt:2,children:[n(w,{children:[e(_,{children:a("pages.outbound.allowedIPs","Allowed IPs")}),e(xe,{size:"sm",...p(`wireguardPeers.${oe}.allowedIPs`)})]}),n(w,{children:[e(_,{children:a("pages.outbound.endpoint","Endpoint")}),e(xe,{size:"sm",...p(`wireguardPeers.${oe}.endpoint`)})]})]}),n(w,{mt:2,children:[e(_,{children:a("pages.outbound.keepAlive","Keep alive")}),e(xe,{size:"sm",type:"number",...p(`wireguardPeers.${oe}.keepAlive`,{valueAsNumber:!0})})]})]},ce.id))]})]})]}),n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.transport","Transport")}),n(ue,{spacing:3,align:"stretch",children:[n(w,{children:[e(_,{children:a("pages.outbound.network")}),n(tt,{size:"sm",...p("network"),onChange:ce=>{p("network").onChange(ce)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),b==="tcp"&&n(U,{children:[n(w,{children:[e(_,{children:a("pages.outbound.tcpHeader","Header")}),n(tt,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),W==="http"&&n(Lt,{children:[n(w,{children:[e(_,{children:a("host")}),e(xe,{size:"sm",...p("tcpHost")})]}),n(w,{children:[e(_,{children:a("path")}),e(xe,{size:"sm",...p("tcpPath")})]})]})]}),b==="ws"&&n(U,{children:[n(w,{children:[e(_,{children:a("host")}),e(xe,{size:"sm",...p("wsHost")})]}),n(w,{children:[e(_,{children:a("path")}),e(xe,{size:"sm",...p("wsPath")})]})]}),b==="grpc"&&n(w,{children:[e(_,{children:a("serviceName")}),e(xe,{size:"sm",...p("grpcServiceName")})]})]})]}),n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.security")}),n(U,{children:[n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"TLS"}),e(dt,{size:"sm",isChecked:M,onChange:ce=>{const oe=ce.target.checked;k("tlsEnabled",oe),oe&&k("realityEnabled",!1)}})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"Reality"}),e(dt,{size:"sm",isChecked:I,onChange:ce=>{const oe=ce.target.checked;k("realityEnabled",oe),oe&&k("tlsEnabled",!1)}})]})]}),M&&n(w,{mt:3,children:[e(_,{children:"SNI"}),e(xe,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),I&&n(ue,{spacing:3,align:"stretch",mt:3,children:[n(w,{children:[e(_,{children:"SNI"}),e(xe,{size:"sm",...p("tlsServerName")})]}),n(w,{children:[e(_,{children:a("pages.outbound.publicKey")}),e(xe,{size:"sm",...p("realityPublicKey")})]}),n(w,{children:[e(_,{children:a("pages.outbound.shortId")}),e(xe,{size:"sm",...p("realityShortId")})]})]})]}),n(T,{children:[e(h,{fontWeight:"semibold",mb:3,children:a("pages.outbound.mux")}),n(w,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:a("pages.outbound.enableMux")}),e(dt,{size:"sm",...p("muxEnabled")})]}),ve&&n(w,{mt:3,children:[e(_,{children:a("pages.outbound.concurrency")}),e(xe,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(Vt,{children:n(ue,{align:"stretch",spacing:3,children:[n(w,{children:[e(_,{children:a("pages.outbound.configToJson","Config to JSON")}),n(U,{align:"start",spacing:3,children:[e(_r,{value:Te,onChange:ce=>Re(ce.target.value),placeholder:a("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(K,{size:"sm",colorScheme:"primary",onClick:de,children:a("pages.outbound.convertConfig","Convert")})]})]}),e(T,{height:"420px",children:e(sa,{json:L,onChange:O})}),re&&e(h,{fontSize:"sm",color:"red.500",children:re})]})})]})]})}),n(Nt,{gap:3,children:[e(K,{variant:"outline",onClick:it,children:a("cancel")}),e(K,{colorScheme:"primary",type:"submit",isDisabled:!x,children:a(r==="edit"?"save":"add")})]})]})]})},Pp=["tcp","udp","http","quic","grpc"],Tp=["http","tls","bittorrent","quic"],Ep=["field","chained"],Np=["","hybrid","linear"],Nl={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},Vn=t=>Array.isArray(t)?t.join(", "):"",$n=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean),zp=t=>{var r,l,o,a;if(!t)return{...Nl};const s=t.attrs?Object.entries(t.attrs).map(([i,c])=>({key:i,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(o=t.outboundTag)!=null?o:"",balancerTag:(a=t.balancerTag)!=null?a:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:Vn(t.source),sourcePort:Vn(t.sourcePort),domain:Vn(t.domain),ip:Vn(t.ip),user:Vn(t.user),port:Vn(t.port),attrs:s}},Rp=t=>{const s={};t.type&&(s.type=t.type),t.domainMatcher&&(s.domainMatcher=t.domainMatcher),t.outboundTag&&(s.outboundTag=t.outboundTag),t.balancerTag&&(s.balancerTag=t.balancerTag),t.inboundTags.length&&(s.inboundTag=t.inboundTags),t.networks.length&&(s.network=t.networks),t.protocols.length&&(s.protocol=t.protocols);const r=$n(t.sourceIps);r.length&&(s.source=r);const l=$n(t.sourcePort);l.length&&(s.sourcePort=l);const o=$n(t.domain);o.length&&(s.domain=o);const a=$n(t.ip);a.length&&(s.ip=a);const i=$n(t.user);i.length&&(s.user=i);const c=$n(t.port);if(c.length&&(s.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:p,value:m})=>{!p.trim()||(u[p.trim()]=m)}),Object.keys(u).length&&(s.attrs=u)}return s.type||(s.type="field"),s},Up=({isOpen:t,mode:s,initialRule:r,availableInboundTags:l,availableOutboundTags:o,availableBalancerTags:a,onSubmit:i,onClose:c})=>{const{t:u}=Je(),p=nt("white","gray.900"),{control:m,register:g,handleSubmit:A,reset:D,formState:{isSubmitting:k}}=Mr({defaultValues:Nl}),{fields:x,append:v,remove:C}=Jn({control:m,name:"attrs"});d.exports.useEffect(()=>{t&&D(zp(r))},[t,r,D]);const R=()=>v({key:"",value:""}),ie=()=>{c()},b=A(I=>{const W=Rp(I);i(W),ie()}),M=d.exports.useMemo(()=>s==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[s,u]);return n(Rt,{isOpen:t,onClose:ie,size:"xl",scrollBehavior:"inside",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{as:"form",onSubmit:b,bg:p,children:[e(At,{children:M}),e(zt,{}),e(Ct,{children:n(ke,{spacing:5,children:[n(w,{children:[e(_,{children:u("pages.xray.rules.type","Rule Type")}),e(tt,{...g("type"),size:"sm",children:Ep.map(I=>e("option",{value:I,children:I||u("core.none","None")},I))})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(tt,{...g("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:o.map(I=>e("option",{value:I,children:I},I))})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(tt,{...g("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:a.map(I=>e("option",{value:I,children:I},I))})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(ut,{control:m,name:"inboundTags",render:({field:I})=>e(si,{...I,children:e(ii,{spacing:3,children:l.map(W=>e(Is,{children:e(Ir,{value:W,children:W})},W))})})})]}),e(Yn,{}),n(w,{children:[e(_,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(tt,{...g("domainMatcher"),size:"sm",children:Np.map(I=>e("option",{value:I,children:I||u("core.default","Default")},I||"empty"))})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.network","Network")}),e(ut,{control:m,name:"networks",render:({field:I})=>e(si,{...I,children:e(ii,{spacing:3,children:Pp.map(W=>e(Is,{children:e(Ir,{value:W,children:W})},W))})})})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.protocol","Protocol")}),e(ut,{control:m,name:"protocols",render:({field:I})=>e(si,{...I,children:e(ii,{spacing:3,children:Tp.map(W=>e(Is,{children:e(Ir,{value:W,children:W})},W))})})})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.source","Source IPs")}),e(_r,{...g("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(_r,{...g("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.ip","Destination IPs")}),e(_r,{...g("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.domain","Domains")}),e(_r,{...g("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.user","Users")}),e(_r,{...g("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(w,{children:[e(_,{children:u("pages.xray.rules.port","Ports")}),e(_r,{...g("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(Yn,{}),n(T,{children:[n(w,{children:[e(_,{children:u("pages.xray.rules.attrs","Attributes")}),e(K,{onClick:R,size:"xs",leftIcon:e(dn,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),n(ke,{spacing:2,mt:3,children:[x.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),x.map((I,W)=>n(U,{spacing:2,align:"flex-start",children:[e(xe,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...g(`attrs.${W}.key`)}),e(xe,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...g(`attrs.${W}.value`)}),e(Le,{"aria-label":"Remove attribute",icon:e(la,{width:16}),size:"sm",variant:"ghost",onClick:()=>C(W)})]},I.id))]})]})]})}),n(Nt,{gap:3,children:[e(K,{variant:"outline",onClick:ie,children:u("cancel")}),e(K,{colorScheme:"primary",type:"submit",isLoading:k,children:s==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},Lp=({isOpen:t,onClose:s,form:r,setBalancersData:l,balancerIndex:o})=>{const{t:a}=Je(),i=Mr({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=i.handleSubmit(u=>{const p={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},m=r.getValues("config.routing.balancers")||[];o!==void 0?m[o]=p:m.push(p),r.setValue("config.routing.balancers",m,{shouldDirty:!0}),l(m.map((g,A)=>{var D;return{key:A,tag:g.tag||"",strategy:((D=g.strategy)==null?void 0:D.type)||"random",selector:g.selector||[],fallbackTag:g.fallbackTag||""}})),s()});return n(Rt,{isOpen:t,onClose:s,size:"sm",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(zt,{mt:3}),e(Ct,{children:e("form",{onSubmit:c,children:n(ue,{spacing:4,children:[n(w,{children:[e(_,{children:a("pages.xray.balancer.tag")}),e(xe,{...i.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),n(w,{children:[e(_,{children:a("pages.xray.balancer.balancerStrategy")}),e(tt,{...i.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),n(w,{children:[e(_,{children:a("pages.xray.balancer.balancerSelectors")}),e(xe,{...i.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),n(w,{children:[e(_,{children:a("pages.xray.balancer.fallbackTag")}),e(xe,{...i.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(K,{type:"submit",colorScheme:"primary",size:"sm",children:a(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},Mp=({isOpen:t,onClose:s,form:r,setDnsServers:l,dnsIndex:o})=>{const{t:a}=Je(),i=Mr({defaultValues:{address:"",domains:"",expectIPs:""}}),c=i.handleSubmit(u=>{const p={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},m=r.getValues("config.dns.servers")||[];o!==void 0?m[o]=p:m.push(p),r.setValue("config.dns.servers",m,{shouldDirty:!0}),l(m),s()});return n(Rt,{isOpen:t,onClose:s,size:"sm",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(zt,{mt:3}),e(Ct,{children:e("form",{onSubmit:c,children:n(ue,{spacing:4,children:[n(w,{children:[e(_,{children:a("pages.xray.dns.address")}),e(xe,{...i.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),n(w,{children:[e(_,{children:a("pages.xray.dns.domains")}),e(xe,{...i.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),n(w,{children:[e(_,{children:a("pages.xray.dns.expectIPs")}),e(xe,{...i.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(K,{type:"submit",colorScheme:"primary",size:"sm",children:a(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},Op=({isOpen:t,onClose:s,form:r,setFakeDns:l,fakeDnsIndex:o})=>{const{t:a}=Je(),i=Mr({defaultValues:{ipPool:"",poolSize:""}}),c=i.handleSubmit(u=>{const p={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},m=r.getValues("config.fakedns")||[];o!==void 0?m[o]=p:m.push(p),r.setValue("config.fakedns",m.length>0?m:null,{shouldDirty:!0}),l(m),s()});return n(Rt,{isOpen:t,onClose:s,size:"sm",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ut,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(zt,{mt:3}),e(Ct,{children:e("form",{onSubmit:c,children:n(ue,{spacing:4,children:[n(w,{children:[e(_,{children:a("pages.xray.fakedns.ipPool")}),e(xe,{...i.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),n(w,{children:[e(_,{children:a("pages.xray.fakedns.poolSize")}),e(xe,{...i.register("poolSize"),size:"sm",placeholder:"100"})]}),e(K,{type:"submit",colorScheme:"primary",size:"sm",children:a(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},ia={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},fo=t=>{var u,p,m,g,A,D,k,x,v,C,R,ie,b;if(!t)return{...ia};const s=(u=t.settings)!=null?u:{},l=(p=(Array.isArray(s.peers)?s.peers:[])[0])!=null?p:{},o=Array.isArray(s.address)?s.address:[],a=(g=(m=o.find(M=>typeof M=="string"&&M.endsWith("/32")))==null?void 0:m.replace("/32",""))!=null?g:"",i=(D=(A=o.find(M=>typeof M=="string"&&M.endsWith("/128")))==null?void 0:A.replace("/128",""))!=null?D:"",c=Array.isArray(s.reserved)?s.reserved.filter(M=>Number.isFinite(Number(M))).join(","):"";return{tag:(k=t.tag)!=null?k:"warp",privateKey:(v=(x=s.secretKey)!=null?x:s.privateKey)!=null?v:"",publicKey:(C=l.publicKey)!=null?C:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:a,addressV6:i,reserved:c,mtu:(R=s.mtu)!=null?R:1420,domainStrategy:(ie=s.domainStrategy)!=null?ie:"ForceIP",notes:typeof t.notes=="string"?t.notes:(b=s.notes)!=null?b:""}},Wp=t=>{const s=[];t.addressV4.trim()&&s.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&s.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(a=>Number(a.trim())).filter(a=>Number.isFinite(a)),o=qt.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:s,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?o.notes=t.notes.trim():delete o.notes,o},Fp=t=>{if(!t)return[];try{const s=atob(t);return Array.from(s).map(r=>r.charCodeAt(0))}catch{return[]}},Hp=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const s=t;return s.host?s.port?`${s.host}:${s.port}`:s.host:""}return""},Bp=(t,s)=>{var p,m,g,A,D,k,x,v,C,R,ie;if(!t||!(s!=null&&s.config))return null;const r=s.config,l=[],o=(m=(p=r.interface)==null?void 0:p.addresses)!=null?m:{};o.v4&&l.push(`${o.v4}/32`),o.v6&&l.push(`${o.v6}/128`);const i=(g=(Array.isArray(r.peers)?r.peers:[])[0])!=null?g:{},c=(D=(A=i.allowed_ips)!=null?A:i.allowedIPs)!=null?D:["0.0.0.0/0","::/0"];return qt.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(x=(k=r.interface)==null?void 0:k.mtu)!=null?x:1420,secretKey:t.private_key,address:l,reserved:Fp(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(C=(v=i.public_key)!=null?v:t.public_key)!=null?C:"",endpoint:Hp(i.endpoint),allowedIPs:c,keepAlive:(ie=(R=i.keep_alive)!=null?R:i.keepAlive)!=null?ie:0}]}})},bo=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},Vi=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":_n.sizeFormat(t),cr=({label:t,value:s})=>{const r=nt("gray.500","gray.400");return n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:s||"-"})]})},Vp=({isOpen:t,onClose:s,initialOutbound:r,onSave:l,onDelete:o})=>{var Te,Re,Me,H,B;const{t:a}=Je(),i=Ht(),[c,u]=d.exports.useState({...ia}),[p,m]=d.exports.useState(null),[g,A]=d.exports.useState(null),[D,k]=d.exports.useState(null),[x,v]=d.exports.useState(""),[C,R]=d.exports.useState(!1),[ie,b]=d.exports.useState(!1),[M,I]=d.exports.useState(!1),[W,ve]=d.exports.useState(!1),[Z,te]=d.exports.useState(!1);d.exports.useEffect(()=>{Kh()},[]);const z=d.exports.useCallback(async()=>{var O,de;R(!0);try{const ze=await _e("/core/warp",{method:"GET"});m((O=ze.account)!=null?O:null),A(null),k(null)}catch(ze){i({title:a("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((de=ze==null?void 0:ze.data)==null?void 0:de.detail)||(ze==null?void 0:ze.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{R(!1)}},[i,a]);d.exports.useEffect(()=>{t&&z().catch(()=>{})},[t,z]),d.exports.useEffect(()=>{t&&u(fo(r))},[r,t]),d.exports.useEffect(()=>{var O;v((O=p==null?void 0:p.license_key)!=null?O:"")},[p]);const j=(O,de)=>{u(ze=>({...ze,[O]:de}))},pe=nt("gray.600","gray.300"),Y=nt("gray.200","whiteAlpha.200"),Q=()=>{const O=bi();j("privateKey",O.privateKey),j("publicKey",O.publicKey),i({title:a("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},P=()=>{const O=Array.from({length:3},()=>Math.floor(Math.random()*256));j("reserved",O.join(","))},me=d.exports.useCallback((O,de)=>{if(!O||!de){k(null);return}const ze=Bp(O,de);ze&&(k(ze),u(fo(ze.toJson())))},[]),Ie=async()=>{var O;b(!0);try{const de=bi(),ze=await _e("/core/warp/register",{method:"POST",body:{private_key:de.privateKey,public_key:de.publicKey}});m(ze.account),A(ze.config),me(ze.account,ze.config),i({title:a("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(de){i({title:a("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((O=de==null?void 0:de.data)==null?void 0:O.detail)||(de==null?void 0:de.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{b(!1)}},De=async()=>{var O;if(!p){i({title:a("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}ve(!0);try{const de=await _e("/core/warp/config",{method:"GET"});A(de.config),me(p,de.config),i({title:a("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(de){i({title:a("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((O=de==null?void 0:de.data)==null?void 0:O.detail)||(de==null?void 0:de.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{ve(!1)}},L=async()=>{var O;if(!!x.trim()){I(!0);try{const de=await _e("/core/warp/license",{method:"POST",body:{license_key:x.trim()}});m(de.account),i({title:a("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(de){i({title:a("pages.xray.warp.licenseFailed","Failed to update license."),description:((O=de==null?void 0:de.data)==null?void 0:O.detail)||(de==null?void 0:de.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{I(!1)}}},y=async()=>{var O;te(!0);try{await _e("/core/warp",{method:"DELETE"}),m(null),A(null),k(null),o(),i({title:a("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(de){i({title:a("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((O=de==null?void 0:de.data)==null?void 0:O.detail)||(de==null?void 0:de.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{te(!1)}},E=()=>{if(!D)return;const O=D.toJson();l(O),i({title:a("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},ae=()=>{o(),u({...ia}),i({title:a("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},re=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){i({title:a("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const O=Wp(c);l(O),s()},Ce=d.exports.useMemo(()=>Boolean(r),[r]);return n(Rt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),n(Ut,{children:[e(At,{children:a("pages.xray.warp.manage","Manage WARP")}),e(zt,{}),e(Ct,{children:n(ue,{spacing:5,align:"stretch",children:[n(Dr,{status:"info",borderRadius:"md",children:[e(Ar,{}),e(bn,{children:a("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(T,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:p?n(ue,{spacing:4,align:"stretch",children:[n(Ke,{columns:{base:1,md:2},spacing:4,children:[e(cr,{label:a("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(cr,{label:a("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(cr,{label:a("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(cr,{label:a("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(cr,{label:a("pages.xray.warp.registeredAt","Registered at"),value:bo(p.created_at)}),e(cr,{label:a("pages.xray.warp.updatedAt","Updated at"),value:bo(p.updated_at)})]}),n(U,{spacing:3,flexWrap:"wrap",children:[e(K,{variant:"outline",onClick:De,isLoading:W,children:a("pages.xray.warp.fetchInfo","Refresh info")}),e(K,{variant:"ghost",colorScheme:"red",onClick:y,isLoading:Z,children:a("pages.xray.warp.removeAccount","Remove account")})]})]}):n(ue,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:pe,children:a("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(K,{colorScheme:"primary",onClick:Ie,isLoading:ie||C,children:a("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&n(T,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.licenseSection","WARP+/License key")}),n(U,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(xe,{value:x,onChange:O=>v(O.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(K,{colorScheme:"primary",onClick:L,isLoading:M,isDisabled:!x.trim(),children:a("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:pe,mt:2,children:a("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),n(T,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(U,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:a("pages.xray.warp.remoteConfig","Remote configuration")}),g?e(rn,{colorScheme:g.enabled?"green":"yellow",children:g.enabled?a("core.active","Active"):a("core.pending","Pending")}):e(rn,{colorScheme:"gray",children:a("core.empty","Empty")})]}),g?n(ke,{spacing:4,children:[n(Ke,{columns:{base:1,md:2},spacing:4,children:[e(cr,{label:a("core.name","Name"),value:(Te=g.name)!=null?Te:"-"}),e(cr,{label:a("core.model","Model"),value:(Re=g.model)!=null?Re:"-"}),e(cr,{label:a("core.status","Status"),value:g.enabled?a("core.enabled","Enabled"):a("core.disabled","Disabled")}),e(cr,{label:a("core.id","ID"),value:(Me=g.id)!=null?Me:"-"})]}),g.account&&n(Lt,{children:[e(Yn,{}),n(Ke,{columns:{base:1,md:3},spacing:4,children:[e(cr,{label:a("core.type","Type"),value:(H=g.account.account_type)!=null?H:"-"}),e(cr,{label:a("core.role","Role"),value:(B=g.account.role)!=null?B:"-"}),e(cr,{label:a("pages.xray.warp.premiumData","WARP+ data"),value:Vi(g.account.premium_data)}),e(cr,{label:a("core.quota","Quota"),value:Vi(g.account.quota)}),e(cr,{label:a("core.usage","Usage"),value:Vi(g.account.usage)})]})]}),n(U,{spacing:3,flexWrap:"wrap",children:[e(K,{colorScheme:"primary",onClick:E,isDisabled:!D,children:a("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(K,{variant:"ghost",onClick:()=>A(null),children:a("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:pe,children:a("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),n(T,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:a("pages.xray.warp.manualTitle","Manual outbound")}),n(ke,{spacing:4,children:[n(w,{isRequired:!0,children:[e(_,{children:a("pages.xray.outbound.tag","Tag")}),e(xe,{size:"sm",value:c.tag,onChange:O=>j("tag",O.target.value),placeholder:"warp"})]}),n(w,{isRequired:!0,children:[e(_,{children:a("pages.xray.warp.privateKey")}),e(_r,{size:"sm",value:c.privateKey,onChange:O=>j("privateKey",O.target.value),rows:2})]}),n(w,{isRequired:!0,children:[e(_,{children:a("pages.xray.warp.publicKey")}),e(_r,{size:"sm",value:c.publicKey,onChange:O=>j("publicKey",O.target.value),rows:2})]}),n(w,{children:[e(K,{size:"sm",colorScheme:"primary",onClick:Q,children:a("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:pe,mt:1,children:a("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),n(w,{isRequired:!0,children:[e(_,{children:a("pages.xray.warp.endpoint")}),e(xe,{size:"sm",value:c.endpoint,onChange:O=>j("endpoint",O.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),n(w,{children:[e(_,{children:a("pages.xray.warp.addressV4","Client IPv4")}),e(xe,{size:"sm",value:c.addressV4,onChange:O=>j("addressV4",O.target.value),placeholder:"172.16.0.2"}),e(Lr,{children:a("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),n(w,{children:[e(_,{children:a("pages.xray.warp.addressV6","Client IPv6")}),e(xe,{size:"sm",value:c.addressV6,onChange:O=>j("addressV6",O.target.value),placeholder:"2606:4700:****:****::****"})]}),n(w,{children:[e(_,{children:a("pages.xray.warp.reserved")}),e(xe,{size:"sm",value:c.reserved,onChange:O=>j("reserved",O.target.value),placeholder:"0,0,0"}),e(Lr,{children:a("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(K,{size:"xs",mt:2,variant:"ghost",onClick:P,children:a("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),n(w,{children:[e(_,{children:a("pages.xray.warp.mtu","MTU")}),e(Pn,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(O,de)=>j("mtu",de||1420),children:e(In,{})})]}),n(w,{children:[e(_,{children:a("pages.xray.warp.notes","Notes (optional)")}),e(_r,{size:"sm",rows:2,value:c.notes,onChange:O=>j("notes",O.target.value)})]})]})]})]})}),n(Nt,{display:"flex",justifyContent:"space-between",children:[Ce?e(K,{colorScheme:"red",variant:"outline",onClick:ae,children:a("delete")}):e("span",{}),n(U,{spacing:3,children:[e(K,{variant:"ghost",onClick:s,children:a("cancel")}),e(K,{colorScheme:"primary",onClick:re,children:a(Ce?"save":"add")})]})]})]})]})},fs=ee(dn,{baseStyle:{w:3.5,h:3.5}}),bs=ee(tn,{baseStyle:{w:4,h:4}}),ys=ee(yn,{baseStyle:{w:4,h:4}}),yo=ee(al,{baseStyle:{w:4,h:4}}),So=ee(ol,{baseStyle:{w:4,h:4}}),xo=ee(Vr,{baseStyle:{w:4,h:4}}),$p=ee(qc,{baseStyle:{w:4,h:4}}),Kp=ee(Yc,{baseStyle:{w:4,h:4}}),Jp=ee(Gc,{baseStyle:{w:4,h:4}}),qp=ee(Qc,{baseStyle:{w:4,h:4}}),Yp=ee(da,{baseStyle:{w:4,h:4}}),Gp=ee(Xc,{baseStyle:{w:4,h:4}}),Qp=ee(Zc,{baseStyle:{w:4,h:4}}),Xp=ee(jc,{baseStyle:{w:4,h:4}}),Zp=ee(ed,{baseStyle:{w:4,h:4}}),ko=ee(td,{baseStyle:{w:4,h:4}}),Ss={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},Zs=t=>JSON.stringify(t!=null?t:{}),wo=t=>Array.isArray(t)?t.join(","):t!=null?t:"",jp=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],$i=({title:t,children:s})=>{const r=nt("gray.50","whiteAlpha.100"),l=nt("gray.200","whiteAlpha.300");return n(T,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(T,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(T,{overflowX:"auto",children:e(Tn,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(Br,{children:s})})})]})},Fr=({label:t,controlId:s,children:r})=>{const l=nt("gray.700","whiteAlpha.800");return n(_t,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Ne,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(_,{htmlFor:s,mb:{base:2,md:0},color:l,children:t})}),e(Ne,{py:3,display:{base:"block",md:"table-cell"},children:e(w,{id:s,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(s)})})]})},xs=({children:t})=>{const s=nt("gray.200","whiteAlpha.200"),r=nt("white","blackAlpha.400"),l=nt("sm","none");return e(T,{borderWidth:"1px",borderColor:s,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(T,{overflowX:"auto",children:t})})},ks=({children:t,...s})=>{const r=nt("gray.50","whiteAlpha.100"),l=nt("gray.200","whiteAlpha.300"),o=nt("gray.300","whiteAlpha.300"),a=nt("gray.100","whiteAlpha.200"),i=nt("gray.50","whiteAlpha.100");return e(Tn,{size:"sm",w:"full",...s,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:o,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:a,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:i}},children:t})},em=()=>{var Gs,ds,us,hs;const{t}=Je(),{fetchCoreSettings:s,updateConfig:r,isLoading:l,config:o,isPostLoading:a,restartCore:i}=xp(),{onEditingCore:c}=wt(),u=Ht(),{isOpen:p,onOpen:m,onClose:g}=Gt(),{isOpen:A,onOpen:D,onClose:k}=Gt(),{isOpen:x,onOpen:v,onClose:C}=Gt(),{isOpen:R,onOpen:ie,onClose:b}=Gt(),{isOpen:M,onOpen:I,onClose:W}=Gt(),{isOpen:ve,onOpen:Z,onClose:te}=Gt(),z=Mr({defaultValues:{config:o||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),j=d.exports.useRef(Zs(z.getValues("config"))),pe=Ft({control:z.control,name:"config"}),Y=d.exports.useMemo(()=>Zs(pe)!==j.current,[pe]),[Q,P]=d.exports.useState([]),[me,Ie]=d.exports.useState([]),[De,L]=d.exports.useState([]),[y,E]=d.exports.useState([]),[ae,re]=d.exports.useState([]),[Ce,Te]=d.exports.useState([]),[Re,Me]=d.exports.useState(null),[H,B]=d.exports.useState(null),[O,de]=d.exports.useState(!1),[ze,it]=d.exports.useState("xraySetting"),[he,ce]=d.exports.useState(""),oe=Sr({base:!0,md:!1}),[V,ye]=d.exports.useState(0),[ht,ft]=d.exports.useState(""),[q,F]=d.exports.useState(""),Se=d.exports.useCallback(f=>f.map((S,X)=>{var qe,rt;return{key:`${X}-${(rt=(qe=S.tag)!=null?qe:S.protocol)!=null?rt:"outbound"}`,...S}}),[]),Ue=d.exports.useCallback(f=>{P(Se(f))},[Se]),We=d.exports.useCallback(()=>{const f=z.getValues("config.outbounds");return Array.isArray(f)?JSON.parse(JSON.stringify(f)):[]},[z]),Be=d.exports.useCallback(f=>{z.setValue("config.outbounds",f,{shouldDirty:!0}),Ue(f),ye(S=>S+1)},[z,Ue]),le=d.exports.useCallback(f=>f.map((S,X)=>{var qe,rt,Ye,yt,mr,Sn,mn,ne,at,et,mt,It,Wr,Jr,qr;return{key:`${X}-${(rt=(qe=S.outboundTag)!=null?qe:S.balancerTag)!=null?rt:"rule"}`,source:(Ye=S.source)!=null?Ye:[],sourcePort:(yt=S.sourcePort)!=null?yt:[],network:(mr=S.network)!=null?mr:[],protocol:(Sn=S.protocol)!=null?Sn:[],attrs:S.attrs?JSON.stringify(S.attrs,null,2):"",ip:(mn=S.ip)!=null?mn:[],domain:(ne=S.domain)!=null?ne:[],port:(at=S.port)!=null?at:[],inboundTag:(et=S.inboundTag)!=null?et:[],user:(mt=S.user)!=null?mt:[],outboundTag:(It=S.outboundTag)!=null?It:"",balancerTag:(Wr=S.balancerTag)!=null?Wr:"",type:(Jr=S.type)!=null?Jr:"field",domainMatcher:(qr=S.domainMatcher)!=null?qr:""}}),[]),ge=d.exports.useCallback(f=>{Ie(le(f))},[le]),Oe=d.exports.useCallback(f=>{z.setValue("config.routing.rules",f,{shouldDirty:!0}),ge(f),ye(S=>S+1)},[z,ge]),Ae=d.exports.useCallback(()=>{const f=z.getValues("config.routing.rules");return Array.isArray(f)?JSON.parse(JSON.stringify(f)):[]},[z]);d.exports.useEffect(()=>{const f=()=>{de(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",f),()=>{document.removeEventListener("fullscreenchange",f)}},[]),d.exports.useEffect(()=>(c(!0),s().then(()=>{console.log("Core settings fetched successfully")}).catch(f=>{u({title:t("core.errorFetchingConfig"),description:f.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>c(!1)),[s,c,u,t]),d.exports.useEffect(()=>{var f,S,X,qe;o&&(z.reset({config:o}),j.current=Zs(o),Ue((o==null?void 0:o.outbounds)||[]),ge(((f=o==null?void 0:o.routing)==null?void 0:f.rules)||[]),L(((X=(S=o==null?void 0:o.routing)==null?void 0:S.balancers)==null?void 0:X.map((rt,Ye)=>{var yt;return{key:Ye,tag:rt.tag||"",strategy:((yt=rt.strategy)==null?void 0:yt.type)||"random",selector:rt.selector||[],fallbackTag:rt.fallbackTag||""}}))||[]),E(((qe=o==null?void 0:o.dns)==null?void 0:qe.servers)||[]),re((o==null?void 0:o.fakedns)||[]),ce(o!=null&&o.observatory?"observatory":o!=null&&o.burstObservatory?"burstObservatory":""),ye(rt=>rt+1))},[o,z,Ue,ge]);const{mutate:lt,isLoading:pt}=Cr(i,{onSuccess:()=>{u({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:f=>{var S,X;u({title:t("core.generalErrorMessage"),description:((X=(S=f.response)==null?void 0:S.data)==null?void 0:X.detail)||f.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Ge=z.handleSubmit(({config:f})=>{r(f).then(()=>{z.reset({config:f}),j.current=Zs(f),u({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(S=>{let X=t("core.generalErrorMessage");typeof S.response._data.detail=="object"&&(X=S.response._data.detail[Object.keys(S.response._data.detail)[0]]),typeof S.response._data.detail=="string"&&(X=S.response._data.detail),u({title:X,status:"error",isClosable:!0,position:"top",duration:3e3})})}),$t=async()=>{const f=await _e("/panel/xray/getOutboundsTraffic");f!=null&&f.success&&Te(f.obj)},dr=()=>{B(null),g()},rr=()=>{B(null),m()},ur=f=>{B(f),m()},nr=f=>{const S=We();f<0||f>=S.length||(S.splice(f,1),Be(S))},Qt=(f,S)=>{const X=We();if(f<0||f>=X.length||S<0||S>=X.length)return;const[qe]=X.splice(f,1);X.splice(S,0,qe),Be(X)},sr=f=>{Qt(f,f-1)},ir=f=>{Qt(f,f+1)},Xt=()=>{Me(null),D()},ar=f=>{Me(f),D()},J=f=>{const S=Ae();S.splice(f,1),Oe(S)},be=(f,S)=>{const X=Ae();if(f<0||f>=X.length||S<0||S>=X.length)return;const[qe]=X.splice(f,1);X.splice(S,0,qe),Oe(X)},G=f=>{const S=Ae();Re!==null&&Re>=0&&Re<S.length?S[Re]=f:S.push(f),Oe(S),Me(null)},N=()=>{Me(null),k()},we=()=>{v()},Ee=f=>{v()},Fe=f=>{const S=[...De],X=S.splice(f,1)[0];z.setValue("config.routing.balancers",S,{shouldDirty:!0}),L(S);const qe={...z.getValues("config")};qe.observatory&&(qe.observatory.subjectSelector=qe.observatory.subjectSelector.filter(rt=>rt!==X.tag)),qe.burstObservatory&&(qe.burstObservatory.subjectSelector=qe.burstObservatory.subjectSelector.filter(rt=>rt!==X.tag)),z.setValue("config",qe,{shouldDirty:!0})},Xe=()=>{ie()},bt=f=>{ie()},ct=f=>{const S=[...y];S.splice(f,1),z.setValue("config.dns.servers",S,{shouldDirty:!0}),E(S)},Pt=()=>{I()},Mt=f=>{I()},Zt=f=>{const S=[...ae];S.splice(f,1),z.setValue("config.fakedns",S.length>0?S:null,{shouldDirty:!0}),re(S)},jt=f=>{var S,X,qe,rt,Ye;switch(f.protocol){case"vmess":case"vless":return((S=f.settings.vnext)==null?void 0:S.map(yt=>`${yt.address}:${yt.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((X=f.settings.servers)==null?void 0:X.map(yt=>`${yt.address}:${yt.port}`))||[];case"dns":return[`${(qe=f.settings)==null?void 0:qe.address}:${(rt=f.settings)==null?void 0:rt.port}`];case"wireguard":return((Ye=f.settings.peers)==null?void 0:Ye.map(yt=>yt.endpoint))||[];default:return[]}},Er=f=>{const S=Ce.find(X=>X.tag===f.tag);return S?`${_n.sizeFormat(S.up)} / ${_n.sizeFormat(S.down)}`:`${_n.sizeFormat(0)} / ${_n.sizeFormat(0)}`},Ve=d.exports.useMemo(()=>Array.isArray(pe==null?void 0:pe.outbounds)?pe.outbounds:[],[pe]),St=d.exports.useMemo(()=>{var f;return Array.isArray((f=pe==null?void 0:pe.routing)==null?void 0:f.rules)?pe.routing.rules:[]},[pe]),Nr=d.exports.useMemo(()=>{var f;return Array.from(new Set(((f=pe==null?void 0:pe.inbounds)!=null?f:[]).map(S=>S==null?void 0:S.tag).filter(S=>Boolean(S))))},[pe]),Or=d.exports.useMemo(()=>Array.from(new Set(Ve.map(f=>f==null?void 0:f.tag).filter(f=>Boolean(f)))),[Ve]),hr=d.exports.useMemo(()=>{var f,S;return Array.from(new Set(((S=(f=pe==null?void 0:pe.routing)==null?void 0:f.balancers)!=null?S:[]).map(X=>X==null?void 0:X.tag).filter(X=>Boolean(X))))},[pe]),or=d.exports.useMemo(()=>Ve.length===0?-1:Ve.findIndex(f=>(f==null?void 0:f.protocol)==="freedom"),[Ve]),Kt=d.exports.useMemo(()=>{var S,X;if(or<0)return"";const f=Ve[or];return(X=(S=f==null?void 0:f.settings)==null?void 0:S.domainStrategy)!=null?X:""},[or,Ve]),zr=f=>{const S=z.getValues("config")||{},X=Array.isArray(S.outbounds)?JSON.parse(JSON.stringify(S.outbounds)):[],qe=X.findIndex(yt=>(yt==null?void 0:yt.protocol)==="freedom");if(qe===-1)return;const rt={...X[qe]},Ye={...rt.settings||{}};f?Ye.domainStrategy=f:delete Ye.domainStrategy,rt.settings=Ye,X[qe]=rt,z.setValue("config.outbounds",X,{shouldDirty:!0}),P(X.map((yt,mr)=>({key:mr,...yt}))),ye(yt=>yt+1)},nn=d.exports.useMemo(()=>{var f;return(f=Ve.find(S=>(S==null?void 0:S.tag)==="warp"))!=null?f:null},[Ve]),kr=d.exports.useMemo(()=>Ve.findIndex(f=>(f==null?void 0:f.tag)==="warp"),[Ve])!==-1,xt=d.exports.useMemo(()=>{const f=St.find(S=>S.outboundTag==="warp");return Array.isArray(f==null?void 0:f.domain)?f.domain:[]},[St]),pr=f=>{const S=f.map(Ye=>Ye.trim()).filter((Ye,yt,mr)=>Ye.length>0&&mr.indexOf(Ye)===yt),X=Ae(),qe=X.findIndex(Ye=>Ye.outboundTag==="warp");if(S.length===0){qe!==-1&&(X.splice(qe,1),Oe(X));return}const rt={type:"field",outboundTag:"warp",domain:S};qe!==-1?X[qe]={...X[qe],...rt}:X.push(rt),Oe(X)},wr=f=>{const S=f.trim();!S||xt.includes(S)||pr([...xt,S])},Rr=f=>{pr(xt.filter(S=>S!==f))},fe=nt("white","blackAlpha.400"),Kr=nt("gray.200","whiteAlpha.200"),er=nt("gray.600","gray.300"),pn=f=>{var rt;const S=We(),X=(rt=f.tag)!=null?rt:"warp",qe=S.findIndex(Ye=>(Ye==null?void 0:Ye.tag)===X);qe>=0?S[qe]=f:S.push(f),Be(S)},Ln=()=>{const f=We(),S=f.findIndex(X=>(X==null?void 0:X.tag)==="warp");S!==-1&&(f.splice(S,1),Be(f),pr([]),ft(""),F(""))},Mn=f=>{const S=We();H!==null&&H>=0&&H<S.length?S[H]=f:S.push(f),Be(S),B(null)},Js=()=>{te()},qs=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{de(!1)}).catch(f=>{console.error("Error exiting fullscreen:",f)}):document.documentElement.requestFullscreen().then(()=>{de(!0)}).catch(f=>{console.error("Error entering fullscreen:",f)})},Ys=()=>{var S,X,qe,rt;const f=z.getValues("config")||{};switch(ze){case"inboundSettings":return JSON.stringify((S=f.inbounds)!=null?S:[],null,2);case"outboundSettings":return JSON.stringify((X=f.outbounds)!=null?X:[],null,2);case"routingRuleSettings":return JSON.stringify((rt=(qe=f.routing)==null?void 0:qe.rules)!=null?rt:[],null,2);case"xraySetting":default:return JSON.stringify(f!=null?f:{},null,2)}},Ci=f=>{var S,X,qe,rt;try{const Ye=JSON.parse(f),yt={...z.getValues("config")||{}};switch(ze){case"inboundSettings":yt.inbounds=Ye;break;case"outboundSettings":yt.outbounds=Ye,Ue(Ye);break;case"routingRuleSettings":yt.routing||(yt.routing={}),yt.routing.rules=Ye,ge(Ye);break;case"xraySetting":default:z.setValue("config",Ye,{shouldDirty:!0}),Ue((Ye==null?void 0:Ye.outbounds)||[]),ge(((S=Ye==null?void 0:Ye.routing)==null?void 0:S.rules)||[]),L(((qe=(X=Ye==null?void 0:Ye.routing)==null?void 0:X.balancers)==null?void 0:qe.map((mr,Sn)=>{var mn;return{key:Sn,tag:mr.tag||"",strategy:((mn=mr.strategy)==null?void 0:mn.type)||"random",selector:mr.selector||[],fallbackTag:mr.fallbackTag||""}}))||[]),E(((rt=Ye==null?void 0:Ye.dns)==null?void 0:rt.servers)||[]),re((Ye==null?void 0:Ye.fakedns)||[]);return}z.setValue("config",yt,{shouldDirty:!0})}catch{}},ls=()=>{var S,X;const f=z.getValues("config")||{};return he==="observatory"?JSON.stringify((S=f.observatory)!=null?S:{},null,2):he==="burstObservatory"?JSON.stringify((X=f.burstObservatory)!=null?X:{},null,2):""},cs=f=>{try{const S=JSON.parse(f),X={...z.getValues("config")||{}};he==="observatory"&&(X.observatory=S),he==="burstObservatory"&&(X.burstObservatory=S),z.setValue("config",X,{shouldDirty:!0})}catch{}},_i=f=>!f&&f!==0?[]:Array.isArray(f)?f.map(S=>typeof S=="string"?S.trim():String(S)).filter(Boolean):typeof f=="string"?f.split(",").map(S=>S.trim()).filter(Boolean):[String(f)],sn=(f,S="blue")=>{const X=_i(f);return X.length?e(vp,{chips:X,color:S}):e(h,{color:"gray.400",children:"-"})},On=f=>{if(f==null||f===""||typeof f=="string"&&!f.trim())return e(h,{color:"gray.400",children:"-"});const S=typeof f=="string"?f:String(f);return S.length>30?e(Cp,{text:S,label:t("details")}):e(h,{children:S})},Di=f=>{if(!f)return e(h,{color:"gray.400",children:"-"});try{const S=JSON.parse(f);if(S&&typeof S=="object"&&!Array.isArray(S)){const X=Object.entries(S);return X.length?e(T,{display:"flex",flexWrap:"wrap",gap:"1",children:X.map(([qe,rt])=>e(gt,{colorScheme:"purple",size:"sm",children:`${qe}: ${String(rt)}`},qe))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:f})},Ai=ls(),Ii=Ys();return n(ue,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(ke,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:n(ke,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(K,{size:"sm",colorScheme:"primary",isLoading:a,isDisabled:!Y||a,onClick:Ge,w:{base:"full",sm:"auto"},children:t("core.save")}),e(K,{size:"sm",leftIcon:e(xo,{}),isLoading:pt,onClick:()=>lt(),variant:"outline",w:{base:"full",sm:"auto"},children:t(pt?"core.restarting":"core.restartCore")})]})}),n(ss,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[n(is,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(Bt,{children:n(U,{spacing:2,align:"center",children:[e(Jp,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(Bt,{children:n(U,{spacing:2,align:"center",children:[e(qp,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(Bt,{children:n(U,{spacing:2,align:"center",children:[e(Yp,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(Bt,{children:n(U,{spacing:2,align:"center",children:[e(Gp,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(Bt,{children:n(U,{spacing:2,align:"center",children:[e(Qp,{}),e(h,{as:"span",children:t("DNS")})]})}),e(Bt,{children:n(U,{spacing:2,align:"center",children:[e(Xp,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(Bt,{children:n(U,{spacing:2,align:"center",children:[e(Zp,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),n(as,{children:[e(Vt,{children:n(ue,{spacing:4,align:"stretch",children:[n($i,{title:t("pages.xray.generalConfigs"),children:[e(Fr,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:f=>n(tt,{id:f,size:"sm",maxW:"220px",value:Kt,onChange:S=>zr(S.target.value),isDisabled:or===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(S=>e("option",{value:S,children:S},S))]})}),e(Fr,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:f=>e(ut,{name:"config.routing.domainStrategy",control:z.control,render:({field:S})=>e(tt,{...S,id:f,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(X=>e("option",{value:X,children:X},X))})})})]}),e(T,{borderWidth:"1px",borderColor:Kr,borderRadius:"lg",bg:fe,p:{base:3,md:4},children:n(ue,{align:"stretch",spacing:3,children:[n(U,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(K,{variant:"outline",size:"sm",leftIcon:e(ko,{}),onClick:Z,children:kr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:er,children:t("pages.xray.warpRoutingDesc")}),n(ii,{children:[xt.length===0&&e(Is,{children:e(gt,{colorScheme:"gray",variant:"subtle",children:e(Pa,{children:t("core.empty","Empty")})})}),xt.map(f=>e(Is,{children:n(gt,{colorScheme:"primary",borderRadius:"full",children:[e(Pa,{children:f}),e(rd,{"aria-label":t("core.remove"),onClick:()=>Rr(f)})]})},f))]}),n(U,{spacing:3,flexWrap:"wrap",children:[e(tt,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:ht,onChange:f=>{const{value:S}=f.target;S&&wr(S),ft("")},children:jp.map(f=>e("option",{value:f.value,children:f.label},f.value))}),n(U,{spacing:2,maxW:"320px",flex:"1",children:[e(xe,{size:"sm",value:q,onChange:f=>F(f.target.value),placeholder:"geosite:google"}),e(K,{size:"sm",colorScheme:"primary",onClick:()=>{wr(q),F("")},isDisabled:!q.trim(),children:t("core.add")})]})]})]})}),n($i,{title:t("pages.xray.statistics"),children:[e(Fr,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:f=>e(ut,{name:"config.policy.system.statsInboundUplink",control:z.control,render:({field:S})=>e(dt,{id:f,isChecked:!!S.value,onChange:X=>S.onChange(X.target.checked)})})}),e(Fr,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:f=>e(ut,{name:"config.policy.system.statsInboundDownlink",control:z.control,render:({field:S})=>e(dt,{id:f,isChecked:!!S.value,onChange:X=>S.onChange(X.target.checked)})})}),e(Fr,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:f=>e(ut,{name:"config.policy.system.statsOutboundUplink",control:z.control,render:({field:S})=>e(dt,{id:f,isChecked:!!S.value,onChange:X=>S.onChange(X.target.checked)})})}),e(Fr,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:f=>e(ut,{name:"config.policy.system.statsOutboundDownlink",control:z.control,render:({field:S})=>e(dt,{id:f,isChecked:!!S.value,onChange:X=>S.onChange(X.target.checked)})})})]}),n($i,{title:t("pages.xray.logConfigs"),children:[e(Fr,{label:t("pages.xray.logLevel"),controlId:"log-level",children:f=>e(ut,{name:"config.log.loglevel",control:z.control,render:({field:S})=>e(tt,{...S,id:f,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(X=>e("option",{value:X,children:X},X))})})}),e(Fr,{label:t("pages.xray.accessLog"),controlId:"access-log",children:f=>e(ut,{name:"config.log.access",control:z.control,render:({field:S})=>n(tt,{...S,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(X=>e("option",{value:X,children:X},X))]})})}),e(Fr,{label:t("pages.xray.errorLog"),controlId:"error-log",children:f=>e(ut,{name:"config.log.error",control:z.control,render:({field:S})=>n(tt,{...S,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(X=>e("option",{value:X,children:X},X))]})})}),e(Fr,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:f=>e(ut,{name:"config.log.maskAddress",control:z.control,render:({field:S})=>n(tt,{...S,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(X=>e("option",{value:X,children:X},X))]})})}),e(Fr,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:f=>e(ut,{name:"config.log.dnsLog",control:z.control,render:({field:S})=>e(dt,{id:f,isChecked:!!S.value,onChange:X=>S.onChange(X.target.checked)})})})]})]})}),e(Vt,{children:n(ue,{spacing:4,align:"stretch",children:[e(K,{leftIcon:e(fs,{}),...Ss,onClick:Xt,children:t("pages.xray.rules.add")}),e(xs,{children:n(ks,{minW:"1100px",children:[n(Xr,{children:[n(_t,{children:[e(He,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(He,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(He,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(He,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(He,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(He,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(He,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(He,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),n(_t,{children:[e(He,{children:t("IP",{defaultValue:"IP"})}),e(He,{children:t("port",{defaultValue:"Port"})}),e(He,{children:t("network",{defaultValue:"Network"})}),e(He,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(He,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(He,{children:t("IP",{defaultValue:"IP"})}),e(He,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(He,{children:t("port",{defaultValue:"Port"})}),e(He,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(He,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),n(Br,{children:[me.length===0&&e(_t,{children:e(Ne,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),me.map((f,S)=>n(_t,{children:[e(Ne,{children:n(ue,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:S+1}),n(U,{spacing:1,children:[e(Le,{"aria-label":"move up",icon:e(yo,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>be(S,S-1)}),e(Le,{"aria-label":"move down",icon:e(So,{}),size:"xs",variant:"ghost",isDisabled:S===me.length-1,onClick:()=>be(S,S+1)})]})]})}),e(Ne,{children:sn(f.source,"blue")}),e(Ne,{children:On(f.sourcePort)}),e(Ne,{children:sn(f.network,"purple")}),e(Ne,{children:sn(f.protocol,"green")}),e(Ne,{children:Di(f.attrs)}),e(Ne,{children:sn(f.ip,"blue")}),e(Ne,{children:sn(f.domain,"blue")}),e(Ne,{children:On(f.port)}),e(Ne,{children:sn(f.inboundTag,"teal")}),e(Ne,{children:sn(f.user,"cyan")}),e(Ne,{children:On(f.outboundTag)}),e(Ne,{children:On(f.balancerTag)}),e(Ne,{children:n(U,{spacing:1,children:[e(Le,{"aria-label":"edit",icon:e(ys,{}),size:"xs",variant:"ghost",onClick:()=>ar(S)}),e(Le,{"aria-label":"delete",icon:e(bs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>J(S)})]})})]},f.key))]})]})})]})}),e(Vt,{children:n(ue,{spacing:4,align:"stretch",children:[n(U,{children:[e(K,{leftIcon:e(fs,{}),...Ss,onClick:rr,children:t("pages.xray.outbound.addOutbound")}),e(K,{leftIcon:e(ko,{}),size:"xs",variant:"ghost",onClick:Z,children:kr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(K,{leftIcon:e(xo,{}),size:"xs",variant:"ghost",onClick:$t,children:t("refresh")})]}),e(xs,{children:n(ks,{minW:"880px",children:[e(Xr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.outbound.tag")}),e(He,{children:t("protocol")}),e(He,{children:t("pages.xray.outbound.address")}),e(He,{children:t("pages.inbounds.traffic")})]})}),e(Br,{children:Q.map((f,S)=>{var X,qe,rt;return n(_t,{children:[e(Ne,{children:n(U,{children:[e(h,{children:S+1}),e(Le,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(yo,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>sr(S)}),e(Le,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(So,{}),size:"xs",variant:"ghost",isDisabled:S===Q.length-1,onClick:()=>ir(S)}),e(Le,{"aria-label":"edit",icon:e(ys,{}),size:"xs",variant:"ghost",onClick:()=>ur(S)}),e(Le,{"aria-label":"delete",icon:e(bs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>nr(S)})]})}),e(Ne,{children:f.tag}),n(Ne,{children:[e(gt,{colorScheme:"purple",children:f.protocol}),["vmess","vless","trojan","shadowsocks"].includes(f.protocol)&&n(Lt,{children:[e(gt,{colorScheme:"blue",children:(X=f.streamSettings)==null?void 0:X.network}),((qe=f.streamSettings)==null?void 0:qe.security)==="tls"&&e(gt,{colorScheme:"green",children:"tls"}),((rt=f.streamSettings)==null?void 0:rt.security)==="reality"&&e(gt,{colorScheme:"green",children:"reality"})]})]}),e(Ne,{children:jt(f).map(Ye=>e(h,{children:Ye},Ye))}),e(Ne,{children:e(gt,{colorScheme:"green",children:Er(f)})})]},f.key)})})]})})]})}),e(Vt,{children:n(ue,{spacing:4,align:"stretch",children:[e(K,{leftIcon:e(fs,{}),...Ss,onClick:we,children:t("pages.xray.balancer.addBalancer")}),e(xs,{children:n(ks,{minW:"680px",children:[e(Xr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.balancer.tag")}),e(He,{children:t("pages.xray.balancer.balancerStrategy")}),e(He,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(Br,{children:De.map((f,S)=>n(_t,{children:[e(Ne,{children:n(U,{children:[e(h,{children:S+1}),e(Le,{"aria-label":"edit",icon:e(ys,{}),size:"xs",variant:"ghost",onClick:()=>Ee()}),e(Le,{"aria-label":"delete",icon:e(bs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Fe(S)})]})}),e(Ne,{children:f.tag}),e(Ne,{children:e(gt,{colorScheme:f.strategy==="random"?"purple":"green",children:f.strategy==="random"?"Random":f.strategy==="roundRobin"?"Round Robin":f.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Ne,{children:f.selector.map(X=>e(gt,{colorScheme:"blue",m:1,children:X},X))})]},f.key))})]})}),(((Gs=z.getValues("config"))==null?void 0:Gs.observatory)||((ds=z.getValues("config"))==null?void 0:ds.burstObservatory))&&n(ue,{spacing:3,align:"stretch",children:[e(gi,{onChange:f=>{ce(f),ye(S=>S+1)},value:he,children:n(U,{spacing:3,children:[((us=z.getValues("config"))==null?void 0:us.observatory)&&e(Gr,{value:"observatory",children:"Observatory"}),((hs=z.getValues("config"))==null?void 0:hs.burstObservatory)&&e(Gr,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(T,{h:"300px",children:e(sa,{json:Ai,onChange:f=>cs(f)},`obs-${he}-${V}`)})]})]})}),e(Vt,{children:n(ue,{spacing:4,align:"stretch",children:[n(w,{display:"flex",alignItems:"center",children:[e(_,{children:t("pages.xray.dns.enable")}),e(ut,{name:"config.dns",control:z.control,render:({field:f})=>e(dt,{isChecked:!!f.value,onChange:S=>{const X={...z.getValues("config")};S.target.checked?X.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete X.dns,delete X.fakedns),z.setValue("config",X,{shouldDirty:!0}),E([]),re([])}})})]}),y.length>0&&n(Lt,{children:[e(K,{leftIcon:e(fs,{}),...Ss,onClick:Xe,children:t("pages.xray.dns.add")}),e(xs,{children:n(ks,{minW:"720px",children:[e(Xr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.outbound.address")}),e(He,{children:t("pages.xray.dns.domains")}),e(He,{children:t("pages.xray.dns.expectIPs")})]})}),e(Br,{children:y.map((f,S)=>n(_t,{children:[e(Ne,{children:n(U,{children:[e(h,{children:S+1}),e(Le,{"aria-label":"edit",icon:e(ys,{}),size:"xs",variant:"ghost",onClick:()=>bt()}),e(Le,{"aria-label":"delete",icon:e(bs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ct(S)})]})}),e(Ne,{children:typeof f=="object"?f.address:f}),e(Ne,{children:typeof f=="object"?wo(f.domains):""}),e(Ne,{children:typeof f=="object"?wo(f.expectIPs):""})]},S))})]})})]}),ae.length>0&&n(Lt,{children:[e(K,{leftIcon:e(fs,{}),...Ss,onClick:Pt,children:t("pages.xray.fakedns.add")}),e(xs,{children:n(ks,{minW:"520px",children:[e(Xr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.fakedns.ipPool")}),e(He,{children:t("pages.xray.fakedns.poolSize")})]})}),e(Br,{children:ae.map((f,S)=>n(_t,{children:[e(Ne,{children:n(U,{children:[e(h,{children:S+1}),e(Le,{"aria-label":"edit",icon:e(ys,{}),size:"xs",variant:"ghost",onClick:()=>Mt()}),e(Le,{"aria-label":"delete",icon:e(bs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Zt(S)})]})}),e(Ne,{children:f.ipPool}),e(Ne,{children:f.poolSize})]},S))})]})})]})]})}),e(Vt,{children:n(ue,{spacing:4,align:"stretch",children:[n(T,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(T,{px:2,children:e(gi,{onChange:f=>{it(f),ye(S=>S+1)},value:ze,children:n(U,{spacing:3,wrap:"wrap",children:[e(Gr,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Gr,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Gr,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Gr,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),n(T,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(Le,{position:O?"fixed":"absolute",top:2,right:2,"aria-label":O?"Exit Full Screen":"Full Screen",icon:O?e(Kp,{}):e($p,{}),onClick:qs,zIndex:O?1101:10}),e(T,{w:O?"100vw":"100%",h:O?"100vh":"100%",position:O?"fixed":"relative",top:O?0:"auto",left:O?0:"auto",zIndex:O?1e3:"auto",children:e(sa,{json:Ii,onChange:f=>{Ci(f)}},`advanced-${ze}-${V}`)}),O&&oe&&e(K,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:qs,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(Vt,{children:e(T,{children:e(El,{showTitle:!1})})})]})]}),e(Ip,{isOpen:p,onClose:dr,mode:H!==null?"edit":"create",initialOutbound:H!==null?Ve[H]:null,onSubmitOutbound:Mn}),e(Up,{isOpen:A,mode:Re!==null?"edit":"create",initialRule:Re!==null&&St[Re]||null,availableInboundTags:Nr,availableOutboundTags:Or,availableBalancerTags:hr,onSubmit:G,onClose:N}),e(Vp,{isOpen:ve,onClose:Js,initialOutbound:nn,onSave:pn,onDelete:Ln}),e(Lp,{isOpen:x,onClose:C,form:z,setBalancersData:L}),e(Mp,{isOpen:R,onClose:b,form:z,setDnsServers:E}),e(Op,{isOpen:M,onClose:W,form:z,setFakeDns:re})]})},tm=({isOpen:t,onClose:s,onSubmit:r,isSaving:l,allHosts:o,allAdmins:a,initialService:i})=>{var P,me,Ie,De;const{t:c}=Je(),[u,p]=d.exports.useState((P=i==null?void 0:i.name)!=null?P:""),[m,g]=d.exports.useState((me=i==null?void 0:i.description)!=null?me:""),[A,D]=d.exports.useState((Ie=i==null?void 0:i.admin_ids)!=null?Ie:[]),[k,x]=d.exports.useState((De=i==null?void 0:i.hosts.map(L=>L.id))!=null?De:[]),[v,C]=d.exports.useState(""),[R,ie]=d.exports.useState(""),[b,M]=d.exports.useState(null),I=Ht();d.exports.useEffect(()=>{var L,y,E,ae;t&&(p((L=i==null?void 0:i.name)!=null?L:""),g((y=i==null?void 0:i.description)!=null?y:""),D((E=i==null?void 0:i.admin_ids)!=null?E:[]),x((ae=i==null?void 0:i.hosts.map(re=>re.id))!=null?ae:[]),C(""),ie(""))},[t,i]);const W=d.exports.useMemo(()=>new Map(o.map(L=>[L.id,L])),[o]),ve=d.exports.useMemo(()=>o.filter(L=>!k.includes(L.id)&&!L.isDisabled),[o,k]),Z=d.exports.useMemo(()=>{const L=R.trim().toLowerCase();return L?ve.filter(y=>{const E=y.label.toLowerCase(),ae=y.inboundTag.toLowerCase(),re=y.protocol.toLowerCase();return E.includes(L)||ae.includes(L)||re.includes(L)}):ve},[ve,R]),te=d.exports.useMemo(()=>{const L=v.trim().toLowerCase();return L?a.filter(y=>y.username.toLowerCase().includes(L)):a},[v,a]),z=d.exports.useMemo(()=>new Set(A),[A]),j=L=>{D(y=>y.includes(L)?y.filter(E=>E!==L):[...y,L])},pe=L=>{x(y=>y.includes(L)?y.filter(E=>E!==L):[...y,L])},Y=(L,y)=>{x(E=>{const ae=E.indexOf(L);if(ae===-1)return E;const re=y==="up"?ae-1:ae+1;if(re<0||re>=E.length)return E;const Ce=[...E];return[Ce[ae],Ce[re]]=[Ce[re],Ce[ae]],Ce})},Q=async()=>{if(!u.trim()){I({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!k.length){I({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const L=k.map((y,E)=>({host_id:y,sort:E}));await r({name:u.trim(),description:(m==null?void 0:m.trim())||null,admin_ids:A,hosts:L},i==null?void 0:i.id)};return n(Rt,{isOpen:t,onClose:s,size:"5xl",children:[e(vt,{}),n(Ut,{children:[e(At,{children:i?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(zt,{}),e(Ct,{children:n(ke,{spacing:6,children:[n(U,{spacing:4,children:[e(Yt,{label:c("services.fields.name","Name"),value:u,onChange:L=>p(L.target.value),maxLength:128,isRequired:!0}),e(Yt,{label:c("services.fields.description","Description"),value:m!=null?m:"",onChange:L=>g(L.target.value),maxLength:256})]}),n(T,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),n(ke,{spacing:3,children:[e(Yt,{value:v,onChange:L=>C(L.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(ue,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:a.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):te.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):te.map(L=>{const y=z.has(L.id);return e(T,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:y?"primary.400":"gray.200",bg:y?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:y?"primary.300":"gray.600",bg:y?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>j(L.id),onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),j(L.id))},role:"button",tabIndex:0,children:n(ot,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:L.username}),y&&e(rn,{colorScheme:"primary",children:c("services.selected","Selected")})]})},L.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),n(ma,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(Dn,{children:n(en,{variant:"outline",h:"full",children:[e(qn,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(ln,{children:n(ke,{spacing:3,children:[e(Yt,{value:R,onChange:L=>ie(L.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(ue,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:ve.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):Z.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):Z.map(L=>n(T,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:b===L.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>M(L.id),onMouseLeave:()=>M(null),onClick:()=>pe(L.id),children:[e(h,{fontWeight:"medium",children:L.label}),n(h,{fontSize:"sm",color:"gray.500",children:[L.protocol.toUpperCase()," - ",L.inboundTag]})]},L.id))})]})})]})}),e(Dn,{children:n(en,{variant:"outline",h:"full",children:[e(qn,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(ln,{children:n(ue,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[k.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),k.map((L,y)=>{const E=W.get(L);return E?e(nd.div,{layout:!0,children:n(ot,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[n(T,{children:[n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:E.label}),E.isDisabled&&e(rn,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),n(h,{fontSize:"sm",color:"gray.500",children:[E.protocol.toUpperCase()," - ",E.inboundTag]})]}),n(U,{spacing:1,children:[e(st,{label:c("services.moveUp","Move up"),children:e(Le,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(al,{width:16}),onClick:()=>Y(L,"up"),isDisabled:y===0})}),e(st,{label:c("services.moveDown","Move down"),children:e(Le,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(ol,{width:16}),onClick:()=>Y(L,"down"),isDisabled:y===k.length-1})}),e(st,{label:c("services.removeHost","Remove host"),children:e(Le,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(tn,{width:16}),onClick:()=>pe(L)})})]})]})},L):null})]})})]})})]})]})}),e(Nt,{children:n(U,{justify:"flex-end",w:"full",children:[e(K,{onClick:s,children:c("cancel")}),e(K,{colorScheme:"primary",onClick:Q,isLoading:l,children:c(i?"saveChanges":"create")})]})})]})]})},rm=()=>{var it;const{t}=Je(),s=Ht(),{userData:r,getUserIsSuccess:l}=Un(),o=l&&r.is_sudo,a=Gn(),i=hn(),c=bl(),{inbounds:u,refetchUsers:p}=wt(),m=Gt(),[g,A]=d.exports.useState(null);d.exports.useEffect(()=>{!l||!o||(a.fetchServices(),i.fetchAdmins({limit:500,offset:0}),Ns(),c.fetchHosts())},[l,o]);const D=d.exports.useMemo(()=>i.admins.slice().sort((he,ce)=>he.username.localeCompare(ce.username)).map(he=>({id:he.id,username:he.username})),[i.admins]),k=d.exports.useMemo(()=>{var ce,oe;const he=[];for(const[V,ye]of Object.entries(c.hosts)){const ht=(ce=Array.from(u.values()).flat().find(q=>q.tag===V))!=null?ce:null,ft=(oe=ht==null?void 0:ht.protocol)!=null?oe:"unknown";ye.forEach(q=>{q.id!=null&&he.push({id:q.id,label:q.remark,inboundTag:V,protocol:ft,isDisabled:Boolean(q.is_disabled)})})}return he},[c.hosts,u]),x=()=>{A(null),m.onOpen()},v=async he=>{try{const ce=await a.fetchServiceDetail(he);A(ce),m.onOpen()}catch{s({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},C=async(he,ce)=>{var oe,V;try{ce?(await a.updateService(ce,he),s({status:"success",title:t("services.updated","Service updated")})):(await a.createService(he),s({status:"success",title:t("services.created","Service created")})),p(!0),m.onClose()}catch(ye){s({status:"error",title:(V=(oe=ye==null?void 0:ye.data)==null?void 0:oe.detail)!=null?V:t("services.saveFailed","Failed to save service")})}},R=async he=>{var ce,oe;try{const V=await a.fetchServiceDetail(he);Ie(V),Me()}catch(V){s({status:"error",title:(oe=(ce=V==null?void 0:V.data)==null?void 0:ce.detail)!=null?oe:t("services.deleteFailed","Unable to delete service")})}},ie=async he=>{var ce,oe;try{await a.resetServiceUsage(he),s({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(V){s({status:"error",title:(oe=(ce=V==null?void 0:V.data)==null?void 0:ce.detail)!=null?oe:t("services.resetFailed","Failed to reset usage")})}},[b,M]=d.exports.useState(null),[I,W]=d.exports.useState(!1),{isOpen:ve,onOpen:Z,onClose:te}=Gt(),z=d.exports.useRef(null),j=he=>{M(he),Z()},pe=async()=>{if(b!=null){W(!0);try{await ie(b)}finally{W(!1),te()}}},Y=b!=null?(it=a.services.find(he=>he.id===b))==null?void 0:it.name:void 0,Q=()=>{Ie(null),H()},P=async()=>{var ce,oe;if(!me)return;const he={mode:me.user_count?De:"delete_users",unlink_admins:y};if(he.mode==="transfer_users"){if(!ae){s({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}he.target_service_id=ae}Te(!0);try{await a.deleteService(me.id,he),s({status:"success",title:t("services.deleted","Service removed")}),p(!0),Q()}catch(V){s({status:"error",title:(oe=(ce=V==null?void 0:V.data)==null?void 0:ce.detail)!=null?oe:t("services.deleteFailed","Unable to delete service")})}finally{Te(!1)}},[me,Ie]=d.exports.useState(null),[De,L]=d.exports.useState("delete_users"),[y,E]=d.exports.useState(!1),[ae,re]=d.exports.useState(null),[Ce,Te]=d.exports.useState(!1),{isOpen:Re,onOpen:Me,onClose:H}=Gt(),B=d.exports.useMemo(()=>me?a.services.filter(he=>he.id!==me.id):a.services,[me,a.services]);d.exports.useEffect(()=>{me&&(L("delete_users"),E(me.admin_ids.length>0),re(null))},[me]),d.exports.useEffect(()=>{De==="delete_users"&&re(null)},[De]);const O=he=>e(jo,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:ce})=>n(Lt,{children:[n(el,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[n(T,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:he.name}),he.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:ce?3:1,mt:1,children:he.description})]}),n(ue,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[n(U,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:he.host_count})]}),n(U,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:he.user_count})]})]}),e(sd,{})]}),e(tl,{pt:0,pb:4,children:n(ke,{spacing:4,children:[n(Ke,{columns:2,spacing:3,children:[n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:je(he.used_traffic)})]}),n(T,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:je(he.lifetime_used_traffic)})]})]}),n(ke,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),n(U,{spacing:2,flexWrap:"wrap",children:[e(st,{label:t("services.view","View"),children:e(Le,{"aria-label":"View",icon:e(Ps,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),a.fetchServiceDetail(he.id)}})}),e(st,{label:t("services.edit","Edit"),children:e(Le,{"aria-label":"Edit",icon:e(Qi,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),v(he.id)},isDisabled:!o})}),e(st,{label:t("services.resetUsage","Reset usage"),children:e(Le,{"aria-label":"Reset usage",icon:e(Vr,{width:18}),size:"sm",variant:"outline",onClick:oe=>{oe.stopPropagation(),j(he.id)},isDisabled:!o})}),e(st,{label:t("services.delete","Delete"),children:e(Le,{"aria-label":"Delete",icon:e(tn,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:oe=>{oe.stopPropagation(),R(he.id)},isDisabled:!o})})]})]})]})})]})},`service-accordion-${he.id}`),de=he=>n(_t,{children:[e(Ne,{children:n(ue,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:he.name}),he.description&&e(h,{fontSize:"sm",color:"gray.500",children:he.description})]})}),e(Ne,{children:he.host_count}),e(Ne,{children:he.user_count}),e(Ne,{children:je(he.used_traffic)}),e(Ne,{children:je(he.lifetime_used_traffic)}),e(Ne,{children:n(U,{spacing:2,children:[e(st,{label:t("services.view","View"),children:e(Le,{"aria-label":"View",icon:e(Ps,{width:18}),size:"sm",variant:"ghost",onClick:()=>a.fetchServiceDetail(he.id)})}),o&&n(Lt,{children:[e(st,{label:t("services.edit","Edit"),children:e(Le,{"aria-label":"Edit",icon:e(Qi,{width:18}),size:"sm",variant:"ghost",onClick:()=>v(he.id)})}),e(st,{label:t("services.resetUsage","Reset usage"),children:e(Le,{"aria-label":"Reset usage",icon:e(Vr,{width:18}),size:"sm",variant:"ghost",onClick:()=>j(he.id)})}),e(st,{label:t("services.delete","Delete"),children:e(Le,{"aria-label":"Delete",icon:e(tn,{width:18}),size:"sm",variant:"ghost",onClick:()=>R(he.id)})})]})]})})]},he.id),ze=a.serviceDetail;return l?o?n(ue,{spacing:4,align:"stretch",children:[n(ot,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[n(T,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),o&&e(K,{leftIcon:e(dn,{width:18}),colorScheme:"primary",onClick:x,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(en,{variant:"outline",children:e(ln,{children:a.isLoading?e(ot,{justify:"center",py:10,children:e(Dt,{})}):n(Lt,{children:[e(Zo,{allowToggle:!0,display:{base:"block",md:"none"},children:a.services.map(O)}),e(T,{display:{base:"none",md:"block"},overflowX:"auto",children:n(Tn,{variant:"simple",children:[e(Xr,{children:n(_t,{children:[e(He,{children:t("services.columns.name","Name")}),e(He,{children:t("services.columns.hosts","Hosts")}),e(He,{children:t("services.columns.users","Users")}),e(He,{children:t("services.columns.usage","Usage")}),e(He,{children:t("services.columns.lifetime","Lifetime")}),e(He,{children:t("services.columns.actions","Actions")})]})}),e(Br,{children:a.services.map(de)})]})})]})})}),ze&&n(en,{variant:"outline",children:[e(qn,{children:n(ot,{justify:"space-between",align:"center",children:[n(T,{children:[e(h,{fontWeight:"semibold",children:ze.name}),ze.description&&e(h,{fontSize:"sm",color:"gray.500",children:ze.description})]}),e(rn,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:ze.user_count})})]})}),e(ln,{children:n(Ke,{columns:{base:1,md:2},spacing:6,children:[n(T,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(ke,{spacing:2,children:ze.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):ze.admins.map(he=>n(ot,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:he.username}),n(h,{fontSize:"sm",color:"gray.500",children:[je(he.used_traffic)," /"," ",je(he.lifetime_used_traffic)]})]},he.id))})]}),n(T,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(ke,{spacing:2,children:ze.hosts.map(he=>n(ot,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[n(T,{children:[e(h,{fontWeight:"medium",children:he.remark}),n(h,{fontSize:"sm",color:"gray.500",children:[he.inbound_protocol.toUpperCase()," - ",he.inbound_tag]})]}),n(rn,{colorScheme:"gray",children:["#",he.sort+1]})]},he.id))})]})]})})]}),e(Ts,{isOpen:ve,leastDestructiveRef:z,onClose:te,isCentered:!0,motionPreset:"slideInBottom",children:e(vt,{children:n(Es,{mx:{base:4,sm:0},children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(Ct,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:Y!=null?Y:t("services.thisService","this service")})}),n(Nt,{children:[e(K,{ref:z,onClick:te,children:t("cancel","Cancel")}),e(K,{colorScheme:"primary",ml:3,onClick:pe,isLoading:I,children:t("services.resetUsage","Reset usage")})]})]})})}),n(Rt,{isOpen:Re,onClose:Q,size:"lg",children:[e(vt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ut,{children:[n(At,{children:[t("services.deleteDialogTitle","Delete Service"),me?` \u2013 ${me.name}`:""]}),e(zt,{}),e(Ct,{children:me?n(ue,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:me.name})}),me.admin_ids.length>0?e(Ir,{isChecked:y,onChange:he=>E(he.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),me.user_count>0?n(ue,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:me.user_count})}),e(gi,{value:De,onChange:he=>L(he),children:n(ke,{align:"flex-start",spacing:2,children:[e(Gr,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Gr,{value:"transfer_users",isDisabled:B.length===0,children:B.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),De==="transfer_users"&&B.length>0&&n(w,{isRequired:!0,children:[e(_,{children:t("services.selectTargetService","Target service")}),e(tt,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:ae!=null?ae:"",onChange:he=>re(he.target.value?Number(he.target.value):null),children:B.map(he=>e("option",{value:he.id,children:he.name},he.id))}),e(Lr,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):n(Dr,{status:"info",borderRadius:"md",children:[e(Ar,{}),e(bn,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),n(Nt,{gap:3,children:[e(K,{variant:"ghost",onClick:Q,children:t("cancel","Cancel")}),e(K,{colorScheme:"red",onClick:P,isLoading:Ce,isDisabled:Boolean((me==null?void 0:me.user_count)&&De==="transfer_users"&&B.length>0&&!ae),children:t("services.delete","Delete")})]})]})]}),e(tm,{isOpen:m.isOpen,onClose:m.onClose,onSubmit:C,isSaving:a.isSaving,allHosts:k,allAdmins:D,initialService:g!=null?g:void 0})]}):n(ue,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(ot,{justify:"center",align:"center",h:"full",py:10,children:e(Dt,{})})};$e.extend(Hs);const vo=ee(Us,{baseStyle:{w:4,h:4}}),nm=ee(fa,{baseStyle:{w:4,h:4}}),sm={key:"30d",label:"30d",amount:30,unit:"day"},im=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=$e.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},Co=t=>$e(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",_o=t=>$e(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",js=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return $e.utc(r).valueOf()},Do=t=>{const s=t.unit==="hour"?"hour":"day",r=$e().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},am=(t,s)=>{const r=$e(t),l=$e(s),[o,a]=r.isBefore(l)?[r,l]:[l,r],i=o.startOf("day"),c=a.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},om=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>je(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>je(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},lm=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>je(Number(r)||0,2),title:{formatter:(r,l)=>{var o,a,i,c;return(c=(i=(a=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:a.labels)==null?void 0:i[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),cm=()=>{var Ce,Te,Re,Me;const{t}=Je(),{colorMode:s}=$r(),{admins:r}=hn(),l="auto-end",o=(Ce=Sr({base:"bottom",md:"auto-end"}))!=null?Ce:l,[a,i]=d.exports.useState([]),[c,u]=d.exports.useState([]),[p,m]=d.exports.useState(null),[g,A]=d.exports.useState([]),[D,k]=d.exports.useState(!1),x=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),v=(Te=x.find(H=>H.key==="30d"))!=null?Te:sm,[C,R]=d.exports.useState(()=>Do(v)),[ie,b]=d.exports.useState(v.key),[M,I]=d.exports.useState(null),[W,ve]=d.exports.useState([]),[Z,te]=d.exports.useState(!1),[z,j]=d.exports.useState(!1),[pe,Y]=d.exports.useState([C.start,C.end]);d.exports.useMemo(()=>{var H;return(H=c.find(B=>B.id===p))!=null?H:null},[c,p]);const Q=d.exports.useMemo(()=>{if(!p)return a;const H=new Set(g.map(O=>O.username).filter(O=>Boolean(O))),B=a.filter(O=>H.has(O.username));return B.length?B:a},[a,p,g]),P=d.exports.useMemo(()=>g.reduce((H,B)=>H+(B.used_traffic||0),0),[g]),me=d.exports.useMemo(()=>g.map(H=>H.used_traffic||0),[g]),Ie=d.exports.useMemo(()=>g.map(H=>H.username||t("services.unassignedAdmin","Unassigned")),[g,t]),De=d.exports.useMemo(()=>lm(s,Ie),[s,Ie]);d.exports.useEffect(()=>{z||Y([C.start,C.end])},[z,C.start,C.end]),d.exports.useEffect(()=>{let H=!1;return(async()=>{var O;try{const de=await _e("/v2/services",{query:{limit:500}});if(H||!de)return;const ze=(O=de.services)!=null?O:[];u(ze),m(it=>it!==null?it:ze.length?ze[0].id:null)}catch{H||u([])}})(),()=>{H=!0}},[]),d.exports.useEffect(()=>{if(!p){A([]);return}let H=!1;return k(!0),_e(`/v2/services/${p}/usage/admins`,{query:{start:Co(C.start),end:_o(C.end)}}).then(B=>{var O;H||!B||A((O=B.admins)!=null?O:[])}).catch(()=>{H||A([])}).finally(()=>{H||k(!1)}),()=>{H=!0}},[p,C.start,C.end,C.unit]),d.exports.useEffect(()=>{let H=!1;return(async()=>{try{const O=await _e("/admins");if(H)return;Array.isArray(O)?i(O):i(O.admins||[])}catch(O){console.error("Failed to load all admins:",O),i(r||[])}})(),()=>{H=!0}},[r]),d.exports.useEffect(()=>{if(!M)return;let H=!1;te(!0);const B=C.unit==="hour",O={start:Co(C.start),end:_o(C.end)};B&&(O.granularity="hour");const de=B?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:M,endpoint:de,query:O}),_e(`/admin/${encodeURIComponent(M)}/usage/${de}`,{query:O}).then(ze=>{if(H)return;const it=Array.isArray(ze==null?void 0:ze.usages)?ze.usages:[];console.debug("AdminsUsage: response usages",{length:it.length,endpoint:de});let he;if(B){const ce=new Map;it.forEach(V=>{var ft,q;const ye=typeof(V==null?void 0:V.date)=="string"?V.date:"";if(!ye)return;const ht=(ft=ce.get(ye))!=null?ft:0;ce.set(ye,ht+Number((q=V==null?void 0:V.used_traffic)!=null?q:0))});const oe=Array.from(ce.entries());oe.sort((V,ye)=>{const[ht]=V,[ft]=ye;return js(ht)-js(ft)}),he=oe.map(([V,ye])=>({date:V,used_traffic:ye}))}else{const ce=it.map(oe=>{var V,ye;return{date:(V=oe==null?void 0:oe.date)!=null?V:"",used_traffic:Number((ye=oe==null?void 0:oe.used_traffic)!=null?ye:0)}});ce.sort((oe,V)=>js(oe.date)-js(V.date)),he=ce}ve(he)}).catch(ze=>{H||(console.error("Error fetching admin usage:",ze),ve([]))}).finally(()=>{H||te(!1)}),()=>{H=!0}},[M,C]),d.exports.useEffect(()=>{if(!Q||Q.length===0)return;Q.some(B=>B.username===M)||I(Q[0].username)},[Q,M]),d.exports.useEffect(()=>{const H=x.find(B=>B.key===C.key);b(H?H.key:"custom")},[C,x]);const L=d.exports.useMemo(()=>W.map(H=>im(H.date)),[W]),y=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:W.map(H=>H.used_traffic)}],[W,t]),E=d.exports.useMemo(()=>({options:om(s,L),series:y}),[s,L,y]),ae=d.exports.useMemo(()=>W.reduce((H,B)=>H+Number(B.used_traffic||0),0),[W]),re=d.exports.useMemo(()=>{const H=$e(C.start).format("YYYY-MM-DD"),B=$e(C.end).format("YYYY-MM-DD");return H===B?H:`${H} - ${B}`},[C.start,C.end]);return n(ue,{spacing:4,align:"stretch",children:[n(T,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[n(ue,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),n(ke,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(tt,{value:p!=null?p:"",onChange:H=>{const B=Number(H.target.value);m(Number.isNaN(B)?null:B)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(H=>e("option",{value:H.id,children:H.name},H.id))}),n(U,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(vo,{}),n(h,{children:[t("services.totalUsage","Total"),":"," ",e(ee.span,{fontWeight:"medium",children:je(P,2)})]})]})]})]}),n(ke,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(T,{flex:"1",children:D?n(ue,{spacing:3,py:8,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):g.length&&P>0?e(jr,{type:"donut",height:320,options:De,series:me}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(ue,{flex:"1",align:"stretch",spacing:2,children:g.length?g.map(H=>{var ze;const B=H.username||t("services.unassignedAdmin","Unassigned"),O=Boolean(H.username),de=M===H.username&&O;return e(K,{size:"sm",variant:de?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{O&&H.username&&I(H.username)},isDisabled:!O,children:n(U,{justify:"space-between",w:"full",children:[e(h,{children:B}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:je(H.used_traffic||0,2)})]})},`${(ze=H.admin_id)!=null?ze:"na"}-${B}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),n(T,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(st,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(vo,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(ee.span,{fontWeight:"medium",children:M!=null?M:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(ee.span,{fontWeight:"medium",children:je(ae||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ke,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:x.map(H=>e(K,{size:"sm",onClick:()=>{b(H.key),R(Do(H))},variant:ie===H.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:H.label},H.key))}),n(ke,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[n(Ls,{placement:o,isOpen:z,onClose:()=>{j(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Ms,{children:e(K,{size:"sm",variant:"outline",leftIcon:e(nm,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(z){j(!1);return}Y([C.start,C.end]),j(!0)},children:re})}),n(Os,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Ws,{}),n(Fs,{px:3,py:3,children:[e(T,{overflowX:"auto",maxW:"full",children:e($s,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(Re=pe[0])!=null?Re:void 0,endDate:(Me=pe[1])!=null?Me:void 0,calendarClassName:"usage-range-datepicker",onChange:H=>{const[B,O]=H!=null?H:[null,null];if(Y([B,O]),B&&O){const de=am(B,O);b("custom"),R(de),j(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(tt,{value:M!=null?M:"",onChange:H=>I(H.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!Q.length,children:Q.map(H=>e("option",{value:H.username,children:H.username},H.username))})]})]})]}),e(T,{mt:6,children:Z?n(ue,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):E.series&&E.series.length?e(jr,{options:E.options,series:E.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};$e.extend(Hs);const dm=ee(fa,{baseStyle:{w:4,h:4}}),Ki=ee(Us,{baseStyle:{w:4,h:4}}),Ji=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],Ao=t=>{const s=t.unit==="hour"?"hour":"day",r=$e().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},um=(t,s)=>{const r=$e(t),l=$e(s),[o,a]=r.isBefore(l)?[r,l]:[l,r],i=o.startOf("day"),c=a.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Io=t=>$e(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Po=t=>$e(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),To=(t,s)=>{if(!t)return t;const r=$e.utc(t);return r.isValid()?s==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},Eo=(t,s,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>je(Number(o)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>je(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},hm=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>je(Number(r)||0,2),title:{formatter:(r,l)=>{var o,a,i,c;return(c=(i=(a=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:a.labels)==null?void 0:i[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),pm=({services:t,selectedServiceId:s})=>{var oe,V,ye,ht,ft,q;const{t:r}=Je(),{colorMode:l}=$r(),o="auto-end",a=(oe=Sr({base:"bottom",md:"auto-end"}))!=null?oe:o,i=d.exports.useMemo(()=>t.map(F=>({id:F.id,name:F.name})),[t]),c=d.exports.useMemo(()=>s||(i.length?i[0].id:null),[s,i]),u=(V=Ji.find(F=>F.key==="30d"))!=null?V:Ji[0],[p,m]=d.exports.useState(c),[g,A]=d.exports.useState(()=>Ao(u)),[D,k]=d.exports.useState(u.key),[x,v]=d.exports.useState([null,null]),[C,R]=d.exports.useState(!1),[ie,b]=d.exports.useState([]),[M,I]=d.exports.useState("day"),[W,ve]=d.exports.useState([]),[Z,te]=d.exports.useState(!1),[z,j]=d.exports.useState(!1),[pe,Y]=d.exports.useState(null),[Q,P]=d.exports.useState([]),[me,Ie]=d.exports.useState("day"),[De,L]=d.exports.useState(""),[y,E]=d.exports.useState(!1);d.exports.useEffect(()=>{m(c)},[c]),d.exports.useEffect(()=>{if(!p){b([]),ve([]),P([]),Y(null),L("");return}const F={start:Io(g.start),end:Po(g.end)},Se=g.unit==="hour"?"hour":"day";let Ue=!1;return te(!0),_e(`/v2/services/${p}/usage/timeseries`,{query:{...F,granularity:Se}}).then(We=>{var Be,le;Ue||!We||(b((Be=We.points)!=null?Be:[]),I((le=We.granularity)!=null?le:Se))}).catch(()=>{Ue||(b([]),I(Se))}).finally(()=>{Ue||te(!1)}),j(!0),_e(`/v2/services/${p}/usage/admins`,{query:F}).then(We=>{var Be;Ue||!We||ve((Be=We.admins)!=null?Be:[])}).catch(()=>{Ue||ve([])}).finally(()=>{Ue||j(!1)}),()=>{Ue=!0}},[p,g.start,g.end,g.unit]),d.exports.useEffect(()=>{if(!p){Y(null),P([]),L("");return}if(!W.length){Y(null);return}Y(F=>{var Be,le;const Se=W.map(ge=>ge.admin_id);if(F===null){if(Se.includes(null))return F}else if(Se.includes(F))return F;const Ue=W.find(ge=>(ge.used_traffic||0)>0);if(Ue)return(Be=Ue.admin_id)!=null?Be:null;const We=W[0];return(le=We==null?void 0:We.admin_id)!=null?le:null})},[W,p]),d.exports.useEffect(()=>{if(!p){P([]),L(""),Ie("day");return}if(pe===void 0)return;if(!W.length&&pe===null){P([]),L("");return}const F=g.unit==="hour"?"hour":"day",Se=pe===null?"null":Number.isFinite(pe)?String(pe):"null";let Ue=!1;return E(!0),_e(`/v2/services/${p}/usage/admin-timeseries`,{query:{start:Io(g.start),end:Po(g.end),granularity:F,admin_id:Se}}).then(We=>{var Be,le,ge;Ue||!We||(P((Be=We.points)!=null?Be:[]),Ie((le=We.granularity)!=null?le:F),L((ge=We.username)!=null?ge:""))}).catch(()=>{Ue||(P([]),L(""),Ie(F))}).finally(()=>{Ue||E(!1)}),()=>{Ue=!0}},[W,g.end,g.start,g.unit,pe,p]);const ae=d.exports.useMemo(()=>{const F=$e(g.start).format("YYYY-MM-DD"),Se=$e(g.end).format("YYYY-MM-DD");return`${F} \u2013 ${Se}`},[g.start,g.end]),re=d.exports.useMemo(()=>ie.map(F=>To(F.timestamp,M)),[ie,M]),Ce=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ie.map(F=>F.used_traffic)}],[ie,r]),Te=d.exports.useMemo(()=>Eo(l,re,r("services.usageYAxis","Usage")),[re,l,r]),Re=d.exports.useMemo(()=>W.map(F=>({value:F.admin_id===null?"null":String(F.admin_id),label:F.username||r("services.unassignedAdmin","Unassigned")})),[W,r]),Me=d.exports.useMemo(()=>{var Se,Ue;const F=pe===null?"null":String(pe);return(Ue=(Se=Re.find(We=>We.value===F))==null?void 0:Se.label)!=null?Ue:pe===null?r("services.unassignedAdmin","Unassigned"):""},[Re,pe,r]),H=d.exports.useMemo(()=>Q.map(F=>To(F.timestamp,me)),[Q,me]),B=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:Q.map(F=>F.used_traffic)}],[Q,r]),O=d.exports.useMemo(()=>Eo(l,H,r("services.usageYAxis","Usage")),[H,l,r]),de=d.exports.useMemo(()=>Q.reduce((F,Se)=>F+(Se.used_traffic||0),0),[Q]),ze=d.exports.useMemo(()=>W.map(F=>F.used_traffic),[W]),it=d.exports.useMemo(()=>W.map(F=>F.username||r("services.unassignedAdmin","Unassigned")),[W,r]),he=d.exports.useMemo(()=>hm(l,it),[l,it]),ce=d.exports.useMemo(()=>W.reduce((F,Se)=>F+(Se.used_traffic||0),0),[W]);return i.length===0?n(ue,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(T,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):n(ue,{spacing:4,align:"stretch",children:[n(U,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(tt,{value:p!=null?p:"",onChange:F=>m(Number(F.target.value)||null),minW:{md:"220px"},children:i.map(F=>e("option",{value:F.id,children:F.name},F.id))}),e(ke,{direction:{base:"column",sm:"row"},spacing:2,children:Ji.map(F=>e(K,{size:"sm",variant:D===F.key?"solid":"outline",colorScheme:"primary",onClick:()=>{k(F.key),A(Ao(F))},children:F.label},F.key))}),n(Ls,{placement:a,isOpen:C,onClose:()=>R(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Ms,{children:e(K,{size:"sm",variant:"outline",leftIcon:e(dm,{}),onClick:()=>{v([g.start,g.end]),R(F=>!F)},children:ae})}),n(Os,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Ws,{}),n(Fs,{px:3,py:3,children:[e(T,{overflowX:"auto",maxW:"full",children:e($s,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(ye=x[0])!=null?ye:void 0,endDate:(ht=x[1])!=null?ht:void 0,calendarClassName:"usage-range-datepicker",onChange:F=>{const[Se,Ue]=F!=null?F:[null,null];if(v([Se,Ue]),Se&&Ue){const We=um(Se,Ue);k("custom"),A(We),R(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),n(T,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(U,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),n(U,{fontSize:"sm",color:"gray.500",children:[e(Ki,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(ee.span,{fontWeight:"medium",children:je(ie.reduce((F,Se)=>F+(Se.used_traffic||0),0),2)})]})]})]}),e(T,{mt:4,children:Z?n(ue,{spacing:3,py:10,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):ie.length?e(jr,{type:"area",height:360,options:Te,series:Ce}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(T,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(st,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(Ki,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(ee.span,{fontWeight:"medium",children:Me||De||"-"})," ",r("services.totalUsage","Total"),":"," ",e(ee.span,{fontWeight:"medium",children:je(de||0,2)})]})]}),e(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(tt,{size:"sm",minW:{md:"200px"},value:pe===null?"null":String(pe),onChange:F=>{const Se=F.target.value;if(Se==="null"){Y(null);return}const Ue=Number(Se);Y(Number.isNaN(Ue)?null:Ue)},isDisabled:Re.length===0,children:Re.map(F=>e("option",{value:F.value,children:F.label},F.value))})})]}),e(T,{mt:4,children:y?n(ue,{spacing:3,py:10,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(q=(ft=B[0])==null?void 0:ft.data)!=null&&q.length?e(jr,{type:"area",height:360,options:O,series:B}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(T,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(U,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),n(U,{fontSize:"sm",color:"gray.500",children:[e(Ki,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(ee.span,{fontWeight:"medium",children:je(ce,2)})]})]})]}),n(ke,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(T,{flex:"1",children:z?n(ue,{spacing:3,py:8,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):W.length&&ce>0?e(jr,{type:"donut",height:320,options:he,series:ze}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(ue,{flex:"1",align:"stretch",spacing:2,children:W.length?W.map(F=>{var Se;return n(U,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:F.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:je(F.used_traffic||0,2)})]},`${(Se=F.admin_id)!=null?Se:"na"}-${F.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};$e.extend(Hs);const mm=ee(fa,{baseStyle:{w:4,h:4}}),ei=ee(Us,{baseStyle:{w:4,h:4}}),ws={key:"30d",label:"30d",amount:30,unit:"day"},No=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=$e.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},vs=t=>$e(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Cs=t=>$e(t).utc().format("YYYY-MM-DDTHH:mm:ss"),gn=t=>{const s=t.unit==="hour"?"hour":"day",r=$e().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},ti=(t,s)=>{const r=$e(t),l=$e(s),[o,a]=r.isBefore(l)?[r,l]:[l,r],i=o.startOf("day"),c=a.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},zo=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>je(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>je(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},ri=({presets:t,range:s,onPresetChange:r,onCustomChange:l})=>{var k,x,v;const{t:o}=Je(),a="auto-end",i=(k=Sr({base:"bottom",md:"auto-end"}))!=null?k:a,c=$e(s.start).format("YYYY-MM-DD"),u=$e(s.end).format("YYYY-MM-DD"),p=c===u?c:`${c} - ${u}`,[m,g]=d.exports.useState(!1),[A,D]=d.exports.useState([s.start,s.end]);return d.exports.useEffect(()=>{m||D([s.start,s.end])},[m,s.start,s.end]),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ke,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(C=>e(K,{size:"sm",onClick:()=>r(C.key),colorScheme:"primary",variant:s.key===C.key?"solid":"outline",w:{base:"full",sm:"auto"},children:C.label},C.key))}),n(Ls,{placement:i,isOpen:m,onClose:()=>{g(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Ms,{children:e(K,{size:"sm",variant:"outline",leftIcon:e(mm,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(m){g(!1);return}D([s.start,s.end]),g(!0)},children:p})}),n(Os,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Ws,{}),n(Fs,{px:3,py:3,children:[e(T,{overflowX:"auto",maxW:"full",children:e($s,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(x=A[0])!=null?x:void 0,endDate:(v=A[1])!=null?v:void 0,calendarClassName:"usage-range-datepicker",onChange:C=>{const[R,ie]=C!=null?C:[null,null];D([R,ie]),R&&ie&&(l(R,ie),g(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},gm=()=>{var rr,ur,nr,Qt,sr,ir,Xt,ar;const{t}=Je(),s=Ht(),{colorMode:r}=$r(),{data:l}=Sa(),{fetchNodesUsage:o}=Ks(),{userData:a}=Un(),i=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(ur=(rr=i.find(J=>J.key==="30d"))!=null?rr:i[0])!=null?ur:ws,[u,p]=d.exports.useState(()=>gn(c)),[m,g]=d.exports.useState([]),[A,D]=d.exports.useState(!1),[k,x]=d.exports.useState(()=>gn(c)),[v,C]=d.exports.useState(null),[R,ie]=d.exports.useState(!1),[b,M]=d.exports.useState([]),[I,W]=d.exports.useState(null),[ve,Z]=d.exports.useState(()=>gn(c)),[te,z]=d.exports.useState(()=>gn(c)),[j,pe]=d.exports.useState([]),[Y,Q]=d.exports.useState(null),[P,me]=d.exports.useState(null),[Ie,De]=d.exports.useState([]),[L,y]=d.exports.useState([]),[E,ae]=d.exports.useState(!1),[re,Ce]=d.exports.useState(null),[Te,Re]=d.exports.useState(!1),[Me,H]=d.exports.useState([]),[B,O]=d.exports.useState(null),de=d.exports.useCallback(J=>J?(Array.isArray(J)?J:Object.values(J)).map(G=>{var N,we,Ee,Fe;return{nodeId:Number((N=G==null?void 0:G.node_id)!=null?N:0),nodeName:(we=G==null?void 0:G.node_name)!=null?we:t("nodes.unknownNode","Unknown"),total:Number((Ee=G==null?void 0:G.uplink)!=null?Ee:0)+Number((Fe=G==null?void 0:G.downlink)!=null?Fe:0)}}):[],[t]),ze=d.exports.useCallback(J=>{var G;const be=(G=i.find(N=>N.key===J))!=null?G:ws;p(gn(be))},[i]),it=d.exports.useCallback((J,be)=>{const G=ti(J,be);p(G)},[]),he=d.exports.useCallback(J=>{var G;const be=(G=i.find(N=>N.key===J))!=null?G:ws;x(gn(be))},[i]),ce=d.exports.useCallback((J,be)=>{const G=ti(J,be);x(G)},[]),oe=d.exports.useCallback(J=>{var G;const be=(G=i.find(N=>N.key===J))!=null?G:ws;z(gn(be))},[i]),V=d.exports.useCallback((J,be)=>{const G=ti(J,be);z(G)},[]),ye=d.exports.useCallback(J=>{var G;const be=(G=i.find(N=>N.key===J))!=null?G:ws;Z(gn(be))},[i]),ht=d.exports.useCallback((J,be)=>{const G=ti(J,be);Z(G)},[]),ft=d.exports.useMemo(()=>m.reduce((J,be)=>J+be.total,0),[m]),q=d.exports.useMemo(()=>{const J=m.map(G=>G.total),be=m.map(G=>G.nodeName);return fi(r,`${t("userDialog.total")} ${je(ft||0,2)}`,J,be)},[r,m,t,ft]),F=d.exports.useMemo(()=>b.map(J=>No(J.date)),[b]),Se=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:b.map(J=>J.used_traffic)}],[b,t]),Ue=d.exports.useMemo(()=>b.reduce((J,be)=>J+be.used_traffic,0),[b]),We=d.exports.useMemo(()=>({options:zo(r,F),series:Se}),[r,F,Se]),Be=d.exports.useMemo(()=>L.reduce((J,be)=>J+be.total,0),[L]),le=d.exports.useMemo(()=>{const J=L.map(G=>G.total),be=L.map(G=>G.nodeName);return fi(r,`${t("userDialog.total")} ${je(Be||0,2)}`,J,be)},[L,r,t,Be]),ge=d.exports.useMemo(()=>Me.map(J=>No(J.date)),[Me]),Oe=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:Me.map(J=>J.used_traffic)}],[Me,t]),Ae=d.exports.useMemo(()=>Me.reduce((J,be)=>J+be.used_traffic,0),[Me]),lt=d.exports.useMemo(()=>({options:zo(r,ge),series:Oe}),[r,ge,Oe]),pt=d.exports.useMemo(()=>{const J=[],be=new Set;return m.forEach(G=>{G.nodeId>0&&!be.has(G.nodeId)&&(be.add(G.nodeId),J.push({value:G.nodeId,label:G.nodeName}))}),Array.isArray(l)&&l.forEach(G=>{(G==null?void 0:G.id)&&!be.has(G.id)&&(be.add(G.id),J.push({value:G.id,label:G.name}))}),J.sort((G,N)=>G.label.localeCompare(N.label))},[m,l]),Ge=d.exports.useMemo(()=>{const J=[],be=new Set;return Ie.forEach(G=>{be.has(G.nodeId)||(be.add(G.nodeId),J.push({value:G.nodeId,label:G.nodeName}))}),be.has(0)||J.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(G=>{(G==null?void 0:G.id)&&!be.has(G.id)&&(be.add(G.id),J.push({value:G.id,label:G.name}))}),J.sort((G,N)=>G.label.localeCompare(N.label))},[Ie,l,t]),$t=d.exports.useMemo(()=>j.map(J=>({value:J,label:J})),[j]),dr=d.exports.useMemo(()=>{const J=new Map;return Array.isArray(l)&&l.forEach(be=>{(be==null?void 0:be.id)!=null&&J.set(be.id,be.name)}),J},[l]);return d.exports.useEffect(()=>{let J=!1;return D(!0),o({start:vs(u.start),end:Cs(u.end)}).then(be=>{if(J)return;const G=de(be==null?void 0:be.usages);g(G)}).catch(be=>{J||(console.error("Error fetching usage data:",be),g([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{J||D(!1)}),()=>{J=!0}},[o,u,de,s,t]),d.exports.useEffect(()=>{!(a!=null&&a.username)||(Q(J=>J!=null?J:a.username),me(J=>J!=null?J:a.username),a.is_sudo||pe([a.username]))},[a]),d.exports.useEffect(()=>{if(!(a!=null&&a.is_sudo))return;let J=!1;return _e("/admins").then(be=>{if(J)return;const N=(Array.isArray(be)?be:Array.isArray(be==null?void 0:be.admins)?be.admins:[]).map(Ee=>Ee==null?void 0:Ee.username).filter(Ee=>typeof Ee=="string"),we=Array.from(new Set(N)).sort((Ee,Fe)=>Ee.localeCompare(Fe));if(!we.length&&(a==null?void 0:a.username)){pe([a.username]);return}pe(we),Q(Ee=>{var Fe,Xe;return Ee&&we.includes(Ee)?Ee:(Xe=(Fe=we[0])!=null?Fe:Ee)!=null?Xe:null}),me(Ee=>{var Fe,Xe;return Ee&&we.includes(Ee)?Ee:(Xe=(Fe=we[0])!=null?Fe:Ee)!=null?Xe:null})}).catch(be=>{console.error("Error fetching admins:",be)}),()=>{J=!0}},[a==null?void 0:a.is_sudo,a==null?void 0:a.username]),d.exports.useEffect(()=>{var be,G;if(v!==null)return;const J=(be=m.filter(N=>N.nodeId>0).sort((N,we)=>we.total-N.total)[0])==null?void 0:be.nodeId;if(J&&J>0){C(J);return}if(Array.isArray(l)&&l.length){const N=(G=l[0])==null?void 0:G.id;N&&C(N)}},[v,m,l]),d.exports.useEffect(()=>{Ce(null)},[Y]),d.exports.useEffect(()=>{if(!Y){De([]),Ce(null);return}let J=!1;const be={start:vs(te.start),end:Cs(te.end)};return _e(`/admin/${encodeURIComponent(Y)}/usage/nodes`,{query:be}).then(G=>{if(J)return;const N=de(G==null?void 0:G.usages);De(N),Ce(we=>{var Fe,Xe,bt;if(we!==null)return we;const Ee=(Fe=N.filter(ct=>ct.nodeId!==0).sort((ct,Pt)=>Pt.total-ct.total)[0])==null?void 0:Fe.nodeId;return typeof Ee=="number"?Ee:(bt=(Xe=N[0])==null?void 0:Xe.nodeId)!=null?bt:0})}).catch(G=>{J||(console.error("Error fetching daily admin nodes:",G),De([]),Ce(null),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{J=!0}},[Y,te,de,s,t]),d.exports.useEffect(()=>{if(!P){y([]),ae(!1);return}let J=!1;return ae(!0),_e(`/admin/${encodeURIComponent(P)}/usage/nodes`,{query:{start:vs(ve.start),end:Cs(ve.end)}}).then(be=>{if(J)return;const G=de(be==null?void 0:be.usages);y(G)}).catch(be=>{J||(console.error("Error fetching admin totals nodes:",be),y([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{J||ae(!1)}),()=>{J=!0}},[P,ve,de,s,t]),d.exports.useEffect(()=>{if(v===null){M([]),W(null);return}let J=!1;ie(!0);const be={start:vs(k.start),end:Cs(k.end)};return k.unit==="hour"&&(be.granularity="hour"),_e(`/node/${v}/usage/daily`,{query:be}).then(G=>{var Fe,Xe,bt;if(J)return;const we=(Array.isArray(G==null?void 0:G.usages)?G.usages:[]).map(ct=>{var Pt,Mt;return{date:(Pt=ct==null?void 0:ct.date)!=null?Pt:"",used_traffic:Number((Mt=ct==null?void 0:ct.used_traffic)!=null?Mt:0)}});M(we);const Ee=(Xe=(Fe=G==null?void 0:G.node_name)!=null?Fe:dr.get(v))!=null?Xe:t("nodes.unknownNode","Unknown");W({nodeName:Ee,nodeId:(bt=G==null?void 0:G.node_id)!=null?bt:v})}).catch(G=>{J||(console.error("Error fetching node daily usage:",G),M([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{J||ie(!1)}),()=>{J=!0}},[v,k,dr,s,t]),d.exports.useEffect(()=>{if(!Y){H([]),O(null);return}if(re===null){H([]),O(null);return}let J=!1;Re(!0);const be={start:vs(te.start),end:Cs(te.end)};return re!=null&&(be.node_id=re),te.unit==="hour"&&(be.granularity="hour"),_e(`/admin/${encodeURIComponent(Y)}/usage/chart`,{query:be}).then(G=>{var Ee,Fe,Xe,bt;if(J)return;const we=(Array.isArray(G==null?void 0:G.usages)?G.usages:[]).map(ct=>{var Pt,Mt;return{date:(Pt=ct==null?void 0:ct.date)!=null?Pt:"",used_traffic:Number((Mt=ct==null?void 0:ct.used_traffic)!=null?Mt:0)}});H(we),O({nodeName:(Xe=(Fe=G==null?void 0:G.node_name)!=null?Fe:(Ee=Ge.find(ct=>ct.value===re))==null?void 0:Ee.label)!=null?Xe:null,nodeId:(bt=G==null?void 0:G.node_id)!=null?bt:re})}).catch(G=>{J||(console.error("Error fetching admin usage chart:",G),H([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{J||Re(!1)}),()=>{J=!0}},[Y,re,te,Ge,t,s]),n(ue,{spacing:6,align:"stretch",children:[n(T,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(st,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(ei,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:je(ft||0,2)})]})]}),e(ri,{presets:i,range:u,onPresetChange:ze,onCustomChange:it})]}),e(T,{mt:6,children:A?n(ue,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):q.series.length?e(jr,{options:q.options,series:q.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(T,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(st,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(ei,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(ee.span,{fontWeight:"medium",children:(nr=I==null?void 0:I.nodeName)!=null?nr:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:je(Ue||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(tt,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:v!=null?v:"",onChange:J=>{const be=J.target.value;if(!be){C(null);return}const G=Number(be);C(Number.isFinite(G)&&G>0?G:null)},placeholder:t("nodes.selectNode","Select node"),children:pt.map(J=>e("option",{value:J.value,children:J.label},J.value))}),e(ri,{presets:i,range:k,onPresetChange:he,onCustomChange:ce})]})]}),e(T,{mt:6,children:R?n(ue,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(sr=(Qt=Se[0])==null?void 0:Qt.data)!=null&&sr.length?e(jr,{options:We.options,series:We.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(T,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(st,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(ei,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ee.span,{fontWeight:"medium",children:Y!=null?Y:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(ee.span,{fontWeight:"medium",children:(ir=B==null?void 0:B.nodeName)!=null?ir:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:je(Ae||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(tt,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:Y!=null?Y:"",onChange:J=>Q(J.target.value||null),isDisabled:$t.length===0,children:$t.map(J=>e("option",{value:J.value,children:J.label},J.value))}),e(tt,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:re!=null?re:"",onChange:J=>{const be=J.target.value;if(be===""){Ce(null);return}const G=Number(be);Ce(Number.isNaN(G)?null:G)},placeholder:t("nodes.selectNode","Select node"),children:Ge.map(J=>e("option",{value:J.value,children:J.label},J.value))}),e(ri,{presets:i,range:te,onPresetChange:oe,onCustomChange:V})]})]}),e(T,{mt:6,children:Te?n(ue,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(ar=(Xt=Oe[0])==null?void 0:Xt.data)!=null&&ar.length?e(jr,{options:lt.options,series:lt.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(T,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[n(ue,{align:"start",spacing:1,children:[e(st,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:n(U,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(ei,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ee.span,{fontWeight:"medium",children:P!=null?P:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:je(Be||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(tt,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:P!=null?P:"",onChange:J=>me(J.target.value||null),isDisabled:$t.length===0,children:$t.map(J=>e("option",{value:J.value,children:J.label},J.value))}),e(ri,{presets:i,range:ve,onPresetChange:ye,onCustomChange:ht})]})]}),e(T,{mt:6,children:E?n(ue,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):le.series.length?e(jr,{options:le.options,series:le.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},fm=()=>{const{t}=Je(),{userData:s,getUserIsSuccess:r}=Un(),l=r&&s.is_sudo,o=Gn(i=>i.services),a=Gn(i=>i.fetchServices);return d.exports.useEffect(()=>{l&&a({limit:500})},[a,l]),r?l?n(ue,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),n(ss,{variant:"enclosed",colorScheme:"primary",children:[n(is,{children:[e(Bt,{children:t("usage.tabs.services","Services")}),e(Bt,{children:t("usage.tabs.admins","Admins")}),e(Bt,{children:t("usage.tabs.nodes","Nodes")})]}),n(as,{children:[e(Vt,{px:0,children:e(pm,{services:o})}),e(Vt,{px:0,children:e(cm,{})}),e(Vt,{px:0,children:e(gm,{})})]})]})]}):n(ue,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(ot,{justify:"center",align:"center",py:10,children:e(Dt,{})})},zl="__dot__",aa=t=>t.replace(/\./g,zl),Kn=t=>t.replace(new RegExp(zl,"g"),"."),bm=t=>{const s={},r=(l,o)=>{if(o!==void 0){if(typeof o=="boolean"){s[Kn(l)]=o;return}if(typeof o=="string"){if(o==="")return;o==="true"||o==="false"?s[Kn(l)]=o==="true":s[Kn(l)]=Boolean(o);return}if(typeof o=="number"){s[Kn(l)]=o!==0;return}if(Array.isArray(o)){s[Kn(l)]=o.length>0;return}if(o&&typeof o=="object"){Object.entries(o).forEach(([a,i])=>{const c=l?`${l}.${a}`:a;r(c,i)});return}s[Kn(l)]=Boolean(o)}};return Object.entries(t).forEach(([l,o])=>{r(l,o)}),s},Rl=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],ym=Rl.flatMap(t=>t.events.map(s=>s.key)),Ro=ee(Vr,{baseStyle:{w:4,h:4}}),Uo=ee(id,{baseStyle:{w:4,h:4}}),qi=t=>{var l,o,a,i;const s={};Object.entries(t.forum_topics||{}).forEach(([c,u])=>{var p;s[c]={title:(p=u.title)!=null?p:"",topic_id:u.topic_id!=null?String(u.topic_id):""}});const r={};return ym.forEach(c=>{var m;const u=aa(c),p=(m=t.event_toggles)==null?void 0:m[c];r[u]=p===void 0?!0:Boolean(p)}),Object.entries(t.event_toggles||{}).forEach(([c,u])=>{const p=aa(c);p in r||(r[p]=Boolean(u))}),{api_token:(l=t.api_token)!=null?l:"",use_telegram:(o=t.use_telegram)!=null?o:!0,proxy_url:(a=t.proxy_url)!=null?a:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(i=t.default_vless_flow)!=null?i:"",forum_topics:s,event_toggles:r}},Yi=({disabled:t,message:s,children:r})=>n(T,{position:"relative",children:[e(T,{pointerEvents:t?"none":"auto",filter:t?"blur(1.2px)":"none",opacity:t?.55:1,transition:"all 0.2s ease",children:r}),t&&e(ot,{position:"absolute",inset:0,align:"center",justify:"center",textAlign:"center",fontWeight:"semibold",color:"white",px:6,borderRadius:"inherit",bg:"blackAlpha.400",backdropFilter:"blur(2px)",children:e(h,{children:s})})]}),Sm=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(s=>s.length>0).map(s=>Number(s)).filter(s=>Number.isFinite(s)),xm=()=>{var me,Ie,De,L;const{t}=Je(),s=Ht(),r=ga(),{data:l,isLoading:o,refetch:a}=Tr("telegram-settings",Uu,{refetchOnWindowFocus:!1}),{data:i,isLoading:c,refetch:u}=Tr("panel-settings",ba,{refetchOnWindowFocus:!1}),p=Tr("maintenance-info",()=>_e("/maintenance/info"),{refetchOnWindowFocus:!1}),[m,g]=d.exports.useState((me=i==null?void 0:i.use_nobetci)!=null?me:!1),[A,D]=d.exports.useState(!1),[k,x]=d.exports.useState(!1),v=d.exports.useRef(null);d.exports.useEffect(()=>{i&&g(i.use_nobetci)},[i]);const{register:C,control:R,handleSubmit:ie,reset:b,watch:M,formState:{isDirty:I}}=Mr({defaultValues:qi(l!=null?l:{api_token:null,use_telegram:!0,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{l&&b(qi(l))},[l,b]);const W=Cr(Lu,{onSuccess:y=>{b(qi(y)),r.setQueryData("telegram-settings",y),s({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),ve=Cr(Mu,{onSuccess:y=>{g(y.use_nobetci),r.setQueryData("panel-settings",y),s({title:t("settings.panel.saved","Panel settings saved"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),Z=y=>{const E=bm(y.event_toggles||{}),ae={api_token:y.api_token.trim()||null,use_telegram:y.use_telegram,proxy_url:y.proxy_url.trim()||null,admin_chat_ids:Sm(y.admin_chat_ids),logs_chat_id:y.logs_chat_id.trim()?Number(y.logs_chat_id.trim()):null,logs_chat_is_forum:y.logs_chat_is_forum,default_vless_flow:y.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(y.forum_topics||{}).map(([re,Ce])=>[re,{title:Ce.title,topic_id:Ce.topic_id.trim()?Number(Ce.topic_id.trim()):void 0}])),event_toggles:E};W.mutate(ae)},te=y=>{if(!y)return`rebecca-backup-${Date.now()}.zip`;const E=y.split(";");for(const ae of E){const re=ae.trim();if(re.toLowerCase().startsWith("filename="))return re.split("=",1)[1].trim().replace(/(^\"|\"$)/g,"")||`rebecca-backup-${Date.now()}.zip`}return`rebecca-backup-${Date.now()}.zip`},z=async()=>{D(!0);try{const y=Zn(),E=await fetch("/api/maintenance/backup/export",{method:"GET",headers:y?{Authorization:`Bearer ${y}`}:void 0});if(!E.ok)throw new Error(await E.text());const ae=await E.blob(),re=te(E.headers.get("content-disposition")),Ce=window.URL.createObjectURL(ae),Te=document.createElement("a");Te.href=Ce,Te.download=re,document.body.appendChild(Te),Te.click(),document.body.removeChild(Te),window.URL.revokeObjectURL(Ce),Ot(t("settings.panel.backupDownloadSuccess"),s)}catch(y){Wt(y,s)}finally{D(!1)}},j=async y=>{var ae;const E=(ae=y.target.files)==null?void 0:ae[0];if(!!E){x(!0);try{const re=Zn(),Ce=new FormData;Ce.append("file",E);const Te=await fetch("/api/maintenance/backup/import",{method:"POST",headers:re?{Authorization:`Bearer ${re}`}:void 0,body:Ce});if(!Te.ok)throw new Error(await Te.text());Ot(t("settings.panel.backupUploadSuccess"),s)}catch(re){Wt(re,s)}finally{x(!1),y.target.value=""}}},pe=M("forum_topics"),Y=M("use_telegram"),Q=t("settings.telegram.disabledOverlay","Telegram bot is disabled. Enable it to edit these settings."),P=()=>{var y;(y=v.current)==null||y.click()};return n(T,{px:{base:4,md:8},py:{base:6,md:8},children:[e(kn,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),n(ss,{colorScheme:"primary",children:[n(is,{children:[e(Bt,{children:t("settings.panel.tabTitle","Panel")}),e(Bt,{children:t("settings.telegram","Telegram")}),e(Bt,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),n(as,{children:[e(Vt,{px:{base:0,md:2},children:c&&i===void 0?e(ot,{align:"center",justify:"center",py:12,children:e(Dt,{size:"lg"})}):n(ke,{spacing:6,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.description","Control dashboard-specific behaviors that affect all admins.")}),e(T,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(ot,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(T,{children:[e(kn,{size:"sm",mb:1,children:t("settings.panel.useNobetciTitle","Enable Nobetci integration")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.useNobetciDescription","Show Nobetci options when creating or editing nodes.")})]}),e(dt,{isChecked:m,onChange:y=>g(y.target.checked),isDisabled:ve.isLoading||c})]})}),n(T,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(ot,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(T,{children:[e(kn,{size:"sm",mb:1,children:t("settings.panel.maintenanceTitle","Maintenance status")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceDescription","Inspect which container images are currently used by the panel and node.")})]}),e(K,{variant:"outline",size:"sm",leftIcon:e(Vr,{width:16,height:16}),onClick:()=>p.refetch(),isLoading:p.isFetching,children:t("actions.refresh","Refresh")})]}),e(ke,{spacing:2,mt:4,children:p.isLoading&&!p.data?e(ot,{align:"center",justify:"center",py:4,children:e(Dt,{size:"sm"})}):n(Lt,{children:[n(T,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.panelVersion","Panel image")}),e(h,{fontSize:"sm",color:"gray.500",children:(De=(Ie=p.data)==null?void 0:Ie.panel)!=null&&De.image?`${p.data.panel.image}${p.data.panel.tag?` (${p.data.panel.tag})`:""}`:t("settings.panel.versionUnknown","Unknown")})]}),n(T,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.nodeVersion","Node image")}),e(h,{fontSize:"sm",color:"gray.500",children:(L=p.data)!=null&&L.node?p.data.node.image?`${p.data.node.image}${p.data.node.tag?` (${p.data.node.tag})`:""}`:t("settings.panel.versionUnknown","Unknown"):t("settings.panel.nodeVersionUnavailable","Node deployment not detected")})]})]})})]}),n(T,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(ot,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(T,{children:[e(kn,{size:"sm",mb:1,children:t("settings.panel.backupTitle","Backup & Restore")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.backupDescription","Create or restore backups directly through the maintenance service.")})]}),n(ke,{spacing:3,direction:{base:"column",md:"row"},children:[e(K,{leftIcon:e(ua,{width:16,height:16}),onClick:z,isLoading:A,children:t("settings.panel.backupDownload","Download backup")}),e(K,{leftIcon:e(da,{width:16,height:16}),onClick:P,isLoading:k,children:t("settings.panel.backupUpload","Restore backup")})]})]}),e("input",{ref:v,type:"file",accept:".zip,.tar.gz",style:{display:"none"},onChange:j})]}),n(ot,{gap:3,justify:"flex-end",children:[e(K,{variant:"outline",leftIcon:e(Ro,{}),onClick:()=>u(),isDisabled:ve.isLoading,children:t("actions.refresh","Refresh")}),e(K,{colorScheme:"primary",leftIcon:e(Uo,{}),onClick:()=>ve.mutate({use_nobetci:m}),isLoading:ve.isLoading,isDisabled:ve.isLoading||i===void 0||m===i.use_nobetci,children:t("settings.save","Save Settings")})]})]})}),e(Vt,{px:{base:0,md:2},children:o&&!l?e(ot,{align:"center",justify:"center",py:12,children:e(Dt,{size:"lg"})}):e("form",{onSubmit:ie(Z),children:n(ue,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),n(ot,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(T,{children:[e(kn,{size:"sm",mb:1,children:t("settings.telegram.enableBot","Enable Telegram bot")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.enableBotDescription","Turn the bot on or off without clearing the API token.")})]}),e(ut,{control:R,name:"use_telegram",render:({field:y})=>e(dt,{isChecked:y.value,onChange:E=>y.onChange(E.target.checked)})})]}),e(Yi,{disabled:!Y,message:Q,children:e(T,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(Ke,{columns:{base:1,md:2},spacing:6,children:[n(w,{children:[e(_,{children:t("settings.telegram.apiToken","Bot API Token")}),e(xe,{placeholder:"123456:ABC",...C("api_token")})]}),n(w,{children:[e(_,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(xe,{placeholder:"socks5://user:pass@host:port",...C("proxy_url")})]}),n(w,{children:[e(_,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(xe,{placeholder:"12345, 67890",...C("admin_chat_ids")}),e(Lr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),n(w,{children:[e(_,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(xe,{placeholder:"-100123456789",...C("logs_chat_id")}),e(Lr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),n(w,{display:"flex",alignItems:"center",children:[e(_,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(ut,{control:R,name:"logs_chat_is_forum",render:({field:y})=>e(dt,{id:"logs_chat_is_forum",isChecked:y.value,onChange:y.onChange})})]}),n(w,{children:[e(_,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(xe,{placeholder:"xtls-rprx-vision",...C("default_vless_flow")})]})]})})}),e(Yi,{disabled:!Y,message:Q,children:n(T,{children:[e(kn,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),pe&&Object.keys(pe).length>0?e(ke,{spacing:4,children:Object.entries(pe).map(([y])=>n(T,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",y]}),n(Ke,{columns:{base:1,md:2},spacing:4,children:[n(w,{children:[e(_,{children:t("settings.telegram.topicTitle","Topic Title")}),e(xe,{...C(`forum_topics.${y}.title`)})]}),n(w,{children:[e(_,{children:t("settings.telegram.topicId","Topic ID")}),e(xe,{type:"number",...C(`forum_topics.${y}.topic_id`)}),e(Lr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},y))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]})}),e(Yi,{disabled:!Y,message:Q,children:n(T,{children:[e(kn,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(ke,{spacing:4,children:Rl.map(y=>n(T,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(y.titleKey,y.defaultTitle)}),e(Ke,{columns:{base:1,md:2},spacing:4,children:y.events.map(E=>n(w,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[n(T,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(E.labelKey,E.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(E.hintKey,E.defaultHint)})]}),e(ut,{control:R,name:`event_toggles.${aa(E.key)}`,render:({field:ae})=>e(dt,{isChecked:Boolean(ae.value),onChange:re=>ae.onChange(re.target.checked)})})]},E.key))})]},y.key))})]})}),n(ot,{gap:3,justify:"flex-end",children:[e(K,{variant:"outline",leftIcon:e(Ro,{}),onClick:()=>a(),isDisabled:W.isLoading,children:t("actions.refresh","Refresh")}),e(K,{colorScheme:"primary",leftIcon:e(Uo,{}),type:"submit",isLoading:W.isLoading,isDisabled:!I&&!W.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(Vt,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},km=async()=>{try{const t=Zn();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const s=await _e("/admin",{headers:{Authorization:`Bearer ${t}`}});if(s&&typeof s=="object"&&"error"in s)throw new Error(`API error: ${s.error||"Unknown error"}`);return s}catch(t){throw console.error("Loader error:",t),t}},wm=ad([{path:"/",element:e(nu,{}),errorElement:e(Ma,{}),loader:km,children:[{index:!0,element:e(pu,{})},{path:"users",element:e(oh,{})},{path:"admins",element:e(hh,{})},{path:"usage",element:e(fm,{})},{path:"services",element:e(rm,{})},{path:"hosts",element:e(ep,{})},{path:"node-settings",element:e(Sp,{})},{path:"integrations",element:e(xm,{})},{path:"xray-settings",element:e(em,{})},{path:"xray-logs",element:e(El,{})}]},{path:"/login/",element:e(Ma,{})}]);function vm(){return e(od,{router:wm})}$e.extend(ld);$e.extend(cd);$e.extend(Hs);$e.extend(dd);$e.extend(ud);oi(hd.get()||"light");pd.createRoot(document.getElementById("root")).render(e(Gi.StrictMode,{children:e(md,{theme:fd,children:e(gd,{client:ai,children:e(vm,{})})})}));
