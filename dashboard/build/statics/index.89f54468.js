var zo=Object.defineProperty;var Lo=(t,a,r)=>a in t?zo(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;var T=(t,a,r)=>(Lo(t,typeof a!="symbol"?a+"":a,r),r);import{i as yn,B as Po,a as No,b as Uo,j as Pi,d as Te,U as da,z as Ro,r as Mo,f as Oo,Q as Wo,e as Fo,m as it,$ as Ho,c as V,X as Ni,R as ta,N as Ls,I as de,g as Ps,h as s,F,k as e,l as H,n as jt,o as Bo,p as Tn,q as _t,s as Vo,t as $o,u as Jo,v as Ko,w as nr,x as Tr,y as d,L as Yo,C as ua,A as Ne,D as qe,M as vn,E as Cn,G as Ee,H as _n,J as Ft,K as P,O as qo,T as h,S as Go,P as Zo,V as ra,W as Pr,Y as sa,Z as Ui,_ as Ri,a0 as Qo,a1 as Rt,a2 as Ur,a3 as Gt,a4 as Ma,a5 as z,a6 as Dn,a7 as Dt,a8 as nt,a9 as At,aa as ct,ab as xt,ac as at,ad as X,ae as ot,af as De,ag as yr,ah as te,ai as kt,aj as zn,ak as Se,al as Xo,am as Ns,an as ha,ao as jo,ap as ma,aq as or,ar as pr,as as kr,at as hr,au as mr,av as as,aw as Ln,ax as vr,ay as el,az as Mi,aA as tl,aB as rl,aC as sl,aD as nl,aE as Pn,aF as al,aG as Oi,aH as An,aI as Oa,aJ as il,aK as ol,aL as Wi,aM as Xt,aN as Nt,aO as ll,aP as cl,aQ as ga,aR as pa,aS as hs,aT as dl,aU as ul,aV as Nn,aW as lt,aX as Fi,aY as fr,aZ as Yr,a_ as hl,a$ as fa,b0 as Hr,b1 as Hi,b2 as ml,b3 as gl,b4 as Ge,b5 as Bi,b6 as pl,b7 as fl,b8 as Vi,b9 as bl,ba as $i,bb as yl,bc as Sl,bd as xl,be as Ji,bf as kl,bg as wl,bh as vl,bi as Mn,bj as Wa,bk as Ws,bl as Fs,bm as Ht,bn as Hs,bo as Bt,bp as Cl,bq as _l,br as ms,bs as Dl,bt as Ir,bu as Al,bv as vt,bw as et,bx as Ct,by as gr,bz as Nr,bA as Ki,bB as Il,bC as Yi,bD as is,bE as br,bF as gt,bG as Pe,bH as dr,bI as Le,bJ as qi,bK as Gi,bL as Zi,bM as Fa,bN as Sr,bO as El,bP as Tl,bQ as zl,bR as Ll,bS as Pl,bT as Nl,bU as Us,bV as Rs,bW as Bs,bX as Qi,bY as St,bZ as Ul,b_ as rs,b$ as Lr,c0 as Vs,c1 as $s,c2 as Rl,c3 as Js,c4 as Ks,c5 as Xi,c6 as Ys,c7 as Ml,c8 as ji,c9 as ba,ca as cr,cb as eo,cc as na,cd as Er,ce as qs,cf as On,cg as Ol,ch as Wl,ci as Fl,cj as Hl,ck as Bl,cl as to,cm as ro,cn as Vl,co as $l,cp as Jl,cq as Kl,cr as Yl,cs as ql,ct as Gl,cu as Zl,cv as Ql,cw as Xl,cx as ya,cy as jl,cz as Wn,cA as ec,cB as tc,cC as rc,cD as sc,cE as nc,cF as ac,cG as ic,cH as oc,cI as lc,cJ as cc}from"./vendor.44535343.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}})();yn.use(Po).use(No).use(Uo).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:Pi(["/","statics/locales/{{lng}}.json"])}},function(t,a){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",yn.language),Te.locale(yn.language)});yn.on("languageChanged",t=>{console.log("Language changed to:",t),Te.locale(t)});da("zh-cn",Ro);da("ru",Mo);da("fa",Oo);const Sn=new Wo,xn=(t,a)=>{const r=document.querySelector('meta[name="theme-color"]'),o={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:a||"#f6f8ff"},n=a||o[t]||o.default;r==null||r.setAttribute("content",n)},dc=Fo({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:it("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:it("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:it("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:it("surface.light","surface.dark")(t),borderColor:it("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:it("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t),boxShadow:it("lg","dark-lg")(t)},item:{_hover:{bg:it("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:it("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:it("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t),boxShadow:it("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:it("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:it("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:it("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:it("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:it("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:it("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:it("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const In=()=>localStorage.getItem("token"),uc=t=>{localStorage.setItem("token",t)},hc=()=>{localStorage.removeItem("token")},mc=Ho.create({baseURL:{}.VITE_BASE_API}),gc=(t,a={})=>(In()&&(a.headers={...(a==null?void 0:a.headers)||{},Authorization:`Bearer ${In()}`}),mc(t,a)),we=gc,pc=V(Ni,{baseStyle:{w:4,h:4}}),Ut=ta.forwardRef(({disabled:t,step:a,label:r,className:o,startAdornment:n,endAdornment:l,type:i="text",placeholder:c,onChange:u,onBlur:m,name:g,value:p,onClick:D,error:I,clearable:k=!1,...f},v)=>{const N=()=>{u&&u({target:{value:"",name:g}})},{size:M="md"}=f,j=i=="number"?Ls:de,C=i=="number"?Ps:ta.Fragment,B=i=="number"?{keepWithinRange:!0,precision:5,format:re=>isNaN(parseFloat(String(re)))||Number(parseFloat(String(re)).toFixed(5))===0?re:Number(parseFloat(String(re)).toFixed(5)),min:0,step:a,name:g,type:i,placeholder:c,onChange:re=>{u&&u(re)},onBlur:m,value:p,onClick:D,disabled:t,flexGrow:1,size:M}:{};return s(F,{isInvalid:!!I,children:[r&&e(H,{children:r}),s(jt,{size:M,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[n&&e(Bo,{children:n}),s(C,{...B,children:[e(j,{name:g,ref:v,step:a,className:Tn(o),type:i,placeholder:c,onChange:u,onBlur:m,value:p,onClick:D,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...f,roundedLeft:n?"0":"md",roundedRight:l?"0":"md"}),i=="number"&&e(_t,{children:s(Vo,{children:[e($o,{}),e(Jo,{})]})})]}),l&&e(Ko,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:l}),k&&p&&p.length&&e(nr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:N,cursor:"pointer",children:e(pc,{})})]}),!!I&&e(Tr,{children:I})]})}),fc=t=>d.exports.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.exports.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),bc=V(Yo,{baseStyle:{w:4,h:4}}),yc=V(ua,{baseStyle:{w:4,h:4}}),so=({actions:t})=>{const{i18n:a}=Ne(),r=qe("surface.light","surface.dark"),o=qe("blackAlpha.50","whiteAlpha.100"),n=qe("blackAlpha.200","whiteAlpha.200"),l=qe("gray.800","gray.100"),i=u=>{a.changeLanguage(u)};return s(vn,{placement:"bottom-end",children:[e(Cn,{as:Ee,size:"sm",variant:"outline",icon:e(bc,{}),position:"relative"}),e(_n,{minW:"160px",zIndex:9999,bg:r,borderColor:n,color:l,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:m,flag:g})=>e(Ft,{fontSize:"sm",onClick:()=>i(u),_hover:{bg:o},children:s(P,{justify:"space-between",w:"full",children:[s(P,{spacing:2,children:[e(qo,{countryCode:g,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:m})]}),a.language===u&&e(yc,{})]})},u))})]})},Ha="rb-theme",Ba="rb-custom-themes",Sc=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],Va=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],$a=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],Yt={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},qt={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Fn=.14,Hn=.22,Ja=V(ua,{baseStyle:{w:4,h:4}}),xc=V(Go,{baseStyle:{w:4,h:4}}),kc=V(Zo,{baseStyle:{w:4,h:4}}),wc=V(ra,{baseStyle:{w:4,h:4}}),vc=V(Pr,{baseStyle:{w:4,h:4}}),Ka=V(sa,{baseStyle:{w:4,h:4}}),Cc=V(Ui,{baseStyle:{w:4,h:4}}),_c=V(Ri,{baseStyle:{w:4,h:4}}),Dc=V(Qo,{baseStyle:{w:4,h:4}}),no=(t,a=0,r=1)=>Math.min(r,Math.max(a,t)),aa=t=>{const a=t.replace("#",""),r=parseInt(a,16);if(a.length===3){const o=r>>8&15,n=r>>4&15,l=r&15;return{r:o<<4|o,g:n<<4|n,b:l<<4|l}}return{r:r>>16&255,g:r>>8&255,b:r&255}},ao=(t,a,r)=>{const o=n=>n.toString(16).padStart(2,"0");return`#${o(t)}${o(a)}${o(r)}`},Ac=(t,a,r)=>{t/=255,a/=255,r/=255;const o=Math.max(t,a,r),n=Math.min(t,a,r);let l=0,i=0;const c=(o+n)/2;if(o!==n){const u=o-n;switch(i=c>.5?u/(2-o-n):u/(o+n),o){case t:l=(a-r)/u+(a<r?6:0);break;case a:l=(r-t)/u+2;break;default:l=(t-a)/u+4}l/=6}return{h:l,s:i,l:c}},Ic=(t,a,r)=>{let o,n,l;if(a===0)o=n=l=r;else{const i=(m,g,p)=>(p<0&&(p+=1),p>1&&(p-=1),p<.16666666666666666?m+(g-m)*6*p:p<.5?g:p<.6666666666666666?m+(g-m)*(.6666666666666666-p)*6:m),c=r<.5?r*(1+a):r+a-r*a,u=2*r-c;o=i(u,c,t+1/3),n=i(u,c,t),l=i(u,c,t-1/3)}return{r:Math.round(o*255),g:Math.round(n*255),b:Math.round(l*255)}},Bn=t=>{try{const{r:a,g:r,b:o}=aa(t),{h:n,s:l,l:i}=Ac(a,r,o);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[m,g])=>{const{r:p,g:D,b:I}=Ic(n,l,no(i+g));return u[`--primary-${m}`]=ao(p,D,I),u},{})}catch{return{}}},Ec=(t,a,r)=>{const o=no(r,0,1),n=aa(t),l=aa(a),i=(c,u)=>Math.round(c*(1-o)+u*o);return ao(i(n.r,l.r),i(n.g,l.g),i(n.b,l.b))},Xr=(t,a,r,o)=>{try{return Ec(t,a,r)}catch{return o}},Tc=()=>{const t=document.documentElement;Sc.forEach(a=>t.style.removeProperty(a)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},zc=(t,a)=>{const r=document.documentElement;Object.entries(t).forEach(([o,n])=>r.style.setProperty(o,n)),r.style.setProperty("--bg-light",a.bgLight),r.style.setProperty("--bg-dark",a.bgDark),r.style.setProperty("--surface-light",a.surfaceLight),r.style.setProperty("--surface-dark",a.surfaceDark)},Vn=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},Ya=()=>({name:"",light:{...Yt},dark:{...qt}}),Et=(t,a)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:a,io=({minimal:t=!1})=>{const{t:a}=Ne(),r=Rt(),{colorMode:o,toggleColorMode:n}=Ur(),l=Gt(),i=Gt(),c=qe("surface.light","surface.dark"),u=qe("blackAlpha.50","whiteAlpha.100"),m=qe("blackAlpha.200","whiteAlpha.200"),g=qe("gray.800","gray.100"),p=qe("gray.600","gray.300"),D=qe("blackAlpha.400","blackAlpha.700"),I=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:p}}),[p]),[k,f]=d.exports.useState(()=>{try{return localStorage.getItem(Ha)||"default"}catch{return"default"}}),[v,N]=d.exports.useState(()=>{try{const x=localStorage.getItem(Ba);if(!x)return[];const A=JSON.parse(x);return Array.isArray(A)?A.map(ie=>{var Be,Ve,Ze,dt,oe,he;const O=Et(((Be=ie.light)==null?void 0:Be.primary)||Yt.primary,Yt.primary),ue=Et(((Ve=ie.light)==null?void 0:Ve.bg)||Yt.bg,Yt.bg),ve=Xr(ue,O,Fn,Yt.surface),ze=Et(((Ze=ie.light)==null?void 0:Ze.surface)||ve,ve),Me=Et(((dt=ie.dark)==null?void 0:dt.primary)||qt.primary,qt.primary),q=Et(((oe=ie.dark)==null?void 0:oe.bg)||qt.bg,qt.bg),ye=Xr(q,Me,Hn,qt.surface),_e=Et(((he=ie.dark)==null?void 0:he.surface)||ye,ye);return{id:ie.id||Vn(),name:ie.name||"Custom",light:{primary:O,bg:ue,surface:ze},dark:{primary:Me,bg:q,surface:_e}}}):[]}catch{return[]}}),[M,j]=d.exports.useState(Ya),[C,B]=d.exports.useState(null),[re,_]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(Ba,JSON.stringify(v))}catch{}},[v]),d.exports.useEffect(()=>{try{localStorage.setItem(Ha,k)}catch{}},[k]),d.exports.useEffect(()=>{k.startsWith("custom:")&&(v.some(A=>`custom:${A.id}`===k)||f("default"))},[k,v]),d.exports.useEffect(()=>{const x=document.documentElement;Array.from(x.classList).filter(ie=>ie.startsWith("rb-theme-")).forEach(ie=>x.classList.remove(ie)),Tc();const A=Va.find(ie=>ie.key===k);if(A){A.className&&x.classList.add(A.className),xn(A.key);return}if(k.startsWith("custom:")){const ie=v.find(ve=>`custom:${ve.id}`===k);if(!ie)return;const O=o==="dark"?ie.dark:ie.light,ue=Bn(O.primary);zc(ue,{bgLight:ie.light.bg,bgDark:ie.dark.bg,surfaceLight:ie.light.surface,surfaceDark:ie.dark.surface}),xn("custom",o==="dark"?ie.dark.bg:ie.light.bg)}else xn("default")},[k,v,o]);const K=d.exports.useCallback(x=>{x.colorModeTarget&&o!==x.colorModeTarget&&n(),f(x.key)},[o,n]),pe=x=>{f(`custom:${x}`)},be=x=>{B(null),j(x?{name:a(`theme.presets.${x.key}.name`),light:{...x.light},dark:{...x.dark}}:Ya()),l.onOpen()},Ie=x=>{B(x.id),j({name:x.name,light:{...x.light},dark:{...x.dark}}),l.onOpen()},le=()=>{const x=M.name.trim()||a("theme.untitled"),A=Et(M.light.primary,Yt.primary),ie=Et(M.light.bg,Yt.bg),O=Xr(ie,A,Fn,Yt.surface),ue=Et(M.light.surface,O),ve=Et(M.dark.primary,qt.primary),ze=Et(M.dark.bg,qt.bg),Me=Xr(ze,ve,Hn,qt.surface),q=Et(M.dark.surface,Me),ye={id:C||Vn(),name:x,light:{primary:A,bg:ie,surface:ue},dark:{primary:ve,bg:ze,surface:q}};N(_e=>C?_e.map(Be=>Be.id===C?ye:Be):[..._e,ye]),f(`custom:${ye.id}`),l.onClose(),B(null),r({status:"success",title:a("theme.customSaved")})},ge=x=>{N(A=>A.filter(ie=>ie.id!==x)),k===`custom:${x}`&&f("default"),r({status:"info",title:a("theme.customDeleted")})},G=()=>{f("default"),r({status:"info",title:a("theme.resetSuccess")})},Q=async()=>{if(!v.length){r({status:"warning",title:a("theme.exportEmpty")});return}const x=v.map(({id:ie,...O})=>O),A=JSON.stringify(x,null,2);try{await navigator.clipboard.writeText(A),r({status:"success",title:a("theme.exportSuccess")})}catch{try{const ie=new Blob([A],{type:"application/json"}),O=URL.createObjectURL(ie),ue=document.createElement("a");ue.href=O,ue.download="rebecca-themes.json",ue.click(),URL.revokeObjectURL(O),r({status:"success",title:a("theme.exportSuccessDownload")})}catch{r({status:"error",title:a("theme.exportError")})}}},w=()=>{try{const x=JSON.parse(re),ie=(Array.isArray(x)?x:[x]).map(O=>{var Ve,Ze,dt,oe,he,Z;const ue=Et(((Ve=O==null?void 0:O.light)==null?void 0:Ve.primary)||Yt.primary,Yt.primary),ve=Et(((Ze=O==null?void 0:O.light)==null?void 0:Ze.bg)||Yt.bg,Yt.bg),ze=Xr(ve,ue,Fn,Yt.surface),Me=Et(((dt=O==null?void 0:O.light)==null?void 0:dt.surface)||ze,ze),q=Et(((oe=O==null?void 0:O.dark)==null?void 0:oe.primary)||qt.primary,qt.primary),ye=Et(((he=O==null?void 0:O.dark)==null?void 0:he.bg)||qt.bg,qt.bg),_e=Xr(ye,q,Hn,qt.surface),Be=Et(((Z=O==null?void 0:O.dark)==null?void 0:Z.surface)||_e,_e);return{id:Vn(),name:(O==null?void 0:O.name)||"Custom",light:{primary:ue,bg:ve,surface:Me},dark:{primary:q,bg:ye,surface:Be}}}).filter(O=>O.name);if(!ie.length){r({status:"warning",title:a("theme.importError")});return}N(O=>[...O,...ie]),i.onClose(),_(""),r({status:"success",title:a("theme.importSuccess")})}catch{r({status:"error",title:a("theme.importError")})}},me=d.exports.useCallback((x,A)=>{x.preventDefault(),x.stopPropagation(),A()},[]),xe=d.exports.useMemo(()=>Bn(M.light.primary),[M.light.primary]),$=d.exports.useMemo(()=>Bn(M.dark.primary),[M.dark.primary]),y=x=>{const A=M[x],ie=x==="dark"?$:xe,O=ie["--primary-500"]||A.primary,ue=ie["--primary-300"]||ie["--primary-400"]||O,ve=x==="dark"?"whiteAlpha.900":"gray.800",ze=x==="dark"?"whiteAlpha.700":"gray.600",Me=x==="dark"?"whiteAlpha.200":"blackAlpha.200",q=x==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(z,{borderWidth:"1px",borderRadius:"md",bg:A.bg,p:4,borderColor:Me,children:s(De,{spacing:3,children:[e(h,{fontWeight:"semibold",color:ve,children:a(x==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(z,{borderRadius:"lg",bg:A.surface,p:4,borderWidth:"1px",borderColor:Me,children:s(De,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:ve,children:a("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:ze,children:a("theme.previewSampleBody")}),e(te,{size:"sm",bg:O,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:a("theme.previewSampleAction")}),s(P,{spacing:2,pt:2,children:[e(z,{flex:"1",h:"2",borderRadius:"full",bg:ue,opacity:.8}),e(z,{flex:"1",h:"2",borderRadius:"full",bg:O,opacity:.9})]})]})}),s(P,{spacing:1,pt:1,flexWrap:"wrap",children:[e(z,{w:6,h:6,borderRadius:"sm",bg:A.bg,borderWidth:"1px",borderColor:q}),e(z,{w:6,h:6,borderRadius:"sm",bg:A.surface,borderWidth:"1px",borderColor:q}),Object.entries(ie).map(([ye,_e])=>e(z,{w:6,h:6,borderRadius:"sm",bg:_e,borderWidth:"1px",borderColor:q,title:ye},ye))]})]})})};return s(_t,{children:[s(vn,{placement:"bottom-end",children:[e(Cn,{as:Ee,size:"sm",variant:"outline",icon:e(xc,{}),position:"relative"}),s(_n,{minW:"260px",zIndex:9999,bg:c,color:g,borderColor:m,children:[e(Ma,{title:a("theme.builtIn"),sx:I,children:Va.map(x=>{const A=k===x.key;return e(Ft,{onClick:()=>K(x),_hover:{bg:u},children:s(P,{justify:"space-between",w:"full",children:[s(P,{children:[e(z,{w:"4",h:"3",bg:x.accent,borderRadius:"xs",borderWidth:"1px",borderColor:m}),e(h,{children:a(`theme.${x.key}`)})]}),A&&e(Ja,{})]})},x.key)})}),!t&&s(_t,{children:[e(Dn,{borderColor:m}),s(Ma,{title:a("theme.customGroup"),sx:I,children:[v.length?v.map(x=>{const A=k===`custom:${x.id}`;return e(Ft,{onClick:()=>pe(x.id),_hover:{bg:u},children:s(P,{justify:"space-between",w:"full",children:[s(P,{children:[e(z,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${x.light.surface}, ${x.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:m}),e(h,{children:x.name})]}),s(P,{spacing:1,children:[A&&e(Ja,{}),[{icon:e(wc,{}),label:a("theme.edit"),onClick:()=>Ie(x)},{icon:e(vc,{}),label:a("theme.delete"),onClick:()=>ge(x.id)}].map(({icon:ie,label:O,onClick:ue})=>e(z,{as:"span",role:"button",tabIndex:0,"aria-label":O,onClick:ve=>me(ve,ue),onKeyDown:ve=>{(ve.key==="Enter"||ve.key===" ")&&me(ve,ue)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:u},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:ie},O))]})]})},x.id)}):e(Ft,{isDisabled:!0,children:a("theme.noCustom")}),e(Ft,{icon:e(kc,{}),onClick:()=>be(),_hover:{bg:u},children:a("theme.createCustom")})]}),e(Dn,{borderColor:m}),e(Ft,{icon:e(Ka,{}),onClick:()=>be($a[0]),_hover:{bg:u},children:a("theme.quickPreset")}),e(Ft,{icon:e(Cc,{}),onClick:Q,_hover:{bg:u},children:a("theme.export")}),e(Ft,{icon:e(_c,{}),onClick:()=>i.onOpen(),_hover:{bg:u},children:a("theme.import")}),e(Ft,{icon:e(Dc,{}),onClick:G,_hover:{bg:u},children:a("theme.reset")})]})]})]}),s(Dt,{isOpen:l.isOpen,onClose:l.onClose,isCentered:!0,size:"xl",children:[e(nt,{bg:D,backdropFilter:"blur(4px)"}),s(At,{mx:4,bg:c,borderColor:m,borderWidth:"1px",color:g,children:[e(ct,{color:g,children:a(C?"theme.editThemeTitle":"theme.customTitle")}),e(xt,{}),e(at,{children:s(X,{spacing:6,align:"stretch",children:[s(F,{children:[e(H,{color:p,children:a("theme.customName")}),e(de,{placeholder:a("theme.customNamePlaceholder")||"",value:M.name,onChange:x=>j(A=>({...A,name:x.target.value}))})]}),s(ot,{columns:{base:1,md:2},spacing:4,children:[y("light"),y("dark")]}),s(ot,{columns:{base:1,md:2},spacing:4,children:[s(De,{spacing:4,children:[s(F,{children:[e(H,{color:p,children:a("theme.lightPrimary")}),e(de,{type:"color",value:M.light.primary,onChange:x=>j(A=>({...A,light:{...A.light,primary:x.target.value}}))}),e(yr,{color:p,children:a("theme.lightPrimaryHint")})]}),s(F,{children:[e(H,{color:p,children:a("theme.lightSurface")}),e(de,{type:"color",value:M.light.surface,onChange:x=>j(A=>({...A,light:{...A.light,surface:x.target.value}}))}),e(yr,{color:p,children:a("theme.lightSurfaceHint")})]}),s(F,{children:[e(H,{color:p,children:a("theme.lightBackground")}),e(de,{type:"color",value:M.light.bg,onChange:x=>j(A=>({...A,light:{...A.light,bg:x.target.value}}))})]})]}),s(De,{spacing:4,children:[s(F,{children:[e(H,{color:p,children:a("theme.darkPrimary")}),e(de,{type:"color",value:M.dark.primary,onChange:x=>j(A=>({...A,dark:{...A.dark,primary:x.target.value}}))}),e(yr,{color:p,children:a("theme.darkPrimaryHint")})]}),s(F,{children:[e(H,{color:p,children:a("theme.darkSurface")}),e(de,{type:"color",value:M.dark.surface,onChange:x=>j(A=>({...A,dark:{...A.dark,surface:x.target.value}}))}),e(yr,{color:p,children:a("theme.darkSurfaceHint")})]}),s(F,{children:[e(H,{color:p,children:a("theme.darkBackground")}),e(de,{type:"color",value:M.dark.bg,onChange:x=>j(A=>({...A,dark:{...A.dark,bg:x.target.value}}))})]})]})]}),s(z,{children:[s(P,{mb:2,children:[e(Ka,{}),e(h,{fontWeight:"semibold",children:a("theme.presets")})]}),e(ot,{columns:{base:1,md:3},spacing:3,children:$a.map(x=>e(te,{size:"sm",variant:"outline",onClick:()=>j({name:a(`theme.presets.${x.key}.name`),light:{...x.light},dark:{...x.dark}}),children:a(`theme.presets.${x.key}.name`)},x.key))})]})]})}),s(kt,{children:[e(te,{variant:"ghost",mr:3,onClick:l.onClose,children:a("cancel")}),e(te,{colorScheme:"primary",onClick:le,children:a(C?"theme.customUpdate":"theme.customSave")})]})]})]}),s(Dt,{isOpen:i.isOpen,onClose:i.onClose,size:"lg",isCentered:!0,children:[e(nt,{bg:D,backdropFilter:"blur(4px)"}),s(At,{mx:4,bg:c,borderColor:m,borderWidth:"1px",color:g,children:[e(ct,{color:g,children:a("theme.importTitle")}),e(xt,{}),e(at,{children:s(X,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:p,children:a("theme.importDescription")}),e(zn,{rows:8,placeholder:a("theme.importPlaceholder")||"",value:re,onChange:x=>_(x.target.value),bg:"transparent",borderColor:m,color:g})]})}),s(kt,{children:[e(te,{variant:"ghost",mr:3,onClick:i.onClose,children:a("cancel")}),e(te,{colorScheme:"primary",onClick:w,children:a("theme.importAction")})]})]})]})]})},Lc=Se.object({username:Se.string().min(1,"login.fieldRequired"),password:Se.string().min(1,"login.fieldRequired")}),Pc=V(fc,{baseStyle:{strokeWidth:"10px",w:12,h:12}}),Nc=V(Xo,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Uc=V(Ns,{baseStyle:{w:4,h:4}}),Rc=V(ha,{baseStyle:{w:4,h:4}}),qa=()=>{var I,k;const[t,a]=d.exports.useState(""),[r,o]=d.exports.useState(!1),[n,l]=d.exports.useState(!1),i=jo(),{t:c}=Ne();let u=ma();const{register:m,formState:{errors:g},handleSubmit:p}=or({resolver:Ln(Lc)});d.exports.useEffect(()=>{hc(),u.pathname!=="/login"&&i("/login",{replace:!0})},[]);const D=f=>{a("");const v=new FormData;v.append("username",f.username),v.append("password",f.password),v.append("grant_type","password"),o(!0),we("/admin/token",{method:"post",body:v}).then(({access_token:N})=>{console.log("Token received:",N),uc(N),i("/")}).catch(N=>{var M,j;a(((j=(M=N.response)==null?void 0:M._data)==null?void 0:j.detail)||"Login failed")}).finally(()=>o(!1))};return e(X,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(pr,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:s(kr,{children:[s(P,{justifyContent:"end",spacing:2,mb:6,children:[e(so,{}),e(io,{minimal:!0})]}),s(X,{alignItems:"center",w:"full",spacing:4,children:[e(Pc,{}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(z,{w:"full",pt:"4",children:e("form",{onSubmit:p(D),children:s(X,{spacing:4,children:[e(F,{children:e(Ut,{w:"full",placeholder:c("username"),...m("username"),error:c((I=g==null?void 0:g.username)==null?void 0:I.message)})}),s(F,{isInvalid:!!g.password,children:[s(jt,{children:[e(de,{w:"full",type:n?"text":"password",placeholder:c("password"),...m("password")}),e(nr,{children:e(Ee,{"aria-label":n?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>l(!n),icon:n?e(Rc,{}):e(Uc,{})})})]}),e(Tr,{children:(k=g.password)==null?void 0:k.message})]}),t&&s(hr,{status:"error",rounded:"md",children:[e(mr,{}),e(as,{children:t})]}),s(te,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(Nc,{marginRight:1}),c("login")]})]})})})]})})})},Mc=async()=>await we("/admin"),qr=()=>{const{data:t,isError:a,isLoading:r,isSuccess:o,error:n}=vr({queryFn:()=>Mc()});return{userData:t||{is_sudo:!1,telegram_id:"",username:"",users_usage:0},getUserIsPending:r,getUserIsSuccess:o,getUserIsError:a,getUserError:n}},Cr={baseStyle:{w:5,h:5}},Oc=V(el,Cr),Wc=V(Mi,Cr),Fc=V(tl,Cr),$n=V(rl,Cr),Hc=V(sl,Cr),Bc=V(nl,Cr),Vc=V(Pn,Cr),$c=V(al,Cr),Jc=V(Oi,Cr),Ga=({collapsed:t,inDrawer:a=!1})=>{const{t:r}=Ne(),o=ma(),{userData:n,getUserIsSuccess:l}=qr(),i=l&&n.is_sudo,u=[...[{title:r("header.hostSettings"),url:"/hosts",icon:Fc},{title:r("header.nodeSettings"),url:"/node-settings",icon:Hc},{title:r("header.integrationSettings","Master Settings"),url:"/integrations",icon:$n},{title:r("header.xraySettings"),url:"/xray-settings",icon:$n}]];i&&u.unshift({title:r("services.menu","Services"),url:"/services",icon:$c});const m=u.some(I=>o.pathname===I.url),[g,p]=d.exports.useState(m);d.exports.useEffect(()=>{m&&p(!0)},[m]);const D=[{title:r("dashboard"),url:"/",icon:Oc},{title:r("users"),url:"/users",icon:Wc}];return i&&(D.push({title:r("usage.menu","Usage"),url:"/usage",icon:Jc}),D.push({title:r("admins","Admins"),url:"/admins",icon:Bc}),D.push({title:r("header.settings"),icon:$n,subItems:u})),e(z,{w:a?"full":t?"16":"60",h:a?"100%":"100vh",maxH:a?"100%":"100vh",bg:"surface.light",borderRight:a?void 0:"1px",borderColor:a?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:a?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:a?"relative":"fixed",top:a?void 0:"0",left:a?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:s(X,{spacing:1,p:4,align:"stretch",children:[!t&&e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},px:2,mb:2,children:r("menu")}),D.map(I=>{const k=I.url,f=typeof k=="string"&&o.pathname===k||typeof k=="string"&&k!=="/"&&o.pathname.startsWith(k)||I.subItems&&I.subItems.some(N=>o.pathname===N.url),v=I.icon;return e(z,{children:I.subItems?s(_t,{children:[s(P,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:f?"primary.50":"transparent",color:f?"primary.600":"gray.700",_dark:{bg:f?"primary.900":"transparent",color:f?"primary.200":"gray.300"},_hover:{bg:f?"primary.50":"gray.50",_dark:{bg:f?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>p(!g),children:[s(P,{children:[e(v,{}),!t&&e(h,{fontSize:"sm",fontWeight:f?"semibold":"normal",children:I.title})]}),!t&&e(Vc,{transform:g?"rotate(180deg)":"rotate(0deg)"})]}),!t&&e(An,{in:g,animateOpacity:!0,children:e(X,{align:"stretch",pl:6,spacing:1,mt:2,children:I.subItems.map(N=>{const M=o.pathname===N.url,j=N.icon;return e(Oa,{to:N.url,children:s(P,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:M?"primary.50":"transparent",color:M?"primary.600":"gray.700",_dark:{bg:M?"primary.900":"transparent",color:M?"primary.200":"gray.300"},_hover:{bg:M?"primary.50":"gray.50",_dark:{bg:M?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(j,{}),e(h,{fontSize:"sm",fontWeight:M?"semibold":"normal",children:N.title})]})},N.url)})})})]}):I.url?e(Oa,{to:I.url,children:s(P,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:f?"primary.50":"transparent",color:f?"primary.600":"gray.700",_dark:{bg:f?"primary.900":"transparent",color:f?"primary.200":"gray.300"},_hover:{bg:f?"primary.50":"gray.50",_dark:{bg:f?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(v,{}),!t&&e(h,{fontSize:"sm",fontWeight:f?"semibold":"normal",children:I.title})]})}):null},I.title)})]})})},kn=il,Kc="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",oo={base:Kc,folder:"apple/64",ext:".png",className:"apple-emoji"},Jn=t=>{var a,r;return typeof t=="string"&&((r=(a=kn.test)==null?void 0:a.call(kn,t))!=null?r:!1)},Yc=t=>t.some(a=>{var r;return a.type==="characterData"?Jn((r=a.target)==null?void 0:r.data):a.type==="childList"?Array.from(a.addedNodes).some(o=>{if(o.nodeType===Node.TEXT_NODE)return Jn(o.textContent);if(o.nodeType===Node.ELEMENT_NODE){const n=o;return n.tagName==="IMG"&&n.classList.contains(oo.className)?!1:Jn(n.textContent)}return!1}):!1}),qc=()=>{const t=ma();d.exports.useEffect(()=>{const a=document.getElementById("root");if(!a)return;const r=()=>{kn.parse(a,oo)};r();const o=new MutationObserver(n=>{Yc(n)&&requestAnimationFrame(r)});return o.observe(a,{childList:!0,subtree:!0,characterData:!0}),()=>o.disconnect()},[t])},lo={baseStyle:{w:4,h:4}},Gc=V(ol,lo),Zc=V(Wi,lo);function Qc(){const[t,a]=d.exports.useState(!1),r=Xt({base:!0,md:!1}),o=Gt();return qc(),s(Nt,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(Ga,{collapsed:t}),s(Nt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[s(z,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(Ee,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?o.onOpen():a(!t)},icon:e(Zc,{})}),s(P,{spacing:2,children:[e(so,{}),e(io,{}),e(ll,{to:"/login",children:e(Ee,{size:"sm",variant:"outline","aria-label":"logout",icon:e(Gc,{})})})]})]}),e(z,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(cl,{})})]}),r&&s(ga,{isOpen:o.isOpen,placement:"left",onClose:o.onClose,size:"xs",children:[e(nt,{}),e(pa,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(at,{p:0,children:e(Ga,{collapsed:!1,inDrawer:!0})})})]})]})}const co="marzban-num-users-per-page",Za=10,Xc=()=>{const t=localStorage.getItem(co)||Za.toString();return parseInt(t)||Za},jc=t=>localStorage.setItem(co,t),ed=t=>{for(const a in t)t[a]||delete t[a];return tt.setState({loading:!0}),we("/users",{query:t}).then(a=>{var l,i;const r=(l=a.users_limit)!=null?l:null,o=(i=a.active_total)!=null?i:null,n=r!=null&&r>0&&o!==null?o>=r:!1;return tt.setState({users:a,isUserLimitReached:n}),a}).finally(()=>{tt.setState({loading:!1})})},Sa=()=>we("/inbounds").then(t=>{tt.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{tt.setState({loading:!1})}),tt=hs(dl((t,a)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:Xc(),sort:"-created_at"},inbounds:new Map,isEditingCore:!1,refetchUsers:()=>{ed(a().filters)},resetAllUsage:()=>we("/users/reset",{method:"POST"}).then(()=>{a().onResetAllUsage(!1),a().refetchUsers()}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...a().filters,...r}}),a().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),we(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),a().refetchUsers(),Sn.invalidateQueries(wn)})),createUser:r=>we("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),a().refetchUsers(),Sn.invalidateQueries(wn)}),createUserWithService:r=>we("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),a().refetchUsers(),Sn.invalidateQueries(wn)}),editUser:(r,o)=>we(`/v2/users/${r}`,{method:"PUT",body:o}).then(()=>{a().onEditingUser(null),a().refetchUsers()}),fetchUserUsage:(r,o)=>{for(const n in o)o[n]||delete o[n];return we(`/user/${r.username}/usage`,{method:"GET",query:o})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>we(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),a().refetchUsers()}),revokeSubscription:r=>we(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(o=>{t({revokeSubscriptionUser:null,editingUser:o}),a().refetchUsers()}),onEditingCore:r=>t({isEditingCore:r})})));function Fe(t,a=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const o=1024,n=a<0?0:a,l=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(t)/Math.log(o)),c=parseFloat((t/Math.pow(o,i)).toFixed(n));return r?[c,l[i]]:`${c} ${l[i]}`}const Qa=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},td=V(Mi,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),rd=V(ul,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Xa=({title:t,content:a,icon:r})=>s(pr,{p:6,borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[s(P,{alignItems:"center",columnGap:"4",children:[e(z,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:r}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(z,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:a})]}),wn="statistics-query-key",sd=t=>{var l;const{version:a}=tt(),{userData:r}=qr(),{data:o}=vr({queryKey:wn,queryFn:()=>we("/system"),refetchInterval:6e5,onSuccess:({version:i})=>{a!==i&&tt.setState({version:i})}}),{t:n}=Ne();return s(P,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(Xa,{title:n("activeUsers"),content:o&&s(P,{alignItems:"flex-end",children:[e(h,{children:Qa(o.users_active)}),s(h,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Qa(o.total_user)]})]}),icon:e(td,{})}),e(Xa,{title:n("UsersUsage"),content:Fe((l=r.users_usage)!=null?l:0),icon:e(rd,{})})]})},nd=()=>{const{t}=Ne();return e(X,{spacing:6,align:"stretch",children:s(z,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(sd,{})]})})},Vr=({children:t,color:a})=>e(z,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${a}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${a}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${a}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${a}.400`}},children:e(h,{color:`${a}.500`,_dark:{color:`${a}.900`},position:"relative",zIndex:"2",children:t})}),Gs=V(Pr,{baseStyle:{w:5,h:5}}),ad=()=>{const[t,a]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:o,deleteUser:n}=tt(),{t:l}=Ne(),i=Rt(),c=()=>{o(null)},u=()=>{r&&(a(!0),n(r).then(()=>{i({title:l("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(a.bind(null,!1)))};return s(Dt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(Vr,{color:"red",children:e(Gs,{})})}),e(xt,{mt:3}),s(at,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:l("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Nn,{components:{b:e("b",{})},children:l("deleteUser.prompt",{username:r.username})})})]}),s(kt,{display:"flex",children:[e(te,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:l("cancel")}),e(te,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(lt,{size:"xs"}):void 0,children:l("delete")})]})]})]})},id={search:"",limit:10,offset:0,sort:"username"},_r=hs((t,a)=>({admins:[],total:0,loading:!1,filters:id,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:o}=a(),n={...o,...r},l={};n.search&&(l.username=n.search),n.offset!==void 0&&(l.offset=n.offset),n.limit!==void 0&&(l.limit=n.limit),n.sort&&(n.sort==="data_usage"?l.sort="users_usage":n.sort==="data_limit"?l.sort="data_limit":l.sort=n.sort),t({loading:!0});try{const i=await we("/admins",{query:l}),{admins:c,total:u}=Array.isArray(i)?{admins:i,total:i.length}:{admins:i.admins||[],total:i.total||0};t(m=>{const g=m.adminInDetails?c.find(p=>{var D;return p.username===((D=m.adminInDetails)==null?void 0:D.username)})||m.adminInDetails:null;return{admins:c,total:u,adminInDetails:g}})}catch(i){console.error("Failed to fetch admins:",i),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(o=>({filters:{...o.filters,...r}}))},onFilterChange(r){t(o=>({filters:{...o.filters,...r}})),a().fetchAdmins()},async createAdmin(r){await we("/admin",{method:"POST",body:r}),await a().fetchAdmins()},async updateAdmin(r,o){await we(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:o}),await a().fetchAdmins()},async deleteAdmin(r){await we(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await a().fetchAdmins()},async resetUsage(r){await we(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await a().fetchAdmins()},async disableUsers(r){await we(`/admin/${encodeURIComponent(r)}/users/disable`,{method:"POST"})},async activateUsers(r){await we(`/admin/${encodeURIComponent(r)}/users/activate`,{method:"POST"})},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),Un={baseStyle:{w:4,h:4}},od=V(Fi,Un),ld=V(Ni,Un),uo=V(fr,Un),cd=V(Yr,Un),dd=hl((t,a)=>{a==="users"?tt.getState().onFilterChange({...tt.getState().filters,offset:0,search:t}):_r.getState().onFilterChange({search:t,offset:0})},300),ho=({for:t="users",...a})=>{var re;const{loading:r,filters:o,onFilterChange:n,refetchUsers:l,onCreateUser:i}=tt(),{loading:c,filters:u,onFilterChange:m,fetchAdmins:g,openAdminDialog:p}=_r(),{t:D}=Ne(),[I,k]=d.exports.useState(""),f=t==="users"?r:c,v=t==="users"?o:u,N=_=>{k(_.target.value),dd(_.target.value,t)},M=()=>{k(""),t==="users"?n({...v,offset:0,search:""}):m({search:"",offset:0})},j=()=>{t==="users"?l():g()},C=()=>{t==="users"?i(!0):p()},B=(re=Xt({base:!0,sm:!1}))!=null?re:!1;return s(fa,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...a,children:[e(Hr,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:s(P,{spacing:2,align:"center",w:"full",children:[s(jt,{flex:"1",children:[e(Hi,{pointerEvents:"none",children:e(od,{})}),e(de,{placeholder:t==="users"?D("search"):D("admins.searchPlaceholder","Search admins..."),value:I,borderColor:"light-border",w:"full",onChange:N}),s(nr,{children:[f&&e(lt,{size:"xs"}),v.search&&v.search.length>0&&e(Ee,{onClick:M,"aria-label":"clear",size:"xs",variant:"ghost",children:e(ld,{})})]})]}),e(Ee,{"aria-label":"refresh",disabled:f,onClick:j,size:B?"sm":"md",variant:B?"ghost":"outline",borderRadius:"full",minW:B?"36px":"40px",h:B?"36px":void 0,children:e(uo,{className:Tn({"animate-spin":f})})})]})}),e(Hr,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(De,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:e(te,{colorScheme:"primary",size:B?"sm":"md",onClick:C,px:B?3:5,leftIcon:B?void 0:e(cd,{}),w:"auto",h:B?"36px":void 0,minW:B?"auto":"8.5rem",fontSize:B?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?D("createUser"):D("admins.addAdmin","Add admin")})})})]})},ud=V(ml,{baseStyle:{w:4,h:4}}),hd=V(gl,{baseStyle:{w:4,h:4}}),ja=5;function md(t,a,r){if(r<ja)throw new Error(`Must allow at least ${ja} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const o=Math.max(0,Math.min(t-r,a-Math.floor(r/2))),n=new Array(r);for(let l=0;l<r;l+=1)n[l]=l+o;return typeof n[0]=="number"&&n[0]>0&&(n[0]=0,n[1]="prev-more"),n[n.length-1]<t-1&&(n[n.length-1]=t-1,n[n.length-2]="next-more"),n}const mo=({for:t="users"})=>{const{filters:a,onFilterChange:r,users:{total:o}}=tt(),{filters:n,onFilterChange:l,total:i}=_r(),{t:c}=Ne(),{filters:u,total:m,onFilterChange:g}=d.exports.useMemo(()=>t==="admins"?{filters:n,total:i,onFilterChange:l}:{filters:a,total:o,onFilterChange:r},[t,n,i,l,a,o,r]),{limit:p,offset:D}=u,I=Number(p||10),k=Number(D||0),f=Math.floor(k/I),v=Math.ceil(m/I),N=md(v,f,7),M=re=>{g({...u,offset:re*I})},j=re=>{const _=parseInt(re.target.value,10);g({...u,limit:_,offset:0}),t==="users"&&jc(re.target.value)},C=d.exports.useMemo(()=>f>0&&v>0,[f,v]),B=d.exports.useMemo(()=>f+1<v&&v>0,[f,v]);return m<=I&&f===0?null:s(P,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(z,{order:{base:2,md:1},children:s(P,{children:[s(Ge,{minW:"60px",value:String(I),onChange:j,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),s(Bi,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(te,{leftIcon:e(ud,{}),onClick:()=>M(f-1),isDisabled:!C,children:c("previous")}),N.map(re=>typeof re=="string"?e(te,{children:"..."},re):e(te,{variant:re===f?"solid":"outline",onClick:()=>M(re),children:re+1},re)),e(te,{rightIcon:e(hd,{}),onClick:()=>M(f+1),isDisabled:!B,children:c("next")})]})]})},gd=pl;const ei=V(fl),pd=V(Vi,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),fd=V(bl,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),bd=V($i,{baseStyle:{w:5,h:5}}),yd=()=>{const{QRcodeLinks:t,setQRCode:a,setSubLink:r,subscribeUrl:o}=tt(),n=t!==null,[l,i]=d.exports.useState(0),{t:c}=Ne(),u=()=>{a(null),r(null)},m=String(o).startsWith("/")?window.location.origin+o:String(o);return s(Dt,{isOpen:n,onClose:u,children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(ct,{pt:6,children:e(Vr,{color:"primary",children:e(bd,{color:"white"})})}),e(xt,{mt:3}),t&&s(at,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[o&&s(X,{children:[e(ei,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),s(z,{w:"300px",children:[e(gd,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:i,onInit:()=>i(0),nextArrow:e(Ee,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(pd,{})}),prevArrow:e(Ee,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(fd,{})}),children:t.map((g,p)=>e(P,{children:e(ei,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:g,bg:"white"})},p))}),s(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[l+1," / ",t.length]})]})]})]})]})},Sd=V(fr,{baseStyle:{w:5,h:5}}),xd=()=>{const[t,a]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:o}=tt(),{t:n}=Ne(),l=Rt(),i=()=>{tt.setState({resetUsageUser:null})},c=()=>{r&&(a(!0),o(r).then(()=>{l({title:n("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:n("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{a(!1)}))};return s(Dt,{isCentered:!0,isOpen:!!r,onClose:i,size:"sm",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(Vr,{color:"blue",children:e(Sd,{})})}),e(xt,{mt:3}),s(at,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:n("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Nn,{components:{b:e("b",{})},children:n("resetUserUsage.prompt",{username:r.username})})})]}),s(kt,{display:"flex",children:[e(te,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:n("cancel")}),e(te,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(lt,{size:"xs"}):void 0,children:n("reset")})]})]})]})},kd=V(fr,{baseStyle:{w:5,h:5}}),wd=()=>{const[t,a]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:o}=tt(),{t:n}=Ne(),l=Rt(),i=()=>{tt.setState({revokeSubscriptionUser:null})},c=()=>{r&&(a(!0),o(r).then(()=>{l({title:n("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{l({title:n("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{a(!1)}))};return s(Dt,{isCentered:!0,isOpen:!!r,onClose:i,size:"sm",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(Vr,{color:"blue",children:e(kd,{})})}),e(xt,{mt:3}),s(at,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:n("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Nn,{components:{b:e("b",{})},children:n("revokeUserSub.prompt",{username:r.username})})})]}),s(kt,{display:"flex",children:[e(te,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:n("cancel")}),e(te,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(lt,{size:"xs"}):void 0,children:n("revoke")})]})]})]})},Zs={baseStyle:{strokeWidth:"2px",w:4,h:4}},ti=V(yl,Zs),vd=V(Sl,Zs),ri=V(xl,Zs),si=V(Ji,Zs),Cd=V(Ji,Zs),ia=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],Br={active:{statusColor:"green",bandWidthColor:"primary",icon:ti},connected:{statusColor:"green",bandWidthColor:"primary",icon:ti},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:vd},expired:{statusColor:"orange",bandWidthColor:"orange",icon:si},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Cd},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:si},limited:{statusColor:"red",bandWidthColor:"red",icon:ri},error:{statusColor:"red",bandWidthColor:"red",icon:ri}},ss=hs((t,a)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const o=await we("/v2/services",{query:r});t({services:o.services,total:o.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const o=await we(`/v2/services/${r}`);return t({serviceDetail:o}),o}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const o=await we("/v2/services",{method:"POST",body:r});return t({serviceDetail:o}),await a().fetchServices(),o}finally{t({isSaving:!1})}},async updateService(r,o){t({isSaving:!0});try{const n=await we(`/v2/services/${r}`,{method:"PUT",body:o});return t({serviceDetail:n}),await a().fetchServices(),n}finally{t({isSaving:!1})}},async deleteService(r){t({isSaving:!0});try{await we(`/v2/services/${r}`,{method:"DELETE"}),t({serviceDetail:null}),await a().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const o=await we(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:o}),await a().fetchServices(),o}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),os=kl,Rn=t=>{let a={status:"",time:""};if(t){Te(t*1e3).utc().isAfter(Te().utc())?a.status="expires":a.status="expired";const r=[],o=Te.duration(Te(t*1e3).utc().diff(Te()));o.years()!=0&&r.push(Math.abs(o.years())+" year"+(Math.abs(o.years())!=1?"s":"")),o.months()!=0&&r.push(Math.abs(o.months())+" month"+(Math.abs(o.months())!=1?"s":"")),o.days()!=0&&r.push(Math.abs(o.days())+" day"+(Math.abs(o.days())!=1?"s":"")),r.length===0&&(o.hours()!=0&&r.push(Math.abs(o.hours())+" hour"+(Math.abs(o.hours())!=1?"s":"")),o.minutes()!=0&&r.push(Math.abs(o.minutes())+" min"+(Math.abs(o.minutes())!=1?"s":""))),a.time=r.join(", ")}return a};function _d(t){const a=360/t,r=90,o=47,n=[];for(let l=0;l<t;l++){const i=l*a%360+140,c=Dd(i,r,o);n.push(c)}return n}function Dd(t,a,r){t/=360,a/=100,r/=100;let o,n,l;if(a===0)o=n=l=r;else{const c=(g,p,D)=>(D<0&&(D+=1),D>1&&(D-=1),D<.16666666666666666?g+(p-g)*6*D:D<.5?p:D<.6666666666666666?g+(p-g)*(.6666666666666666-D)*6:g),u=r<.5?r*(1+a):r+a-r*a,m=2*r-u;o=Math.round(c(m,u,t+1/3)*255),n=Math.round(c(m,u,t)*255),l=Math.round(c(m,u,t-1/3)*255)}const i=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${i(o)}${i(n)}${i(l)}`}const ni=({border:t,...a})=>{const{getInputProps:r,getRadioProps:o}=Cl(a),n=Xt({base:"xs",md:"sm"});return s(z,{as:"label",children:[e("input",{...r()}),e(z,{...o(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:n,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:a.children})]})},Ad=({onChange:t,defaultValue:a,...r})=>{const{t:o,i18n:n}=Ne();Ur();const l=Xt({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),i={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=Xt({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:m,setValue:g}=wl({name:"filter",defaultValue:a,onChange:le=>{if(le==="custom")return;I(),l.indexOf(le)>=0?(v(o("userDialog.custom")),M(!1)):(v(o("userDialog.custom")+` (${le})`),M(!0));const ge=Number(le.substring(0,le.length-1)),G=i[le[le.length-1]];t(le,{start:Te().utc().subtract(ge,G).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:p,onOpen:D,onClose:I}=Gt(),k=d.exports.useRef(null);vl({ref:k,handler:I});const[f,v]=d.exports.useState(o("userDialog.custom")),[N,M]=d.exports.useState(!1),[j,C]=d.exports.useState(0),B=Xt({base:1,md:2}),re=Xt({base:"xs",md:"sm"}),[_,K]=d.exports.useState(null),[pe,be]=d.exports.useState(null),Ie=le=>{const[ge,G]=le;pe&&!G?(K(null),be(null)):(K(ge),be(G),ge&&G&&(I(),t("custom",{start:Te(ge).format("YYYY-MM-DDT00:00:00"),end:Te(G).format("YYYY-MM-DDT23:59:59")})))};return s(X,{...r,children:[j==0&&s(ot,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[l.map(le=>e(ni,{...m({value:le}),children:le},le)),e(z,{onClick:()=>{K(null),be(null),D()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:re,px:3,py:1,bg:N?"primary.500":"unset",color:N?"white":"unset",borderColor:N?"primary.500":"unset",children:s(P,{children:[e(h,{children:f}),e(Mn,{as:Wa,boxSize:"18px"})]})})]}),j==1&&s(P,{onClick:D,cursor:"pointer",fontSize:re,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:_?"unset":"gray.500",children:_?Te(_).format("YYYY-MM-DD (00:00)"):o("userDialog.startDate")}),e(Mn,{as:Vi,boxSize:"18px"}),e(h,{w:"full",color:pe?"unset":"gray.500",children:pe?Te(pe).format("YYYY-MM-DD (23:59)"):o("userDialog.endDate")}),e(Mn,{as:Wa,boxSize:"18px"})]}),e(X,{ref:k,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:p?"unset":"none",children:s(Ws,{onChange:le=>C(le),children:[s(Fs,{children:[e(Ht,{fontSize:re,children:o("userDialog.relative")}),e(Ht,{fontSize:re,children:o("userDialog.absolute")})]}),s(Hs,{children:[e(Bt,{children:c.map(le=>e(X,{alignItems:"start",pl:2,pr:2,children:s(P,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:re,minW:"60px",children:o("userDialog."+le.title)}),le.options.map(ge=>e(ni,{border:!0,...m({value:ge}),children:ge},ge+".custom"))]})},le.title))}),e(Bt,{className:"datepicker-panel",children:e(X,{children:e(os,{locale:n.language.toLocaleLowerCase(),selected:_,onChange:Ie,startDate:_,endDate:pe,selectsRange:!0,maxDate:new Date,monthsShown:B,peekNextMonth:!1,inline:!0})})})]})]})})]})};function En(t,a,r=[],o=[]){const n=Fe(r.reduce((l,i)=>l+=i,0));return{series:r,options:{labels:o,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${a}${n}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(l,{seriesIndex:i,w:c})=>Fe(c.config.series[i],1)},tooltip:{custom:({series:l,seriesIndex:i,dataPointIndex:c,w:u})=>{const m=Fe(l[i],1),g=Math.max(l.reduce((D,I)=>D+=I),1),p=Math.round(l[i]/g*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[i]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[i]}: <b>${p}, ${m}</b>
            </div>
          `}},colors:_d(r.length)}}}const Kn="user-dialog-datepicker-portal",Id=V(_l,{baseStyle:{w:5,h:5}}),Ed=V(ms,{baseStyle:{w:5,h:5}}),Td=V(Oi,{baseStyle:{w:5,h:5}}),zd=V(Dl,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}}),Ld=t=>{var r,o,n,l,i;const a=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(o=t.service_id)!=null?o:null,next_plan_enabled:Boolean(a),next_plan_data_limit:a!=null&&a.data_limit?Number((a.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(n=a==null?void 0:a.expire)!=null?n:null,next_plan_add_remaining_traffic:(l=a==null?void 0:a.add_remaining_traffic)!=null?l:!1,next_plan_fire_on_either:(i=a==null?void 0:a.fire_on_either)!=null?i:!0}},ai=()=>({data_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),ys={username:Se.string().min(1,{message:"Required"}),note:Se.string().nullable(),service_id:Se.union([Se.string(),Se.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const a=Number(t);return Number.isNaN(a)?null:a}),proxies:Se.record(Se.string(),Se.record(Se.string(),Se.any())).transform(t=>{const a=(r,o)=>{r&&r[o]===""&&delete r[o]};return a(t.vmess,"id"),a(t.vless,"id"),a(t.trojan,"password"),a(t.shadowsocks,"password"),a(t.shadowsocks,"method"),t}),data_limit:Se.string().min(0).or(Se.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:Se.number().nullable(),data_limit_reset_strategy:Se.string(),inbounds:Se.record(Se.string(),Se.array(Se.string())).transform(t=>(Object.keys(t).forEach(a=>{var r;Array.isArray(t[a])&&!((r=t[a])!=null&&r.length)&&delete t[a]}),t)),next_plan_enabled:Se.boolean().default(!1),next_plan_data_limit:Se.union([Se.string(),Se.number(),Se.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const a=Number(t);return Number.isNaN(a)?null:Math.max(0,a)}),next_plan_expire:Se.union([Se.number(),Se.string(),Se.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const a=Number(t);return Number.isNaN(a)?null:a}),next_plan_add_remaining_traffic:Se.boolean().default(!1),next_plan_fire_on_either:Se.boolean().default(!0)},Pd=Se.discriminatedUnion("status",[Se.object({status:Se.literal("active"),...ys}),Se.object({status:Se.literal("disabled"),...ys}),Se.object({status:Se.literal("limited"),...ys}),Se.object({status:Se.literal("expired"),...ys}),Se.object({status:Se.literal("on_hold"),on_hold_expire_duration:Se.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...ys})]),Nd=()=>{var ae,fe,Ue,Ke,rt,bt,Tt;const{editingUser:t,isCreatingNewUser:a,onCreateUser:r,editUser:o,fetchUserUsage:n,onEditingUser:l,createUserWithService:i,onDeletingUser:c,users:u,isUserLimitReached:m}=tt(),g=!!t,p=a||g,D=(ae=u.users_limit)!=null?ae:null,I=(fe=u.active_total)!=null?fe:null,k=m&&!g,[f,v]=d.exports.useState(!1),[N,M]=d.exports.useState(""),j=Rt(),{t:C,i18n:B}=Ne(),{colorMode:re}=Ur(),_=ss(W=>W.services),K=ss(W=>W.isLoading),{userData:pe,getUserIsSuccess:be}=qr(),Ie=Boolean(be&&pe.is_sudo),[le,ge]=d.exports.useState(null),G=_.length>0,Q=le&&(Ue=_.find(W=>W.id===le))!=null?Ue:null,w=Boolean(t==null?void 0:t.service_id),[me,xe]=d.exports.useState(!1),$=()=>{xe(W=>!W)},y=or({defaultValues:ai(),resolver:Ln(Pd)});d.exports.useEffect(()=>{p&&ss.getState().fetchServices()},[p]),d.exports.useEffect(()=>{var W,ke;g?t!=null&&t.service_id?ge(t.service_id):Ie?ge(null):_.length?ge((ke=(W=_[0])==null?void 0:W.id)!=null?ke:null):ge(null):p||ge(null)},[g,t,p,Ie,_]),d.exports.useEffect(()=>{!g&&p&&G&&ge(W=>{var ke,He;return(He=W!=null?W:(ke=_[0])==null?void 0:ke.id)!=null?He:null})},[_,g,p,G]),d.exports.useEffect(()=>{if(typeof document>"u")return;let W=document.getElementById(Kn);return W||(W=document.createElement("div"),W.setAttribute("id",Kn),document.body.appendChild(W)),()=>{W&&W.childElementCount===0&&W.remove()}},[]),d.exports.useEffect(()=>{!g&&p&&!G&&ge(null)},[G,g,p]);const[x,A]=Ir({control:y.control,name:["data_limit","status"]}),ie=Ir({control:y.control,name:"next_plan_enabled"}),O=Ir({control:y.control,name:"next_plan_data_limit"}),ue=Ir({control:y.control,name:"next_plan_expire"}),ve=Ir({control:y.control,name:"next_plan_add_remaining_traffic"}),ze=Ir({control:y.control,name:"next_plan_fire_on_either"}),Me=W=>{y.setValue("next_plan_enabled",W,{shouldDirty:!0}),W?(y.getValues("next_plan_data_limit")===null&&y.setValue("next_plan_data_limit",0,{shouldDirty:!1}),y.getValues("next_plan_add_remaining_traffic")===void 0&&y.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),y.getValues("next_plan_fire_on_either")===void 0&&y.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(y.setValue("next_plan_data_limit",null,{shouldDirty:!0}),y.setValue("next_plan_expire",null,{shouldDirty:!0}))},q=C("userDialog.total"),[ye,_e]=d.exports.useState(En(re,q)),[Be,Ve]=d.exports.useState("1m"),Ze=W=>{n(t,W).then(ke=>{const He=[],st=[];for(const yt in ke.usages)st.push(ke.usages[yt].used_traffic),He.push(ke.usages[yt].node_name);_e(En(re,q,st,He))})};d.exports.useEffect(()=>{t&&(y.reset(Ld(t)),Ze({start:Te().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}))},[t,g,p]);const dt=W=>{if(k)return;v(!0),M(null);const{service_id:ke,next_plan_enabled:He,next_plan_data_limit:st,next_plan_expire:yt,next_plan_add_remaining_traffic:zt,next_plan_fire_on_either:er,proxies:Jt,inbounds:Mt,status:Lt,data_limit:pt,data_limit_reset_strategy:Vt,on_hold_expire_duration:It,...tr}=W,U=He&&st&&st>0?Number((Number(st)*1073741824).toFixed(5)):0,ee=He?{data_limit:U,expire:yt!=null?yt:0,add_remaining_traffic:zt,fire_on_either:er}:null;if(!g){if(!le){M(C("userDialog.selectService","Please choose a service")),v(!1);return}const b={username:W.username,service_id:le,note:W.note,status:W.status==="active"||W.status==="disabled"||W.status==="on_hold"?W.status:"active",expire:W.expire,data_limit:W.data_limit,data_limit_reset_strategy:pt&&pt>0?Vt:"no_reset",on_hold_expire_duration:Lt==="on_hold"?It:null};ee&&(b.next_plan=ee),i(b).then(()=>{j({title:C("userDialog.userCreated",{username:W.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),oe()}).catch(S=>{var R,Ae,Re,Qe,Ce;(((R=S==null?void 0:S.response)==null?void 0:R.status)===409||((Ae=S==null?void 0:S.response)==null?void 0:Ae.status)===400)&&M((Qe=(Re=S==null?void 0:S.response)==null?void 0:Re._data)==null?void 0:Qe.detail),((Ce=S==null?void 0:S.response)==null?void 0:Ce.status)===422&&Object.keys(S.response._data.detail).forEach(We=>{M(S==null?void 0:S.response._data.detail[We]),y.setError(We,{type:"custom",message:S.response._data.detail[We]})})}).finally(()=>{v(!1)});return}const L={...tr,data_limit:pt,data_limit_reset_strategy:pt&&pt>0?Vt:"no_reset",status:Lt==="active"||Lt==="disabled"||Lt==="on_hold"?Lt:"active",on_hold_expire_duration:Lt==="on_hold"?It:null};ee?L.next_plan=ee:!He&&(t==null?void 0:t.next_plan)&&(L.next_plan=null),t!=null&&t.service_id||(Jt&&Object.keys(Jt).length>0&&(L.proxies=Jt),Mt&&Object.keys(Mt).length>0&&(L.inbounds=Mt)),typeof le<"u"&&(le===null?Ie&&(L.service_id=null):le!==(t==null?void 0:t.service_id)&&(L.service_id=le)),o(t.username,L).then(()=>{j({title:C("userDialog.userEdited",{username:W.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),oe()}).catch(b=>{var S,R,Ae,Re,Qe;(((S=b==null?void 0:b.response)==null?void 0:S.status)===409||((R=b==null?void 0:b.response)==null?void 0:R.status)===400)&&M((Re=(Ae=b==null?void 0:b.response)==null?void 0:Ae._data)==null?void 0:Re.detail),((Qe=b==null?void 0:b.response)==null?void 0:Qe.status)===422&&Object.keys(b.response._data.detail).forEach(Ce=>{M(b==null?void 0:b.response._data.detail[Ce]),y.setError(Ce,{type:"custom",message:b.response._data.detail[Ce]})})}).finally(()=>{v(!1)})},oe=()=>{y.reset(ai()),r(!1),l(null),M(null),xe(!1),Ve("1m"),ge(null)},he=()=>{tt.setState({resetUsageUser:t})},Z=()=>{tt.setState({revokeSubscriptionUser:t})},ne=f||k,ht=A==="on_hold",[Je,J]=d.exports.useState(!1),E=()=>{J(!0);let W="";const ke="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",He=ke.length;let st=0;for(;st<6;)W+=ke.charAt(Math.floor(Math.random()*He)),st+=1;return W};return s(Dt,{isOpen:p,onClose:oe,size:"2xl",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Al,{...y,children:s(At,{mx:"3",position:"relative",overflow:"hidden",children:[e(xt,{mt:3,disabled:f}),e(z,{pointerEvents:k?"none":"auto",filter:k?"blur(6px)":"none",transition:"filter 0.2s ease",children:s("form",{onSubmit:y.handleSubmit(dt),children:[e(ct,{pt:6,children:s(P,{gap:2,children:[e(Vr,{color:"primary",children:g?e(Ed,{color:"white"}):e(Id,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:C(g?"userDialog.editUserTitle":"createNewUser")})]})}),s(at,{children:[g&&w&&s(hr,{status:"info",mb:4,borderRadius:"md",children:[e(mr,{}),C("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(Ke=t==null?void 0:t.service_name)!=null?Ke:""})]}),s(fa,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:3,children:[e(Hr,{children:s(X,{justifyContent:"space-between",children:[s(Nt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[s(Nt,{flexDirection:"row",w:"full",gap:2,children:[s(F,{mb:"10px",children:[e(H,{children:s(Nt,{gap:2,alignItems:"center",children:[C("username"),!g&&e(uo,{cursor:"pointer",className:Tn({"animate-spin":Je}),onClick:()=>{const W=E();y.setValue("username",W),setTimeout(()=>{J(!1)},350)}})]})}),s(P,{children:[e(Ut,{size:"sm",type:"text",borderRadius:"6px",error:(rt=y.formState.errors.username)==null?void 0:rt.message,disabled:ne||g,...y.register("username")}),g&&e(P,{px:1,children:e(vt,{name:"status",control:y.control,render:({field:W})=>e(et,{placement:"top",label:"status: "+C(`status.${W.value}`),textTransform:"capitalize",children:e(z,{children:e(Ct,{colorScheme:"primary",isChecked:W.value==="active",onChange:ke=>{ke.target.checked?W.onChange("active"):W.onChange("disabled")}})})})})})]})]}),!g&&s(F,{flex:"1",children:[e(H,{whiteSpace:"nowrap",children:C("userDialog.onHold")}),e(vt,{name:"status",control:y.control,render:({field:W})=>{const ke=W.value;return e(_t,{children:ke?e(Ct,{colorScheme:"primary",isChecked:ke==="on_hold",onChange:He=>{He.target.checked?W.onChange("on_hold"):W.onChange("active")}}):""})}})]})]}),s(F,{mb:"10px",children:[e(H,{children:C("userDialog.dataLimit")}),e(vt,{control:y.control,name:"data_limit",render:({field:W})=>{var ke;return e(Ut,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:W.onChange,disabled:ne,error:(ke=y.formState.errors.data_limit)==null?void 0:ke.message,value:W.value?String(W.value):""})}})]}),e(An,{in:!!(x&&x>0),animateOpacity:!0,style:{width:"100%"},children:s(F,{height:"66px",children:[e(H,{children:C("userDialog.periodicUsageReset")}),e(vt,{control:y.control,name:"data_limit_reset_strategy",render:({field:W})=>e(Ge,{size:"sm",...W,disabled:ne,bg:ne?"gray.100":"transparent",_dark:{bg:ne?"gray.600":"transparent"},sx:{option:{backgroundColor:re==="dark"?"#222C3B":"white"}},children:ia.map(ke=>e("option",{value:ke.value,children:C("userDialog.resetStrategy"+ke.title)},ke.value))})})]})}),s(z,{mb:"10px",children:[s(P,{justify:"space-between",align:"center",children:[e(H,{mb:0,children:C("userDialog.nextPlanTitle","Next plan")}),e(Ct,{colorScheme:"primary",isChecked:ie,onChange:W=>Me(W.target.checked),isDisabled:ne})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:C("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(An,{in:ie,animateOpacity:!0,style:{width:"100%"},children:s(X,{align:"stretch",spacing:3,mt:3,children:[s(F,{children:[e(H,{fontSize:"sm",children:C("userDialog.nextPlanDataLimit","Next plan data limit")}),e(Ut,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",disabled:ne,value:O!==null&&typeof O<"u"?String(O):"",onChange:W=>{const ke=W.target.value;if(!ke){y.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const He=Number(ke);Number.isNaN(He)||y.setValue("next_plan_data_limit",Math.max(0,He),{shouldDirty:!0})}})]}),s(F,{children:[e(H,{fontSize:"sm",children:C("userDialog.nextPlanExpire","Next plan expiry")}),e(os,{locale:B.language.toLocaleLowerCase(),dateFormat:C("dateFormat"),minDate:new Date,selected:ue&&ue>0?Te(ue*1e3).utc().toDate():void 0,onChange:W=>{if(!W){y.setValue("next_plan_expire",null,{shouldDirty:!0});return}const ke=Te(W).set("hour",23).set("minute",59).set("second",59).utc().valueOf();y.setValue("next_plan_expire",Math.floor(ke/1e3),{shouldDirty:!0})},customInput:e(Ut,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:ne}),calendarClassName:"usage-range-datepicker",popperClassName:"usage-range-datepicker-popper",popperPlacement:"bottom-end",portalId:Kn,popperModifiers:[{name:"offset",options:{offset:[0,8]}},{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","top-start"]}}]})]}),s(P,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:C("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(Ct,{size:"sm",colorScheme:"primary",isChecked:Boolean(ve),onChange:W=>y.setValue("next_plan_add_remaining_traffic",W.target.checked,{shouldDirty:!0}),isDisabled:ne})]}),s(P,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:C("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(Ct,{size:"sm",colorScheme:"primary",isChecked:Boolean(ze),onChange:W=>y.setValue("next_plan_fire_on_either",W.target.checked,{shouldDirty:!0}),isDisabled:ne})]})]})})]}),s(F,{mb:"10px",children:[e(H,{children:C(ht?"userDialog.onHoldExpireDuration":"userDialog.expiryDate")}),ht&&e(vt,{control:y.control,name:"on_hold_expire_duration",render:({field:W})=>{var ke;return e(Ut,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:He=>{y.setValue("expire",null),W.onChange({target:{value:He}})},disabled:ne,error:(ke=y.formState.errors.on_hold_expire_duration)==null?void 0:ke.message,value:W.value?String(W.value):""})}}),!ht&&e(vt,{name:"expire",control:y.control,render:({field:W})=>{var yt;function ke(zt){return Te(Te(zt*1e3).utc()).toDate()}const{status:He,time:st}=Rn(W.value);return s(_t,{children:[e(os,{locale:B.language.toLocaleLowerCase(),dateFormat:C("dateFormat"),minDate:new Date,selected:W.value?ke(W.value):void 0,onChange:zt=>{y.setValue("on_hold_expire_duration",null),W.onChange({target:{value:zt?Te(Te(zt).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0,name:"expire"}})},customInput:e(Ut,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:ne,error:(yt=y.formState.errors.expire)==null?void 0:yt.message})}),W.value?e(yr,{children:C(He,{time:st})}):""]})}})]}),s(F,{mb:"10px",isInvalid:!!y.formState.errors.note,children:[e(H,{children:C("userDialog.note")}),e(zn,{...y.register("note")}),e(Tr,{children:(Tt=(bt=y.formState.errors)==null?void 0:bt.note)==null?void 0:Tt.message})]})]}),N&&s(hr,{status:"error",display:{base:"none",md:"flex"},children:[e(mr,{}),N]})]})}),e(Hr,{children:s(F,{isRequired:!g,children:[e(H,{children:C("userDialog.selectServiceLabel","Service")}),K?s(P,{spacing:2,py:4,children:[e(lt,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:C("loading")})]}):G?s(X,{align:"stretch",spacing:3,children:[g&&Ie&&s(z,{role:"button",tabIndex:ne?-1:0,"aria-pressed":le===null,onKeyDown:W=>{ne||(W.key==="Enter"||W.key===" ")&&(W.preventDefault(),ge(null))},onClick:()=>{ne||ge(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:le===null?"primary.500":"gray.200",bg:le===null?"primary.50":"transparent",cursor:ne?"not-allowed":"pointer",pointerEvents:ne?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:ne?{}:{borderColor:le===null?"primary.500":"gray.300"},_dark:{borderColor:le===null?"primary.400":"gray.700",bg:le===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:C("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:C("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),_.map(W=>{const ke=le===W.id;return e(z,{role:"button",tabIndex:ne?-1:0,"aria-pressed":ke,onKeyDown:He=>{ne||(He.key==="Enter"||He.key===" ")&&(He.preventDefault(),ge(W.id))},onClick:()=>{ne||ge(W.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:ke?"primary.500":"gray.200",bg:ke?"primary.50":"transparent",cursor:ne?"not-allowed":"pointer",pointerEvents:ne?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:ne?{}:{borderColor:ke?"primary.500":"gray.300"},_dark:{borderColor:ke?"primary.400":"gray.700",bg:ke?"primary.900":"transparent"},children:s(P,{justify:"space-between",align:"flex-start",children:[s(X,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:W.name}),W.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:W.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:C("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:W.host_count,users:W.user_count})})]})},W.id)})]}):s(hr,{status:"warning",borderRadius:"md",children:[e(mr,{}),C("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),Q&&e(yr,{mt:2,children:C("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:Q.host_count,users:Q.user_count})})]})}),g&&me&&e(Hr,{pt:6,colSpan:{base:1,md:2},children:s(X,{gap:4,children:[e(Ad,{defaultValue:Be,onChange:(W,ke)=>{Ve(W),Ze(ke)}}),e(z,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(gr,{options:ye.options,series:ye.series,type:"donut"})})]})})]}),N&&s(hr,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(mr,{}),N]})]}),e(kt,{mt:"3",children:s(P,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(P,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:g&&s(_t,{children:[e(et,{label:C("delete"),placement:"top",children:e(Ee,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),oe()},children:e(Gs,{})})}),e(et,{label:C("userDialog.usage"),placement:"top",children:e(Ee,{"aria-label":"usage",size:"sm",onClick:$,children:e(Td,{})})}),e(te,{onClick:he,size:"sm",children:C("userDialog.resetUsage")}),e(te,{onClick:Z,size:"sm",children:C("userDialog.revokeSubscription")})]})}),e(P,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(te,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:f?e(lt,{size:"xs"}):void 0,disabled:ne,children:C(g?"userDialog.editUser":"createUser")})})]})})]})}),k&&s(Nt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(Vr,{color:"primary",children:e(zd,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:C("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:D&&D>0?C("userDialog.limitReachedBody",{limit:D,active:I!=null?I:D}):C("userDialog.limitReachedContent")})]})]})})]})},Ud=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Rd=t=>{if(!t)return null;const a=new Date(`${t}Z`);return Math.floor(a.getTime()/1e3)},ii=({lastOnline:t})=>{const a=Math.floor(Date.now()/1e3),r=Rd(t);return!t||r===null?e(z,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):a-r<=60?e(z,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(z,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Md=t=>{if(!t)return null;const a=new Date(t+"Z");return Math.floor(a.getTime()/1e3)},oi=({lastOnline:t})=>{const a=Math.floor(Date.now()/1e3),r=Md(t),o=r?a-r:null,n=r?Rn(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o&&o<=60?"Online":o?`${n.time} ago`:n.time})},Yn=({expiryDate:t,status:a,compact:r=!1,showDetail:o=!0,extraText:n})=>{const{t:l}=Ne(),i=Rn(t),c=Br[a].icon;return s(_t,{children:[s(Nr,{colorScheme:Br[a].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),o&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[a&&l(`status.${a}`),n&&`: ${n}`]})]}),o&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l(i.status,{time:i.time})})]})},Od=V(Ud),gs={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Wd=V(Ki,gs),Fd=V(Pn,gs),li=V(ua,gs),Hd=V(Il,gs),Bd=V($i,gs),Vd=V(ms,gs),$d=V(Pn,{baseStyle:{width:"15px",height:"15px"}}),Jd=t=>{for(var a=0;a<ia.length;a++){const r=ia[a];if(r.value==t)return r.title}return"No"},Kd=t=>{const{used:a,total:r,dataLimitResetStrategy:o,totalUsedTraffic:n}=t,l=r===0||r===null;return e(P,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:s(h,{children:[Fe(a)," /"," ",l?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Fe(r)]})})},ci=t=>{const{used:a,total:r,dataLimitResetStrategy:o,totalUsedTraffic:n,...l}=t,i=r===0||r===null,c=!i&&a/r*100>=100;return s(_t,{children:[e(El,{orientation:"horizontal",value:i?100:Math.min(a/r*100,100),colorScheme:c?"red":"primary",...l,children:e(Tl,{h:"6px",borderRadius:"full",children:e(zl,{borderRadius:"full"})})}),s(P,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[s(h,{children:[Fe(a)," /"," ",i?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Fe(r)+(o&&o!=="no_reset"?" "+Sr("userDialog.resetStrategy"+Jd(o)):"")]}),s(h,{children:[Sr("usersTable.total"),": ",Fe(n)]})]})]})},Ss=({sort:t,column:a})=>t.includes(a)?e($d,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,Yd=t=>{const{filters:a,users:{users:r,total:o},onEditingUser:n,onFilterChange:l}=tt(),{t:i}=Ne(),[c,u]=d.exports.useState(void 0),m=Xt({base:!1,md:!0}),g=r.length!==o,p=k=>{let f=a.sort;f.includes(k)?f.startsWith("-")?f="-created_at":f="-"+k:f=k,l({sort:f})},D=k=>{l({status:k.target.value.length>0?k.target.value:void 0})},I=k=>{u(k===c?void 0:k)};return s(z,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(Yi,{allowMultiple:!0,display:{base:"block",md:"none"},index:c,children:s(is,{orientation:"vertical",zIndex:"docked",...t,children:[e(br,{zIndex:"docked",position:"relative",children:s(gt,{children:[e(Pe,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:p.bind(null,"username"),children:s(P,{children:[e("span",{children:i("users")}),e(Ss,{sort:a.sort,column:"username"})]})}),e(Pe,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:s(P,{spacing:0,position:"relative",children:[s(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[i("usersTable.status"),a.status?": "+a.status:""]}),s(Ge,{value:a.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(_t,{}),_focusVisible:{border:"0 !important"},onChange:D,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Pe,{minW:"100px",cursor:"pointer",pr:0,onClick:p.bind(null,"used_traffic"),children:s(P,{children:[e("span",{children:i("usersTable.dataUsage")}),e(Ss,{sort:a.sort,column:"used_traffic"})]})}),e(Pe,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),e(dr,{children:!m&&(r==null?void 0:r.map((k,f)=>{var v;return s(d.exports.Fragment,{children:[s(gt,{onClick:I.bind(null,f),cursor:"pointer",children:[e(Le,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:s("div",{className:"flex-status",children:[e(ii,{lastOnline:k.online_at}),e(h,{isTruncated:!0,children:k.username})]})}),e(Le,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Yn,{compact:!0,showDetail:!1,expiryDate:k.expire,status:k.status})}),e(Le,{borderBottom:0,minW:"100px",pr:0,children:e(Kd,{totalUsedTraffic:k.lifetime_used_traffic,dataLimitResetStrategy:k.data_limit_reset_strategy,used:k.used_traffic,total:k.data_limit,colorScheme:Br[k.status].bandWidthColor})}),e(Le,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Fd,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:c===f?"rotate(180deg)":"0deg"})})]}),e(gt,{className:"collapsible",onClick:I.bind(null,f),children:e(Le,{p:0,colSpan:4,children:s(qi,{border:0,children:[e(Gi,{display:"none"}),e(Zi,{border:0,cursor:"pointer",px:6,py:3,children:s(X,{justifyContent:"space-between",spacing:"4",children:[s(X,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:i("usersTable.dataUsage")}),e(z,{width:"full",minW:"230px",children:e(ci,{totalUsedTraffic:k.lifetime_used_traffic,dataLimitResetStrategy:k.data_limit_reset_strategy,used:k.used_traffic,total:k.data_limit,colorScheme:Br[k.status].bandWidthColor})})]}),s(X,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:i("usersTable.service","Service")}),e(h,{fontSize:"sm",color:k.service_name?"gray.700":"gray.500",_dark:{color:k.service_name?"gray.200":"gray.500"},children:(v=k.service_name)!=null?v:i("usersTable.defaultService","Default")})]}),s(P,{w:"full",justifyContent:"space-between",children:[s(z,{width:"full",children:[e(Yn,{compact:!0,expiryDate:k.expire,status:k.status}),e(oi,{lastOnline:k.online_at})]}),s(P,{children:[e(di,{user:k}),e(et,{label:i("userDialog.editUser"),placement:"top",children:e(Ee,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:N=>{N.stopPropagation(),n(k)},children:e(Vd,{})})})]})]})]})})]})})})]},k.username)}))})]})}),s(is,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(br,{position:"relative",zIndex:"docked",children:s(gt,{children:[e(Pe,{minW:"140px",cursor:"pointer",onClick:p.bind(null,"username"),children:s(P,{children:[e("span",{children:i("username")}),e(Ss,{sort:a.sort,column:"username"})]})}),e(Pe,{width:"400px",minW:"150px",cursor:"pointer",children:s(P,{position:"relative",gap:"5px",children:[s(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[i("usersTable.status"),a.status?": "+a.status:""]}),e(h,{children:"/"}),e(Ss,{sort:a.sort,column:"expire"}),e(P,{onClick:p.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),s(Ge,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(_t,{}),_focusVisible:{border:"0 !important"},value:a.sort,onChange:D,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(Pe,{minW:"150px",children:e("span",{children:i("usersTable.service","Service")})}),e(Pe,{width:"350px",minW:"230px",cursor:"pointer",onClick:p.bind(null,"used_traffic"),children:s(P,{children:[e("span",{children:i("usersTable.dataUsage")}),e(Ss,{sort:a.sort,column:"used_traffic"})]})}),e(Pe,{width:"200px",minW:"180px"})]})}),s(dr,{children:[m&&(r==null?void 0:r.map((k,f)=>{var v;return s(gt,{className:Tn("interactive",{"last-row":f===r.length-1}),onClick:()=>n(k),children:[e(Le,{minW:"140px",children:s("div",{className:"flex-status",children:[e(ii,{lastOnline:k.online_at}),k.username,e(oi,{lastOnline:k.online_at})]})}),e(Le,{width:"400px",minW:"150px",children:e(Yn,{expiryDate:k.expire,status:k.status})}),e(Le,{minW:"150px",children:e(h,{fontSize:"sm",color:k.service_name?"gray.700":"gray.500",_dark:{color:k.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(v=k.service_name)!=null?v:i("usersTable.defaultService","Default")})}),e(Le,{width:"350px",minW:"230px",children:e(ci,{totalUsedTraffic:k.lifetime_used_traffic,dataLimitResetStrategy:k.data_limit_reset_strategy,used:k.used_traffic,total:k.data_limit,colorScheme:Br[k.status].bandWidthColor})}),e(Le,{width:"200px",minW:"180px",children:e(di,{user:k})})]},k.username)})),r.length==0&&e(gt,{children:e(Le,{colSpan:4,children:e(qd,{isFiltered:g})})})]})]})]})},di=({user:t})=>{const{setQRCode:a,setSubLink:r}=tt(),o=t.links.join(`\r
`),[n,l]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{n[1]&&setTimeout(()=>{l([-1,!1])},1e3)},[n]),s(P,{justifyContent:"flex-end",onClick:i=>{i.preventDefault(),i.stopPropagation()},children:[e(Fa,{text:t.subscription_url.startsWith("/")?window.location.origin+t.subscription_url:t.subscription_url,onCopy:()=>{l([0,!0])},children:e("div",{children:e(et,{label:n[0]==0&&n[1]?Sr("usersTable.copied"):Sr("usersTable.copyLink"),placement:"top",children:e(Ee,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:n[0]==0&&n[1]?e(li,{}):e(Hd,{})})})})}),e(Fa,{text:o,onCopy:()=>{l([1,!0])},children:e("div",{children:e(et,{label:n[0]==1&&n[1]?Sr("usersTable.copied"):Sr("usersTable.copyConfigs"),placement:"top",children:e(Ee,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:n[0]==1&&n[1]?e(li,{}):e(Wd,{})})})})}),e(et,{label:"QR Code",placement:"top",children:e(Ee,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{a(t.links),r(t.subscription_url)},children:e(Bd,{})})})]})},qd=({isFiltered:t})=>{const{onCreateUser:a}=tt();return s(z,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Od,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?Sr("usersTable.noUserMatched"):Sr("usersTable.noUser")}),!t&&e(te,{size:"sm",colorScheme:"primary",onClick:()=>a(!0),children:Sr("createUser")})]})},Gd=()=>{const{t}=Ne();return d.exports.useEffect(()=>{tt.getState().refetchUsers(),Sa()},[]),s(X,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(ho,{}),e(Yd,{}),e(mo,{}),e(Nd,{}),e(ad,{}),e(yd,{}),e(xd,{}),e(wd,{})]})},Wt=(t,a,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return a({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(o=>r.setError(o,{message:t.response._data.detail[o]}));return}}return a({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Pt=(t,a)=>a({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),Zd=()=>{var be,Ie,le,ge,G;const{t}=Ne(),a=Rt(),{adminInDialog:r,isAdminDialogOpen:o,closeAdminDialog:n,createAdmin:l,updateAdmin:i}=_r(),c=d.exports.useMemo(()=>r?"edit":"create",[r]),u=d.exports.useMemo(()=>Se.object({username:c==="create"?Se.string().trim().min(3,{message:t("admins.validation.usernameMin")}):Se.string().optional(),password:Se.string().trim().optional().transform(w=>w===""?void 0:w).refine(w=>!w||w.length>=6,t("admins.validation.passwordMin")),telegram_id:Se.string().trim().optional().transform(w=>w===""?void 0:w).refine(w=>w===void 0||/^\d+$/.test(w),t("admins.validation.telegramNumeric")),is_sudo:Se.boolean().optional(),data_limit:Se.string().trim().optional().transform(w=>w===""?void 0:w).refine(w=>w===void 0||/^\d+$/.test(w),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:Se.string().trim().optional().transform(w=>w===""?void 0:w).refine(w=>w===void 0||/^\d+$/.test(w),t("admins.validation.usersLimitNumeric","Users limit must be a number"))}).superRefine((w,me)=>{c==="create"&&!w.password&&me.addIssue({code:Se.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[c,t]),m=or({resolver:Ln(u),defaultValues:{username:"",password:"",telegram_id:"",is_sudo:!1,data_limit:"",users_limit:""}}),{register:g,handleSubmit:p,reset:D,formState:I,setValue:k,watch:f,setError:v}=m,N=g("is_sudo"),[M,j]=d.exports.useState(!1),C=d.exports.useCallback(Q=>{var xe;const w="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",me=w.length;if(typeof window<"u"&&((xe=window.crypto)==null?void 0:xe.getRandomValues)){const $=new Uint32Array(Q);return window.crypto.getRandomValues($),Array.from($,y=>w[y%me]).join("")}return Array.from({length:Q},()=>{const $=Math.floor(Math.random()*me);return w[$]}).join("")},[]),B=d.exports.useCallback(()=>{if(c==="edit")return;const Q=C(8);k("username",Q,{shouldDirty:!0,shouldValidate:!0})},[C,c,k]),re=d.exports.useCallback(()=>{const Q=C(12);k("password",Q,{shouldDirty:!0,shouldValidate:!0})},[C,k]),{errors:_,isSubmitting:K}=I;d.exports.useEffect(()=>{var Q,w;o&&D({username:(Q=r==null?void 0:r.username)!=null?Q:"",password:"",telegram_id:(r==null?void 0:r.telegram_id)!==void 0&&(r==null?void 0:r.telegram_id)!==null?String(r.telegram_id):"",is_sudo:(w=r==null?void 0:r.is_sudo)!=null?w:!1,data_limit:(r==null?void 0:r.data_limit)!==void 0&&(r==null?void 0:r.data_limit)!==null?String(Math.floor(r.data_limit/(1024*1024*1024))):"",users_limit:(r==null?void 0:r.users_limit)!==void 0&&(r==null?void 0:r.users_limit)!==null?String(r.users_limit):""})},[r,o,D]);const pe=p(async Q=>{var w,me,xe,$;if(c==="edit"&&r){const y=(w=r.active_users)!=null?w:0;if(Q.users_limit){const x=Number(Q.users_limit);if(!Number.isNaN(x)&&x>0&&x<y){v("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:y})});return}}}try{if(c==="create"){const y={username:Q.username.trim(),password:(me=Q.password)!=null?me:"",is_sudo:(xe=Q.is_sudo)!=null?xe:!1,telegram_id:Q.telegram_id?Number(Q.telegram_id):void 0,data_limit:Q.data_limit?Number(Q.data_limit)*1024*1024*1024:void 0,users_limit:Q.users_limit?Number(Q.users_limit):void 0};await l(y),Pt(t("admins.createSuccess","Admin created"),a)}else if(r){const y={is_sudo:($=Q.is_sudo)!=null?$:!1,telegram_id:Q.telegram_id?Number(Q.telegram_id):void 0,data_limit:Q.data_limit?Number(Q.data_limit)*1024*1024*1024:void 0,users_limit:Q.users_limit?Number(Q.users_limit):void 0};Q.password&&(y.password=Q.password),await i(r.username,y),Pt(t("admins.updateSuccess","Admin updated"),a)}n()}catch(y){Wt(y,a,m)}});return s(Dt,{isOpen:o,onClose:n,size:"lg",children:[e(nt,{}),s(At,{children:[e(ct,{children:c==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(xt,{}),e(at,{children:s(X,{spacing:4,align:"stretch",children:[s(F,{isInvalid:!!_.username,children:[e(H,{children:t("username")}),s(jt,{children:[e(de,{placeholder:t("admins.usernamePlaceholder","Admin username"),...g("username"),isDisabled:c==="edit"}),c==="create"&&e(nr,{children:e(Ee,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(sa,{width:20}),onClick:B})})]}),e(Tr,{children:(be=_.username)==null?void 0:be.message})]}),s(F,{isInvalid:!!_.password,children:[e(H,{children:t("password")}),s(P,{spacing:2,children:[s(jt,{children:[e(de,{placeholder:t("admins.passwordPlaceholder","Password"),type:M?"text":"password",...g("password")}),e(nr,{children:e(Ee,{"aria-label":M?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:M?e(ha,{width:16}):e(Ns,{width:16}),onClick:()=>j(!M)})})]}),e(Ee,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(sa,{width:20}),onClick:re})]}),e(Tr,{children:(Ie=_.password)==null?void 0:Ie.message}),c==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),e(F,{display:"flex",alignItems:"center",children:s(X,{align:"start",spacing:1,w:"full",children:[s(P,{justify:"space-between",w:"full",children:[e(H,{htmlFor:"is_sudo",mb:"0",children:t("admins.sudoAccess","Sudo access")}),e(Ct,{id:"is_sudo",isChecked:f("is_sudo"),onChange:Q=>k("is_sudo",Q.target.checked,{shouldDirty:!0}),onBlur:N.onBlur,ref:N.ref})]}),e(h,{fontSize:"xs",color:"gray.500",children:t("admins.sudoDescription","Sudo admins can manage other admins.")})]})}),s(F,{isInvalid:!!_.telegram_id,children:[e(H,{children:t("admins.telegramId","Telegram ID")}),e(de,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...g("telegram_id")}),e(Tr,{children:(le=_.telegram_id)==null?void 0:le.message})]}),s(F,{isInvalid:!!_.data_limit,children:[e(H,{children:t("admins.dataLimit","Data Limit (GB)")}),e(de,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...g("data_limit")}),e(Tr,{children:(ge=_.data_limit)==null?void 0:ge.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),s(F,{isInvalid:!!_.users_limit,children:[e(H,{children:t("admins.usersLimit","Users Limit")}),e(de,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...g("users_limit")}),e(Tr,{children:(G=_.users_limit)==null?void 0:G.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})}),e(kt,{children:s(P,{spacing:3,children:[e(te,{variant:"ghost",onClick:n,children:t("cancel")}),e(te,{colorScheme:"primary",onClick:pe,isLoading:K,children:c==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]})},Qd=()=>{var Q;const{t}=Ne(),a=Rt(),r=qe("gray.50","whiteAlpha.100"),o=qe("primary.50","primary.900"),{admins:n,loading:l,total:i,filters:c,onFilterChange:u,fetchAdmins:m,deleteAdmin:g,resetUsage:p,disableUsers:D,activateUsers:I,openAdminDialog:k,openAdminDetails:f,adminInDetails:v}=_r(),N=d.exports.useRef(null),{isOpen:M,onOpen:j,onClose:C}=Gt(),[B,re]=d.exports.useState(null),[_,K]=d.exports.useState(null),pe=w=>{if(w==="data_usage"||w==="data_limit"){const me=c.sort===w?`-${w}`:w;u({sort:me,offset:0})}else{const me=c.sort===w?`-${w}`:c.sort===`-${w}`?void 0:w;u({sort:me,offset:0})}},be=w=>{re(w),j()},Ie=async()=>{if(!!B)try{await g(B.username),Pt(t("admins.deleteSuccess","Admin removed"),a),C(),re(null)}catch(w){Wt(w,a)}},le=async(w,me)=>{K({type:w,username:me.username});try{w==="reset"?(await p(me.username),Pt(t("admins.resetUsageSuccess","Usage reset"),a)):w==="disable"?(await D(me.username),Pt(t("admins.disableUsersSuccess","Users disabled"),a)):w==="activate"&&(await I(me.username),Pt(t("admins.activateUsersSuccess","Users activated"),a)),m()}catch(xe){Wt(xe,a)}finally{K(null)}},ge=({column:w})=>{var $,y,x,A,ie;let me=!1,xe=!1;return w==="data"?(me=(($=c.sort)==null?void 0:$.includes("data_usage"))||((y=c.sort)==null?void 0:y.includes("data_limit")),xe=me&&((x=c.sort)==null?void 0:x.startsWith("-"))):(me=(A=c.sort)==null?void 0:A.includes(w),xe=me&&((ie=c.sort)==null?void 0:ie.startsWith("-"))),e(Pn,{style:{width:"1rem",height:"1rem",opacity:me?1:0,transform:me&&!xe?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},G=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return l&&!n.length?e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(lt,{})}):i?s(_t,{children:[e(z,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:s(is,{variant:"simple",size:"sm",minW:"640px",children:[e(br,{children:e(gt,{children:G.map(w=>e(Pe,{onClick:()=>w.key==="username"||w.key==="users_count"||w.key==="data"?pe(w.key):void 0,cursor:w.key==="username"||w.key==="users_count"||w.key==="data"?"pointer":"default",textAlign:w.key==="actions"?"right":"left",children:s(P,{justify:w.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:w.label}),w.key==="data"?s(vn,{children:[e(Cn,{as:Ee,size:"xs",variant:"ghost",icon:e(ge,{column:"data"})}),s(_n,{children:[e(Ft,{onClick:()=>pe("data_usage"),children:t("admins.sortByUsage")}),e(Ft,{onClick:()=>pe("data_limit"),children:t("admins.sortByLimit")})]})]}):w.key==="username"||w.key==="users_count"?e(ge,{column:w.key}):null]})},w.key))})}),e(dr,{children:n.map(w=>{var y,x;const me=(v==null?void 0:v.username)===w.username,xe=w.users_limit&&w.users_limit>0?String(w.users_limit):"\u221E",$=`${(y=w.active_users)!=null?y:0}/${xe}`;return s(gt,{onClick:()=>f(w),cursor:"pointer",bg:me?o:void 0,_hover:{bg:r},transition:"background-color 0.15s ease-in-out",children:[s(Le,{children:[e(h,{fontWeight:"medium",children:w.username}),w.is_sudo&&e(Nr,{colorScheme:"purple",fontSize:"xs",mt:1,children:t("sudo")})]}),e(Le,{children:s(h,{whiteSpace:"nowrap",children:[Fe((x=w.users_usage)!=null?x:0,2)," /"," ",w.data_limit?Fe(w.data_limit,2):"-"]})}),e(Le,{children:s(De,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:$})]})}),e(Le,{textAlign:"right",children:s(vn,{children:[e(Cn,{as:Ee,icon:e(Ll,{width:20}),variant:"ghost",onClick:A=>A.stopPropagation()}),s(_n,{onClick:A=>A.stopPropagation(),children:[e(Ft,{icon:e(ms,{width:20}),onClick:A=>{A.stopPropagation(),k(w)},children:t("edit")}),e(Ft,{icon:e(fr,{width:20}),onClick:A=>{A.stopPropagation(),le("reset",w)},isDisabled:(_==null?void 0:_.username)===w.username,children:t("admins.resetUsage")}),e(Dn,{}),e(Ft,{icon:e(Pl,{width:20}),onClick:A=>{A.stopPropagation(),le("activate",w)},isDisabled:(_==null?void 0:_.username)===w.username,children:t("admins.activateUsers")}),e(Ft,{icon:e(Nl,{width:20}),onClick:A=>{A.stopPropagation(),le("disable",w)},isDisabled:(_==null?void 0:_.username)===w.username,children:t("admins.disableUsers")}),e(Dn,{}),e(Ft,{color:"red.500",icon:e(Pr,{width:20}),onClick:A=>{A.stopPropagation(),be(w)},children:t("delete")})]})]})})]},w.username)})})]})}),e(Us,{isOpen:M,leastDestructiveRef:N,onClose:C,children:e(nt,{children:s(Rs,{children:[e(ct,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(at,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(Q=B==null?void 0:B.username)!=null?Q:""})}),s(kt,{children:[e(te,{ref:N,onClick:C,children:t("cancel")}),e(te,{colorScheme:"red",onClick:Ie,ml:3,children:t("delete")})]})]})})})]}):e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},Xd=(t,a)=>!t||t<=0?a!=null?a:"\u221E":`${t}`,qn=(t,a)=>!t||t<=0?a!=null?a:"\u221E":Fe(t,2),jd=()=>{var N,M,j,C,B,re,_,K,pe,be;const{t}=Ne(),{isAdminDetailsOpen:a,adminInDetails:r,closeAdminDetails:o}=_r(Ie=>({isAdminDetailsOpen:Ie.isAdminDetailsOpen,adminInDetails:Ie.adminInDetails,closeAdminDetails:Ie.closeAdminDetails})),n=qe("gray.50","whiteAlpha.50"),l=(N=r==null?void 0:r.active_users)!=null?N:0,i=(M=r==null?void 0:r.users_limit)!=null?M:null,c=t("admins.details.unlimited","Unlimited"),u=i&&i>0?String(i):c,m=(j=r==null?void 0:r.users_count)!=null?j:0,g=(C=r==null?void 0:r.limited_users)!=null?C:0,p=(B=r==null?void 0:r.expired_users)!=null?B:0,D=(re=r==null?void 0:r.online_users)!=null?re:0,I=(_=r==null?void 0:r.users_usage)!=null?_:0,k=(K=r==null?void 0:r.data_limit)!=null?K:null,f=k&&k>0?Math.max(k-I,0):null,v=(pe=r==null?void 0:r.lifetime_usage)!=null?pe:null;return s(ga,{isOpen:a,placement:"right",size:"md",onClose:o,children:[e(nt,{}),s(pa,{children:[e(xt,{}),e(ct,{bg:n,children:s(De,{spacing:1,children:[s(P,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(be=r==null?void 0:r.username)!=null?be:t("admins.details.title","Admin details")}),(r==null?void 0:r.is_sudo)&&e(z,{as:"span",fontSize:"xs",px:2,py:.5,borderRadius:"full",bg:"purple.500",color:"white",children:t("admins.sudoBadge","Sudo")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:l,limit:u})})]})}),e(at,{children:r?s(De,{spacing:8,children:[s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),s(ot,{columns:{base:2,md:3},spacing:4,children:[e(lr,{label:t("admins.details.activeLabel","Active"),value:String(l)}),e(lr,{label:t("admins.details.onlineLabel","Online"),value:String(D)}),e(lr,{label:t("admins.details.limitedLabel","Limited"),value:String(g)}),e(lr,{label:t("admins.details.expiredLabel","Expired"),value:String(p)}),e(lr,{label:t("admins.details.totalUsers","Total users"),value:String(m)}),e(lr,{label:t("admins.details.usersLimit","Users limit"),value:Xd(i,c)})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),s(ot,{columns:{base:2,md:4},spacing:4,children:[e(lr,{label:t("admins.details.used","Used"),value:Fe(I,2)}),e(lr,{label:t("admins.details.limit","Limit"),value:qn(k,c)}),e(lr,{label:t("admins.details.remaining","Remaining"),value:qn(f,c)}),e(lr,{label:t("admins.details.lifetime","Lifetime usage"),value:qn(v,void 0)})]})]})]}):e(z,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(kt,{children:e(te,{variant:"outline",mr:3,onClick:o,children:t("close","Close")})})]})]})},lr=({label:t,value:a})=>s(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:a})]}),eu=()=>{const{t}=Ne(),a=_r(l=>l.fetchAdmins),{userData:r,getUserIsSuccess:o}=qr(),n=o&&r.is_sudo;return d.exports.useEffect(()=>{n&&a()},[a,n]),n?s(X,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(ho,{for:"admins"}),e(Qd,{}),e(mo,{for:"admins"}),e(Zd,{}),e(jd,{})]}):s(X,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},go=hs(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),we("/hosts").then(a=>t({hosts:a})).finally(()=>t({isLoading:!1}))},setHosts:a=>(t({isPostLoading:!0}),we("/hosts",{method:"PUT",body:a}).finally(()=>{t({isPostLoading:!1})}))})),tu=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],ru=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],su=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],nu=V(ms,{baseStyle:{w:4,h:4}}),po=V(Yr,{baseStyle:{w:4,h:4}}),fo=V(Wi,{baseStyle:{w:4,h:4}}),au=V(Bs,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),iu=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],ns=()=>{const{t}=Ne();return s(Vs,{isLazy:!0,placement:"right",children:[e($s,{children:e(z,{mt:"-1",children:e(au,{})})}),e(Rl,{children:s(Js,{maxW:"xs",fontSize:"xs",children:[e(Ks,{}),e(Xi,{}),e(Ys,{children:s(z,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),iu.map(({token:a,labelKey:r})=>s(h,{mt:1,children:[e(Nr,{mr:2,children:a}),t(r)]},a))]})})]})})]})},bo=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,sr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,ur=t=>(t!=null?t:"").trim(),xs=(t,a=!1)=>typeof t=="boolean"?t:a,ou=(t,a)=>{var r,o,n,l,i,c,u,m;return{id:(r=t.id)!=null?r:null,remark:(o=t.remark)!=null?o:"",address:(n=t.address)!=null?n:"",sort:(l=t.sort)!=null?l:a,port:(i=t.port)!=null?i:null,path:ur(t.path),sni:ur(t.sni),host:ur(t.host),mux_enable:xs(t.mux_enable),allowinsecure:xs(t.allowinsecure),is_disabled:xs(t.is_disabled,!1),fragment_setting:ur(t.fragment_setting),noise_setting:ur(t.noise_setting),random_user_agent:xs(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(m=t.fingerprint)!=null?m:"",use_sni_as_host:xs(t.use_sni_as_host)}},oa=t=>{var a,r;return{id:(a=t.id)!=null?a:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},ui=t=>{var a,r;return{...t,id:(a=t.id)!=null?a:null,port:(r=t.port)!=null?r:null,path:ur(t.path),sni:ur(t.sni),host:ur(t.host),fragment_setting:ur(t.fragment_setting),noise_setting:ur(t.noise_setting)}},yo=t=>{const a=ui(t.data),r=ui(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(a)!==JSON.stringify(r)},lu=t=>{var a;return{id:(a=t.id)!=null?a:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},zs=t=>[...t].sort((a,r)=>{const o=sr(a.data.sort)-sr(r.data.sort);return o!==0?o:a.data.remark.localeCompare(r.data.remark)}),cu=t=>{const a=[];return Object.entries(t).forEach(([r,o])=>{o.forEach((n,l)=>{const i=ou(n,l),c=i.id!=null?`host-${i.id}`:bo();a.push({uid:c,inboundTag:r,initialInboundTag:r,data:oa(i),original:oa(i)})})}),zs(a)},So=t=>{const a=new Map;t.forEach(o=>{var l;const n=(l=a.get(o.inboundTag))!=null?l:[];n.push(o.data),a.set(o.inboundTag,n)});const r={};return a.forEach((o,n)=>{r[n]=o.map(l=>lu(l)).sort((l,i)=>sr(l.sort)-sr(i.sort))}),r},Gn=(t,a)=>{const r=So(t),o=Array.from(new Set(a)),n={};return o.forEach(l=>{var i;n[l]=(i=r[l])!=null?i:[]}),n},du=({host:t,inboundOptions:a,orderIndex:r,onToggleActive:o,onEdit:n,onDelete:l,saving:i,deleting:c})=>{const{t:u}=Ne(),m=a.find(I=>I.value===t.inboundTag),g=!t.data.is_disabled,p=yo(t),D=t.data.remark||u("hostsPage.untitledHost");return e(pr,{borderWidth:"1px",borderColor:p?"primary.400":"gray.200",_dark:{borderColor:p?"primary.300":"gray.700",bg:p?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>n(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:s(kr,{as:De,spacing:4,children:[s(P,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(X,{align:"flex-start",spacing:1,flex:"1",children:[e(et,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:D})}),s(P,{spacing:2,flexWrap:"wrap",children:[e(St,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),m&&e(St,{colorScheme:"purple",size:"sm",children:`${m.value} (${m.protocol.toUpperCase()} - ${m.network})`}),typeof t.data.port=="number"&&e(St,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),p&&e(St,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),s(P,{spacing:2,children:[e(Ct,{size:"sm",colorScheme:"primary",isChecked:g,onChange:I=>{I.stopPropagation(),o(t.uid,I.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(g?"hostsPage.enabled":"hostsPage.disabled")})]})]}),s(X,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&s(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),s(P,{justify:"space-between",children:[e(te,{size:"sm",variant:"outline",leftIcon:e(nu,{}),onClick:I=>{I.stopPropagation(),n(t.uid)},isLoading:i,children:u("hostsPage.edit")}),e(Ee,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:I=>{I.stopPropagation(),l(t.uid)},icon:e(Gs,{}),isLoading:c})]})]})})},uu=({host:t,index:a})=>{const{t:r}=Ne(),o=Ul(),n=t.data.remark||r("hostsPage.untitledHost"),l=d.exports.useCallback(i=>{i.pointerType==="mouse"&&i.button!==0||(i.preventDefault(),o.start(i))},[o]);return e(Qi.Item,{value:t,id:t.uid,dragListener:!1,dragControls:o,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:s(P,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(et,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(Ee,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(fo,{}),cursor:"grab",onPointerDown:l,style:{touchAction:"none"}})}),e(St,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:a+1})}),s(X,{align:"flex-start",spacing:0,flex:"1",children:[e(et,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:n})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},hu=({host:t,inboundOptions:a,isOpen:r,onClose:o,onChange:n,onChangeInbound:l,onSave:i,onReset:c,onDelete:u,saving:m,deleting:g})=>{var k;const{t:p}=Ne();if(!t)return null;const D=a.find(f=>f.value===t.inboundTag),I=yo(t);return s(ga,{isOpen:r,placement:"right",size:"xl",onClose:o,children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),s(pa,{children:[e(xt,{}),e(ct,{pb:1,children:s(X,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||p("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||p("hostsPage.noAddress")}),D&&e(St,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${D.value} (${D.protocol.toUpperCase()} - ${D.network})`})]})}),e(at,{children:s(X,{align:"stretch",spacing:5,children:[s(pr,{variant:"outline",children:[e(rs,{pb:2,children:e(h,{fontWeight:"semibold",children:p("hostsPage.section.general")})}),e(kr,{pt:0,children:s(X,{align:"stretch",spacing:4,children:[s(F,{children:[e(H,{children:p("hostsDialog.remark")}),s(jt,{children:[e(de,{value:t.data.remark,onChange:f=>n(t.uid,"remark",f.target.value)}),e(nr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ns,{})})]})]}),s(ot,{columns:{base:1,md:2},spacing:4,children:[s(F,{children:[e(H,{children:p("hostsPage.inboundLabel")}),e(Ge,{value:t.inboundTag,onChange:f=>l(t.uid,f.target.value),children:a.map(f=>e("option",{value:f.value,children:f.label},f.value))})]}),s(F,{children:[e(H,{children:p("hostsDialog.sort")}),e(Ps,{value:t.data.sort,allowMouseWheel:!0,onChange:(f,v)=>n(t.uid,"sort",Number.isNaN(v)?t.data.sort:v),children:e(Ls,{})})]})]}),s(ot,{columns:{base:1,md:2},spacing:4,children:[s(F,{children:[e(H,{children:p("hostsDialog.address")}),s(jt,{children:[e(de,{value:t.data.address,onChange:f=>n(t.uid,"address",f.target.value)}),e(nr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ns,{})})]})]}),s(F,{children:[e(H,{children:p("hostsDialog.port")}),e(Ps,{value:(k=t.data.port)!=null?k:"",allowMouseWheel:!0,onChange:(f,v)=>n(t.uid,"port",Number.isNaN(v)?null:v),children:e(Ls,{})})]})]})]})})]}),s(pr,{variant:"outline",children:[e(rs,{pb:2,children:e(h,{fontWeight:"semibold",children:p("hostsPage.section.security")})}),e(kr,{pt:0,children:s(X,{align:"stretch",spacing:4,children:[s(ot,{columns:{base:1,md:2},spacing:4,children:[s(F,{children:[e(H,{children:p("hostsDialog.sni")}),e(de,{value:t.data.sni,onChange:f=>n(t.uid,"sni",f.target.value)})]}),s(F,{children:[e(H,{children:p("hostsDialog.host")}),s(jt,{children:[e(de,{value:t.data.host,onChange:f=>n(t.uid,"host",f.target.value)}),e(nr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ns,{})})]})]})]}),s(ot,{columns:{base:1,md:3},spacing:4,children:[s(F,{children:[e(H,{children:p("hostsDialog.security")}),e(Ge,{value:t.data.security,onChange:f=>n(t.uid,"security",f.target.value),children:tu.map(f=>e("option",{value:f.value,children:f.title},f.value))})]}),s(F,{children:[e(H,{children:p("hostsDialog.alpn")}),e(Ge,{value:t.data.alpn,onChange:f=>n(t.uid,"alpn",f.target.value),children:ru.map(f=>e("option",{value:f.value,children:f.title},f.value))})]}),s(F,{children:[e(H,{children:p("hostsDialog.fingerprint")}),e(Ge,{value:t.data.fingerprint,onChange:f=>n(t.uid,"fingerprint",f.target.value),children:su.map(f=>e("option",{value:f.value,children:f.title},f.value))})]})]})]})})]}),s(pr,{variant:"outline",children:[e(rs,{pb:2,children:e(h,{fontWeight:"semibold",children:p("hostsPage.section.advanced")})}),e(kr,{pt:0,children:s(X,{align:"stretch",spacing:4,children:[s(ot,{columns:{base:1,md:2},spacing:4,children:[s(F,{children:[e(H,{children:p("hostsDialog.fragment")}),e(de,{value:t.data.fragment_setting,onChange:f=>n(t.uid,"fragment_setting",f.target.value)})]}),s(F,{children:[e(H,{children:p("hostsDialog.noise")}),e(de,{value:t.data.noise_setting,onChange:f=>n(t.uid,"noise_setting",f.target.value)})]})]}),s(De,{direction:{base:"column",md:"row"},spacing:4,children:[e(Lr,{isChecked:t.data.allowinsecure,onChange:f=>n(t.uid,"allowinsecure",f.target.checked),children:p("hostsDialog.allowinsecure")}),e(Lr,{isChecked:t.data.mux_enable,onChange:f=>n(t.uid,"mux_enable",f.target.checked),children:p("hostsDialog.muxEnable")}),e(Lr,{isChecked:t.data.random_user_agent,onChange:f=>n(t.uid,"random_user_agent",f.target.checked),children:p("hostsDialog.randomUserAgent")}),e(Lr,{isChecked:t.data.use_sni_as_host,onChange:f=>n(t.uid,"use_sni_as_host",f.target.checked),children:p("hostsDialog.useSniAsHost")})]})]})})]})]})}),s(kt,{justifyContent:"space-between",children:[e(te,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(Gs,{}),onClick:()=>u(t.uid),isLoading:g,children:p("hostsPage.delete")}),s(P,{spacing:3,children:[e(te,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!I||m,children:p("hostsPage.reset")}),e(te,{size:"sm",colorScheme:"primary",onClick:()=>i(t.uid),isDisabled:!I,isLoading:m,children:p("hostsPage.save")})]})]})]})]})},mu=({isOpen:t,onClose:a,inboundOptions:r,onSubmit:o,isSubmitting:n,defaultSort:l})=>{var p,D,I,k;const{t:i}=Ne(),c=d.exports.useRef(null),[u,m]=d.exports.useState({inboundTag:(D=(p=r[0])==null?void 0:p.value)!=null?D:"",remark:"",address:"",sort:l!=null?l:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var f,v;t&&(m({inboundTag:(v=(f=r[0])==null?void 0:f.value)!=null?v:"",remark:"",address:"",sort:l!=null?l:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var N;return(N=c.current)==null?void 0:N.focus()},150))},[l,r,t]);const g=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||o(u)};return s(Dt,{isOpen:t,onClose:a,size:"lg",initialFocusRef:c,children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),s(At,{children:[e(ct,{children:s(P,{spacing:3,children:[e(po,{}),e(h,{fontWeight:"semibold",children:i("hostsPage.create.title")})]})}),e(xt,{mt:2}),s(at,{as:X,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:i("hostsPage.create.description")}),s(F,{children:[e(H,{children:i("hostsPage.inboundLabel")}),e(Ge,{value:u.inboundTag,onChange:f=>m(v=>({...v,inboundTag:f.target.value})),children:r.map(f=>e("option",{value:f.value,children:f.label},f.value))})]}),s(F,{isRequired:!0,children:[e(H,{children:i("hostsDialog.remark")}),s(jt,{children:[e(de,{ref:c,value:u.remark,onChange:f=>m(v=>({...v,remark:f.target.value}))}),e(nr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ns,{})})]})]}),s(ot,{columns:{base:1,md:2},spacing:3,children:[s(F,{isRequired:!0,children:[e(H,{children:i("hostsDialog.address")}),s(jt,{children:[e(de,{value:u.address,onChange:f=>m(v=>({...v,address:f.target.value}))}),e(nr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ns,{})})]})]}),s(F,{children:[e(H,{children:i("hostsDialog.port")}),e(Ps,{value:(I=u.port)!=null?I:"",onChange:(f,v)=>m(N=>({...N,port:Number.isNaN(v)?null:v})),children:e(Ls,{})})]})]}),s(ot,{columns:{base:1,md:2},spacing:3,children:[s(F,{children:[e(H,{children:i("hostsDialog.path")}),e(de,{value:u.path,onChange:f=>m(v=>({...v,path:f.target.value}))})]}),s(F,{children:[e(H,{children:i("hostsDialog.sni")}),e(de,{value:u.sni,onChange:f=>m(v=>({...v,sni:f.target.value}))})]})]}),s(F,{children:[e(H,{children:i("hostsDialog.host")}),s(jt,{children:[e(de,{value:u.host,onChange:f=>m(v=>({...v,host:f.target.value}))}),e(nr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ns,{})})]})]}),s(F,{children:[e(H,{children:i("hostsDialog.sort")}),e(Ps,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(f,v)=>m(N=>({...N,sort:Number.isNaN(v)?N.sort:v})),children:e(Ls,{})})]}),e(z,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:i("hostsPage.create.sortHint",{value:(k=u.sort)!=null?k:l})})]}),s(kt,{gap:2,children:[e(te,{variant:"ghost",onClick:a,children:i("hostsPage.cancel")}),e(te,{colorScheme:"primary",onClick:g,isLoading:n,children:i("hostsPage.create.submit")})]})]})]})},gu=()=>{var Je;const{t}=Ne(),a=Rt(),{hosts:r,fetchHosts:o,isLoading:n,isPostLoading:l,setHosts:i}=go(),{inbounds:c}=tt(),[u,m]=d.exports.useState([]),g=d.exports.useRef([]),p=d.exports.useCallback(J=>{typeof J=="function"?m(E=>{const ae=J(E);return g.current=ae,ae}):(g.current=J,m(J))},[]),[D,I]=d.exports.useState(null),[k,f]=d.exports.useState(!1),[v,N]=d.exports.useState(!1),[M,j]=d.exports.useState(null),[C,B]=d.exports.useState(null),[re,_]=d.exports.useState(null),[K,pe]=d.exports.useState(null),be=d.exports.useRef(null),[Ie,le]=d.exports.useState(!1),ge=d.exports.useRef(!1),[G,Q]=d.exports.useState(!1),[w,me]=d.exports.useState(!1),[xe,$]=d.exports.useState(null);d.exports.useEffect(()=>{o()},[o]),d.exports.useEffect(()=>{c.size||Sa()},[c]),d.exports.useEffect(()=>{const J=cu(r);p(J)},[r,p]),d.exports.useEffect(()=>{if(K){const J=g.current.find(E=>E.inboundTag===K.inboundTag&&E.data.remark.trim()===K.remark&&E.data.address.trim()===K.address);J&&(I(J.uid),pe(null))}},[u,K]),d.exports.useEffect(()=>{D&&!g.current.some(J=>J.uid===D)&&!K&&I(null)},[u,D,K]);const y=d.exports.useCallback(J=>{ge.current=J,le(J)},[]);d.exports.useEffect(()=>{w||($(null),y(!1))},[k,w,y]),d.exports.useEffect(()=>{if(!w||!xe)return;const J=new Set(g.current.map(ae=>ae.uid));xe.every(ae=>J.has(ae.uid))||($(null),y(!1))},[u,w,y,xe]);const x=d.exports.useMemo(()=>{const J=[];return c.forEach(E=>{E.forEach(ae=>{J.push({label:`${ae.tag} (${ae.protocol.toUpperCase()} - ${ae.network})`,value:ae.tag,protocol:ae.protocol,network:ae.network})})}),J.sort((E,ae)=>E.label.localeCompare(ae.label))},[c]),A=d.exports.useMemo(()=>g.current.filter(J=>!J.data.is_disabled).sort((J,E)=>sr(J.data.sort)-sr(E.data.sort)),[u]),ie=d.exports.useMemo(()=>[...g.current].sort((J,E)=>sr(J.data.sort)-sr(E.data.sort)),[u]),O=d.exports.useMemo(()=>k?ie:A,[A,ie,k]);d.exports.useEffect(()=>{w&&$(J=>J!=null?J:[...A])},[A,w]);const ue=w?xe!=null?xe:A:O,ve=d.exports.useMemo(()=>{const J=new Map;return ue.forEach((E,ae)=>J.set(E.uid,ae)),J},[ue]),ze=D&&(Je=g.current.find(J=>J.uid===D))!=null?Je:null,Me=(J,E,ae)=>{p(fe=>zs(fe.map(Ue=>Ue.uid===J?{...Ue,data:{...Ue.data,[E]:ae}}:Ue)))},q=(J,E)=>{p(ae=>zs(ae.map(fe=>fe.uid===J?{...fe,inboundTag:E}:fe)))},ye=d.exports.useCallback(async()=>{if(!w||G)return!1;const J=A,E=xe!=null?xe:J;if(!(E.length!==J.length||E.some((W,ke)=>{var He;return W.uid!==((He=J[ke])==null?void 0:He.uid)}))||!xe||E.length===0)return me(!1),$(null),y(!1),!0;const fe=E.map(W=>W.uid),Ue=new Map;fe.forEach((W,ke)=>Ue.set(W,ke));const Ke=g.current,rt=g.current.filter(W=>Ue.has(W.uid)).sort((W,ke)=>{var He,st;return((He=Ue.get(W.uid))!=null?He:Number.MAX_SAFE_INTEGER)-((st=Ue.get(ke.uid))!=null?st:Number.MAX_SAFE_INTEGER)}),bt=g.current.filter(W=>!Ue.has(W.uid)).sort((W,ke)=>sr(W.data.sort)-sr(ke.data.sort)),Tt=[...rt,...bt].map((W,ke)=>({...W,data:{...W.data,sort:ke},original:{...W.original,sort:ke}}));p(Tt),$(Tt.filter(W=>!W.data.is_disabled)),Q(!0);try{const W=So(Tt);return await i(W),await o(),y(!1),me(!1),$(null),a({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{p(Ke);const ke=Ke.filter(He=>!He.data.is_disabled).sort((He,st)=>sr(He.data.sort)-sr(st.data.sort));return $(ke),y(!0),a({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{Q(!1)}},[p,A,o,w,G,i,y,t,a,xe]),_e=d.exports.useCallback(J=>{if(!w||!J.length)return;const E=xe!=null?xe:A;!(J.length!==E.length||J.some((fe,Ue)=>{var Ke;return fe.uid!==((Ke=E[Ue])==null?void 0:Ke.uid)}))||($(J),ge.current||y(!0))},[A,w,y,xe]),Be=d.exports.useCallback(()=>{$([...A]),y(!1),me(!0)},[A,y]),Ve=d.exports.useCallback(()=>{me(!1),$(null),y(!1)},[y]),Ze=d.exports.useCallback(()=>{ye()},[ye]),dt=async J=>{const E=g.current.find(ae=>ae.uid===J);if(!!E){j(J),pe({inboundTag:E.inboundTag,remark:E.data.remark.trim(),address:E.data.address.trim()});try{const ae=Gn(g.current,[E.inboundTag,E.initialInboundTag]);await i(ae),await o(),a({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"})}catch{a({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{j(null)}}},oe=J=>{p(E=>zs(E.map(ae=>ae.uid===J?{...ae,inboundTag:ae.initialInboundTag,data:oa(ae.original)}:ae)))},he=(J,E)=>{Me(J,"is_disabled",!E),E||f(!0)},Z=J=>{_(J)},ne=async()=>{if(!re)return;const J=g.current.find(E=>E.uid===re);if(!!J){B(re);try{const E=g.current.filter(fe=>fe.uid!==re);p(E);const ae=Gn(E,[J.inboundTag,J.initialInboundTag]);await i(ae),await o(),a({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),D===re&&I(null)}catch{a({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{B(null),_(null)}}},ht=async J=>{const E=g.current.length?Math.max(...g.current.map(ae=>ae.data.sort))+1:0;j("create"),pe({inboundTag:J.inboundTag,remark:J.remark.trim(),address:J.address.trim()});try{const ae={uid:bo(),inboundTag:J.inboundTag,initialInboundTag:J.inboundTag,data:{id:null,remark:J.remark,address:J.address,sort:Number.isFinite(J.sort)?J.sort:E,port:J.port,path:J.path,sni:J.sni,host:J.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:J.remark,address:J.address,sort:Number.isFinite(J.sort)?J.sort:E,port:J.port,path:J.path,sni:J.sni,host:J.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},fe=zs([...g.current,ae]);p(fe);const Ue=Gn(fe,[J.inboundTag]);await i(Ue),await o(),a({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),N(!1)}catch{a({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{j(null)}};return s(X,{align:"stretch",spacing:4,children:[w?s(X,{align:"stretch",spacing:2,children:[s(P,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),s(P,{spacing:2,children:[e(te,{variant:"ghost",onClick:Ve,isDisabled:G,children:t("hostsPage.cancel")}),e(te,{colorScheme:"primary",onClick:Ze,isLoading:G,isDisabled:!Ie&&!G,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),G?s(P,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(lt,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):Ie?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):s(P,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[s(P,{spacing:3,children:[e(te,{colorScheme:"primary",size:"sm",onClick:()=>N(!0),leftIcon:e(po,{}),isDisabled:!x.length,children:t("hostsPage.addHost")}),e(Ct,{isChecked:k,onChange:J=>f(J.target.checked),children:t("hostsPage.showDisabled")})]}),e(te,{size:"sm",variant:"outline",leftIcon:e(fo,{}),onClick:Be,isDisabled:n||!A.length,children:t("hostsPage.enterSort")})]}),n?e(P,{justify:"center",py:10,children:e(lt,{})}):ue.length===0?e(z,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t("hostsPage.emptyState")})}):w?e(Qi.Group,{axis:"y",values:ue,onReorder:_e,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:ue.map((J,E)=>e(uu,{host:J,index:E},J.uid))}):e(ot,{columns:{base:1,md:2,xl:3},spacing:4,children:O.map((J,E)=>{var ae;return e(du,{host:J,inboundOptions:x,orderIndex:(ae=ve.get(J.uid))!=null?ae:E,onToggleActive:he,onEdit:I,onDelete:Z,saving:M===J.uid&&l,deleting:C===J.uid&&l},J.uid)})}),e(mu,{isOpen:v,onClose:()=>N(!1),inboundOptions:x,onSubmit:ht,isSubmitting:M==="create"&&l,defaultSort:g.current.length?Math.max(...g.current.map(J=>J.data.sort))+1:0}),e(hu,{host:ze,inboundOptions:x,isOpen:Boolean(ze),onClose:()=>I(null),onChange:Me,onChangeInbound:q,onSave:dt,onReset:oe,onDelete:Z,saving:!!ze&&M===ze.uid&&l,deleting:!!ze&&C===ze.uid&&l}),e(Us,{isOpen:Boolean(re),leastDestructiveRef:be,onClose:()=>_(null),children:e(nt,{children:s(Rs,{children:[e(ct,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(at,{children:t("hostsPage.deleteConfirmation")}),s(kt,{children:[e(te,{ref:be,onClick:()=>_(null),children:t("hostsPage.cancel")}),e(te,{colorScheme:"red",onClick:ne,ml:3,isLoading:Boolean(C),children:t("hostsPage.delete")})]})]})})})]})},pu=()=>{const{t}=Ne();return s(X,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings")}),e(gu,{})]})},fu=Se.object({name:Se.string().min(1),address:Se.string().min(1),port:Se.number().min(1).or(Se.string().transform(t=>parseFloat(t))),api_port:Se.number().min(1).or(Se.string().transform(t=>parseFloat(t))),xray_version:Se.string().nullable().optional(),id:Se.number().nullable().optional(),status:Se.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:Se.string().nullable().optional(),add_as_new_host:Se.boolean().optional(),usage_coefficient:Se.number().or(Se.string().transform(t=>parseFloat(t))),data_limit:Se.number().nullable().optional(),uplink:Se.number().nullable().optional(),downlink:Se.number().nullable().optional()}),hn=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0}),rr="fetch-nodes-query-key",xa=()=>{const{isEditingNodes:t}=tt();return vr({queryKey:rr,queryFn:Qs.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Qs=hs((t,a)=>({nodes:[],addNode(r){return we("/node",{method:"POST",body:r})},fetchNodes(){return we("/nodes")},fetchNodesUsage(r){return we("/nodes/usage",{query:r})},updateNode(r){return we(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return we(`/node/${r.id}/reconnect`,{method:"POST"})},resetNodeUsage(r){return we(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return we("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return we("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return we(`/node/${(r=a().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),hi=({expiryDate:t,status:a,compact:r=!1,showDetail:o=!0,extraText:n})=>{const{t:l}=Ne(),i=Rn(t),c=Br[a].icon;return s(_t,{children:[s(Nr,{colorScheme:Br[a].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),o&&s(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[a&&l(`nodeModal.status.${a}`),n&&`: ${n}`]})]}),o&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l(i.status,{time:i.time})})]})},bu=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),mi=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(bu(t))}catch{}return""},yu=t=>{if(typeof t!="string"||t.length===0)return"";const a=globalThis.Wireguard;if(a!=null&&a.generateKeypair)try{const r=a.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class Qt{static isEmpty(a){return a==null?!0:typeof a=="string"?a.trim().length===0:Array.isArray(a)?a.length===0:typeof a=="object"?Object.keys(a).length===0:!1}static isArrEmpty(a){return!Array.isArray(a)||a.length===0}}const Y=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),xo=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"});Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const Su=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Zn=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class je{static toJsonArray(a){return a.map(r=>r.toJson())}static fromJson(a){return new je}toJson(){return{}}toString(a=!0){const r=this.toJson();return a?JSON.stringify(r,null,2):JSON.stringify(r)}}class wr extends je{constructor(r="none",o="",n=""){super();T(this,"type");T(this,"host");T(this,"path");this.type=r,this.host=o,this.path=n}static fromJson(r={}){var n,l,i,c,u,m,g,p,D,I;const o=r==null?void 0:r.header;if(!o)return new wr;if(o.type==="http"&&o.request){const k=((l=(n=o.request)==null?void 0:n.headers)==null?void 0:l.Host)&&Array.isArray(o.request.headers.Host)?o.request.headers.Host.join(","):(u=(c=(i=o.request)==null?void 0:i.headers)==null?void 0:c.Host)!=null?u:"",f=((m=o.request)==null?void 0:m.path)&&Array.isArray(o.request.path)?o.request.path.join(","):(p=(g=o.request)==null?void 0:g.path)!=null?p:"";return new wr((D=o.type)!=null?D:"http",k,f)}return new wr((I=o.type)!=null?I:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:Qt.isEmpty(this.host)?[]:this.host.split(",")},path:Qt.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class ls extends je{constructor(r=1350,o=50,n=5,l=20,i=!1,c=2,u=2,m="none",g=""){super();T(this,"mtu");T(this,"tti");T(this,"upCap");T(this,"downCap");T(this,"congestion");T(this,"readBuffer");T(this,"writeBuffer");T(this,"type");T(this,"seed");this.mtu=r!=null?r:1350,this.tti=o!=null?o:50,this.upCap=n!=null?n:5,this.downCap=l!=null?l:20,this.congestion=Boolean(i),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=m!=null?m:"none",this.seed=g!=null?g:""}static fromJson(r={}){var o,n,l;return new ls(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(n=(o=r==null?void 0:r.header)==null?void 0:o.type)!=null?n:"none",(l=r==null?void 0:r.seed)!=null?l:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class $r extends je{constructor(r="/",o="",n=0){super();T(this,"path");T(this,"host");T(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=o!=null?o:"",this.heartbeatPeriod=n!=null?n:0}static fromJson(r={}){var o,n,l;return new $r((o=r==null?void 0:r.path)!=null?o:"/",(n=r==null?void 0:r.host)!=null?n:"",(l=r==null?void 0:r.heartbeatPeriod)!=null?l:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class Jr extends je{constructor(r="",o="",n=!1){super();T(this,"serviceName");T(this,"authority");T(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=o!=null?o:"",this.multiMode=Boolean(n)}static fromJson(r={}){var o,n;return new Jr((o=r==null?void 0:r.serviceName)!=null?o:"",(n=r==null?void 0:r.authority)!=null?n:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class cs extends je{constructor(r="/",o=""){super();T(this,"path");T(this,"host");this.path=r!=null?r:"/",this.host=o!=null?o:""}static fromJson(r={}){var o,n;return new cs((o=r==null?void 0:r.path)!=null?o:"/",(n=r==null?void 0:r.host)!=null?n:"")}toJson(){return{path:this.path,host:this.host}}}class ds extends je{constructor(r="/",o="",n="",l=!1,i="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,m,g,p,D,I;super();T(this,"path");T(this,"host");T(this,"mode");T(this,"noGRPCHeader");T(this,"scMinPostsIntervalMs");T(this,"xmux");this.path=r!=null?r:"/",this.host=o!=null?o:"",this.mode=n!=null?n:"",this.noGRPCHeader=Boolean(l),this.scMinPostsIntervalMs=i!=null?i:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(m=c==null?void 0:c.maxConnections)!=null?m:0,cMaxReuseTimes:(g=c==null?void 0:c.cMaxReuseTimes)!=null?g:0,hMaxRequestTimes:(p=c==null?void 0:c.hMaxRequestTimes)!=null?p:"600-900",hMaxReusableSecs:(D=c==null?void 0:c.hMaxReusableSecs)!=null?D:"1800-3000",hKeepAlivePeriod:(I=c==null?void 0:c.hKeepAlivePeriod)!=null?I:0}}static fromJson(r={}){var o,n,l,i;return new ds((o=r==null?void 0:r.path)!=null?o:"/",(n=r==null?void 0:r.host)!=null?n:"",(l=r==null?void 0:r.mode)!=null?l:"",Boolean(r==null?void 0:r.noGRPCHeader),(i=r==null?void 0:r.scMinPostsIntervalMs)!=null?i:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class Kr extends je{constructor(r="",o=[],n="",l=!1,i=""){super();T(this,"serverName");T(this,"alpn");T(this,"fingerprint");T(this,"allowInsecure");T(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=o!=null?o:[],this.fingerprint=n!=null?n:"",this.allowInsecure=Boolean(l),this.echConfigList=i!=null?i:""}static fromJson(r={}){var o,n,l;return new Kr((o=r==null?void 0:r.serverName)!=null?o:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(n=r==null?void 0:r.fingerprint)!=null?n:"",Boolean(r==null?void 0:r.allowInsecure),(l=r==null?void 0:r.echConfigList)!=null?l:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class us extends je{constructor(r="",o="",n="",l="",i="",c=""){super();T(this,"publicKey");T(this,"fingerprint");T(this,"serverName");T(this,"shortId");T(this,"spiderX");T(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=o!=null?o:"",this.serverName=n!=null?n:"",this.shortId=l!=null?l:"",this.spiderX=i!=null?i:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var o,n,l,i,c,u;return new us((o=r==null?void 0:r.publicKey)!=null?o:"",(n=r==null?void 0:r.fingerprint)!=null?n:"",(l=r==null?void 0:r.serverName)!=null?l:"",(i=r==null?void 0:r.shortId)!=null?i:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class Ms extends je{constructor(r="",o=!1,n=0,l=!1,i=!1,c=Zn.NONE){super();T(this,"dialerProxy");T(this,"tcpFastOpen");T(this,"tcpKeepAliveInterval");T(this,"tcpMptcp");T(this,"penetrate");T(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(o),this.tcpKeepAliveInterval=n!=null?n:0,this.tcpMptcp=Boolean(l),this.penetrate=Boolean(i),this.addressPortStrategy=c!=null?c:Zn.NONE}static fromJson(r={}){var o,n,l;return!r||Object.keys(r).length===0?new Ms:new Ms((o=r==null?void 0:r.dialerProxy)!=null?o:"",Boolean(r==null?void 0:r.tcpFastOpen),(n=r==null?void 0:r.tcpKeepAliveInterval)!=null?n:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(l=r==null?void 0:r.addressPortStrategy)!=null?l:Zn.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class zr extends je{constructor(r="tcp",o="none",n=new Kr,l=new us,i=new wr,c=new ls,u=new $r,m=new Jr,g=new cs,p=new ds,D){super();T(this,"network");T(this,"security");T(this,"tls");T(this,"reality");T(this,"tcp");T(this,"kcp");T(this,"ws");T(this,"grpc");T(this,"httpupgrade");T(this,"xhttp");T(this,"sockopt");this.network=r!=null?r:"tcp",this.security=o!=null?o:"none",this.tls=n,this.reality=l,this.tcp=i,this.kcp=c,this.ws=u,this.grpc=m,this.httpupgrade=g,this.xhttp=p,this.sockopt=D}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new Ms:void 0}static fromJson(r={}){var o,n;return new zr((o=r==null?void 0:r.network)!=null?o:"tcp",(n=r==null?void 0:r.security)!=null?n:"none",Kr.fromJson(r==null?void 0:r.tlsSettings),us.fromJson(r==null?void 0:r.realitySettings),wr.fromJson(r==null?void 0:r.tcpSettings),ls.fromJson(r==null?void 0:r.kcpSettings),$r.fromJson(r==null?void 0:r.wsSettings),Jr.fromJson(r==null?void 0:r.grpcSettings),cs.fromJson(r==null?void 0:r.httpupgradeSettings),ds.fromJson(r==null?void 0:r.xhttpSettings),Ms.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class Os extends je{constructor(r=!1,o=8,n=16,l="reject"){super();T(this,"enabled");T(this,"concurrency");T(this,"xudpConcurrency");T(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=o!=null?o:8,this.xudpConcurrency=n!=null?n:16,this.xudpProxyUDP443=l!=null?l:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new Os:new Os(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var xr,ir;const Oe=class extends je{constructor(r="",o=Y.VLESS,n=Oe.Settings.getSettings(Y.VLESS),l=new zr,i,c=new Os){super();T(this,"tag");T(this,"_protocol");T(this,"settings");T(this,"stream");T(this,"sendThrough");T(this,"mux");this.tag=r!=null?r:"",this._protocol=o!=null?o:Y.VLESS,this.settings=n!=null?n:Oe.Settings.getSettings(this._protocol),this.stream=l,this.sendThrough=i,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=Oe.Settings.getSettings(r),this.stream=new zr}canEnableTls(){return[Y.VMess,Y.VLESS,Y.Trojan,Y.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===Y.VLESS:!1}canEnableReality(){return[Y.VLESS,Y.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[Y.VMess,Y.VLESS,Y.Trojan,Y.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[Y.VMess,Y.VLESS,Y.Trojan,Y.Shadowsocks,Y.HTTP,Y.Socks].includes(this.protocol)}hasVnext(){return[Y.VMess,Y.VLESS].includes(this.protocol)}hasServers(){return[Y.Trojan,Y.Shadowsocks,Y.Socks,Y.HTTP].includes(this.protocol)}hasAddressPort(){return[Y.DNS,Y.VMess,Y.VLESS,Y.Trojan,Y.Shadowsocks,Y.Socks,Y.HTTP].includes(this.protocol)}hasUsername(){return[Y.Socks,Y.HTTP].includes(this.protocol)}static fromJson(r={}){var o,n,l,i;return new Oe((o=r==null?void 0:r.tag)!=null?o:"",(n=r==null?void 0:r.protocol)!=null?n:Y.VLESS,Oe.Settings.fromProtocol((l=r==null?void 0:r.protocol)!=null?l:Y.VLESS,r==null?void 0:r.settings),zr.fromJson(r==null?void 0:r.streamSettings),(i=r==null?void 0:r.sendThrough)!=null?i:"",Os.fromJson(r==null?void 0:r.mux))}toJson(){var o,n;let r;return this.canEnableStream()?r=this.stream.toJson():(o=this.stream)!=null&&o.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof je?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(n=this.mux)!=null&&n.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const o=r.split("://");if(o.length!==2)return null;const n=o[0].toLowerCase();try{switch(n){case Y.VMess:return Oe.fromVmessLink(JSON.parse(mi(o[1])));case Y.VLESS:case Y.Trojan:case"ss":return Oe.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var i,c,u,m,g,p,D,I,k,f,v,N,M,j,C,B,re,_,K,pe,be,Ie,le;if(!r)return null;const o=new zr((i=r==null?void 0:r.net)!=null?i:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),n=r==null?void 0:r.net;n==="tcp"?o.tcp=new wr((u=r==null?void 0:r.type)!=null?u:"none",(m=r==null?void 0:r.host)!=null?m:"",(g=r==null?void 0:r.path)!=null?g:""):n==="kcp"?(o.kcp=new ls,o.kcp.type=(p=r==null?void 0:r.type)!=null?p:"none",o.kcp.seed=(D=r==null?void 0:r.path)!=null?D:""):n==="ws"?o.ws=new $r((I=r==null?void 0:r.path)!=null?I:"/",(k=r==null?void 0:r.host)!=null?k:""):n==="grpc"?o.grpc=new Jr((f=r==null?void 0:r.path)!=null?f:"",(v=r==null?void 0:r.authority)!=null?v:"",(r==null?void 0:r.type)==="multi"):n==="httpupgrade"?o.httpupgrade=new cs((N=r==null?void 0:r.path)!=null?N:"/",(M=r==null?void 0:r.host)!=null?M:""):n==="xhttp"&&(o.xhttp=new ds((j=r==null?void 0:r.path)!=null?j:"/",(C=r==null?void 0:r.host)!=null?C:"",(B=r==null?void 0:r.mode)!=null?B:"")),(r==null?void 0:r.tls)==="tls"&&(o.security="tls",o.tls=new Kr((re=r==null?void 0:r.sni)!=null?re:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(_=r==null?void 0:r.fp)!=null?_:"",Boolean(r==null?void 0:r.allowInsecure)));const l=Number((K=r==null?void 0:r.port)!=null?K:0);return Number.isNaN(l)?null:new Oe((pe=r==null?void 0:r.ps)!=null?pe:"",Y.VMess,new Oe.VmessSettings((be=r==null?void 0:r.add)!=null?be:"",l,(Ie=r==null?void 0:r.id)!=null?Ie:"",(le=r==null?void 0:r.scy)!=null?le:""),o)}static fromParamLink(r){var B,re,_,K,pe,be,Ie,le,ge,G,Q,w,me,xe,$,y,x,A,ie,O,ue;let o;try{o=new URL(r)}catch{return null}const n=(B=o.searchParams.get("type"))!=null?B:"tcp",l=(re=o.searchParams.get("security"))!=null?re:"none",i=new zr(n,l),c=(_=o.searchParams.get("headerType"))!=null?_:void 0,u=(K=o.searchParams.get("host"))!=null?K:void 0,m=(pe=o.searchParams.get("path"))!=null?pe:void 0,g=(be=o.searchParams.get("mode"))!=null?be:void 0;if(n==="tcp"||n==="none"?i.tcp=new wr(c!=null?c:"none",u!=null?u:"",m!=null?m:""):n==="kcp"?(i.kcp=new ls,i.kcp.type=c!=null?c:"none",i.kcp.seed=m!=null?m:""):n==="ws"?i.ws=new $r(m!=null?m:"/",u!=null?u:""):n==="grpc"?i.grpc=new Jr((Ie=o.searchParams.get("serviceName"))!=null?Ie:"",(le=o.searchParams.get("authority"))!=null?le:"",o.searchParams.get("mode")==="multi"):n==="httpupgrade"?i.httpupgrade=new cs(m!=null?m:"/",u!=null?u:""):n==="xhttp"&&(i.xhttp=new ds(m!=null?m:"/",u!=null?u:"",g!=null?g:"")),l==="tls"){const ve=(ge=o.searchParams.get("fp"))!=null?ge:"none",ze=o.searchParams.get("alpn"),Me=o.searchParams.get("allowInsecure"),q=(G=o.searchParams.get("sni"))!=null?G:"",ye=(Q=o.searchParams.get("ech"))!=null?Q:"";i.tls=new Kr(q,ze?ze.split(","):[],ve,Me==="1",ye)}if(l==="reality"){const ve=(w=o.searchParams.get("pbk"))!=null?w:"",ze=(me=o.searchParams.get("fp"))!=null?me:"",Me=(xe=o.searchParams.get("sni"))!=null?xe:"",q=($=o.searchParams.get("sid"))!=null?$:"",ye=(y=o.searchParams.get("spx"))!=null?y:"",_e=(x=o.searchParams.get("pqv"))!=null?x:"";i.reality=new us(ve,ze,Me,q,ye,_e)}const p=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,D=r.match(p);if(!D)return null;let[,I,k,f,v]=D,N=Number(v);Number.isNaN(N)&&(N=0),I==="ss"&&(I=Y.Shadowsocks,k=mi(k));let M=null;switch(I){case Y.VLESS:{const ve=(A=o.searchParams.get("encryption"))!=null?A:"none";M=new Oe.VLESSSettings(f,N,k,(ie=o.searchParams.get("flow"))!=null?ie:"",ve);break}case Y.Trojan:M=new Oe.TrojanSettings(f,N,k);break;case Y.Shadowsocks:{const ve=k.split(":"),ze=(O=ve.shift())!=null?O:"";M=new Oe.ShadowsocksSettings(f,N,ve.join(":"),ze,!0);break}default:return null}const j=decodeURIComponent((ue=o.hash)!=null?ue:""),C=j.length>1?j.substring(1):`out-${I}-${N}`;return new Oe(C,I,M,i)}};let Ot=Oe;T(Ot,"Settings",class extends je{constructor(n){super();T(this,"protocol");this.protocol=n}static getSettings(n){switch(n){case Y.Freedom:return new Oe.FreedomSettings;case Y.Blackhole:return new Oe.BlackholeSettings;case Y.DNS:return new Oe.DNSSettings;case Y.VMess:return new Oe.VmessSettings;case Y.VLESS:return new Oe.VLESSSettings;case Y.Trojan:return new Oe.TrojanSettings;case Y.Shadowsocks:return new Oe.ShadowsocksSettings;case Y.Socks:return new Oe.SocksSettings;case Y.HTTP:return new Oe.HttpSettings;case Y.Wireguard:return new Oe.WireguardSettings;default:return null}}static fromProtocol(n,l){switch(n){case Y.Freedom:return Oe.FreedomSettings.fromJson(l);case Y.Blackhole:return Oe.BlackholeSettings.fromJson(l);case Y.DNS:return Oe.DNSSettings.fromJson(l);case Y.VMess:return Oe.VmessSettings.fromJson(l);case Y.VLESS:return Oe.VLESSSettings.fromJson(l);case Y.Trojan:return Oe.TrojanSettings.fromJson(l);case Y.Shadowsocks:return Oe.ShadowsocksSettings.fromJson(l);case Y.Socks:return Oe.SocksSettings.fromJson(l);case Y.HTTP:return Oe.HttpSettings.fromJson(l);case Y.Wireguard:return Oe.WireguardSettings.fromJson(l);default:return null}}toJson(){return{}}}),T(Ot,"FreedomSettings",(xr=class extends je{constructor(n="",l="",i={},c=[]){super();T(this,"domainStrategy");T(this,"redirect");T(this,"fragment");T(this,"noises");this.domainStrategy=n!=null?n:"",this.redirect=l!=null?l:"",this.fragment=i!=null?i:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new Oe.FreedomSettings.Noise)}delNoise(n){this.noises.splice(n,1)}static fromJson(n={}){var l,i;return new xr((l=n==null?void 0:n.domainStrategy)!=null?l:"",(i=n==null?void 0:n.redirect)!=null?i:"",n!=null&&n.fragment?xr.Fragment.fromJson(n.fragment):{},Array.isArray(n==null?void 0:n.noises)?n.noises.map(c=>xr.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:Qt.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:Qt.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:je.toJsonArray(this.noises)}}},T(xr,"Fragment",class ko extends je{constructor(i="1-3",c="",u="",m=""){super();T(this,"packets");T(this,"length");T(this,"interval");T(this,"maxSplit");this.packets=i!=null?i:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=m!=null?m:""}static fromJson(i={}){var c,u,m,g;return new ko((c=i==null?void 0:i.packets)!=null?c:"1-3",(u=i==null?void 0:i.length)!=null?u:"",(m=i==null?void 0:i.interval)!=null?m:"",(g=i==null?void 0:i.maxSplit)!=null?g:"")}}),T(xr,"Noise",class wo extends je{constructor(i="rand",c="10-20",u="10-16",m="ip"){super();T(this,"type");T(this,"packet");T(this,"delay");T(this,"applyTo");this.type=i!=null?i:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=m!=null?m:"ip"}static fromJson(i={}){var c,u,m,g;return new wo((c=i==null?void 0:i.type)!=null?c:"rand",(u=i==null?void 0:i.packet)!=null?u:"10-20",(m=i==null?void 0:i.delay)!=null?m:"10-16",(g=i==null?void 0:i.applyTo)!=null?g:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),xr)),T(Ot,"BlackholeSettings",class vo extends je{constructor(n){super();T(this,"type");this.type=n}static fromJson(n={}){var l;return new vo((l=n==null?void 0:n.response)==null?void 0:l.type)}toJson(){return{response:Qt.isEmpty(this.type)?void 0:{type:this.type}}}}),T(Ot,"DNSSettings",class Co extends je{constructor(n="udp",l="",i=53,c="reject",u=[]){super();T(this,"network");T(this,"address");T(this,"port");T(this,"nonIPQuery");T(this,"blockTypes");this.network=n!=null?n:"udp",this.address=l!=null?l:"",this.port=i!=null?i:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(n={}){var l,i,c,u;return new Co((l=n==null?void 0:n.network)!=null?l:"udp",(i=n==null?void 0:n.address)!=null?i:"",(c=n==null?void 0:n.port)!=null?c:53,(u=n==null?void 0:n.nonIPQuery)!=null?u:"reject",Array.isArray(n==null?void 0:n.blockTypes)?n.blockTypes:[])}}),T(Ot,"VmessSettings",class extends je{constructor(n="",l=0,i="",c=""){super();T(this,"address");T(this,"port");T(this,"id");T(this,"security");this.address=n!=null?n:"",this.port=l!=null?l:0,this.id=i!=null?i:"",this.security=c!=null?c:""}static fromJson(n={}){var c,u,m,g;if(Qt.isArrEmpty(n==null?void 0:n.vnext))return new Oe.VmessSettings;const l=n.vnext[0],i=Array.isArray(l==null?void 0:l.users)&&l.users[0]?l.users[0]:{};return new Oe.VmessSettings((c=l==null?void 0:l.address)!=null?c:"",(u=l==null?void 0:l.port)!=null?u:0,(m=i==null?void 0:i.id)!=null?m:"",(g=i==null?void 0:i.security)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),T(Ot,"VLESSSettings",class extends je{constructor(n="",l=0,i="",c="",u=""){super();T(this,"address");T(this,"port");T(this,"id");T(this,"flow");T(this,"encryption");this.address=n!=null?n:"",this.port=l!=null?l:0,this.id=i!=null?i:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(n={}){var c,u,m,g,p;if(Qt.isArrEmpty(n==null?void 0:n.vnext))return new Oe.VLESSSettings;const l=n.vnext[0],i=Array.isArray(l==null?void 0:l.users)&&l.users[0]?l.users[0]:{};return new Oe.VLESSSettings((c=l==null?void 0:l.address)!=null?c:"",(u=l==null?void 0:l.port)!=null?u:0,(m=i==null?void 0:i.id)!=null?m:"",(g=i==null?void 0:i.flow)!=null?g:"",(p=i==null?void 0:i.encryption)!=null?p:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),T(Ot,"TrojanSettings",class extends je{constructor(n="",l=0,i=""){super();T(this,"address");T(this,"port");T(this,"password");this.address=n!=null?n:"",this.port=l!=null?l:0,this.password=i!=null?i:""}static fromJson(n={}){var i,c,u;if(Qt.isArrEmpty(n==null?void 0:n.servers))return new Oe.TrojanSettings;const l=n.servers[0];return new Oe.TrojanSettings((i=l==null?void 0:l.address)!=null?i:"",(c=l==null?void 0:l.port)!=null?c:0,(u=l==null?void 0:l.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),T(Ot,"ShadowsocksSettings",class extends je{constructor(n="",l=0,i="",c="",u,m){super();T(this,"address");T(this,"port");T(this,"password");T(this,"method");T(this,"uot");T(this,"UoTVersion");this.address=n!=null?n:"",this.port=l!=null?l:0,this.password=i!=null?i:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=m}static fromJson(n={}){var c,u,m,g;let l=n==null?void 0:n.servers;Qt.isArrEmpty(l)&&(l=[{}]);const i=l[0];return new Oe.ShadowsocksSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(m=i==null?void 0:i.password)!=null?m:"",(g=i==null?void 0:i.method)!=null?g:"",i==null?void 0:i.uot,i==null?void 0:i.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),T(Ot,"SocksSettings",class extends je{constructor(n="",l=0,i="",c=""){super();T(this,"address");T(this,"port");T(this,"user");T(this,"pass");this.address=n!=null?n:"",this.port=l!=null?l:0,this.user=i!=null?i:"",this.pass=c!=null?c:""}static fromJson(n={}){var u,m,g,p;let l=n==null?void 0:n.servers;Qt.isArrEmpty(l)&&(l=[{users:[{}]}]);const i=l[0],c=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Oe.SocksSettings((u=i==null?void 0:i.address)!=null?u:"",(m=i==null?void 0:i.port)!=null?m:0,(g=c==null?void 0:c.user)!=null?g:"",(p=c==null?void 0:c.pass)!=null?p:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Qt.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),T(Ot,"HttpSettings",class extends je{constructor(n="",l=0,i="",c=""){super();T(this,"address");T(this,"port");T(this,"user");T(this,"pass");this.address=n!=null?n:"",this.port=l!=null?l:0,this.user=i!=null?i:"",this.pass=c!=null?c:""}static fromJson(n={}){var u,m,g,p;let l=n==null?void 0:n.servers;Qt.isArrEmpty(l)&&(l=[{users:[{}]}]);const i=l[0],c=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Oe.HttpSettings((u=i==null?void 0:i.address)!=null?u:"",(m=i==null?void 0:i.port)!=null?m:0,(g=c==null?void 0:c.user)!=null?g:"",(p=c==null?void 0:c.pass)!=null?p:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Qt.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),T(Ot,"WireguardSettings",(ir=class extends je{constructor(n=1420,l="",i=[""],c=2,u="",m="",g=[new ir.Peer],p=!1){super();T(this,"mtu");T(this,"secretKey");T(this,"pubKey");T(this,"address");T(this,"workers");T(this,"domainStrategy");T(this,"reserved");T(this,"peers");T(this,"noKernelTun");this.mtu=n!=null?n:1420,this.secretKey=l!=null?l:"",this.pubKey=this.secretKey.length>0?yu(this.secretKey):"",this.address=Array.isArray(i)?i.join(","):i!=null?i:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(m)?m.join(","):m!=null?m:"",this.peers=g!=null?g:[new ir.Peer],this.noKernelTun=Boolean(p)}addPeer(){this.peers.push(new ir.Peer)}delPeer(n){this.peers.splice(n,1)}static fromJson(n={}){var l,i,c,u,m,g,p;return new ir((l=n==null?void 0:n.mtu)!=null?l:1420,(i=n==null?void 0:n.secretKey)!=null?i:"",(c=n==null?void 0:n.address)!=null?c:[""],(u=n==null?void 0:n.workers)!=null?u:2,(m=n==null?void 0:n.domainStrategy)!=null?m:"",(g=n==null?void 0:n.reserved)!=null?g:"",Array.isArray(n==null?void 0:n.peers)?n.peers.map(D=>ir.Peer.fromJson(D)):[new ir.Peer],(p=n==null?void 0:n.noKernelTun)!=null?p:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:Su.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(n=>Number(n)).filter(n=>!Number.isNaN(n)):void 0,peers:je.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},T(ir,"Peer",class extends je{constructor(i="",c="",u=["0.0.0.0/0","::/0"],m="",g=0){super();T(this,"publicKey");T(this,"psk");T(this,"allowedIPs");T(this,"endpoint");T(this,"keepAlive");this.publicKey=i!=null?i:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=m!=null?m:"",this.keepAlive=g!=null?g:0}static fromJson(i={}){var c,u,m,g;return new Oe.WireguardSettings.Peer((c=i==null?void 0:i.publicKey)!=null?c:"",(u=i==null?void 0:i.preSharedKey)!=null?u:"",Array.isArray(i==null?void 0:i.allowedIPs)?i.allowedIPs:["0.0.0.0/0","::/0"],(m=i==null?void 0:i.endpoint)!=null?m:"",(g=i==null?void 0:i.keepAlive)!=null?g:0)}toJson(){var i;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(i=this.allowedIPs)!=null&&i.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),ir));class ts{static sizeFormat(a){if(a<=0||Number.isNaN(a))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let o=0,n=a;for(;n>=1024&&o<r.length-1;)n/=1024,o++;return`${n.toFixed(2)} ${r[o]}`}}const xu=V(Ns,{baseStyle:{w:4,h:4}}),ku=V(ha,{baseStyle:{w:4,h:4}}),wu=V(Ml,{baseStyle:{w:4,h:4}}),vu=V(Ri,{baseStyle:{w:4,h:4}}),gi=1024*1024*1024,jr=t=>{if(t&&typeof t=="object"&&"message"in t){const a=t.message;return typeof a=="string"?a:void 0}},pi=({isOpen:t,onClose:a,node:r,mutate:o,isLoading:n,isAddMode:l=!1})=>{var be,Ie,le,ge,G,Q,w,me,xe,$,y,x,A,ie;const{t:i}=Ne(),c=Rt(),[u,m]=d.exports.useState(l),{fetchNodesUsage:g}=Qs(),[p,D]=d.exports.useState(null),{data:I,isLoading:k}=vr({queryKey:"node-settings",queryFn:()=>we("/node/settings")}),f=O=>{if(O==null)return null;const ue=O/gi;return Number.isFinite(ue)?Math.round(ue*100)/100:null},v=O=>O==null?null:Math.round(O*gi),N=l?{...hn(),add_as_new_host:!1}:{...hn(),...r,add_as_new_host:!1},M=or({resolver:Ln(fu),defaultValues:{...N,data_limit:f((be=N.data_limit)!=null?be:null)}}),j=(Ie=I==null?void 0:I.certificate)!=null?Ie:"",{onCopy:C,hasCopied:B}=ji(j);d.exports.useEffect(()=>{var O;if(t){const ue=l?{...hn(),add_as_new_host:!1}:{...hn(),...r,add_as_new_host:!1};M.reset({...ue,data_limit:f((O=ue.data_limit)!=null?O:null)}),m(l&&!!j)}},[t,l,r,M,j]),d.exports.useEffect(()=>{!l&&r&&t?g({start:Te().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(O=>{const ue=O.usages[r.id];ue&&D({uplink:ue.uplink,downlink:ue.downlink})}):D(null)},[r,l,t,g]);const re=M.handleSubmit(O=>{var ve;const ue={...O,data_limit:v((ve=O.data_limit)!=null?ve:null)};o(ue)}),_=()=>{!j||(C(),c({title:i("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},K=()=>{if(!j)return;const O=new Blob([j],{type:"text/plain"}),ue=URL.createObjectURL(O),ve=document.createElement("a");ve.href=ue,ve.download="ssl_client_cert.pem",ve.click(),URL.revokeObjectURL(ue)},pe=()=>{m(!1),D(null),a()};return s(Dt,{isOpen:t,onClose:pe,size:"lg",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",as:"form",onSubmit:re,children:[e(ct,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(l?"nodes.addNewMarzbanNode":"nodes.editNode")})}),e(xt,{mt:3}),e(at,{children:s(De,{spacing:6,children:[!l&&p&&s(De,{spacing:2,children:[e(h,{fontWeight:"medium",children:i("nodes.usage")}),s(P,{children:[s(St,{colorScheme:"green",children:[i("nodes.uplink"),": ",ts.sizeFormat(p.uplink)]}),s(St,{colorScheme:"blue",children:[i("nodes.downlink"),": ",ts.sizeFormat(p.downlink)]})]})]}),l&&s(De,{spacing:3,children:[s(P,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:i("nodes.certificate")}),s(P,{spacing:2,children:[e(te,{size:"xs",variant:"outline",leftIcon:e(wu,{}),onClick:_,isDisabled:!j,children:i(B?"copied":"copy")}),e(te,{size:"xs",variant:"outline",leftIcon:e(vu,{}),onClick:K,isDisabled:!j,children:i("nodes.download-certificate")}),e(et,{placement:"top",label:i(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(Ee,{"aria-label":i(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>m(O=>!O),size:"xs",variant:"ghost",children:u?e(ku,{}):e(xu,{})})})]})]}),e(An,{in:u&&!!j,animateOpacity:!0,children:e(z,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:j||(k?i("loading"):"")})}),!j&&!k&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:i("nodes.certificateUnavailable","Certificate not available.")})]}),s(De,{spacing:4,children:[s(ot,{columns:{base:1,md:2},spacing:4,children:[e(F,{children:e(Ut,{label:i("nodes.nodeName"),size:"sm",placeholder:"Marzban-S2",...M.register("name"),error:jr((ge=(le=M.formState)==null?void 0:le.errors)==null?void 0:ge.name)})}),e(F,{children:e(Ut,{label:i("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...M.register("address"),error:jr((Q=(G=M.formState)==null?void 0:G.errors)==null?void 0:Q.address)})})]}),s(ot,{columns:{base:1,md:2},spacing:4,children:[e(F,{children:e(Ut,{label:i("nodes.nodePort"),size:"sm",placeholder:"62050",...M.register("port"),error:jr((me=(w=M.formState)==null?void 0:w.errors)==null?void 0:me.port)})}),e(F,{children:e(Ut,{label:i("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...M.register("api_port"),error:jr(($=(xe=M.formState)==null?void 0:xe.errors)==null?void 0:$.api_port)})})]}),e(F,{children:e(Ut,{label:i("nodes.usageCoefficient"),size:"sm",placeholder:"1",...M.register("usage_coefficient"),error:jr((x=(y=M.formState)==null?void 0:y.errors)==null?void 0:x.usage_coefficient)})}),s(F,{children:[e(Ut,{label:i("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:i("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...M.register("data_limit",{setValueAs:O=>{if(O===""||O===null||O===void 0)return null;const ue=Number(O);return Number.isFinite(ue)?ue:Number.NaN},validate:O=>O==null?!0:Number.isNaN(O)?i("nodes.dataLimitValidation","Data limit must be a valid number"):O>=0||i("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:jr((ie=(A=M.formState)==null?void 0:A.errors)==null?void 0:ie.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:i("nodes.dataLimitHint","Leave empty for unlimited data.")})]})]}),l&&e(z,{children:e(Lr,{...M.register("add_as_new_host"),children:i("nodes.addHostForEveryInbound")})})]})}),s(kt,{gap:3,children:[e(te,{variant:"outline",onClick:pe,children:i("cancel")}),e(te,{type:"submit",colorScheme:"primary",isLoading:n,children:i(l?"nodes.addNode":"nodes.editNode")})]})]})]})},Cu=({deleteCallback:t})=>{const{deleteNode:a,deletingNode:r,setDeletingNode:o}=Qs(),{t:n}=Ne(),l=Rt(),i=ba(),c=()=>{o(null)},{isLoading:u,mutate:m}=cr(a,{onSuccess:()=>{Pt(n("deleteNode.deleteSuccess",{name:r&&r.name}),l),o(null),i.invalidateQueries(rr),t&&t()},onError:g=>{Wt(g,l)}});return s(Dt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(Vr,{color:"red",children:e(Gs,{})})}),e(xt,{mt:3}),s(at,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:n("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Nn,{components:{b:e("b",{})},children:n("deleteNode.prompt",{name:r.name})})})]}),s(kt,{display:"flex",children:[e(te,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:n("cancel")}),e(te,{size:"sm",w:"full",colorScheme:"red",onClick:()=>m(),leftIcon:u?e(lt,{size:"xs"}):void 0,children:n("delete")})]})]})]})},_u=10,Du=({isOpen:t,title:a,description:r,currentVersion:o,allowPersist:n=!1,isSubmitting:l,onSubmit:i,onClose:c})=>{const{t:u}=Ne(),[m,g]=d.exports.useState(""),[p,D]=d.exports.useState(!1),[I,k]=d.exports.useState(null),f=vr(["core-xray-releases"],()=>we("/core/xray/releases",{query:{limit:_u}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(g(o||""),D(!1),k(null))},[t,o]);const v=d.exports.useMemo(()=>{var B,re;return(re=(B=f.data)==null?void 0:B.tags)!=null?re:[]},[f.data]),N=B=>{g(B.target.value)},M=B=>{g(B.target.value)},j=async()=>{if(!m){k(u("validation.required"));return}try{k(null),await i({version:m,persist:n?p:void 0})}catch(B){B instanceof Error?k(B.message):k(u("core.generalErrorMessage"))}},C=f.isLoading;return s(Dt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(nt,{}),s(At,{children:[e(ct,{children:a}),e(xt,{}),e(at,{children:s(De,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),s(F,{children:[e(H,{children:u("nodes.coreVersionDialog.latestReleases")}),e(Ge,{placeholder:u(C?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:m&&v.includes(m)?m:"",onChange:N,isDisabled:C||v.length===0,size:"sm",children:v.map(B=>e("option",{value:B,children:B},B))}),C&&s(De,{direction:"row",align:"center",spacing:2,mt:2,children:[e(lt,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),f.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),s(F,{isRequired:!0,children:[e(H,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(de,{value:m,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:M,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),n&&e(Lr,{isChecked:p,onChange:B=>D(B.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),I&&s(hr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(mr,{}),e(as,{children:I})]})]})}),s(kt,{children:[e(te,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(te,{colorScheme:"primary",onClick:j,isLoading:l,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},fi="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",Au=V(eo,{baseStyle:{w:3.5,h:3.5}}),Iu=V(Yr,{baseStyle:{w:3.5,h:3.5}}),Eu=V(fr,{baseStyle:{w:4,h:4}}),Tu=({isOpen:t,title:a,isSubmitting:r,showMasterOptions:o=!1,defaultTemplateIndexUrl:n,onSubmit:l,onClose:i})=>{const{t:c}=Ne(),[u,m]=d.exports.useState("template"),[g,p]=d.exports.useState(fi),[D,I]=d.exports.useState(""),[k,f]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[v,N]=d.exports.useState(!0),[M,j]=d.exports.useState(!1),[C,B]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(m("template"),p(n||fi),I(""),f([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),N(!0),j(!1),B(null))},[t,n]);const re=vr(["geo-templates",g],()=>we("/core/geo/templates",{query:g?{index_url:g}:void 0}),{enabled:t&&u==="template"&&Boolean(g),staleTime:10*60*1e3}),_=d.exports.useMemo(()=>{var G,Q;return(Q=(G=re.data)==null?void 0:G.templates)!=null?Q:[]},[re.data]);d.exports.useEffect(()=>{_.length>0&&I(G=>G||_[0].name)},[_]);const K=qe("gray.50","whiteAlpha.50"),pe=()=>{f(G=>[...G,{name:"",url:""}])},be=(G,Q,w)=>{f(me=>me.map((xe,$)=>$===G?{...xe,[Q]:w}:xe))},Ie=G=>{f(Q=>Q.filter((w,me)=>me!==G))},le=async()=>{const G=u==="manual"?k.filter(w=>w.name.trim()&&w.url.trim()):[];if(u==="template"){if(!g.trim()){B(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!D){B(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(G.length===0){B(c("nodes.geoDialog.errors.missingFiles"));return}if(G.find(me=>!me.name.trim()||!me.url.trim())){B(c("nodes.geoDialog.errors.invalidFile"));return}}B(null);const Q=u==="manual"?G:[];try{await l({mode:u,templateIndexUrl:g.trim(),templateName:D,files:Q,persistEnv:v,applyToNodes:M})}catch(w){const me=w instanceof Error?w.message:c("nodes.geoDialog.genericError");B(me)}},ge=()=>s(De,{spacing:3,bg:K,p:4,borderRadius:"md",children:[k.map((G,Q)=>s(z,{borderWidth:"1px",borderRadius:"md",p:3,children:[s(ot,{columns:{base:1,md:2},spacing:3,children:[s(F,{isRequired:!0,children:[e(H,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(de,{size:"sm",value:G.name,placeholder:"geosite.dat",onChange:w=>be(Q,"name",w.target.value)})]}),s(F,{isRequired:!0,children:[e(H,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(de,{size:"sm",value:G.url,placeholder:"https://example.com/geosite.dat",onChange:w=>be(Q,"url",w.target.value)})]})]}),e(P,{justify:"flex-end",mt:3,children:e(et,{label:c("nodes.geoDialog.removeFile"),children:e(Ee,{"aria-label":"remove file",icon:e(Au,{}),variant:"ghost",size:"sm",onClick:()=>Ie(Q),isDisabled:k.length<=1})})})]},`manual-file-${Q}`)),e(te,{onClick:pe,leftIcon:e(Iu,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return s(Dt,{isOpen:t,onClose:i,size:"xl",isCentered:!0,children:[e(nt,{}),s(At,{children:[e(ct,{children:a}),e(xt,{}),e(at,{children:s(De,{spacing:4,children:[s(F,{as:"fieldset",children:[e(H,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(na,{value:u,onChange:G=>m(G),children:s(P,{spacing:4,children:[e(Er,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Er,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?s(De,{spacing:3,children:[s(F,{isRequired:!0,children:[e(H,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(de,{size:"sm",value:g,onChange:G=>p(G.target.value)})]}),s(F,{isRequired:!0,children:[e(H,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),s(P,{align:"center",spacing:2,children:[e(Ge,{size:"sm",flex:1,value:D,onChange:G=>I(G.target.value),isDisabled:re.isLoading||!_.length,placeholder:re.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:_.map(G=>e("option",{value:G.name,children:G.name},G.name))}),e(et,{label:c("nodes.geoDialog.refreshTemplates"),children:e(Ee,{"aria-label":"refresh templates",icon:e(Eu,{}),size:"sm",variant:"outline",onClick:()=>re.refetch(),isLoading:re.isFetching,isDisabled:!g.trim()})})]})]}),re.isError&&s(hr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(mr,{}),e(as,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):ge(),o&&s(De,{spacing:2,children:[e(Lr,{isChecked:v,onChange:G=>N(G.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(Lr,{isChecked:M,onChange:G=>j(G.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),C&&s(hr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(mr,{}),e(as,{children:C})]})]})}),s(kt,{children:[e(te,{variant:"ghost",mr:3,onClick:i,children:c("cancel")}),e(te,{colorScheme:"primary",onClick:le,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};Te.extend(qs);const zu=V(Yr,{baseStyle:{w:4,h:4}}),Lu=V(Pr,{baseStyle:{w:4,h:4}}),Pu=V(ms,{baseStyle:{w:4,h:4}}),bi=V(fr,{baseStyle:{w:4,h:4}}),Nu=V(Fi,{baseStyle:{w:4,h:4}}),_o=1024**3,Uu=t=>{if(t==null)return"";const a=t/_o;return Number.isFinite(a)?(Math.round(a*100)/100).toString():""},yi=t=>{const a=t.trim();if(!a)return null;const r=Number(a);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*_o)},Ru=()=>{var ka,wa,va,Ca,_a,Da,Aa,Ia,Ea,Ta,za,La,Pa;const{t}=Ne(),{onEditingNodes:a}=tt(),r=tt(ce=>ce.isEditingNodes),{data:o,isLoading:n,error:l,refetch:i,isFetching:c}=xa(),{addNode:u,updateNode:m,reconnectNode:g,resetNodeUsage:p,updateMasterNode:D,resetMasterUsage:I,setDeletingNode:k}=Qs(),f=ba(),v=Rt(),[N,M]=d.exports.useState(null),[j,C]=d.exports.useState(!1),[B,re]=d.exports.useState(""),[_,K]=d.exports.useState(null),[pe,be]=d.exports.useState(null),[Ie,le]=d.exports.useState(null),[ge,G]=d.exports.useState(null),[Q,w]=d.exports.useState(!1),[me,xe]=d.exports.useState(!1),[$,y]=d.exports.useState(!1),[x,A]=d.exports.useState(null),[ie,O]=d.exports.useState({}),[ue,ve]=d.exports.useState(null),[ze,Me]=d.exports.useState(null),{isOpen:q,onOpen:ye,onClose:_e}=Gt(),Be=d.exports.useRef(null),[Ve,Ze]=d.exports.useState(""),[dt,oe]=d.exports.useState(!1),{isOpen:he,onOpen:Z,onClose:ne}=Gt(),ht=d.exports.useRef(null),{data:Je,isLoading:J,refetch:E,error:ae}=vr(["core-stats"],()=>we("/core"),{refetchOnWindowFocus:!1}),{data:fe,isLoading:Ue,error:Ke,refetch:rt}=vr(["master-node-state"],()=>we("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(a(!0),()=>{a(!1)}),[a]),d.exports.useEffect(()=>{var ft,Ye;if(!fe)return;if(dt){const Xe=yi(Ve),ut=(ft=fe.data_limit)!=null?ft:null;if(Xe!==ut)return}const ce=Uu((Ye=fe.data_limit)!=null?Ye:null);Ze(ce),dt&&oe(!1)},[fe,dt,Ve]);const{isLoading:bt,mutate:Tt}=cr(u,{onSuccess:()=>{Pt(t("nodes.addNodeSuccess"),v),f.invalidateQueries(rr),C(!1)},onError:ce=>{Wt(ce,v)}}),{isLoading:W,mutate:ke}=cr(m,{onSuccess:()=>{Pt(t("nodes.nodeUpdated"),v),f.invalidateQueries(rr),M(null)},onError:ce=>{Wt(ce,v)}}),{isLoading:He,mutate:st}=cr(g,{onSuccess:()=>{f.invalidateQueries(rr)}}),{mutate:yt,isLoading:zt}=cr(m,{onSuccess:()=>{f.invalidateQueries(rr)},onError:ce=>{Wt(ce,v)},onSettled:(ce,ft,Ye)=>{(Ye==null?void 0:Ye.id)!=null&&O(Xe=>{const ut={...Xe};return delete ut[Ye.id],ut}),A(null)}}),{isLoading:er,mutate:Jt}=cr(p,{onSuccess:()=>{Pt(t("nodes.resetUsageSuccess","Node usage reset"),v),f.invalidateQueries(rr)},onError:ce=>{Wt(ce,v)},onSettled:()=>{ve(null),Me(null),_e()}}),{isLoading:Mt,mutate:Lt}=cr(D,{onSuccess:()=>{Pt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),v),rt(),oe(!1)},onError:ce=>{Wt(ce,v)}}),{isLoading:pt,mutate:Vt}=cr(I,{onSuccess:()=>{Pt(t("nodes.resetMasterUsageSuccess","Master usage reset"),v),rt(),ne()},onError:ce=>{Wt(ce,v)}}),It=d.exports.useMemo(()=>yi(Ve),[Ve]),tr=(ka=fe==null?void 0:fe.data_limit)!=null?ka:null,U=It===void 0,ee=It!==void 0&&It!==tr,L=J||Ue,b=d.exports.useMemo(()=>{if(ae instanceof Error)return ae.message;if(typeof ae=="string")return ae;if(Ke instanceof Error)return Ke.message;if(typeof Ke=="string")return Ke},[ae,Ke]),S=(wa=fe==null?void 0:fe.total_usage)!=null?wa:0,R=(va=fe==null?void 0:fe.data_limit)!=null?va:null,Ae=(Ca=fe==null?void 0:fe.remaining_data)!=null?Ca:null,Re=fe!=null&&fe.updated_at?Te(fe.updated_at).local().format("YYYY-MM-DD HH:mm"):null,Qe=(_a=fe==null?void 0:fe.status)!=null?_a:"error",Ce=Fe(S,2),We=R!==null&&R>0?Fe(R,2):t("nodes.unlimited","Unlimited"),mt=Ae!=null?Fe(Ae,2):null,$e=ce=>{oe(!0),Ze(ce)},Kt=()=>{if(U||It===void 0){Wt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),v);return}Lt({data_limit:It!=null?It:null})},Zt=()=>{oe(!0),Ze(""),Lt({data_limit:null})},Xs=()=>{Z()},js=ce=>{if(!(ce!=null&&ce.id))return;const ft=ce.status!=="disabled",Ye=ft?"disabled":"connecting",Xe=ce.id;A(Xe),O(ut=>({...ut,[Xe]:!ft})),yt({...ce,status:Ye})},en=ce=>{!(ce!=null&&ce.id)||(Me(ce),ye())},tn=()=>{!(ze!=null&&ze.id)||(ve(ze.id),Jt(ze))},ps=()=>{Me(null),_e()},Rr=()=>K(null),Gr=()=>be(null),rn=async({version:ce,persist:ft})=>{var Ye;if(!!_){if(_.type==="master"){w(!0);try{await we("/core/xray/update",{method:"POST",body:{version:ce,persist_env:Boolean(ft)}}),Pt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:ce}),v),await Promise.all([E(),f.invalidateQueries(rr)]),Rr()}catch(Xe){Wt(Xe,v)}finally{w(!1)}return}if(_.type==="bulk"){const Xe=(o!=null?o:[]).filter(ut=>ut.id!=null&&ut.status==="connected");if(Xe.length===0){v({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}xe(!0);try{const ut=[];for(const Fr of Xe)try{await we(`/node/${Fr.id}/xray/update`,{method:"POST",body:{version:ce}}),ut.push({status:"fulfilled",node:Fr})}catch(un){ut.push({status:"rejected",node:Fr}),Wt(un,v)}const Dr=ut.filter(Fr=>Fr.status==="fulfilled").length,Or=ut.length-Dr,Wr=ut.length;Dr>0&&Pt(t("nodes.coreVersionDialog.bulkSuccess",{success:Dr,total:Wr}),v),Or>0&&v({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:Or,total:Wr}),status:"error",isClosable:!0,position:"top",duration:4e3}),f.invalidateQueries(rr),Rr()}finally{xe(!1)}return}if(_.type==="node"){const Xe=_.node;if(!(Xe!=null&&Xe.id))return;le(Xe.id);try{await we(`/node/${Xe.id}/xray/update`,{method:"POST",body:{version:ce}}),Pt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(Ye=Xe.name)!=null?Ye:t("nodes.unnamedNode","Unnamed node"),version:ce}),v),f.invalidateQueries(rr),Rr()}catch(ut){Wt(ut,v)}finally{le(null)}}}},sn=async ce=>{var Ye;if(!pe)return;const ft={mode:ce.mode,template_index_url:ce.templateIndexUrl,template_name:ce.templateName,files:ce.files,persist_env:ce.persistEnv};if(pe.type==="master"){y(!0);try{await we("/core/geo/update",{method:"POST",body:ft}),Pt(t("nodes.geoDialog.masterUpdateSuccess"),v),Gr()}catch(Xe){Wt(Xe,v)}finally{y(!1)}return}if(pe.type==="node"){const Xe=pe.node;if(!(Xe!=null&&Xe.id))return;G(Xe.id);try{await we(`/node/${Xe.id}/geo/update`,{method:"POST",body:ft}),Pt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(Ye=Xe.name)!=null?Ye:t("nodes.unnamedNode","Unnamed node")}),v),f.invalidateQueries(rr),Gr()}catch(ut){Wt(ut,v)}finally{G(null)}}},fs=d.exports.useMemo(()=>{if(!o)return[];const ce=B.trim().toLowerCase();return ce?o.filter(ft=>{var Dr,Or,Wr;const Ye=((Dr=ft.name)!=null?Dr:"").toLowerCase(),Xe=((Or=ft.address)!=null?Or:"").toLowerCase(),ut=((Wr=ft.xray_version)!=null?Wr:"").toLowerCase();return Ye.includes(ce)||Xe.includes(ce)||ut.includes(ce)}):o},[o,B]),nn=d.exports.useMemo(()=>(o!=null?o:[]).some(ce=>ce.id!=null&&ce.status==="connected"),[o]),bs=d.exports.useMemo(()=>{if(!!l){if(l instanceof Error)return l.message;if(typeof l=="string")return l;if(typeof l=="object"&&"message"in l){const ce=l.message;if(typeof ce=="string")return ce}return t("errorOccurred")}},[l,t]),an=Boolean(bs),Zr=t("nodes.masterNode","Master"),Qr=B.trim().toLowerCase(),se=!Qr||Zr.toLowerCase().includes(Qr)||((Da=Je==null?void 0:Je.version)!=null?Da:"").toLowerCase().includes(Qr),on=(_==null?void 0:_.type)==="master"?Q:(_==null?void 0:_.type)==="node"?_.node.id!=null&&Ie===_.node.id:(_==null?void 0:_.type)==="bulk"?me:!1,Mr=(pe==null?void 0:pe.type)==="master"?$:(pe==null?void 0:pe.type)==="node"?pe.node.id!=null&&ge===pe.node.id:!1,ln=(_==null?void 0:_.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(_==null?void 0:_.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(_==null?void 0:_.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Aa=_.node.name)!=null?Aa:t("nodes.unnamedNode","Unnamed node")}):"",cn=(_==null?void 0:_.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(_==null?void 0:_.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(_==null?void 0:_.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(Ia=_.node.name)!=null?Ia:t("nodes.unnamedNode","Unnamed node")}):"",dn=(_==null?void 0:_.type)==="master"?(Ea=Je==null?void 0:Je.version)!=null?Ea:"":(_==null?void 0:_.type)==="node"&&(Ta=_.node.xray_version)!=null?Ta:"",To=(pe==null?void 0:pe.type)==="master"?t("nodes.geoDialog.masterTitle"):(pe==null?void 0:pe.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(za=pe.node.name)!=null?za:t("nodes.unnamedNode","Unnamed node")}):"";return s(X,{spacing:6,align:"stretch",children:[s(De,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),an&&s(hr,{status:"error",borderRadius:"md",children:[e(mr,{}),e(as,{children:bs})]}),s(De,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),s(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[s(P,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[s(jt,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(Hi,{pointerEvents:"none",children:e(Nu,{color:"gray.400"})}),e(de,{value:B,onChange:ce=>re(ce.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(et,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(Ee,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(bi,{}),variant:"ghost",size:"sm",onClick:()=>i(),isLoading:c})})]}),s(De,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(te,{variant:"outline",size:"sm",onClick:()=>K({type:"bulk"}),isDisabled:!nn,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(te,{leftIcon:e(zu,{}),colorScheme:"primary",size:"sm",onClick:()=>C(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),n?e(ot,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((ce,ft)=>e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:s(X,{spacing:3,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${ft}`))}):s(ot,{columns:{base:1,md:2,xl:3},spacing:4,children:[se&&e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:L?s(X,{spacing:3,align:"center",justify:"center",children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):b?s(X,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:b}),e(te,{size:"sm",variant:"outline",onClick:()=>{E(),rt()},children:t("refresh","Refresh")})]}):fe?s(X,{align:"stretch",spacing:4,children:[s(De,{spacing:2,children:[s(P,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:Zr}),e(St,{colorScheme:"purple",size:"sm",children:Je!=null&&Je.version?`Xray ${Je.version}`:t("nodes.versionUnknown","Version unknown")})]}),s(P,{spacing:2,align:"center",children:[e(hi,{status:Qe,compact:!0}),fe.limit_exceeded&&e(St,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Je!=null&&Je.started?t("nodes.masterStartedAt",{date:Te(Je.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),fe.message&&s(hr,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(mr,{}),e(as,{fontSize:"sm",children:fe.message})]}),e(On,{}),s(ot,{columns:{base:1,md:2},spacing:4,children:[s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Ce})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:We})]}),mt&&s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:mt})]}),Re&&s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:Re})]})]}),s(De,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[s(jt,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(de,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:Ve,onChange:ce=>$e(ce.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(nr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(te,{colorScheme:"primary",size:"sm",onClick:Kt,isDisabled:!ee||U||Mt,isLoading:Mt,children:t("save","Save")}),e(te,{variant:"ghost",size:"sm",onClick:Zt,isDisabled:R===null||Mt,isLoading:Mt&&R===null,children:t("nodes.clearDataLimit","Clear limit")})]}),U&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),s(De,{direction:{base:"column",sm:"row"},spacing:2,children:[e(te,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>K({type:"master"}),isLoading:Q,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(te,{size:"sm",variant:"outline",onClick:()=>be({type:"master"}),isLoading:$,children:t("nodes.geoDialog.updateMasterButton")}),e(te,{size:"sm",variant:"outline",colorScheme:"red",onClick:Xs,isLoading:pt,children:t("nodes.resetUsage","Reset usage")})]})]}):s(X,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(te,{size:"sm",variant:"outline",onClick:()=>{E(),rt()},children:t("refresh","Refresh")})]})},"master-node"),fs.length>0?fs.map(ce=>{var un,Na,Ua,Ra;const ft=ce.status||"error",Ye=ce==null?void 0:ce.id,Xe=ft!=="disabled"&&ft!=="limited",ut=Ye!=null?ie[Ye]:void 0,Dr=ut!=null?ut:Xe,Or=Ye!=null&&x===Ye&&zt,Wr=Ye!=null&&Ie===Ye,Fr=Ye!=null&&ge===Ye;return e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:s(X,{align:"stretch",spacing:4,children:[s(De,{spacing:2,children:[s(P,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:ce.name||t("nodes.unnamedNode","Unnamed node")}),e(Ct,{size:"sm",colorScheme:"primary",isChecked:Dr,onChange:()=>js(ce),isDisabled:Or,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),ce.status==="error"&&e(te,{size:"sm",variant:"outline",leftIcon:e(bi,{}),onClick:()=>st(ce),isLoading:He,children:t("nodes.reconnect")})]}),s(P,{spacing:2,flexWrap:"wrap",children:[e(hi,{status:ft,compact:!0}),s(P,{spacing:1,align:"center",children:[e(St,{colorScheme:"blue",size:"sm",children:ce.xray_version?`Xray ${ce.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(te,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>Ye&&K({type:"node",node:ce}),isLoading:Wr,isDisabled:!Ye,children:t("nodes.updateCoreAction")})]}),e(te,{size:"xs",variant:"ghost",onClick:()=>Ye&&be({type:"node",node:ce}),isLoading:Fr,isDisabled:!Ye,children:t("nodes.updateGeoAction","Update geo")}),e(te,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>en(ce),isLoading:er&&Ye!=null&&ue===Ye,isDisabled:!Ye,children:t("nodes.resetUsage","Reset usage")})]}),ft==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(On,{}),s(ot,{columns:{base:1,sm:2},spacingY:2,children:[s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:ce.address})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:ce.port})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:ce.api_port})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:ce.usage_coefficient})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Fe(((un=ce.uplink)!=null?un:0)+((Na=ce.downlink)!=null?Na:0),2)})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:ce.data_limit!=null&&ce.data_limit>0?Fe(ce.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(On,{}),s(P,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[s(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(Ua=ce.id)!=null?Ua:"-"]}),s(Bi,{size:"sm",variant:"ghost",children:[e(Ee,{"aria-label":t("edit"),icon:e(Pu,{}),onClick:()=>M(ce)}),e(Ee,{"aria-label":t("delete"),icon:e(Lu,{}),colorScheme:"red",onClick:()=>k(ce)})]})]})]})},(Ra=ce.id)!=null?Ra:ce.name)}):e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(Du,{isOpen:Boolean(_),onClose:Rr,onSubmit:rn,currentVersion:dn,title:ln,description:cn,allowPersist:(_==null?void 0:_.type)==="master",isSubmitting:on}),e(Tu,{isOpen:Boolean(pe),onClose:Gr,onSubmit:sn,title:To,showMasterOptions:(pe==null?void 0:pe.type)==="master",isSubmitting:Mr}),e(Us,{isOpen:q,leastDestructiveRef:Be,onClose:ps,children:e(nt,{children:s(Rs,{children:[e(ct,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(at,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(Pa=(La=ze==null?void 0:ze.name)!=null?La:ze==null?void 0:ze.address)!=null?Pa:t("nodes.thisNode","this node")})}),s(kt,{children:[e(te,{ref:Be,onClick:ps,children:t("cancel","Cancel")}),e(te,{colorScheme:"red",onClick:tn,ml:3,isLoading:er,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Us,{isOpen:he,leastDestructiveRef:ht,onClose:ne,children:e(nt,{children:s(Rs,{children:[e(ct,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(at,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:Zr})}),s(kt,{children:[e(te,{ref:ht,onClick:ne,children:t("cancel","Cancel")}),e(te,{colorScheme:"red",onClick:()=>Vt(),ml:3,isLoading:pt,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(pi,{isOpen:j,onClose:()=>C(!1),mutate:Tt,isLoading:bt,isAddMode:!0}),e(pi,{isOpen:!!N,onClose:()=>M(null),node:N||void 0,mutate:ke,isLoading:W}),e(Cu,{deleteCallback:()=>f.invalidateQueries(rr)})]})},Mu=hs(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([we("/core").then(({version:a,started:r,logs_websocket:o})=>{t({version:a,started:r,logs_websocket:o})}).catch(a=>{throw console.error("Error fetching /core:",a),a}),we("/core/config").then(a=>{t({config:a})}).catch(a=>{throw console.error("Error fetching /core/config:",a),a})])}finally{t({isLoading:!1})}},updateConfig:a=>(t({isPostLoading:!0}),we("/core/config",{method:"PUT",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>we("/core/restart",{method:"POST"})}));const la=d.exports.forwardRef(({json:t,onChange:a,mode:r="code"},o)=>{const{colorMode:n}=Ur(),l=d.exports.useMemo(()=>n==="dark"?"ace/theme/one_dark":"ace/theme/github",[n]),i=d.exports.useRef(null),c=d.exports.useRef(null),u=d.exports.useRef(a);d.exports.useEffect(()=>{u.current=a},[a]),d.exports.useEffect(()=>{c.current=new Ol(i.current,{mode:r,onChangeText:I=>u.current(I),statusBar:!1,mainMenuBar:!1,theme:l});const D=c.current.aceEditor;return D&&D.setOptions({fontSize:13,fontFamily:"JetBrains Mono, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace",showPrintMargin:!1,highlightActiveLine:!0}),()=>{var I;(I=c.current)==null||I.destroy(),c.current=null}},[]),d.exports.useEffect(()=>{!c.current||c.current.update(t)},[t]),d.exports.useEffect(()=>{!c.current||c.current.setMode(r)},[r]),d.exports.useEffect(()=>{var I;const D=(I=c.current)==null?void 0:I.aceEditor;D&&D.setTheme(l)},[l]);const m=qe("gray.300","whiteAlpha.300"),g=qe("surface.light","surface.dark"),p=qe("sm","none");return e(z,{ref:o,border:"1px solid",borderColor:m,bg:g,borderRadius:"lg",h:"full",boxShadow:p,overflow:"hidden",children:e(z,{height:"full",ref:i})})}),Ou=V(Bs,{baseStyle:{w:4,h:4}}),Wu=V(Ki,{baseStyle:{w:4,h:4}}),Do=({triggerLabel:t,title:a,children:r})=>{const o=Xt({base:!0,md:!1});return s(Vs,{placement:o?"bottom":"right",isLazy:!0,children:[e($s,{children:e(te,{size:"xs",variant:"outline",children:t!=null?t:e(Ou,{})})}),s(Js,{children:[e(Ks,{}),e(Xi,{}),a&&e(Wl,{fontWeight:"semibold",children:a}),e(Ys,{children:r})]})]})},Fu=({chips:t,color:a="blue"})=>{const r=t[0],o=t.slice(1);return s(P,{spacing:2,align:"center",children:[r?e(St,{size:"sm",colorScheme:a,children:r}):e(h,{color:"gray.400",children:"-"}),o.length>0&&e(Do,{triggerLabel:s(St,{size:"sm",children:["+",o.length]}),title:"Details",children:e(X,{align:"stretch",children:t.map((n,l)=>e(P,{justify:"space-between",children:e(h,{children:n})},l))})})]})},Hu=({text:t,label:a})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:o,onCopy:n}=ji(t!=null?t:"");return e(P,{spacing:2,align:"center",children:e(Do,{triggerLabel:r,title:a,children:s(X,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),s(P,{children:[e(Ee,{"aria-label":"copy",size:"sm",icon:e(Wu,{}),onClick:n}),e(h,{fontSize:"sm",children:o?"Copied":"Copy"})]})]})})})},Si=500,Bu=t=>{try{let a=new URL({}.VITE_BASE_API.startsWith("/")?window.location.origin+{}.VITE_BASE_API:{}.VITE_BASE_API);return(a.protocol==="https:"?"wss://":"ws://")+Pi([a.host+a.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+In()}catch(a){return console.error("Unable to generate websocket url"),console.error(a),null}},Ao=({showTitle:t=!0})=>{const{t:a}=Ne(),{data:r}=xa(),[o,n]=d.exports.useState(""),[l,i]=d.exports.useState([]),c=d.exports.useRef(null),[u,m]=d.exports.useState(!0),{colorMode:g}=Ur(),p=C=>{if(C!==o){if(!C){n(""),i([]);return}n(C),i([])}},D=d.exports.useCallback(Fl.exports.debounce(C=>{i(B=>B.length>=Si?[...B.slice(B.length-Si+1),C]:[...B,C])},50),[]);d.exports.useEffect(()=>()=>{D.cancel()},[D]);const{readyState:I}=Hl(Bu(o),{onMessage:C=>{var B;D((B=C.data)!=null?B:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const C=c.current;if(!C)return;const B=()=>{const _=C.scrollHeight-C.scrollTop-C.clientHeight<=32;m(_)};return C.addEventListener("scroll",B),B(),()=>{C.removeEventListener("scroll",B)}},[]),d.exports.useEffect(()=>{u&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[l,u]);const k=d.exports.useMemo(()=>{const C=g==="dark";return{error:{bg:C?"rgba(248, 113, 113, 0.16)":"red.50",color:C?"#fed7d7":"#c53030",border:C?"#f87171":"#feb2b2"},warn:{bg:C?"rgba(251, 191, 36, 0.18)":"orange.50",color:C?"#fefcbf":"#975a16",border:C?"#fbbf24":"#f6ad55"},info:{bg:C?"rgba(96, 165, 250, 0.18)":"blue.50",color:C?"#bfdbfe":"#1a56db",border:C?"#60a5fa":"#63b3ed"},debug:{bg:C?"rgba(148, 163, 184, 0.16)":"gray.100",color:C?"#e2e8f0":"#1f2933",border:C?"#94a3b8":"#cbd5e1"},default:{bg:C?"rgba(30, 64, 175, 0.1)":"gray.50",color:C?"#e2e8f0":"#1f2933",border:C?"#475569":"#e2e8f0"}}},[g]),f=qe("#f5f7fb","#1f2329"),v=qe("gray.200","gray.600"),N=qe("gray.500","gray.400"),M=qe("white","gray.700"),j=C=>/error|failed|exception/i.test(C)?"error":/warn/i.test(C)?"warn":/info/i.test(C)?"info":/debug/i.test(C)?"debug":"default";return s(X,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:a("header.xrayLogs")}),s(De,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[s(De,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(r==null?void 0:r[0])&&s(Ge,{size:"sm",w:{base:"full",sm:"auto"},bg:M,onChange:C=>p(C.target.value),value:o,children:[e("option",{value:"",children:a("core.master")}),r.map(C=>e("option",{value:String(C.id),children:a(C.name)},C.address))]}),e(h,{fontSize:"sm",color:N,children:a(`core.socket.${I}`)})]}),e(h,{fontSize:"xs",color:N,children:u?a("core.autoScrollOn","Auto-scroll: On"):a("core.autoScrollOff","Auto-scroll: Off")})]}),e(z,{border:"1px solid",borderColor:v,bg:f,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:c,fontFamily:"mono",fontSize:"sm",children:e(X,{align:"stretch",spacing:2,children:l.map((C,B)=>{var K;const re=j(C),_=(K=k[re])!=null?K:k.default;return e(z,{bg:_.bg,color:_.color,borderLeftWidth:3,borderLeftColor:_.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(V.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:C})},`${C}-${B}`)})})})]})},Vu=V(Yr),$u=V(eo),$t={tag:"",protocol:Y.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:xo.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},ks=t=>{const a={},r=t.address||void 0,o=Number(t.port)||void 0;switch(t.protocol){case Y.VMess:a.vnext=[{address:r,port:o,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case Y.VLESS:a.vnext=[{address:r,port:o,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case Y.Trojan:a.servers=[{address:r,port:o,password:t.password||void 0}];break;case Y.Shadowsocks:a.servers=[{address:r,port:o,password:t.password||void 0,method:t.method||void 0}];break;case Y.Socks:case Y.HTTP:a.servers=[{address:r,port:o,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case Y.Freedom:a.domainStrategy=t.freedomStrategy||void 0;break;case Y.Blackhole:a.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case Y.DNS:a.network=t.dnsNetwork,a.address=t.dnsAddress||void 0,a.port=Number(t.dnsPort)||void 0;break;case Y.Wireguard:a.secretKey=t.wireguardSecret||void 0,a.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,a.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const n=new zr;n.network=t.network,n.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?n.tcp=new wr(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?n.ws=new $r(t.wsPath,t.wsHost,0):t.network==="grpc"&&(n.grpc=new Jr(t.grpcServiceName,"",!1)),t.tlsEnabled&&(n.tls=new Kr(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(n.reality=new us(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const i=new Ot(t.tag,t.protocol,a,n,void 0).toJson();return i.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(i.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),i},Ju=({isOpen:t,onClose:a,form:r,setOutboundData:o})=>{const{t:n}=Ne(),l=Rt(),i=qe("gray.50","whiteAlpha.100"),{control:c,register:u,reset:m,handleSubmit:g,watch:p,getValues:D,setValue:I,formState:{isValid:k}}=or({defaultValues:$t,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{u("tlsEnabled"),u("realityEnabled")},[u]);const{fields:f,append:v,remove:N}=Bl({control:c,name:"wireguardPeers"}),M=p("protocol"),j=p("network"),C=p("tlsEnabled"),B=p("realityEnabled"),re=p("tcpType"),_=p("muxEnabled"),K=n("validation.required",{defaultValue:"Required"}),pe=n("validation.invalidPort",{defaultValue:"Invalid port"}),be=M||Y.VLESS,Ie=![Y.Freedom,Y.Blackhole,Y.DNS,Y.Wireguard].includes(be),le=[Y.VMess,Y.VLESS].includes(be),ge=[Y.Trojan,Y.Shadowsocks].includes(be),G=be===Y.Shadowsocks,Q=be===Y.DNS,w=Ir({control:c}),[me,xe]=d.exports.useState(0),$=d.exports.useMemo(()=>ks($t),[]),[y,x]=d.exports.useState($),[A,ie]=d.exports.useState(()=>JSON.stringify($,null,2)),[O,ue]=d.exports.useState(null),[ve,ze]=d.exports.useState(""),Me=d.exports.useRef(!1);d.exports.useEffect(()=>{if(t){xe(0),Me.current=!0,m($t),ue(null),ze("");const oe=ks($t);x(oe);const he=JSON.stringify(oe,null,2);ie(he)}},[t,m]),d.exports.useEffect(()=>{if(!w)return;if(Me.current){Me.current=!1;return}const oe=ks(w);x(oe);const he=JSON.stringify(oe,null,2);ie(Z=>Z===he?Z:he),ue(null)},[w]);const q=d.exports.useMemo(()=>[Y.VLESS,Y.VMess,Y.Trojan,Y.Shadowsocks,Y.Socks,Y.HTTP,Y.Freedom,Y.Blackhole,Y.DNS,Y.Wireguard],[]),ye=oe=>{var ht,Je,J,E,ae,fe,Ue,Ke,rt,bt,Tt,W,ke,He,st,yt,zt,er,Jt,Mt,Lt,pt,Vt,It,tr,U,ee,L,b,S,R,Ae,Re,Qe,Ce,We,mt,$e,Kt,Zt,Xs,js,en,tn,ps,Rr,Gr,rn,sn,fs,nn,bs,an,Zr,Qr;const he=Ot.fromJson(oe),Z={...$t,tag:(ht=oe==null?void 0:oe.tag)!=null?ht:"",protocol:(he==null?void 0:he.protocol)||$t.protocol,sendThrough:(Je=oe==null?void 0:oe.sendThrough)!=null?Je:"",muxEnabled:Boolean((J=oe==null?void 0:oe.mux)==null?void 0:J.enabled),muxConcurrency:Number((ae=(E=oe==null?void 0:oe.mux)==null?void 0:E.concurrency)!=null?ae:$t.muxConcurrency)},ne=he==null?void 0:he.stream;switch(Z.network=(fe=ne==null?void 0:ne.network)!=null?fe:$t.network,Z.tlsEnabled=(ne==null?void 0:ne.security)==="tls",Z.realityEnabled=(ne==null?void 0:ne.security)==="reality",Z.tlsServerName=(Ke=(Ue=ne==null?void 0:ne.tls)==null?void 0:Ue.serverName)!=null?Ke:"",Z.realityPublicKey=(bt=(rt=ne==null?void 0:ne.reality)==null?void 0:rt.publicKey)!=null?bt:"",Z.realityShortId=(W=(Tt=ne==null?void 0:ne.reality)==null?void 0:Tt.shortId)!=null?W:"",(ne==null?void 0:ne.network)==="tcp"&&ne.tcp&&(Z.tcpType=ne.tcp.type,Z.tcpHost=(ke=ne.tcp.host)!=null?ke:"",Z.tcpPath=(He=ne.tcp.path)!=null?He:""),(ne==null?void 0:ne.network)==="ws"&&ne.ws&&(Z.wsHost=(st=ne.ws.host)!=null?st:"",Z.wsPath=(yt=ne.ws.path)!=null?yt:""),(ne==null?void 0:ne.network)==="grpc"&&ne.grpc&&(Z.grpcServiceName=(zt=ne.grpc.serviceName)!=null?zt:""),he!=null&&he.hasAddressPort()&&(Z.address=(Lt=(Mt=(er=he.settings)==null?void 0:er.address)!=null?Mt:(Jt=oe==null?void 0:oe.settings)==null?void 0:Jt.address)!=null?Lt:"",Z.port=Number((tr=(It=(pt=he.settings)==null?void 0:pt.port)!=null?It:(Vt=oe==null?void 0:oe.settings)==null?void 0:Vt.port)!=null?tr:$t.port)),Z.protocol){case Y.VMess:{const se=he.settings;Z.id=(U=se==null?void 0:se.id)!=null?U:"",Z.vnextEncryption=(ee=se==null?void 0:se.security)!=null?ee:$t.vnextEncryption,Z.address=(L=se==null?void 0:se.address)!=null?L:Z.address,Z.port=Number((b=se==null?void 0:se.port)!=null?b:Z.port);break}case Y.VLESS:{const se=he.settings;Z.id=(S=se==null?void 0:se.id)!=null?S:"",Z.flow=(R=se==null?void 0:se.flow)!=null?R:"",Z.encryption=(Ae=se==null?void 0:se.encryption)!=null?Ae:Z.encryption,Z.address=(Re=se==null?void 0:se.address)!=null?Re:Z.address,Z.port=Number((Qe=se==null?void 0:se.port)!=null?Qe:Z.port);break}case Y.Trojan:{const se=he.settings;Z.password=(Ce=se==null?void 0:se.password)!=null?Ce:"",Z.address=(We=se==null?void 0:se.address)!=null?We:Z.address,Z.port=Number((mt=se==null?void 0:se.port)!=null?mt:Z.port);break}case Y.Shadowsocks:{const se=he.settings;Z.password=($e=se==null?void 0:se.password)!=null?$e:"",Z.method=(Kt=se==null?void 0:se.method)!=null?Kt:$t.method,Z.address=(Zt=se==null?void 0:se.address)!=null?Zt:Z.address,Z.port=Number((Xs=se==null?void 0:se.port)!=null?Xs:Z.port);break}case Y.Socks:case Y.HTTP:{const se=(Z.protocol===Y.Socks,he.settings);Z.user=(js=se==null?void 0:se.user)!=null?js:"",Z.pass=(en=se==null?void 0:se.pass)!=null?en:"",Z.address=(tn=se==null?void 0:se.address)!=null?tn:Z.address,Z.port=Number((ps=se==null?void 0:se.port)!=null?ps:Z.port);break}case Y.DNS:{const se=he.settings;Z.dnsNetwork=(Rr=se==null?void 0:se.network)!=null?Rr:$t.dnsNetwork,Z.dnsAddress=(Gr=se==null?void 0:se.address)!=null?Gr:"",Z.dnsPort=Number((rn=se==null?void 0:se.port)!=null?rn:$t.dnsPort);break}case Y.Freedom:{const se=he.settings;Z.freedomStrategy=(sn=se==null?void 0:se.domainStrategy)!=null?sn:"";break}case Y.Blackhole:{const se=he.settings;Z.blackholeResponse=(fs=se==null?void 0:se.type)!=null?fs:"";break}case Y.Wireguard:{const se=he.settings;Z.wireguardSecret=(nn=se==null?void 0:se.secretKey)!=null?nn:"",Z.wireguardAddress=(bs=se==null?void 0:se.address)!=null?bs:"";const on=(Zr=(an=se==null?void 0:se.peers)==null?void 0:an.map(Mr=>{var ln,cn,dn;return{publicKey:(ln=Mr.publicKey)!=null?ln:"",allowedIPs:Array.isArray(Mr.allowedIPs)?Mr.allowedIPs.join(","):"",endpoint:(cn=Mr.endpoint)!=null?cn:"",keepAlive:Number((dn=Mr.keepAlive)!=null?dn:0)}}))!=null?Zr:[];Z.wireguardPeers=on.length>0?on:$t.wireguardPeers;break}}return((Qr=oe==null?void 0:oe.mux)==null?void 0:Qr.concurrency)!=null&&(Z.muxConcurrency=Number(oe.mux.concurrency)),(!Z.wireguardPeers||Z.wireguardPeers.length===0)&&(Z.wireguardPeers=$t.wireguardPeers),Z},_e=oe=>{ie(oe);try{const he=JSON.parse(oe);ue(null),x(he),Me.current=!0;const Z=ye(he);m(Z)}catch(he){ue(he.message)}},Be=()=>{const oe=ve.trim();if(!oe){ue(n("pages.outbound.configEmpty","Please paste a config link"));return}const he=Ot.fromLink(oe);if(!he){ue(n("pages.outbound.invalidConfig","Unsupported or invalid config link")),l({status:"error",duration:2500,position:"top",title:n("pages.outbound.configParseFailedTitle","Conversion failed"),description:n("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const Z=he.toJson(),ne=JSON.stringify(Z,null,2);ze(""),_e(ne),l({status:"success",duration:2e3,position:"top",title:n("pages.outbound.configConvertedTitle","Config converted"),description:n("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},Ve=g(oe=>{const he=ks(oe),Z=[...r.getValues("config.outbounds"),he];r.setValue("config.outbounds",Z,{shouldDirty:!0}),o(Z.map((ne,ht)=>({key:ht,...ne}))),l({title:n("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),a()}),Ze=()=>{a()},dt=oe=>{if(xe(oe),oe===1){const he=ks(D());x(he);const Z=JSON.stringify(he,null,2);ie(ne=>ne===Z?ne:Z),ue(null)}};return s(Dt,{size:"4xl",isOpen:t,onClose:Ze,scrollBehavior:"inside",children:[e(nt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),s(At,{as:"form",onSubmit:Ve,children:[e(ct,{children:n("pages.xray.outbound.addOutbound")}),e(xt,{}),e(at,{children:s(Ws,{variant:"enclosed",colorScheme:"primary",index:me,onChange:dt,children:[s(Fs,{children:[e(Ht,{children:n("form")}),e(Ht,{children:n("json")})]}),s(Hs,{children:[e(Bt,{children:s(X,{spacing:6,align:"stretch",children:[s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.basicSettings","Basic settings")}),s(X,{spacing:3,align:"stretch",children:[s(F,{isRequired:!0,children:[e(H,{children:n("pages.xray.outbound.tag")}),e(de,{size:"sm",placeholder:"outbound-tag",...u("tag",{required:K})})]}),s(P,{children:[s(F,{isRequired:!0,children:[e(H,{children:n("protocol")}),e(Ge,{size:"sm",...u("protocol"),children:q.map(oe=>e("option",{value:oe,children:oe},oe))})]}),s(F,{children:[e(H,{children:n("pages.xray.outbound.sendThrough")}),e(de,{size:"sm",placeholder:"0.0.0.0",...u("sendThrough")})]})]})]})]}),Ie&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.endpoint","Endpoint")}),s(X,{spacing:3,align:"stretch",children:[s(F,{isRequired:Ie,children:[e(H,{children:n("pages.outbound.address","Address")}),e(de,{size:"sm",placeholder:"example.com",...u("address",{required:Ie?K:!1})})]}),s(P,{children:[s(F,{isRequired:Ie,children:[e(H,{children:n("pages.outbound.port","Port")}),e(de,{size:"sm",type:"number",min:1,max:65535,...u("port",{required:Ie?K:!1,valueAsNumber:!0,min:{value:1,message:pe},max:{value:65535,message:pe}})})]}),le?s(F,{isRequired:le,children:[e(H,{children:"ID"}),e(de,{size:"sm",placeholder:"UUID",...u("id",{required:le?K:!1})})]}):ge?s(F,{isRequired:ge,children:[e(H,{children:n("password")}),e(de,{size:"sm",placeholder:"password",...u("password",{required:ge?K:!1})})]}):s(F,{children:[e(H,{children:n("username")}),e(de,{size:"sm",placeholder:"username",...u("user")})]})]}),be===Y.Shadowsocks&&s(F,{isRequired:G,children:[e(H,{children:n("pages.outbound.method","Method")}),e(Ge,{size:"sm",...u("method",{required:G?K:!1}),children:Object.values(xo).map(oe=>e("option",{value:oe,children:oe},oe))})]}),be===Y.VLESS&&s(P,{children:[s(F,{children:[e(H,{children:n("pages.outbound.encryption","Encryption")}),e(de,{size:"sm",placeholder:"none",...u("encryption")})]}),s(F,{children:[e(H,{children:"Flow"}),e(de,{size:"sm",placeholder:"xtls-rprx-vision",...u("flow")})]})]}),be===Y.VMess&&s(F,{children:[e(H,{children:n("pages.outbound.security","User security")}),e(de,{size:"sm",placeholder:"auto",...u("vnextEncryption")})]})]})]}),be===Y.DNS&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.dnsSettings","DNS settings")}),s(P,{children:[s(F,{children:[e(H,{children:n("pages.outbound.network")}),s(Ge,{size:"sm",...u("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),s(F,{isRequired:Q,children:[e(H,{children:n("pages.outbound.port")}),e(de,{size:"sm",type:"number",min:1,max:65535,...u("dnsPort",{required:Q?K:!1,valueAsNumber:!0,min:{value:1,message:pe},max:{value:65535,message:pe}})})]})]}),s(F,{mt:3,isRequired:Q,children:[e(H,{children:n("pages.outbound.address")}),e(de,{size:"sm",placeholder:"8.8.8.8",...u("dnsAddress",{required:Q?K:!1})})]})]}),be===Y.Freedom&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.freedom","Freedom options")}),s(F,{children:[e(H,{children:n("pages.outbound.strategy","Strategy")}),e(de,{size:"sm",placeholder:"UseIP",...u("freedomStrategy")})]})]}),be===Y.Blackhole&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.blackhole","Blackhole options")}),s(F,{children:[e(H,{children:n("pages.outbound.response")}),e(de,{size:"sm",placeholder:"none",...u("blackholeResponse")})]})]}),be===Y.Wireguard&&s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.wireguard","Wireguard")}),s(X,{spacing:3,align:"stretch",children:[s(F,{children:[e(H,{children:n("pages.outbound.secretKey","Secret key")}),e(de,{size:"sm",...u("wireguardSecret")})]}),s(F,{children:[e(H,{children:n("pages.outbound.address")}),e(de,{size:"sm",placeholder:"10.0.0.1/32",...u("wireguardAddress")})]}),s(X,{spacing:3,align:"stretch",children:[s(P,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:n("pages.outbound.peer","Peers")}),e(Ee,{size:"sm","aria-label":n("add"),icon:e(Vu,{boxSize:3}),onClick:()=>v({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),f.map((oe,he)=>s(z,{borderWidth:"1px",borderRadius:"md",p:3,bg:i,children:[s(P,{children:[s(F,{children:[e(H,{children:n("pages.outbound.publicKey","Public key")}),e(de,{size:"sm",...u(`wireguardPeers.${he}.publicKey`)})]}),f.length>1&&e(Ee,{mt:6,size:"sm","aria-label":n("delete"),icon:e($u,{boxSize:3}),onClick:()=>N(he)})]}),s(P,{mt:2,children:[s(F,{children:[e(H,{children:n("pages.outbound.allowedIPs","Allowed IPs")}),e(de,{size:"sm",...u(`wireguardPeers.${he}.allowedIPs`)})]}),s(F,{children:[e(H,{children:n("pages.outbound.endpoint","Endpoint")}),e(de,{size:"sm",...u(`wireguardPeers.${he}.endpoint`)})]})]}),s(F,{mt:2,children:[e(H,{children:n("pages.outbound.keepAlive","Keep alive")}),e(de,{size:"sm",type:"number",...u(`wireguardPeers.${he}.keepAlive`,{valueAsNumber:!0})})]})]},oe.id))]})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.transport","Transport")}),s(X,{spacing:3,align:"stretch",children:[s(F,{children:[e(H,{children:n("pages.outbound.network")}),s(Ge,{size:"sm",...u("network"),onChange:oe=>{u("network").onChange(oe)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),j==="tcp"&&s(P,{children:[s(F,{children:[e(H,{children:n("pages.outbound.tcpHeader","Header")}),s(Ge,{size:"sm",...u("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),re==="http"&&s(_t,{children:[s(F,{children:[e(H,{children:n("host")}),e(de,{size:"sm",...u("tcpHost")})]}),s(F,{children:[e(H,{children:n("path")}),e(de,{size:"sm",...u("tcpPath")})]})]})]}),j==="ws"&&s(P,{children:[s(F,{children:[e(H,{children:n("host")}),e(de,{size:"sm",...u("wsHost")})]}),s(F,{children:[e(H,{children:n("path")}),e(de,{size:"sm",...u("wsPath")})]})]}),j==="grpc"&&s(F,{children:[e(H,{children:n("serviceName")}),e(de,{size:"sm",...u("grpcServiceName")})]})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.security")}),s(P,{children:[s(F,{display:"flex",alignItems:"center",children:[e(H,{mb:"0",children:"TLS"}),e(Ct,{size:"sm",isChecked:C,onChange:oe=>{const he=oe.target.checked;I("tlsEnabled",he),he&&I("realityEnabled",!1)}})]}),s(F,{display:"flex",alignItems:"center",children:[e(H,{mb:"0",children:"Reality"}),e(Ct,{size:"sm",isChecked:B,onChange:oe=>{const he=oe.target.checked;I("realityEnabled",he),he&&I("tlsEnabled",!1)}})]})]}),C&&s(F,{mt:3,children:[e(H,{children:"SNI"}),e(de,{size:"sm",placeholder:"example.com",...u("tlsServerName")})]}),B&&s(X,{spacing:3,align:"stretch",mt:3,children:[s(F,{children:[e(H,{children:"SNI"}),e(de,{size:"sm",...u("tlsServerName")})]}),s(F,{children:[e(H,{children:n("pages.outbound.publicKey")}),e(de,{size:"sm",...u("realityPublicKey")})]}),s(F,{children:[e(H,{children:n("pages.outbound.shortId")}),e(de,{size:"sm",...u("realityShortId")})]})]})]}),s(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:n("pages.outbound.mux")}),s(F,{display:"flex",alignItems:"center",children:[e(H,{mb:"0",children:n("pages.outbound.enableMux")}),e(Ct,{size:"sm",...u("muxEnabled")})]}),_&&s(F,{mt:3,children:[e(H,{children:n("pages.outbound.concurrency")}),e(de,{size:"sm",type:"number",...u("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(Bt,{children:s(X,{align:"stretch",spacing:3,children:[s(F,{children:[e(H,{children:n("pages.outbound.configToJson","Config to JSON")}),s(P,{align:"start",spacing:3,children:[e(zn,{value:ve,onChange:oe=>ze(oe.target.value),placeholder:n("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(te,{size:"sm",colorScheme:"primary",onClick:Be,children:n("pages.outbound.convertConfig","Convert")})]})]}),e(z,{height:"420px",children:e(la,{json:y,onChange:_e})}),O&&e(h,{fontSize:"sm",color:"red.500",children:O})]})})]})]})}),s(kt,{gap:3,children:[e(te,{variant:"outline",onClick:Ze,children:n("cancel")}),e(te,{colorScheme:"primary",type:"submit",isDisabled:!k,children:n("add")})]})]})]})},Ku=({isOpen:t,onClose:a,form:r,setRoutingRuleData:o,ruleIndex:n})=>{const{t:l}=Ne(),i=m=>Array.isArray(m)?m.join(","):m!=null?m:"",c=or({defaultValues:{inboundTag:"",outboundTag:"",domain:"",ip:"",source:"",user:"",protocol:"",attrs:"",port:"",sourcePort:"",network:""}}),u=c.handleSubmit(m=>{const g={inboundTag:m.inboundTag?m.inboundTag.split(","):[],outboundTag:m.outboundTag,domain:m.domain?m.domain.split(","):[],ip:m.ip?m.ip.split(","):[],source:m.source?m.source.split(","):[],user:m.user?m.user.split(","):[],protocol:m.protocol?m.protocol.split(","):[],attrs:m.attrs?JSON.parse(m.attrs):{},port:m.port?m.port.split(","):[],sourcePort:m.sourcePort?m.sourcePort.split(","):[],network:m.network?m.network.split(","):[]},p=r.getValues("config.routing.rules")||[];n!==void 0?p[n]=g:p.push(g),r.setValue("config.routing.rules",p,{shouldDirty:!0}),o(p.map((D,I)=>({key:I,...D,domain:i(D.domain),ip:i(D.ip),source:i(D.source),user:i(D.user),inboundTag:i(D.inboundTag),protocol:i(D.protocol),attrs:JSON.stringify(D.attrs,null,2),port:i(D.port),sourcePort:i(D.sourcePort),network:i(D.network)}))),a()});return s(Dt,{isOpen:t,onClose:a,size:"md",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:l(n!==void 0?"pages.xray.rules.edit":"pages.xray.rules.add")})}),e(xt,{mt:3}),e(at,{children:e("form",{onSubmit:u,children:s(X,{spacing:4,children:[s(F,{children:[e(H,{children:l("pages.xray.rules.inboundTag")}),e(de,{...c.register("inboundTag"),size:"sm",placeholder:"tag1,tag2"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.outboundTag")}),e(de,{...c.register("outboundTag"),size:"sm",placeholder:"outbound-tag"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.domain")}),e(de,{...c.register("domain"),size:"sm",placeholder:"example.com,*.example.com"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.ip")}),e(de,{...c.register("ip"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.source")}),e(de,{...c.register("source"),size:"sm",placeholder:"192.168.1.1,10.0.0.1"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.user")}),e(de,{...c.register("user"),size:"sm",placeholder:"user1@example.com,user2@example.com"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.protocol")}),s(Ge,{...c.register("protocol"),size:"sm",children:[e("option",{value:"",children:l("pages.xray.rules.protocolPlaceholder",{defaultValue:"Select protocol"})}),["http","https","ftp","bittorrent"].map(m=>e("option",{value:m,children:m},m))]})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.attrs")}),e(zn,{...c.register("attrs"),size:"sm",placeholder:'{"key": "value"}'})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.port")}),e(de,{...c.register("port"),size:"sm",placeholder:"80,443"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.sourcePort")}),e(de,{...c.register("sourcePort"),size:"sm",placeholder:"1024,2048"})]}),s(F,{children:[e(H,{children:l("pages.xray.rules.network")}),e(de,{...c.register("network"),size:"sm",placeholder:"tcp,udp"})]}),e(te,{type:"submit",colorScheme:"primary",size:"sm",children:l(n!==void 0?"pages.xray.rules.edit":"pages.xray.rules.add")})]})})})]})]})},Yu=({isOpen:t,onClose:a,form:r,setBalancersData:o,balancerIndex:n})=>{const{t:l}=Ne(),i=or({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=i.handleSubmit(u=>{const m={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},g=r.getValues("config.routing.balancers")||[];n!==void 0?g[n]=m:g.push(m),r.setValue("config.routing.balancers",g,{shouldDirty:!0}),o(g.map((p,D)=>{var I;return{key:D,tag:p.tag||"",strategy:((I=p.strategy)==null?void 0:I.type)||"random",selector:p.selector||[],fallbackTag:p.fallbackTag||""}})),a()});return s(Dt,{isOpen:t,onClose:a,size:"sm",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:l(n!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(xt,{mt:3}),e(at,{children:e("form",{onSubmit:c,children:s(X,{spacing:4,children:[s(F,{children:[e(H,{children:l("pages.xray.balancer.tag")}),e(de,{...i.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),s(F,{children:[e(H,{children:l("pages.xray.balancer.balancerStrategy")}),e(Ge,{...i.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),s(F,{children:[e(H,{children:l("pages.xray.balancer.balancerSelectors")}),e(de,{...i.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),s(F,{children:[e(H,{children:l("pages.xray.balancer.fallbackTag")}),e(de,{...i.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(te,{type:"submit",colorScheme:"primary",size:"sm",children:l(n!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},qu=({isOpen:t,onClose:a,form:r,setDnsServers:o,dnsIndex:n})=>{const{t:l}=Ne(),i=or({defaultValues:{address:"",domains:"",expectIPs:""}}),c=i.handleSubmit(u=>{const m={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},g=r.getValues("config.dns.servers")||[];n!==void 0?g[n]=m:g.push(m),r.setValue("config.dns.servers",g,{shouldDirty:!0}),o(g),a()});return s(Dt,{isOpen:t,onClose:a,size:"sm",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:l(n!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(xt,{mt:3}),e(at,{children:e("form",{onSubmit:c,children:s(X,{spacing:4,children:[s(F,{children:[e(H,{children:l("pages.xray.dns.address")}),e(de,{...i.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),s(F,{children:[e(H,{children:l("pages.xray.dns.domains")}),e(de,{...i.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),s(F,{children:[e(H,{children:l("pages.xray.dns.expectIPs")}),e(de,{...i.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(te,{type:"submit",colorScheme:"primary",size:"sm",children:l(n!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},Gu=({isOpen:t,onClose:a,form:r,setFakeDns:o,fakeDnsIndex:n})=>{const{t:l}=Ne(),i=or({defaultValues:{ipPool:"",poolSize:""}}),c=i.handleSubmit(u=>{const m={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},g=r.getValues("config.fakedns")||[];n!==void 0?g[n]=m:g.push(m),r.setValue("config.fakedns",g.length>0?g:null,{shouldDirty:!0}),o(g),a()});return s(Dt,{isOpen:t,onClose:a,size:"sm",children:[e(nt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),s(At,{mx:"3",children:[e(ct,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:l(n!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(xt,{mt:3}),e(at,{children:e("form",{onSubmit:c,children:s(X,{spacing:4,children:[s(F,{children:[e(H,{children:l("pages.xray.fakedns.ipPool")}),e(de,{...i.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),s(F,{children:[e(H,{children:l("pages.xray.fakedns.poolSize")}),e(de,{...i.register("poolSize"),size:"sm",placeholder:"100"})]}),e(te,{type:"submit",colorScheme:"primary",size:"sm",children:l(n!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},ws=V(Yr,{baseStyle:{w:3.5,h:3.5}}),vs=V(Pr,{baseStyle:{w:4,h:4}}),Cs=V(ms,{baseStyle:{w:4,h:4}}),xi=V(to,{baseStyle:{w:4,h:4}}),Zu=V(ro,{baseStyle:{w:4,h:4}}),ki=V(fr,{baseStyle:{w:4,h:4}}),Qu=V(Vl,{baseStyle:{w:4,h:4}}),Xu=V($l,{baseStyle:{w:4,h:4}}),ju=V(Jl,{baseStyle:{w:4,h:4}}),eh=V(Kl,{baseStyle:{w:4,h:4}}),th=V(Ui,{baseStyle:{w:4,h:4}}),rh=V(Yl,{baseStyle:{w:4,h:4}}),sh=V(ql,{baseStyle:{w:4,h:4}}),nh=V(Gl,{baseStyle:{w:4,h:4}}),ah=V(Zl,{baseStyle:{w:4,h:4}}),_s={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},mn=t=>JSON.stringify(t!=null?t:{}),wt=t=>Array.isArray(t)?t.join(","):t!=null?t:"",Qn=({title:t,children:a})=>{const r=qe("gray.50","whiteAlpha.100"),o=qe("gray.200","whiteAlpha.300");return s(z,{borderWidth:"1px",borderColor:o,borderRadius:"lg",overflow:"hidden",children:[e(z,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(z,{overflowX:"auto",children:e(is,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(dr,{children:a})})})]})},ar=({label:t,controlId:a,children:r})=>{const o=qe("gray.700","whiteAlpha.800");return s(gt,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Le,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(H,{htmlFor:a,mb:{base:2,md:0},color:o,children:t})}),e(Le,{py:3,display:{base:"block",md:"table-cell"},children:e(F,{id:a,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(a)})})]})},Ds=({children:t})=>{const a=qe("gray.200","whiteAlpha.200"),r=qe("white","blackAlpha.400"),o=qe("sm","none");return e(z,{borderWidth:"1px",borderColor:a,borderRadius:"xl",bg:r,boxShadow:o,overflow:"hidden",children:e(z,{overflowX:"auto",children:t})})},As=({children:t,...a})=>{const r=qe("gray.50","whiteAlpha.100"),o=qe("gray.200","whiteAlpha.300"),n=qe("gray.300","whiteAlpha.300"),l=qe("gray.100","whiteAlpha.200"),i=qe("gray.50","whiteAlpha.100");return e(is,{size:"sm",w:"full",...a,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:o},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:o},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:n,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:l,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:i}},children:t})},ih=()=>{var tr,U,ee,L;const{t}=Ne(),{fetchCoreSettings:a,updateConfig:r,isLoading:o,config:n,isPostLoading:l,restartCore:i}=Mu(),{onEditingCore:c}=tt(),u=Rt(),{isOpen:m,onOpen:g,onClose:p}=Gt(),{isOpen:D,onOpen:I,onClose:k}=Gt(),{isOpen:f,onOpen:v,onClose:N}=Gt(),{isOpen:M,onOpen:j,onClose:C}=Gt(),{isOpen:B,onOpen:re,onClose:_}=Gt(),K=or({defaultValues:{config:n||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),pe=d.exports.useRef(mn(K.getValues("config"))),be=Ir({control:K.control,name:"config"}),Ie=d.exports.useMemo(()=>mn(be)!==pe.current,[be]),[le,ge]=d.exports.useState([]),[G,Q]=d.exports.useState([]),[w,me]=d.exports.useState([]),[xe,$]=d.exports.useState([]),[y,x]=d.exports.useState([]),[A,ie]=d.exports.useState([]),[O,ue]=d.exports.useState(!1),[ve,ze]=d.exports.useState("xraySetting"),[Me,q]=d.exports.useState("");Xt({base:!0,md:!1});const[ye,_e]=d.exports.useState(0);d.exports.useEffect(()=>{const b=()=>{ue(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",b),()=>{document.removeEventListener("fullscreenchange",b)}},[]),d.exports.useEffect(()=>(c(!0),a().then(()=>{console.log("Core settings fetched successfully")}).catch(b=>{u({title:t("core.errorFetchingConfig"),description:b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>c(!1)),[a,c,u,t]),d.exports.useEffect(()=>{var b,S,R,Ae,Re,Qe;n&&(K.reset({config:n}),pe.current=mn(n),ge(((b=n==null?void 0:n.outbounds)==null?void 0:b.map((Ce,We)=>({key:We,...Ce})))||[]),Q(((R=(S=n==null?void 0:n.routing)==null?void 0:S.rules)==null?void 0:R.map((Ce,We)=>{var mt;return{key:We,...Ce,domain:wt(Ce.domain),ip:wt(Ce.ip),source:wt(Ce.source),network:Array.isArray(Ce.network)?Ce.network.join(","):(mt=Ce.network)!=null?mt:"",user:wt(Ce.user),inboundTag:wt(Ce.inboundTag),protocol:wt(Ce.protocol),attrs:JSON.stringify(Ce.attrs,null,2)}}))||[]),me(((Re=(Ae=n==null?void 0:n.routing)==null?void 0:Ae.balancers)==null?void 0:Re.map((Ce,We)=>{var mt;return{key:We,tag:Ce.tag||"",strategy:((mt=Ce.strategy)==null?void 0:mt.type)||"random",selector:Ce.selector||[],fallbackTag:Ce.fallbackTag||""}}))||[]),$(((Qe=n==null?void 0:n.dns)==null?void 0:Qe.servers)||[]),x((n==null?void 0:n.fakedns)||[]),q(n!=null&&n.observatory?"observatory":n!=null&&n.burstObservatory?"burstObservatory":""),_e(Ce=>Ce+1))},[n,K]);const{mutate:Be,isLoading:Ve}=cr(i,{onSuccess:()=>{u({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:b=>{var S,R;u({title:t("core.generalErrorMessage"),description:((R=(S=b.response)==null?void 0:S.data)==null?void 0:R.detail)||b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Ze=K.handleSubmit(({config:b})=>{r(b).then(()=>{K.reset({config:b}),pe.current=mn(b),u({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(S=>{let R=t("core.generalErrorMessage");typeof S.response._data.detail=="object"&&(R=S.response._data.detail[Object.keys(S.response._data.detail)[0]]),typeof S.response._data.detail=="string"&&(R=S.response._data.detail),u({title:R,status:"error",isClosable:!0,position:"top",duration:3e3})})}),dt=async()=>{const b=await we("/panel/xray/getOutboundsTraffic");b!=null&&b.success&&ie(b.obj)},oe=()=>{g()},he=b=>{g()},Z=b=>{const S=[...le];S.splice(b,1),K.setValue("config.outbounds",S,{shouldDirty:!0}),ge(S)},ne=b=>{const S=[...le];S.splice(0,0,S.splice(b,1)[0]),K.setValue("config.outbounds",S,{shouldDirty:!0}),ge(S)},ht=()=>{I()},Je=b=>{I()},J=b=>{const S=[...G];S.splice(b,1),K.setValue("config.routing.rules",S,{shouldDirty:!0}),Q(S)},E=(b,S)=>{const R=[...G];R.splice(S,0,R.splice(b,1)[0]),K.setValue("config.routing.rules",R,{shouldDirty:!0}),Q(R)},ae=()=>{v()},fe=b=>{v()},Ue=b=>{const S=[...w],R=S.splice(b,1)[0];K.setValue("config.routing.balancers",S,{shouldDirty:!0}),me(S);const Ae={...K.getValues("config")};Ae.observatory&&(Ae.observatory.subjectSelector=Ae.observatory.subjectSelector.filter(Re=>Re!==R.tag)),Ae.burstObservatory&&(Ae.burstObservatory.subjectSelector=Ae.burstObservatory.subjectSelector.filter(Re=>Re!==R.tag)),K.setValue("config",Ae,{shouldDirty:!0})},Ke=()=>{j()},rt=b=>{j()},bt=b=>{const S=[...xe];S.splice(b,1),K.setValue("config.dns.servers",S,{shouldDirty:!0}),$(S)},Tt=()=>{re()},W=b=>{re()},ke=b=>{const S=[...y];S.splice(b,1),K.setValue("config.fakedns",S.length>0?S:null,{shouldDirty:!0}),x(S)},He=b=>{var S,R,Ae,Re,Qe;switch(b.protocol){case"vmess":case"vless":return((S=b.settings.vnext)==null?void 0:S.map(Ce=>`${Ce.address}:${Ce.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((R=b.settings.servers)==null?void 0:R.map(Ce=>`${Ce.address}:${Ce.port}`))||[];case"dns":return[`${(Ae=b.settings)==null?void 0:Ae.address}:${(Re=b.settings)==null?void 0:Re.port}`];case"wireguard":return((Qe=b.settings.peers)==null?void 0:Qe.map(Ce=>Ce.endpoint))||[];default:return[]}},st=b=>{const S=A.find(R=>R.tag===b.tag);return S?`${ts.sizeFormat(S.up)} / ${ts.sizeFormat(S.down)}`:`${ts.sizeFormat(0)} / ${ts.sizeFormat(0)}`},yt=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{ue(!1)}).catch(b=>{console.error("Error exiting fullscreen:",b)}):document.documentElement.requestFullscreen().then(()=>{ue(!0)}).catch(b=>{console.error("Error entering fullscreen:",b)})},zt=()=>{var S,R,Ae,Re;const b=K.getValues("config")||{};switch(ve){case"inboundSettings":return JSON.stringify((S=b.inbounds)!=null?S:[],null,2);case"outboundSettings":return JSON.stringify((R=b.outbounds)!=null?R:[],null,2);case"routingRuleSettings":return JSON.stringify((Re=(Ae=b.routing)==null?void 0:Ae.rules)!=null?Re:[],null,2);case"xraySetting":default:return JSON.stringify(b!=null?b:{},null,2)}},er=b=>{var S,R,Ae,Re,Qe,Ce;try{const We=JSON.parse(b),mt={...K.getValues("config")||{}};switch(ve){case"inboundSettings":mt.inbounds=We;break;case"outboundSettings":mt.outbounds=We,ge(We.map(($e,Kt)=>({key:Kt,...$e})));break;case"routingRuleSettings":mt.routing||(mt.routing={}),mt.routing.rules=We,Q(We.map(($e,Kt)=>{var Zt;return{key:Kt,...$e,domain:wt($e.domain),ip:wt($e.ip),source:wt($e.source),network:Array.isArray($e.network)?$e.network.join(","):(Zt=$e.network)!=null?Zt:"",user:wt($e.user),inboundTag:wt($e.inboundTag),protocol:wt($e.protocol),attrs:JSON.stringify($e.attrs,null,2)}}));break;case"xraySetting":default:K.setValue("config",We,{shouldDirty:!0}),ge(((S=We==null?void 0:We.outbounds)==null?void 0:S.map(($e,Kt)=>({key:Kt,...$e})))||[]),Q(((Ae=(R=We==null?void 0:We.routing)==null?void 0:R.rules)==null?void 0:Ae.map(($e,Kt)=>{var Zt;return{key:Kt,...$e,domain:wt($e.domain),ip:wt($e.ip),source:wt($e.source),network:Array.isArray($e.network)?$e.network.join(","):(Zt=$e.network)!=null?Zt:"",user:wt($e.user),inboundTag:wt($e.inboundTag),protocol:wt($e.protocol),attrs:JSON.stringify($e.attrs,null,2)}}))||[]),me(((Qe=(Re=We==null?void 0:We.routing)==null?void 0:Re.balancers)==null?void 0:Qe.map(($e,Kt)=>{var Zt;return{key:Kt,tag:$e.tag||"",strategy:((Zt=$e.strategy)==null?void 0:Zt.type)||"random",selector:$e.selector||[],fallbackTag:$e.fallbackTag||""}}))||[]),$(((Ce=We==null?void 0:We.dns)==null?void 0:Ce.servers)||[]),x((We==null?void 0:We.fakedns)||[]);return}K.setValue("config",mt,{shouldDirty:!0})}catch{}},Jt=()=>{var S,R;const b=K.getValues("config")||{};return Me==="observatory"?JSON.stringify((S=b.observatory)!=null?S:{},null,2):Me==="burstObservatory"?JSON.stringify((R=b.burstObservatory)!=null?R:{},null,2):""},Mt=b=>{try{const S=JSON.parse(b),R={...K.getValues("config")||{}};Me==="observatory"&&(R.observatory=S),Me==="burstObservatory"&&(R.burstObservatory=S),K.setValue("config",R,{shouldDirty:!0}),_e(Ae=>Ae+1)}catch{}},Lt=b=>!b&&b!==0?[]:Array.isArray(b)?b.map(S=>typeof S=="string"?S.trim():String(S)).filter(Boolean):typeof b=="string"?b.split(",").map(S=>S.trim()).filter(Boolean):[String(b)],pt=(b,S="blue")=>{const R=Lt(b);return R.length?e(Fu,{chips:R,color:S}):e(h,{color:"gray.400",children:"-"})},Vt=b=>{if(b==null||b===""||typeof b=="string"&&!b.trim())return e(h,{color:"gray.400",children:"-"});const S=typeof b=="string"?b:String(b);return S.length>30?e(Hu,{text:S,label:t("details")}):e(h,{children:S})},It=b=>{if(!b)return e(h,{color:"gray.400",children:"-"});try{const S=JSON.parse(b);if(S&&typeof S=="object"&&!Array.isArray(S)){const R=Object.entries(S);return R.length?e(z,{display:"flex",flexWrap:"wrap",gap:"1",children:R.map(([Ae,Re])=>e(St,{colorScheme:"purple",size:"sm",children:`${Ae}: ${String(Re)}`},Ae))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:b})};return s(X,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(De,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:s(De,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(te,{size:"sm",colorScheme:"primary",isLoading:l,isDisabled:!Ie||l,onClick:Ze,w:{base:"full",sm:"auto"},children:t("core.save")}),e(te,{size:"sm",leftIcon:e(ki,{}),isLoading:Ve,onClick:()=>Be(),variant:"outline",w:{base:"full",sm:"auto"},children:t(Ve?"core.restarting":"core.restartCore")})]})}),s(Ws,{variant:"enclosed",colorScheme:"primary",children:[s(Fs,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(Ht,{children:s(P,{spacing:2,align:"center",children:[e(ju,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(Ht,{children:s(P,{spacing:2,align:"center",children:[e(eh,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(Ht,{children:s(P,{spacing:2,align:"center",children:[e(th,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(Ht,{children:s(P,{spacing:2,align:"center",children:[e(rh,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(Ht,{children:s(P,{spacing:2,align:"center",children:[e(sh,{}),e(h,{as:"span",children:t("DNS")})]})}),e(Ht,{children:s(P,{spacing:2,align:"center",children:[e(nh,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(Ht,{children:s(P,{spacing:2,align:"center",children:[e(ah,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),s(Hs,{children:[e(Bt,{children:s(X,{spacing:4,align:"stretch",children:[s(Qn,{title:t("pages.xray.generalConfigs"),children:[e(ar,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:b=>e(vt,{name:"config.outbounds[0].settings.domainStrategy",control:K.control,render:({field:S})=>e(Ge,{...S,id:b,size:"sm",maxW:"220px",children:["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(R=>e("option",{value:R,children:R},R))})})}),e(ar,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:b=>e(vt,{name:"config.routing.domainStrategy",control:K.control,render:({field:S})=>e(Ge,{...S,id:b,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(R=>e("option",{value:R,children:R},R))})})})]}),s(Qn,{title:t("pages.xray.statistics"),children:[e(ar,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:b=>e(vt,{name:"config.policy.system.statsInboundUplink",control:K.control,render:({field:S})=>e(Ct,{id:b,isChecked:!!S.value,onChange:R=>S.onChange(R.target.checked)})})}),e(ar,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:b=>e(vt,{name:"config.policy.system.statsInboundDownlink",control:K.control,render:({field:S})=>e(Ct,{id:b,isChecked:!!S.value,onChange:R=>S.onChange(R.target.checked)})})}),e(ar,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:b=>e(vt,{name:"config.policy.system.statsOutboundUplink",control:K.control,render:({field:S})=>e(Ct,{id:b,isChecked:!!S.value,onChange:R=>S.onChange(R.target.checked)})})}),e(ar,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:b=>e(vt,{name:"config.policy.system.statsOutboundDownlink",control:K.control,render:({field:S})=>e(Ct,{id:b,isChecked:!!S.value,onChange:R=>S.onChange(R.target.checked)})})})]}),s(Qn,{title:t("pages.xray.logConfigs"),children:[e(ar,{label:t("pages.xray.logLevel"),controlId:"log-level",children:b=>e(vt,{name:"config.log.loglevel",control:K.control,render:({field:S})=>e(Ge,{...S,id:b,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(R=>e("option",{value:R,children:R},R))})})}),e(ar,{label:t("pages.xray.accessLog"),controlId:"access-log",children:b=>e(vt,{name:"config.log.access",control:K.control,render:({field:S})=>s(Ge,{...S,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(R=>e("option",{value:R,children:R},R))]})})}),e(ar,{label:t("pages.xray.errorLog"),controlId:"error-log",children:b=>e(vt,{name:"config.log.error",control:K.control,render:({field:S})=>s(Ge,{...S,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(R=>e("option",{value:R,children:R},R))]})})}),e(ar,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:b=>e(vt,{name:"config.log.maskAddress",control:K.control,render:({field:S})=>s(Ge,{...S,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(R=>e("option",{value:R,children:R},R))]})})}),e(ar,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:b=>e(vt,{name:"config.log.dnsLog",control:K.control,render:({field:S})=>e(Ct,{id:b,isChecked:!!S.value,onChange:R=>S.onChange(R.target.checked)})})})]})]})}),e(Bt,{children:s(X,{spacing:4,align:"stretch",children:[e(te,{leftIcon:e(ws,{}),..._s,onClick:ht,children:t("pages.xray.rules.add")}),e(Ds,{children:s(As,{minW:"1100px",children:[s(br,{children:[s(gt,{children:[e(Pe,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(Pe,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(Pe,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(Pe,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(Pe,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(Pe,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(Pe,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(Pe,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),s(gt,{children:[e(Pe,{children:t("IP",{defaultValue:"IP"})}),e(Pe,{children:t("port",{defaultValue:"Port"})}),e(Pe,{children:t("network",{defaultValue:"Network"})}),e(Pe,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(Pe,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(Pe,{children:t("IP",{defaultValue:"IP"})}),e(Pe,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(Pe,{children:t("port",{defaultValue:"Port"})}),e(Pe,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(Pe,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),s(dr,{children:[G.length===0&&e(gt,{children:e(Le,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),G.map((b,S)=>s(gt,{children:[e(Le,{children:s(X,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:S+1}),s(P,{spacing:1,children:[e(Ee,{"aria-label":"move up",icon:e(xi,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>E(S,S-1)}),e(Ee,{"aria-label":"move down",icon:e(Zu,{}),size:"xs",variant:"ghost",isDisabled:S===G.length-1,onClick:()=>E(S,S+1)})]})]})}),e(Le,{children:pt(b.source,"blue")}),e(Le,{children:Vt(b.sourcePort)}),e(Le,{children:pt(b.network,"purple")}),e(Le,{children:pt(b.protocol,"green")}),e(Le,{children:It(b.attrs)}),e(Le,{children:pt(b.ip,"blue")}),e(Le,{children:pt(b.domain,"blue")}),e(Le,{children:Vt(b.port)}),e(Le,{children:pt(b.inboundTag,"teal")}),e(Le,{children:pt(b.user,"cyan")}),e(Le,{children:Vt(b.outboundTag)}),e(Le,{children:Vt(b.balancerTag)}),e(Le,{children:s(P,{spacing:1,children:[e(Ee,{"aria-label":"edit",icon:e(Cs,{}),size:"xs",variant:"ghost",onClick:()=>Je()}),e(Ee,{"aria-label":"delete",icon:e(vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>J(S)})]})})]},b.key))]})]})})]})}),e(Bt,{children:s(X,{spacing:4,align:"stretch",children:[s(P,{children:[e(te,{leftIcon:e(ws,{}),..._s,onClick:oe,children:t("pages.xray.outbound.addOutbound")}),e(te,{leftIcon:e(ki,{}),size:"xs",variant:"ghost",onClick:dt,children:t("refresh")})]}),e(Ds,{children:s(As,{minW:"880px",children:[e(br,{children:s(gt,{children:[e(Pe,{children:"#"}),e(Pe,{children:t("pages.xray.outbound.tag")}),e(Pe,{children:t("protocol")}),e(Pe,{children:t("pages.xray.outbound.address")}),e(Pe,{children:t("pages.inbounds.traffic")})]})}),e(dr,{children:le.map((b,S)=>{var R,Ae,Re;return s(gt,{children:[e(Le,{children:s(P,{children:[e(h,{children:S+1}),e(Ee,{"aria-label":"move to top",icon:e(xi,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>ne(S)}),e(Ee,{"aria-label":"edit",icon:e(Cs,{}),size:"xs",variant:"ghost",onClick:()=>he()}),e(Ee,{"aria-label":"delete",icon:e(vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Z(S)})]})}),e(Le,{children:b.tag}),s(Le,{children:[e(St,{colorScheme:"purple",children:b.protocol}),["vmess","vless","trojan","shadowsocks"].includes(b.protocol)&&s(_t,{children:[e(St,{colorScheme:"blue",children:(R=b.streamSettings)==null?void 0:R.network}),((Ae=b.streamSettings)==null?void 0:Ae.security)==="tls"&&e(St,{colorScheme:"green",children:"tls"}),((Re=b.streamSettings)==null?void 0:Re.security)==="reality"&&e(St,{colorScheme:"green",children:"reality"})]})]}),e(Le,{children:He(b).map(Qe=>e(h,{children:Qe},Qe))}),e(Le,{children:e(St,{colorScheme:"green",children:st(b)})})]},b.key)})})]})})]})}),e(Bt,{children:s(X,{spacing:4,align:"stretch",children:[e(te,{leftIcon:e(ws,{}),..._s,onClick:ae,children:t("pages.xray.balancer.addBalancer")}),e(Ds,{children:s(As,{minW:"680px",children:[e(br,{children:s(gt,{children:[e(Pe,{children:"#"}),e(Pe,{children:t("pages.xray.balancer.tag")}),e(Pe,{children:t("pages.xray.balancer.balancerStrategy")}),e(Pe,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(dr,{children:w.map((b,S)=>s(gt,{children:[e(Le,{children:s(P,{children:[e(h,{children:S+1}),e(Ee,{"aria-label":"edit",icon:e(Cs,{}),size:"xs",variant:"ghost",onClick:()=>fe()}),e(Ee,{"aria-label":"delete",icon:e(vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Ue(S)})]})}),e(Le,{children:b.tag}),e(Le,{children:e(St,{colorScheme:b.strategy==="random"?"purple":"green",children:b.strategy==="random"?"Random":b.strategy==="roundRobin"?"Round Robin":b.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Le,{children:b.selector.map(R=>e(St,{colorScheme:"blue",m:1,children:R},R))})]},b.key))})]})}),(((tr=K.getValues("config"))==null?void 0:tr.observatory)||((U=K.getValues("config"))==null?void 0:U.burstObservatory))&&s(X,{spacing:3,align:"stretch",children:[e(na,{onChange:b=>{q(b),_e(S=>S+1)},value:Me,children:s(P,{spacing:3,children:[((ee=K.getValues("config"))==null?void 0:ee.observatory)&&e(Er,{value:"observatory",children:"Observatory"}),((L=K.getValues("config"))==null?void 0:L.burstObservatory)&&e(Er,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(z,{h:"300px",children:e(la,{json:Jt()?JSON.parse(Jt()):{},onChange:b=>Mt(b)},`obs-${Me}-${ye}`)})]})]})}),e(Bt,{children:s(X,{spacing:4,align:"stretch",children:[s(F,{display:"flex",alignItems:"center",children:[e(H,{children:t("pages.xray.dns.enable")}),e(vt,{name:"config.dns",control:K.control,render:({field:b})=>e(Ct,{isChecked:!!b.value,onChange:S=>{const R={...K.getValues("config")};S.target.checked?R.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete R.dns,delete R.fakedns),K.setValue("config",R,{shouldDirty:!0}),$([]),x([])}})})]}),xe.length>0&&s(_t,{children:[e(te,{leftIcon:e(ws,{}),..._s,onClick:Ke,children:t("pages.xray.dns.add")}),e(Ds,{children:s(As,{minW:"720px",children:[e(br,{children:s(gt,{children:[e(Pe,{children:"#"}),e(Pe,{children:t("pages.xray.outbound.address")}),e(Pe,{children:t("pages.xray.dns.domains")}),e(Pe,{children:t("pages.xray.dns.expectIPs")})]})}),e(dr,{children:xe.map((b,S)=>s(gt,{children:[e(Le,{children:s(P,{children:[e(h,{children:S+1}),e(Ee,{"aria-label":"edit",icon:e(Cs,{}),size:"xs",variant:"ghost",onClick:()=>rt()}),e(Ee,{"aria-label":"delete",icon:e(vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>bt(S)})]})}),e(Le,{children:typeof b=="object"?b.address:b}),e(Le,{children:typeof b=="object"?wt(b.domains):""}),e(Le,{children:typeof b=="object"?wt(b.expectIPs):""})]},S))})]})})]}),y.length>0&&s(_t,{children:[e(te,{leftIcon:e(ws,{}),..._s,onClick:Tt,children:t("pages.xray.fakedns.add")}),e(Ds,{children:s(As,{minW:"520px",children:[e(br,{children:s(gt,{children:[e(Pe,{children:"#"}),e(Pe,{children:t("pages.xray.fakedns.ipPool")}),e(Pe,{children:t("pages.xray.fakedns.poolSize")})]})}),e(dr,{children:y.map((b,S)=>s(gt,{children:[e(Le,{children:s(P,{children:[e(h,{children:S+1}),e(Ee,{"aria-label":"edit",icon:e(Cs,{}),size:"xs",variant:"ghost",onClick:()=>W()}),e(Ee,{"aria-label":"delete",icon:e(vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ke(S)})]})}),e(Le,{children:b.ipPool}),e(Le,{children:b.poolSize})]},S))})]})})]})]})}),e(Bt,{children:s(X,{spacing:4,align:"stretch",children:[s(z,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(z,{px:2,children:e(na,{onChange:b=>{ze(b),_e(S=>S+1)},value:ve,children:s(P,{spacing:3,wrap:"wrap",children:[e(Er,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Er,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Er,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Er,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),s(z,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(Ee,{position:"absolute",top:2,right:2,"aria-label":O?"Exit Full Screen":"Full Screen",icon:O?e(Xu,{}):e(Qu,{}),onClick:yt,zIndex:10}),e(z,{w:O?"100vw":"100%",h:O?"100vh":"100%",position:O?"fixed":"relative",top:O?0:"auto",left:O?0:"auto",zIndex:O?1e3:"auto",children:e(la,{json:zt()?JSON.parse(zt()):{},onChange:b=>{er(b)}},`advanced-${ve}-${ye}`)})]})]})}),e(Bt,{children:e(z,{children:e(Ao,{showTitle:!1})})})]})]}),e(Ju,{isOpen:m,onClose:p,form:K,setOutboundData:ge}),e(Ku,{isOpen:D,onClose:k,form:K,setRoutingRuleData:Q}),e(Yu,{isOpen:f,onClose:N,form:K,setBalancersData:me}),e(qu,{isOpen:M,onClose:C,form:K,setDnsServers:$}),e(Gu,{isOpen:B,onClose:_,form:K,setFakeDns:x})]})},oh=({isOpen:t,onClose:a,onSubmit:r,isSaving:o,allHosts:n,allAdmins:l,initialService:i})=>{var w,me,xe,$;const{t:c}=Ne(),[u,m]=d.exports.useState((w=i==null?void 0:i.name)!=null?w:""),[g,p]=d.exports.useState((me=i==null?void 0:i.description)!=null?me:""),[D,I]=d.exports.useState((xe=i==null?void 0:i.admin_ids)!=null?xe:[]),[k,f]=d.exports.useState(($=i==null?void 0:i.hosts.map(y=>y.id))!=null?$:[]),[v,N]=d.exports.useState(""),[M,j]=d.exports.useState(""),[C,B]=d.exports.useState(null),re=Rt();d.exports.useEffect(()=>{var y,x,A,ie;t&&(m((y=i==null?void 0:i.name)!=null?y:""),p((x=i==null?void 0:i.description)!=null?x:""),I((A=i==null?void 0:i.admin_ids)!=null?A:[]),f((ie=i==null?void 0:i.hosts.map(O=>O.id))!=null?ie:[]),N(""),j(""))},[t,i]);const _=d.exports.useMemo(()=>new Map(n.map(y=>[y.id,y])),[n]),K=d.exports.useMemo(()=>n.filter(y=>!k.includes(y.id)&&!y.isDisabled),[n,k]),pe=d.exports.useMemo(()=>{const y=M.trim().toLowerCase();return y?K.filter(x=>{const A=x.label.toLowerCase(),ie=x.inboundTag.toLowerCase(),O=x.protocol.toLowerCase();return A.includes(y)||ie.includes(y)||O.includes(y)}):K},[K,M]),be=d.exports.useMemo(()=>{const y=v.trim().toLowerCase();return y?l.filter(x=>x.username.toLowerCase().includes(y)):l},[v,l]),Ie=d.exports.useMemo(()=>new Set(D),[D]),le=y=>{I(x=>x.includes(y)?x.filter(A=>A!==y):[...x,y])},ge=y=>{f(x=>x.includes(y)?x.filter(A=>A!==y):[...x,y])},G=(y,x)=>{f(A=>{const ie=A.indexOf(y);if(ie===-1)return A;const O=x==="up"?ie-1:ie+1;if(O<0||O>=A.length)return A;const ue=[...A];return[ue[ie],ue[O]]=[ue[O],ue[ie]],ue})},Q=async()=>{if(!u.trim()){re({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!k.length){re({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const y=k.map((x,A)=>({host_id:x,sort:A}));await r({name:u.trim(),description:(g==null?void 0:g.trim())||null,admin_ids:D,hosts:y},i==null?void 0:i.id)};return s(Dt,{isOpen:t,onClose:a,size:"5xl",children:[e(nt,{}),s(At,{children:[e(ct,{children:i?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(xt,{}),e(at,{children:s(De,{spacing:6,children:[s(P,{spacing:4,children:[e(Ut,{label:c("services.fields.name","Name"),value:u,onChange:y=>m(y.target.value),maxLength:128,isRequired:!0}),e(Ut,{label:c("services.fields.description","Description"),value:g!=null?g:"",onChange:y=>p(y.target.value),maxLength:256})]}),s(z,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),s(De,{spacing:3,children:[e(Ut,{value:v,onChange:y=>N(y.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(X,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:l.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):be.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):be.map(y=>{const x=Ie.has(y.id);return e(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:x?"primary.400":"gray.200",bg:x?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:x?"primary.300":"gray.600",bg:x?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>le(y.id),onKeyDown:A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),le(y.id))},role:"button",tabIndex:0,children:s(Nt,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:y.username}),x&&e(Nr,{colorScheme:"primary",children:c("services.selected","Selected")})]})},y.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),s(fa,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(Hr,{children:s(pr,{variant:"outline",h:"full",children:[e(rs,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(kr,{children:s(De,{spacing:3,children:[e(Ut,{value:M,onChange:y=>j(y.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(X,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:K.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):pe.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):pe.map(y=>s(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:C===y.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>B(y.id),onMouseLeave:()=>B(null),onClick:()=>ge(y.id),children:[e(h,{fontWeight:"medium",children:y.label}),s(h,{fontSize:"sm",color:"gray.500",children:[y.protocol.toUpperCase()," - ",y.inboundTag]})]},y.id))})]})})]})}),e(Hr,{children:s(pr,{variant:"outline",h:"full",children:[e(rs,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(kr,{children:s(X,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[k.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),k.map((y,x)=>{const A=_.get(y);return A?e(Ql.div,{layout:!0,children:s(Nt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[s(z,{children:[s(P,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:A.label}),A.isDisabled&&e(Nr,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),s(h,{fontSize:"sm",color:"gray.500",children:[A.protocol.toUpperCase()," - ",A.inboundTag]})]}),s(P,{spacing:1,children:[e(et,{label:c("services.moveUp","Move up"),children:e(Ee,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(to,{width:16}),onClick:()=>G(y,"up"),isDisabled:x===0})}),e(et,{label:c("services.moveDown","Move down"),children:e(Ee,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(ro,{width:16}),onClick:()=>G(y,"down"),isDisabled:x===k.length-1})}),e(et,{label:c("services.removeHost","Remove host"),children:e(Ee,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(Pr,{width:16}),onClick:()=>ge(y)})})]})]})},y):null})]})})]})})]})]})}),e(kt,{children:s(P,{justify:"flex-end",w:"full",children:[e(te,{onClick:a,children:c("cancel")}),e(te,{colorScheme:"primary",onClick:Q,isLoading:o,children:c(i?"saveChanges":"create")})]})})]})]})},lh=()=>{var xe;const{t}=Ne(),a=Rt(),{userData:r,getUserIsSuccess:o}=qr(),n=o&&r.is_sudo,l=ss(),i=_r(),c=go(),{inbounds:u,refetchUsers:m}=tt(),g=Gt(),[p,D]=d.exports.useState(null);d.exports.useEffect(()=>{!o||!n||(l.fetchServices(),i.fetchAdmins({limit:500,offset:0}),Sa(),c.fetchHosts())},[o,n]);const I=d.exports.useMemo(()=>i.admins.slice().sort(($,y)=>$.username.localeCompare(y.username)).map($=>({id:$.id,username:$.username})),[i.admins]),k=d.exports.useMemo(()=>{var y,x;const $=[];for(const[A,ie]of Object.entries(c.hosts)){const O=(y=Array.from(u.values()).flat().find(ve=>ve.tag===A))!=null?y:null,ue=(x=O==null?void 0:O.protocol)!=null?x:"unknown";ie.forEach(ve=>{ve.id!=null&&$.push({id:ve.id,label:ve.remark,inboundTag:A,protocol:ue,isDisabled:Boolean(ve.is_disabled)})})}return $},[c.hosts,u]),f=()=>{D(null),g.onOpen()},v=async $=>{try{const y=await l.fetchServiceDetail($);D(y),g.onOpen()}catch{a({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},N=async($,y)=>{var x,A;try{y?(await l.updateService(y,$),a({status:"success",title:t("services.updated","Service updated")})):(await l.createService($),a({status:"success",title:t("services.created","Service created")})),m(),g.onClose()}catch(ie){a({status:"error",title:(A=(x=ie==null?void 0:ie.data)==null?void 0:x.detail)!=null?A:t("services.saveFailed","Failed to save service")})}},M=async $=>{var y,x;try{await l.deleteService($),a({status:"success",title:t("services.deleted","Service removed")}),m()}catch(A){a({status:"error",title:(x=(y=A==null?void 0:A.data)==null?void 0:y.detail)!=null?x:t("services.deleteFailed","Unable to delete service")})}},j=async $=>{var y,x;try{await l.resetServiceUsage($),a({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(A){a({status:"error",title:(x=(y=A==null?void 0:A.data)==null?void 0:y.detail)!=null?x:t("services.resetFailed","Failed to reset usage")})}},[C,B]=d.exports.useState(null),[re,_]=d.exports.useState(!1),{isOpen:K,onOpen:pe,onClose:be}=Gt(),Ie=d.exports.useRef(null),le=$=>{B($),pe()},ge=async()=>{if(C!=null){_(!0);try{await j(C)}finally{_(!1),be()}}},G=C!=null?(xe=l.services.find($=>$.id===C))==null?void 0:xe.name:void 0,Q=$=>e(qi,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:y})=>s(_t,{children:[s(Gi,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[s(z,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:$.name}),$.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:y?3:1,mt:1,children:$.description})]}),s(X,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[s(P,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:$.host_count})]}),s(P,{spacing:1,children:[s(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:$.user_count})]})]}),e(Xl,{})]}),e(Zi,{pt:0,pb:4,children:s(De,{spacing:4,children:[s(ot,{columns:2,spacing:3,children:[s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:Fe($.used_traffic)})]}),s(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:Fe($.lifetime_used_traffic)})]})]}),s(De,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),s(P,{spacing:2,flexWrap:"wrap",children:[e(et,{label:t("services.view","View"),children:e(Ee,{"aria-label":"View",icon:e(Ns,{width:18}),size:"sm",variant:"outline",onClick:x=>{x.stopPropagation(),l.fetchServiceDetail($.id)}})}),e(et,{label:t("services.edit","Edit"),children:e(Ee,{"aria-label":"Edit",icon:e(ra,{width:18}),size:"sm",variant:"outline",onClick:x=>{x.stopPropagation(),v($.id)},isDisabled:!n})}),e(et,{label:t("services.resetUsage","Reset usage"),children:e(Ee,{"aria-label":"Reset usage",icon:e(fr,{width:18}),size:"sm",variant:"outline",onClick:x=>{x.stopPropagation(),le($.id)},isDisabled:!n})}),e(et,{label:t("services.delete","Delete"),children:e(Ee,{"aria-label":"Delete",icon:e(Pr,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:x=>{x.stopPropagation(),M($.id)},isDisabled:!n})})]})]})]})})]})},`service-accordion-${$.id}`),w=$=>s(gt,{children:[e(Le,{children:s(X,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:$.name}),$.description&&e(h,{fontSize:"sm",color:"gray.500",children:$.description})]})}),e(Le,{children:$.host_count}),e(Le,{children:$.user_count}),e(Le,{children:Fe($.used_traffic)}),e(Le,{children:Fe($.lifetime_used_traffic)}),e(Le,{children:s(P,{spacing:2,children:[e(et,{label:t("services.view","View"),children:e(Ee,{"aria-label":"View",icon:e(Ns,{width:18}),size:"sm",variant:"ghost",onClick:()=>l.fetchServiceDetail($.id)})}),n&&s(_t,{children:[e(et,{label:t("services.edit","Edit"),children:e(Ee,{"aria-label":"Edit",icon:e(ra,{width:18}),size:"sm",variant:"ghost",onClick:()=>v($.id)})}),e(et,{label:t("services.resetUsage","Reset usage"),children:e(Ee,{"aria-label":"Reset usage",icon:e(fr,{width:18}),size:"sm",variant:"ghost",onClick:()=>le($.id)})}),e(et,{label:t("services.delete","Delete"),children:e(Ee,{"aria-label":"Delete",icon:e(Pr,{width:18}),size:"sm",variant:"ghost",onClick:()=>M($.id)})})]})]})})]},$.id),me=l.serviceDetail;return o?n?s(X,{spacing:4,align:"stretch",children:[s(Nt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[s(z,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),n&&e(te,{leftIcon:e(Yr,{width:18}),colorScheme:"primary",onClick:f,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(pr,{variant:"outline",children:e(kr,{children:l.isLoading?e(Nt,{justify:"center",py:10,children:e(lt,{})}):s(_t,{children:[e(Yi,{allowToggle:!0,display:{base:"block",md:"none"},children:l.services.map(Q)}),e(z,{display:{base:"none",md:"block"},overflowX:"auto",children:s(is,{variant:"simple",children:[e(br,{children:s(gt,{children:[e(Pe,{children:t("services.columns.name","Name")}),e(Pe,{children:t("services.columns.hosts","Hosts")}),e(Pe,{children:t("services.columns.users","Users")}),e(Pe,{children:t("services.columns.usage","Usage")}),e(Pe,{children:t("services.columns.lifetime","Lifetime")}),e(Pe,{children:t("services.columns.actions","Actions")})]})}),e(dr,{children:l.services.map(w)})]})})]})})}),me&&s(pr,{variant:"outline",children:[e(rs,{children:s(Nt,{justify:"space-between",align:"center",children:[s(z,{children:[e(h,{fontWeight:"semibold",children:me.name}),me.description&&e(h,{fontSize:"sm",color:"gray.500",children:me.description})]}),e(Nr,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:me.user_count})})]})}),e(kr,{children:s(ot,{columns:{base:1,md:2},spacing:6,children:[s(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(De,{spacing:2,children:me.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):me.admins.map($=>s(Nt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:$.username}),s(h,{fontSize:"sm",color:"gray.500",children:[Fe($.used_traffic)," /"," ",Fe($.lifetime_used_traffic)]})]},$.id))})]}),s(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(De,{spacing:2,children:me.hosts.map($=>s(Nt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[s(z,{children:[e(h,{fontWeight:"medium",children:$.remark}),s(h,{fontSize:"sm",color:"gray.500",children:[$.inbound_protocol.toUpperCase()," - ",$.inbound_tag]})]}),s(Nr,{colorScheme:"gray",children:["#",$.sort+1]})]},$.id))})]})]})})]}),e(Us,{isOpen:K,leastDestructiveRef:Ie,onClose:be,isCentered:!0,motionPreset:"slideInBottom",children:e(nt,{children:s(Rs,{mx:{base:4,sm:0},children:[e(ct,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(at,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:G!=null?G:t("services.thisService","this service")})}),s(kt,{children:[e(te,{ref:Ie,onClick:be,children:t("cancel","Cancel")}),e(te,{colorScheme:"primary",ml:3,onClick:ge,isLoading:re,children:t("services.resetUsage","Reset usage")})]})]})})}),e(oh,{isOpen:g.isOpen,onClose:g.onClose,onSubmit:N,isSaving:l.isSaving,allHosts:k,allAdmins:I,initialService:p!=null?p:void 0})]}):s(X,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(Nt,{justify:"center",align:"center",h:"full",py:10,children:e(lt,{})})};Te.extend(qs);const wi=V(Bs,{baseStyle:{w:4,h:4}}),ch=V(ya,{baseStyle:{w:4,h:4}}),dh={key:"30d",label:"30d",amount:30,unit:"day"},uh=t=>{if(!t)return t;const a=t.includes(" "),r=a?t.replace(" ","T"):t,o=Te.utc(r);return o.isValid()?a?o.local().format("MM-DD HH:mm"):o.format("YYYY-MM-DD"):t},vi=t=>Te(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Ci=t=>Te(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",gn=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return Te.utc(r).valueOf()},_i=t=>{const a=t.unit==="hour"?"hour":"day",r=Te().utc().endOf(a),o=Math.max(t.amount-1,0),n=r.subtract(o,t.unit).startOf(a);return{key:t.key,start:n.toDate(),end:r.toDate(),unit:t.unit}},hh=(t,a)=>{const r=Te(t),o=Te(a),[n,l]=r.isBefore(o)?[r,o]:[o,r],i=n.startOf("day"),c=l.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},mh=(t,a)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:a,labels:{style:{colors:a.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Fe(Number(o)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Fe(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},gh=(t,a)=>({labels:a,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Fe(Number(r)||0,2),title:{formatter:(r,o)=>{var n,l,i,c;return(c=(i=(l=(n=o==null?void 0:o.w)==null?void 0:n.globals)==null?void 0:l.labels)==null?void 0:i[o.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),ph=()=>{var ue,ve,ze,Me;const{t}=Ne(),{colorMode:a}=Ur(),{admins:r}=_r(),o="auto-end",n=(ue=Xt({base:"bottom",md:"auto-end"}))!=null?ue:o,[l,i]=d.exports.useState([]),[c,u]=d.exports.useState([]),[m,g]=d.exports.useState(null),[p,D]=d.exports.useState([]),[I,k]=d.exports.useState(!1),f=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),v=(ve=f.find(q=>q.key==="30d"))!=null?ve:dh,[N,M]=d.exports.useState(()=>_i(v)),[j,C]=d.exports.useState(v.key),[B,re]=d.exports.useState(null),[_,K]=d.exports.useState([]),[pe,be]=d.exports.useState(!1),[Ie,le]=d.exports.useState(!1),[ge,G]=d.exports.useState([N.start,N.end]);d.exports.useMemo(()=>{var q;return(q=c.find(ye=>ye.id===m))!=null?q:null},[c,m]);const Q=d.exports.useMemo(()=>{if(!m)return l;const q=new Set(p.map(_e=>_e.username).filter(_e=>Boolean(_e))),ye=l.filter(_e=>q.has(_e.username));return ye.length?ye:l},[l,m,p]),w=d.exports.useMemo(()=>p.reduce((q,ye)=>q+(ye.used_traffic||0),0),[p]),me=d.exports.useMemo(()=>p.map(q=>q.used_traffic||0),[p]),xe=d.exports.useMemo(()=>p.map(q=>q.username||t("services.unassignedAdmin","Unassigned")),[p,t]),$=d.exports.useMemo(()=>gh(a,xe),[a,xe]);d.exports.useEffect(()=>{Ie||G([N.start,N.end])},[Ie,N.start,N.end]),d.exports.useEffect(()=>{let q=!1;return(async()=>{var _e;try{const Be=await we("/v2/services",{query:{limit:500}});if(q||!Be)return;const Ve=(_e=Be.services)!=null?_e:[];u(Ve),g(Ze=>Ze!==null?Ze:Ve.length?Ve[0].id:null)}catch{q||u([])}})(),()=>{q=!0}},[]),d.exports.useEffect(()=>{if(!m){D([]);return}let q=!1;return k(!0),we(`/v2/services/${m}/usage/admins`,{query:{start:vi(N.start),end:Ci(N.end)}}).then(ye=>{var _e;q||!ye||D((_e=ye.admins)!=null?_e:[])}).catch(()=>{q||D([])}).finally(()=>{q||k(!1)}),()=>{q=!0}},[m,N.start,N.end,N.unit]),d.exports.useEffect(()=>{let q=!1;return(async()=>{try{const _e=await we("/admins");if(q)return;Array.isArray(_e)?i(_e):i(_e.admins||[])}catch(_e){console.error("Failed to load all admins:",_e),i(r||[])}})(),()=>{q=!0}},[r]),d.exports.useEffect(()=>{if(!B)return;let q=!1;be(!0);const ye=N.unit==="hour",_e={start:vi(N.start),end:Ci(N.end)};ye&&(_e.granularity="hour");const Be=ye?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:B,endpoint:Be,query:_e}),we(`/admin/${encodeURIComponent(B)}/usage/${Be}`,{query:_e}).then(Ve=>{if(q)return;const Ze=Array.isArray(Ve==null?void 0:Ve.usages)?Ve.usages:[];console.debug("AdminsUsage: response usages",{length:Ze.length,endpoint:Be});let dt;if(ye){const oe=new Map;Ze.forEach(Z=>{var Je,J;const ne=typeof(Z==null?void 0:Z.date)=="string"?Z.date:"";if(!ne)return;const ht=(Je=oe.get(ne))!=null?Je:0;oe.set(ne,ht+Number((J=Z==null?void 0:Z.used_traffic)!=null?J:0))});const he=Array.from(oe.entries());he.sort((Z,ne)=>{const[ht]=Z,[Je]=ne;return gn(ht)-gn(Je)}),dt=he.map(([Z,ne])=>({date:Z,used_traffic:ne}))}else{const oe=Ze.map(he=>{var Z,ne;return{date:(Z=he==null?void 0:he.date)!=null?Z:"",used_traffic:Number((ne=he==null?void 0:he.used_traffic)!=null?ne:0)}});oe.sort((he,Z)=>gn(he.date)-gn(Z.date)),dt=oe}K(dt)}).catch(Ve=>{q||(console.error("Error fetching admin usage:",Ve),K([]))}).finally(()=>{q||be(!1)}),()=>{q=!0}},[B,N]),d.exports.useEffect(()=>{if(!Q||Q.length===0)return;Q.some(ye=>ye.username===B)||re(Q[0].username)},[Q,B]),d.exports.useEffect(()=>{const q=f.find(ye=>ye.key===N.key);C(q?q.key:"custom")},[N,f]);const y=d.exports.useMemo(()=>_.map(q=>uh(q.date)),[_]),x=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:_.map(q=>q.used_traffic)}],[_,t]),A=d.exports.useMemo(()=>({options:mh(a,y),series:x}),[a,y,x]),ie=d.exports.useMemo(()=>_.reduce((q,ye)=>q+Number(ye.used_traffic||0),0),[_]),O=d.exports.useMemo(()=>{const q=Te(N.start).format("YYYY-MM-DD"),ye=Te(N.end).format("YYYY-MM-DD");return q===ye?q:`${q} - ${ye}`},[N.start,N.end]);return s(X,{spacing:4,align:"stretch",children:[s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(De,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[s(X,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),s(De,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(Ge,{value:m!=null?m:"",onChange:q=>{const ye=Number(q.target.value);g(Number.isNaN(ye)?null:ye)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(q=>e("option",{value:q.id,children:q.name},q.id))}),s(P,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(wi,{}),s(h,{children:[t("services.totalUsage","Total"),":"," ",e(V.span,{fontWeight:"medium",children:Fe(w,2)})]})]})]})]}),s(De,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:I?s(X,{spacing:3,py:8,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):p.length&&w>0?e(gr,{type:"donut",height:320,options:$,series:me}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(X,{flex:"1",align:"stretch",spacing:2,children:p.length?p.map(q=>{var Ve;const ye=q.username||t("services.unassignedAdmin","Unassigned"),_e=Boolean(q.username),Be=B===q.username&&_e;return e(te,{size:"sm",variant:Be?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{_e&&q.username&&re(q.username)},isDisabled:!_e,children:s(P,{justify:"space-between",w:"full",children:[e(h,{children:ye}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:Fe(q.used_traffic||0,2)})]})},`${(Ve=q.admin_id)!=null?Ve:"na"}-${ye}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(De,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(X,{align:"start",spacing:1,children:[s(P,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(et,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(wi,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(V.span,{fontWeight:"medium",children:B!=null?B:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(V.span,{fontWeight:"medium",children:Fe(ie||0,2)})]})]}),s(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(De,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:f.map(q=>e(te,{size:"sm",onClick:()=>{C(q.key),M(_i(q))},variant:j===q.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:q.label},q.key))}),s(De,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[s(Vs,{placement:n,isOpen:Ie,onClose:()=>{le(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e($s,{children:e(te,{size:"sm",variant:"outline",leftIcon:e(ch,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(Ie){le(!1);return}G([N.start,N.end]),le(!0)},children:O})}),s(Js,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Ks,{}),s(Ys,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(os,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(ze=ge[0])!=null?ze:void 0,endDate:(Me=ge[1])!=null?Me:void 0,calendarClassName:"usage-range-datepicker",onChange:q=>{const[ye,_e]=q!=null?q:[null,null];if(G([ye,_e]),ye&&_e){const Be=hh(ye,_e);C("custom"),M(Be),le(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(Ge,{value:B!=null?B:"",onChange:q=>re(q.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!Q.length,children:Q.map(q=>e("option",{value:q.username,children:q.username},q.username))})]})]})]}),e(z,{mt:6,children:pe?s(X,{spacing:3,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):A.series&&A.series.length?e(gr,{options:A.options,series:A.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};Te.extend(qs);const fh=V(ya,{baseStyle:{w:4,h:4}}),Xn=V(Bs,{baseStyle:{w:4,h:4}}),jn=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],Di=t=>{const a=t.unit==="hour"?"hour":"day",r=Te().utc().endOf(a),o=Math.max(t.amount-1,0),n=r.subtract(o,t.unit).startOf(a);return{key:t.key,start:n.toDate(),end:r.toDate(),unit:t.unit}},bh=(t,a)=>{const r=Te(t),o=Te(a),[n,l]=r.isBefore(o)?[r,o]:[o,r],i=n.startOf("day"),c=l.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Ai=t=>Te(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Ii=t=>Te(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Ei=(t,a)=>{if(!t)return t;const r=Te.utc(t);return r.isValid()?a==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},Ti=(t,a,r)=>{const o=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:a,labels:{style:{colors:a.map(()=>o)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:n=>Fe(Number(n)||0,1),style:{colors:[o]}},title:{text:r,style:{color:o}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:n=>Fe(Number(n)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},yh=(t,a)=>({labels:a,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Fe(Number(r)||0,2),title:{formatter:(r,o)=>{var n,l,i,c;return(c=(i=(l=(n=o==null?void 0:o.w)==null?void 0:n.globals)==null?void 0:l.labels)==null?void 0:i[o.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),Sh=({services:t,selectedServiceId:a})=>{var he,Z,ne,ht,Je,J;const{t:r}=Ne(),{colorMode:o}=Ur(),n="auto-end",l=(he=Xt({base:"bottom",md:"auto-end"}))!=null?he:n,i=d.exports.useMemo(()=>t.map(E=>({id:E.id,name:E.name})),[t]),c=d.exports.useMemo(()=>a||(i.length?i[0].id:null),[a,i]),u=(Z=jn.find(E=>E.key==="30d"))!=null?Z:jn[0],[m,g]=d.exports.useState(c),[p,D]=d.exports.useState(()=>Di(u)),[I,k]=d.exports.useState(u.key),[f,v]=d.exports.useState([null,null]),[N,M]=d.exports.useState(!1),[j,C]=d.exports.useState([]),[B,re]=d.exports.useState("day"),[_,K]=d.exports.useState([]),[pe,be]=d.exports.useState(!1),[Ie,le]=d.exports.useState(!1),[ge,G]=d.exports.useState(null),[Q,w]=d.exports.useState([]),[me,xe]=d.exports.useState("day"),[$,y]=d.exports.useState(""),[x,A]=d.exports.useState(!1);d.exports.useEffect(()=>{g(c)},[c]),d.exports.useEffect(()=>{if(!m){C([]),K([]),w([]),G(null),y("");return}const E={start:Ai(p.start),end:Ii(p.end)},ae=p.unit==="hour"?"hour":"day";let fe=!1;return be(!0),we(`/v2/services/${m}/usage/timeseries`,{query:{...E,granularity:ae}}).then(Ue=>{var Ke,rt;fe||!Ue||(C((Ke=Ue.points)!=null?Ke:[]),re((rt=Ue.granularity)!=null?rt:ae))}).catch(()=>{fe||(C([]),re(ae))}).finally(()=>{fe||be(!1)}),le(!0),we(`/v2/services/${m}/usage/admins`,{query:E}).then(Ue=>{var Ke;fe||!Ue||K((Ke=Ue.admins)!=null?Ke:[])}).catch(()=>{fe||K([])}).finally(()=>{fe||le(!1)}),()=>{fe=!0}},[m,p.start,p.end,p.unit]),d.exports.useEffect(()=>{if(!m){G(null),w([]),y("");return}if(!_.length){G(null);return}G(E=>{var Ke,rt;const ae=_.map(bt=>bt.admin_id);if(E===null){if(ae.includes(null))return E}else if(ae.includes(E))return E;const fe=_.find(bt=>(bt.used_traffic||0)>0);if(fe)return(Ke=fe.admin_id)!=null?Ke:null;const Ue=_[0];return(rt=Ue==null?void 0:Ue.admin_id)!=null?rt:null})},[_,m]),d.exports.useEffect(()=>{if(!m){w([]),y(""),xe("day");return}if(ge===void 0)return;if(!_.length&&ge===null){w([]),y("");return}const E=p.unit==="hour"?"hour":"day",ae=ge===null?"null":Number.isFinite(ge)?String(ge):"null";let fe=!1;return A(!0),we(`/v2/services/${m}/usage/admin-timeseries`,{query:{start:Ai(p.start),end:Ii(p.end),granularity:E,admin_id:ae}}).then(Ue=>{var Ke,rt,bt;fe||!Ue||(w((Ke=Ue.points)!=null?Ke:[]),xe((rt=Ue.granularity)!=null?rt:E),y((bt=Ue.username)!=null?bt:""))}).catch(()=>{fe||(w([]),y(""),xe(E))}).finally(()=>{fe||A(!1)}),()=>{fe=!0}},[_,p.end,p.start,p.unit,ge,m]);const ie=d.exports.useMemo(()=>{const E=Te(p.start).format("YYYY-MM-DD"),ae=Te(p.end).format("YYYY-MM-DD");return`${E} \u2013 ${ae}`},[p.start,p.end]),O=d.exports.useMemo(()=>j.map(E=>Ei(E.timestamp,B)),[j,B]),ue=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:j.map(E=>E.used_traffic)}],[j,r]),ve=d.exports.useMemo(()=>Ti(o,O,r("services.usageYAxis","Usage")),[O,o,r]),ze=d.exports.useMemo(()=>_.map(E=>({value:E.admin_id===null?"null":String(E.admin_id),label:E.username||r("services.unassignedAdmin","Unassigned")})),[_,r]),Me=d.exports.useMemo(()=>{var ae,fe;const E=ge===null?"null":String(ge);return(fe=(ae=ze.find(Ue=>Ue.value===E))==null?void 0:ae.label)!=null?fe:ge===null?r("services.unassignedAdmin","Unassigned"):""},[ze,ge,r]),q=d.exports.useMemo(()=>Q.map(E=>Ei(E.timestamp,me)),[Q,me]),ye=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:Q.map(E=>E.used_traffic)}],[Q,r]),_e=d.exports.useMemo(()=>Ti(o,q,r("services.usageYAxis","Usage")),[q,o,r]),Be=d.exports.useMemo(()=>Q.reduce((E,ae)=>E+(ae.used_traffic||0),0),[Q]),Ve=d.exports.useMemo(()=>_.map(E=>E.used_traffic),[_]),Ze=d.exports.useMemo(()=>_.map(E=>E.username||r("services.unassignedAdmin","Unassigned")),[_,r]),dt=d.exports.useMemo(()=>yh(o,Ze),[o,Ze]),oe=d.exports.useMemo(()=>_.reduce((E,ae)=>E+(ae.used_traffic||0),0),[_]);return i.length===0?s(X,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(z,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):s(X,{spacing:4,align:"stretch",children:[s(P,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),s(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(Ge,{value:m!=null?m:"",onChange:E=>g(Number(E.target.value)||null),minW:{md:"220px"},children:i.map(E=>e("option",{value:E.id,children:E.name},E.id))}),e(De,{direction:{base:"column",sm:"row"},spacing:2,children:jn.map(E=>e(te,{size:"sm",variant:I===E.key?"solid":"outline",colorScheme:"primary",onClick:()=>{k(E.key),D(Di(E))},children:E.label},E.key))}),s(Vs,{placement:l,isOpen:N,onClose:()=>M(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e($s,{children:e(te,{size:"sm",variant:"outline",leftIcon:e(fh,{}),onClick:()=>{v([p.start,p.end]),M(E=>!E)},children:ie})}),s(Js,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Ks,{}),s(Ys,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(os,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(ne=f[0])!=null?ne:void 0,endDate:(ht=f[1])!=null?ht:void 0,calendarClassName:"usage-range-datepicker",onChange:E=>{const[ae,fe]=E!=null?E:[null,null];if(v([ae,fe]),ae&&fe){const Ue=bh(ae,fe);k("custom"),D(Ue),M(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),s(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(P,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),s(P,{fontSize:"sm",color:"gray.500",children:[e(Xn,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(V.span,{fontWeight:"medium",children:Fe(j.reduce((E,ae)=>E+(ae.used_traffic||0),0),2)})]})]})]}),e(z,{mt:4,children:pe?s(X,{spacing:3,py:10,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):j.length?e(gr,{type:"area",height:360,options:ve,series:ue}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(De,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(X,{align:"start",spacing:1,children:[e(et,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:s(P,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(Xn,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(V.span,{fontWeight:"medium",children:Me||$||"-"})," ",r("services.totalUsage","Total"),":"," ",e(V.span,{fontWeight:"medium",children:Fe(Be||0,2)})]})]}),e(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(Ge,{size:"sm",minW:{md:"200px"},value:ge===null?"null":String(ge),onChange:E=>{const ae=E.target.value;if(ae==="null"){G(null);return}const fe=Number(ae);G(Number.isNaN(fe)?null:fe)},isDisabled:ze.length===0,children:ze.map(E=>e("option",{value:E.value,children:E.label},E.value))})})]}),e(z,{mt:4,children:x?s(X,{spacing:3,py:10,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(J=(Je=ye[0])==null?void 0:Je.data)!=null&&J.length?e(gr,{type:"area",height:360,options:_e,series:ye}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[s(P,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),s(P,{fontSize:"sm",color:"gray.500",children:[e(Xn,{}),s(h,{children:[r("services.totalUsage","Total")," ",e(V.span,{fontWeight:"medium",children:Fe(oe,2)})]})]})]}),s(De,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:Ie?s(X,{spacing:3,py:8,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):_.length&&oe>0?e(gr,{type:"donut",height:320,options:dt,series:Ve}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(X,{flex:"1",align:"stretch",spacing:2,children:_.length?_.map(E=>{var ae;return s(P,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:E.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:Fe(E.used_traffic||0,2)})]},`${(ae=E.admin_id)!=null?ae:"na"}-${E.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};Te.extend(qs);const xh=V(ya,{baseStyle:{w:4,h:4}}),pn=V(Bs,{baseStyle:{w:4,h:4}}),Is={key:"30d",label:"30d",amount:30,unit:"day"},zi=t=>{if(!t)return t;const a=t.includes(" "),r=a?t.replace(" ","T"):t,o=Te.utc(r);return o.isValid()?a?o.local().format("MM-DD HH:mm"):o.format("YYYY-MM-DD"):t},Es=t=>Te(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Ts=t=>Te(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Ar=t=>{const a=t.unit==="hour"?"hour":"day",r=Te().utc().endOf(a),o=Math.max(t.amount-1,0),n=r.subtract(o,t.unit).startOf(a);return{key:t.key,start:n.toDate(),end:r.toDate(),unit:t.unit}},fn=(t,a)=>{const r=Te(t),o=Te(a),[n,l]=r.isBefore(o)?[r,o]:[o,r],i=n.startOf("day"),c=l.endOf("day"),u=i.isSame(c,"day");return{key:"custom",start:i.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Li=(t,a)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:a,labels:{style:{colors:a.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Fe(Number(o)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Fe(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},bn=({presets:t,range:a,onPresetChange:r,onCustomChange:o})=>{var k,f,v;const{t:n}=Ne(),l="auto-end",i=(k=Xt({base:"bottom",md:"auto-end"}))!=null?k:l,c=Te(a.start).format("YYYY-MM-DD"),u=Te(a.end).format("YYYY-MM-DD"),m=c===u?c:`${c} - ${u}`,[g,p]=d.exports.useState(!1),[D,I]=d.exports.useState([a.start,a.end]);return d.exports.useEffect(()=>{g||I([a.start,a.end])},[g,a.start,a.end]),s(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(De,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(N=>e(te,{size:"sm",onClick:()=>r(N.key),colorScheme:"primary",variant:a.key===N.key?"solid":"outline",w:{base:"full",sm:"auto"},children:N.label},N.key))}),s(Vs,{placement:i,isOpen:g,onClose:()=>{p(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e($s,{children:e(te,{size:"sm",variant:"outline",leftIcon:e(xh,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(g){p(!1);return}I([a.start,a.end]),p(!0)},children:m})}),s(Js,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Ks,{}),s(Ys,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(os,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(f=D[0])!=null?f:void 0,endDate:(v=D[1])!=null?v:void 0,calendarClassName:"usage-range-datepicker",onChange:N=>{const[M,j]=N!=null?N:[null,null];I([M,j]),M&&j&&(o(M,j),p(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:n("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},kh=()=>{var er,Jt,Mt,Lt,pt,Vt,It,tr;const{t}=Ne(),a=Rt(),{colorMode:r}=Ur(),{data:o}=xa(),{fetchNodesUsage:n}=Qs(),{userData:l}=qr(),i=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(Jt=(er=i.find(U=>U.key==="30d"))!=null?er:i[0])!=null?Jt:Is,[u,m]=d.exports.useState(()=>Ar(c)),[g,p]=d.exports.useState([]),[D,I]=d.exports.useState(!1),[k,f]=d.exports.useState(()=>Ar(c)),[v,N]=d.exports.useState(null),[M,j]=d.exports.useState(!1),[C,B]=d.exports.useState([]),[re,_]=d.exports.useState(null),[K,pe]=d.exports.useState(()=>Ar(c)),[be,Ie]=d.exports.useState(()=>Ar(c)),[le,ge]=d.exports.useState([]),[G,Q]=d.exports.useState(null),[w,me]=d.exports.useState(null),[xe,$]=d.exports.useState([]),[y,x]=d.exports.useState([]),[A,ie]=d.exports.useState(!1),[O,ue]=d.exports.useState(null),[ve,ze]=d.exports.useState(!1),[Me,q]=d.exports.useState([]),[ye,_e]=d.exports.useState(null),Be=d.exports.useCallback(U=>U?(Array.isArray(U)?U:Object.values(U)).map(L=>{var b,S,R,Ae;return{nodeId:Number((b=L==null?void 0:L.node_id)!=null?b:0),nodeName:(S=L==null?void 0:L.node_name)!=null?S:t("nodes.unknownNode","Unknown"),total:Number((R=L==null?void 0:L.uplink)!=null?R:0)+Number((Ae=L==null?void 0:L.downlink)!=null?Ae:0)}}):[],[t]),Ve=d.exports.useCallback(U=>{var L;const ee=(L=i.find(b=>b.key===U))!=null?L:Is;m(Ar(ee))},[i]),Ze=d.exports.useCallback((U,ee)=>{const L=fn(U,ee);m(L)},[]),dt=d.exports.useCallback(U=>{var L;const ee=(L=i.find(b=>b.key===U))!=null?L:Is;f(Ar(ee))},[i]),oe=d.exports.useCallback((U,ee)=>{const L=fn(U,ee);f(L)},[]),he=d.exports.useCallback(U=>{var L;const ee=(L=i.find(b=>b.key===U))!=null?L:Is;Ie(Ar(ee))},[i]),Z=d.exports.useCallback((U,ee)=>{const L=fn(U,ee);Ie(L)},[]),ne=d.exports.useCallback(U=>{var L;const ee=(L=i.find(b=>b.key===U))!=null?L:Is;pe(Ar(ee))},[i]),ht=d.exports.useCallback((U,ee)=>{const L=fn(U,ee);pe(L)},[]),Je=d.exports.useMemo(()=>g.reduce((U,ee)=>U+ee.total,0),[g]),J=d.exports.useMemo(()=>{const U=g.map(L=>L.total),ee=g.map(L=>L.nodeName);return En(r,`${t("userDialog.total")} ${Fe(Je||0,2)}`,U,ee)},[r,g,t,Je]),E=d.exports.useMemo(()=>C.map(U=>zi(U.date)),[C]),ae=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:C.map(U=>U.used_traffic)}],[C,t]),fe=d.exports.useMemo(()=>C.reduce((U,ee)=>U+ee.used_traffic,0),[C]),Ue=d.exports.useMemo(()=>({options:Li(r,E),series:ae}),[r,E,ae]),Ke=d.exports.useMemo(()=>y.reduce((U,ee)=>U+ee.total,0),[y]),rt=d.exports.useMemo(()=>{const U=y.map(L=>L.total),ee=y.map(L=>L.nodeName);return En(r,`${t("userDialog.total")} ${Fe(Ke||0,2)}`,U,ee)},[y,r,t,Ke]),bt=d.exports.useMemo(()=>Me.map(U=>zi(U.date)),[Me]),Tt=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:Me.map(U=>U.used_traffic)}],[Me,t]),W=d.exports.useMemo(()=>Me.reduce((U,ee)=>U+ee.used_traffic,0),[Me]),ke=d.exports.useMemo(()=>({options:Li(r,bt),series:Tt}),[r,bt,Tt]),He=d.exports.useMemo(()=>{const U=[],ee=new Set;return g.forEach(L=>{L.nodeId>0&&!ee.has(L.nodeId)&&(ee.add(L.nodeId),U.push({value:L.nodeId,label:L.nodeName}))}),Array.isArray(o)&&o.forEach(L=>{(L==null?void 0:L.id)&&!ee.has(L.id)&&(ee.add(L.id),U.push({value:L.id,label:L.name}))}),U.sort((L,b)=>L.label.localeCompare(b.label))},[g,o]),st=d.exports.useMemo(()=>{const U=[],ee=new Set;return xe.forEach(L=>{ee.has(L.nodeId)||(ee.add(L.nodeId),U.push({value:L.nodeId,label:L.nodeName}))}),ee.has(0)||U.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(o)&&o.forEach(L=>{(L==null?void 0:L.id)&&!ee.has(L.id)&&(ee.add(L.id),U.push({value:L.id,label:L.name}))}),U.sort((L,b)=>L.label.localeCompare(b.label))},[xe,o,t]),yt=d.exports.useMemo(()=>le.map(U=>({value:U,label:U})),[le]),zt=d.exports.useMemo(()=>{const U=new Map;return Array.isArray(o)&&o.forEach(ee=>{(ee==null?void 0:ee.id)!=null&&U.set(ee.id,ee.name)}),U},[o]);return d.exports.useEffect(()=>{let U=!1;return I(!0),n({start:Es(u.start),end:Ts(u.end)}).then(ee=>{if(U)return;const L=Be(ee==null?void 0:ee.usages);p(L)}).catch(ee=>{U||(console.error("Error fetching usage data:",ee),p([]),a({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{U||I(!1)}),()=>{U=!0}},[n,u,Be,a,t]),d.exports.useEffect(()=>{!(l!=null&&l.username)||(Q(U=>U!=null?U:l.username),me(U=>U!=null?U:l.username),l.is_sudo||ge([l.username]))},[l]),d.exports.useEffect(()=>{if(!(l!=null&&l.is_sudo))return;let U=!1;return we("/admins").then(ee=>{if(U)return;const b=(Array.isArray(ee)?ee:Array.isArray(ee==null?void 0:ee.admins)?ee.admins:[]).map(R=>R==null?void 0:R.username).filter(R=>typeof R=="string"),S=Array.from(new Set(b)).sort((R,Ae)=>R.localeCompare(Ae));if(!S.length&&(l==null?void 0:l.username)){ge([l.username]);return}ge(S),Q(R=>{var Ae,Re;return R&&S.includes(R)?R:(Re=(Ae=S[0])!=null?Ae:R)!=null?Re:null}),me(R=>{var Ae,Re;return R&&S.includes(R)?R:(Re=(Ae=S[0])!=null?Ae:R)!=null?Re:null})}).catch(ee=>{console.error("Error fetching admins:",ee)}),()=>{U=!0}},[l==null?void 0:l.is_sudo,l==null?void 0:l.username]),d.exports.useEffect(()=>{var ee,L;if(v!==null)return;const U=(ee=g.filter(b=>b.nodeId>0).sort((b,S)=>S.total-b.total)[0])==null?void 0:ee.nodeId;if(U&&U>0){N(U);return}if(Array.isArray(o)&&o.length){const b=(L=o[0])==null?void 0:L.id;b&&N(b)}},[v,g,o]),d.exports.useEffect(()=>{ue(null)},[G]),d.exports.useEffect(()=>{if(!G){$([]),ue(null);return}let U=!1;const ee={start:Es(be.start),end:Ts(be.end)};return we(`/admin/${encodeURIComponent(G)}/usage/nodes`,{query:ee}).then(L=>{if(U)return;const b=Be(L==null?void 0:L.usages);$(b),ue(S=>{var Ae,Re,Qe;if(S!==null)return S;const R=(Ae=b.filter(Ce=>Ce.nodeId!==0).sort((Ce,We)=>We.total-Ce.total)[0])==null?void 0:Ae.nodeId;return typeof R=="number"?R:(Qe=(Re=b[0])==null?void 0:Re.nodeId)!=null?Qe:0})}).catch(L=>{U||(console.error("Error fetching daily admin nodes:",L),$([]),ue(null),a({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{U=!0}},[G,be,Be,a,t]),d.exports.useEffect(()=>{if(!w){x([]),ie(!1);return}let U=!1;return ie(!0),we(`/admin/${encodeURIComponent(w)}/usage/nodes`,{query:{start:Es(K.start),end:Ts(K.end)}}).then(ee=>{if(U)return;const L=Be(ee==null?void 0:ee.usages);x(L)}).catch(ee=>{U||(console.error("Error fetching admin totals nodes:",ee),x([]),a({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{U||ie(!1)}),()=>{U=!0}},[w,K,Be,a,t]),d.exports.useEffect(()=>{if(v===null){B([]),_(null);return}let U=!1;j(!0);const ee={start:Es(k.start),end:Ts(k.end)};return k.unit==="hour"&&(ee.granularity="hour"),we(`/node/${v}/usage/daily`,{query:ee}).then(L=>{var Ae,Re,Qe;if(U)return;const S=(Array.isArray(L==null?void 0:L.usages)?L.usages:[]).map(Ce=>{var We,mt;return{date:(We=Ce==null?void 0:Ce.date)!=null?We:"",used_traffic:Number((mt=Ce==null?void 0:Ce.used_traffic)!=null?mt:0)}});B(S);const R=(Re=(Ae=L==null?void 0:L.node_name)!=null?Ae:zt.get(v))!=null?Re:t("nodes.unknownNode","Unknown");_({nodeName:R,nodeId:(Qe=L==null?void 0:L.node_id)!=null?Qe:v})}).catch(L=>{U||(console.error("Error fetching node daily usage:",L),B([]),a({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{U||j(!1)}),()=>{U=!0}},[v,k,zt,a,t]),d.exports.useEffect(()=>{if(!G){q([]),_e(null);return}if(O===null){q([]),_e(null);return}let U=!1;ze(!0);const ee={start:Es(be.start),end:Ts(be.end)};return O!=null&&(ee.node_id=O),be.unit==="hour"&&(ee.granularity="hour"),we(`/admin/${encodeURIComponent(G)}/usage/chart`,{query:ee}).then(L=>{var R,Ae,Re,Qe;if(U)return;const S=(Array.isArray(L==null?void 0:L.usages)?L.usages:[]).map(Ce=>{var We,mt;return{date:(We=Ce==null?void 0:Ce.date)!=null?We:"",used_traffic:Number((mt=Ce==null?void 0:Ce.used_traffic)!=null?mt:0)}});q(S),_e({nodeName:(Re=(Ae=L==null?void 0:L.node_name)!=null?Ae:(R=st.find(Ce=>Ce.value===O))==null?void 0:R.label)!=null?Re:null,nodeId:(Qe=L==null?void 0:L.node_id)!=null?Qe:O})}).catch(L=>{U||(console.error("Error fetching admin usage chart:",L),q([]),a({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{U||ze(!1)}),()=>{U=!0}},[G,O,be,st,t,a]),s(X,{spacing:6,align:"stretch",children:[s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(De,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(X,{align:"start",spacing:1,children:[e(et,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:s(P,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(pn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(V.span,{fontWeight:"medium",children:Fe(Je||0,2)})]})]}),e(bn,{presets:i,range:u,onPresetChange:Ve,onCustomChange:Ze})]}),e(z,{mt:6,children:D?s(X,{spacing:3,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):J.series.length?e(gr,{options:J.options,series:J.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(De,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(X,{align:"start",spacing:1,children:[e(et,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:s(P,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(pn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(V.span,{fontWeight:"medium",children:(Mt=re==null?void 0:re.nodeName)!=null?Mt:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(V.span,{fontWeight:"medium",children:Fe(fe||0,2)})]})]}),s(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ge,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:v!=null?v:"",onChange:U=>{const ee=U.target.value;if(!ee){N(null);return}const L=Number(ee);N(Number.isFinite(L)&&L>0?L:null)},placeholder:t("nodes.selectNode","Select node"),children:He.map(U=>e("option",{value:U.value,children:U.label},U.value))}),e(bn,{presets:i,range:k,onPresetChange:dt,onCustomChange:oe})]})]}),e(z,{mt:6,children:M?s(X,{spacing:3,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(pt=(Lt=ae[0])==null?void 0:Lt.data)!=null&&pt.length?e(gr,{options:Ue.options,series:Ue.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(De,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[s(X,{align:"start",spacing:1,children:[e(et,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:s(P,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(pn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(V.span,{fontWeight:"medium",children:G!=null?G:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(V.span,{fontWeight:"medium",children:(Vt=ye==null?void 0:ye.nodeName)!=null?Vt:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(V.span,{fontWeight:"medium",children:Fe(W||0,2)})]})]}),s(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ge,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:G!=null?G:"",onChange:U=>Q(U.target.value||null),isDisabled:yt.length===0,children:yt.map(U=>e("option",{value:U.value,children:U.label},U.value))}),e(Ge,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:O!=null?O:"",onChange:U=>{const ee=U.target.value;if(ee===""){ue(null);return}const L=Number(ee);ue(Number.isNaN(L)?null:L)},placeholder:t("nodes.selectNode","Select node"),children:st.map(U=>e("option",{value:U.value,children:U.label},U.value))}),e(bn,{presets:i,range:be,onPresetChange:he,onCustomChange:Z})]})]}),e(z,{mt:6,children:ve?s(X,{spacing:3,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(tr=(It=Tt[0])==null?void 0:It.data)!=null&&tr.length?e(gr,{options:ke.options,series:ke.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),s(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[s(De,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[s(X,{align:"start",spacing:1,children:[e(et,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:s(P,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(pn,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),s(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(V.span,{fontWeight:"medium",children:w!=null?w:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(V.span,{fontWeight:"medium",children:Fe(Ke||0,2)})]})]}),s(De,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(Ge,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:w!=null?w:"",onChange:U=>me(U.target.value||null),isDisabled:yt.length===0,children:yt.map(U=>e("option",{value:U.value,children:U.label},U.value))}),e(bn,{presets:i,range:K,onPresetChange:ne,onCustomChange:ht})]})]}),e(z,{mt:6,children:A?s(X,{spacing:3,children:[e(lt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):rt.series.length?e(gr,{options:rt.options,series:rt.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},wh=()=>{const{t}=Ne(),{userData:a,getUserIsSuccess:r}=qr(),o=r&&a.is_sudo,n=ss(i=>i.services),l=ss(i=>i.fetchServices);return d.exports.useEffect(()=>{o&&l({limit:500})},[l,o]),r?o?s(X,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),s(Ws,{variant:"enclosed",colorScheme:"primary",children:[s(Fs,{children:[e(Ht,{children:t("usage.tabs.services","Services")}),e(Ht,{children:t("usage.tabs.admins","Admins")}),e(Ht,{children:t("usage.tabs.nodes","Nodes")})]}),s(Hs,{children:[e(Bt,{px:0,children:e(Sh,{services:n})}),e(Bt,{px:0,children:e(ph,{})}),e(Bt,{px:0,children:e(kh,{})})]})]})]}):s(X,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(Nt,{justify:"center",align:"center",py:10,children:e(lt,{})})},vh=async()=>we("/settings/telegram"),Ch=async t=>we("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),Io="__dot__",ca=t=>t.replace(/\./g,Io),es=t=>t.replace(new RegExp(Io,"g"),"."),_h=t=>{const a={},r=(o,n)=>{if(n!==void 0){if(typeof n=="boolean"){a[es(o)]=n;return}if(typeof n=="string"){if(n==="")return;n==="true"||n==="false"?a[es(o)]=n==="true":a[es(o)]=Boolean(n);return}if(typeof n=="number"){a[es(o)]=n!==0;return}if(Array.isArray(n)){a[es(o)]=n.length>0;return}if(n&&typeof n=="object"){Object.entries(n).forEach(([l,i])=>{const c=o?`${o}.${l}`:l;r(c,i)});return}a[es(o)]=Boolean(n)}};return Object.entries(t).forEach(([o,n])=>{r(o,n)}),a},Eo=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],Dh=Eo.flatMap(t=>t.events.map(a=>a.key)),Ah=V(fr,{baseStyle:{w:4,h:4}}),Ih=V(jl,{baseStyle:{w:4,h:4}}),ea=t=>{var o,n,l;const a={};Object.entries(t.forum_topics||{}).forEach(([i,c])=>{var u;a[i]={title:(u=c.title)!=null?u:"",topic_id:c.topic_id!=null?String(c.topic_id):""}});const r={};return Dh.forEach(i=>{var m;const c=ca(i),u=(m=t.event_toggles)==null?void 0:m[i];r[c]=u===void 0?!0:Boolean(u)}),Object.entries(t.event_toggles||{}).forEach(([i,c])=>{const u=ca(i);u in r||(r[u]=Boolean(c))}),{api_token:(o=t.api_token)!=null?o:"",proxy_url:(n=t.proxy_url)!=null?n:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(l=t.default_vless_flow)!=null?l:"",forum_topics:a,event_toggles:r}},Eh=t=>t.split(/[\s,]+/).map(a=>a.trim()).filter(a=>a.length>0).map(a=>Number(a)).filter(a=>Number.isFinite(a)),Th=()=>{const{t}=Ne(),a=Rt(),r=ba(),{data:o,isLoading:n,refetch:l}=vr("telegram-settings",vh,{refetchOnWindowFocus:!1}),{register:i,control:c,handleSubmit:u,reset:m,watch:g,formState:{isDirty:p}}=or({defaultValues:ea(o!=null?o:{api_token:null,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{o&&m(ea(o))},[o,m]);const D=cr(Ch,{onSuccess:f=>{m(ea(f)),r.setQueryData("telegram-settings",f),a({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{a({title:t("errors.generic","Something went wrong"),status:"error"})}}),I=f=>{const v=_h(f.event_toggles||{}),N={api_token:f.api_token.trim()||null,proxy_url:f.proxy_url.trim()||null,admin_chat_ids:Eh(f.admin_chat_ids),logs_chat_id:f.logs_chat_id.trim()?Number(f.logs_chat_id.trim()):null,logs_chat_is_forum:f.logs_chat_is_forum,default_vless_flow:f.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(f.forum_topics||{}).map(([M,j])=>[M,{title:j.title,topic_id:j.topic_id.trim()?Number(j.topic_id.trim()):void 0}])),event_toggles:v};D.mutate(N)},k=g("forum_topics");return s(z,{px:{base:4,md:8},py:{base:6,md:8},children:[e(Wn,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),s(Ws,{colorScheme:"primary",children:[s(Fs,{children:[e(Ht,{children:t("settings.telegram","Telegram")}),e(Ht,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),s(Hs,{children:[e(Bt,{px:{base:0,md:2},children:n&&!o?e(Nt,{align:"center",justify:"center",py:12,children:e(lt,{size:"lg"})}):e("form",{onSubmit:u(I),children:s(X,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),s(ot,{columns:{base:1,md:2},spacing:6,children:[s(F,{children:[e(H,{children:t("settings.telegram.apiToken","Bot API Token")}),e(de,{placeholder:"123456:ABC",...i("api_token")})]}),s(F,{children:[e(H,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(de,{placeholder:"socks5://user:pass@host:port",...i("proxy_url")})]}),s(F,{children:[e(H,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(de,{placeholder:"12345, 67890",...i("admin_chat_ids")}),e(yr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),s(F,{children:[e(H,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(de,{placeholder:"-100123456789",...i("logs_chat_id")}),e(yr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),s(F,{display:"flex",alignItems:"center",children:[e(H,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(vt,{control:c,name:"logs_chat_is_forum",render:({field:f})=>e(Ct,{id:"logs_chat_is_forum",isChecked:f.value,onChange:f.onChange})})]}),s(F,{children:[e(H,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(de,{placeholder:"xtls-rprx-vision",...i("default_vless_flow")})]})]}),s(z,{children:[e(Wn,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),k&&Object.keys(k).length>0?e(De,{spacing:4,children:Object.entries(k).map(([f])=>s(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[s(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",f]}),s(ot,{columns:{base:1,md:2},spacing:4,children:[s(F,{children:[e(H,{children:t("settings.telegram.topicTitle","Topic Title")}),e(de,{...i(`forum_topics.${f}.title`)})]}),s(F,{children:[e(H,{children:t("settings.telegram.topicId","Topic ID")}),e(de,{type:"number",...i(`forum_topics.${f}.topic_id`)}),e(yr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},f))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]}),s(z,{children:[e(Wn,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(De,{spacing:4,children:Eo.map(f=>s(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(f.titleKey,f.defaultTitle)}),e(ot,{columns:{base:1,md:2},spacing:4,children:f.events.map(v=>s(F,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[s(z,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(v.labelKey,v.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(v.hintKey,v.defaultHint)})]}),e(vt,{control:c,name:`event_toggles.${ca(v.key)}`,render:({field:N})=>e(Ct,{isChecked:Boolean(N.value),onChange:M=>N.onChange(M.target.checked)})})]},v.key))})]},f.key))})]}),s(Nt,{gap:3,justify:"flex-end",children:[e(te,{variant:"outline",leftIcon:e(Ah,{}),onClick:()=>l(),isDisabled:D.isLoading,children:t("actions.refresh","Refresh")}),e(te,{colorScheme:"primary",leftIcon:e(Ih,{}),type:"submit",isLoading:D.isLoading,isDisabled:!p&&!D.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(Bt,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},zh=async()=>{try{const t=In();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const a=await we("/admin",{headers:{Authorization:`Bearer ${t}`}});if(a&&typeof a=="object"&&"error"in a)throw new Error(`API error: ${a.error||"Unknown error"}`);return a}catch(t){throw console.error("Loader error:",t),t}},Lh=ec([{path:"/",element:e(Qc,{}),errorElement:e(qa,{}),loader:zh,children:[{index:!0,element:e(nd,{})},{path:"users",element:e(Gd,{})},{path:"admins",element:e(eu,{})},{path:"usage",element:e(wh,{})},{path:"services",element:e(lh,{})},{path:"hosts",element:e(pu,{})},{path:"node-settings",element:e(Ru,{})},{path:"integrations",element:e(Th,{})},{path:"xray-settings",element:e(ih,{})},{path:"xray-logs",element:e(Ao,{})}]},{path:"/login/",element:e(qa,{})}]);function Ph(){return e(tc,{router:Lh})}Te.extend(rc);Te.extend(sc);Te.extend(qs);Te.extend(nc);Te.extend(ac);xn(ic.get()||"light");oc.createRoot(document.getElementById("root")).render(e(ta.StrictMode,{children:e(lc,{theme:dc,children:e(cc,{client:Sn,children:e(Ph,{})})})}));
