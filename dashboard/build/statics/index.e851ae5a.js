var uc=Object.defineProperty;var hc=(t,s,r)=>s in t?uc(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var J=(t,s,r)=>(hc(t,typeof s!="symbol"?s+"":s,r),r);import{i as Pi,B as pc,a as mc,b as gc,j as al,d as Me,U as Pa,z as fc,r as bc,f as yc,Q as Sc,e as xc,m as Ot,$ as vc,c as ie,X as Ta,R as ba,N as ts,I as De,g as rs,h as n,F as C,k as e,l as D,n as Nr,o as wc,p as Ea,q as Bt,s as kc,t as Cc,u as _c,v as Dc,w as Hr,x as nn,L as ol,C as hi,y as qe,A as We,M as ni,D as Cs,E as He,G as si,H as ir,J as M,K as ll,T as h,S as Ac,P as Ic,O as ya,V as Sn,W as Mi,Y as Na,Z as za,_ as Pc,a0 as er,a1 as Zr,a2 as Zt,a3 as d,a4 as Ya,a5 as z,a6 as Ui,a7 as O,a8 as Wi,a9 as Wt,aa as _t,ab as Ft,ac as It,ad as Ht,ae as Dt,af as he,ag as Fe,ah as fe,ai as ur,aj as Ut,ak as Pr,al as ke,am as Tc,an as ii,ao as Ra,ap as Ec,aq as Ma,ar as jr,as as zr,at as An,au as Wr,av as Fr,aw as Wn,ax as Fi,ay as Rr,az as Nc,aA as zc,aB as Rc,aC as Mc,aD as Uc,aE as Lc,aF as Oc,aG as Wc,aH as Fc,aI as Hi,aJ as cl,aK as dl,aL as mt,aM as _s,aN as Ga,aO as Hc,aP as Bc,aQ as Vc,aR as ul,aS as hl,aT as Tr,aU as pt,aV as Hn,aW as Bn,aX as Vn,aY as ls,aZ as $n,a_ as On,a$ as $c,b0 as Kc,b1 as Jc,b2 as qc,b3 as zs,b4 as Yc,b5 as Gc,b6 as an,b7 as vs,b8 as Zn,b9 as lt,ba as Br,bb as Bi,bc as Rt,bd as pl,be as Xc,bf as on,bg as Pn,bh as Qc,bi as ai,bj as yn,bk as ml,bl as Ua,bm as gl,bn as Er,bo as rt,bp as ei,bq as Ti,br as Zc,bs as jc,bt as fl,bu as ed,bv as td,bw as La,bx as bl,by as yl,bz as rd,bA as nd,bB as sd,bC as Sl,bD as id,bE as ad,bF as od,bG as ti,bH as Xa,bI as cs,bJ as ds,bK as Xt,bL as us,bM as Qt,bN as ld,bO as cd,bP as Fn,bQ as dd,bR as tr,bS as ud,bT as St,bU as gt,bV as xl,bW as vl,bX as wl,bY as hd,bZ as kl,b_ as ns,b$ as fn,c0 as zt,c1 as $e,c2 as sn,c3 as Ue,c4 as vi,c5 as ps,c6 as Cl,c7 as _l,c8 as Dl,c9 as Qa,ca as _n,cb as pd,cc as md,cd as gd,ce as oi,cf as Or,cg as Al,ch as fd,ci as bd,cj as Ds,ck as As,cl as pi,cm as Il,cn as yd,co as ws,cp as xs,cq as Ei,cr as Sd,cs as Pl,ct as Oa,cu as Lr,cv as Tl,cw as mi,cx as xd,cy as vd,cz as wd,cA as El,cB as Nl,cC as kd,cD as Cd,cE as _d,cF as Dd,cG as Ad,cH as Id,cI as Pd,cJ as Td,cK as Ed,cL as Nd,cM as Wa,cN as zd,cO as Rn,cP as Rd,cQ as Md,cR as Ud,cS as Ld,cT as Od,cU as Wd,cV as Fd,cW as Hd,cX as Bd,cY as Vd}from"./vendor.da86636a.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();Pi.use(pc).use(mc).use(gc).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:al(["/","statics/locales/{{lng}}.json"])}},function(t,s){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",Pi.language),Me.locale(Pi.language)});Pi.on("languageChanged",t=>{console.log("Language changed to:",t),Me.locale(t)});Pa("zh-cn",fc);Pa("ru",bc);Pa("fa",yc);const Ni=new Sc,zi=(t,s)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:s||"#f6f8ff"},a=s||l[t]||l.default;r==null||r.setAttribute("content",a)},$d=xc({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:Ot("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:Ot("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:Ot("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:Ot("surface.light","surface.dark")(t),borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:Ot("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Ot("lg","dark-lg")(t)},item:{_hover:{bg:Ot("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:Ot("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:Ot("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Ot("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:Ot("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:Ot("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:Ot("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:Ot("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:Ot("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:Ot("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:Ot("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const Is=()=>localStorage.getItem("token"),Kd=t=>{localStorage.setItem("token",t)},Jd=()=>{localStorage.removeItem("token")},qd=vc.create({baseURL:"https://bot.mazholl.com:8585/api"}),Yd=(t,s={})=>(Is()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${Is()}`}),qd(t,s)),ze=Yd,Gd=ie(Ta,{baseStyle:{w:4,h:4}}),or=ba.forwardRef(({disabled:t,step:s,label:r,className:l,startAdornment:a,endAdornment:i,type:o="text",placeholder:c,onChange:u,onBlur:p,name:m,value:g,onClick:x,error:S,clearable:y=!1,...v},E)=>{const T=()=>{u&&u({target:{value:"",name:m}})},{size:L="md"}=v,ce=o=="number"?ts:De,P=o=="number"?rs:ba.Fragment,W=o=="number"?{keepWithinRange:!0,precision:5,format:A=>isNaN(parseFloat(String(A)))||Number(parseFloat(String(A)).toFixed(5))===0?A:Number(parseFloat(String(A)).toFixed(5)),min:typeof v.min=="number"?v.min:v.min!==void 0?Number(v.min):0,step:s,name:m,type:o,placeholder:c,onBlur:p,onClick:x,disabled:t,flexGrow:1,size:L,onChange:(A,X)=>{!u||u({target:{value:A,valueAsNumber:X,name:m}})}}:{};return n(C,{isInvalid:!!S,children:[r&&e(D,{children:r}),n(Nr,{size:L,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[a&&e(wc,{children:a}),n(P,{...W,children:[e(ce,{name:m,ref:E,step:s,className:Ea(l),type:o,placeholder:c,onChange:o==="number"?void 0:u,onBlur:p,value:o==="number"?void 0:g,onClick:x,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...v,roundedLeft:a?"0":"md",roundedRight:i?"0":"md"}),o=="number"&&e(Bt,{children:n(kc,{children:[e(Cc,{}),e(_c,{})]})})]}),i&&e(Dc,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),y&&g&&g.length&&e(Hr,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:T,cursor:"pointer",children:e(Gd,{})})]}),!!S&&e(nn,{children:S})]})}),Sa="/statics/logo.e8dba2f4.svg",Xd=ie(ol,{baseStyle:{w:4,h:4}}),Qd=ie(hi,{baseStyle:{w:4,h:4}}),Zd=({actions:t})=>{const{i18n:s}=qe(),r=We("surface.light","surface.dark"),l=We("blackAlpha.50","whiteAlpha.100"),a=We("blackAlpha.200","whiteAlpha.200"),i=We("gray.800","gray.100"),o=u=>{s.changeLanguage(u)};return n(ni,{placement:"bottom-end",children:[e(Cs,{as:He,size:"sm",variant:"outline",icon:e(Xd,{}),position:"relative"}),e(si,{minW:{base:"70vw",sm:"160px"},zIndex:9999,bg:r,borderColor:a,color:i,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:p,flag:m})=>e(ir,{fontSize:"sm",onClick:()=>o(u),_hover:{bg:l},children:n(M,{justify:"space-between",w:"full",children:[n(M,{spacing:2,children:[e(ll,{countryCode:m,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:p})]}),s.language===u&&e(Qd,{})]})},u))})]})},Za="rb-theme",ja="rb-custom-themes",jd=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],eo=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],to=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],_r={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},Dr={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Xi=.14,Qi=.22,ro=ie(hi,{baseStyle:{w:4,h:4}}),no=ie(Ac,{baseStyle:{w:4,h:4}}),eu=ie(Ic,{baseStyle:{w:4,h:4}}),tu=ie(ya,{baseStyle:{w:4,h:4}}),ru=ie(Sn,{baseStyle:{w:4,h:4}}),so=ie(Mi,{baseStyle:{w:4,h:4}}),nu=ie(Na,{baseStyle:{w:4,h:4}}),su=ie(za,{baseStyle:{w:4,h:4}}),iu=ie(Pc,{baseStyle:{w:4,h:4}}),zl=(t,s=0,r=1)=>Math.min(r,Math.max(s,t)),xa=t=>{const s=t.replace("#",""),r=parseInt(s,16);if(s.length===3){const l=r>>8&15,a=r>>4&15,i=r&15;return{r:l<<4|l,g:a<<4|a,b:i<<4|i}}return{r:r>>16&255,g:r>>8&255,b:r&255}},Rl=(t,s,r)=>{const l=a=>a.toString(16).padStart(2,"0");return`#${l(t)}${l(s)}${l(r)}`},au=(t,s,r)=>{t/=255,s/=255,r/=255;const l=Math.max(t,s,r),a=Math.min(t,s,r);let i=0,o=0;const c=(l+a)/2;if(l!==a){const u=l-a;switch(o=c>.5?u/(2-l-a):u/(l+a),l){case t:i=(s-r)/u+(s<r?6:0);break;case s:i=(r-t)/u+2;break;default:i=(t-s)/u+4}i/=6}return{h:i,s:o,l:c}},ou=(t,s,r)=>{let l,a,i;if(s===0)l=a=i=r;else{const o=(p,m,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?p+(m-p)*6*g:g<.5?m:g<.6666666666666666?p+(m-p)*(.6666666666666666-g)*6:p),c=r<.5?r*(1+s):r+s-r*s,u=2*r-c;l=o(u,c,t+1/3),a=o(u,c,t),i=o(u,c,t-1/3)}return{r:Math.round(l*255),g:Math.round(a*255),b:Math.round(i*255)}},Zi=t=>{try{const{r:s,g:r,b:l}=xa(t),{h:a,s:i,l:o}=au(s,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[p,m])=>{const{r:g,g:x,b:S}=ou(a,i,zl(o+m));return u[`--primary-${p}`]=Rl(g,x,S),u},{})}catch{return{}}},lu=(t,s,r)=>{const l=zl(r,0,1),a=xa(t),i=xa(s),o=(c,u)=>Math.round(c*(1-l)+u*l);return Rl(o(a.r,i.r),o(a.g,i.g),o(a.b,i.b))},ms=(t,s,r,l)=>{try{return lu(t,s,r)}catch{return l}},cu=()=>{const t=document.documentElement;jd.forEach(s=>t.style.removeProperty(s)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},du=(t,s)=>{const r=document.documentElement;Object.entries(t).forEach(([l,a])=>r.style.setProperty(l,a)),r.style.setProperty("--bg-light",s.bgLight),r.style.setProperty("--bg-dark",s.bgDark),r.style.setProperty("--surface-light",s.surfaceLight),r.style.setProperty("--surface-dark",s.surfaceDark)},ji=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},io=()=>({name:"",light:{..._r},dark:{...Dr}}),nr=(t,s)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:s,Ml=({minimal:t=!1,portalContainer:s,trigger:r="icon",triggerLabel:l})=>{const{t:a}=qe(),i=er(),{colorMode:o,toggleColorMode:c}=Zr(),u=Zt(),p=Zt(),m=We("surface.light","surface.dark"),g=We("blackAlpha.50","whiteAlpha.100"),x=We("blackAlpha.200","whiteAlpha.200"),S=We("gray.800","gray.100"),y=We("gray.600","gray.300"),v=We("blackAlpha.400","blackAlpha.700"),E=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:y}}),[y]),[T,L]=d.exports.useState(()=>{try{return localStorage.getItem(Za)||"default"}catch{return"default"}}),[ce,P]=d.exports.useState(()=>{try{const U=localStorage.getItem(ja);if(!U)return[];const j=JSON.parse(U);return Array.isArray(j)?j.map(de=>{var Z,F,pe,Q,Pe,Te;const k=nr(((Z=de.light)==null?void 0:Z.primary)||_r.primary,_r.primary),I=nr(((F=de.light)==null?void 0:F.bg)||_r.bg,_r.bg),R=ms(I,k,Xi,_r.surface),$=nr(((pe=de.light)==null?void 0:pe.surface)||R,R),Ae=nr(((Q=de.dark)==null?void 0:Q.primary)||Dr.primary,Dr.primary),Se=nr(((Pe=de.dark)==null?void 0:Pe.bg)||Dr.bg,Dr.bg),Je=ms(Se,Ae,Qi,Dr.surface),N=nr(((Te=de.dark)==null?void 0:Te.surface)||Je,Je);return{id:de.id||ji(),name:de.name||"Custom",light:{primary:k,bg:I,surface:$},dark:{primary:Ae,bg:Se,surface:N}}}):[]}catch{return[]}}),[W,A]=d.exports.useState(io),[X,q]=d.exports.useState(null),[ge,H]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(ja,JSON.stringify(ce))}catch{}},[ce]),d.exports.useEffect(()=>{try{localStorage.setItem(Za,T)}catch{}},[T]),d.exports.useEffect(()=>{T.startsWith("custom:")&&(ce.some(j=>`custom:${j.id}`===T)||L("default"))},[T,ce]),d.exports.useEffect(()=>{const U=document.documentElement;Array.from(U.classList).filter(de=>de.startsWith("rb-theme-")).forEach(de=>U.classList.remove(de)),cu();const j=eo.find(de=>de.key===T);if(j){j.className&&U.classList.add(j.className),zi(j.key);return}if(T.startsWith("custom:")){const de=ce.find(R=>`custom:${R.id}`===T);if(!de)return;const k=o==="dark"?de.dark:de.light,I=Zi(k.primary);du(I,{bgLight:de.light.bg,bgDark:de.dark.bg,surfaceLight:de.light.surface,surfaceDark:de.dark.surface}),zi("custom",o==="dark"?de.dark.bg:de.light.bg)}else zi("default")},[T,ce,o]);const oe=d.exports.useCallback(U=>{U.colorModeTarget&&o!==U.colorModeTarget&&c(),L(U.key)},[o,c]),_=U=>{L(`custom:${U}`)},ye=U=>{q(null),A(U?{name:a(`theme.presets.${U.key}.name`),light:{...U.light},dark:{...U.dark}}:io()),u.onOpen()},f=U=>{q(U.id),A({name:U.name,light:{...U.light},dark:{...U.dark}}),u.onOpen()},ae=()=>{const U=W.name.trim()||a("theme.untitled"),j=nr(W.light.primary,_r.primary),de=nr(W.light.bg,_r.bg),k=ms(de,j,Xi,_r.surface),I=nr(W.light.surface,k),R=nr(W.dark.primary,Dr.primary),$=nr(W.dark.bg,Dr.bg),Ae=ms($,R,Qi,Dr.surface),Se=nr(W.dark.surface,Ae),Je={id:X||ji(),name:U,light:{primary:j,bg:de,surface:I},dark:{primary:R,bg:$,surface:Se}};P(N=>X?N.map(Z=>Z.id===X?Je:Z):[...N,Je]),L(`custom:${Je.id}`),u.onClose(),q(null),i({status:"success",title:a("theme.customSaved")})},K=U=>{P(j=>j.filter(de=>de.id!==U)),T===`custom:${U}`&&L("default"),i({status:"info",title:a("theme.customDeleted")})},xe=()=>{L("default"),i({status:"info",title:a("theme.resetSuccess")})},Re=async()=>{if(!ce.length){i({status:"warning",title:a("theme.exportEmpty")});return}const U=ce.map(({id:de,...k})=>k),j=JSON.stringify(U,null,2);try{await navigator.clipboard.writeText(j),i({status:"success",title:a("theme.exportSuccess")})}catch{try{const de=new Blob([j],{type:"application/json"}),k=URL.createObjectURL(de),I=document.createElement("a");I.href=k,I.download="rebecca-themes.json",I.click(),URL.revokeObjectURL(k),i({status:"success",title:a("theme.exportSuccessDownload")})}catch{i({status:"error",title:a("theme.exportError")})}}},Oe=()=>{try{const U=JSON.parse(ge),de=(Array.isArray(U)?U:[U]).map(k=>{var F,pe,Q,Pe,Te,le;const I=nr(((F=k==null?void 0:k.light)==null?void 0:F.primary)||_r.primary,_r.primary),R=nr(((pe=k==null?void 0:k.light)==null?void 0:pe.bg)||_r.bg,_r.bg),$=ms(R,I,Xi,_r.surface),Ae=nr(((Q=k==null?void 0:k.light)==null?void 0:Q.surface)||$,$),Se=nr(((Pe=k==null?void 0:k.dark)==null?void 0:Pe.primary)||Dr.primary,Dr.primary),Je=nr(((Te=k==null?void 0:k.dark)==null?void 0:Te.bg)||Dr.bg,Dr.bg),N=ms(Je,Se,Qi,Dr.surface),Z=nr(((le=k==null?void 0:k.dark)==null?void 0:le.surface)||N,N);return{id:ji(),name:(k==null?void 0:k.name)||"Custom",light:{primary:I,bg:R,surface:Ae},dark:{primary:Se,bg:Je,surface:Z}}}).filter(k=>k.name);if(!de.length){i({status:"warning",title:a("theme.importError")});return}P(k=>[...k,...de]),p.onClose(),H(""),i({status:"success",title:a("theme.importSuccess")})}catch{i({status:"error",title:a("theme.importError")})}},V=d.exports.useCallback((U,j)=>{U.preventDefault(),U.stopPropagation(),j()},[]),be=d.exports.useMemo(()=>Zi(W.light.primary),[W.light.primary]),Ce=d.exports.useMemo(()=>Zi(W.dark.primary),[W.dark.primary]),Ee=U=>{const j=W[U],de=U==="dark"?Ce:be,k=de["--primary-500"]||j.primary,I=de["--primary-300"]||de["--primary-400"]||k,R=U==="dark"?"whiteAlpha.900":"gray.800",$=U==="dark"?"whiteAlpha.700":"gray.600",Ae=U==="dark"?"whiteAlpha.200":"blackAlpha.200",Se=U==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(z,{borderWidth:"1px",borderRadius:"md",bg:j.bg,p:4,borderColor:Ae,children:n(fe,{spacing:3,children:[e(h,{fontWeight:"semibold",color:R,children:a(U==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(z,{borderRadius:"lg",bg:j.surface,p:4,borderWidth:"1px",borderColor:Ae,children:n(fe,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:R,children:a("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:$,children:a("theme.previewSampleBody")}),e(O,{size:"sm",bg:k,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:a("theme.previewSampleAction")}),n(M,{spacing:2,pt:2,children:[e(z,{flex:"1",h:"2",borderRadius:"full",bg:I,opacity:.8}),e(z,{flex:"1",h:"2",borderRadius:"full",bg:k,opacity:.9})]})]})}),n(M,{spacing:1,pt:1,flexWrap:"wrap",children:[e(z,{w:6,h:6,borderRadius:"sm",bg:j.bg,borderWidth:"1px",borderColor:Se}),e(z,{w:6,h:6,borderRadius:"sm",bg:j.surface,borderWidth:"1px",borderColor:Se}),Object.entries(de).map(([Je,N])=>e(z,{w:6,h:6,borderRadius:"sm",bg:N,borderWidth:"1px",borderColor:Se,title:Je},Je))]})]})})},ve=n(si,{minW:{base:"82vw",sm:"240px"},maxW:"320px",zIndex:9999,bg:m,color:S,borderColor:x,maxH:"70vh",overflowY:"auto",children:[e(Ya,{title:a("theme.builtIn"),sx:E,children:eo.map(U=>{const j=T===U.key;return e(ir,{onClick:()=>oe(U),_hover:{bg:g},children:n(M,{justify:"space-between",w:"full",children:[n(M,{children:[e(z,{w:"4",h:"3",bg:U.accent,borderRadius:"xs",borderWidth:"1px",borderColor:x}),e(h,{children:a(`theme.${U.key}`)})]}),j&&e(ro,{})]})},U.key)})}),!t&&n(Bt,{children:[e(Ui,{borderColor:x}),n(Ya,{title:a("theme.customGroup"),sx:E,children:[ce.length?ce.map(U=>{const j=T===`custom:${U.id}`;return e(ir,{onClick:()=>_(U.id),_hover:{bg:g},children:n(M,{justify:"space-between",w:"full",children:[n(M,{children:[e(z,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${U.light.surface}, ${U.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:x}),e(h,{children:U.name})]}),n(M,{spacing:1,children:[j&&e(ro,{}),[{icon:e(tu,{}),label:a("theme.edit"),onClick:()=>f(U)},{icon:e(ru,{}),label:a("theme.delete"),onClick:()=>K(U.id)}].map(({icon:de,label:k,onClick:I})=>e(z,{as:"span",role:"button",tabIndex:0,"aria-label":k,onClick:R=>V(R,I),onKeyDown:R=>{(R.key==="Enter"||R.key===" ")&&V(R,I)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:g},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:de},k))]})]})},U.id)}):e(ir,{isDisabled:!0,children:a("theme.noCustom")}),e(ir,{icon:e(eu,{}),onClick:()=>ye(),_hover:{bg:g},children:a("theme.createCustom")})]}),e(Ui,{borderColor:x}),e(ir,{icon:e(so,{}),onClick:()=>ye(to[0]),_hover:{bg:g},children:a("theme.quickPreset")}),e(ir,{icon:e(nu,{}),onClick:Re,_hover:{bg:g},children:a("theme.export")}),e(ir,{icon:e(su,{}),onClick:()=>p.onOpen(),_hover:{bg:g},children:a("theme.import")}),e(ir,{icon:e(iu,{}),onClick:xe,_hover:{bg:g},children:a("theme.reset")})]})]}),B=r==="icon"?e(Cs,{as:He,size:"sm",variant:"outline",icon:e(no,{}),position:"relative"}):e(Cs,{as:O,w:"full",justifyContent:"space-between",variant:"ghost",rightIcon:e(no,{}),children:l||a("theme.triggerLabel","Theme")});return n(Bt,{children:[n(ni,{placement:"bottom-end",children:[B,s?e(Wi,{containerRef:s,children:ve}):ve]}),n(Wt,{isOpen:u.isOpen,onClose:u.onClose,isCentered:!0,size:"xl",children:[e(_t,{bg:v,backdropFilter:"blur(4px)"}),n(Ft,{mx:4,bg:m,borderColor:x,borderWidth:"1px",color:S,children:[e(It,{color:S,children:a(X?"theme.editThemeTitle":"theme.customTitle")}),e(Ht,{}),e(Dt,{children:n(he,{spacing:6,align:"stretch",children:[n(C,{children:[e(D,{color:y,children:a("theme.customName")}),e(De,{placeholder:a("theme.customNamePlaceholder")||"",value:W.name,onChange:U=>A(j=>({...j,name:U.target.value}))})]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[Ee("light"),Ee("dark")]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(fe,{spacing:4,children:[n(C,{children:[e(D,{color:y,children:a("theme.lightPrimary")}),e(De,{type:"color",value:W.light.primary,onChange:U=>A(j=>({...j,light:{...j.light,primary:U.target.value}}))}),e(ur,{color:y,children:a("theme.lightPrimaryHint")})]}),n(C,{children:[e(D,{color:y,children:a("theme.lightSurface")}),e(De,{type:"color",value:W.light.surface,onChange:U=>A(j=>({...j,light:{...j.light,surface:U.target.value}}))}),e(ur,{color:y,children:a("theme.lightSurfaceHint")})]}),n(C,{children:[e(D,{color:y,children:a("theme.lightBackground")}),e(De,{type:"color",value:W.light.bg,onChange:U=>A(j=>({...j,light:{...j.light,bg:U.target.value}}))})]})]}),n(fe,{spacing:4,children:[n(C,{children:[e(D,{color:y,children:a("theme.darkPrimary")}),e(De,{type:"color",value:W.dark.primary,onChange:U=>A(j=>({...j,dark:{...j.dark,primary:U.target.value}}))}),e(ur,{color:y,children:a("theme.darkPrimaryHint")})]}),n(C,{children:[e(D,{color:y,children:a("theme.darkSurface")}),e(De,{type:"color",value:W.dark.surface,onChange:U=>A(j=>({...j,dark:{...j.dark,surface:U.target.value}}))}),e(ur,{color:y,children:a("theme.darkSurfaceHint")})]}),n(C,{children:[e(D,{color:y,children:a("theme.darkBackground")}),e(De,{type:"color",value:W.dark.bg,onChange:U=>A(j=>({...j,dark:{...j.dark,bg:U.target.value}}))})]})]})]}),n(z,{children:[n(M,{mb:2,children:[e(so,{}),e(h,{fontWeight:"semibold",children:a("theme.presets")})]}),e(Fe,{columns:{base:1,md:3},spacing:3,children:to.map(U=>e(O,{size:"sm",variant:"outline",onClick:()=>A({name:a(`theme.presets.${U.key}.name`),light:{...U.light},dark:{...U.dark}}),children:a(`theme.presets.${U.key}.name`)},U.key))})]})]})}),n(Ut,{children:[e(O,{variant:"ghost",mr:3,onClick:u.onClose,children:a("cancel")}),e(O,{colorScheme:"primary",onClick:ae,children:a(X?"theme.customUpdate":"theme.customSave")})]})]})]}),n(Wt,{isOpen:p.isOpen,onClose:p.onClose,size:"lg",isCentered:!0,children:[e(_t,{bg:v,backdropFilter:"blur(4px)"}),n(Ft,{mx:4,bg:m,borderColor:x,borderWidth:"1px",color:S,children:[e(It,{color:S,children:a("theme.importTitle")}),e(Ht,{}),e(Dt,{children:n(he,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:y,children:a("theme.importDescription")}),e(Pr,{rows:8,placeholder:a("theme.importPlaceholder")||"",value:ge,onChange:U=>H(U.target.value),bg:"transparent",borderColor:x,color:S})]})}),n(Ut,{children:[e(O,{variant:"ghost",mr:3,onClick:p.onClose,children:a("cancel")}),e(O,{colorScheme:"primary",onClick:Oe,children:a("theme.importAction")})]})]})]})]})},uu=ke.object({username:ke.string().min(1,"login.fieldRequired"),password:ke.string().min(1,"login.fieldRequired")}),hu=ie("img",{baseStyle:{w:12,h:12}}),pu=ie(Tc,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),mu=ie(ii,{baseStyle:{w:4,h:4}}),gu=ie(Ra,{baseStyle:{w:4,h:4}}),ao=()=>{var y,v;const[t,s]=d.exports.useState(""),[r,l]=d.exports.useState(!1),[a,i]=d.exports.useState(!1),o=Ec(),{t:c}=qe(),{colorMode:u}=Zr();let p=Ma();const{register:m,formState:{errors:g},handleSubmit:x}=jr({resolver:Fi(uu)});d.exports.useEffect(()=>{Jd(),p.pathname!=="/login"&&o("/login",{replace:!0})},[]);const S=E=>{s("");const T=new FormData;T.append("username",E.username),T.append("password",E.password),T.append("grant_type","password"),l(!0),ze("/admin/token",{method:"post",body:T}).then(({access_token:L})=>{console.log("Token received:",L),Kd(L),o("/")}).catch(L=>{var ce,P;s(((P=(ce=L.response)==null?void 0:ce._data)==null?void 0:P.detail)||"Login failed")}).finally(()=>l(!1))};return e(he,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(zr,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:n(An,{children:[n(M,{justifyContent:"end",spacing:2,mb:6,children:[e(Zd,{}),e(Ml,{minimal:!0})]}),n(he,{alignItems:"center",w:"full",spacing:4,children:[e(hu,{src:Sa,alt:c("appName")||"Rebecca",filter:u==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(z,{w:"full",pt:"4",children:e("form",{onSubmit:x(S),children:n(he,{spacing:4,children:[e(C,{children:e(or,{w:"full",placeholder:c("username"),...m("username"),error:c((y=g==null?void 0:g.username)==null?void 0:y.message)})}),n(C,{isInvalid:!!g.password,children:[n(Nr,{children:[e(De,{w:"full",type:a?"text":"password",placeholder:c("password"),...m("password")}),e(Hr,{children:e(He,{"aria-label":a?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>i(!a),icon:a?e(gu,{}):e(mu,{})})})]}),e(nn,{children:(v=g.password)==null?void 0:v.message})]}),t&&n(Wr,{status:"error",rounded:"md",children:[e(Fr,{}),e(Wn,{children:t})]}),n(O,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(pu,{marginRight:1}),c("login")]})]})})})]})})})};var Xe=(t=>(t.Standard="standard",t.Sudo="sudo",t.FullAccess="full_access",t))(Xe||{}),Ln=(t=>(t.Active="active",t.Disabled="disabled",t.Deleted="deleted",t))(Ln||{}),ct=(t=>(t.Create="create",t.Delete="delete",t.ResetUsage="reset_usage",t.Revoke="revoke",t.CreateOnHold="create_on_hold",t.AllowUnlimitedData="allow_unlimited_data",t.AllowUnlimitedExpire="allow_unlimited_expire",t.AllowNextPlan="allow_next_plan",t))(ct||{}),ar=(t=>(t.View="can_view",t.Edit="can_edit",t.ManageSudo="can_manage_sudo",t))(ar||{}),bt=(t=>(t.Usage="usage",t.Admins="admins",t.Services="services",t.Hosts="hosts",t.Nodes="nodes",t.Integrations="integrations",t.Xray="xray",t))(bt||{});const fu=t=>JSON.parse(JSON.stringify(t)),bu={users:{[ct.Create]:!0,[ct.Delete]:!1,[ct.ResetUsage]:!1,[ct.Revoke]:!1,[ct.CreateOnHold]:!1,[ct.AllowUnlimitedData]:!1,[ct.AllowUnlimitedExpire]:!1,[ct.AllowNextPlan]:!1,max_data_limit_per_user:null},admin_management:{[ar.View]:!1,[ar.Edit]:!1,[ar.ManageSudo]:!1},sections:{[bt.Usage]:!1,[bt.Admins]:!1,[bt.Services]:!1,[bt.Hosts]:!1,[bt.Nodes]:!1,[bt.Integrations]:!1,[bt.Xray]:!1}},yu={users:{[ct.Create]:!0,[ct.Delete]:!0,[ct.ResetUsage]:!0,[ct.Revoke]:!0,[ct.CreateOnHold]:!0,[ct.AllowUnlimitedData]:!0,[ct.AllowUnlimitedExpire]:!0,[ct.AllowNextPlan]:!0,max_data_limit_per_user:null},admin_management:{[ar.View]:!0,[ar.Edit]:!0,[ar.ManageSudo]:!1},sections:{[bt.Usage]:!0,[bt.Admins]:!0,[bt.Services]:!0,[bt.Hosts]:!0,[bt.Nodes]:!0,[bt.Integrations]:!0,[bt.Xray]:!0}},Su={users:{[ct.Create]:!0,[ct.Delete]:!0,[ct.ResetUsage]:!0,[ct.Revoke]:!0,[ct.CreateOnHold]:!0,[ct.AllowUnlimitedData]:!0,[ct.AllowUnlimitedExpire]:!0,[ct.AllowNextPlan]:!0,max_data_limit_per_user:null},admin_management:{[ar.View]:!0,[ar.Edit]:!0,[ar.ManageSudo]:!0},sections:{[bt.Usage]:!0,[bt.Admins]:!0,[bt.Services]:!0,[bt.Hosts]:!0,[bt.Nodes]:!0,[bt.Integrations]:!0,[bt.Xray]:!0}},oo={[Xe.Standard]:bu,[Xe.Sudo]:yu,[Xe.FullAccess]:Su},li=(t=Xe.Standard)=>{var s;return fu((s=oo[t])!=null?s:oo[Xe.Standard])},lo=t=>typeof t=="object"&&t!==null&&!Array.isArray(t),Ul=(t,s)=>{const r={...t};return Object.entries(s).forEach(([l,a])=>{if(a!==void 0){if(lo(a)&&lo(r[l])){r[l]=Ul(r[l],a);return}r[l]=a}}),r},xu=(t,s)=>s?Ul(li(t),s):li(t),wi=li(Xe.Standard),vu=async()=>await ze("/admin"),hr=()=>{const{data:t,isError:s,isLoading:r,isSuccess:l,error:a}=Rr({queryFn:()=>vu()}),i={role:Xe.Standard,permissions:li(Xe.Standard),telegram_id:"",username:"",users_usage:0,status:Ln.Active,disabled_reason:null},o=(t==null?void 0:t.role)||Xe.Standard,c=t!=null&&t.permissions?xu(o,t.permissions):li(o);return{userData:t?{...t,role:o,permissions:c}:{...i,role:o,permissions:c},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:s,getUserError:a}},wu=()=>ze("/ads"),ku=(t=!0)=>Rr({queryKey:["ads"],queryFn:wu,enabled:t,staleTime:1e3*60*30,cacheTime:1e3*60*60}),Cu=({ad:t,compact:s=!1,ratio:r,maxSize:l})=>{const a=We("gray.200","whiteAlpha.200"),i=We("gray.600","gray.300"),o=We("primary.600","primary.200"),c=s?2:3,u=s?2:3,p=t.type==="image"||Boolean(t.image_url),m=r!=null?r:s?3/1:1,g=l!=null?l:460,x=p?e(Nc,{ratio:m,w:"full",children:e(zc,{alt:t.title||t.text||"Advertisement",borderRadius:"md",objectFit:"contain",src:t.image_url,w:"100%",h:"100%"})}):n(fe,{spacing:1,children:[t.title&&e(h,{fontSize:s?"sm":"md",fontWeight:"semibold",children:t.title}),t.text&&e(h,{fontSize:s?"xs":"sm",color:i,noOfLines:s?3:4,children:t.text})]}),S=n(z,{borderColor:a,borderWidth:"1px",borderRadius:"md",bg:We("white","gray.800"),px:u,py:c,w:"full",maxW:`${g}px`,shadow:"sm",transition:"box-shadow 0.2s ease",_hover:{shadow:"md"},children:[x,!p&&t.cta&&e(h,{fontSize:s?"xs":"sm",fontWeight:"semibold",color:o,mt:t.image_url?2:3,children:t.cta})]});return t.link?e(Rc,{href:t.link,isExternal:!0,display:"block",_hover:{textDecoration:"none"},children:S}):S},_u=t=>(t||"en").split(/[-_]/)[0].toLowerCase(),Du=(t,s,r)=>{var o,c,u;if(!t)return;const l=_u(r),a=(c=(o=t.locales)==null?void 0:o[l])==null?void 0:c[s];if(a!=null&&a.length)return a[0];const i=(u=t.default)==null?void 0:u[s];return i==null?void 0:i[0]},Tn={baseStyle:{w:5,h:5}},Au=ie(Mc,Tn),Iu=ie(Uc,Tn),Pu=ie(Lc,Tn),ea=ie(Oc,Tn),Tu=ie(Wc,Tn),Eu=ie(Fc,Tn),Nu=ie(Hi,Tn),zu=ie(cl,Tn),Ru=ie(dl,Tn),co=ie("img",{baseStyle:{w:8,h:8}}),uo=({collapsed:t,inDrawer:s=!1,onRequestExpand:r})=>{var ge;const{t:l,i18n:a}=qe(),i=Ma(),{colorMode:o}=Zr(),{userData:c,getUserIsSuccess:u}=hr(),p=u&&[Xe.Sudo,Xe.FullAccess].includes(c.role),{data:m}=ku(p),g=a.language||"en",x=p?Du(m,"sidebar",g):void 0,S=d.exports.useMemo(()=>{switch(c.role){case Xe.FullAccess:return l("admins.roles.fullAccess","Full access");case Xe.Sudo:return l("admins.roles.sudo","Sudo");case Xe.Standard:default:return l("admins.roles.standard","Standard")}},[l,c.role]),y=(ge=c.permissions)==null?void 0:ge.sections,v=Boolean(y==null?void 0:y[bt.Usage]),E=Boolean(y==null?void 0:y[bt.Admins]),T=Boolean(y==null?void 0:y[bt.Services]),ce=[...[y!=null&&y[bt.Hosts]?{title:l("header.hostSettings"),url:"/hosts",icon:Pu}:null,y!=null&&y[bt.Nodes]?{title:l("header.nodeSettings"),url:"/node-settings",icon:Tu}:null,y!=null&&y[bt.Integrations]?{title:l("header.integrationSettings","Master Settings"),url:"/integrations",icon:ea}:null,y!=null&&y[bt.Xray]?{title:l("header.xraySettings"),url:"/xray-settings",icon:ea}:null].filter(Boolean)],P=()=>{s&&r&&r()};T&&ce.unshift({title:l("services.menu","Services"),url:"/services",icon:zu});const W=ce.some(H=>i.pathname===H.url),[A,X]=d.exports.useState(W);d.exports.useEffect(()=>{W&&X(!0)},[W]);const q=[{title:l("dashboard"),url:"/",icon:Au},{title:l("users"),url:"/users",icon:Iu}];return v&&q.push({title:l("usage.menu","Usage"),url:"/usage",icon:Ru}),E&&q.push({title:l("admins","Admins"),url:"/admins",icon:Eu}),ce.length>0&&q.push({title:l("header.settings"),icon:ea,subItems:ce}),e(z,{w:s?"full":t?"16":"60",h:s?"100%":"100vh",maxH:s?"100%":"100vh",bg:"surface.light",borderRight:s?void 0:"1px",borderColor:s?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:s?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:s?"relative":"fixed",top:s?void 0:"0",left:s?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:n(he,{spacing:2,p:t?2:4,align:"stretch",h:"100%",justify:"space-between",children:[n(z,{flex:"1",overflowY:"auto",children:[t?e(M,{justify:"center",mb:6,children:e(mt,{label:"Rebecca",placement:"right",hasArrow:!0,children:e(co,{src:Sa,alt:"Rebecca",filter:o==="dark"?"brightness(0) invert(1)":"none"})})}):n(M,{spacing:3,align:"center",mb:6,px:2,children:[e(co,{src:Sa,alt:"Rebecca",filter:o==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"lg",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},children:l("menu")})]}),q.map(H=>{const oe=H.url,_=typeof oe=="string"&&i.pathname===oe||typeof oe=="string"&&oe!=="/"&&i.pathname.startsWith(oe)||H.subItems&&H.subItems.some(f=>i.pathname===f.url),ye=H.icon;return e(z,{children:H.subItems?n(Bt,{children:[e(mt,{label:t?H.title:"",placement:"right",hasArrow:!0,children:n(M,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:_?"primary.50":"transparent",color:_?"primary.600":"gray.700",_dark:{bg:_?"primary.900":"transparent",color:_?"primary.200":"gray.300"},_hover:{bg:_?"primary.50":"gray.50",_dark:{bg:_?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>{t?(r&&r(),X(!0)):X(!A)},children:[n(M,{spacing:3,children:[e(ye,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:_?"semibold":"normal",children:H.title})]}),!t&&e(Nu,{transform:A?"rotate(180deg)":"rotate(0deg)"})]})}),!t&&e(_s,{in:A,animateOpacity:!0,children:e(he,{align:"stretch",pl:6,spacing:1,mt:2,children:H.subItems.map(f=>{const ae=i.pathname===f.url,K=f.icon;return e(Ga,{to:f.url,onClick:P,children:n(M,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:ae?"primary.50":"transparent",color:ae?"primary.600":"gray.700",_dark:{bg:ae?"primary.900":"transparent",color:ae?"primary.200":"gray.300"},_hover:{bg:ae?"primary.50":"gray.50",_dark:{bg:ae?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(K,{w:t?5:void 0,h:t?5:void 0}),e(h,{fontSize:"sm",fontWeight:ae?"semibold":"normal",children:f.title})]})},f.url)})})})]}):H.url?e(Ga,{to:H.url,onClick:P,children:e(mt,{label:t?H.title:"",placement:"right",hasArrow:!0,children:n(M,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:_?"primary.50":"transparent",color:_?"primary.600":"gray.700",_dark:{bg:_?"primary.900":"transparent",color:_?"primary.200":"gray.300"},_hover:{bg:_?"primary.50":"gray.50",_dark:{bg:_?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(ye,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:_?"semibold":"normal",children:H.title})]})})}):null},H.title)})]}),x&&!t&&e(z,{px:t?2:3,py:3,mt:4,w:"full",children:e(Cu,{ad:x})}),u&&c.username&&e(z,{px:t?2:3,py:2,borderTop:"1px",borderColor:"light-border",_dark:{borderColor:"whiteAlpha.200"},mt:4,children:t?e(mt,{label:`${c.username} \xB7 ${S}`,placement:"right",hasArrow:!0,children:e(z,{w:"8",h:"8",borderRadius:"full",bg:"primary.100",_dark:{bg:"primary.800"},display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",flexShrink:0,children:e(h,{fontSize:"sm",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},textAlign:"center",children:c.username.charAt(0).toUpperCase()})})}):n(he,{align:"flex-start",spacing:1,children:[e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:"username:"}),e(h,{fontSize:"sm",fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},noOfLines:1,children:c.username}),e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:l("admins.roleLabel","Admin role")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:S})]})})]})})},Mu=()=>{const[t,s]=d.exports.useState(null);return Zr(),d.exports.useEffect(()=>{fetch("https://api.github.com/repos/rebeccapanel/Rebecca").then(l=>l.json()).then(l=>{l.stargazers_count&&s(l.stargazers_count)}).catch(()=>{})},[]),e(z,{as:"button",onClick:()=>{window.open("https://github.com/rebeccapanel/Rebecca","_blank","noopener,noreferrer")},px:3,py:1.5,borderRadius:"md",borderWidth:"1px",borderColor:"gray.300",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},_hover:{bg:"gray.50",borderColor:"gray.400",transform:"translateY(-1px)",boxShadow:"sm",_dark:{bg:"gray.700",borderColor:"gray.500"}},transition:"all 0.2s",cursor:"pointer","aria-label":"GitHub Stars",children:n(M,{spacing:2,align:"center",children:[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"})}),n(M,{spacing:1,px:1.5,py:.5,borderRadius:"full",bg:"gray.100",_dark:{bg:"gray.700"},children:[e(Hc,{style:{width:"14px",height:"14px",color:"#fbbf24"}}),t!==null?e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.700",_dark:{color:"gray.200"},lineHeight:"1",children:t>1e3?`${(t/1e3).toFixed(1)}k`:t}):e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},lineHeight:"1",children:"..."})]})]})})},Ri=Bc,Uu="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",Ll={base:Uu,folder:"apple/64",ext:".png",className:"apple-emoji"},ta=t=>{var s,r;return typeof t=="string"&&((r=(s=Ri.test)==null?void 0:s.call(Ri,t))!=null?r:!1)},Lu=t=>t.some(s=>{var r;return s.type==="characterData"?ta((r=s.target)==null?void 0:r.data):s.type==="childList"?Array.from(s.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return ta(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const a=l;return a.tagName==="IMG"&&a.classList.contains(Ll.className)?!1:ta(a.textContent)}return!1}):!1}),Ou=()=>{const t=Ma();d.exports.useEffect(()=>{const s=document.getElementById("root");if(!s)return;const r=()=>{Ri.parse(s,Ll)};r();const l=new MutationObserver(a=>{Lu(a)&&requestAnimationFrame(r)});return l.observe(s,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},Vi={baseStyle:{w:4,h:4}},Wu=ie(Vc,Vi),Fu=ie(ul,Vi),Hu=ie(hl,Vi),Bu=ie(ol,Vi);function Vu(){const[t,s]=d.exports.useState(!1),r=Tr({base:!0,md:!1}),l=Zt(),a=Zt(),i=d.exports.useRef(null),{t:o,i18n:c}=qe();Ou();const u=[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}],p=m=>{c.changeLanguage(m)};return n(pt,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(uo,{collapsed:t,onRequestExpand:()=>s(!1)}),n(pt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[n(z,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(He,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():s(!t)},icon:e(Fu,{})}),n(M,{spacing:2,children:[e(Mu,{}),n(Hn,{isOpen:a.isOpen,onOpen:a.onOpen,onClose:a.onClose,placement:"bottom-end",children:[e(Bn,{children:e(He,{size:"sm",variant:"outline",icon:e(Hu,{}),"aria-label":"quick actions",onClick:()=>a.isOpen?a.onClose():a.onOpen()})}),n(Vn,{ref:i,w:"full",maxW:{base:"calc(100vw - 2rem)",sm:"56"},mx:{base:4,sm:0},children:[e(ls,{}),e($n,{children:n(fe,{spacing:2,children:[n(ni,{placement:"left-start",isLazy:!0,children:[e(Cs,{as:O,justifyContent:"space-between",rightIcon:e(Bu,{}),variant:"ghost",children:o("header.language","Language")}),e(Wi,{containerRef:i,children:e(si,{minW:{base:"100%",sm:"200px"},maxW:{base:"100%",sm:"240px"},maxH:"60vh",overflowY:"auto",children:u.map(({code:m,label:g,flag:x})=>{const S=c.language===m;return e(ir,{onClick:()=>{p(m),a.onClose()},children:n(M,{justify:"space-between",w:"full",children:[n(M,{spacing:2,children:[e(ll,{countryCode:x,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:g})]}),S&&e(hi,{width:16})]})},m)})})})]}),e(On,{}),e(Ml,{trigger:"menu",triggerLabel:o("header.theme","Theme"),portalContainer:i}),e(On,{}),e(O,{colorScheme:"red",leftIcon:e(Wu,{}),justifyContent:"flex-start",as:$c,to:"/login",onClick:a.onClose,children:o("header.logout","Log out")})]})})]})]})]})]}),e(z,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(Kc,{})})]}),r&&n(Jc,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(_t,{}),e(qc,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(Dt,{p:0,children:e(uo,{collapsed:!1,inDrawer:!0,onRequestExpand:l.onClose})})})]})]})}const Ol="rebecca-num-users-per-page",ho=10,$u=()=>{const t=localStorage.getItem(Ol)||ho.toString();return parseInt(t)||ho},Ku=t=>localStorage.setItem(Ol,t),Wl="-created_at",Ju=60*60*1e3,qu=t=>{const s={sort:t.sort||Wl};return Object.keys(t).forEach(r=>{if(r==="sort")return;const l=t[r];if(Array.isArray(l)){if(l.length===0)return;s[r]=l;return}l==null||l===""||(s[r]=l)}),s},Yu=t=>JSON.stringify(Object.keys(t).sort().map(s=>[s,t[s]])),Gu=(t,s={})=>{var p;const r=qu(t),l=Yu(r),{lastUsersFetchAt:a,usersCacheKey:i,users:o}=Tt.getState(),c=Date.now();if(!s.force&&a&&i===l&&c-a<Ju)return Promise.resolve(o);Tt.setState({loading:!0});const u={...r};return(p=r.advancedFilters)!=null&&p.length&&(u.filter=r.advancedFilters),r.owner&&(u.admin=r.owner),r.serviceId!==void 0&&(u.service_id=r.serviceId),delete u.advancedFilters,delete u.owner,delete u.serviceId,ze("/users",{query:u}).then(m=>{var y,v;const g=(y=m.users_limit)!=null?y:null,x=(v=m.active_total)!=null?v:null,S=g!=null&&g>0&&x!==null?x>=g:!1;return Tt.setState({users:m,isUserLimitReached:S,lastUsersFetchAt:Date.now(),usersCacheKey:l}),m}).finally(()=>{Tt.setState({loading:!1})})},ci=()=>ze("/inbounds").then(t=>{Tt.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{Tt.setState({loading:!1})}),Tt=zs(Yc((t,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,lastUsersFetchAt:null,usersCacheKey:null,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{limit:$u(),sort:Wl,advancedFilters:[],owner:void 0,serviceId:void 0},inbounds:new Map,isEditingCore:!1,refetchUsers:(r=!1)=>{Gu(s().filters,{force:r})},resetAllUsage:()=>ze("/users/reset",{method:"POST"}).then(()=>{s().onResetAllUsage(!1),s().refetchUsers(!0)}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...s().filters,...r}}),s().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),ze(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),s().refetchUsers(!0),Ni.invalidateQueries(na)})),createUser:r=>ze("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),Ni.invalidateQueries(na)}),createUserWithService:r=>ze("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),Ni.invalidateQueries(na)}),editUser:(r,l)=>ze(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{s().onEditingUser(null),s().refetchUsers(!0)}),fetchUserUsage:(r,l)=>{for(const a in l)l[a]||delete l[a];return ze(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>ze(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),s().refetchUsers(!0)}),revokeSubscription:r=>ze(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),s().refetchUsers(!0)}),onEditingCore:r=>t({isEditingCore:r})})));function Be(t,s=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,a=s<0?0:s,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(t)/Math.log(l)),c=parseFloat((t/Math.pow(l,o)).toFixed(a));return r?[c,i[o]]:`${c} ${i[o]}`}const Xu=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Qu=[{label:"d",seconds:24*60*60},{label:"h",seconds:60*60},{label:"m",seconds:60},{label:"s",seconds:1}],ra=(t=0)=>{const s=Math.max(0,Math.floor(t));if(s===0)return"0s";const r=[];let l=s;for(const a of Qu){const i=Math.floor(l/a.seconds);i>0&&(r.push(`${i}${a.label}`),l-=i*a.seconds)}return r.join(" ")},na="statistics-query-key",Zu={baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}},ju=ie(Gc,Zu),Qr=t=>{var s;return(s=Xu(t))!=null?s:t.toString()},Fl=[{labelKey:"historyInterval.2m",seconds:120},{labelKey:"historyInterval.10m",seconds:600},{labelKey:"historyInterval.30m",seconds:1800},{labelKey:"historyInterval.1h",seconds:3600},{labelKey:"historyInterval.3h",seconds:10800},{labelKey:"historyInterval.5h",seconds:18e3}],eh=({isOpen:t,onClose:s,payload:r,intervalSeconds:l,onIntervalChange:a,t:i})=>{var v;const{colorMode:o}=Zr(),u=Math.floor(Date.now()/1e3)-l,p=d.exports.useMemo(()=>!r||r.type==="network"||r.type==="panel"?[]:r.entries.filter(E=>E.timestamp>=u),[r,u]),m=d.exports.useMemo(()=>!r||r.type!=="network"?[]:r.entries.filter(E=>E.timestamp>=u),[r,u]),g=d.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.cpuEntries.filter(E=>E.timestamp>=u),[r,u]),x=d.exports.useMemo(()=>!r||r.type!=="panel"?[]:r.memoryEntries.filter(E=>E.timestamp>=u),[r,u]),S=d.exports.useMemo(()=>r?r.type==="network"?[{name:i("networkIncoming"),data:m.map(E=>[E.timestamp*1e3,E.incoming])},{name:i("networkOutgoing"),data:m.map(E=>[E.timestamp*1e3,E.outgoing])}]:r.type==="panel"?[{name:i("cpuUsage"),data:g.map(E=>[E.timestamp*1e3,E.value])},{name:i("memoryUsage"),data:x.map(E=>[E.timestamp*1e3,E.value])}]:[{name:r.metricLabel,data:p.map(E=>[E.timestamp*1e3,E.value])}]:[],[p,m,g,x,r,i]),y=d.exports.useMemo(()=>({chart:{type:"line",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1},background:"transparent"},theme:{mode:o},stroke:{curve:"smooth"},xaxis:{type:"datetime",labels:{datetimeFormatter:{hour:"HH:mm"}}},yaxis:{decimalsInFloat:0},tooltip:{x:{format:"HH:mm:ss"}}}),[o]);return n(Wt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(_t,{}),n(Ft,{children:[e(It,{children:i("historyModalTitle",{metric:(v=r==null?void 0:r.title)!=null?v:""})}),e(Ht,{}),e(Dt,{children:n(fe,{spacing:3,children:[e(pt,{wrap:"wrap",gap:2,children:Fl.map(E=>e(O,{size:"sm",variant:l===E.seconds?"solid":"outline",onClick:()=>a(E.seconds),children:i(E.labelKey)},E.seconds))}),e(an,{options:y,series:S,type:"line",height:300})]})}),e(Ut,{children:e(O,{onClick:s,children:i("close")})})]})]})},th=({values:t,accent:s})=>{const r=We("gray.600","gray.300"),l=t.length?t:[0],a=Math.max(...l,1);return e(M,{alignItems:"flex-end",spacing:"2px",mt:2,minH:"42px",w:"full",overflow:"hidden",children:l.map((i,o)=>{const c=a>0?i/a*100:0,u=Math.max(4,Math.round(c/100*40));return e(z,{flex:"0 1 4px",minW:"2px",maxW:"4px",h:`${u}px`,bg:s!=null?s:r,borderRadius:"1px",transition:"all 0.2s"},o)})})},ri=({label:t,value:s,history:r,accent:l,onOpen:a,actionLabel:i})=>n(fe,{spacing:1,children:[n(M,{justifyContent:"space-between",alignItems:"center",children:[n(z,{children:[e(h,{fontSize:"xs",color:"gray.500",children:t}),e(h,{fontSize:"lg",fontWeight:"semibold",children:s})]}),a&&e(O,{size:"xs",variant:"ghost",onClick:a,children:i})]}),e(th,{values:r,accent:l})]}),jt=({label:t,value:s,colorScheme:r="gray"})=>{const l=We("gray.200","gray.700"),a=We("white","gray.900"),i=We(r==="gray"?"gray.800":`${r}.600`,r==="gray"?"gray.100":`${r}.300`);return n(z,{px:3,py:2,borderRadius:"md",borderWidth:"1px",borderColor:l,bg:a,_dark:{bg:"gray.800",borderColor:"gray.700"},children:[e(h,{fontSize:"xs",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",color:i,children:s})]})},rh=({data:t,t:s,onOpenHistory:r})=>{const l=t.cpu_history.map(o=>o.value),a=t.memory_history.map(o=>o.value),i=t.network_history.map(o=>o.incoming);return e(zr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(fe,{spacing:4,children:[n(fe,{direction:{base:"column",md:"row"},spacing:{base:2,md:4},justifyContent:"space-between",align:{base:"flex-start",md:"center"},children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("systemOverview")}),n(vs,{spacing:2,shouldWrapChildren:!0,justify:{base:"flex-start",md:"flex-end"},children:[e(Zn,{children:n(lt,{colorScheme:"gray",children:["v",t.version]})}),e(Zn,{children:n(lt,{colorScheme:"gray",children:[s("loadAverage"),": "," ",t.load_avg.length?t.load_avg.map(o=>o.toFixed(2)).join(" | "):"-"]})})]})]}),n(Fe,{columns:{base:1,md:3},gap:4,children:[e(ri,{label:s("cpuUsage"),value:`${t.cpu_usage.toFixed(1)}%`,history:l,actionLabel:s("viewHistory"),onOpen:()=>r({type:"cpu",title:s("cpuUsage"),metricLabel:s("cpuUsage"),entries:t.cpu_history})}),e(ri,{label:s("memoryUsage"),value:`${t.memory.percent.toFixed(1)}%`,history:a,actionLabel:s("viewHistory"),onOpen:()=>r({type:"memory",title:s("memoryUsage"),metricLabel:s("memoryUsage"),entries:t.memory_history})}),e(ri,{label:s("networkHistory"),value:`${Be(t.incoming_bandwidth_speed)}/s`,history:i,actionLabel:s("viewHistory"),onOpen:()=>r({type:"network",title:s("networkHistory"),entries:t.network_history})})]}),n(Fe,{columns:{base:1,md:2},gap:4,children:[e(jt,{label:s("incomingSpeed"),value:`${Be(t.incoming_bandwidth_speed)}/s`,colorScheme:"green"}),e(jt,{label:s("outgoingSpeed"),value:`${Be(t.outgoing_bandwidth_speed)}/s`,colorScheme:"blue"})]}),n(Fe,{columns:{base:1,md:3},gap:4,children:[e(jt,{label:s("memoryUsage"),value:`${Be(t.memory.current)} / ${Be(t.memory.total)}`}),e(jt,{label:s("swapUsage"),value:`${Be(t.swap.current)} / ${Be(t.swap.total)}`}),e(jt,{label:s("diskUsage"),value:`${Be(t.disk.current)} / ${Be(t.disk.total)}`})]}),n(fe,{direction:{base:"column",md:"row"},spacing:2,flexWrap:"wrap",alignItems:"flex-start",children:[n(lt,{colorScheme:"green",children:[s("systemUptime"),": ",ra(t.uptime_seconds)]}),n(lt,{colorScheme:"blue",children:[s("panelUptime"),": ",ra(t.panel_uptime_seconds)]}),n(lt,{colorScheme:"orange",children:[s("xrayUptime"),": ",ra(t.xray_uptime_seconds)]})]})]})})},nh=({data:t,t:s,onOpenHistory:r})=>{const l=t.panel_cpu_history.map(i=>i.value),a=t.panel_memory_history.map(i=>i.value);return e(zr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(fe,{spacing:4,children:[n(M,{justifyContent:"space-between",alignItems:"center",children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("panelUsage")}),e(Br,{colorScheme:t.xray_running?"green":"red",children:t.xray_running?s("status.running"):s("status.stopped")})]}),n(Fe,{columns:{base:1,md:2},gap:4,children:[e(ri,{label:s("cpuUsage"),value:`${t.panel_cpu_percent.toFixed(1)}%`,history:l,actionLabel:s("viewHistory"),onOpen:()=>r({type:"panel",title:s("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})}),e(ri,{label:s("memoryUsage"),value:`${t.panel_memory_percent.toFixed(1)}%`,history:a,actionLabel:s("viewHistory"),onOpen:()=>r({type:"panel",title:s("panelUsage"),cpuEntries:t.panel_cpu_history,memoryEntries:t.panel_memory_history})})]}),n(Fe,{columns:{base:1,md:2},gap:4,children:[e(jt,{label:s("threads"),value:Qr(t.app_threads),colorScheme:"purple"}),e(jt,{label:s("appMemory"),value:Be(t.app_memory),colorScheme:"blue"})]})]})})},sh=({value:t,t:s})=>{const r=We("gray.200","gray.700"),l=We("gray.50","gray.900"),a=We("primary.100","primary.900"),i=We("primary.500","primary.200");return e(z,{borderWidth:"1px",borderColor:r,borderRadius:"md",bg:l,p:4,children:n(M,{justifyContent:"space-between",alignItems:"center",children:[n(M,{alignItems:"center",spacing:3,children:[e(z,{p:2,borderRadius:"md",bg:a,children:e(ju,{color:i})}),e(h,{fontSize:"xs",color:"gray.500",children:s("UsersUsage")})]}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:Be(t)})]})})},ih=({data:t,t:s,usersUsage:r})=>e(zr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(fe,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("usersOverview")}),e(jt,{label:s("totalUsersLabel"),value:Qr(t.total_user),colorScheme:"blue"}),typeof r=="number"&&e(sh,{value:r,t:s}),n(Fe,{columns:{base:1,sm:2},gap:3,children:[e(jt,{label:s("status.active"),value:Qr(t.users_active),colorScheme:"green"}),e(jt,{label:s("status.disabled"),value:Qr(t.users_disabled),colorScheme:"red"}),e(jt,{label:s("status.expired"),value:Qr(t.users_expired),colorScheme:"orange"}),e(jt,{label:s("status.limited"),value:Qr(t.users_limited),colorScheme:"yellow"}),e(jt,{label:s("status.on_hold"),value:Qr(t.users_on_hold),colorScheme:"purple"})]})]})}),ah=({data:t,t:s})=>t?e(zr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(fe,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("yourUsage")}),n(Fe,{columns:{base:1,md:2},gap:4,children:[e(jt,{label:s("totalUsersLabel"),value:Qr(t.total_users),colorScheme:"blue"}),e(jt,{label:s("consumedData"),value:Be(t.consumed_bytes),colorScheme:"green"}),e(jt,{label:s("builtData"),value:Be(t.built_bytes),colorScheme:"purple"}),e(jt,{label:s("resetData"),value:Be(t.reset_bytes),colorScheme:"orange"})]})]})}):null,oh=({data:t,t:s})=>t?e(zr,{p:5,borderRadius:"12px",boxShadow:"none",children:n(fe,{spacing:4,children:[e(h,{fontSize:"lg",fontWeight:"semibold",children:s("adminOverview")}),n(Fe,{columns:{base:1,md:2},gap:3,children:[e(jt,{label:s("totalAdmins"),value:Qr(t.total_admins),colorScheme:"blue"}),e(jt,{label:s("sudoAdmins"),value:Qr(t.sudo_admins),colorScheme:"purple"}),e(jt,{label:s("fullAccessAdmins"),value:Qr(t.full_access_admins),colorScheme:"green"}),e(jt,{label:s("standardAdmins"),value:Qr(t.standard_admins),colorScheme:"orange"})]}),t.top_admin_username&&n(z,{children:[n(h,{fontSize:"sm",color:"gray.500",children:[s("topAdmin"),":"," ",e(h,{as:"span",fontWeight:"semibold",children:t.top_admin_username})]}),n(h,{fontSize:"sm",color:"gray.500",children:[s("topAdminUsage"),": ",Be(t.top_admin_usage)]})]})]})}):null,lh=t=>{var y;const{version:s}=Tt(),{userData:r}=hr(),{t:l}=qe(),{data:a}=Rr({queryKey:"statistics-query-key",queryFn:()=>ze("/system"),refetchInterval:3e3,onSuccess:({version:v})=>{s!==v&&Tt.setState({version:v})}}),[i,o]=d.exports.useState(null),[c,u]=d.exports.useState(Fl[0].seconds),p=r.role===Xe.Sudo||r.role===Xe.FullAccess,m=v=>{o(v)},g=[];a&&g.push(e(ih,{data:a,t:l,usersUsage:(y=r.users_usage)!=null?y:void 0},"users-overview"));const x=(a==null?void 0:a.personal_usage)&&e(ah,{data:a.personal_usage,t:l},"your-usage");x&&g.push(x);const S=g.length>1?2:1;return n(fe,{spacing:4,width:"full",...t,children:[a&&n(Bt,{children:[e(rh,{data:a,t:l,onOpenHistory:m}),e(nh,{data:a,t:l,onOpenHistory:m})]}),g.length>0&&e(Fe,{columns:{base:1,md:S},gap:4,children:g}),p&&a&&e(oh,{data:a.admin_overview,t:l}),e(eh,{isOpen:Boolean(i),onClose:()=>o(null),payload:i,intervalSeconds:c,onIntervalChange:u,t:l})]})},ch=()=>{const{t}=qe();return e(he,{spacing:6,align:"stretch",children:n(z,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(lh,{})]})})},ss=({children:t,color:s})=>e(z,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(h,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:t})}),gi=ie(Sn,{baseStyle:{w:5,h:5}}),dh=()=>{const[t,s]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:a}=Tt(),{t:i}=qe(),o=er(),c=()=>{l(null)},u=()=>{r&&(s(!0),a(r).then(()=>{o({title:i("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(s.bind(null,!1)))};return n(Wt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",children:[e(It,{pt:6,children:e(ss,{color:"red",children:e(gi,{})})}),e(Ht,{mt:3}),n(Dt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:r.username})})})]}),n(Ut,{display:"flex",children:[e(O,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(Rt,{size:"xs"}):void 0,children:i("delete")})]})]})]})},uh={search:"",limit:10,offset:0,sort:"username"},xn=zs((t,s)=>({admins:[],total:0,loading:!1,filters:uh,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=s(),a={...l,...r},i={};a.search&&(i.username=a.search),a.offset!==void 0&&(i.offset=a.offset),a.limit!==void 0&&(i.limit=a.limit),a.sort&&(a.sort==="data_usage"?i.sort="users_usage":a.sort==="data_limit"?i.sort="data_limit":i.sort=a.sort),t({loading:!0});try{const o=await ze("/admins",{query:i}),{admins:c,total:u}=Array.isArray(o)?{admins:o,total:o.length}:{admins:o.admins||[],total:o.total||0};t(p=>{const m=p.adminInDetails?c.find(g=>{var x;return g.username===((x=p.adminInDetails)==null?void 0:x.username)})||p.adminInDetails:null;return{admins:c,total:u,adminInDetails:m}})}catch(o){console.error("Failed to fetch admins:",o),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),s().fetchAdmins()},async createAdmin(r){await ze("/admin",{method:"POST",body:r}),await s().fetchAdmins()},async updateAdmin(r,l){await ze(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await s().fetchAdmins()},async deleteAdmin(r){await ze(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await s().fetchAdmins()},async resetUsage(r){await ze(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await s().fetchAdmins()},async disableAdmin(r,l){await ze(`/admin/${encodeURIComponent(r)}/disable`,{method:"POST",body:{reason:l}}),await s().fetchAdmins()},async enableAdmin(r){await ze(`/admin/${encodeURIComponent(r)}/enable`,{method:"POST"}),await s().fetchAdmins()},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),jn=zs((t,s)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await ze("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await ze(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await ze("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const a=await ze(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:a}),await s().fetchServices(),a}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await ze(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await s().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await ze(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),fi={baseStyle:{w:4,h:4}},hh=ie(pl,fi),ph=ie(Xc,fi),mh=ie(Ta,fi),gh=ie(on,fi),fh=ie(Pn,fi),po=[{key:"online",labelKey:"filters.advanced.online",fallback:"Online right now"},{key:"offline",labelKey:"filters.advanced.offline",fallback:"Offline for 24h"},{key:"sub_not_updated",labelKey:"filters.advanced.subNotUpdated",fallback:"Sub link stale for 24h"},{key:"sub_never_updated",labelKey:"filters.advanced.subNeverUpdated",fallback:"Sub link never updated"},{key:"limit",labelKey:"filters.advanced.limit",fallback:"Has data limit"},{key:"unlimited",labelKey:"filters.advanced.unlimited",fallback:"Unlimited users"},{key:"finished",labelKey:"filters.advanced.finished",fallback:"Finished (limited or expired)"},{key:"expired",labelKey:"filters.advanced.statusExpired",fallback:"Expired users"},{key:"limited",labelKey:"filters.advanced.statusLimited",fallback:"Limited users"},{key:"disabled",labelKey:"filters.advanced.statusDisabled",fallback:"Disabled users"},{key:"on_hold",labelKey:"filters.advanced.statusOnHold",fallback:"On-hold users"}],bh=Qc((t,s)=>{s==="users"?Tt.getState().onFilterChange({...Tt.getState().filters,offset:0,search:t}):xn.getState().onFilterChange({search:t,offset:0})},300),Hl=({for:t="users",...s})=>{var U,j,de,k,I,R,$,Ae;const{loading:r,filters:l,onFilterChange:a,refetchUsers:i,onCreateUser:o}=Tt(),{loading:c,filters:u,onFilterChange:p,fetchAdmins:m,openAdminDialog:g,admins:x}=xn(),{t:S}=qe(),[y,v]=d.exports.useState(""),{userData:E}=hr(),T=E.role===Xe.Sudo||E.role===Xe.FullAccess,L=!T&&E.status===Ln.Disabled,ce=Boolean(((j=(U=E.permissions)==null?void 0:U.admin_management)==null?void 0:j[ar.Edit])||E.role===Xe.FullAccess),P=T||Boolean((k=(de=E.permissions)==null?void 0:de.users)==null?void 0:k[ct.Create]),W=t==="users"?P&&!L:ce,A=t==="users"?r:c,X=t==="users",q=X?l:u,ge=X?l:void 0,H=Boolean(ge),oe=(I=ge==null?void 0:ge.advancedFilters)!=null?I:[],_=ge==null?void 0:ge.serviceId,ye=ge==null?void 0:ge.owner,{services:f,fetchServices:ae}=jn();d.exports.useEffect(()=>{ae({limit:500})},[ae]),d.exports.useEffect(()=>{T&&m({limit:200,offset:0})},[m,T]);const K=Se=>{const Je=po.find(N=>N.key===Se);return Je?S(Je.labelKey,Je.fallback):Se},xe=Se=>{if(!H)return;const Je=oe.includes(Se)?oe.filter(N=>N!==Se):[...oe,Se];a({advancedFilters:Je,offset:0})},Re=()=>{!H||oe.length===0||a({advancedFilters:[],offset:0})},Oe=Se=>{a({serviceId:Se?Number(Se):void 0,offset:0})},V=Se=>{a({owner:Se||void 0,offset:0})},be=Se=>{v(Se.target.value),bh(Se.target.value,t)},Ce=()=>{v(""),X?a({...l,offset:0,search:""}):p({search:"",offset:0})},Ee=()=>{t==="users"?i(!0):m()},ve=()=>{if(t==="users"){if(L||!P)return;o(!0)}else ce&&g()},B=(R=Tr({base:!0,sm:!1}))!=null?R:!1;return n(ai,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...s,children:[n(yn,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:[n(M,{spacing:2,align:"center",w:"full",children:[n(Nr,{flex:"1",children:[e(ml,{pointerEvents:"none",children:e(hh,{})}),e(De,{placeholder:t==="users"?S("search"):S("admins.searchPlaceholder","Search admins..."),value:y,borderColor:"light-border",w:"full",onChange:be}),n(Hr,{children:[A&&e(Rt,{size:"xs"}),q.search&&q.search.length>0&&e(He,{onClick:Ce,"aria-label":"clear",size:"xs",variant:"ghost",children:e(mh,{})})]})]}),H&&n(Hn,{placement:"bottom-start",children:[e(Bn,{children:e(O,{leftIcon:e(ph,{}),size:B?"sm":"md",variant:"outline",borderRadius:"full",minW:B?"auto":"8rem",h:B?"36px":void 0,fontSize:B?"xs":"sm",children:S("filters.advancedButton","Filters")})}),n(Vn,{borderColor:"light-border",minW:"250px",children:[e(ls,{}),e(Ua,{}),e(gl,{fontWeight:"semibold",children:S("filters.advancedTitle","Advanced filters")}),n($n,{children:[e(fe,{spacing:2,children:po.map(Se=>e(Er,{isChecked:oe.includes(Se.key),onChange:()=>xe(Se.key),children:K(Se.key)},Se.key))}),n(fe,{spacing:3,mt:3,children:[n(z,{children:[e(h,{fontSize:"sm",fontWeight:"semibold",mb:1,children:S("filters.advanced.serviceLabel","Service filter")}),n(rt,{value:_?String(_):"",onChange:Se=>Oe(Se.target.value),size:"sm",children:[e("option",{value:"",children:S("filters.advanced.serviceAll","All services")}),f.map(Se=>e("option",{value:String(Se.id),children:Se.name},Se.id))]})]}),T&&n(z,{children:[e(h,{fontSize:"sm",fontWeight:"semibold",mb:1,children:S("filters.advanced.adminLabel","Admin filter")}),n(rt,{value:ye!=null?ye:"",onChange:Se=>V(Se.target.value),size:"sm",children:[e("option",{value:"",children:S("filters.advanced.adminAll","All admins")}),e("option",{value:E.username,children:S("filters.advanced.adminMyUsers","My users")}),x.map(Se=>e("option",{value:Se.username,children:Se.username},Se.username))]})]})]}),e(O,{variant:"ghost",size:"sm",mt:3,w:"full",onClick:Re,isDisabled:oe.length===0,children:S("filters.advancedClear","Clear filters")})]})]})]}),e(He,{"aria-label":"refresh",disabled:A,onClick:Ee,size:B?"sm":"md",variant:B?"ghost":"outline",borderRadius:"full",minW:B?"36px":"40px",h:B?"36px":void 0,children:e(gh,{className:Ea({"animate-spin":A})})})]}),H&&(oe.length>0||Boolean(_)||Boolean(ye))&&n(vs,{mt:2,spacing:2,children:[oe.map(Se=>n(lt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ei,{children:K(Se)}),e(Ti,{onClick:Je=>{Je.preventDefault(),Je.stopPropagation(),xe(Se)}})]},Se)),_&&n(lt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ei,{children:S("filters.advanced.serviceTag","Service: {{name}}",{name:(Ae=($=f.find(Se=>Se.id===_))==null?void 0:$.name)!=null?Ae:_})}),e(Ti,{onClick:Se=>{Se.preventDefault(),Se.stopPropagation(),Oe("")}})]},"service"),ye&&n(lt,{size:"sm",borderRadius:"full",variant:"solid",colorScheme:"primary",children:[e(ei,{children:ye===E.username?S("filters.advanced.adminTagMine","My users"):ye}),e(Ti,{onClick:Se=>{Se.preventDefault(),Se.stopPropagation(),V("")}})]},"owner")]})]}),e(yn,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(fe,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:W&&e(O,{colorScheme:"primary",size:B?"sm":"md",onClick:ve,isDisabled:t==="admins"&&!ce,px:B?3:5,leftIcon:B?void 0:e(fh,{}),w:"auto",h:B?"36px":void 0,minW:B?"auto":"8.5rem",fontSize:B?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?S("createUser"):S("admins.addAdmin","Add admin")})})})]})},yh=ie(Zc,{baseStyle:{w:4,h:4}}),Sh=ie(jc,{baseStyle:{w:4,h:4}}),mo=5;function xh(t,s,r){if(r<mo)throw new Error(`Must allow at least ${mo} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,s-Math.floor(r/2))),a=new Array(r);for(let i=0;i<r;i+=1)a[i]=i+l;return typeof a[0]=="number"&&a[0]>0&&(a[0]=0,a[1]="prev-more"),a[a.length-1]<t-1&&(a[a.length-1]=t-1,a[a.length-2]="next-more"),a}const Bl=({for:t="users"})=>{const{filters:s,onFilterChange:r,users:{total:l}}=Tt(),{filters:a,onFilterChange:i,total:o}=xn(),{t:c}=qe(),{filters:u,total:p,onFilterChange:m}=d.exports.useMemo(()=>t==="admins"?{filters:a,total:o,onFilterChange:i}:{filters:s,total:l,onFilterChange:r},[t,a,o,i,s,l,r]),{limit:g,offset:x}=u,S=Number(g||10),y=Number(x||0),v=Math.floor(y/S),E=Math.ceil(p/S),T=xh(E,v,7),L=A=>{m({...u,offset:A*S})},ce=A=>{const X=parseInt(A.target.value,10);m({...u,limit:X,offset:0}),t==="users"&&Ku(A.target.value)},P=d.exports.useMemo(()=>v>0&&E>0,[v,E]),W=d.exports.useMemo(()=>v+1<E&&E>0,[v,E]);return p<=S&&v===0?null:n(M,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(z,{order:{base:2,md:1},children:n(M,{children:[n(rt,{minW:"60px",value:String(S),onChange:ce,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),n(fl,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(O,{leftIcon:e(yh,{}),onClick:()=>L(v-1),isDisabled:!P,children:c("previous")}),T.map(A=>typeof A=="string"?e(O,{children:"..."},A):e(O,{variant:A===v?"solid":"outline",onClick:()=>L(A),children:A+1},A)),e(O,{rightIcon:e(Sh,{}),onClick:()=>L(v+1),isDisabled:!W,children:c("next")})]})]})},vh=ed;const go=ie(td),wh=ie(La,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),kh=ie(bl,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Ch=ie(yl,{baseStyle:{w:5,h:5}}),_h=()=>{const{QRcodeLinks:t,setQRCode:s,setSubLink:r,subscribeUrl:l}=Tt(),a=t!==null,[i,o]=d.exports.useState(0),{t:c}=qe(),u=()=>{s(null),r(null)},p=String(l).startsWith("/")?window.location.origin+l:String(l);return n(Wt,{isOpen:a,onClose:u,children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(It,{pt:6,children:e(ss,{color:"primary",children:e(Ch,{color:"white"})})}),e(Ht,{mt:3}),t&&n(Dt,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&n(he,{children:[e(go,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),n(z,{w:"300px",children:[e(vh,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:o,onInit:()=>o(0),nextArrow:e(He,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(wh,{})}),prevArrow:e(He,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(kh,{})}),children:t.map((m,g)=>e(M,{children:e(go,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"})},g))}),n(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},Dh=ie(on,{baseStyle:{w:5,h:5}}),Ah=()=>{const[t,s]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=Tt(),{t:a}=qe(),i=er(),o=()=>{Tt.setState({resetUsageUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{i({title:a("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:a("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Wt,{isCentered:!0,isOpen:!!r,onClose:o,size:"sm",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",children:[e(It,{pt:6,children:e(ss,{color:"blue",children:e(Dh,{})})}),e(Ht,{mt:3}),n(Dt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:a("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:a("resetUserUsage.prompt",{username:r.username})})})]}),n(Ut,{display:"flex",children:[e(O,{size:"sm",onClick:o,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Rt,{size:"xs"}):void 0,children:a("reset")})]})]})]})},Ih=ie(on,{baseStyle:{w:5,h:5}}),Ph=()=>{const[t,s]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=Tt(),{t:a}=qe(),i=er(),o=()=>{Tt.setState({revokeSubscriptionUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{i({title:a("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:a("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Wt,{isCentered:!0,isOpen:!!r,onClose:o,size:"sm",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",children:[e(It,{pt:6,children:e(ss,{color:"blue",children:e(Ih,{})})}),e(Ht,{mt:3}),n(Dt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:a("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:a("revokeUserSub.prompt",{username:r.username})})})]}),n(Ut,{display:"flex",children:[e(O,{size:"sm",onClick:o,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Rt,{size:"xs"}):void 0,children:a("revoke")})]})]})]})},bi={baseStyle:{strokeWidth:"2px",w:4,h:4}},fo=ie(rd,bi),Th=ie(nd,bi),bo=ie(sd,bi),yo=ie(Sl,bi),Eh=ie(Sl,bi),va=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],es={active:{statusColor:"green",bandWidthColor:"primary",icon:fo},connected:{statusColor:"green",bandWidthColor:"primary",icon:fo},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:Th},expired:{statusColor:"orange",bandWidthColor:"orange",icon:yo},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Eh},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:yo},limited:{statusColor:"red",bandWidthColor:"red",icon:bo},error:{statusColor:"red",bandWidthColor:"red",icon:bo}},Nh=async()=>ze("/settings/telegram"),zh=async t=>ze("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),Fa=async()=>ze("/settings/panel"),Rh=async t=>ze("/settings/panel",{method:"PUT",body:JSON.stringify(t)}),$i=t=>{let s={status:"",time:""};if(t){Me(t*1e3).utc().isAfter(Me().utc())?s.status="expires":s.status="expired";const r=[],l=Me.duration(Me(t*1e3).utc().diff(Me()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),s.time=r.join(", ")}return s},Mh=({value:t,onChange:s,placeholder:r="Select date",disabled:l=!1,minDate:a,quickSelects:i=[]})=>{const{isOpen:o,onOpen:c,onClose:u}=Zt(),[p,m]=d.exports.useState(()=>t?Me(t):Me()),[g,x]=d.exports.useState({hour:t?Me(t).hour():12,minute:t?Me(t).minute():0}),S=We("white","gray.900"),y=We("gray.900","white"),v=We("gray.200","gray.700"),E=We("gray.50","gray.800"),T=We("gray.100","gray.700"),L=We("gray.100","gray.700"),ce=We("gray.500","gray.400"),P=We("gray.400","gray.500"),W=We("gray.100","gray.700"),A=We("gray.200","gray.700"),X=We("gray.600","gray.400"),q=We("primary.500","primary.400");d.exports.useEffect(()=>{t&&(m(Me(t)),x({hour:Me(t).hour(),minute:Me(t).minute()}))},[t]);const ge=()=>{t||(m(Me()),x({hour:12,minute:0})),u()},H=p.daysInMonth(),oe=p.startOf("month").day(),_=Me(),ye=t?Me(t):null,f=Ce=>{const Ee=p.date(Ce).hour(g.hour).minute(g.minute).second(0).millisecond(0);a&&Ee.isBefore(Me(a),"day")||s(Ee.toDate())},ae=(Ce,Ee)=>{if(x({hour:Ce,minute:Ee}),t){const ve=Me(t).hour(Ce).minute(Ee);s(ve.toDate())}},K=()=>{s(null),m(Me()),x({hour:12,minute:0}),u()},xe=()=>m(p.subtract(1,"month")),Re=()=>m(p.add(1,"month")),Oe=Ce=>{const ve=(t?Me(t):Me()).add(Ce,"day");s(ve.toDate())},V=()=>{const Ce=[],Ee=a?Me(a):null;for(let ve=0;ve<oe;ve++)Ce.push(e(yn,{},`empty-${ve}`));for(let ve=1;ve<=H;ve++){const B=p.date(ve),U=B.isSame(_,"day"),j=ye==null?void 0:ye.isSame(B,"day"),de=Ee&&B.isBefore(Ee,"day");Ce.push(e(yn,{children:e(O,{size:"xs",variant:"ghost",w:"full",h:"28px",minW:"28px",fontSize:"xs",fontWeight:U?"bold":"normal",bg:j?"primary.500":"transparent",color:j?"white":de?P:"inherit",border:U?"1px solid":"none",borderColor:q,_hover:{bg:de?"transparent":j?"primary.600":W},onClick:()=>!de&&f(ve),isDisabled:!!de,cursor:de?"not-allowed":"pointer",children:ve})},ve))}return Ce},be=t?Me(t).format("YYYY/MM/DD HH:mm"):"";return n(Hn,{isOpen:o,onOpen:c,onClose:ge,placement:"bottom-start",isLazy:!0,children:[e(Bn,{children:e(De,{value:be,placeholder:r,size:"sm",isReadOnly:!0,cursor:"pointer",isDisabled:l,onClick:c,bg:"transparent",_dark:{bg:"transparent"}})}),e(Wi,{children:e(Vn,{w:"auto",maxW:"min(90vw, 420px)",bg:S,borderColor:v,color:y,_focus:{boxShadow:"none"},children:e($n,{p:0,children:n(pt,{children:[n(he,{spacing:1,align:"stretch",px:2,py:2,bg:E,minW:"100px",maxW:"110px",borderRight:"1px solid",borderColor:T,flexShrink:0,children:[e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Oe(1),_hover:{bg:L},children:"+1 Day"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Oe(30),_hover:{bg:L},children:"+1 Month"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Oe(90),_hover:{bg:L},children:"+3 Months"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Oe(180),_hover:{bg:L},children:"+6 Months"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Oe(365),_hover:{bg:L},children:"+1 Year"}),e(O,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>Oe(1095),_hover:{bg:L},children:"+3 Years"})]}),n(z,{flex:"1",p:2,children:[n(pt,{justify:"space-between",align:"center",mb:2,children:[n(M,{spacing:1,children:[e(He,{"aria-label":"Previous month",size:"xs",variant:"ghost",icon:e(bl,{width:14,height:14}),onClick:xe,_hover:{bg:L}}),e(He,{"aria-label":"Next month",size:"xs",variant:"ghost",icon:e(La,{width:14,height:14}),onClick:Re,_hover:{bg:L}})]}),e(h,{fontSize:"xs",fontWeight:"semibold",children:p.format("MMMM YYYY")})]}),e(ai,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:1,children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(Ce=>e(yn,{children:e(h,{fontSize:"2xs",textAlign:"center",color:ce,fontWeight:"semibold",children:Ce})},Ce))}),e(ai,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:2,children:V()}),n(M,{spacing:2,justify:"center",pt:2,borderTop:"1px solid",borderColor:A,children:[e(h,{fontSize:"2xs",color:X,children:"Time:"}),e(De,{type:"number",size:"xs",w:"45px",min:0,max:23,value:g.hour,onChange:Ce=>{const Ee=Math.max(0,Math.min(23,parseInt(Ce.target.value)||0));ae(Ee,g.minute)},textAlign:"center",fontSize:"xs"}),e(h,{fontSize:"xs",children:":"}),e(De,{type:"number",size:"xs",w:"45px",min:0,max:59,value:g.minute,onChange:Ce=>{const Ee=Math.max(0,Math.min(59,parseInt(Ce.target.value)||0));ae(g.hour,Ee)},textAlign:"center",fontSize:"xs"})]}),n(M,{spacing:2,justify:"flex-end",mt:2,children:[e(O,{size:"xs",variant:"ghost",onClick:K,children:"Clear"}),e(O,{size:"xs",colorScheme:"primary",onClick:ge,children:"Done"})]})]})]})})})})]})},yi=d.exports.forwardRef((t,s)=>e(id,{...t,ref:s}));yi.displayName="DatePicker";function Uh(t){const s=360/t,r=90,l=47,a=[];for(let i=0;i<t;i++){const o=i*s%360+140,c=Lh(o,r,l);a.push(c)}return a}function Lh(t,s,r){t/=360,s/=100,r/=100;let l,a,i;if(s===0)l=a=i=r;else{const c=(m,g,x)=>(x<0&&(x+=1),x>1&&(x-=1),x<.16666666666666666?m+(g-m)*6*x:x<.5?g:x<.6666666666666666?m+(g-m)*(.6666666666666666-x)*6:m),u=r<.5?r*(1+s):r+s-r*s,p=2*r-u;l=Math.round(c(p,u,t+1/3)*255),a=Math.round(c(p,u,t)*255),i=Math.round(c(p,u,t-1/3)*255)}const o=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${o(l)}${o(a)}${o(i)}`}const So=({border:t,...s})=>{const{getInputProps:r,getRadioProps:l}=ld(s),a=Tr({base:"xs",md:"sm"});return n(z,{as:"label",children:[e("input",{...r()}),e(z,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:a,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},Oh=({onChange:t,defaultValue:s,...r})=>{const{t:l,i18n:a}=qe();Zr();const i=Tr({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),o={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=Tr({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:p,setValue:m}=ad({name:"filter",defaultValue:s,onChange:_=>{if(_==="custom")return;S(),i.indexOf(_)>=0?(E(l("userDialog.custom")),L(!1)):(E(l("userDialog.custom")+` (${_})`),L(!0));const ye=Number(_.substring(0,_.length-1)),f=o[_[_.length-1]];t(_,{start:Me().utc().subtract(ye,f).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:g,onOpen:x,onClose:S}=Zt(),y=d.exports.useRef(null);od({ref:y,handler:S});const[v,E]=d.exports.useState(l("userDialog.custom")),[T,L]=d.exports.useState(!1),[ce,P]=d.exports.useState(0),W=Tr({base:1,md:2}),A=Tr({base:"xs",md:"sm"}),[X,q]=d.exports.useState(null),[ge,H]=d.exports.useState(null),oe=_=>{const[ye,f]=_;ge&&!f?(q(null),H(null)):(q(ye),H(f),ye&&f&&(S(),t("custom",{start:Me(ye).format("YYYY-MM-DDT00:00:00"),end:Me(f).format("YYYY-MM-DDT23:59:59")})))};return n(he,{...r,children:[ce==0&&n(Fe,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(_=>e(So,{...p({value:_}),children:_},_)),e(z,{onClick:()=>{q(null),H(null),x()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:A,px:3,py:1,bg:T?"primary.500":"unset",color:T?"white":"unset",borderColor:T?"primary.500":"unset",children:n(M,{children:[e(h,{children:v}),e(ti,{as:Xa,boxSize:"18px"})]})})]}),ce==1&&n(M,{onClick:x,cursor:"pointer",fontSize:A,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:X?"unset":"gray.500",children:X?Me(X).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(ti,{as:La,boxSize:"18px"}),e(h,{w:"full",color:ge?"unset":"gray.500",children:ge?Me(ge).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(ti,{as:Xa,boxSize:"18px"})]}),e(he,{ref:y,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:n(cs,{onChange:_=>P(_),children:[n(ds,{children:[e(Xt,{fontSize:A,children:l("userDialog.relative")}),e(Xt,{fontSize:A,children:l("userDialog.absolute")})]}),n(us,{children:[e(Qt,{children:c.map(_=>e(he,{alignItems:"start",pl:2,pr:2,children:n(M,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:A,minW:"60px",children:l("userDialog."+_.title)}),_.options.map(ye=>e(So,{border:!0,...p({value:ye}),children:ye},ye+".custom"))]})},_.title))}),e(Qt,{className:"datepicker-panel",children:e(he,{children:e(yi,{locale:a.language.toLocaleLowerCase(),selected:X,onChange:oe,startDate:X,endDate:ge,selectsRange:!0,maxDate:new Date,monthsShown:W,peekNextMonth:!1,inline:!0})})})]})]})})]})};function Li(t,s,r=[],l=[]){const a=Be(r.reduce((i,o)=>i+=o,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${a}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:o,w:c})=>Be(c.config.series[o],1)},tooltip:{custom:({series:i,seriesIndex:o,dataPointIndex:c,w:u})=>{const p=Be(i[o],1),m=Math.max(i.reduce((x,S)=>x+=S),1),g=Math.round(i[o]/m*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[o]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[o]}: <b>${g}, ${p}</b>
            </div>
          `}},colors:Uh(r.length)}}}const Wh=ie(cd,{baseStyle:{w:5,h:5}}),Fh=ie(Fn,{baseStyle:{w:5,h:5}}),Hh=ie(dl,{baseStyle:{w:5,h:5}}),Bh=ie(dd,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});ie(hi,{baseStyle:{w:4,h:4}});const Vh=t=>{var r,l,a,i,o;const s=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(s),next_plan_data_limit:s!=null&&s.data_limit?Number((s.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(a=s==null?void 0:s.expire)!=null?a:null,next_plan_add_remaining_traffic:(i=s==null?void 0:s.add_remaining_traffic)!=null?i:!1,next_plan_fire_on_either:(o=s==null?void 0:s.fire_on_either)!=null?o:!0}},sa=()=>({data_limit:null,ip_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),Ws={username:ke.string().min(1,{message:"Required"}),note:ke.string().nullable(),service_id:ke.union([ke.string(),ke.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),proxies:ke.record(ke.string(),ke.record(ke.string(),ke.any())).transform(t=>{const s=(r,l)=>{r&&r[l]===""&&delete r[l]};return s(t.vmess,"id"),s(t.vless,"id"),s(t.trojan,"password"),s(t.shadowsocks,"password"),s(t.shadowsocks,"method"),t}),data_limit:ke.string().min(0).or(ke.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:ke.number().nullable(),data_limit_reset_strategy:ke.string(),inbounds:ke.record(ke.string(),ke.array(ke.string())).transform(t=>(Object.keys(t).forEach(s=>{var r;Array.isArray(t[s])&&!((r=t[s])!=null&&r.length)&&delete t[s]}),t)),next_plan_enabled:ke.boolean().default(!1),next_plan_data_limit:ke.union([ke.string(),ke.number(),ke.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:Math.max(0,s)}),next_plan_expire:ke.union([ke.number(),ke.string(),ke.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),next_plan_add_remaining_traffic:ke.boolean().default(!1),next_plan_fire_on_either:ke.boolean().default(!0),ip_limit:ke.union([ke.number().min(0),ke.null()]).optional().transform(t=>typeof t!="number"?null:Number.isFinite(t)?t:null)},$h=ke.discriminatedUnion("status",[ke.object({status:ke.literal("active"),...Ws}),ke.object({status:ke.literal("disabled"),...Ws}),ke.object({status:ke.literal("limited"),...Ws}),ke.object({status:ke.literal("expired"),...Ws}),ke.object({status:ke.literal("on_hold"),on_hold_expire_duration:ke.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...Ws})]),Kh=()=>{var cr,mr,gr,re,_e,Y,Ge,kt,Vt,Et,Nt,ut,ht,At,rr,vr,Vr;const{editingUser:t,isCreatingNewUser:s,onCreateUser:r,editUser:l,fetchUserUsage:a,onEditingUser:i,createUserWithService:o,onDeletingUser:c,users:u,isUserLimitReached:p}=Tt(),m=!!t,g=s||m,x=(cr=u.users_limit)!=null?cr:null,S=(mr=u.active_total)!=null?mr:null,y=p&&!m,[v,E]=d.exports.useState(!1),[T,L]=d.exports.useState(""),ce=er(),{t:P}=qe(),{colorMode:W}=Zr(),A=jr({defaultValues:sa(),resolver:Fi($h)}),X=A.getValues("expire"),q=A.getValues("next_plan_expire");function ge(G){if(typeof G!="number"||G<=0)return null;const Ie=Me.unix(G).utc().local(),Ve=Me(),Qe=Ie.diff(Ve,"day",!0);return Number.isFinite(Qe)?Math.max(0,Math.round(Qe)):null}function H(G){return Me().add(G,"day").endOf("day").utc().unix()}const[oe,_]=d.exports.useState(()=>ge(X)),[ye,f]=d.exports.useState(()=>ge(q)),ae=[{label:P("userDialog.quickSelectOneMonth","+1 month"),amount:1,unit:"month"},{label:P("userDialog.quickSelectThreeMonths","+3 months"),amount:3,unit:"month"},{label:P("userDialog.quickSelectOneYear","+1 year"),amount:1,unit:"year"}],K=jn(G=>G.services),xe=jn(G=>G.isLoading),{userData:Re,getUserIsSuccess:Oe}=hr(),V=Boolean(Oe&&(Re.role===Xe.Sudo||Re.role===Xe.FullAccess));V||Boolean((re=(gr=Re.permissions)==null?void 0:gr.users)==null?void 0:re[ct.Create]);const be=V||Boolean((Y=(_e=Re.permissions)==null?void 0:_e.users)==null?void 0:Y[ct.Delete]),Ce=V||Boolean((kt=(Ge=Re.permissions)==null?void 0:Ge.users)==null?void 0:kt[ct.ResetUsage]),Ee=V||Boolean((Et=(Vt=Re.permissions)==null?void 0:Vt.users)==null?void 0:Et[ct.Revoke]),[ve,B]=d.exports.useState(null),U=K.length>0,j=ve&&(Nt=K.find(G=>G.id===ve))!=null?Nt:null,de=Boolean(t==null?void 0:t.service_id),k=!V&&K.length===1,I=V||K.length!==1,R=I&&K.length>0,$=!R,Ae=!V&&K.length===0,{data:Se}=Rr("panel-settings",Fa,{enabled:g,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),Je=Boolean(Se==null?void 0:Se.use_nobetci),[N,Z]=d.exports.useState(!1),F=()=>{Z(G=>!G)};d.exports.useEffect(()=>{g&&jn.getState().fetchServices()},[g]),d.exports.useEffect(()=>{var G,Ie;m?t!=null&&t.service_id?B(t.service_id):V?B(null):K.length?B((Ie=(G=K[0])==null?void 0:G.id)!=null?Ie:null):B(null):g||B(null)},[m,t,g,V,K]),d.exports.useEffect(()=>{!m&&g&&U&&B(G=>{var Ie,Ve;return(Ve=G!=null?G:(Ie=K[0])==null?void 0:Ie.id)!=null?Ve:null})},[K,m,g,U]),d.exports.useEffect(()=>{!m&&g&&!U&&B(null)},[U,m,g]),d.exports.useEffect(()=>{k&&K[0]&&B(G=>G!=null?G:K[0].id)},[k,K]);const[pe,Q]=tr({control:A.control,name:["data_limit","status"]}),Pe=tr({control:A.control,name:"next_plan_enabled"}),Te=tr({control:A.control,name:"expire"}),le=tr({control:A.control,name:"next_plan_data_limit"}),Le=tr({control:A.control,name:"next_plan_expire"}),Ke=tr({control:A.control,name:"next_plan_add_remaining_traffic"}),ne=tr({control:A.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const G=ge(Te);_(Ie=>Ie===G?Ie:G)},[Te]),d.exports.useEffect(()=>{const G=ge(Le);f(Ie=>Ie===G?Ie:G)},[Le]);const Ye=G=>{A.setValue("next_plan_enabled",G,{shouldDirty:!0}),G?(A.getValues("next_plan_data_limit")===null&&A.setValue("next_plan_data_limit",0,{shouldDirty:!1}),A.getValues("next_plan_add_remaining_traffic")===void 0&&A.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),A.getValues("next_plan_fire_on_either")===void 0&&A.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(A.setValue("next_plan_data_limit",null,{shouldDirty:!0}),A.setValue("next_plan_expire",null,{shouldDirty:!0}),f(null))},te=P("userDialog.total"),[ee,Ne]=d.exports.useState(Li(W,te)),[at,ot]=d.exports.useState("1m"),yt=G=>{a(t,G).then(Ie=>{const Ve=[],Qe=[];for(const xt in Ie.usages)Qe.push(Ie.usages[xt].used_traffic),Ve.push(Ie.usages[xt].node_name);Ne(Li(W,te,Qe,Ve))})};d.exports.useEffect(()=>{if(t){const G=Vh(t);A.reset(G),_(ge(G.expire)),f(ge(G.next_plan_expire)),yt({start:Me().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const G=sa();A.reset(G),_(ge(G.expire)),f(ge(G.next_plan_expire))}},[t,m,g]);const et=G=>{var ln,Gr;if(y)return;E(!0),L(null);const{service_id:Ie,next_plan_enabled:Ve,next_plan_data_limit:Qe,next_plan_expire:xt,next_plan_add_remaining_traffic:Gt,next_plan_fire_on_either:fr,proxies:Mr,inbounds:dr,status:wr,data_limit:$r,data_limit_reset_strategy:vn,on_hold_expire_duration:En,ip_limit:Kr,...Jr}=G,we=Ve&&Qe&&Qe>0?Number((Number(Qe)*1073741824).toFixed(5)):0,qr=Ve?{data_limit:we,expire:xt!=null?xt:0,add_remaining_traffic:Gt,fire_on_either:fr}:null,Yr=typeof Kr=="number"&&Number.isFinite(Kr)&&Kr>0?Math.floor(Kr):0;if(!m){const Lt=ve!=null?ve:k&&(Gr=(ln=K[0])==null?void 0:ln.id)!=null?Gr:null;if(!Lt){L(P("userDialog.selectService","Please choose a service")),E(!1);return}const wn={username:G.username,service_id:Lt,note:G.note,status:G.status==="active"||G.status==="disabled"||G.status==="on_hold"?G.status:"active",expire:G.expire,data_limit:G.data_limit,ip_limit:Yr,data_limit_reset_strategy:$r&&$r>0?vn:"no_reset",on_hold_expire_duration:wr==="on_hold"?En:null};qr&&(wn.next_plan=qr),o(wn).then(()=>{ce({title:P("userDialog.userCreated",{username:G.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Jt()}).catch($t=>{var cn,dn,un,hn,Nn;(((cn=$t==null?void 0:$t.response)==null?void 0:cn.status)===409||((dn=$t==null?void 0:$t.response)==null?void 0:dn.status)===400)&&L((hn=(un=$t==null?void 0:$t.response)==null?void 0:un._data)==null?void 0:hn.detail),((Nn=$t==null?void 0:$t.response)==null?void 0:Nn.status)===422&&Object.keys($t.response._data.detail).forEach(kn=>{L($t==null?void 0:$t.response._data.detail[kn]),A.setError(kn,{type:"custom",message:$t.response._data.detail[kn]})})}).finally(()=>{E(!1)});return}const kr={...Jr,data_limit:$r,ip_limit:Yr,data_limit_reset_strategy:$r&&$r>0?vn:"no_reset",status:wr==="active"||wr==="disabled"||wr==="on_hold"?wr:"active",on_hold_expire_duration:wr==="on_hold"?En:null};qr?kr.next_plan=qr:!Ve&&(t==null?void 0:t.next_plan)&&(kr.next_plan=null),t!=null&&t.service_id||(Mr&&Object.keys(Mr).length>0&&(kr.proxies=Mr),dr&&Object.keys(dr).length>0&&(kr.inbounds=dr)),typeof ve<"u"&&(ve===null?V&&(kr.service_id=null):ve!==(t==null?void 0:t.service_id)&&(kr.service_id=ve)),l(t.username,kr).then(()=>{ce({title:P("userDialog.userEdited",{username:G.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),Jt()}).catch(Lt=>{var wn,$t,cn,dn,un;(((wn=Lt==null?void 0:Lt.response)==null?void 0:wn.status)===409||(($t=Lt==null?void 0:Lt.response)==null?void 0:$t.status)===400)&&L((dn=(cn=Lt==null?void 0:Lt.response)==null?void 0:cn._data)==null?void 0:dn.detail),((un=Lt==null?void 0:Lt.response)==null?void 0:un.status)===422&&Object.keys(Lt.response._data.detail).forEach(hn=>{L(Lt==null?void 0:Lt.response._data.detail[hn]),A.setError(hn,{type:"custom",message:Lt.response._data.detail[hn]})})}).finally(()=>{E(!1)})},Jt=()=>{A.reset(sa()),_(null),f(null),r(!1),i(null),L(null),Z(!1),ot("1m"),B(null)},qt=()=>{!Ce||Tt.setState({resetUsageUser:t})},wt=()=>{!Ee||Tt.setState({revokeSubscriptionUser:t})},dt=v||y,lr=Q==="on_hold",[Sr,pr]=d.exports.useState(!1),xr=()=>{pr(!0);let G="";const Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ve=Ie.length;let Qe=0;for(;Qe<6;)G+=Ie.charAt(Math.floor(Math.random()*Ve)),Qe+=1;return G};return n(Wt,{isOpen:g,onClose:Jt,size:Ae?"lg":"2xl",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(ud,{...A,children:n(Ft,{mx:"3",position:"relative",overflow:"hidden",children:[e(Ht,{mt:3,disabled:v}),e(z,{pointerEvents:y?"none":"auto",filter:y?"blur(6px)":"none",transition:"filter 0.2s ease",children:n("form",{onSubmit:A.handleSubmit(et),children:[e(It,{pt:6,children:n(M,{gap:2,children:[e(ss,{color:"primary",children:m?e(Fh,{color:"white"}):e(Wh,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:P(m?"userDialog.editUserTitle":"createNewUser")})]})}),n(Dt,{children:[m&&de&&n(Wr,{status:"info",mb:4,borderRadius:"md",children:[e(Fr,{}),P("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(ut=t==null?void 0:t.service_name)!=null?ut:""})]}),n(ai,{templateColumns:{base:"repeat(1, 1fr)",md:R?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...$?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(yn,{children:n(he,{justifyContent:"space-between",children:[n(pt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(pt,{flexDirection:"row",w:"full",gap:2,children:n(C,{mb:"10px",isInvalid:!!((ht=A.formState.errors.username)!=null&&ht.message),children:[e(D,{children:P("username")}),n(M,{align:"flex-end",children:[e(z,{flex:"1",minW:"0",children:n(Nr,{size:"sm",children:[e(De,{type:"text",borderRadius:"6px",placeholder:P("username"),isDisabled:dt||m,...A.register("username")}),!m&&e(Hr,{width:"auto",pr:1,children:e(He,{"aria-label":P("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(Mi,{width:18}),onClick:()=>{const G=xr();A.setValue("username",G,{shouldDirty:!0}),setTimeout(()=>{pr(!1)},350)},isLoading:Sr,isDisabled:dt})})]})}),m&&e(M,{px:1,children:e(St,{name:"status",control:A.control,render:({field:G})=>e(mt,{placement:"top",label:"status: "+P(`status.${G.value}`),textTransform:"capitalize",children:e(z,{children:e(gt,{colorScheme:"primary",isChecked:G.value==="active",onChange:Ie=>{Ie.target.checked?G.onChange("active"):G.onChange("disabled")}})})})})})]}),e(nn,{children:(At=A.formState.errors.username)==null?void 0:At.message})]})}),n(fe,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[n(C,{flex:"1",children:[e(D,{children:P("userDialog.dataLimit")}),e(St,{control:A.control,name:"data_limit",render:({field:G})=>{var Ie;return e(or,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",onChange:G.onChange,disabled:dt,error:(Ie=A.formState.errors.data_limit)==null?void 0:Ie.message,value:G.value?String(G.value):""})}})]}),Je&&n(C,{flex:"1",children:[n(D,{display:"flex",alignItems:"center",gap:2,children:[P("userDialog.ipLimitLabel","IP limit"),e(mt,{hasArrow:!0,placement:"top",label:P("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(ie.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(xl,{width:16,height:16})})})]}),e(St,{control:A.control,name:"ip_limit",rules:{validate:G=>G==null?!0:typeof G!="number"||Number.isNaN(G)?P("userDialog.ipLimitValidation","Enter a valid non-negative number"):G>=0?!0:P("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:G})=>{var Ie;return e(or,{size:"sm",borderRadius:"6px",placeholder:P("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof G.value=="number"&&G.value>0?String(G.value):"",onChange:Ve=>{const Qe=Ve.target.value;if(!Qe.trim()||Qe.trim()==="-"){G.onChange(null);return}const xt=Number(Qe);Number.isNaN(xt)||G.onChange(xt<0?0:Math.floor(xt))},disabled:dt,error:(Ie=A.formState.errors.ip_limit)==null?void 0:Ie.message})}})]})]}),e(_s,{in:!!(pe&&pe>0),animateOpacity:!0,style:{width:"100%"},children:n(C,{height:"66px",children:[e(D,{children:P("userDialog.periodicUsageReset")}),e(St,{control:A.control,name:"data_limit_reset_strategy",render:({field:G})=>e(rt,{size:"sm",...G,disabled:dt,bg:dt?"gray.100":"transparent",_dark:{bg:dt?"gray.600":"transparent"},sx:{option:{backgroundColor:W==="dark"?"#222C3B":"white"}},children:va.map(Ie=>e("option",{value:Ie.value,children:P("userDialog.resetStrategy"+Ie.title)},Ie.value))})})]})}),n(C,{mb:"10px",isInvalid:!lr&&Boolean(A.formState.errors.expire),children:[n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(D,{mb:0,children:lr?P("userDialog.onHoldExpireDuration"):P("userDialog.expiryDaysLabel","Expires in (days)")}),!m&&e(St,{name:"status",control:A.control,render:({field:G})=>{const Ie=G.value==="on_hold";return n(M,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:P("userDialog.onHold")}),e(gt,{colorScheme:"primary",isChecked:Ie,onChange:Ve=>{Ve.target.checked?G.onChange("on_hold"):(G.onChange("active"),A.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:dt})]})}})]}),lr?e(St,{control:A.control,name:"on_hold_expire_duration",render:({field:G})=>{var Ie;return e(or,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Ve=>{A.setValue("expire",null);const Qe=Ve.target.value;if(!Qe){G.onChange(null);return}const xt=Number(Qe);Number.isNaN(xt)||xt<0||G.onChange(Math.round(xt))},disabled:dt,error:(Ie=A.formState.errors.on_hold_expire_duration)==null?void 0:Ie.message,value:G.value?String(G.value):""})}}):n(Bt,{children:[e(St,{name:"expire",control:A.control,render:({field:G})=>{const{status:Ie,time:Ve}=$i(G.value),Qe=G.value?Me.unix(G.value).toDate():null,xt=Gt=>{if(!Gt){G.onChange(null),A.setValue("on_hold_expire_duration",null,{shouldDirty:!1});return}const fr=Me(Gt).utc().unix();A.setValue("on_hold_expire_duration",null,{shouldDirty:!1}),G.onChange(fr)};return n(z,{children:[e(Mh,{value:Qe,onChange:xt,placeholder:P("userDialog.selectExpiryDate","Select expiration date"),disabled:dt,minDate:new Date,quickSelects:ae.map(Gt=>({label:Gt.label,onClick:()=>{const fr=Me().add(Gt.amount,Gt.unit).endOf("day");xt(fr.toDate())}}))}),G.value?e(ur,{children:P(Ie,{time:Ve})}):null]})}}),e(nn,{children:(rr=A.formState.errors.expire)==null?void 0:rr.message})]})]}),n(z,{mb:"10px",children:[n(M,{justify:"space-between",align:"center",children:[e(D,{mb:0,children:P("userDialog.nextPlanTitle","Next plan")}),e(gt,{colorScheme:"primary",isChecked:Pe,onChange:G=>Ye(G.target.checked),isDisabled:dt})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:P("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(_s,{in:Pe,animateOpacity:!0,style:{width:"100%"},children:n(he,{align:"stretch",spacing:3,mt:3,children:[n(C,{children:[e(D,{fontSize:"sm",children:P("userDialog.nextPlanDataLimit","Next plan data limit")}),e(or,{endAdornment:"GB",type:"text",inputMode:"decimal",size:"sm",borderRadius:"6px",disabled:dt,value:le!==null&&typeof le<"u"?String(le):"",onChange:G=>{const Ie=G.target.value;if(!Ie){A.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Ve=Number(Ie);Number.isNaN(Ve)||A.setValue("next_plan_data_limit",Math.max(0,Ve),{shouldDirty:!0})}})]}),n(C,{children:[e(D,{fontSize:"sm",children:P("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(St,{control:A.control,name:"next_plan_expire",render:({field:G})=>{const Ie=Ve=>{if(!Ve){f(null),G.onChange(null);return}const Qe=Number(Ve);if(Number.isNaN(Qe)||Qe<0)return;const xt=Math.min(Math.round(Qe),3650);f(xt);const Gt=H(xt);G.onChange(Gt)};return e(or,{endAdornment:P("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof ye=="number"?String(ye):"",onChange:Ve=>Ie(Ve.target.value),disabled:dt})}})]}),n(M,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:P("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(gt,{size:"sm",colorScheme:"primary",isChecked:Boolean(Ke),onChange:G=>A.setValue("next_plan_add_remaining_traffic",G.target.checked,{shouldDirty:!0}),isDisabled:dt})]}),n(M,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:P("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(gt,{size:"sm",colorScheme:"primary",isChecked:Boolean(ne),onChange:G=>A.setValue("next_plan_fire_on_either",G.target.checked,{shouldDirty:!0}),isDisabled:dt})]})]})})]}),n(C,{mb:"10px",isInvalid:!!A.formState.errors.note,children:[e(D,{children:P("userDialog.note")}),e(Pr,{...A.register("note")}),e(nn,{children:(Vr=(vr=A.formState.errors)==null?void 0:vr.note)==null?void 0:Vr.message})]})]}),T&&n(Wr,{status:"error",display:{base:"none",md:"flex"},children:[e(Fr,{}),T]})]})}),I&&e(yn,{mt:R?0:4,children:n(C,{isRequired:!m,children:[e(D,{children:P("userDialog.selectServiceLabel","Service")}),xe?n(M,{spacing:2,py:4,children:[e(Rt,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:P("loading")})]}):U?n(he,{align:"stretch",spacing:3,children:[m&&V&&n(z,{role:"button",tabIndex:dt?-1:0,"aria-pressed":ve===null,onKeyDown:G=>{dt||(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),B(null))},onClick:()=>{dt||B(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:ve===null?"primary.500":"gray.200",bg:ve===null?"primary.50":"transparent",cursor:dt?"not-allowed":"pointer",pointerEvents:dt?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:dt?{}:{borderColor:ve===null?"primary.500":"gray.300"},_dark:{borderColor:ve===null?"primary.400":"gray.700",bg:ve===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:P("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:P("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),K.map(G=>{const Ie=ve===G.id;return e(z,{role:"button",tabIndex:dt?-1:0,"aria-pressed":Ie,onKeyDown:Ve=>{dt||(Ve.key==="Enter"||Ve.key===" ")&&(Ve.preventDefault(),B(G.id))},onClick:()=>{dt||B(G.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:Ie?"primary.500":"gray.200",bg:Ie?"primary.50":"transparent",cursor:dt?"not-allowed":"pointer",pointerEvents:dt?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:dt?{}:{borderColor:Ie?"primary.500":"gray.300"},_dark:{borderColor:Ie?"primary.400":"gray.700",bg:Ie?"primary.900":"transparent"},children:n(M,{justify:"space-between",align:"flex-start",children:[n(he,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:G.name}),G.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:G.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:P("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:G.host_count,users:G.user_count})})]})},G.id)})]}):n(Wr,{status:"warning",borderRadius:"md",children:[e(Fr,{}),P("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),j&&e(ur,{mt:2,children:P("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:j.host_count,users:j.user_count})})]})}),m&&N&&e(yn,{pt:6,colSpan:{base:1,md:I?2:1},children:n(he,{gap:4,children:[e(Oh,{defaultValue:at,onChange:(G,Ie)=>{ot(G),yt(Ie)}}),e(z,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(an,{options:ee.options,series:ee.series,type:"donut"})})]})})]}),T&&n(Wr,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(Fr,{}),T]})]}),e(Ut,{mt:"3",children:n(M,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(M,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:m&&n(Bt,{children:[be&&e(mt,{label:P("delete"),placement:"top",children:e(He,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),Jt()},children:e(gi,{})})}),e(mt,{label:P("userDialog.usage"),placement:"top",children:e(He,{"aria-label":"usage",size:"sm",onClick:F,children:e(Hh,{})})}),Ce&&e(O,{onClick:qt,size:"sm",children:P("userDialog.resetUsage")}),Ee&&e(O,{onClick:wt,size:"sm",children:P("userDialog.revokeSubscription")})]})}),e(M,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(O,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:v?e(Rt,{size:"xs"}):void 0,disabled:dt,children:P(m?"userDialog.editUser":"createUser")})})]})})]})}),y&&n(pt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(ss,{color:"primary",children:e(Bh,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:P("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:x&&x>0?P("userDialog.limitReachedBody",{limit:x,active:S!=null?S:x}):P("userDialog.limitReachedContent")})]})]})})]})},Jh=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),qh=t=>{if(!t)return null;const s=new Date(`${t}Z`);return Math.floor(s.getTime()/1e3)},xo=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=qh(t);return!t||r===null?e(z,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-r<=60?e(z,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(z,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Yh=t=>{if(!t)return null;const s=new Date(t+"Z");return Math.floor(s.getTime()/1e3)},vo=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=Yh(t),l=r?s-r:null,a=r?$i(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${a.time} ago`:a.time})},ia=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:a})=>{const{t:i}=qe(),o=$i(t),c=es[s].icon;return n(Bt,{children:[n(Br,{colorScheme:es[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&i(`status.${s}`),a&&`: ${a}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(o.status,{time:o.time})})]})},Gh=ie(Jh),Rs={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},Xh=ie(vl,Rs),Qh=ie(Hi,Rs),wo=ie(hi,Rs),Zh=ie(wl,Rs),jh=ie(yl,Rs),ep=ie(Fn,Rs),tp=ie(Hi,{baseStyle:{width:"15px",height:"15px"}}),rp=ie(hd,{baseStyle:{width:{base:16,md:20},height:{base:16,md:20}}}),np=t=>{for(var s=0;s<va.length;s++){const r=va[s];if(r.value==t)return r.title}return"No"},sp=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:a}=t,i=r===0||r===null;return e(M,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:n(h,{children:[Be(s)," /"," ",i?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Be(r)]})})},ko=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:a,...i}=t,o=r===0||r===null,c=!o&&s/r*100>=100;return n(Bt,{children:[e(pd,{orientation:"horizontal",value:o?100:Math.min(s/r*100,100),colorScheme:c?"red":"primary",...i,children:e(md,{h:"6px",borderRadius:"full",children:e(gd,{borderRadius:"full"})})}),n(M,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[n(h,{children:[Be(s)," /"," ",o?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Be(r)+(l&&l!=="no_reset"?" "+_n("userDialog.resetStrategy"+np(l)):"")]}),n(h,{children:[_n("usersTable.total"),": ",Be(a)]})]})]})},Fs=({sort:t,column:s})=>t.includes(s)?e(tp,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,ip=t=>{var W,A,X,q,ge,H,oe,_,ye;const{filters:s,users:{users:r,total:l},onEditingUser:a,onFilterChange:i,loading:o}=Tt(),{t:c}=qe(),[u,p]=d.exports.useState(void 0),m=Tr({base:!1,md:!0}),{userData:g}=hr(),x=g.role===Xe.Sudo||g.role===Xe.FullAccess,S=Boolean(!x&&g.status===Ln.Disabled),y=x||Boolean((A=(W=g.permissions)==null?void 0:W.users)==null?void 0:A[ct.Create]);x||Boolean((q=(X=g.permissions)==null?void 0:X.users)==null?void 0:q[ct.Delete]),x||Boolean((H=(ge=g.permissions)==null?void 0:ge.users)==null?void 0:H[ct.ResetUsage]),x||Boolean((_=(oe=g.permissions)==null?void 0:oe.users)==null?void 0:_[ct.Revoke]);const v=g.disabled_reason,E=r.length!==l,T=s.limit||10,L=f=>{let ae=s.sort;ae.includes(f)?ae.startsWith("-")?ae="-created_at":ae="-"+f:ae=f,i({sort:ae})},ce=f=>{i({status:f.target.value.length>0?f.target.value:void 0})},P=f=>{p(f===u?void 0:f)};return n(z,{position:"relative",children:[n(z,{id:"users-table",overflowX:{base:"unset",md:"unset"},filter:S?"blur(4px)":void 0,pointerEvents:S?"none":void 0,"aria-hidden":S?!0:void 0,children:[e(kl,{allowMultiple:!0,display:{base:"block",md:"none"},index:u,children:n(ns,{orientation:"vertical",zIndex:"docked",...t,children:[e(fn,{zIndex:"docked",position:"relative",children:n(zt,{children:[e($e,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:L.bind(null,"username"),children:n(M,{children:[e("span",{children:c("users")}),e(Fs,{sort:s.sort,column:"username"})]})}),e($e,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:n(M,{spacing:0,position:"relative",children:[n(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[c("usersTable.status"),s.status?": "+s.status:""]}),n(rt,{value:(ye=s.status)!=null?ye:"",fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Bt,{}),_focusVisible:{border:"0 !important"},onChange:ce,children:[e("option",{value:""}),e("option",{value:"active",children:"active"}),e("option",{value:"on_hold",children:"on_hold"}),e("option",{value:"disabled",children:"disabled"}),e("option",{value:"limited",children:"limited"}),e("option",{value:"expired",children:"expired"})]})]})}),e($e,{minW:"100px",cursor:"pointer",pr:0,onClick:L.bind(null,"used_traffic"),children:n(M,{children:[e("span",{children:c("usersTable.dataUsage")}),e(Fs,{sort:s.sort,column:"used_traffic"})]})}),e($e,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),n(sn,{children:[!m&&(o?Array.from({length:T}).map((f,ae)=>n(d.exports.Fragment,{children:[n(zt,{children:[e(Ue,{borderBottom:0,minW:"100px",pl:4,pr:4,children:e(vi,{noOfLines:1,width:"40%"})}),e(Ue,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(ps,{height:"16px",width:"64px"})}),e(Ue,{borderBottom:0,minW:"100px",pr:0,children:e(ps,{height:"16px",width:"120px"})}),e(Ue,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(ps,{height:"16px",width:"16px"})})]}),e(zt,{className:"collapsible",children:e(Ue,{p:0,colSpan:4,children:e(z,{px:6,py:3,children:e(vi,{noOfLines:3})})})})]},"skeleton-"+ae)):r==null?void 0:r.map((f,ae)=>{var K;return n(d.exports.Fragment,{children:[n(zt,{onClick:P.bind(null,ae),cursor:"pointer",children:[e(Ue,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:n("div",{className:"flex-status",children:[e(xo,{lastOnline:f.online_at}),e(h,{isTruncated:!0,children:f.username})]})}),e(Ue,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(ia,{compact:!0,showDetail:!1,expiryDate:f.expire,status:f.status})}),e(Ue,{borderBottom:0,minW:"100px",pr:0,children:e(sp,{totalUsedTraffic:f.lifetime_used_traffic,dataLimitResetStrategy:f.data_limit_reset_strategy,used:f.used_traffic,total:f.data_limit,colorScheme:es[f.status].bandWidthColor})}),e(Ue,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Qh,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:u===ae?"rotate(180deg)":"0deg"})})]}),e(zt,{className:"collapsible",onClick:P.bind(null,ae),children:e(Ue,{p:0,colSpan:4,children:n(Cl,{border:0,children:[e(_l,{display:"none"}),e(Dl,{border:0,cursor:"pointer",px:6,py:3,children:n(he,{justifyContent:"space-between",spacing:"4",children:[n(he,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.dataUsage")}),e(z,{width:"full",minW:"230px",children:e(ko,{totalUsedTraffic:f.lifetime_used_traffic,dataLimitResetStrategy:f.data_limit_reset_strategy,used:f.used_traffic,total:f.data_limit,colorScheme:es[f.status].bandWidthColor})})]}),n(he,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.service","Service")}),e(h,{fontSize:"sm",color:f.service_name?"gray.700":"gray.500",_dark:{color:f.service_name?"gray.200":"gray.500"},children:(K=f.service_name)!=null?K:c("usersTable.defaultService","Default")})]}),n(M,{w:"full",justifyContent:"space-between",children:[n(z,{width:"full",children:[e(ia,{compact:!0,expiryDate:f.expire,status:f.status}),e(vo,{lastOnline:f.online_at})]}),n(M,{children:[e(Co,{user:f}),y&&e(mt,{label:c("userDialog.editUser"),placement:"top",children:e(He,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:xe=>{xe.stopPropagation(),a(f)},children:e(ep,{})})})]})]})]})})]})})})]},f.username)})),!o&&!m&&r.length===0&&e(zt,{children:e(Ue,{colSpan:4,border:0,children:e(_o,{isFiltered:E,isCreateDisabled:S})})})]})]})}),n(ns,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(fn,{position:"relative",zIndex:"docked",children:n(zt,{children:[e($e,{minW:"140px",cursor:"pointer",onClick:L.bind(null,"username"),children:n(M,{children:[e("span",{children:c("username")}),e(Fs,{sort:s.sort,column:"username"})]})}),e($e,{width:"400px",minW:"150px",cursor:"pointer",children:n(M,{position:"relative",gap:"5px",children:[n(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),s.status?": "+s.status:""]}),e(h,{children:"/"}),e(Fs,{sort:s.sort,column:"expire"}),e(M,{onClick:L.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),n(rt,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Bt,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:ce,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e($e,{minW:"150px",children:e("span",{children:c("usersTable.service","Service")})}),e($e,{width:"350px",minW:"230px",cursor:"pointer",onClick:L.bind(null,"used_traffic"),children:n(M,{children:[e("span",{children:c("usersTable.dataUsage")}),e(Fs,{sort:s.sort,column:"used_traffic"})]})}),e($e,{width:"200px",minW:"180px"})]})}),n(sn,{children:[m&&(o?Array.from({length:T}).map((f,ae)=>n(zt,{children:[e(Ue,{minW:"140px",children:e(vi,{noOfLines:1,width:"40%"})}),e(Ue,{width:"400px",minW:"150px",children:e(ps,{height:"16px",width:"120px"})}),e(Ue,{minW:"150px",children:e(vi,{noOfLines:1,width:"60%"})}),e(Ue,{width:"350px",minW:"230px",children:e(ps,{height:"16px",width:"200px"})}),e(Ue,{width:"200px",minW:"180px",children:e(ps,{height:"16px",width:"64px"})})]},"skeleton-desktop-"+ae)):r==null?void 0:r.map((f,ae)=>{var K;return n(zt,{className:Ea("interactive",{"last-row":ae===r.length-1}),onClick:()=>{y&&a(f)},cursor:y?"pointer":"default",children:[e(Ue,{minW:"140px",children:n("div",{className:"flex-status",children:[e(xo,{lastOnline:f.online_at}),f.username,e(vo,{lastOnline:f.online_at})]})}),e(Ue,{width:"400px",minW:"150px",children:e(ia,{expiryDate:f.expire,status:f.status})}),e(Ue,{minW:"150px",children:e(h,{fontSize:"sm",color:f.service_name?"gray.700":"gray.500",_dark:{color:f.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(K=f.service_name)!=null?K:c("usersTable.defaultService","Default")})}),e(Ue,{width:"350px",minW:"230px",children:e(ko,{totalUsedTraffic:f.lifetime_used_traffic,dataLimitResetStrategy:f.data_limit_reset_strategy,used:f.used_traffic,total:f.data_limit,colorScheme:es[f.status].bandWidthColor})}),e(Ue,{width:"200px",minW:"180px",children:e(Co,{user:f})})]},f.username)})),!o&&r.length==0&&e(zt,{children:e(Ue,{colSpan:5,children:e(_o,{isFiltered:E,isCreateDisabled:S||!y})})})]})]})]}),S&&n(pt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",textAlign:"center",px:6,py:8,bg:"rgba(255, 255, 255, 0.85)",_dark:{bg:"rgba(15, 23, 42, 0.9)"},zIndex:"overlay",children:[e(rp,{color:"red.400",mb:6}),e(h,{fontSize:"xl",fontWeight:"bold",mb:3,children:c("usersTable.adminDisabledTitle","Your account is disabled")}),e(h,{maxW:"480px",color:"gray.600",_dark:{color:"gray.200"},children:v||c("usersTable.adminDisabledDescription","Please contact the sudo admin to regain access.")})]})]})},Co=({user:t})=>{const{setQRCode:s,setSubLink:r}=Tt(),l=t.links.join(`\r
`),i=(u=>u?u.startsWith("/")?window.location.origin+u:u:"")(t.subscription_url),[o,c]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{o[1]&&setTimeout(()=>{c([-1,!1])},1e3)},[o]),n(M,{justifyContent:"flex-end",onClick:u=>{u.preventDefault(),u.stopPropagation()},children:[e(Qa,{text:i,onCopy:()=>{c([0,!0])},children:e("div",{children:e(mt,{label:o[0]==0&&o[1]?_n("usersTable.copied"):_n("usersTable.copyLink"),placement:"top",children:e(He,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==0&&o[1]?e(wo,{}):e(Zh,{})})})})}),e(Qa,{text:l,onCopy:()=>{c([1,!0])},children:e("div",{children:e(mt,{label:o[0]==1&&o[1]?_n("usersTable.copied"):_n("usersTable.copyConfigs"),placement:"top",children:e(He,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:o[0]==1&&o[1]?e(wo,{}):e(Xh,{})})})})}),e(mt,{label:"QR Code",placement:"top",children:e(He,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(t.links),r(i)},children:e(jh,{})})})]})},_o=({isFiltered:t,isCreateDisabled:s})=>{const{onCreateUser:r}=Tt(),l=()=>{s||r(!0)};return n(z,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(Gh,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?_n("usersTable.noUserMatched"):_n("usersTable.noUser")}),!t&&!s&&e(O,{size:"sm",colorScheme:"primary",onClick:l,children:_n("createUser")})]})},ap=()=>{const{t}=qe();return d.exports.useEffect(()=>{Tt.getState().refetchUsers(),ci()},[]),n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(Hl,{}),e(ip,{}),e(Bl,{}),e(Kh,{}),e(dh,{}),e(_h,{}),e(Ah,{}),e(Ph,{})]})},Kt=(t,s,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return s({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Yt=(t,s)=>s({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),op=[{key:ct.Create,label:"admins.permissions.createUser"},{key:ct.Delete,label:"admins.permissions.deleteUser"},{key:ct.ResetUsage,label:"admins.permissions.resetUsage"},{key:ct.Revoke,label:"admins.permissions.revoke"},{key:ct.CreateOnHold,label:"admins.permissions.createOnHold"},{key:ct.AllowUnlimitedData,label:"admins.permissions.unlimitedData"},{key:ct.AllowUnlimitedExpire,label:"admins.permissions.unlimitedExpire"},{key:ct.AllowNextPlan,label:"admins.permissions.nextPlan"}],lp=[{key:ar.View,label:"admins.permissions.viewAdmins"},{key:ar.Edit,label:"admins.permissions.editAdmins"},{key:ar.ManageSudo,label:"admins.permissions.manageSudo"}],cp=[{key:bt.Usage,label:"admins.sections.usage"},{key:bt.Admins,label:"admins.sections.admins"},{key:bt.Services,label:"admins.sections.services"},{key:bt.Hosts,label:"admins.sections.hosts"},{key:bt.Nodes,label:"admins.sections.nodes"},{key:bt.Integrations,label:"admins.sections.integrations"},{key:bt.Xray,label:"admins.sections.xray"}],Vl=({value:t,onChange:s,maxDataLimitValue:r,onMaxDataLimitChange:l,maxDataLimitError:a,showReset:i=!1,onReset:o,hideExtendedSections:c=!1})=>{const{t:u}=qe(),p=(g,x,S)=>{const y={...t[g],[x]:S},v={...t,[g]:y};s(v)},m=g=>{l==null||l(g.target.value)};return n(fe,{spacing:6,children:[n(M,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.userCapabilities","User capabilities")}),i&&o&&e(O,{size:"xs",variant:"ghost",onClick:o,children:u("admins.permissions.resetToDefaults","Reset to defaults")})]}),e(Fe,{columns:{base:1,md:2},spacing:3,children:op.map(({key:g,label:x})=>n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(x)}),e(gt,{isChecked:Boolean(t.users[g]),onChange:S=>p("users",g,S.target.checked)})]},g))}),n(C,{isInvalid:Boolean(a),children:[e(D,{children:u("admins.permissions.maxDataPerUser","Max per user data (GB)")}),e(mt,{label:u("admins.permissions.enableUnlimitedFirst","Enable unlimited data first to set this value."),isDisabled:Boolean(t.users.allow_unlimited_data),hasArrow:!0,openDelay:200,placement:"top",gutter:6,shouldWrapChildren:!0,children:e(De,{type:"number",min:"0",step:"1",placeholder:u("admins.permissions.maxDataHint","Leave empty for unlimited"),value:r,onChange:m,isDisabled:!t.users.allow_unlimited_data})}),a?e(nn,{children:a}):e(ur,{children:t.users.allow_unlimited_data?u("admins.permissions.maxDataDescription","Applies when this admin creates or edits users."):u("admins.permissions.limitDisabledHint","Unlimited data must be allowed before setting a cap.")})]}),!c&&n(fe,{spacing:3,children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.manageAdminsTitle","Admin management")}),e(Fe,{columns:{base:1,md:2},spacing:3,children:lp.map(({key:g,label:x})=>n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(x)}),e(gt,{isChecked:Boolean(t.admin_management[g]),onChange:S=>p("admin_management",g,S.target.checked)})]},g))})]}),!c&&n(fe,{spacing:3,children:[e(h,{fontWeight:"semibold",children:u("admins.permissions.sectionAccess","Section access")}),e(Fe,{columns:{base:1,md:2},spacing:3,children:cp.map(({key:g,label:x})=>n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontSize:"sm",children:u(x)}),e(gt,{isChecked:Boolean(t.sections[g]),onChange:S=>p("sections",g,S.target.checked)})]},g))})]})]})},$l=({isOpen:t,onClose:s,admin:r})=>{var S,y;const{t:l}=qe(),a=er(),i=xn(v=>v.updateAdmin),[o,c]=d.exports.useState((S=r==null?void 0:r.permissions)!=null?S:wi),[u,p]=d.exports.useState(""),[m,g]=d.exports.useState(!1);d.exports.useEffect(()=>{var v;r?(c((v=r.permissions)!=null?v:wi),p(r.permissions.users.max_data_limit_per_user?String(Math.floor(r.permissions.users.max_data_limit_per_user/(1024*1024*1024))):"")):(c(wi),p(""))},[r,t]);const x=async()=>{if(!!r){g(!0);try{await i(r.username,{permissions:o}),Yt(l("admins.permissions.updateSuccess","Permissions updated"),a),s()}catch(v){Kt(v,a)}finally{g(!1)}}};return n(Wt,{isOpen:t,onClose:s,size:"lg",children:[e(_t,{}),n(Ft,{children:[e(It,{children:l("admins.permissions.modalTitle",{defaultValue:"Edit permissions for {{username}}",username:(y=r==null?void 0:r.username)!=null?y:""})}),e(Ht,{}),e(Dt,{children:e(Vl,{value:o,onChange:c,showReset:!0,onReset:()=>c(wi),maxDataLimitValue:u,onMaxDataLimitChange:v=>{p(v);const E=Number(v);c(T=>({...T,users:{...T.users,max_data_limit_per_user:!v||Number.isNaN(E)?null:Math.max(0,E)*1024*1024*1024}}))},hideExtendedSections:(r==null?void 0:r.role)===Xe.Standard})}),n(Ut,{children:[e(O,{variant:"ghost",mr:3,onClick:s,children:l("cancel")}),e(O,{colorScheme:"primary",onClick:x,isLoading:m,isDisabled:!r,children:l("save","Save")})]})]})]})},Qs=1024*1024*1024,dp={[Xe.Standard]:{users:{create:!0,delete:!1,reset_usage:!1,revoke:!1,create_on_hold:!1,allow_unlimited_data:!1,allow_unlimited_expire:!1,allow_next_plan:!1,max_data_limit_per_user:null},admin_management:{can_view:!1,can_edit:!1,can_manage_sudo:!1},sections:{usage:!1,admins:!1,services:!1,hosts:!1,nodes:!1,integrations:!1,xray:!1}},[Xe.Sudo]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!1},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}},[Xe.FullAccess]:{users:{create:!0,delete:!0,reset_usage:!0,revoke:!0,create_on_hold:!0,allow_unlimited_data:!0,allow_unlimited_expire:!0,allow_next_plan:!0,max_data_limit_per_user:null},admin_management:{can_view:!0,can_edit:!0,can_manage_sudo:!0},sections:{usage:!0,admins:!0,services:!0,hosts:!0,nodes:!0,integrations:!0,xray:!0}}},qn=t=>JSON.parse(JSON.stringify(dp[t])),up=t=>t&&t>0?String(Math.floor(t/Qs)):"",hp=ke.object({users:ke.object({create:ke.boolean(),delete:ke.boolean(),reset_usage:ke.boolean(),revoke:ke.boolean(),create_on_hold:ke.boolean(),allow_unlimited_data:ke.boolean(),allow_unlimited_expire:ke.boolean(),allow_next_plan:ke.boolean(),max_data_limit_per_user:ke.number().nullable()}),admin_management:ke.object({can_view:ke.boolean(),can_edit:ke.boolean(),can_manage_sudo:ke.boolean()}),sections:ke.object({usage:ke.boolean(),admins:ke.boolean(),services:ke.boolean(),hosts:ke.boolean(),nodes:ke.boolean(),integrations:ke.boolean(),xray:ke.boolean()})}),pp=()=>{var Ce,Ee,ve,B,U,j,de;const{t}=qe(),{userData:s}=hr(),r=s.role===Xe.FullAccess,l=er(),{admins:a,adminInDialog:i,isAdminDialogOpen:o,closeAdminDialog:c,createAdmin:u,updateAdmin:p}=xn(),m=d.exports.useMemo(()=>{var k;return i?(k=a.find(I=>I.username===i.username))!=null?k:i:null},[i,a]),g=d.exports.useMemo(()=>m?"edit":"create",[m]),x=d.exports.useMemo(()=>ke.object({username:g==="create"?ke.string().trim().min(3,{message:t("admins.validation.usernameMin")}):ke.string().optional(),password:ke.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>!I||I.length>=6,t("admins.validation.passwordMin")),telegram_id:ke.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.telegramNumeric")),role:ke.nativeEnum(Xe).optional(),data_limit:ke.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:ke.string().trim().optional().transform(I=>I===""?void 0:I).refine(I=>I===void 0||/^\d+$/.test(I),t("admins.validation.usersLimitNumeric","Users limit must be a number")),maxDataLimitPerUserGb:ke.string().trim().optional().transform(I=>I===""?void 0:I),permissions:hp}).superRefine((I,R)=>{g==="create"&&!I.password&&R.addIssue({code:ke.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[g,t]),S=jr({resolver:Fi(x),defaultValues:{username:"",password:"",telegram_id:"",role:Xe.Standard,permissions:qn(Xe.Standard),maxDataLimitPerUserGb:"",data_limit:"",users_limit:""}}),{register:y,handleSubmit:v,reset:E,formState:T,setValue:L,watch:ce,setError:P}=S,[W,A]=d.exports.useState(!1),[X,q]=d.exports.useState(!1),ge=d.exports.useCallback(k=>{var $;const I="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",R=I.length;if(typeof window<"u"&&(($=window.crypto)==null?void 0:$.getRandomValues)){const Ae=new Uint32Array(k);return window.crypto.getRandomValues(Ae),Array.from(Ae,Se=>I[Se%R]).join("")}return Array.from({length:k},()=>{const Ae=Math.floor(Math.random()*R);return I[Ae]}).join("")},[]),H=d.exports.useCallback(()=>{if(g==="edit")return;const k=ge(8);L("username",k,{shouldDirty:!0,shouldValidate:!0})},[ge,g,L]),oe=d.exports.useCallback(()=>{const k=ge(12);L("password",k,{shouldDirty:!0,shouldValidate:!0})},[ge,L]),{errors:_,isSubmitting:ye}=T,f=ce("role"),ae=ce("permissions"),K=(Ce=ce("maxDataLimitPerUserGb"))!=null?Ce:"",xe=d.exports.useCallback(()=>{const k=f!=null?f:Xe.Standard;L("permissions",qn(k),{shouldDirty:!0}),L("maxDataLimitPerUserGb","",{shouldDirty:!0})},[L,f]),Re=d.exports.useCallback(k=>{L("permissions",k,{shouldDirty:!0})},[L]),Oe=d.exports.useCallback(k=>{L("maxDataLimitPerUserGb",k,{shouldDirty:!0})},[L]);d.exports.useEffect(()=>{y("maxDataLimitPerUserGb"),y("permissions")},[y]),d.exports.useEffect(()=>{var k,I,R;if(o){const $=(k=m==null?void 0:m.role)!=null?k:Xe.Standard,Ae=m&&(I=JSON.parse(JSON.stringify(m.permissions)))!=null?I:qn($);E({username:(R=m==null?void 0:m.username)!=null?R:"",password:"",telegram_id:(m==null?void 0:m.telegram_id)!==void 0&&(m==null?void 0:m.telegram_id)!==null?String(m.telegram_id):"",role:$,permissions:Ae,maxDataLimitPerUserGb:up(Ae.users.max_data_limit_per_user),data_limit:(m==null?void 0:m.data_limit)!==void 0&&(m==null?void 0:m.data_limit)!==null?String(Math.floor(m.data_limit/Qs)):"",users_limit:(m==null?void 0:m.users_limit)!==void 0&&(m==null?void 0:m.users_limit)!==null?String(m.users_limit):""})}},[m,o,E]),d.exports.useEffect(()=>{o||q(!1)},[o]);const V=v(async k=>{var $,Ae,Se,Je,N;const I=($=k.role)!=null?$:Xe.Standard;let R;if(g==="create"){const Z=JSON.parse(JSON.stringify((Ae=k.permissions)!=null?Ae:qn(I))),F=(Se=k.maxDataLimitPerUserGb)==null?void 0:Se.trim();if(F){const pe=Number(F);if(Number.isNaN(pe)||pe<0){P("maxDataLimitPerUserGb",{type:"manual",message:t("admins.validation.invalidMaxDataLimit","Enter a positive number or leave empty.")});return}Z.users.max_data_limit_per_user=pe===0?null:Math.round(pe*Qs)}else Z.users.max_data_limit_per_user=null;R=Z}if(g==="edit"&&m){const Z=(Je=m.active_users)!=null?Je:0;if(k.users_limit){const F=Number(k.users_limit);if(!Number.isNaN(F)&&F>0&&F<Z){P("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:Z})});return}}}try{if(g==="create"){const Z={username:k.username.trim(),password:(N=k.password)!=null?N:"",role:I,permissions:R!=null?R:qn(I),telegram_id:k.telegram_id?Number(k.telegram_id):void 0,data_limit:k.data_limit?Number(k.data_limit)*Qs:void 0,users_limit:k.users_limit?Number(k.users_limit):void 0};await u(Z),Yt(t("admins.createSuccess","Admin created"),l)}else if(m){const Z={role:I,telegram_id:k.telegram_id?Number(k.telegram_id):void 0,data_limit:k.data_limit?Number(k.data_limit)*Qs:void 0,users_limit:k.users_limit?Number(k.users_limit):void 0};k.password&&(Z.password=k.password),await p(m.username,Z),Yt(t("admins.updateSuccess","Admin updated"),l)}c()}catch(Z){Kt(Z,l,S)}}),be=n(he,{spacing:4,align:"stretch",children:[n(C,{isInvalid:!!_.username,children:[e(D,{children:t("username")}),n(Nr,{children:[e(De,{placeholder:t("admins.usernamePlaceholder","Admin username"),...y("username"),isDisabled:g==="edit"}),g==="create"&&e(Hr,{children:e(He,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(Mi,{width:20}),onClick:H})})]}),e(nn,{children:(Ee=_.username)==null?void 0:Ee.message})]}),n(C,{isInvalid:!!_.password,children:[e(D,{children:t("password")}),n(M,{spacing:2,children:[n(Nr,{children:[e(De,{placeholder:t("admins.passwordPlaceholder","Password"),type:W?"text":"password",...y("password")}),e(Hr,{children:e(He,{"aria-label":W?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:W?e(Ra,{width:16}):e(ii,{width:16}),onClick:()=>A(!W)})})]}),e(He,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(Mi,{width:20}),onClick:oe})]}),e(nn,{children:(ve=_.password)==null?void 0:ve.message}),g==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),n(C,{children:[e(D,{children:t("admins.roleLabel","Admin role")}),e(oi,{value:f!=null?f:Xe.Standard,onChange:k=>L("role",k,{shouldDirty:!0}),children:n(he,{align:"flex-start",spacing:2,children:[n(Or,{value:Xe.Standard,children:[e(h,{fontWeight:"medium",children:t("admins.roles.standard","Standard")}),e(ur,{m:0,children:t("admins.roles.standardDescription","Can manage own users with limited privileges.")})]}),n(Or,{value:Xe.Sudo,children:[e(h,{fontWeight:"medium",children:t("admins.roles.sudo","Sudo")}),e(ur,{m:0,children:t("admins.roles.sudoDescription","Extended access to settings and other admins.")})]}),r&&n(Or,{value:Xe.FullAccess,children:[e(h,{fontWeight:"medium",children:t("admins.roles.fullAccess","Full access")}),e(ur,{m:0,children:t("admins.roles.fullAccessDescription","Complete control, including other sudo admins.")})]})]})})]}),g==="edit"&&e(O,{alignSelf:"flex-start",onClick:()=>q(!0),variant:"outline",children:t("admins.editPermissionsButton","Edit permissions")}),n(C,{isInvalid:!!_.telegram_id,children:[e(D,{children:t("admins.telegramId","Telegram ID")}),e(De,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...y("telegram_id")}),e(nn,{children:(B=_.telegram_id)==null?void 0:B.message})]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{isInvalid:!!_.data_limit,children:[e(D,{children:t("admins.dataLimit","Data Limit (GB)")}),e(De,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...y("data_limit")}),e(nn,{children:(U=_.data_limit)==null?void 0:U.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),n(C,{isInvalid:!!_.users_limit,children:[e(D,{children:t("admins.usersLimit","Users Limit")}),e(De,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...y("users_limit")}),e(nn,{children:(j=_.users_limit)==null?void 0:j.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})]});return n(Bt,{children:[n(Wt,{isOpen:o,onClose:c,size:"lg",children:[e(_t,{}),n(Ft,{children:[e(It,{children:g==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Ht,{}),e(Dt,{children:g==="create"?n(cs,{colorScheme:"primary",isFitted:!0,variant:"enclosed",children:[n(ds,{children:[e(Xt,{children:t("admins.detailsTabLabel","Details")}),e(Xt,{children:t("admins.permissionsTabLabel","Permissions")})]}),n(us,{children:[e(Qt,{px:0,children:be}),e(Qt,{px:0,children:e(Vl,{value:ae!=null?ae:qn(f!=null?f:Xe.Standard),onChange:Re,showReset:!0,onReset:xe,maxDataLimitValue:K,onMaxDataLimitChange:Oe,maxDataLimitError:(de=_.maxDataLimitPerUserGb)==null?void 0:de.message})})]})]}):be}),e(Ut,{children:n(M,{spacing:3,children:[e(O,{variant:"ghost",onClick:c,children:t("cancel")}),e(O,{colorScheme:"primary",onClick:V,isLoading:ye,children:g==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]}),e($l,{isOpen:X,onClose:()=>q(!1),admin:m})]})},mp=()=>{var le,Le,Ke;const{t}=qe(),s=er(),{userData:r}=hr(),l=We("gray.50","whiteAlpha.100"),a=We("primary.50","primary.900"),i=We("surface.light","surface.dark"),o=We("light-border","gray.700"),{admins:c,loading:u,total:p,filters:m,onFilterChange:g,fetchAdmins:x,deleteAdmin:S,resetUsage:y,disableAdmin:v,enableAdmin:E,openAdminDialog:T,openAdminDetails:L,adminInDetails:ce}=xn(),P=d.exports.useRef(null),W=d.exports.useRef(null),{isOpen:A,onOpen:X,onClose:q}=Zt(),{isOpen:ge,onOpen:H,onClose:oe}=Zt(),{isOpen:_,onOpen:ye,onClose:f}=Zt(),[ae,K]=d.exports.useState(null),[xe,Re]=d.exports.useState(null),[Oe,V]=d.exports.useState(""),[be,Ce]=d.exports.useState(null),[Ee,ve]=d.exports.useState(null),B=r.username,U=r.role===Xe.FullAccess,j=(le=r.permissions)==null?void 0:le.admin_management,de=Boolean((j==null?void 0:j[ar.Edit])||U),k=Boolean((j==null?void 0:j[ar.ManageSudo])||U),I=ne=>ne.username===B?!0:ne.role===Xe.FullAccess||!de?!1:ne.role===Xe.Sudo?k:!0,R=ne=>{if(ne==="data_usage"||ne==="data_limit"){const Ye=m.sort===ne?`-${ne}`:ne;g({sort:Ye,offset:0})}else{const Ye=m.sort===ne?`-${ne}`:m.sort===`-${ne}`?void 0:ne;g({sort:Ye,offset:0})}},$=ne=>{K(ne),X()},Ae=async()=>{if(!!ae)try{await S(ae.username),Yt(t("admins.deleteSuccess","Admin removed"),s),q(),K(null)}catch(ne){Kt(ne,s)}},Se=async ne=>{Ce({type:"reset",username:ne.username});try{await y(ne.username),Yt(t("admins.resetUsageSuccess","Usage reset"),s),x()}catch(Ye){Kt(Ye,s)}finally{Ce(null)}},Je=ne=>{Re(ne),V(""),H()},N=()=>{oe(),Re(null),V("")},Z=ne=>{ve(ne),ye()},F=()=>{ve(null),f()},pe=async()=>{if(!xe)return;const ne=Oe.trim();if(!(ne.length<3)){Ce({type:"disableAdmin",username:xe.username});try{await v(xe.username,ne),Yt(t("admins.disableAdminSuccess","Admin disabled"),s),N(),x()}catch(Ye){Kt(Ye,s)}finally{Ce(null)}}},Q=async ne=>{Ce({type:"enableAdmin",username:ne.username});try{await E(ne.username),Yt(t("admins.enableAdminSuccess","Admin re-enabled"),s),x()}catch(Ye){Kt(Ye,s)}finally{Ce(null)}},Pe=({column:ne})=>{var ee,Ne,at,ot,yt;let Ye=!1,te=!1;return ne==="data"?(Ye=((ee=m.sort)==null?void 0:ee.includes("data_usage"))||((Ne=m.sort)==null?void 0:Ne.includes("data_limit")),te=Ye&&((at=m.sort)==null?void 0:at.startsWith("-"))):(Ye=(ot=m.sort)==null?void 0:ot.includes(ne),te=Ye&&((yt=m.sort)==null?void 0:yt.startsWith("-"))),e(Hi,{style:{width:"1rem",height:"1rem",opacity:Ye?1:0,transform:Ye&&!te?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},Te=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return u&&!c.length?e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(Rt,{})}):p?n(Bt,{children:[e(z,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:n(ns,{variant:"simple",size:"sm",minW:"640px",children:[e(fn,{children:e(zt,{children:Te.map(ne=>e($e,{onClick:()=>ne.key==="username"||ne.key==="users_count"||ne.key==="data"?R(ne.key):void 0,cursor:ne.key==="username"||ne.key==="users_count"||ne.key==="data"?"pointer":"default",textAlign:ne.key==="actions"?"right":"left",children:n(M,{justify:ne.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:ne.label}),ne.key==="data"?n(ni,{children:[e(Cs,{as:He,size:"xs",variant:"ghost",icon:e(Pe,{column:"data"})}),n(si,{children:[e(ir,{onClick:()=>R("data_usage"),children:t("admins.sortByUsage")}),e(ir,{onClick:()=>R("data_limit"),children:t("admins.sortByLimit")})]})]}):ne.key==="username"||ne.key==="users_count"?e(Pe,{column:ne.key}):null]})},ne.key))})}),e(sn,{children:c.map(ne=>{var Jt,qt;const Ye=(ce==null?void 0:ce.username)===ne.username,te=ne.users_limit&&ne.users_limit>0?String(ne.users_limit):"\u221E",ee=`${(Jt=ne.active_users)!=null?Jt:0}/${te}`,Ne=I(ne),at=Ne&&ne.username!==B,ot=at&&ne.status!==Ln.Disabled,yt=at&&ne.status===Ln.Disabled,et=at;return n(zt,{onClick:()=>L(ne),cursor:"pointer",bg:Ye?a:void 0,_hover:{bg:l},transition:"background-color 0.15s ease-in-out",children:[n(Ue,{children:[e(h,{fontWeight:"medium",children:ne.username}),ne.role!==Xe.Standard&&e(Br,{colorScheme:ne.role===Xe.FullAccess?"orange":"purple",fontSize:"xs",mt:1,children:ne.role===Xe.FullAccess?t("admins.roles.fullAccess","Full access"):t("admins.roles.sudo","Sudo")}),ne.status===Ln.Disabled&&e(Br,{colorScheme:"red",fontSize:"xs",mt:1,children:t("admins.disabledLabel","Disabled")}),ne.status===Ln.Disabled&&ne.disabled_reason&&e(h,{fontSize:"xs",color:"red.400",mt:1,children:ne.disabled_reason})]}),e(Ue,{children:n(h,{whiteSpace:"nowrap",children:[Be((qt=ne.users_usage)!=null?qt:0,2)," /"," ",ne.data_limit?Be(ne.data_limit,2):"-"]})}),e(Ue,{children:n(fe,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:ee})]})}),e(Ue,{textAlign:"right",children:n(ni,{children:[e(Cs,{as:He,icon:e(hl,{width:20}),variant:"ghost",isDisabled:!Ne&&!at,onClick:wt=>wt.stopPropagation()}),n(si,{onClick:wt=>wt.stopPropagation(),children:[Ne&&n(Bt,{children:[e(ir,{icon:e(Fn,{width:20}),onClick:wt=>{wt.stopPropagation(),T(ne)},children:t("edit")}),e(ir,{icon:e(Al,{width:20}),onClick:wt=>{wt.stopPropagation(),Z(ne)},children:t("admins.editPermissionsButton","Edit permissions")}),e(ir,{icon:e(on,{width:20}),onClick:wt=>{wt.stopPropagation(),Se(ne)},isDisabled:(be==null?void 0:be.username)===ne.username&&(be==null?void 0:be.type)==="reset",children:t("admins.resetUsage")})]}),(ot||yt||et)&&Ne&&e(Ui,{}),ot&&e(ir,{icon:e(fd,{width:20}),onClick:wt=>{wt.stopPropagation(),Je(ne)},isDisabled:(be==null?void 0:be.username)===ne.username&&(be==null?void 0:be.type)==="disableAdmin",children:t("admins.disableAdmin","Disable admin")}),yt&&e(ir,{icon:e(bd,{width:20}),onClick:wt=>{wt.stopPropagation(),Q(ne)},isDisabled:(be==null?void 0:be.username)===ne.username&&(be==null?void 0:be.type)==="enableAdmin",children:t("admins.enableAdmin","Enable admin")}),et&&(ot||yt)&&e(Ui,{}),et&&e(ir,{color:"red.500",icon:e(Sn,{width:20}),onClick:wt=>{wt.stopPropagation(),$(ne)},children:t("delete")})]})]})})]},ne.username)})})]})}),e(Ds,{isOpen:A,leastDestructiveRef:P,onClose:q,children:e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(As,{bg:i,borderWidth:"1px",borderColor:o,children:[e(It,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(Dt,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(Le=ae==null?void 0:ae.username)!=null?Le:""})}),n(Ut,{children:[e(O,{ref:P,onClick:q,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(O,{colorScheme:"red",onClick:Ae,ml:3,children:t("delete")})]})]})})}),e(Ds,{isOpen:ge,leastDestructiveRef:W,onClose:N,children:e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)",children:n(As,{bg:i,borderWidth:"1px",borderColor:o,children:[e(It,{fontSize:"lg",fontWeight:"bold",children:t("admins.disableAdminTitle","Disable admin")}),n(Dt,{children:[e(h,{mb:3,children:t("admins.disableAdminMessage","All users owned by {{username}} will be disabled. Provide a reason for this action.",{username:(Ke=xe==null?void 0:xe.username)!=null?Ke:""})}),e(Pr,{value:Oe,onChange:ne=>V(ne.target.value),placeholder:t("admins.disableAdminReasonPlaceholder","Reason for disabling")})]}),n(Ut,{children:[e(O,{ref:W,onClick:N,variant:"ghost",colorScheme:"primary",children:t("cancel")}),e(O,{colorScheme:"red",onClick:pe,ml:3,isDisabled:Oe.trim().length<3,isLoading:(be==null?void 0:be.type)==="disableAdmin"&&(be==null?void 0:be.username)===(xe==null?void 0:xe.username),children:t("admins.disableAdminConfirm","Disable admin")})]})]})})}),e($l,{isOpen:_,onClose:F,admin:Ee})]}):e(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},gp=(t,s)=>!t||t<=0?s!=null?s:"\u221E":`${t}`,aa=(t,s)=>!t||t<=0?s!=null?s:"\u221E":Be(t,2),fp=()=>{var T,L,ce,P,W,A,X,q,ge,H;const{t}=qe(),{isAdminDetailsOpen:s,adminInDetails:r,closeAdminDetails:l}=xn(oe=>({isAdminDetailsOpen:oe.isAdminDetailsOpen,adminInDetails:oe.adminInDetails,closeAdminDetails:oe.closeAdminDetails})),a=We("gray.50","whiteAlpha.50"),i=(T=r==null?void 0:r.active_users)!=null?T:0,o=(L=r==null?void 0:r.users_limit)!=null?L:null,c=t("admins.details.unlimited","Unlimited"),u=o&&o>0?String(o):c,p=(ce=r==null?void 0:r.users_count)!=null?ce:0,m=(P=r==null?void 0:r.limited_users)!=null?P:0,g=(W=r==null?void 0:r.expired_users)!=null?W:0,x=(A=r==null?void 0:r.online_users)!=null?A:0,S=(X=r==null?void 0:r.users_usage)!=null?X:0,y=(q=r==null?void 0:r.data_limit)!=null?q:null,v=y&&y>0?Math.max(y-S,0):null,E=(ge=r==null?void 0:r.lifetime_usage)!=null?ge:null;return n(Wt,{isCentered:!0,isOpen:s,onClose:l,scrollBehavior:"inside",size:"xl",children:[e(_t,{}),n(Ft,{children:[e(It,{bg:a,children:n(fe,{spacing:1,children:[n(M,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(H=r==null?void 0:r.username)!=null?H:t("admins.details.title","Admin details")}),r&&e(Br,{fontSize:"xs",px:2,py:.5,borderRadius:"full",colorScheme:r.role===Xe.FullAccess?"orange":r.role===Xe.Sudo?"purple":"gray",children:r.role===Xe.FullAccess?t("admins.roles.fullAccess","Full access"):r.role===Xe.Sudo?t("admins.roles.sudo","Sudo"):t("admins.roles.standard","Standard")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:i,limit:u})})]})}),e(Ht,{}),e(Dt,{children:r?n(fe,{spacing:8,children:[n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),n(Fe,{columns:{base:2,md:3},spacing:4,children:[e(gn,{label:t("admins.details.activeLabel","Active"),value:String(i)}),e(gn,{label:t("admins.details.onlineLabel","Online"),value:String(x)}),e(gn,{label:t("admins.details.limitedLabel","Limited"),value:String(m)}),e(gn,{label:t("admins.details.expiredLabel","Expired"),value:String(g)}),e(gn,{label:t("admins.details.totalUsers","Total users"),value:String(p)}),e(gn,{label:t("admins.details.usersLimit","Users limit"),value:gp(o,c)})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),n(Fe,{columns:{base:2,md:4},spacing:4,children:[e(gn,{label:t("admins.details.used","Used"),value:Be(S,2)}),e(gn,{label:t("admins.details.limit","Limit"),value:aa(y,c)}),e(gn,{label:t("admins.details.remaining","Remaining"),value:aa(v,c)}),e(gn,{label:t("admins.details.lifetime","Lifetime usage"),value:aa(E,void 0)})]})]})]}):e(z,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(Ut,{children:e(O,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},gn=({label:t,value:s})=>n(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:s})]}),bp=()=>{var i;const{t}=qe(),s=xn(o=>o.fetchAdmins),{userData:r,getUserIsSuccess:l}=hr(),a=l&&Boolean((i=r.permissions)==null?void 0:i.sections.admins);return d.exports.useEffect(()=>{a&&s()},[s,a]),a?n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(Hl,{for:"admins"}),e(mp,{}),e(Bl,{for:"admins"}),e(pp,{}),e(fp,{})]}):n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},Kl=zs(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),ze("/hosts").then(s=>t({hosts:s})).finally(()=>t({isLoading:!1}))},setHosts:s=>(t({isPostLoading:!0}),ze("/hosts",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})}))})),yp=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],Sp=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],xp=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],vp=ie(Fn,{baseStyle:{w:4,h:4}}),Jl=ie(Pn,{baseStyle:{w:4,h:4}}),ql=ie(ul,{baseStyle:{w:4,h:4}}),wp=ie(pi,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),kp=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],ks=()=>{const{t}=qe();return n(Hn,{isLazy:!0,placement:"right",children:[e(Bn,{children:e(z,{mt:"-1",children:e(wp,{})})}),e(Wi,{children:n(Vn,{maxW:"xs",fontSize:"xs",children:[e(ls,{}),e(Ua,{}),e($n,{children:n(z,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),kp.map(({token:s,labelKey:r})=>n(h,{mt:1,children:[e(Br,{mr:2,children:s}),t(r)]},s))]})})]})})]})},Yl=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Xr=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,bn=t=>(t!=null?t:"").trim(),Hs=(t,s=!1)=>typeof t=="boolean"?t:s,Cp=(t,s)=>{var r,l,a,i,o,c,u,p;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(a=t.address)!=null?a:"",sort:(i=t.sort)!=null?i:s,port:(o=t.port)!=null?o:null,path:bn(t.path),sni:bn(t.sni),host:bn(t.host),mux_enable:Hs(t.mux_enable),allowinsecure:Hs(t.allowinsecure),is_disabled:Hs(t.is_disabled,!1),fragment_setting:bn(t.fragment_setting),noise_setting:bn(t.noise_setting),random_user_agent:Hs(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:Hs(t.use_sni_as_host)}},wa=t=>{var s,r;return{id:(s=t.id)!=null?s:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},Do=t=>{var s,r;return{...t,id:(s=t.id)!=null?s:null,port:(r=t.port)!=null?r:null,path:bn(t.path),sni:bn(t.sni),host:bn(t.host),fragment_setting:bn(t.fragment_setting),noise_setting:bn(t.noise_setting)}},Gl=t=>{const s=Do(t.data),r=Do(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(s)!==JSON.stringify(r)},_p=t=>{var s;return{id:(s=t.id)!=null?s:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},Zs=t=>[...t].sort((s,r)=>{const l=Xr(s.data.sort)-Xr(r.data.sort);return l!==0?l:s.data.remark.localeCompare(r.data.remark)}),Dp=t=>{const s=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((a,i)=>{const o=Cp(a,i),c=o.id!=null?`host-${o.id}`:Yl();s.push({uid:c,inboundTag:r,initialInboundTag:r,data:wa(o),original:wa(o)})})}),Zs(s)},Xl=t=>{const s=new Map;t.forEach(l=>{var i;const a=(i=s.get(l.inboundTag))!=null?i:[];a.push(l.data),s.set(l.inboundTag,a)});const r={};return s.forEach((l,a)=>{r[a]=l.map(i=>_p(i)).sort((i,o)=>Xr(i.sort)-Xr(o.sort))}),r},oa=(t,s)=>{const r=Xl(t),l=Array.from(new Set(s)),a={};return l.forEach(i=>{var o;a[i]=(o=r[i])!=null?o:[]}),a},Ap=({host:t,inboundOptions:s,orderIndex:r,onToggleActive:l,onEdit:a,onDelete:i,saving:o,deleting:c})=>{const{t:u}=qe(),p=s.find(S=>S.value===t.inboundTag),m=!t.data.is_disabled,g=Gl(t),x=t.data.remark||u("hostsPage.untitledHost");return e(zr,{borderWidth:"1px",borderColor:g?"primary.400":"gray.200",_dark:{borderColor:g?"primary.300":"gray.700",bg:g?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>a(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:n(An,{as:fe,spacing:4,children:[n(M,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(he,{align:"flex-start",spacing:1,flex:"1",children:[e(mt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:x})}),n(M,{spacing:2,flexWrap:"wrap",children:[e(lt,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),p&&e(lt,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(lt,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),g&&e(lt,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),n(M,{spacing:2,children:[e(gt,{size:"sm",colorScheme:"primary",isChecked:m,onChange:S=>{S.stopPropagation(),l(t.uid,S.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(m?"hostsPage.enabled":"hostsPage.disabled")})]})]}),n(he,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),n(M,{justify:"space-between",children:[e(O,{size:"sm",variant:"outline",leftIcon:e(vp,{}),onClick:S=>{S.stopPropagation(),a(t.uid)},isLoading:o,children:u("hostsPage.edit")}),e(He,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:S=>{S.stopPropagation(),i(t.uid)},icon:e(gi,{}),isLoading:c})]})]})})},Ip=({host:t,index:s})=>{const{t:r}=qe(),l=yd(),a=t.data.remark||r("hostsPage.untitledHost"),i=d.exports.useCallback(o=>{o.pointerType==="mouse"&&o.button!==0||(o.preventDefault(),l.start(o))},[l]);return e(Il.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:n(M,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(mt,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(He,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(ql,{}),cursor:"grab",onPointerDown:i,style:{touchAction:"none"}})}),e(lt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:s+1})}),n(he,{align:"flex-start",spacing:0,flex:"1",children:[e(mt,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:a})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Pp=({host:t,inboundOptions:s,isOpen:r,onClose:l,onChange:a,onChangeInbound:i,onSave:o,onReset:c,onDelete:u,saving:p,deleting:m})=>{var y;const{t:g}=qe();if(!t)return null;const x=s.find(v=>v.value===t.inboundTag),S=Gl(t);return n(Wt,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,returnFocusOnClose:!1,children:[e(_t,{}),n(Ft,{children:[e(Ht,{}),e(It,{pb:1,children:n(he,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||g("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||g("hostsPage.noAddress")}),x&&e(lt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${x.value} (${x.protocol.toUpperCase()} - ${x.network})`})]})}),e(Dt,{children:n(he,{align:"stretch",spacing:5,children:[n(zr,{variant:"outline",children:[e(ws,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.general")})}),e(An,{pt:0,children:n(he,{align:"stretch",spacing:4,children:[n(C,{children:[e(D,{children:g("hostsDialog.remark")}),n(Nr,{children:[e(De,{value:t.data.remark,onChange:v=>a(t.uid,"remark",v.target.value)}),e(Hr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ks,{})})]})]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:g("hostsPage.inboundLabel")}),e(rt,{value:t.inboundTag,onChange:v=>i(t.uid,v.target.value),children:s.map(v=>e("option",{value:v.value,children:v.label},v.value))})]}),n(C,{children:[e(D,{children:g("hostsDialog.sort")}),e(rs,{value:t.data.sort,allowMouseWheel:!0,onChange:(v,E)=>a(t.uid,"sort",Number.isNaN(E)?t.data.sort:E),children:e(ts,{})})]})]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:g("hostsDialog.address")}),n(Nr,{children:[e(De,{value:t.data.address,onChange:v=>a(t.uid,"address",v.target.value)}),e(Hr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ks,{})})]})]}),n(C,{children:[e(D,{children:g("hostsDialog.port")}),e(rs,{value:(y=t.data.port)!=null?y:"",allowMouseWheel:!0,onChange:(v,E)=>a(t.uid,"port",Number.isNaN(E)?null:E),children:e(ts,{})})]})]}),n(C,{children:[e(D,{children:g("hostsDialog.path")}),e(De,{value:t.data.path,onChange:v=>a(t.uid,"path",v.target.value),placeholder:"/"})]})]})})]}),n(zr,{variant:"outline",children:[e(ws,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.security")})}),e(An,{pt:0,children:n(he,{align:"stretch",spacing:4,children:[n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:g("hostsDialog.sni")}),e(De,{value:t.data.sni,onChange:v=>a(t.uid,"sni",v.target.value)})]}),n(C,{children:[e(D,{children:g("hostsDialog.host")}),n(Nr,{children:[e(De,{value:t.data.host,onChange:v=>a(t.uid,"host",v.target.value)}),e(Hr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ks,{})})]})]})]}),n(Fe,{columns:{base:1,md:3},spacing:4,children:[n(C,{children:[e(D,{children:g("hostsDialog.security")}),e(rt,{value:t.data.security,onChange:v=>a(t.uid,"security",v.target.value),children:yp.map(v=>e("option",{value:v.value,children:v.title},v.value))})]}),n(C,{children:[e(D,{children:g("hostsDialog.alpn")}),e(rt,{value:t.data.alpn,onChange:v=>a(t.uid,"alpn",v.target.value),children:Sp.map(v=>e("option",{value:v.value,children:v.title},v.value))})]}),n(C,{children:[e(D,{children:g("hostsDialog.fingerprint")}),e(rt,{value:t.data.fingerprint,onChange:v=>a(t.uid,"fingerprint",v.target.value),children:xp.map(v=>e("option",{value:v.value,children:v.title},v.value))})]})]})]})})]}),n(zr,{variant:"outline",children:[e(ws,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.advanced")})}),e(An,{pt:0,children:n(he,{align:"stretch",spacing:4,children:[n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:g("hostsDialog.fragment")}),e(De,{value:t.data.fragment_setting,onChange:v=>a(t.uid,"fragment_setting",v.target.value)})]}),n(C,{children:[e(D,{children:g("hostsDialog.noise")}),e(De,{value:t.data.noise_setting,onChange:v=>a(t.uid,"noise_setting",v.target.value)})]})]}),n(fe,{direction:{base:"column",md:"row"},spacing:4,children:[e(Er,{isChecked:t.data.allowinsecure,onChange:v=>a(t.uid,"allowinsecure",v.target.checked),children:g("hostsDialog.allowinsecure")}),e(Er,{isChecked:t.data.mux_enable,onChange:v=>a(t.uid,"mux_enable",v.target.checked),children:g("hostsDialog.muxEnable")}),e(Er,{isChecked:t.data.random_user_agent,onChange:v=>a(t.uid,"random_user_agent",v.target.checked),children:g("hostsDialog.randomUserAgent")}),e(Er,{isChecked:t.data.use_sni_as_host,onChange:v=>a(t.uid,"use_sni_as_host",v.target.checked),children:g("hostsDialog.useSniAsHost")})]})]})})]})]})}),n(Ut,{justifyContent:"space-between",children:[e(O,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(gi,{}),onClick:()=>u(t.uid),isLoading:m,children:g("hostsPage.delete")}),n(M,{spacing:3,children:[e(O,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!S||p,children:g("hostsPage.reset")}),e(O,{size:"sm",colorScheme:"primary",onClick:()=>o(t.uid),isDisabled:!S,isLoading:p,children:g("hostsPage.save")})]})]})]})]})},Tp=({isOpen:t,onClose:s,inboundOptions:r,onSubmit:l,isSubmitting:a,defaultSort:i})=>{var g,x,S,y;const{t:o}=qe(),c=d.exports.useRef(null),[u,p]=d.exports.useState({inboundTag:(x=(g=r[0])==null?void 0:g.value)!=null?x:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var v,E;t&&(p({inboundTag:(E=(v=r[0])==null?void 0:v.value)!=null?E:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var T;return(T=c.current)==null?void 0:T.focus()},150))},[i,r,t]);const m=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return n(Wt,{isOpen:t,onClose:s,size:"lg",initialFocusRef:c,returnFocusOnClose:!1,children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ft,{children:[e(It,{children:n(M,{spacing:3,children:[e(Jl,{}),e(h,{fontWeight:"semibold",children:o("hostsPage.create.title")})]})}),e(Ht,{mt:2}),n(Dt,{as:he,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:o("hostsPage.create.description")}),n(C,{children:[e(D,{children:o("hostsPage.inboundLabel")}),e(rt,{value:u.inboundTag,onChange:v=>p(E=>({...E,inboundTag:v.target.value})),children:r.map(v=>e("option",{value:v.value,children:v.label},v.value))})]}),n(C,{isRequired:!0,children:[e(D,{children:o("hostsDialog.remark")}),n(Nr,{children:[e(De,{ref:c,value:u.remark,onChange:v=>p(E=>({...E,remark:v.target.value}))}),e(Hr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ks,{})})]})]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{isRequired:!0,children:[e(D,{children:o("hostsDialog.address")}),n(Nr,{children:[e(De,{value:u.address,onChange:v=>p(E=>({...E,address:v.target.value}))}),e(Hr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ks,{})})]})]}),n(C,{children:[e(D,{children:o("hostsDialog.port")}),e(rs,{value:(S=u.port)!=null?S:"",onChange:(v,E)=>p(T=>({...T,port:Number.isNaN(E)?null:E})),children:e(ts,{})})]})]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("hostsDialog.path")}),e(De,{value:u.path,onChange:v=>p(E=>({...E,path:v.target.value}))})]}),n(C,{children:[e(D,{children:o("hostsDialog.sni")}),e(De,{value:u.sni,onChange:v=>p(E=>({...E,sni:v.target.value}))})]})]}),n(C,{children:[e(D,{children:o("hostsDialog.host")}),n(Nr,{children:[e(De,{value:u.host,onChange:v=>p(E=>({...E,host:v.target.value}))}),e(Hr,{width:"auto",pr:2,pointerEvents:"auto",children:e(ks,{})})]})]}),n(C,{children:[e(D,{children:o("hostsDialog.sort")}),e(rs,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(v,E)=>p(T=>({...T,sort:Number.isNaN(E)?T.sort:E})),children:e(ts,{})})]}),e(z,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:o("hostsPage.create.sortHint",{value:(y=u.sort)!=null?y:i})})]}),n(Ut,{gap:2,children:[e(O,{variant:"ghost",onClick:s,children:o("hostsPage.cancel")}),e(O,{colorScheme:"primary",onClick:m,isLoading:a,children:o("hostsPage.create.submit")})]})]})]})},Ep=()=>{var pe;const{t}=qe(),s=er(),{hosts:r,fetchHosts:l,isLoading:a,isPostLoading:i,setHosts:o}=Kl(),{inbounds:c}=Tt(),[u,p]=d.exports.useState([]),m=d.exports.useRef([]),g=d.exports.useCallback(Q=>{typeof Q=="function"?p(Pe=>{const Te=Q(Pe);return m.current=Te,Te}):(m.current=Q,p(Q))},[]),[x,S]=d.exports.useState(null),[y,v]=d.exports.useState(!1),[E,T]=d.exports.useState(!1),[L,ce]=d.exports.useState(null),[P,W]=d.exports.useState(null),[A,X]=d.exports.useState(null),q=d.exports.useRef(null),[ge,H]=d.exports.useState(!1),oe=d.exports.useRef(!1),[_,ye]=d.exports.useState(!1),[f,ae]=d.exports.useState(!1),[K,xe]=d.exports.useState(null);d.exports.useEffect(()=>{l()},[l]),d.exports.useEffect(()=>{c.size||ci()},[c]),d.exports.useEffect(()=>{const Q=Dp(r);g(Q)},[r,g]),d.exports.useEffect(()=>{x&&!m.current.some(Q=>Q.uid===x)&&S(null)},[u,x]);const Re=d.exports.useCallback(Q=>{oe.current=Q,H(Q)},[]);d.exports.useEffect(()=>{f||(xe(null),Re(!1))},[y,f,Re]),d.exports.useEffect(()=>{if(!f||!K)return;const Q=new Set(m.current.map(Te=>Te.uid));K.every(Te=>Q.has(Te.uid))||(xe(null),Re(!1))},[u,f,Re,K]);const Oe=d.exports.useMemo(()=>{const Q=[];return c.forEach(Pe=>{Pe.forEach(Te=>{Q.push({label:`${Te.tag} (${Te.protocol.toUpperCase()} - ${Te.network})`,value:Te.tag,protocol:Te.protocol,network:Te.network})})}),Q.sort((Pe,Te)=>Pe.label.localeCompare(Te.label))},[c]),V=d.exports.useMemo(()=>m.current.filter(Q=>!Q.data.is_disabled).sort((Q,Pe)=>Xr(Q.data.sort)-Xr(Pe.data.sort)),[u]),be=d.exports.useMemo(()=>[...m.current].sort((Q,Pe)=>Xr(Q.data.sort)-Xr(Pe.data.sort)),[u]),Ce=d.exports.useMemo(()=>y?be:V,[V,be,y]);d.exports.useEffect(()=>{f&&xe(Q=>Q!=null?Q:[...V])},[V,f]);const Ee=f?K!=null?K:V:Ce,ve=d.exports.useMemo(()=>{const Q=new Map;return Ee.forEach((Pe,Te)=>Q.set(Pe.uid,Te)),Q},[Ee]),B=x&&(pe=m.current.find(Q=>Q.uid===x))!=null?pe:null,U=(Q,Pe,Te)=>{g(le=>Zs(le.map(Le=>Le.uid===Q?{...Le,data:{...Le.data,[Pe]:Te}}:Le)))},j=(Q,Pe)=>{g(Te=>Zs(Te.map(le=>le.uid===Q?{...le,inboundTag:Pe}:le)))},de=d.exports.useCallback(async()=>{if(!f||_)return!1;const Q=V,Pe=K!=null?K:Q;if(!(Pe.length!==Q.length||Pe.some((ee,Ne)=>{var at;return ee.uid!==((at=Q[Ne])==null?void 0:at.uid)}))||!K||Pe.length===0)return ae(!1),xe(null),Re(!1),!0;const le=Pe.map(ee=>ee.uid),Le=new Map;le.forEach((ee,Ne)=>Le.set(ee,Ne));const Ke=m.current,ne=m.current.filter(ee=>Le.has(ee.uid)).sort((ee,Ne)=>{var at,ot;return((at=Le.get(ee.uid))!=null?at:Number.MAX_SAFE_INTEGER)-((ot=Le.get(Ne.uid))!=null?ot:Number.MAX_SAFE_INTEGER)}),Ye=m.current.filter(ee=>!Le.has(ee.uid)).sort((ee,Ne)=>Xr(ee.data.sort)-Xr(Ne.data.sort)),te=[...ne,...Ye].map((ee,Ne)=>({...ee,data:{...ee.data,sort:Ne},original:{...ee.original,sort:Ne}}));g(te),xe(te.filter(ee=>!ee.data.is_disabled)),ye(!0);try{const ee=Xl(te);return await o(ee),await l(),Re(!1),ae(!1),xe(null),s({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{g(Ke);const Ne=Ke.filter(at=>!at.data.is_disabled).sort((at,ot)=>Xr(at.data.sort)-Xr(ot.data.sort));return xe(Ne),Re(!0),s({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{ye(!1)}},[g,V,l,f,_,o,Re,t,s,K]),k=d.exports.useCallback(Q=>{if(!f||!Q.length)return;const Pe=K!=null?K:V;!(Q.length!==Pe.length||Q.some((le,Le)=>{var Ke;return le.uid!==((Ke=Pe[Le])==null?void 0:Ke.uid)}))||(xe(Q),oe.current||Re(!0))},[V,f,Re,K]),I=d.exports.useCallback(()=>{xe([...V]),Re(!1),ae(!0)},[V,Re]),R=d.exports.useCallback(()=>{ae(!1),xe(null),Re(!1)},[Re]),$=d.exports.useCallback(()=>{de()},[de]),Ae=async Q=>{const Pe=m.current.find(Te=>Te.uid===Q);if(!!Pe){ce(Q);try{const Te=oa(m.current,[Pe.inboundTag,Pe.initialInboundTag]);await o(Te),await l(),s({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"}),S(null)}catch{s({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{ce(null)}}},Se=Q=>{g(Pe=>Zs(Pe.map(Te=>Te.uid===Q?{...Te,inboundTag:Te.initialInboundTag,data:wa(Te.original)}:Te)))},Je=(Q,Pe)=>{U(Q,"is_disabled",!Pe),Pe||v(!0)},N=Q=>{X(Q)},Z=async()=>{if(!A)return;const Q=m.current.find(Pe=>Pe.uid===A);if(!!Q){W(A);try{const Pe=m.current.filter(le=>le.uid!==A);g(Pe);const Te=oa(Pe,[Q.inboundTag,Q.initialInboundTag]);await o(Te),await l(),s({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),x===A&&S(null)}catch{s({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{W(null),X(null)}}},F=async Q=>{const Pe=m.current.length?Math.max(...m.current.map(Te=>Te.data.sort))+1:0;ce("create");try{const Te={uid:Yl(),inboundTag:Q.inboundTag,initialInboundTag:Q.inboundTag,data:{id:null,remark:Q.remark,address:Q.address,sort:Number.isFinite(Q.sort)?Q.sort:Pe,port:Q.port,path:Q.path,sni:Q.sni,host:Q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:Q.remark,address:Q.address,sort:Number.isFinite(Q.sort)?Q.sort:Pe,port:Q.port,path:Q.path,sni:Q.sni,host:Q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},le=Zs([...m.current,Te]);g(le);const Le=oa(le,[Q.inboundTag]);await o(Le),await l(),s({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),T(!1)}catch{s({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{ce(null)}};return n(he,{align:"stretch",spacing:4,children:[f?n(he,{align:"stretch",spacing:2,children:[n(M,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),n(M,{spacing:2,children:[e(O,{variant:"ghost",onClick:R,isDisabled:_,children:t("hostsPage.cancel")}),e(O,{colorScheme:"primary",onClick:$,isLoading:_,isDisabled:!ge&&!_,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),_?n(M,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(Rt,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):ge?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):n(M,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(M,{spacing:3,children:[e(O,{colorScheme:"primary",size:"sm",onClick:()=>T(!0),leftIcon:e(Jl,{}),isDisabled:!Oe.length,children:t("hostsPage.addHost")}),e(gt,{isChecked:y,onChange:Q=>v(Q.target.checked),children:t("hostsPage.showDisabled")})]}),e(O,{size:"sm",variant:"outline",leftIcon:e(ql,{}),onClick:I,isDisabled:a||!V.length,children:t("hostsPage.enterSort")})]}),a?e(M,{justify:"center",py:10,children:e(Rt,{})}):Ee.length===0?e(z,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t("hostsPage.emptyState")})}):f?e(Il.Group,{axis:"y",values:Ee,onReorder:k,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:Ee.map((Q,Pe)=>e(Ip,{host:Q,index:Pe},Q.uid))}):e(Fe,{columns:{base:1,md:2,xl:3},spacing:4,children:Ce.map((Q,Pe)=>{var Te;return e(Ap,{host:Q,inboundOptions:Oe,orderIndex:(Te=ve.get(Q.uid))!=null?Te:Pe,onToggleActive:Je,onEdit:S,onDelete:N,saving:L===Q.uid&&i,deleting:P===Q.uid&&i},Q.uid)})}),e(Tp,{isOpen:E,onClose:()=>T(!1),inboundOptions:Oe,onSubmit:F,isSubmitting:L==="create"&&i,defaultSort:m.current.length?Math.max(...m.current.map(Q=>Q.data.sort))+1:0}),e(Pp,{host:B,inboundOptions:Oe,isOpen:Boolean(B),onClose:()=>S(null),onChange:U,onChangeInbound:j,onSave:Ae,onReset:Se,onDelete:N,saving:!!B&&L===B.uid&&i,deleting:!!B&&P===B.uid&&i}),e(Ds,{isOpen:Boolean(A),leastDestructiveRef:q,onClose:()=>X(null),children:e(_t,{children:n(As,{children:[e(It,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(Dt,{children:t("hostsPage.deleteConfirmation")}),n(Ut,{children:[e(O,{ref:q,onClick:()=>X(null),children:t("hostsPage.cancel")}),e(O,{colorScheme:"red",onClick:Z,ml:3,isLoading:Boolean(P),children:t("hostsPage.delete")})]})]})})})]})},Np=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),Ao=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(Np(t))}catch{}return""},zp=t=>{if(typeof t!="string"||t.length===0)return"";const s=globalThis.Wireguard;if(s!=null&&s.generateKeypair)try{const r=s.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class Ur{static isEmpty(s){return s==null?!0:typeof s=="string"?s.trim().length===0:Array.isArray(s)?s.length===0:typeof s=="object"?Object.keys(s).length===0:!1}static isArrEmpty(s){return!Array.isArray(s)||s.length===0}}const me=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),Ql=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const Rp=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),Mp=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const Up=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const la=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class Pt{static toJsonArray(s){return s.map(r=>r.toJson())}static fromJson(s){return new Pt}toJson(){return{}}toString(s=!0){const r=this.toJson();return s?JSON.stringify(r,null,2):JSON.stringify(r)}}class In extends Pt{constructor(r="none",l="",a=""){super();J(this,"type");J(this,"host");J(this,"path");this.type=r,this.host=l,this.path=a}static fromJson(r={}){var a,i,o,c,u,p,m,g,x,S;const l=r==null?void 0:r.header;if(!l)return new In;if(l.type==="http"&&l.request){const y=((i=(a=l.request)==null?void 0:a.headers)==null?void 0:i.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(c=(o=l.request)==null?void 0:o.headers)==null?void 0:c.Host)!=null?u:"",v=((p=l.request)==null?void 0:p.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(g=(m=l.request)==null?void 0:m.path)!=null?g:"";return new In((x=l.type)!=null?x:"http",y,v)}return new In((S=l.type)!=null?S:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:Ur.isEmpty(this.host)?[]:this.host.split(",")},path:Ur.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class Ps extends Pt{constructor(r=1350,l=50,a=5,i=20,o=!1,c=2,u=2,p="none",m=""){super();J(this,"mtu");J(this,"tti");J(this,"upCap");J(this,"downCap");J(this,"congestion");J(this,"readBuffer");J(this,"writeBuffer");J(this,"type");J(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=a!=null?a:5,this.downCap=i!=null?i:20,this.congestion=Boolean(o),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=p!=null?p:"none",this.seed=m!=null?m:""}static fromJson(r={}){var l,a,i;return new Ps(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(a=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?a:"none",(i=r==null?void 0:r.seed)!=null?i:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class is extends Pt{constructor(r="/",l="",a=0){super();J(this,"path");J(this,"host");J(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=a!=null?a:0}static fromJson(r={}){var l,a,i;return new is((l=r==null?void 0:r.path)!=null?l:"/",(a=r==null?void 0:r.host)!=null?a:"",(i=r==null?void 0:r.heartbeatPeriod)!=null?i:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class as extends Pt{constructor(r="",l="",a=!1){super();J(this,"serviceName");J(this,"authority");J(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(a)}static fromJson(r={}){var l,a;return new as((l=r==null?void 0:r.serviceName)!=null?l:"",(a=r==null?void 0:r.authority)!=null?a:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class Ts extends Pt{constructor(r="/",l=""){super();J(this,"path");J(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,a;return new Ts((l=r==null?void 0:r.path)!=null?l:"/",(a=r==null?void 0:r.host)!=null?a:"")}toJson(){return{path:this.path,host:this.host}}}class Es extends Pt{constructor(r="/",l="",a="",i=!1,o="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,p,m,g,x,S;super();J(this,"path");J(this,"host");J(this,"mode");J(this,"noGRPCHeader");J(this,"scMinPostsIntervalMs");J(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=a!=null?a:"",this.noGRPCHeader=Boolean(i),this.scMinPostsIntervalMs=o!=null?o:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(m=c==null?void 0:c.cMaxReuseTimes)!=null?m:0,hMaxRequestTimes:(g=c==null?void 0:c.hMaxRequestTimes)!=null?g:"600-900",hMaxReusableSecs:(x=c==null?void 0:c.hMaxReusableSecs)!=null?x:"1800-3000",hKeepAlivePeriod:(S=c==null?void 0:c.hKeepAlivePeriod)!=null?S:0}}static fromJson(r={}){var l,a,i,o;return new Es((l=r==null?void 0:r.path)!=null?l:"/",(a=r==null?void 0:r.host)!=null?a:"",(i=r==null?void 0:r.mode)!=null?i:"",Boolean(r==null?void 0:r.noGRPCHeader),(o=r==null?void 0:r.scMinPostsIntervalMs)!=null?o:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class os extends Pt{constructor(r="",l=[],a="",i=!1,o=""){super();J(this,"serverName");J(this,"alpn");J(this,"fingerprint");J(this,"allowInsecure");J(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=a!=null?a:"",this.allowInsecure=Boolean(i),this.echConfigList=o!=null?o:""}static fromJson(r={}){var l,a,i;return new os((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(a=r==null?void 0:r.fingerprint)!=null?a:"",Boolean(r==null?void 0:r.allowInsecure),(i=r==null?void 0:r.echConfigList)!=null?i:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class Ns extends Pt{constructor(r="",l="",a="",i="",o="",c=""){super();J(this,"publicKey");J(this,"fingerprint");J(this,"serverName");J(this,"shortId");J(this,"spiderX");J(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=a!=null?a:"",this.shortId=i!=null?i:"",this.spiderX=o!=null?o:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var l,a,i,o,c,u;return new Ns((l=r==null?void 0:r.publicKey)!=null?l:"",(a=r==null?void 0:r.fingerprint)!=null?a:"",(i=r==null?void 0:r.serverName)!=null?i:"",(o=r==null?void 0:r.shortId)!=null?o:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class di extends Pt{constructor(r="",l=!1,a=0,i=!1,o=!1,c=la.NONE){super();J(this,"dialerProxy");J(this,"tcpFastOpen");J(this,"tcpKeepAliveInterval");J(this,"tcpMptcp");J(this,"penetrate");J(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=a!=null?a:0,this.tcpMptcp=Boolean(i),this.penetrate=Boolean(o),this.addressPortStrategy=c!=null?c:la.NONE}static fromJson(r={}){var l,a,i;return!r||Object.keys(r).length===0?new di:new di((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(a=r==null?void 0:r.tcpKeepAliveInterval)!=null?a:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(i=r==null?void 0:r.addressPortStrategy)!=null?i:la.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class Un extends Pt{constructor(r="tcp",l="none",a=new os,i=new Ns,o=new In,c=new Ps,u=new is,p=new as,m=new Ts,g=new Es,x){super();J(this,"network");J(this,"security");J(this,"tls");J(this,"reality");J(this,"tcp");J(this,"kcp");J(this,"ws");J(this,"grpc");J(this,"httpupgrade");J(this,"xhttp");J(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=a,this.reality=i,this.tcp=o,this.kcp=c,this.ws=u,this.grpc=p,this.httpupgrade=m,this.xhttp=g,this.sockopt=x}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new di:void 0}static fromJson(r={}){var l,a;return new Un((l=r==null?void 0:r.network)!=null?l:"tcp",(a=r==null?void 0:r.security)!=null?a:"none",os.fromJson(r==null?void 0:r.tlsSettings),Ns.fromJson(r==null?void 0:r.realitySettings),In.fromJson(r==null?void 0:r.tcpSettings),Ps.fromJson(r==null?void 0:r.kcpSettings),is.fromJson(r==null?void 0:r.wsSettings),as.fromJson(r==null?void 0:r.grpcSettings),Ts.fromJson(r==null?void 0:r.httpupgradeSettings),Es.fromJson(r==null?void 0:r.xhttpSettings),di.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class ui extends Pt{constructor(r=!1,l=8,a=16,i="reject"){super();J(this,"enabled");J(this,"concurrency");J(this,"xudpConcurrency");J(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=a!=null?a:16,this.xudpProxyUDP443=i!=null?i:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new ui:new ui(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var Dn,rn;const tt=class extends Pt{constructor(r="",l=me.VLESS,a=tt.Settings.getSettings(me.VLESS),i=new Un,o,c=new ui){super();J(this,"tag");J(this,"_protocol");J(this,"settings");J(this,"stream");J(this,"sendThrough");J(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:me.VLESS,this.settings=a!=null?a:tt.Settings.getSettings(this._protocol),this.stream=i,this.sendThrough=o,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=tt.Settings.getSettings(r),this.stream=new Un}canEnableTls(){return[me.VMess,me.VLESS,me.Trojan,me.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===me.VLESS:!1}canEnableReality(){return[me.VLESS,me.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[me.VMess,me.VLESS,me.Trojan,me.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[me.VMess,me.VLESS,me.Trojan,me.Shadowsocks,me.HTTP,me.Socks].includes(this.protocol)}hasVnext(){return[me.VMess,me.VLESS].includes(this.protocol)}hasServers(){return[me.Trojan,me.Shadowsocks,me.Socks,me.HTTP].includes(this.protocol)}hasAddressPort(){return[me.DNS,me.VMess,me.VLESS,me.Trojan,me.Shadowsocks,me.Socks,me.HTTP].includes(this.protocol)}hasUsername(){return[me.Socks,me.HTTP].includes(this.protocol)}static fromJson(r={}){var l,a,i,o;return new tt((l=r==null?void 0:r.tag)!=null?l:"",(a=r==null?void 0:r.protocol)!=null?a:me.VLESS,tt.Settings.fromProtocol((i=r==null?void 0:r.protocol)!=null?i:me.VLESS,r==null?void 0:r.settings),Un.fromJson(r==null?void 0:r.streamSettings),(o=r==null?void 0:r.sendThrough)!=null?o:"",ui.fromJson(r==null?void 0:r.mux))}toJson(){var l,a;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof Pt?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(a=this.mux)!=null&&a.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const a=l[0].toLowerCase();try{switch(a){case me.VMess:return tt.fromVmessLink(JSON.parse(Ao(l[1])));case me.VLESS:case me.Trojan:case"ss":return tt.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var o,c,u,p,m,g,x,S,y,v,E,T,L,ce,P,W,A,X,q,ge,H,oe,_;if(!r)return null;const l=new Un((o=r==null?void 0:r.net)!=null?o:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),a=r==null?void 0:r.net;a==="tcp"?l.tcp=new In((u=r==null?void 0:r.type)!=null?u:"none",(p=r==null?void 0:r.host)!=null?p:"",(m=r==null?void 0:r.path)!=null?m:""):a==="kcp"?(l.kcp=new Ps,l.kcp.type=(g=r==null?void 0:r.type)!=null?g:"none",l.kcp.seed=(x=r==null?void 0:r.path)!=null?x:""):a==="ws"?l.ws=new is((S=r==null?void 0:r.path)!=null?S:"/",(y=r==null?void 0:r.host)!=null?y:""):a==="grpc"?l.grpc=new as((v=r==null?void 0:r.path)!=null?v:"",(E=r==null?void 0:r.authority)!=null?E:"",(r==null?void 0:r.type)==="multi"):a==="httpupgrade"?l.httpupgrade=new Ts((T=r==null?void 0:r.path)!=null?T:"/",(L=r==null?void 0:r.host)!=null?L:""):a==="xhttp"&&(l.xhttp=new Es((ce=r==null?void 0:r.path)!=null?ce:"/",(P=r==null?void 0:r.host)!=null?P:"",(W=r==null?void 0:r.mode)!=null?W:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new os((A=r==null?void 0:r.sni)!=null?A:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(X=r==null?void 0:r.fp)!=null?X:"",Boolean(r==null?void 0:r.allowInsecure)));const i=Number((q=r==null?void 0:r.port)!=null?q:0);return Number.isNaN(i)?null:new tt((ge=r==null?void 0:r.ps)!=null?ge:"",me.VMess,new tt.VmessSettings((H=r==null?void 0:r.add)!=null?H:"",i,(oe=r==null?void 0:r.id)!=null?oe:"",(_=r==null?void 0:r.scy)!=null?_:""),l)}static fromParamLink(r){var W,A,X,q,ge,H,oe,_,ye,f,ae,K,xe,Re,Oe,V,be,Ce,Ee,ve,B;let l;try{l=new URL(r)}catch{return null}const a=(W=l.searchParams.get("type"))!=null?W:"tcp",i=(A=l.searchParams.get("security"))!=null?A:"none",o=new Un(a,i),c=(X=l.searchParams.get("headerType"))!=null?X:void 0,u=(q=l.searchParams.get("host"))!=null?q:void 0,p=(ge=l.searchParams.get("path"))!=null?ge:void 0,m=(H=l.searchParams.get("mode"))!=null?H:void 0;if(a==="tcp"||a==="none"?o.tcp=new In(c!=null?c:"none",u!=null?u:"",p!=null?p:""):a==="kcp"?(o.kcp=new Ps,o.kcp.type=c!=null?c:"none",o.kcp.seed=p!=null?p:""):a==="ws"?o.ws=new is(p!=null?p:"/",u!=null?u:""):a==="grpc"?o.grpc=new as((oe=l.searchParams.get("serviceName"))!=null?oe:"",(_=l.searchParams.get("authority"))!=null?_:"",l.searchParams.get("mode")==="multi"):a==="httpupgrade"?o.httpupgrade=new Ts(p!=null?p:"/",u!=null?u:""):a==="xhttp"&&(o.xhttp=new Es(p!=null?p:"/",u!=null?u:"",m!=null?m:"")),i==="tls"){const U=(ye=l.searchParams.get("fp"))!=null?ye:"none",j=l.searchParams.get("alpn"),de=l.searchParams.get("allowInsecure"),k=(f=l.searchParams.get("sni"))!=null?f:"",I=(ae=l.searchParams.get("ech"))!=null?ae:"";o.tls=new os(k,j?j.split(","):[],U,de==="1",I)}if(i==="reality"){const U=(K=l.searchParams.get("pbk"))!=null?K:"",j=(xe=l.searchParams.get("fp"))!=null?xe:"",de=(Re=l.searchParams.get("sni"))!=null?Re:"",k=(Oe=l.searchParams.get("sid"))!=null?Oe:"",I=(V=l.searchParams.get("spx"))!=null?V:"",R=(be=l.searchParams.get("pqv"))!=null?be:"";o.reality=new Ns(U,j,de,k,I,R)}const g=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,x=r.match(g);if(!x)return null;let[,S,y,v,E]=x,T=Number(E);Number.isNaN(T)&&(T=0),S==="ss"&&(S=me.Shadowsocks,y=Ao(y));let L=null;switch(S){case me.VLESS:{const U=(Ce=l.searchParams.get("encryption"))!=null?Ce:"none";L=new tt.VLESSSettings(v,T,y,(Ee=l.searchParams.get("flow"))!=null?Ee:"",U);break}case me.Trojan:L=new tt.TrojanSettings(v,T,y);break;case me.Shadowsocks:{const U=y.split(":"),j=(ve=U.shift())!=null?ve:"";L=new tt.ShadowsocksSettings(v,T,U.join(":"),j,!0);break}default:return null}const ce=decodeURIComponent((B=l.hash)!=null?B:""),P=ce.length>1?ce.substring(1):`out-${S}-${T}`;return new tt(P,S,L,o)}};let sr=tt;J(sr,"Settings",class extends Pt{constructor(a){super();J(this,"protocol");this.protocol=a}static getSettings(a){switch(a){case me.Freedom:return new tt.FreedomSettings;case me.Blackhole:return new tt.BlackholeSettings;case me.DNS:return new tt.DNSSettings;case me.VMess:return new tt.VmessSettings;case me.VLESS:return new tt.VLESSSettings;case me.Trojan:return new tt.TrojanSettings;case me.Shadowsocks:return new tt.ShadowsocksSettings;case me.Socks:return new tt.SocksSettings;case me.HTTP:return new tt.HttpSettings;case me.Wireguard:return new tt.WireguardSettings;default:return null}}static fromProtocol(a,i){switch(a){case me.Freedom:return tt.FreedomSettings.fromJson(i);case me.Blackhole:return tt.BlackholeSettings.fromJson(i);case me.DNS:return tt.DNSSettings.fromJson(i);case me.VMess:return tt.VmessSettings.fromJson(i);case me.VLESS:return tt.VLESSSettings.fromJson(i);case me.Trojan:return tt.TrojanSettings.fromJson(i);case me.Shadowsocks:return tt.ShadowsocksSettings.fromJson(i);case me.Socks:return tt.SocksSettings.fromJson(i);case me.HTTP:return tt.HttpSettings.fromJson(i);case me.Wireguard:return tt.WireguardSettings.fromJson(i);default:return null}}toJson(){return{}}}),J(sr,"FreedomSettings",(Dn=class extends Pt{constructor(a="",i="",o={},c=[]){super();J(this,"domainStrategy");J(this,"redirect");J(this,"fragment");J(this,"noises");this.domainStrategy=a!=null?a:"",this.redirect=i!=null?i:"",this.fragment=o!=null?o:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new tt.FreedomSettings.Noise)}delNoise(a){this.noises.splice(a,1)}static fromJson(a={}){var i,o;return new Dn((i=a==null?void 0:a.domainStrategy)!=null?i:"",(o=a==null?void 0:a.redirect)!=null?o:"",a!=null&&a.fragment?Dn.Fragment.fromJson(a.fragment):{},Array.isArray(a==null?void 0:a.noises)?a.noises.map(c=>Dn.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:Ur.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:Ur.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:Pt.toJsonArray(this.noises)}}},J(Dn,"Fragment",class Zl extends Pt{constructor(o="1-3",c="",u="",p=""){super();J(this,"packets");J(this,"length");J(this,"interval");J(this,"maxSplit");this.packets=o!=null?o:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=p!=null?p:""}static fromJson(o={}){var c,u,p,m;return new Zl((c=o==null?void 0:o.packets)!=null?c:"1-3",(u=o==null?void 0:o.length)!=null?u:"",(p=o==null?void 0:o.interval)!=null?p:"",(m=o==null?void 0:o.maxSplit)!=null?m:"")}}),J(Dn,"Noise",class jl extends Pt{constructor(o="rand",c="10-20",u="10-16",p="ip"){super();J(this,"type");J(this,"packet");J(this,"delay");J(this,"applyTo");this.type=o!=null?o:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(o={}){var c,u,p,m;return new jl((c=o==null?void 0:o.type)!=null?c:"rand",(u=o==null?void 0:o.packet)!=null?u:"10-20",(p=o==null?void 0:o.delay)!=null?p:"10-16",(m=o==null?void 0:o.applyTo)!=null?m:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),Dn)),J(sr,"BlackholeSettings",class ec extends Pt{constructor(a){super();J(this,"type");this.type=a}static fromJson(a={}){var i;return new ec((i=a==null?void 0:a.response)==null?void 0:i.type)}toJson(){return{response:Ur.isEmpty(this.type)?void 0:{type:this.type}}}}),J(sr,"DNSSettings",class tc extends Pt{constructor(a="udp",i="",o=53,c="reject",u=[]){super();J(this,"network");J(this,"address");J(this,"port");J(this,"nonIPQuery");J(this,"blockTypes");this.network=a!=null?a:"udp",this.address=i!=null?i:"",this.port=o!=null?o:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(a={}){var i,o,c,u;return new tc((i=a==null?void 0:a.network)!=null?i:"udp",(o=a==null?void 0:a.address)!=null?o:"",(c=a==null?void 0:a.port)!=null?c:53,(u=a==null?void 0:a.nonIPQuery)!=null?u:"reject",Array.isArray(a==null?void 0:a.blockTypes)?a.blockTypes:[])}}),J(sr,"VmessSettings",class extends Pt{constructor(a="",i=0,o="",c=""){super();J(this,"address");J(this,"port");J(this,"id");J(this,"security");this.address=a!=null?a:"",this.port=i!=null?i:0,this.id=o!=null?o:"",this.security=c!=null?c:""}static fromJson(a={}){var c,u,p,m;if(Ur.isArrEmpty(a==null?void 0:a.vnext))return new tt.VmessSettings;const i=a.vnext[0],o=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new tt.VmessSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=o==null?void 0:o.id)!=null?p:"",(m=o==null?void 0:o.security)!=null?m:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),J(sr,"VLESSSettings",class extends Pt{constructor(a="",i=0,o="",c="",u=""){super();J(this,"address");J(this,"port");J(this,"id");J(this,"flow");J(this,"encryption");this.address=a!=null?a:"",this.port=i!=null?i:0,this.id=o!=null?o:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(a={}){var c,u,p,m,g;if(Ur.isArrEmpty(a==null?void 0:a.vnext))return new tt.VLESSSettings;const i=a.vnext[0],o=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new tt.VLESSSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=o==null?void 0:o.id)!=null?p:"",(m=o==null?void 0:o.flow)!=null?m:"",(g=o==null?void 0:o.encryption)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),J(sr,"TrojanSettings",class extends Pt{constructor(a="",i=0,o=""){super();J(this,"address");J(this,"port");J(this,"password");this.address=a!=null?a:"",this.port=i!=null?i:0,this.password=o!=null?o:""}static fromJson(a={}){var o,c,u;if(Ur.isArrEmpty(a==null?void 0:a.servers))return new tt.TrojanSettings;const i=a.servers[0];return new tt.TrojanSettings((o=i==null?void 0:i.address)!=null?o:"",(c=i==null?void 0:i.port)!=null?c:0,(u=i==null?void 0:i.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),J(sr,"ShadowsocksSettings",class extends Pt{constructor(a="",i=0,o="",c="",u,p){super();J(this,"address");J(this,"port");J(this,"password");J(this,"method");J(this,"uot");J(this,"UoTVersion");this.address=a!=null?a:"",this.port=i!=null?i:0,this.password=o!=null?o:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=p}static fromJson(a={}){var c,u,p,m;let i=a==null?void 0:a.servers;Ur.isArrEmpty(i)&&(i=[{}]);const o=i[0];return new tt.ShadowsocksSettings((c=o==null?void 0:o.address)!=null?c:"",(u=o==null?void 0:o.port)!=null?u:0,(p=o==null?void 0:o.password)!=null?p:"",(m=o==null?void 0:o.method)!=null?m:"",o==null?void 0:o.uot,o==null?void 0:o.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),J(sr,"SocksSettings",class extends Pt{constructor(a="",i=0,o="",c=""){super();J(this,"address");J(this,"port");J(this,"user");J(this,"pass");this.address=a!=null?a:"",this.port=i!=null?i:0,this.user=o!=null?o:"",this.pass=c!=null?c:""}static fromJson(a={}){var u,p,m,g;let i=a==null?void 0:a.servers;Ur.isArrEmpty(i)&&(i=[{users:[{}]}]);const o=i[0],c=Array.isArray(o==null?void 0:o.users)&&o.users[0]?o.users[0]:{};return new tt.SocksSettings((u=o==null?void 0:o.address)!=null?u:"",(p=o==null?void 0:o.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Ur.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),J(sr,"HttpSettings",class extends Pt{constructor(a="",i=0,o="",c=""){super();J(this,"address");J(this,"port");J(this,"user");J(this,"pass");this.address=a!=null?a:"",this.port=i!=null?i:0,this.user=o!=null?o:"",this.pass=c!=null?c:""}static fromJson(a={}){var u,p,m,g;let i=a==null?void 0:a.servers;Ur.isArrEmpty(i)&&(i=[{users:[{}]}]);const o=i[0],c=Array.isArray(o==null?void 0:o.users)&&o.users[0]?o.users[0]:{};return new tt.HttpSettings((u=o==null?void 0:o.address)!=null?u:"",(p=o==null?void 0:o.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:Ur.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),J(sr,"WireguardSettings",(rn=class extends Pt{constructor(a=1420,i="",o=[""],c=2,u="",p="",m=[new rn.Peer],g=!1){super();J(this,"mtu");J(this,"secretKey");J(this,"pubKey");J(this,"address");J(this,"workers");J(this,"domainStrategy");J(this,"reserved");J(this,"peers");J(this,"noKernelTun");this.mtu=a!=null?a:1420,this.secretKey=i!=null?i:"",this.pubKey=this.secretKey.length>0?zp(this.secretKey):"",this.address=Array.isArray(o)?o.join(","):o!=null?o:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=m!=null?m:[new rn.Peer],this.noKernelTun=Boolean(g)}addPeer(){this.peers.push(new rn.Peer)}delPeer(a){this.peers.splice(a,1)}static fromJson(a={}){var i,o,c,u,p,m,g;return new rn((i=a==null?void 0:a.mtu)!=null?i:1420,(o=a==null?void 0:a.secretKey)!=null?o:"",(c=a==null?void 0:a.address)!=null?c:[""],(u=a==null?void 0:a.workers)!=null?u:2,(p=a==null?void 0:a.domainStrategy)!=null?p:"",(m=a==null?void 0:a.reserved)!=null?m:"",Array.isArray(a==null?void 0:a.peers)?a.peers.map(x=>rn.Peer.fromJson(x)):[new rn.Peer],(g=a==null?void 0:a.noKernelTun)!=null?g:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:Up.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(a=>Number(a)).filter(a=>!Number.isNaN(a)):void 0,peers:Pt.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},J(rn,"Peer",class extends Pt{constructor(o="",c="",u=["0.0.0.0/0","::/0"],p="",m=0){super();J(this,"publicKey");J(this,"psk");J(this,"allowedIPs");J(this,"endpoint");J(this,"keepAlive");this.publicKey=o!=null?o:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=m!=null?m:0}static fromJson(o={}){var c,u,p,m;return new tt.WireguardSettings.Peer((c=o==null?void 0:o.publicKey)!=null?c:"",(u=o==null?void 0:o.preSharedKey)!=null?u:"",Array.isArray(o==null?void 0:o.allowedIPs)?o.allowedIPs:["0.0.0.0/0","::/0"],(p=o==null?void 0:o.endpoint)!=null?p:"",(m=o==null?void 0:o.keepAlive)!=null?m:0)}toJson(){var o;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(o=this.allowedIPs)!=null&&o.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),rn));class Qn{static sizeFormat(s){if(s<=0||Number.isNaN(s))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,a=s;for(;a>=1024&&l<r.length-1;)a/=1024,l++;return`${a.toFixed(2)} ${r[l]}`}}const Lp=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(Mp);const Op=Object.values(Rp),Ha=["vmess","vless","trojan","shadowsocks","http","socks"],Wp=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp","xhttp"],Fp=["none","tls","reality"],ca=t=>t.split(/[\n,]/).map(s=>s.trim()).filter(Boolean),da=t=>t&&t.length?t.join(`
`):"",gs=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",rc=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),Hp=t=>{if(!t)return 0;const s=Number(t);return!Number.isNaN(s)&&s>0?s:t.trim()},Ir=t=>(Object.keys(t).forEach(s=>{const r=t[s];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[s]}),t),Io=()=>({user:"",pass:""}),ka=()=>({name:"",value:""}),Po=t=>{var s,r;return{user:(s=t==null?void 0:t.user)!=null?s:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},To=t=>{var s,r;return Ir({user:(s=t.user)==null?void 0:s.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},Gn=t=>{if(t===""||t===null||typeof t>"u")return;const s=Number(t);return Number.isFinite(s)?s:void 0},Bp=t=>{if(!t.sockoptEnabled)return;const s=t.sockopt,r={acceptProxyProtocol:s.acceptProxyProtocol,tcpFastOpen:s.tcpFastOpen,mark:Gn(s.mark),tproxy:s.tproxy||void 0,tcpMptcp:s.tcpMptcp,penetrate:s.penetrate,domainStrategy:s.domainStrategy||void 0,tcpMaxSeg:Gn(s.tcpMaxSeg),dialerProxy:s.dialerProxy||void 0,tcpKeepAliveInterval:Gn(s.tcpKeepAliveInterval),tcpKeepAliveIdle:Gn(s.tcpKeepAliveIdle),tcpUserTimeout:Gn(s.tcpUserTimeout),tcpcongestion:s.tcpcongestion||void 0,V6Only:s.V6Only,tcpWindowClamp:Gn(s.tcpWindowClamp),interface:s.interfaceName||void 0};return Ir(r)},Ca=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",tlsRawSettings:{},realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",xhttpHost:"",xhttpPath:"/",xhttpHeaders:[ka()],xhttpMode:"auto",xhttpScMaxBufferedPosts:"30",xhttpScMaxEachPostBytes:"1000000",xhttpScStreamUpServerSecs:"20-80",xhttpPaddingBytes:"100-1000",xhttpNoSSEHeader:!1,vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:rc(),httpAccounts:[Io()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[Io()],socksUdpEnabled:!1,socksUdpIp:""}),Vp=t=>{var s,r,l,a,i,o,c;return{dest:(r=(s=t==null?void 0:t.dest)==null?void 0:s.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(a=t==null?void 0:t.type)!=null?a:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(i=t==null?void 0:t.alpn)!=null?i:"",xver:(c=(o=t==null?void 0:t.xver)==null?void 0:o.toString())!=null?c:""}},Eo=t=>{var r,l,a;const s={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(a=t.type)==null?void 0:a.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(s.alpn=t.alpn.split(",").map(i=>i.trim()).filter(Boolean)),Ir(s)},$p=t=>{var p,m,g,x,S,y,v,E,T,L,ce,P,W,A,X,q,ge,H,oe,_,ye,f,ae,K,xe,Re,Oe,V,be,Ce,Ee,ve,B,U,j,de,k,I,R,$,Ae,Se,Je,N,Z,F,pe,Q,Pe,Te,le,Le,Ke,ne,Ye,te,ee,Ne,at,ot,yt,et,Jt,qt,wt,dt,lr,Sr,pr,xr,cr,mr,gr,re,_e,Y,Ge,kt,Vt,Et,Nt,ut,ht,At,rr,vr,Vr,G;const s=Ha.includes(t.protocol)?t.protocol:"vless",r=Ca(s),l=(p=t.settings)!=null?p:{},a=(m=t.sniffing)!=null?m:{},i=(g=t.streamSettings)!=null?g:{},o=(x=i.tlsSettings)!=null?x:{},c=i.tlsSettings!==void 0&&i.tlsSettings!==null?JSON.parse(JSON.stringify(i.tlsSettings)):{},u=(S=i.realitySettings)!=null?S:{};return{...r,tag:(y=t.tag)!=null?y:"",listen:(v=t.listen)!=null?v:"",port:(T=(E=t.port)==null?void 0:E.toString())!=null?T:"",disableInsecureEncryption:Boolean((L=l.disableInsecureEncryption)!=null?L:r.disableInsecureEncryption),vlessDecryption:(ce=l.decryption)!=null?ce:r.vlessDecryption,vlessEncryption:(P=l.encryption)!=null?P:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map(Ie=>Vp(Ie)):r.fallbacks,shadowsocksNetwork:(W=l.network)!=null?W:r.shadowsocksNetwork,sniffingEnabled:Boolean((A=a.enabled)!=null?A:r.sniffingEnabled),sniffingDestinations:Array.isArray(a.destOverride)&&a.destOverride.length?a.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((X=a.routeOnly)!=null?X:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((q=a.metadataOnly)!=null?q:r.sniffingMetadataOnly),streamNetwork:(ge=i.network)!=null?ge:r.streamNetwork,streamSecurity:(H=i.security)!=null?H:r.streamSecurity,tlsServerName:(oe=o.serverName)!=null?oe:r.tlsServerName,tlsAlpn:Array.isArray(o.alpn)?o.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((_=o.allowInsecure)!=null?_:r.tlsAllowInsecure),tlsFingerprint:(ye=o.fingerprint)!=null?ye:r.tlsFingerprint,tlsRawSettings:c,realityPrivateKey:(f=u.privateKey)!=null?f:r.realityPrivateKey,realityServerNames:da(u.serverNames),realityShortIds:da(u.shortIds),realityDest:(ae=u.dest)!=null?ae:r.realityDest,realitySpiderX:(K=u.spiderX)!=null?K:r.realitySpiderX,realityXver:(Re=(xe=u.xver)==null?void 0:xe.toString())!=null?Re:r.realityXver,wsPath:(V=(Oe=i==null?void 0:i.wsSettings)==null?void 0:Oe.path)!=null?V:r.wsPath,wsHost:(Ee=(Ce=(be=i==null?void 0:i.wsSettings)==null?void 0:be.headers)==null?void 0:Ce.Host)!=null?Ee:r.wsHost,tcpHeaderType:(U=(B=(ve=i==null?void 0:i.tcpSettings)==null?void 0:ve.header)==null?void 0:B.type)!=null?U:r.tcpHeaderType,tcpHttpHosts:da((I=(k=(de=(j=i==null?void 0:i.tcpSettings)==null?void 0:j.header)==null?void 0:de.request)==null?void 0:k.headers)==null?void 0:I.Host),tcpHttpPath:Array.isArray((Ae=($=(R=i==null?void 0:i.tcpSettings)==null?void 0:R.header)==null?void 0:$.request)==null?void 0:Ae.path)?i.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(Je=(Se=i==null?void 0:i.grpcSettings)==null?void 0:Se.serviceName)!=null?Je:r.grpcServiceName,grpcAuthority:(Z=(N=i==null?void 0:i.grpcSettings)==null?void 0:N.authority)!=null?Z:r.grpcAuthority,grpcMultiMode:Boolean((pe=(F=i==null?void 0:i.grpcSettings)==null?void 0:F.multiMode)!=null?pe:r.grpcMultiMode),kcpHeaderType:(Te=(Pe=(Q=i==null?void 0:i.kcpSettings)==null?void 0:Q.header)==null?void 0:Pe.type)!=null?Te:r.kcpHeaderType,kcpSeed:(Le=(le=i==null?void 0:i.kcpSettings)==null?void 0:le.seed)!=null?Le:r.kcpSeed,quicSecurity:(ne=(Ke=i==null?void 0:i.quicSettings)==null?void 0:Ke.security)!=null?ne:r.quicSecurity,quicKey:(te=(Ye=i==null?void 0:i.quicSettings)==null?void 0:Ye.key)!=null?te:r.quicKey,quicHeaderType:(at=(Ne=(ee=i==null?void 0:i.quicSettings)==null?void 0:ee.header)==null?void 0:Ne.type)!=null?at:r.quicHeaderType,httpupgradePath:(yt=(ot=i==null?void 0:i.httpupgradeSettings)==null?void 0:ot.path)!=null?yt:r.httpupgradePath,httpupgradeHost:(Jt=(et=i==null?void 0:i.httpupgradeSettings)==null?void 0:et.host)!=null?Jt:r.httpupgradeHost,splithttpPath:(wt=(qt=i==null?void 0:i.splithttpSettings)==null?void 0:qt.path)!=null?wt:r.splithttpPath,splithttpHost:(lr=(dt=i==null?void 0:i.splithttpSettings)==null?void 0:dt.host)!=null?lr:r.splithttpHost,xhttpHost:(pr=(Sr=i==null?void 0:i.xhttpSettings)==null?void 0:Sr.host)!=null?pr:r.xhttpHost,xhttpPath:(cr=(xr=i==null?void 0:i.xhttpSettings)==null?void 0:xr.path)!=null?cr:r.xhttpPath,xhttpHeaders:(mr=i==null?void 0:i.xhttpSettings)!=null&&mr.headers?Yp(i.xhttpSettings.headers):r.xhttpHeaders,xhttpMode:(re=(gr=i==null?void 0:i.xhttpSettings)==null?void 0:gr.mode)!=null?re:r.xhttpMode,xhttpScMaxBufferedPosts:(Ge=(Y=(_e=i==null?void 0:i.xhttpSettings)==null?void 0:_e.scMaxBufferedPosts)==null?void 0:Y.toString())!=null?Ge:r.xhttpScMaxBufferedPosts,xhttpScMaxEachPostBytes:(Et=(Vt=(kt=i==null?void 0:i.xhttpSettings)==null?void 0:kt.scMaxEachPostBytes)==null?void 0:Vt.toString())!=null?Et:r.xhttpScMaxEachPostBytes,xhttpScStreamUpServerSecs:(ht=(ut=(Nt=i==null?void 0:i.xhttpSettings)==null?void 0:Nt.scStreamUpServerSecs)==null?void 0:ut.toString())!=null?ht:r.xhttpScStreamUpServerSecs,xhttpPaddingBytes:(rr=(At=i==null?void 0:i.xhttpSettings)==null?void 0:At.xPaddingBytes)!=null?rr:r.xhttpPaddingBytes,xhttpNoSSEHeader:Boolean((Vr=(vr=i==null?void 0:i.xhttpSettings)==null?void 0:vr.noSSEHeader)!=null?Vr:r.xhttpNoSSEHeader),vlessSelectedAuth:(G=l.selectedAuth)!=null?G:r.vlessSelectedAuth,sockoptEnabled:Boolean(i==null?void 0:i.sockopt),sockopt:(()=>{var Qe,xt,Gt,fr,Mr,dr;const Ie=rc(),Ve=(Qe=i==null?void 0:i.sockopt)!=null?Qe:{};return Ie.acceptProxyProtocol=Boolean(Ve.acceptProxyProtocol),Ie.tcpFastOpen=Boolean(Ve.tcpFastOpen),Ie.mark=gs(Ve.mark),Ie.tproxy=(xt=Ve.tproxy)!=null?xt:Ie.tproxy,Ie.tcpMptcp=Boolean(Ve.tcpMptcp),Ie.penetrate=Boolean(Ve.penetrate),Ie.domainStrategy=(Gt=Ve.domainStrategy)!=null?Gt:Ie.domainStrategy,Ie.tcpMaxSeg=gs(Ve.tcpMaxSeg),Ie.dialerProxy=(fr=Ve.dialerProxy)!=null?fr:Ie.dialerProxy,Ie.tcpKeepAliveInterval=gs(Ve.tcpKeepAliveInterval),Ie.tcpKeepAliveIdle=gs(Ve.tcpKeepAliveIdle),Ie.tcpUserTimeout=gs(Ve.tcpUserTimeout),Ie.tcpcongestion=(Mr=Ve.tcpcongestion)!=null?Mr:Ie.tcpcongestion,Ie.V6Only=Boolean(Ve.V6Only),Ie.tcpWindowClamp=gs(Ve.tcpWindowClamp),Ie.interfaceName=(dr=Ve.interface)!=null?dr:Ie.interfaceName,Ie})(),httpAccounts:s==="http"&&Array.isArray(l.accounts)?l.accounts.map(Ie=>Po(Ie)):r.httpAccounts,httpAllowTransparent:s==="http"&&typeof l.allowTransparent=="boolean"?l.allowTransparent:r.httpAllowTransparent,socksAuth:s==="socks"&&l.auth==="password"?"password":r.socksAuth,socksAccounts:s==="socks"&&Array.isArray(l.accounts)?l.accounts.map(Ie=>Po(Ie)):r.socksAccounts,socksUdpEnabled:s==="socks"&&typeof l.udp=="boolean"?l.udp:r.socksUdpEnabled,socksUdpIp:s==="socks"&&l.ip!==void 0&&l.ip!==null?String(l.ip):r.socksUdpIp}},Kp=t=>{var l,a,i,o;const s={network:t.streamNetwork,security:t.streamSecurity};if(t.streamNetwork==="ws"&&(s.wsSettings=Ir({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?s.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:ca(t.tcpHttpHosts)}:{}}}}:s.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(s.grpcSettings=Ir({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(s.kcpSettings=Ir({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(s.quicSettings=Ir({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(s.httpupgradeSettings=Ir({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(s.splithttpSettings=Ir({path:t.splithttpPath,host:t.splithttpHost})),t.streamNetwork==="xhttp"&&(s.xhttpSettings=Ir({path:t.xhttpPath,host:t.xhttpHost,headers:Gp(t.xhttpHeaders),mode:t.xhttpMode,scMaxBufferedPosts:Gn(t.xhttpScMaxBufferedPosts),scMaxEachPostBytes:((l=t.xhttpScMaxEachPostBytes)==null?void 0:l.trim())||void 0,scStreamUpServerSecs:((a=t.xhttpScStreamUpServerSecs)==null?void 0:a.trim())||void 0,xPaddingBytes:((i=t.xhttpPaddingBytes)==null?void 0:i.trim())||void 0,noSSEHeader:t.xhttpNoSSEHeader||void 0})),t.streamSecurity==="tls"){const c=t.tlsRawSettings&&typeof t.tlsRawSettings=="object"?{...t.tlsRawSettings}:{};c.serverName=t.tlsServerName||void 0,c.alpn=(o=t.tlsAlpn)!=null&&o.length?t.tlsAlpn:void 0,c.allowInsecure=t.tlsAllowInsecure,c.fingerprint=t.tlsFingerprint||void 0,s.tlsSettings=Ir(c)}t.streamSecurity==="reality"&&(s.realitySettings=Ir({privateKey:t.realityPrivateKey||void 0,serverNames:ca(t.realityServerNames),shortIds:ca(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=Bp(t);return r&&(s.sockopt=r),Ir(s)},Jp=t=>{const s={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(s.clients=[]),t.protocol){case"vmess":s.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":s.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(s.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(s.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(Eo).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(Eo).filter(r=>Object.keys(r).length));break;case"shadowsocks":s.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(To).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r),t.httpAllowTransparent&&(s.allowTransparent=!0);break}case"socks":{if(s.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(To).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r)}s.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(s.ip=t.socksUdpIp.trim());break}}return s},qp=t=>{const r=t.protocol!=="http"&&t.protocol!=="socks"?Kp(t):void 0,l={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:Hp(t.port),protocol:t.protocol,settings:Jp(t)};return r&&(l.streamSettings=r),t.sniffingEnabled&&(l.sniffing=Ir({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly})),l},Yp=t=>{if(!t)return[ka()];const s=[];return Object.entries(t).forEach(([r,l])=>{var a;Array.isArray(l)?l.forEach(i=>{var o;return s.push({name:r,value:(o=i==null?void 0:i.toString())!=null?o:""})}):s.push({name:r,value:(a=l==null?void 0:l.toString())!=null?a:""})}),s.length?s:[ka()]},Gp=t=>{const s={};return t.forEach(({name:r,value:l})=>{const a=r==null?void 0:r.trim(),i=l==null?void 0:l.trim();!a||!i||(s[a]=i)}),Object.keys(s).length?s:void 0};class _a{static gf(s){const r=new Float64Array(16);if(s)for(let l=0;l<s.length;++l)r[l]=s[l];return r}static pack(s,r){let l;const a=this.gf(),i=this.gf();for(let o=0;o<16;++o)i[o]=r[o];this.carry(i),this.carry(i),this.carry(i);for(let o=0;o<2;++o){a[0]=i[0]-65517;for(let c=1;c<15;++c)a[c]=i[c]-65535-(a[c-1]>>16&1),a[c-1]&=65535;a[15]=i[15]-32767-(a[14]>>16&1),l=a[15]>>16&1,a[14]&=65535,this.cswap(i,a,1-l)}for(let o=0;o<16;++o)s[2*o]=i[o]&255,s[2*o+1]=i[o]>>8}static carry(s){for(let r=0;r<16;++r)s[(r+1)%16]+=(r<15?1:38)*Math.floor(s[r]/65536),s[r]&=65535}static cswap(s,r,l){const a=~(l-1);for(let i=0;i<16;++i){const o=a&(s[i]^r[i]);s[i]^=o,r[i]^=o}}static add(s,r,l){for(let a=0;a<16;++a)s[a]=r[a]+l[a]|0}static subtract(s,r,l){for(let a=0;a<16;++a)s[a]=r[a]-l[a]|0}static multmod(s,r,l){const a=new Float64Array(31);for(let i=0;i<16;++i)for(let o=0;o<16;++o)a[i+o]+=r[i]*l[o];for(let i=0;i<15;++i)a[i]+=38*a[i+16];for(let i=0;i<16;++i)s[i]=a[i];this.carry(s),this.carry(s)}static invert(s,r){const l=this.gf();for(let a=0;a<16;++a)l[a]=r[a];for(let a=253;a>=0;--a)this.multmod(l,l,l),a!==2&&a!==4&&this.multmod(l,l,r);for(let a=0;a<16;++a)s[a]=l[a]}static clamp(s){s[31]=s[31]&127|64,s[0]&=248}static generatePublicKey(s){let r;const l=new Uint8Array(32),a=this.gf([1]),i=this.gf([9]),o=this.gf(),c=this.gf([1]),u=this.gf(),p=this.gf(),m=this.gf([56129,1]),g=this.gf([9]);for(let x=0;x<32;++x)l[x]=s[x];this.clamp(l);for(let x=254;x>=0;--x)r=l[x>>>3]>>>(x&7)&1,this.cswap(a,i,r),this.cswap(o,c,r),this.add(u,a,o),this.subtract(a,a,o),this.add(o,i,c),this.subtract(i,i,c),this.multmod(c,u,u),this.multmod(p,a,a),this.multmod(a,o,a),this.multmod(o,i,u),this.add(u,a,o),this.subtract(a,a,o),this.multmod(i,a,a),this.subtract(o,c,p),this.multmod(a,o,m),this.add(a,a,c),this.multmod(o,o,a),this.multmod(a,c,p),this.multmod(c,i,g),this.multmod(i,u,u),this.cswap(a,i,r),this.cswap(o,c,r);return this.invert(o,o),this.multmod(a,a,o),this.pack(l,a),l}static generatePresharedKey(){const s=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(s),s}static generatePrivateKey(){const s=this.generatePresharedKey();return this.clamp(s),s}static encodeBase64(s,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let a=0;a<4;++a)s[a]=l[a]+65+(25-l[a]>>8&6)-(51-l[a]>>8&75)-(61-l[a]>>8&15)+(62-l[a]>>8&3)}static keyToBase64(s){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),s.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([s[r*3+0],s[r*3+1],0])),l[43]=61,Array.from(l).map(a=>String.fromCharCode(a)).join("")}static keyFromBase64(s){const r=globalThis.atob(s),l=new Uint8Array(r.length);for(let a=0;a<r.length;a++)l[a]=r.charCodeAt(a);return l}static generateKeypair(s=""){const r=s.length>0?this.keyFromBase64(s):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:s.length>0?s:this.keyToBase64(r)}}}const Oi=t=>_a.generateKeypair(t!=null?t:""),Xp=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:_a.generateKeypair.bind(_a)})},Qp=async()=>ze("/xray/vlessenc"),nt=d.exports.forwardRef((t,s)=>e(De,{size:"sm",ref:s,...t}));nt.displayName="InboundFormInput";const Xn=d.exports.forwardRef((t,s)=>e(rt,{size:"sm",ref:s,...t}));Xn.displayName="InboundFormSelect";const js=d.exports.forwardRef((t,s)=>e(Pr,{size:"sm",resize:"vertical",ref:s,...t}));js.displayName="InboundFormTextarea";const No=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),Zp=t=>{const s=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!s)return"";const r=s.length%4;return r===0?s:`${s}${"=".repeat(4-r)}`},jp=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],em=["bbr","cubic","reno"],tm=["off","redirect","tproxy"],rm=["auto","packet-up","stream-up","stream-one"],nm=({isOpen:t,mode:s,initialValue:r,isSubmitting:l,onClose:a,onSubmit:i})=>{var Le,Ke,ne,Ye;const{t:o}=qe(),c=er(),[u,p]=d.exports.useState([]),[m,g]=d.exports.useState(!1),x=jr({defaultValues:Ca()}),{control:S,register:y,handleSubmit:v,reset:E,watch:T}=x,{fields:L,append:ce,remove:P}=xs({control:S,name:"fallbacks"}),{fields:W,append:A,remove:X}=xs({control:S,name:"httpAccounts"}),{fields:q,append:ge,remove:H}=xs({control:S,name:"socksAccounts"}),{fields:oe,append:_,remove:ye}=xs({control:S,name:"xhttpHeaders"}),f=tr({control:S,name:"protocol"})||T("protocol"),ae=tr({control:S,name:"streamNetwork"})||T("streamNetwork"),K=tr({control:S,name:"streamSecurity"})||T("streamSecurity"),xe=(Le=tr({control:S,name:"sniffingEnabled"}))!=null?Le:T("sniffingEnabled"),Re=tr({control:S,name:"realityPrivateKey"})||T("realityPrivateKey"),Oe=tr({control:S,name:"tcpHeaderType"})||T("tcpHeaderType"),V=(Ke=tr({control:S,name:"sockoptEnabled"}))!=null?Ke:!1,be=tr({control:S,name:"vlessSelectedAuth"})||"",Ce=tr({control:S,name:"socksAuth"})||T("socksAuth")||"noauth",Ee=(Ye=(ne=tr({control:S,name:"socksUdpEnabled"}))!=null?ne:T("socksUdpEnabled"))!=null?Ye:!1,ve=tr({control:S,name:"xhttpMode"})||T("xhttpMode")||"auto",B=f!=="http"&&f!=="socks",U=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),j=d.exports.useMemo(()=>{const te=[...U,...u.map(Ne=>Ne.label)].filter(Boolean);return Array.from(new Set(te)).map(Ne=>({label:Ne,value:Ne}))},[U,u]);d.exports.useEffect(()=>{if(t)if(r){const te=$p(r);E(te)}else E(Ca())},[r,E,t]);const de=d.exports.useCallback((te,ee)=>n(C,{children:[e(D,{children:ee}),e(St,{control:S,name:`sockopt.${te}`,render:({field:Ne})=>{const at=typeof Ne.value=="number"||typeof Ne.value=="string"?Ne.value:void 0;return e(rs,{min:0,value:at!=null?at:"",onChange:ot=>Ne.onChange(ot),children:e(ts,{})})}})]}),[S]),k=d.exports.useCallback((te,ee)=>n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:ee}),e(St,{control:S,name:`sockopt.${te}`,render:({field:Ne})=>e(gt,{isChecked:typeof Ne.value=="boolean"?Ne.value:Boolean(Ne.value),onChange:at=>Ne.onChange(at.target.checked)})})]}),[S]),I=d.exports.useCallback((te,ee,Ne)=>n(C,{children:[e(D,{children:ee}),e(nt,{...y(`sockopt.${te}`),placeholder:Ne})]}),[y]),R=f==="vless"||f==="trojan",$=We("gray.200","gray.700"),Ae=async te=>{await i(te)},Se=d.exports.useCallback(()=>{try{const{privateKey:te}=Oi();x.setValue("realityPrivateKey",No(te),{shouldDirty:!0})}catch(te){c({status:"error",title:o("inbounds.reality.generateError","Unable to generate key pair"),description:te instanceof Error?te.message:void 0})}},[x,c,o]),Je=d.exports.useCallback(()=>{try{const te=typeof window>"u"?void 0:window.crypto;if(!(te!=null&&te.getRandomValues))throw new Error("Crypto API is not available in this environment.");const ee=new Uint8Array(4);te.getRandomValues(ee);const Ne=Array.from(ee).map(yt=>yt.toString(16).padStart(2,"0")).join(""),ot=(x.getValues("realityShortIds")||"").split(/[\s,]+/).map(yt=>yt.trim()).filter(Boolean);ot.push(Ne),x.setValue("realityShortIds",ot.join(`
`),{shouldDirty:!0})}catch(te){c({status:"error",title:o("inbounds.reality.shortIdError","Unable to generate short ID"),description:te instanceof Error?te.message:void 0})}},[x,c,o]),N=d.exports.useMemo(()=>{const te=Zp(Re);if(!te)return"";try{const{publicKey:ee}=Oi(te);return No(ee)}catch{return""}},[Re]),Z=()=>ce({dest:"",path:"",type:"",alpn:"",xver:""}),F=d.exports.useCallback(async()=>{var te;g(!0);try{const ee=await Qp(),Ne=(te=ee==null?void 0:ee.auths)!=null?te:[];return p(Ne),Ne}catch(ee){return console.error(ee),c({status:"error",title:o("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{g(!1)}},[c,o]),pe=d.exports.useCallback(async()=>u.length?u:F(),[F,u]),Q=d.exports.useCallback((te,ee)=>{var at,ot;const Ne=ee.find(yt=>yt.label===te);if(!Ne){c({status:"warning",title:o("inbounds.vless.authNotFound","Authentication block not available")});return}x.setValue("vlessDecryption",(at=Ne.decryption)!=null?at:"",{shouldDirty:!0}),x.setValue("vlessEncryption",(ot=Ne.encryption)!=null?ot:"",{shouldDirty:!0})},[x,o,c]),Pe=d.exports.useCallback(async te=>{if(!te){x.setValue("vlessDecryption","",{shouldDirty:!0}),x.setValue("vlessEncryption","",{shouldDirty:!0});return}const ee=await pe();ee.length&&Q(te,ee)},[Q,pe,x]),Te=d.exports.useCallback(async()=>{const te=x.getValues("vlessSelectedAuth");if(!te){c({status:"info",title:o("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const ee=await F();ee.length&&Q(te,ee)},[Q,F,x,o,c]),le=d.exports.useCallback(()=>{x.setValue("vlessSelectedAuth","",{shouldDirty:!0}),x.setValue("vlessDecryption","",{shouldDirty:!0}),x.setValue("vlessEncryption","",{shouldDirty:!0})},[x]);return d.exports.useEffect(()=>{t&&f==="vless"&&pe()},[f,pe,t]),n(Wt,{isOpen:t,onClose:a,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(_t,{}),n(Ft,{maxW:{base:"95vw",md:"4xl"},children:[e(It,{children:s==="create"?o("inbounds.add","Add inbound"):o("inbounds.edit","Edit inbound")}),e(Ht,{}),e(Dt,{children:n(he,{align:"stretch",spacing:6,children:[n(fe,{spacing:4,borderWidth:"1px",borderColor:$,borderRadius:"lg",p:4,children:[n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{isRequired:!0,children:[e(D,{children:o("inbounds.tag","Tag")}),e(nt,{...y("tag",{required:!0}),isDisabled:s==="edit"})]}),n(C,{children:[e(D,{children:o("inbounds.listen","Listen address")}),e(nt,{placeholder:"0.0.0.0",...y("listen")})]})]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{isRequired:!0,children:[e(D,{children:o("inbounds.port","Port")}),e(nt,{placeholder:"443",...y("port",{required:!0})})]}),n(C,{isRequired:!0,children:[e(D,{children:o("inbounds.protocol","Protocol")}),e(Xn,{...y("protocol",{required:!0}),isDisabled:s==="edit",children:Ha.map(te=>e("option",{value:te,children:te.toUpperCase()},te))})]})]}),f==="vmess"&&n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(gt,{...y("disableInsecureEncryption")})]}),f==="shadowsocks"&&n(C,{children:[e(D,{children:o("inbounds.shadowsocks.network","Allowed networks")}),e(nt,{...y("shadowsocksNetwork")})]}),f==="vless"&&n(fe,{spacing:3,children:[e(St,{control:S,name:"vlessSelectedAuth",render:({field:te})=>n(C,{children:[e(D,{children:o("inbounds.vless.authentication","Authentication")}),n(rt,{placeholder:o("inbounds.vless.authPlaceholder","Select authentication"),value:te.value||"",onChange:async ee=>{const Ne=ee.target.value;te.onChange(Ne),await Pe(Ne)},children:[e("option",{value:"",children:o("common.none","None")}),j.map(ee=>e("option",{value:ee.value,children:ee.label},ee.value))]})]})}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:o("inbounds.vless.decryption","Decryption")}),e(nt,{...y("vlessDecryption")})]}),n(C,{children:[e(D,{children:o("inbounds.vless.encryption","Encryption")}),e(nt,{...y("vlessEncryption")})]})]}),n(M,{spacing:3,children:[e(O,{size:"sm",onClick:Te,isLoading:m,isDisabled:!be,children:o("inbounds.vless.getKeys","Get new keys")}),e(O,{size:"sm",variant:"ghost",onClick:le,children:o("inbounds.vless.clearKeys","Clear")})]})]}),f==="http"&&n(fe,{spacing:3,children:[n(pt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("inbounds.http.accounts","HTTP accounts")}),e(O,{size:"xs",onClick:()=>A({user:"",pass:""}),children:o("inbounds.accounts.add","Add account")})]}),n(fe,{spacing:3,children:[W.map((te,ee)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:$,p:3,children:[n(pt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[o("inbounds.accounts.label","Account")," #",ee+1]}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>X(ee),children:o("hostsPage.delete","Delete")})]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("username","Username")}),e(nt,{...y(`httpAccounts.${ee}.user`)})]}),n(C,{children:[e(D,{children:o("password","Password")}),e(nt,{...y(`httpAccounts.${ee}.pass`)})]})]})]},te.id)),!W.length&&e(h,{fontSize:"sm",color:"gray.500",children:o("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.http.allowTransparent","Allow transparent proxy")}),e(gt,{...y("httpAllowTransparent")})]})]}),f==="socks"&&n(fe,{spacing:3,children:[n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.socks.udp","Enable UDP")}),e(gt,{...y("socksUdpEnabled")})]}),Ee&&n(C,{children:[e(D,{children:o("inbounds.socks.udpIp","UDP bind IP")}),e(nt,{...y("socksUdpIp"),placeholder:"127.0.0.1"})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.socks.auth","Require authentication")}),e(St,{control:S,name:"socksAuth",render:({field:te})=>e(gt,{isChecked:te.value==="password",onChange:ee=>te.onChange(ee.target.checked?"password":"noauth")})})]}),Ce==="password"&&n(fe,{spacing:3,children:[n(pt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("inbounds.socks.accounts","SOCKS accounts")}),e(O,{size:"xs",onClick:()=>ge({user:"",pass:""}),children:o("inbounds.accounts.add","Add account")})]}),q.map((te,ee)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:$,p:3,children:[n(pt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[o("inbounds.accounts.label","Account")," #",ee+1]}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>H(ee),children:o("hostsPage.delete","Delete")})]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("username","Username")}),e(nt,{...y(`socksAccounts.${ee}.user`)})]}),n(C,{children:[e(D,{children:o("password","Password")}),e(nt,{...y(`socksAccounts.${ee}.pass`)})]})]})]},te.id)),!q.length&&e(h,{fontSize:"sm",color:"gray.500",children:o("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),B&&n(fe,{spacing:4,borderWidth:"1px",borderColor:$,borderRadius:"lg",p:4,children:[n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:o("inbounds.network","Network")}),e(Xn,{...y("streamNetwork"),children:Wp.map(te=>e("option",{value:te,children:te},te))})]}),n(C,{children:[e(D,{children:o("inbounds.security","Security")}),e(Xn,{...y("streamSecurity"),children:Fp.map(te=>e("option",{value:te,children:te},te))})]})]}),ae==="ws"&&n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:o("inbounds.ws.path","WebSocket path")}),e(nt,{...y("wsPath"),placeholder:"/ws"})]}),n(C,{children:[e(D,{children:o("inbounds.ws.host","WebSocket host header")}),e(nt,{...y("wsHost")})]})]}),ae==="tcp"&&n(fe,{spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.tcp.headerType","TCP header type")}),n(Xn,{...y("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),Oe==="http"&&n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.tcp.host","HTTP host list")}),e(js,{...y("tcpHttpHosts"),placeholder:"example.com"})]}),n(C,{children:[e(D,{children:o("inbounds.tcp.path","HTTP path")}),e(nt,{...y("tcpHttpPath")})]})]})]}),ae==="grpc"&&n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.grpc.serviceName","Service name")}),e(nt,{...y("grpcServiceName")})]}),n(C,{children:[e(D,{children:o("inbounds.grpc.authority","Authority")}),e(nt,{...y("grpcAuthority")})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.grpc.multiMode","Multi mode")}),e(gt,{...y("grpcMultiMode")})]})]}),ae==="kcp"&&n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.kcp.headerType","mKCP header")}),e(nt,{...y("kcpHeaderType")})]}),n(C,{children:[e(D,{children:o("inbounds.kcp.seed","mKCP seed")}),e(nt,{...y("kcpSeed")})]})]}),ae==="quic"&&n(Fe,{columns:{base:1,md:3},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.quic.security","QUIC security")}),e(nt,{...y("quicSecurity")})]}),n(C,{children:[e(D,{children:o("inbounds.quic.key","QUIC key")}),e(nt,{...y("quicKey")})]}),n(C,{children:[e(D,{children:o("inbounds.quic.headerType","QUIC header type")}),e(nt,{...y("quicHeaderType")})]})]}),ae==="httpupgrade"&&n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.httpUpgrade.path","Path")}),e(nt,{...y("httpupgradePath")})]}),n(C,{children:[e(D,{children:o("inbounds.httpUpgrade.host","Host")}),e(nt,{...y("httpupgradeHost")})]})]}),ae==="splithttp"&&n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.splitHttp.path","Path")}),e(nt,{...y("splithttpPath")})]}),n(C,{children:[e(D,{children:o("inbounds.splitHttp.host","Host")}),e(nt,{...y("splithttpHost")})]})]}),ae==="xhttp"&&n(fe,{spacing:3,children:[n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.xhttp.host","Host")}),e(nt,{...y("xhttpHost"),placeholder:"example.com"})]}),n(C,{children:[e(D,{children:o("inbounds.xhttp.path","Path")}),e(nt,{...y("xhttpPath"),placeholder:"/"})]})]}),n(fe,{spacing:2,children:[n(pt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("inbounds.xhttp.headers","Custom headers")}),e(O,{size:"xs",onClick:()=>_({name:"",value:""}),children:o("inbounds.accounts.add","Add")})]}),oe.map((te,ee)=>n(M,{spacing:2,align:"flex-start",children:[e(C,{children:e(nt,{...y(`xhttpHeaders.${ee}.name`),placeholder:o("inbounds.xhttp.headerName","Header name")})}),e(C,{children:e(nt,{...y(`xhttpHeaders.${ee}.value`),placeholder:o("inbounds.xhttp.headerValue","Header value")})}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ye(ee),children:o("hostsPage.delete","Delete")})]},te.id))]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.xhttp.mode","Mode")}),e(Xn,{...y("xhttpMode"),children:rm.map(te=>e("option",{value:te,children:te},te))})]}),n(C,{children:[e(D,{children:o("inbounds.xhttp.paddingBytes","Padding bytes")}),e(nt,{...y("xhttpPaddingBytes"),placeholder:"100-1000"})]})]}),ve==="packet-up"&&n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.xhttp.maxBuffered","Max buffered upload")}),e(nt,{...y("xhttpScMaxBufferedPosts"),placeholder:"30"})]}),n(C,{children:[e(D,{children:o("inbounds.xhttp.maxUploadBytes","Max upload size (bytes)")}),e(nt,{...y("xhttpScMaxEachPostBytes"),placeholder:"1000000"})]})]}),ve==="stream-up"&&n(C,{children:[e(D,{children:o("inbounds.xhttp.streamUp","Stream-up server seconds")}),e(nt,{...y("xhttpScStreamUpServerSecs"),placeholder:"20-80"})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.xhttp.noSSE","Disable SSE header")}),e(gt,{...y("xhttpNoSSEHeader")})]})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.sockopt.enable","Enable sockopt")}),e(St,{control:S,name:"sockoptEnabled",render:({field:te})=>e(gt,{isChecked:Boolean(te.value),onChange:ee=>te.onChange(ee.target.checked)})})]}),e(_s,{in:Boolean(V),animateOpacity:!0,children:n(fe,{spacing:4,borderWidth:"1px",borderColor:$,borderRadius:"md",p:4,mt:2,children:[n(Fe,{columns:{base:1,md:2},spacing:3,children:[de("mark",o("inbounds.sockopt.routeMark","Route mark")),de("tcpKeepAliveInterval",o("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),de("tcpKeepAliveIdle",o("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),de("tcpMaxSeg",o("inbounds.sockopt.tcpMaxSeg","TCP max segment")),de("tcpUserTimeout",o("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),de("tcpWindowClamp",o("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[I("dialerProxy",o("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),I("interfaceName",o("inbounds.sockopt.interfaceName","Interface name"))]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.sockopt.domainStrategy","Domain strategy")}),e(St,{control:S,name:"sockopt.domainStrategy",render:({field:te})=>n(rt,{...te,children:[e("option",{value:"",children:o("common.none","None")}),jp.map(ee=>e("option",{value:ee,children:ee},ee))]})})]}),n(C,{children:[e(D,{children:o("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(St,{control:S,name:"sockopt.tcpcongestion",render:({field:te})=>n(rt,{...te,children:[e("option",{value:"",children:o("common.none","None")}),em.map(ee=>e("option",{value:ee,children:ee},ee))]})})]}),n(C,{children:[e(D,{children:o("inbounds.sockopt.tproxy","TProxy")}),e(St,{control:S,name:"sockopt.tproxy",render:({field:te})=>e(rt,{...te,children:tm.map(ee=>e("option",{value:ee,children:ee},ee))})})]})]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[k("acceptProxyProtocol",o("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),k("tcpFastOpen",o("inbounds.sockopt.tcpFastOpen","TCP fast open")),k("tcpMptcp",o("inbounds.sockopt.tcpMptcp","Multipath TCP")),k("penetrate",o("inbounds.sockopt.penetrate","Penetrate")),k("V6Only",o("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),K==="tls"&&n(fe,{spacing:4,borderWidth:"1px",borderColor:$,borderRadius:"lg",p:4,children:[n(C,{children:[e(D,{children:o("inbounds.tls.serverName","Server name (SNI)")}),e(nt,{...y("tlsServerName"),placeholder:"example.com"})]}),n(C,{children:[e(D,{children:o("inbounds.tls.fingerprint","uTLS fingerprint")}),n(Xn,{...y("tlsFingerprint"),children:[e("option",{value:"",children:o("common.none","None")}),Op.map(te=>e("option",{value:te,children:te},te))]})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.tls.allowInsecure","Allow insecure")}),e(gt,{...y("tlsAllowInsecure")})]})]}),K==="reality"&&n(fe,{spacing:4,borderWidth:"1px",borderColor:$,borderRadius:"lg",p:4,children:[n(C,{isRequired:!0,children:[e(D,{children:o("inbounds.reality.privateKey","Reality private key")}),e(js,{rows:3,...y("realityPrivateKey",{required:!0})}),e(O,{size:"xs",mt:2,variant:"outline",onClick:Se,alignSelf:"flex-start",children:o("inbounds.reality.generateKeys","Generate key pair")})]}),n(C,{children:[e(D,{children:o("inbounds.reality.publicKey","Reality public key")}),e(nt,{value:N,isReadOnly:!0,placeholder:o("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:o("inbounds.reality.serverNames","Server names")}),e(js,{rows:2,...y("realityServerNames"),placeholder:"domain.com"}),e(z,{fontSize:"sm",color:"gray.500",children:o("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),n(C,{children:[e(D,{children:o("inbounds.reality.dest","Destination (host:port)")}),e(nt,{...y("realityDest"),placeholder:"example.com:443"})]})]}),n(C,{children:[e(D,{children:o("inbounds.reality.shortIds","Short IDs")}),e(js,{rows:2,...y("realityShortIds")}),e(O,{size:"xs",mt:2,variant:"outline",onClick:Je,alignSelf:"flex-start",children:o("inbounds.reality.generateShortId","Generate short ID")}),e(z,{fontSize:"sm",color:"gray.500",children:o("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:o("inbounds.reality.spiderX","SpiderX")}),e(nt,{...y("realitySpiderX")})]}),n(C,{children:[e(D,{children:o("inbounds.reality.xver","Xver")}),e(nt,{...y("realityXver")})]})]})]}),R&&n(fe,{spacing:3,borderWidth:"1px",borderColor:$,borderRadius:"lg",p:4,children:[n(pt,{align:"center",justify:"space-between",children:[e(z,{fontWeight:"medium",children:o("inbounds.fallbacks","Fallbacks")}),e(O,{size:"xs",onClick:Z,children:o("inbounds.fallbacks.add","Add fallback")})]}),L.length===0?e(h,{fontSize:"sm",color:"gray.500",children:o("inbounds.fallbacks.empty","No fallbacks configured yet.")}):L.map((te,ee)=>n(z,{borderWidth:"1px",borderRadius:"md",borderColor:$,p:3,children:[n(pt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[o("inbounds.fallbacks.type","Fallback")," #",ee+1]}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>P(ee),children:o("hostsPage.delete","Delete")})]}),n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.fallbacks.dest","Destination (host:port)")}),e(nt,{placeholder:"example.com:443",...y(`fallbacks.${ee}.dest`)})]}),n(C,{children:[e(D,{children:o("inbounds.fallbacks.path","Path")}),e(nt,{...y(`fallbacks.${ee}.path`),placeholder:"/"})]}),n(C,{children:[e(D,{children:o("inbounds.fallbacks.type","Type")}),e(nt,{...y(`fallbacks.${ee}.type`),placeholder:"none"})]}),n(C,{children:[e(D,{children:o("inbounds.fallbacks.alpn","ALPN")}),e(nt,{...y(`fallbacks.${ee}.alpn`),placeholder:"h2,http/1.1"})]}),n(C,{children:[e(D,{children:"Xver"}),e(nt,{...y(`fallbacks.${ee}.xver`),placeholder:"0"})]})]})]},te.id))]}),n(fe,{spacing:4,borderWidth:"1px",borderColor:$,borderRadius:"lg",p:4,children:[n(pt,{align:"center",justify:"space-between",children:[n(M,{spacing:2,children:[e(z,{fontWeight:"medium",children:o("inbounds.sniffing","Sniffing")}),e(mt,{label:o("inbounds.sniffingHint","It is recommended to keep the default."),children:e(xl,{width:16,height:16})})]}),e(gt,{...y("sniffingEnabled")})]}),xe&&n(fe,{spacing:3,children:[n(C,{children:[e(D,{children:o("inbounds.sniffingDestinations","Protocols to sniff")}),e(St,{control:S,name:"sniffingDestinations",render:({field:te})=>{var ee;return e(Ei,{value:(ee=te.value)!=null?ee:[],onChange:te.onChange,children:e(M,{spacing:4,children:Lp.map(Ne=>e(Er,{value:Ne.value,children:Ne.label},Ne.value))})})}})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.sniffingRouteOnly","Route only")}),e(gt,{...y("sniffingRouteOnly")})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("inbounds.sniffingMetadataOnly","Metadata only")}),e(gt,{...y("sniffingMetadataOnly")})]})]})]})]})}),n(Ut,{children:[e(O,{variant:"ghost",mr:3,onClick:a,children:o("hostsPage.cancel","Cancel")}),e(O,{colorScheme:"primary",isLoading:l,onClick:v(Ae),children:s==="create"?o("common.create","Create"):o("common.save","Save")})]})]})]})},sm=()=>{const{t}=qe(),s=er(),[r,l]=d.exports.useState([]),[a,i]=d.exports.useState(!0),[o,c]=d.exports.useState(!1),[u,p]=d.exports.useState(null),[m,g]=d.exports.useState({protocol:"all",search:""}),[x,S]=d.exports.useState(null),{isOpen:y,onOpen:v,onClose:E}=Zt(),[T,L]=d.exports.useState("create"),ce=Tr({base:!1,md:!0}),P=d.exports.useCallback(()=>{i(!0),p(null),ze("/inbounds/full").then(H=>{l(H||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>i(!1))},[t]);d.exports.useEffect(()=>{P()},[P]);const W=d.exports.useMemo(()=>{const H=m.search.trim().toLowerCase();return r.filter(oe=>{var _;return m.protocol!=="all"&&oe.protocol!==m.protocol?!1:H?oe.tag.toLowerCase().includes(H)||((_=oe.port)==null?void 0:_.toString().includes(H)):!0})},[r,m]),A=()=>{L("create"),S(null),v()},X=H=>{L("edit"),S(H),v()},q=async H=>{var oe;c(!0);try{const _=qp(H),ye=T==="create"?"/inbounds":`/inbounds/${encodeURIComponent(_.tag)}`;await ze(ye,{method:T==="create"?"POST":"PUT",body:_}),s({status:"success",title:T==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),ci(),await P(),E()}catch(_){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((oe=_==null?void 0:_.data)==null?void 0:oe.detail)||(_==null?void 0:_.message)})}finally{c(!1)}},ge=async H=>{var _;const oe=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:H.tag});if(!!window.confirm(oe)){c(!0);try{await ze(`/inbounds/${encodeURIComponent(H.tag)}`,{method:"DELETE"}),s({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),ci(),await P()}catch(ye){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((_=ye==null?void 0:ye.data)==null?void 0:_.detail)||(ye==null?void 0:ye.message)})}finally{c(!1)}}};return n(fe,{spacing:4,children:[n(pt,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(De,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:m.search,onChange:H=>g(oe=>({...oe,search:H.target.value}))}),n(M,{spacing:3,children:[n(rt,{width:"180px",value:m.protocol,onChange:H=>g(oe=>({...oe,protocol:H.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),Ha.map(H=>e("option",{value:H,children:H.toUpperCase()},H))]}),e(O,{leftIcon:e(Pn,{width:18,height:18}),onClick:A,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&n(Wr,{status:"error",children:[e(Fr,{}),u]}),a?e(pt,{justify:"center",py:10,children:e(Rt,{})}):W.length===0?e(z,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):ce?e(z,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:n(ns,{variant:"simple",size:"sm",children:[e(fn,{bg:"gray.50",_dark:{bg:"gray.900"},children:n(zt,{children:[e($e,{children:t("inbounds.tag","Tag")}),e($e,{children:t("inbounds.protocol","Protocol")}),e($e,{children:t("inbounds.portLabel","Port")}),e($e,{children:t("inbounds.network","Network")}),e($e,{children:t("inbounds.security","Security")}),e($e,{children:t("inbounds.sniffing","Sniffing")}),e($e,{width:"120px",children:t("actions","Actions")})]})}),e(sn,{children:W.map(H=>{var _;const oe=H.streamSettings||{};return n(zt,{children:[n(Ue,{children:[e(h,{fontWeight:"semibold",children:H.tag}),H.listen&&e(h,{fontSize:"sm",color:"gray.500",children:H.listen})]}),e(Ue,{children:e(lt,{colorScheme:"purple",children:H.protocol})}),e(Ue,{children:H.port}),e(Ue,{children:oe.network||"\u2014"}),e(Ue,{children:oe.security&&oe.security!=="none"?e(lt,{colorScheme:"blue",children:oe.security}):"\u2014"}),e(Ue,{children:(_=H.sniffing)!=null&&_.enabled?e(lt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(lt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Ue,{children:n(M,{spacing:2,children:[e(He,{"aria-label":t("common.edit","Edit"),icon:e(Fn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>X(H)}),e(He,{"aria-label":t("common.delete","Delete"),icon:e(Sn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ge(H),isLoading:o})]})})]},H.tag)})})]})}):e(fe,{spacing:3,children:W.map(H=>{var _;const oe=H.streamSettings||{};return n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(pt,{justify:"space-between",align:"center",mb:2,children:[n(z,{children:[e(h,{fontWeight:"semibold",children:H.tag}),n(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",H.port]})]}),n(M,{spacing:2,children:[e(He,{"aria-label":t("common.edit","Edit"),icon:e(Fn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>X(H)}),e(He,{"aria-label":t("common.delete","Delete"),icon:e(Sn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>ge(H),isLoading:o})]})]}),n(fe,{spacing:2,children:[n(M,{spacing:2,wrap:"wrap",children:[e(lt,{colorScheme:"purple",children:H.protocol}),oe.network&&e(lt,{children:oe.network}),oe.security&&oe.security!=="none"&&e(lt,{colorScheme:"blue",children:oe.security})]}),n(M,{spacing:2,wrap:"wrap",children:[(_=H.sniffing)!=null&&_.enabled?e(lt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(lt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),H.listen&&e(lt,{size:"sm",colorScheme:"gray",children:H.listen})]})]})]},H.tag)})}),e(nm,{isOpen:y,mode:T,initialValue:x,isSubmitting:o,onClose:E,onSubmit:q})]})},im=()=>{var a;const{t}=qe(),{userData:s,getUserIsSuccess:r}=hr();return r&&Boolean((a=s.permissions)==null?void 0:a.sections.hosts)?n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),n(cs,{colorScheme:"primary",isLazy:!0,children:[n(ds,{children:[e(Xt,{children:n(M,{spacing:2,children:[e(ti,{as:wl,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e(Xt,{children:n(M,{spacing:2,children:[e(ti,{as:cl,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),n(us,{children:[e(Qt,{px:0,children:n(he,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(sm,{})]})}),e(Qt,{px:0,children:n(he,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Ep,{})]})})]})]})]}):n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("hostsPage.noPermission","You do not have permission to manage host or inbound settings.")})]})},am=ke.object({name:ke.string().min(1),address:ke.string().min(1),port:ke.number().min(1).or(ke.string().transform(t=>parseFloat(t))),api_port:ke.number().min(1).or(ke.string().transform(t=>parseFloat(t))),xray_version:ke.string().nullable().optional(),node_service_version:ke.string().nullable().optional(),id:ke.number().nullable().optional(),status:ke.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:ke.string().nullable().optional(),add_as_new_host:ke.boolean().optional(),usage_coefficient:ke.number().or(ke.string().transform(t=>parseFloat(t))),data_limit:ke.number().nullable().optional(),uplink:ke.number().nullable().optional(),downlink:ke.number().nullable().optional(),use_nobetci:ke.boolean().optional(),nobetci_port:ke.number().nullable().optional()}),ki=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",node_service_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,nobetci_port:null}),Ar="fetch-nodes-query-key",Ba=()=>{const{isEditingNodes:t}=Tt();return Rr({queryKey:Ar,queryFn:Si.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Si=zs((t,s)=>({nodes:[],addNode(r){return ze("/node",{method:"POST",body:r})},fetchNodes(){return ze("/nodes")},fetchNodesUsage(r){return ze("/nodes/usage",{query:r})},updateNode(r){return ze(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return ze(`/node/${r.id}/reconnect`,{method:"POST"})},restartNodeService(r){return ze(`/node/${r.id}/service/restart`,{method:"POST"})},updateNodeService(r){return ze(`/node/${r.id}/service/update`,{method:"POST"})},resetNodeUsage(r){return ze(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return ze("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return ze("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return ze(`/node/${(r=s().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),zo=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:a})=>{const{t:i}=qe(),o=$i(t),c=es[s].icon;return n(Bt,{children:[n(Br,{colorScheme:es[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[s&&i(`nodeModal.status.${s}`),a&&`: ${a}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(o.status,{time:o.time})})]})},om=ie(ii,{baseStyle:{w:4,h:4}}),lm=ie(Ra,{baseStyle:{w:4,h:4}}),cm=ie(Sd,{baseStyle:{w:4,h:4}}),dm=ie(za,{baseStyle:{w:4,h:4}}),Ro=1024*1024*1024,um=51031,Yn=t=>{if(t&&typeof t=="object"&&"message"in t){const s=t.message;return typeof s=="string"?s:void 0}},Mo=({isOpen:t,onClose:s,node:r,mutate:l,isLoading:a,isAddMode:i=!1})=>{var ye,f,ae,K,xe,Re,Oe,V,be,Ce,Ee,ve,B,U,j,de,k;const{t:o}=qe(),c=er(),[u,p]=d.exports.useState(i),{fetchNodesUsage:m}=Si(),[g,x]=d.exports.useState(null),{data:S,isLoading:y}=Rr({queryKey:"node-settings",queryFn:()=>ze("/node/settings")}),{data:v}=Rr({queryKey:"panel-settings",queryFn:Fa,staleTime:5*60*1e3}),E=(ye=v==null?void 0:v.use_nobetci)!=null?ye:!0,T=I=>{if(I==null)return null;const R=I/Ro;return Number.isFinite(R)?Math.round(R*100)/100:null},L=I=>I==null?null:Math.round(I*Ro),ce=i?{...ki(),add_as_new_host:!1}:{...ki(),...r,add_as_new_host:!1},P=jr({resolver:Fi(am),defaultValues:{...ce,data_limit:T((f=ce.data_limit)!=null?f:null)}}),W=(ae=S==null?void 0:S.certificate)!=null?ae:"",{onCopy:A,hasCopied:X}=Pl(W),q=P.watch("use_nobetci");d.exports.useEffect(()=>{if(!E||!q){P.getValues("nobetci_port")!==null&&P.setValue("nobetci_port",null);return}const I=P.getValues("nobetci_port");(I==null||I==="")&&P.setValue("nobetci_port",um)},[q,P,E]),d.exports.useEffect(()=>{v&&!v.use_nobetci&&(P.getValues("use_nobetci")&&P.setValue("use_nobetci",!1),P.getValues("nobetci_port")!==null&&P.setValue("nobetci_port",null))},[v,P]),d.exports.useEffect(()=>{var I;if(t){const R=i?{...ki(),add_as_new_host:!1}:{...ki(),...r,add_as_new_host:!1};P.reset({...R,data_limit:T((I=R.data_limit)!=null?I:null)}),p(i&&!!W)}},[t,i,r,P,W]),d.exports.useEffect(()=>{!i&&r&&t?m({start:Me().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(I=>{const R=I.usages[r.id];R&&x({uplink:R.uplink,downlink:R.downlink})}):x(null)},[r,i,t,m]);const ge=P.handleSubmit(I=>{var $;const R={...I,data_limit:L(($=I.data_limit)!=null?$:null)};l(R)}),H=()=>{!W||(A(),c({title:o("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},oe=()=>{if(!W)return;const I=new Blob([W],{type:"text/plain"}),R=URL.createObjectURL(I),$=document.createElement("a");$.href=R,$.download="ssl_client_cert.pem",$.click(),URL.revokeObjectURL(R)},_=()=>{p(!1),x(null),s()};return n(Wt,{isOpen:t,onClose:_,size:"lg",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",as:"form",onSubmit:ge,children:[e(It,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:o(i?"nodes.addNewRebeccaNode":"nodes.editNode")})}),e(Ht,{mt:3}),e(Dt,{children:n(fe,{spacing:6,children:[!i&&g&&n(fe,{spacing:2,children:[e(h,{fontWeight:"medium",children:o("nodes.usage")}),n(M,{children:[n(lt,{colorScheme:"green",children:[o("nodes.uplink"),": ",Qn.sizeFormat(g.uplink)]}),n(lt,{colorScheme:"blue",children:[o("nodes.downlink"),": ",Qn.sizeFormat(g.downlink)]})]})]}),i&&n(fe,{spacing:3,children:[n(M,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:o("nodes.certificate")}),n(M,{spacing:2,children:[e(O,{size:"xs",variant:"outline",leftIcon:e(cm,{}),onClick:H,isDisabled:!W,children:o(X?"copied":"copy")}),e(O,{size:"xs",variant:"outline",leftIcon:e(dm,{}),onClick:oe,isDisabled:!W,children:o("nodes.download-certificate")}),e(mt,{placement:"top",label:o(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(He,{"aria-label":o(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p(I=>!I),size:"xs",variant:"ghost",children:u?e(lm,{}):e(om,{})})})]})]}),e(_s,{in:u&&!!W,animateOpacity:!0,children:e(z,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:W||(y?o("loading"):"")})}),!W&&!y&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.certificateUnavailable","Certificate not available.")})]}),n(fe,{spacing:4,children:[n(Fe,{columns:{base:1,md:2},spacing:4,children:[e(C,{children:e(or,{label:o("nodes.nodeName"),size:"sm",placeholder:"Rebecca-S2",...P.register("name"),error:Yn((xe=(K=P.formState)==null?void 0:K.errors)==null?void 0:xe.name)})}),e(C,{children:e(or,{label:o("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...P.register("address"),error:Yn((Oe=(Re=P.formState)==null?void 0:Re.errors)==null?void 0:Oe.address)})})]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[e(C,{children:e(or,{label:o("nodes.nodePort"),size:"sm",placeholder:"62050",...P.register("port"),error:Yn((be=(V=P.formState)==null?void 0:V.errors)==null?void 0:be.port)})}),e(C,{children:e(or,{label:o("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...P.register("api_port"),error:Yn((Ee=(Ce=P.formState)==null?void 0:Ce.errors)==null?void 0:Ee.api_port)})})]}),e(C,{children:e(or,{label:o("nodes.usageCoefficient"),size:"sm",placeholder:"1",...P.register("usage_coefficient"),error:Yn((B=(ve=P.formState)==null?void 0:ve.errors)==null?void 0:B.usage_coefficient)})}),n(C,{children:[e(or,{label:o("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:o("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...P.register("data_limit",{setValueAs:I=>{if(I===""||I===null||I===void 0)return null;const R=Number(I);return Number.isFinite(R)?R:Number.NaN},validate:I=>I==null?!0:Number.isNaN(I)?o("nodes.dataLimitValidation","Data limit must be a valid number"):I>=0||o("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:Yn((j=(U=P.formState)==null?void 0:U.errors)==null?void 0:j.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:o("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),E&&n(Bt,{children:[n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:0,children:o("nodes.useNobetci","Enable Nobetci integration")}),e(St,{control:P.control,name:"use_nobetci",render:({field:I})=>e(gt,{isChecked:Boolean(I.value),onChange:R=>I.onChange(R.target.checked)})})]}),e(_s,{in:Boolean(q),animateOpacity:!0,children:n(C,{mt:q?2:0,children:[e(or,{label:o("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...P.register("nobetci_port",{setValueAs:I=>{if(I===""||I===null||I===void 0)return null;const R=Number(I);return Number.isFinite(R)?R:Number.NaN},validate:I=>q?I==null?o("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(I)?o("nodes.nobetciPortInvalid","Enter a valid port number"):I>=1&&I<=65535?!0:o("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:Yn((k=(de=P.formState)==null?void 0:de.errors)==null?void 0:k.nobetci_port)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:o("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]})]}),i&&e(z,{children:e(Er,{...P.register("add_as_new_host"),children:o("nodes.addHostForEveryInbound")})})]})}),n(Ut,{gap:3,children:[e(O,{variant:"outline",onClick:_,children:o("cancel")}),e(O,{type:"submit",colorScheme:"primary",isLoading:a,children:o(i?"nodes.addNode":"nodes.editNode")})]})]})]})},hm=({deleteCallback:t})=>{const{deleteNode:s,deletingNode:r,setDeletingNode:l}=Si(),{t:a}=qe(),i=er(),o=Oa(),c=()=>{l(null)},{isLoading:u,mutate:p}=Lr(s,{onSuccess:()=>{Yt(a("deleteNode.deleteSuccess",{name:r&&r.name}),i),l(null),o.invalidateQueries(Ar),t&&t()},onError:m=>{Kt(m,i)}});return n(Wt,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",children:[e(It,{pt:6,children:e(ss,{color:"red",children:e(gi,{})})}),e(Ht,{mt:3}),n(Dt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:a("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(Bi,{components:{b:e("b",{})},children:a("deleteNode.prompt",{name:r.name})})})]}),n(Ut,{display:"flex",children:[e(O,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:a("cancel")}),e(O,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:u?e(Rt,{size:"xs"}):void 0,children:a("delete")})]})]})]})},pm=10,mm=({isOpen:t,title:s,description:r,currentVersion:l,allowPersist:a=!1,isSubmitting:i,onSubmit:o,onClose:c})=>{const{t:u}=qe(),[p,m]=d.exports.useState(""),[g,x]=d.exports.useState(!1),[S,y]=d.exports.useState(null),v=Rr(["core-xray-releases"],()=>ze("/core/xray/releases",{query:{limit:pm}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(m(l||""),x(!1),y(null))},[t,l]);const E=d.exports.useMemo(()=>{var W,A;return(A=(W=v.data)==null?void 0:W.tags)!=null?A:[]},[v.data]),T=W=>{m(W.target.value)},L=W=>{m(W.target.value)},ce=async()=>{if(!p){y(u("validation.required"));return}try{y(null),await o({version:p,persist:a?g:void 0})}catch(W){W instanceof Error?y(W.message):y(u("core.generalErrorMessage"))}},P=v.isLoading;return n(Wt,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(_t,{}),n(Ft,{children:[e(It,{children:s}),e(Ht,{}),e(Dt,{children:n(fe,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),n(C,{children:[e(D,{children:u("nodes.coreVersionDialog.latestReleases")}),e(rt,{placeholder:u(P?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&E.includes(p)?p:"",onChange:T,isDisabled:P||E.length===0,size:"sm",children:E.map(W=>e("option",{value:W,children:W},W))}),P&&n(fe,{direction:"row",align:"center",spacing:2,mt:2,children:[e(Rt,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),v.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),n(C,{isRequired:!0,children:[e(D,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(De,{value:p,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:L,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),a&&e(Er,{isChecked:g,onChange:W=>x(W.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),S&&n(Wr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Fr,{}),e(Wn,{children:S})]})]})}),n(Ut,{children:[e(O,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(O,{colorScheme:"primary",onClick:ce,isLoading:i,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},Uo="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",gm=ie(Tl,{baseStyle:{w:3.5,h:3.5}}),fm=ie(Pn,{baseStyle:{w:3.5,h:3.5}}),bm=ie(on,{baseStyle:{w:4,h:4}}),ym=({isOpen:t,title:s,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:a,onSubmit:i,onClose:o})=>{const{t:c}=qe(),[u,p]=d.exports.useState("template"),[m,g]=d.exports.useState(Uo),[x,S]=d.exports.useState(""),[y,v]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[E,T]=d.exports.useState(!0),[L,ce]=d.exports.useState(!1),[P,W]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),g(a||Uo),S(""),v([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),T(!0),ce(!1),W(null))},[t,a]);const A=Rr(["geo-templates",m],()=>ze("/core/geo/templates",{query:m?{index_url:m}:void 0}),{enabled:t&&u==="template"&&Boolean(m),staleTime:10*60*1e3}),X=d.exports.useMemo(()=>{var f,ae;return(ae=(f=A.data)==null?void 0:f.templates)!=null?ae:[]},[A.data]);d.exports.useEffect(()=>{X.length>0&&S(f=>f||X[0].name)},[X]);const q=We("gray.50","whiteAlpha.50"),ge=()=>{v(f=>[...f,{name:"",url:""}])},H=(f,ae,K)=>{v(xe=>xe.map((Re,Oe)=>Oe===f?{...Re,[ae]:K}:Re))},oe=f=>{v(ae=>ae.filter((K,xe)=>xe!==f))},_=async()=>{const f=u==="manual"?y.filter(K=>K.name.trim()&&K.url.trim()):[];if(u==="template"){if(!m.trim()){W(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!x){W(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(f.length===0){W(c("nodes.geoDialog.errors.missingFiles"));return}if(f.find(xe=>!xe.name.trim()||!xe.url.trim())){W(c("nodes.geoDialog.errors.invalidFile"));return}}W(null);const ae=u==="manual"?f:[];try{await i({mode:u,templateIndexUrl:m.trim(),templateName:x,files:ae,persistEnv:E,applyToNodes:L})}catch(K){const xe=K instanceof Error?K.message:c("nodes.geoDialog.genericError");W(xe)}},ye=()=>n(fe,{spacing:3,bg:q,p:4,borderRadius:"md",children:[y.map((f,ae)=>n(z,{borderWidth:"1px",borderRadius:"md",p:3,children:[n(Fe,{columns:{base:1,md:2},spacing:3,children:[n(C,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(De,{size:"sm",value:f.name,placeholder:"geosite.dat",onChange:K=>H(ae,"name",K.target.value)})]}),n(C,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(De,{size:"sm",value:f.url,placeholder:"https://example.com/geosite.dat",onChange:K=>H(ae,"url",K.target.value)})]})]}),e(M,{justify:"flex-end",mt:3,children:e(mt,{label:c("nodes.geoDialog.removeFile"),children:e(He,{"aria-label":"remove file",icon:e(gm,{}),variant:"ghost",size:"sm",onClick:()=>oe(ae),isDisabled:y.length<=1})})})]},`manual-file-${ae}`)),e(O,{onClick:ge,leftIcon:e(fm,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return n(Wt,{isOpen:t,onClose:o,size:"xl",isCentered:!0,children:[e(_t,{}),n(Ft,{children:[e(It,{children:s}),e(Ht,{}),e(Dt,{children:n(fe,{spacing:4,children:[n(C,{as:"fieldset",children:[e(D,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(oi,{value:u,onChange:f=>p(f),children:n(M,{spacing:4,children:[e(Or,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Or,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?n(fe,{spacing:3,children:[n(C,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(De,{size:"sm",value:m,onChange:f=>g(f.target.value)})]}),n(C,{isRequired:!0,children:[e(D,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),n(M,{align:"center",spacing:2,children:[e(rt,{size:"sm",flex:1,value:x,onChange:f=>S(f.target.value),isDisabled:A.isLoading||!X.length,placeholder:A.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:X.map(f=>e("option",{value:f.name,children:f.name},f.name))}),e(mt,{label:c("nodes.geoDialog.refreshTemplates"),children:e(He,{"aria-label":"refresh templates",icon:e(bm,{}),size:"sm",variant:"outline",onClick:()=>A.refetch(),isLoading:A.isFetching,isDisabled:!m.trim()})})]})]}),A.isError&&n(Wr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Fr,{}),e(Wn,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):ye(),l&&n(fe,{spacing:2,children:[e(Er,{isChecked:E,onChange:f=>T(f.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(Er,{isChecked:L,onChange:f=>ce(f.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),P&&n(Wr,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Fr,{}),e(Wn,{children:P})]})]})}),n(Ut,{children:[e(O,{variant:"ghost",mr:3,onClick:o,children:c("cancel")}),e(O,{colorScheme:"primary",onClick:_,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};Me.extend(mi);const Sm=ie(Pn,{baseStyle:{w:4,h:4}}),xm=ie(Sn,{baseStyle:{w:4,h:4}}),vm=ie(Fn,{baseStyle:{w:4,h:4}}),Lo=ie(on,{baseStyle:{w:4,h:4}}),wm=ie(pl,{baseStyle:{w:4,h:4}}),nc=1024**3,km=t=>{if(t==null)return"";const s=t/nc;return Number.isFinite(s)?(Math.round(s*100)/100).toString():""},Oo=t=>{const s=t.trim();if(!s)return null;const r=Number(s);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*nc)},Cm=()=>{var Ms,Us,Ls,Os,b,w,se,Ze,it,je,Ct,Cr,Kn,zn;const{t}=qe(),{onEditingNodes:s}=Tt(),r=Tt(ue=>ue.isEditingNodes),{data:l,isLoading:a,error:i,refetch:o,isFetching:c}=Ba(),{addNode:u,updateNode:p,reconnectNode:m,restartNodeService:g,updateNodeService:x,resetNodeUsage:S,updateMasterNode:y,resetMasterUsage:v,setDeletingNode:E}=Si(),T=Oa(),L=er(),{userData:ce,getUserIsSuccess:P}=hr();if(!(P&&Boolean((Ms=ce.permissions)==null?void 0:Ms.sections.nodes)))return n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("nodes.title","Nodes")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.noPermission","You do not have permission to manage nodes.")})]});const[A,X]=d.exports.useState(null),[q,ge]=d.exports.useState(!1),[H,oe]=d.exports.useState(""),[_,ye]=d.exports.useState(null),[f,ae]=d.exports.useState(null),[K,xe]=d.exports.useState(null),[Re,Oe]=d.exports.useState(null),[V,be]=d.exports.useState(!1),[Ce,Ee]=d.exports.useState(!1),[ve,B]=d.exports.useState(!1),[U,j]=d.exports.useState(null),[de,k]=d.exports.useState({}),[I,R]=d.exports.useState(null),[$,Ae]=d.exports.useState(null),[Se,Je]=d.exports.useState(null),[N,Z]=d.exports.useState(null),{isOpen:F,onOpen:pe,onClose:Q}=Zt(),Pe=d.exports.useRef(null),[Te,le]=d.exports.useState(""),[Le,Ke]=d.exports.useState(!1),{isOpen:ne,onOpen:Ye,onClose:te}=Zt(),ee=d.exports.useRef(null),{data:Ne,isLoading:at,refetch:ot,error:yt}=Rr(["core-stats"],()=>ze("/core"),{refetchOnWindowFocus:!1}),{data:et,isLoading:Jt,error:qt,refetch:wt}=Rr(["master-node-state"],()=>ze("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(s(!0),()=>{s(!1)}),[s]),d.exports.useEffect(()=>{var ft,st;if(!et)return;if(Le){const vt=Oo(Te),Mt=(ft=et.data_limit)!=null?ft:null;if(vt!==Mt)return}const ue=km((st=et.data_limit)!=null?st:null);le(ue),Le&&Ke(!1)},[et,Le,Te]);const{isLoading:dt,mutate:lr}=Lr(u,{onSuccess:()=>{Yt(t("nodes.addNodeSuccess"),L),T.invalidateQueries(Ar),ge(!1)},onError:ue=>{Kt(ue,L)}}),{isLoading:Sr,mutate:pr}=Lr(p,{onSuccess:()=>{Yt(t("nodes.nodeUpdated"),L),T.invalidateQueries(Ar),X(null)},onError:ue=>{Kt(ue,L)}}),{isLoading:xr,mutate:cr}=Lr(m,{onSuccess:()=>{T.invalidateQueries(Ar)}}),{mutate:mr,isLoading:gr}=Lr(p,{onSuccess:()=>{T.invalidateQueries(Ar)},onError:ue=>{Kt(ue,L)},onSettled:(ue,ft,st)=>{(st==null?void 0:st.id)!=null&&k(vt=>{const Mt={...vt};return delete Mt[st.id],Mt}),j(null)}}),{isLoading:re,mutate:_e}=Lr(S,{onSuccess:()=>{Yt(t("nodes.resetUsageSuccess","Node usage reset"),L),T.invalidateQueries(Ar)},onError:ue=>{Kt(ue,L)},onSettled:()=>{R(null),Ae(null),Q()}}),{mutate:Y,isLoading:Ge}=Lr(g,{onMutate:ue=>{var ft;Je((ft=ue.id)!=null?ft:null)},onSuccess:()=>{Yt(t("nodes.restartServiceTriggered","Node restart requested"),L),T.invalidateQueries(Ar)},onError:ue=>{Kt(ue,L)},onSettled:()=>{Je(null)}}),{mutate:kt,isLoading:Vt}=Lr(x,{onMutate:ue=>{var ft;Z((ft=ue.id)!=null?ft:null)},onSuccess:()=>{Yt(t("nodes.updateServiceTriggered","Node update requested"),L),T.invalidateQueries(Ar)},onError:ue=>{Kt(ue,L)},onSettled:()=>{Z(null)}}),{isLoading:Et,mutate:Nt}=Lr(y,{onSuccess:()=>{Yt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),L),wt(),Ke(!1)},onError:ue=>{Kt(ue,L)}}),{isLoading:ut,mutate:ht}=Lr(v,{onSuccess:()=>{Yt(t("nodes.resetMasterUsageSuccess","Master usage reset"),L),wt(),te()},onError:ue=>{Kt(ue,L)}}),At=d.exports.useMemo(()=>Oo(Te),[Te]),rr=(Us=et==null?void 0:et.data_limit)!=null?Us:null,vr=At===void 0,Vr=At!==void 0&&At!==rr,G=at||Jt,Ie=d.exports.useMemo(()=>{if(yt instanceof Error)return yt.message;if(typeof yt=="string")return yt;if(qt instanceof Error)return qt.message;if(typeof qt=="string")return qt},[yt,qt]),Ve=(Ls=et==null?void 0:et.total_usage)!=null?Ls:0,Qe=(Os=et==null?void 0:et.data_limit)!=null?Os:null,xt=(b=et==null?void 0:et.remaining_data)!=null?b:null,Gt=et!=null&&et.updated_at?Me(et.updated_at).local().format("YYYY-MM-DD HH:mm"):null,fr=(w=et==null?void 0:et.status)!=null?w:"error",Mr=Be(Ve,2),dr=Qe!==null&&Qe>0?Be(Qe,2):t("nodes.unlimited","Unlimited"),wr=xt!=null?Be(xt,2):null,$r=ue=>{Ke(!0),le(ue)},vn=()=>{if(vr||At===void 0){Kt(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),L);return}Nt({data_limit:At!=null?At:null})},En=()=>{Ke(!0),le(""),Nt({data_limit:null})},Kr=()=>{Ye()},Jr=ue=>{if(!(ue!=null&&ue.id))return;const ft=ue.status!=="disabled",st=ft?"disabled":"connecting",vt=ue.id;j(vt),k(Mt=>({...Mt,[vt]:!ft})),mr({...ue,status:st})},we=ue=>{!(ue!=null&&ue.id)||(Ae(ue),pe())},qr=ue=>{if(!(ue!=null&&ue.id))return;const ft=ue.name||ue.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.restartServiceConfirm","Send a restart request to {{name}}? Services will be interrupted briefly.",{name:ft}))||Y(ue)},Yr=ue=>{if(!(ue!=null&&ue.id))return;const ft=ue.name||ue.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.updateServiceConfirm","Send an update request to {{name}}? The node will download updates and restart.",{name:ft}))||kt(ue)},kr=()=>{!($!=null&&$.id)||(R($.id),_e($))},ln=()=>{Ae(null),Q()},Gr=()=>ye(null),Lt=()=>ae(null),wn=async({version:ue,persist:ft})=>{var st;if(!!_){if(_.type==="master"){be(!0);try{await ze("/core/xray/update",{method:"POST",body:{version:ue,persist_env:Boolean(ft)}}),Yt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:ue}),L),await Promise.all([ot(),T.invalidateQueries(Ar)]),Gr()}catch(vt){Kt(vt,L)}finally{be(!1)}return}if(_.type==="bulk"){const vt=(l!=null?l:[]).filter(Mt=>Mt.id!=null&&Mt.status==="connected");if(vt.length===0){L({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}Ee(!0);try{const Mt=[];for(const Jn of vt)try{await ze(`/node/${Jn.id}/xray/update`,{method:"POST",body:{version:ue}}),Mt.push({status:"fulfilled",node:Jn})}catch(Gi){Mt.push({status:"rejected",node:Jn}),Kt(Gi,L)}const en=Mt.filter(Jn=>Jn.status==="fulfilled").length,pn=Mt.length-en,mn=Mt.length;en>0&&Yt(t("nodes.coreVersionDialog.bulkSuccess",{success:en,total:mn}),L),pn>0&&L({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:pn,total:mn}),status:"error",isClosable:!0,position:"top",duration:4e3}),T.invalidateQueries(Ar),Gr()}finally{Ee(!1)}return}if(_.type==="node"){const vt=_.node;if(!(vt!=null&&vt.id))return;xe(vt.id);try{await ze(`/node/${vt.id}/xray/update`,{method:"POST",body:{version:ue}}),Yt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(st=vt.name)!=null?st:t("nodes.unnamedNode","Unnamed node"),version:ue}),L),T.invalidateQueries(Ar),Gr()}catch(Mt){Kt(Mt,L)}finally{xe(null)}}}},$t=async ue=>{var st;if(!f)return;const ft={mode:ue.mode,template_index_url:ue.templateIndexUrl,template_name:ue.templateName,files:ue.files,persist_env:ue.persistEnv};if(f.type==="master"){B(!0);try{await ze("/core/geo/update",{method:"POST",body:ft}),Yt(t("nodes.geoDialog.masterUpdateSuccess"),L),Lt()}catch(vt){Kt(vt,L)}finally{B(!1)}return}if(f.type==="node"){const vt=f.node;if(!(vt!=null&&vt.id))return;Oe(vt.id);try{await ze(`/node/${vt.id}/geo/update`,{method:"POST",body:ft}),Yt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(st=vt.name)!=null?st:t("nodes.unnamedNode","Unnamed node")}),L),T.invalidateQueries(Ar),Lt()}catch(Mt){Kt(Mt,L)}finally{Oe(null)}}},cn=d.exports.useMemo(()=>{if(!l)return[];const ue=H.trim().toLowerCase();return ue?l.filter(ft=>{var en,pn,mn;const st=((en=ft.name)!=null?en:"").toLowerCase(),vt=((pn=ft.address)!=null?pn:"").toLowerCase(),Mt=((mn=ft.xray_version)!=null?mn:"").toLowerCase();return st.includes(ue)||vt.includes(ue)||Mt.includes(ue)}):l},[l,H]),dn=d.exports.useMemo(()=>(l!=null?l:[]).some(ue=>ue.id!=null&&ue.status==="connected"),[l]),un=d.exports.useMemo(()=>{if(!!i){if(i instanceof Error)return i.message;if(typeof i=="string")return i;if(typeof i=="object"&&"message"in i){const ue=i.message;if(typeof ue=="string")return ue}return t("errorOccurred")}},[i,t]),hn=Boolean(un),Nn=t("nodes.masterNode","Master"),kn=H.trim().toLowerCase(),Ki=!kn||Nn.toLowerCase().includes(kn)||((se=Ne==null?void 0:Ne.version)!=null?se:"").toLowerCase().includes(kn),Cn=(_==null?void 0:_.type)==="master"?V:(_==null?void 0:_.type)==="node"?_.node.id!=null&&K===_.node.id:(_==null?void 0:_.type)==="bulk"?Ce:!1,hs=(f==null?void 0:f.type)==="master"?ve:(f==null?void 0:f.type)==="node"?f.node.id!=null&&Re===f.node.id:!1,Ji=(_==null?void 0:_.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(_==null?void 0:_.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(_==null?void 0:_.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Ze=_.node.name)!=null?Ze:t("nodes.unnamedNode","Unnamed node")}):"",qi=(_==null?void 0:_.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(_==null?void 0:_.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(_==null?void 0:_.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(it=_.node.name)!=null?it:t("nodes.unnamedNode","Unnamed node")}):"",Yi=(_==null?void 0:_.type)==="master"?(je=Ne==null?void 0:Ne.version)!=null?je:"":(_==null?void 0:_.type)==="node"&&(Ct=_.node.xray_version)!=null?Ct:"",xi=(f==null?void 0:f.type)==="master"?t("nodes.geoDialog.masterTitle"):(f==null?void 0:f.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(Cr=f.node.name)!=null?Cr:t("nodes.unnamedNode","Unnamed node")}):"";return n(he,{spacing:6,align:"stretch",children:[n(fe,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),hn&&n(Wr,{status:"error",borderRadius:"md",children:[e(Fr,{}),e(Wn,{children:un})]}),n(fe,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),n(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[n(M,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[n(Nr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(ml,{pointerEvents:"none",children:e(wm,{color:"gray.400"})}),e(De,{value:H,onChange:ue=>oe(ue.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(mt,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(He,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(Lo,{}),variant:"ghost",size:"sm",onClick:()=>o(),isLoading:c})})]}),n(fe,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(O,{variant:"outline",size:"sm",onClick:()=>ye({type:"bulk"}),isDisabled:!dn,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(O,{leftIcon:e(Sm,{}),colorScheme:"primary",size:"sm",onClick:()=>ge(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),a?e(Fe,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((ue,ft)=>e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:n(he,{spacing:3,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${ft}`))}):n(Fe,{columns:{base:1,md:2,xl:3},spacing:4,children:[Ki&&e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:G?n(he,{spacing:3,align:"center",justify:"center",children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Ie?n(he,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Ie}),e(O,{size:"sm",variant:"outline",onClick:()=>{ot(),wt()},children:t("refresh","Refresh")})]}):et?n(he,{align:"stretch",spacing:4,children:[n(fe,{spacing:2,children:[n(M,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:Nn}),e(lt,{colorScheme:"purple",size:"sm",children:Ne!=null&&Ne.version?`Xray ${Ne.version}`:t("nodes.versionUnknown","Version unknown")})]}),n(M,{spacing:2,align:"center",children:[e(zo,{status:fr,compact:!0}),et.limit_exceeded&&e(lt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Ne!=null&&Ne.started?t("nodes.masterStartedAt",{date:Me(Ne.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),et.message&&n(Wr,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(Fr,{}),e(Wn,{fontSize:"sm",children:et.message})]}),e(On,{}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Mr})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:dr})]}),wr&&n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:wr})]}),Gt&&n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:Gt})]})]}),n(fe,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[n(Nr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(De,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:Te,onChange:ue=>$r(ue.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(Hr,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(O,{colorScheme:"primary",size:"sm",onClick:vn,isDisabled:!Vr||vr||Et,isLoading:Et,children:t("save","Save")}),e(O,{variant:"ghost",size:"sm",onClick:En,isDisabled:Qe===null||Et,isLoading:Et&&Qe===null,children:t("nodes.clearDataLimit","Clear limit")})]}),vr&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),n(fe,{direction:{base:"column",sm:"row"},spacing:2,children:[e(O,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>ye({type:"master"}),isLoading:V,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(O,{size:"sm",variant:"outline",onClick:()=>ae({type:"master"}),isLoading:ve,children:t("nodes.geoDialog.updateMasterButton")}),e(O,{size:"sm",variant:"outline",colorScheme:"red",onClick:Kr,isLoading:ut,children:t("nodes.resetUsage","Reset usage")})]})]}):n(he,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(O,{size:"sm",variant:"outline",onClick:()=>{ot(),wt()},children:t("refresh","Refresh")})]})},"master-node"),cn.length>0?cn.map(ue=>{var $a,Ka,Ja,qa;const ft=ue.status||"error",st=ue==null?void 0:ue.id,vt=ft!=="disabled"&&ft!=="limited",Mt=st!=null?de[st]:void 0,en=Mt!=null?Mt:vt,pn=st!=null&&U===st&&gr,mn=st!=null&&K===st,Jn=st!=null&&Re===st,Gi=Ge&&st!=null&&Se===st,cc=Vt&&st!=null&&N===st,Va=e(zo,{status:ft,compact:!0}),dc=ft==="error"&&ue.message?e(mt,{label:ue.message,hasArrow:!0,placement:"top",openDelay:300,children:e(z,{as:"span",children:Va})}):Va;return e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:n(he,{align:"stretch",spacing:4,children:[n(fe,{spacing:2,children:[n(M,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:ue.name||t("nodes.unnamedNode","Unnamed node")}),e(gt,{size:"sm",colorScheme:"primary",isChecked:en,onChange:()=>Jr(ue),isDisabled:pn,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),ue.status==="error"&&e(O,{size:"sm",variant:"outline",leftIcon:e(Lo,{}),onClick:()=>cr(ue),isLoading:xr,children:t("nodes.reconnect")})]}),n(M,{spacing:2,flexWrap:"wrap",children:[dc,n(M,{spacing:1,align:"center",children:[e(lt,{colorScheme:"blue",size:"sm",children:ue.xray_version?`Xray ${ue.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(lt,{colorScheme:"green",size:"sm",children:ue.node_service_version?t("nodes.nodeServiceVersionTag",{version:ue.node_service_version}):t("nodes.nodeServiceVersionUnknown","Node version unknown")}),e(O,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>st&&ye({type:"node",node:ue}),isLoading:mn,isDisabled:!st,children:t("nodes.updateCoreAction")})]}),e(O,{size:"xs",variant:"ghost",onClick:()=>st&&ae({type:"node",node:ue}),isLoading:Jn,isDisabled:!st,children:t("nodes.updateGeoAction","Update geo")}),e(O,{size:"xs",variant:"ghost",colorScheme:"orange",onClick:()=>qr(ue),isLoading:Gi,isDisabled:!st,children:t("nodes.restartServiceAction","Restart node service")}),e(O,{size:"xs",variant:"ghost",colorScheme:"teal",onClick:()=>Yr(ue),isLoading:cc,isDisabled:!st,children:t("nodes.updateServiceAction","Update node service")}),e(O,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>we(ue),isLoading:re&&st!=null&&I===st,isDisabled:!st,children:t("nodes.resetUsage","Reset usage")})]}),ft==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(On,{}),n(Fe,{columns:{base:1,sm:2},spacingY:2,children:[n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:ue.address})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:ue.port})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:ue.api_port})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:ue.usage_coefficient})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Be((($a=ue.uplink)!=null?$a:0)+((Ka=ue.downlink)!=null?Ka:0),2)})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:ue.data_limit!=null&&ue.data_limit>0?Be(ue.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(On,{}),n(M,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[n(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(Ja=ue.id)!=null?Ja:"-"]}),n(fl,{size:"sm",variant:"ghost",children:[e(He,{"aria-label":t("edit"),icon:e(vm,{}),onClick:()=>X(ue)}),e(He,{"aria-label":t("delete"),icon:e(xm,{}),colorScheme:"red",onClick:()=>E(ue)})]})]})]})},(qa=ue.id)!=null?qa:ue.name)}):e(z,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(mm,{isOpen:Boolean(_),onClose:Gr,onSubmit:wn,currentVersion:Yi,title:Ji,description:qi,allowPersist:(_==null?void 0:_.type)==="master",isSubmitting:Cn}),e(ym,{isOpen:Boolean(f),onClose:Lt,onSubmit:$t,title:xi,showMasterOptions:(f==null?void 0:f.type)==="master",isSubmitting:hs}),e(Ds,{isOpen:F,leastDestructiveRef:Pe,onClose:ln,children:e(_t,{children:n(As,{children:[e(It,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(Dt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(zn=(Kn=$==null?void 0:$.name)!=null?Kn:$==null?void 0:$.address)!=null?zn:t("nodes.thisNode","this node")})}),n(Ut,{children:[e(O,{ref:Pe,onClick:ln,children:t("cancel","Cancel")}),e(O,{colorScheme:"red",onClick:kr,ml:3,isLoading:re,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Ds,{isOpen:ne,leastDestructiveRef:ee,onClose:te,children:e(_t,{children:n(As,{children:[e(It,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(Dt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:Nn})}),n(Ut,{children:[e(O,{ref:ee,onClick:te,children:t("cancel","Cancel")}),e(O,{colorScheme:"red",onClick:()=>ht(),ml:3,isLoading:ut,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Mo,{isOpen:q,onClose:()=>ge(!1),mutate:lr,isLoading:dt,isAddMode:!0}),e(Mo,{isOpen:!!A,onClose:()=>X(null),node:A||void 0,mutate:pr,isLoading:Sr}),e(hm,{deleteCallback:()=>T.invalidateQueries(Ar)})]})},_m=zs(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([ze("/core").then(({version:s,started:r,logs_websocket:l})=>{t({version:s,started:r,logs_websocket:l})}).catch(s=>{throw console.error("Error fetching /core:",s),s}),ze("/core/config").then(s=>{t({config:s})}).catch(s=>{throw console.error("Error fetching /core/config:",s),s})])}finally{t({isLoading:!1})}},updateConfig:s=>(t({isPostLoading:!0}),ze("/core/config",{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>ze("/core/restart",{method:"POST"})}));const Da=d.exports.forwardRef(({json:t,onChange:s,mode:r="code"},l)=>{const{colorMode:a}=Zr(),i=d.exports.useRef(null),o=d.exports.useRef(null),c=d.exports.useRef(s),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=s},[s]);const p=d.exports.useCallback(S=>{u.current=S,c.current(S)},[]);d.exports.useEffect(()=>{if(!i.current)return;const S=new xd(i.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:a==="dark"?"ace/theme/one_dark":"ace/theme/github"});o.current=S;const y=S.aceEditor;y&&(y.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),y.setTheme(a==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?S.setText(t):t!==void 0&&S.set(t)}catch{typeof t=="string"&&S.updateText(t)}return()=>{S.destroy(),o.current=null}},[]),d.exports.useEffect(()=>{const S=o.current;if(!S)return;const v=(T=>{if(T==null)return"";if(typeof T=="string")return T;try{return JSON.stringify(T,null,2)}catch{return""}})(t);if(v===null)return;if(u.current!==null){let T=u.current;try{T=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,T===v)return}let E=null;try{E=S.getText()}catch{E=null}if(E!==v)if(typeof t=="string")try{S.updateText(v)}catch{S.setText(v)}else{const T=t==null?{}:t;try{S.update(T)}catch{S.set(T)}}},[t]),d.exports.useEffect(()=>{const S=o.current;if(!!S)try{S.getMode&&S.getMode()!==r?S.setMode(r):S.getMode||S.setMode(r)}catch{S.setMode(r)}},[r]),d.exports.useEffect(()=>{var y;const S=(y=o.current)==null?void 0:y.aceEditor;!S||S.setTheme(a==="dark"?"ace/theme/one_dark":"ace/theme/github")},[a]);const m=We("gray.300","whiteAlpha.300"),g=We("surface.light","surface.dark"),x=We("sm","none");return e(z,{ref:l,border:"1px solid",borderColor:m,bg:g,borderRadius:"lg",h:"full",boxShadow:x,overflow:"hidden",children:e(z,{height:"full",ref:i})})}),Dm=ie(pi,{baseStyle:{w:4,h:4}}),Am=ie(vl,{baseStyle:{w:4,h:4}}),sc=({triggerLabel:t,title:s,children:r})=>{const l=Tr({base:!0,md:!1});return n(Hn,{placement:l?"bottom":"right",isLazy:!0,children:[e(Bn,{children:e(O,{size:"xs",variant:"outline",children:t!=null?t:e(Dm,{})})}),n(Vn,{children:[e(ls,{}),e(Ua,{}),s&&e(gl,{fontWeight:"semibold",children:s}),e($n,{children:r})]})]})},Im=({chips:t,color:s="blue"})=>{const r=t[0],l=t.slice(1);return n(M,{spacing:2,align:"center",children:[r?e(lt,{size:"sm",colorScheme:s,children:r}):e(h,{color:"gray.400",children:"-"}),l.length>0&&e(sc,{triggerLabel:n(lt,{size:"sm",children:["+",l.length]}),title:"Details",children:e(he,{align:"stretch",children:t.map((a,i)=>e(M,{justify:"space-between",children:e(h,{children:a})},i))})})]})},Pm=({text:t,label:s})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:a}=Pl(t!=null?t:"");return e(M,{spacing:2,align:"center",children:e(sc,{triggerLabel:r,title:s,children:n(he,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),n(M,{children:[e(He,{"aria-label":"copy",size:"sm",icon:e(Am,{}),onClick:a}),e(h,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},Wo=500,Tm=t=>{try{let s=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(s.protocol==="https:"?"wss://":"ws://")+al([s.host+s.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+Is()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}},ic=({showTitle:t=!0})=>{var X;const{t:s}=qe(),{userData:r,getUserIsSuccess:l}=hr();if(!(l&&Boolean((X=r.permissions)==null?void 0:X.sections.xray)))return n(he,{spacing:4,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("xrayLogs.title","Xray logs")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:s("xrayLogs.noPermission","You do not have permission to view Xray logs.")})]});const{data:i}=Ba(),[o,c]=d.exports.useState(""),[u,p]=d.exports.useState([]),m=d.exports.useRef(null),[g,x]=d.exports.useState(!0),{colorMode:S}=Zr(),y=q=>{if(q!==o){if(!q){c(""),p([]);return}c(q),p([])}},v=d.exports.useCallback(vd.exports.debounce(q=>{p(ge=>ge.length>=Wo?[...ge.slice(ge.length-Wo+1),q]:[...ge,q])},50),[]);d.exports.useEffect(()=>()=>{v.cancel()},[v]);const{readyState:E}=wd(Tm(o),{onMessage:q=>{var ge;v((ge=q.data)!=null?ge:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const q=m.current;if(!q)return;const ge=()=>{const oe=q.scrollHeight-q.scrollTop-q.clientHeight<=32;x(oe)};return q.addEventListener("scroll",ge),ge(),()=>{q.removeEventListener("scroll",ge)}},[]),d.exports.useEffect(()=>{g&&m.current&&(m.current.scrollTop=m.current.scrollHeight)},[u,g]);const T=d.exports.useMemo(()=>{const q=S==="dark";return{error:{bg:q?"rgba(248, 113, 113, 0.16)":"red.50",color:q?"#fed7d7":"#c53030",border:q?"#f87171":"#feb2b2"},warn:{bg:q?"rgba(251, 191, 36, 0.18)":"orange.50",color:q?"#fefcbf":"#975a16",border:q?"#fbbf24":"#f6ad55"},info:{bg:q?"rgba(96, 165, 250, 0.18)":"blue.50",color:q?"#bfdbfe":"#1a56db",border:q?"#60a5fa":"#63b3ed"},debug:{bg:q?"rgba(148, 163, 184, 0.16)":"gray.100",color:q?"#e2e8f0":"#1f2933",border:q?"#94a3b8":"#cbd5e1"},default:{bg:q?"rgba(30, 64, 175, 0.1)":"gray.50",color:q?"#e2e8f0":"#1f2933",border:q?"#475569":"#e2e8f0"}}},[S]),L=We("#f5f7fb","#1f2329"),ce=We("gray.200","gray.600"),P=We("gray.500","gray.400"),W=We("white","gray.700"),A=q=>/error|failed|exception/i.test(q)?"error":/warn/i.test(q)?"warn":/info/i.test(q)?"info":/debug/i.test(q)?"debug":"default";return n(he,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("header.xrayLogs")}),n(fe,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[n(fe,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(i==null?void 0:i[0])&&n(rt,{size:"sm",w:{base:"full",sm:"auto"},bg:W,onChange:q=>y(q.target.value),value:o,children:[e("option",{value:"",children:s("core.master")}),i.map(q=>e("option",{value:String(q.id),children:s(q.name)},q.address))]}),e(h,{fontSize:"sm",color:P,children:s(`core.socket.${E}`)})]}),e(h,{fontSize:"xs",color:P,children:g?s("core.autoScrollOn","Auto-scroll: On"):s("core.autoScrollOff","Auto-scroll: Off")})]}),e(z,{border:"1px solid",borderColor:ce,bg:L,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:m,fontFamily:"mono",fontSize:"sm",children:e(he,{align:"stretch",spacing:2,children:u.map((q,ge)=>{var _;const H=A(q),oe=(_=T[H])!=null?_:T.default;return e(z,{bg:oe.bg,color:oe.color,borderLeftWidth:3,borderLeftColor:oe.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(ie.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:q})},`${q}-${ge}`)})})})]})},Em=ie(Pn),Nm=ie(Tl),br={tag:"",protocol:me.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:Ql.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},fs=t=>{const s={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case me.VMess:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case me.VLESS:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case me.Trojan:s.servers=[{address:r,port:l,password:t.password||void 0}];break;case me.Shadowsocks:s.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case me.Socks:case me.HTTP:s.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case me.Freedom:s.domainStrategy=t.freedomStrategy||void 0;break;case me.Blackhole:s.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case me.DNS:s.network=t.dnsNetwork,s.address=t.dnsAddress||void 0,s.port=Number(t.dnsPort)||void 0;break;case me.Wireguard:s.secretKey=t.wireguardSecret||void 0,s.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,s.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const a=new Un;a.network=t.network,a.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?a.tcp=new In(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?a.ws=new is(t.wsPath,t.wsHost,0):t.network==="grpc"&&(a.grpc=new as(t.grpcServiceName,"",!1)),t.tlsEnabled&&(a.tls=new os(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(a.reality=new Ns(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const o=new sr(t.tag,t.protocol,s,a,void 0).toJson();return o.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(o.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),o},zm=({isOpen:t,onClose:s,mode:r,initialOutbound:l,onSubmitOutbound:a})=>{const{t:i}=qe(),o=er(),c=We("gray.50","whiteAlpha.100"),{control:u,register:p,reset:m,handleSubmit:g,watch:x,getValues:S,setValue:y,formState:{isValid:v}}=jr({defaultValues:br,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:E,append:T,remove:L}=xs({control:u,name:"wireguardPeers"}),ce=x("protocol"),P=x("network"),W=x("tlsEnabled"),A=x("realityEnabled"),X=x("tcpType"),q=x("muxEnabled"),ge=i("validation.required",{defaultValue:"Required"}),H=i("validation.invalidPort",{defaultValue:"Invalid port"}),oe=ce||me.VLESS,_=![me.Freedom,me.Blackhole,me.DNS,me.Wireguard].includes(oe),ye=[me.VMess,me.VLESS].includes(oe),f=[me.Trojan,me.Shadowsocks].includes(oe),ae=oe===me.Shadowsocks,K=oe===me.DNS,xe=tr({control:u}),[Re,Oe]=d.exports.useState(0),[V,be]=d.exports.useState(()=>fs(br)),[Ce,Ee]=d.exports.useState(()=>JSON.stringify(fs(br),null,2)),[ve,B]=d.exports.useState(null),[U,j]=d.exports.useState(""),de=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;Oe(0),B(null),j("");const N=l?I(l):br;de.current=!0,m(N);const Z=fs(N);be(Z),Ee(JSON.stringify(Z,null,2))},[l,t,m]),d.exports.useEffect(()=>{if(!xe)return;if(de.current){de.current=!1;return}const N=fs(xe);be(N);const Z=JSON.stringify(N,null,2);Ee(F=>F===Z?F:Z),B(null)},[xe]);const k=d.exports.useMemo(()=>[me.VLESS,me.VMess,me.Trojan,me.Shadowsocks,me.Socks,me.HTTP,me.Freedom,me.Blackhole,me.DNS,me.Wireguard],[]),I=N=>{var Q,Pe,Te,le,Le,Ke,ne,Ye,te,ee,Ne,at,ot,yt,et,Jt,qt,wt,dt,lr,Sr,pr,xr,cr,mr,gr,re,_e,Y,Ge,kt,Vt,Et,Nt,ut,ht,At,rr,vr,Vr,G,Ie,Ve,Qe,xt,Gt,fr,Mr,dr,wr,$r,vn,En,Kr,Jr;const Z=sr.fromJson(N),F={...br,tag:(Q=N==null?void 0:N.tag)!=null?Q:"",protocol:(Z==null?void 0:Z.protocol)||br.protocol,sendThrough:(Pe=N==null?void 0:N.sendThrough)!=null?Pe:"",muxEnabled:Boolean((Te=N==null?void 0:N.mux)==null?void 0:Te.enabled),muxConcurrency:Number((Le=(le=N==null?void 0:N.mux)==null?void 0:le.concurrency)!=null?Le:br.muxConcurrency)},pe=Z==null?void 0:Z.stream;switch(F.network=(Ke=pe==null?void 0:pe.network)!=null?Ke:br.network,F.tlsEnabled=(pe==null?void 0:pe.security)==="tls",F.realityEnabled=(pe==null?void 0:pe.security)==="reality",F.tlsServerName=(Ye=(ne=pe==null?void 0:pe.tls)==null?void 0:ne.serverName)!=null?Ye:"",F.realityPublicKey=(ee=(te=pe==null?void 0:pe.reality)==null?void 0:te.publicKey)!=null?ee:"",F.realityShortId=(at=(Ne=pe==null?void 0:pe.reality)==null?void 0:Ne.shortId)!=null?at:"",(pe==null?void 0:pe.network)==="tcp"&&pe.tcp&&(F.tcpType=pe.tcp.type,F.tcpHost=(ot=pe.tcp.host)!=null?ot:"",F.tcpPath=(yt=pe.tcp.path)!=null?yt:""),(pe==null?void 0:pe.network)==="ws"&&pe.ws&&(F.wsHost=(et=pe.ws.host)!=null?et:"",F.wsPath=(Jt=pe.ws.path)!=null?Jt:""),(pe==null?void 0:pe.network)==="grpc"&&pe.grpc&&(F.grpcServiceName=(qt=pe.grpc.serviceName)!=null?qt:""),Z!=null&&Z.hasAddressPort()&&(F.address=(Sr=(lr=(wt=Z.settings)==null?void 0:wt.address)!=null?lr:(dt=N==null?void 0:N.settings)==null?void 0:dt.address)!=null?Sr:"",F.port=Number((mr=(cr=(pr=Z.settings)==null?void 0:pr.port)!=null?cr:(xr=N==null?void 0:N.settings)==null?void 0:xr.port)!=null?mr:br.port)),F.protocol){case me.VMess:{const we=Z.settings;F.id=(gr=we==null?void 0:we.id)!=null?gr:"",F.vnextEncryption=(re=we==null?void 0:we.security)!=null?re:br.vnextEncryption,F.address=(_e=we==null?void 0:we.address)!=null?_e:F.address,F.port=Number((Y=we==null?void 0:we.port)!=null?Y:F.port);break}case me.VLESS:{const we=Z.settings;F.id=(Ge=we==null?void 0:we.id)!=null?Ge:"",F.flow=(kt=we==null?void 0:we.flow)!=null?kt:"",F.encryption=(Vt=we==null?void 0:we.encryption)!=null?Vt:F.encryption,F.address=(Et=we==null?void 0:we.address)!=null?Et:F.address,F.port=Number((Nt=we==null?void 0:we.port)!=null?Nt:F.port);break}case me.Trojan:{const we=Z.settings;F.password=(ut=we==null?void 0:we.password)!=null?ut:"",F.address=(ht=we==null?void 0:we.address)!=null?ht:F.address,F.port=Number((At=we==null?void 0:we.port)!=null?At:F.port);break}case me.Shadowsocks:{const we=Z.settings;F.password=(rr=we==null?void 0:we.password)!=null?rr:"",F.method=(vr=we==null?void 0:we.method)!=null?vr:br.method,F.address=(Vr=we==null?void 0:we.address)!=null?Vr:F.address,F.port=Number((G=we==null?void 0:we.port)!=null?G:F.port);break}case me.Socks:case me.HTTP:{const we=(F.protocol===me.Socks,Z.settings);F.user=(Ie=we==null?void 0:we.user)!=null?Ie:"",F.pass=(Ve=we==null?void 0:we.pass)!=null?Ve:"",F.address=(Qe=we==null?void 0:we.address)!=null?Qe:F.address,F.port=Number((xt=we==null?void 0:we.port)!=null?xt:F.port);break}case me.DNS:{const we=Z.settings;F.dnsNetwork=(Gt=we==null?void 0:we.network)!=null?Gt:br.dnsNetwork,F.dnsAddress=(fr=we==null?void 0:we.address)!=null?fr:"",F.dnsPort=Number((Mr=we==null?void 0:we.port)!=null?Mr:br.dnsPort);break}case me.Freedom:{const we=Z.settings;F.freedomStrategy=(dr=we==null?void 0:we.domainStrategy)!=null?dr:"";break}case me.Blackhole:{const we=Z.settings;F.blackholeResponse=(wr=we==null?void 0:we.type)!=null?wr:"";break}case me.Wireguard:{const we=Z.settings;F.wireguardSecret=($r=we==null?void 0:we.secretKey)!=null?$r:"",F.wireguardAddress=(vn=we==null?void 0:we.address)!=null?vn:"";const qr=(Kr=(En=we==null?void 0:we.peers)==null?void 0:En.map(Yr=>{var kr,ln,Gr;return{publicKey:(kr=Yr.publicKey)!=null?kr:"",allowedIPs:Array.isArray(Yr.allowedIPs)?Yr.allowedIPs.join(","):"",endpoint:(ln=Yr.endpoint)!=null?ln:"",keepAlive:Number((Gr=Yr.keepAlive)!=null?Gr:0)}}))!=null?Kr:[];F.wireguardPeers=qr.length>0?qr:br.wireguardPeers;break}}return((Jr=N==null?void 0:N.mux)==null?void 0:Jr.concurrency)!=null&&(F.muxConcurrency=Number(N.mux.concurrency)),(!F.wireguardPeers||F.wireguardPeers.length===0)&&(F.wireguardPeers=br.wireguardPeers),F},R=N=>{Ee(N);try{const Z=JSON.parse(N);B(null),be(Z),de.current=!0;const F=I(Z);m(F)}catch(Z){B(Z.message)}},$=()=>{const N=U.trim();if(!N){B(i("pages.outbound.configEmpty","Please paste a config link"));return}const Z=sr.fromLink(N);if(!Z){B(i("pages.outbound.invalidConfig","Unsupported or invalid config link")),o({status:"error",duration:2500,position:"top",title:i("pages.outbound.configParseFailedTitle","Conversion failed"),description:i("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const F=Z.toJson(),pe=JSON.stringify(F,null,2);j(""),R(pe),o({status:"success",duration:2e3,position:"top",title:i("pages.outbound.configConvertedTitle","Config converted"),description:i("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},Ae=g(async N=>{var F;const Z=fs(N);try{await a(Z),o({title:r==="edit"?i("pages.xray.outbound.updated","Outbound updated"):i("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),s()}catch(pe){o({title:((F=pe==null?void 0:pe.data)==null?void 0:F.detail)||(pe==null?void 0:pe.message)||i("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),Se=()=>{s()},Je=N=>{if(Oe(N),N===1){const Z=fs(S());be(Z);const F=JSON.stringify(Z,null,2);Ee(pe=>pe===F?pe:F),B(null)}};return n(Wt,{size:"4xl",isOpen:t,onClose:Se,scrollBehavior:"inside",children:[e(_t,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),n(Ft,{as:"form",onSubmit:Ae,children:[e(It,{children:r==="edit"?i("pages.xray.outbound.editOutbound","Edit Outbound"):i("pages.xray.outbound.addOutbound")}),e(Ht,{}),e(Dt,{children:n(cs,{variant:"enclosed",colorScheme:"primary",index:Re,onChange:Je,children:[n(ds,{children:[e(Xt,{children:i("form")}),e(Xt,{children:i("json")})]}),n(us,{children:[e(Qt,{children:n(he,{spacing:6,align:"stretch",children:[n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.basicSettings","Basic settings")}),n(he,{spacing:3,align:"stretch",children:[n(C,{isRequired:!0,children:[e(D,{children:i("pages.xray.outbound.tag")}),e(De,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:ge})})]}),n(M,{children:[n(C,{isRequired:!0,children:[e(D,{children:i("protocol")}),e(rt,{size:"sm",...p("protocol"),children:k.map(N=>e("option",{value:N,children:N},N))})]}),n(C,{children:[e(D,{children:i("pages.xray.outbound.sendThrough")}),e(De,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),_&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.endpoint","Endpoint")}),n(he,{spacing:3,align:"stretch",children:[n(C,{isRequired:_,children:[e(D,{children:i("pages.outbound.address","Address")}),e(De,{size:"sm",placeholder:"example.com",...p("address",{required:_?ge:!1})})]}),n(M,{children:[n(C,{isRequired:_,children:[e(D,{children:i("pages.outbound.port","Port")}),e(De,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:_?ge:!1,valueAsNumber:!0,min:{value:1,message:H},max:{value:65535,message:H}})})]}),ye?n(C,{isRequired:ye,children:[e(D,{children:"ID"}),e(De,{size:"sm",placeholder:"UUID",...p("id",{required:ye?ge:!1})})]}):f?n(C,{isRequired:f,children:[e(D,{children:i("password")}),e(De,{size:"sm",placeholder:"password",...p("password",{required:f?ge:!1})})]}):n(C,{children:[e(D,{children:i("username")}),e(De,{size:"sm",placeholder:"username",...p("user")})]})]}),oe===me.Shadowsocks&&n(C,{isRequired:ae,children:[e(D,{children:i("pages.outbound.method","Method")}),e(rt,{size:"sm",...p("method",{required:ae?ge:!1}),children:Object.values(Ql).map(N=>e("option",{value:N,children:N},N))})]}),oe===me.VLESS&&n(M,{children:[n(C,{children:[e(D,{children:i("pages.outbound.encryption","Encryption")}),e(De,{size:"sm",placeholder:"none",...p("encryption")})]}),n(C,{children:[e(D,{children:"Flow"}),e(De,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),oe===me.VMess&&n(C,{children:[e(D,{children:i("pages.outbound.security","User security")}),e(De,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),oe===me.DNS&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.dnsSettings","DNS settings")}),n(M,{children:[n(C,{children:[e(D,{children:i("pages.outbound.network")}),n(rt,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),n(C,{isRequired:K,children:[e(D,{children:i("pages.outbound.port")}),e(De,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:K?ge:!1,valueAsNumber:!0,min:{value:1,message:H},max:{value:65535,message:H}})})]})]}),n(C,{mt:3,isRequired:K,children:[e(D,{children:i("pages.outbound.address")}),e(De,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:K?ge:!1})})]})]}),oe===me.Freedom&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.freedom","Freedom options")}),n(C,{children:[e(D,{children:i("pages.outbound.strategy","Strategy")}),e(De,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),oe===me.Blackhole&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.blackhole","Blackhole options")}),n(C,{children:[e(D,{children:i("pages.outbound.response")}),e(De,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),oe===me.Wireguard&&n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.wireguard","Wireguard")}),n(he,{spacing:3,align:"stretch",children:[n(C,{children:[e(D,{children:i("pages.outbound.secretKey","Secret key")}),e(De,{size:"sm",...p("wireguardSecret")})]}),n(C,{children:[e(D,{children:i("pages.outbound.address")}),e(De,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),n(he,{spacing:3,align:"stretch",children:[n(M,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:i("pages.outbound.peer","Peers")}),e(He,{size:"sm","aria-label":i("add"),icon:e(Em,{boxSize:3}),onClick:()=>T({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),E.map((N,Z)=>n(z,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[n(M,{children:[n(C,{children:[e(D,{children:i("pages.outbound.publicKey","Public key")}),e(De,{size:"sm",...p(`wireguardPeers.${Z}.publicKey`)})]}),E.length>1&&e(He,{mt:6,size:"sm","aria-label":i("delete"),icon:e(Nm,{boxSize:3}),onClick:()=>L(Z)})]}),n(M,{mt:2,children:[n(C,{children:[e(D,{children:i("pages.outbound.allowedIPs","Allowed IPs")}),e(De,{size:"sm",...p(`wireguardPeers.${Z}.allowedIPs`)})]}),n(C,{children:[e(D,{children:i("pages.outbound.endpoint","Endpoint")}),e(De,{size:"sm",...p(`wireguardPeers.${Z}.endpoint`)})]})]}),n(C,{mt:2,children:[e(D,{children:i("pages.outbound.keepAlive","Keep alive")}),e(De,{size:"sm",type:"number",...p(`wireguardPeers.${Z}.keepAlive`,{valueAsNumber:!0})})]})]},N.id))]})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.transport","Transport")}),n(he,{spacing:3,align:"stretch",children:[n(C,{children:[e(D,{children:i("pages.outbound.network")}),n(rt,{size:"sm",...p("network"),onChange:N=>{p("network").onChange(N)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),P==="tcp"&&n(M,{children:[n(C,{children:[e(D,{children:i("pages.outbound.tcpHeader","Header")}),n(rt,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),X==="http"&&n(Bt,{children:[n(C,{children:[e(D,{children:i("host")}),e(De,{size:"sm",...p("tcpHost")})]}),n(C,{children:[e(D,{children:i("path")}),e(De,{size:"sm",...p("tcpPath")})]})]})]}),P==="ws"&&n(M,{children:[n(C,{children:[e(D,{children:i("host")}),e(De,{size:"sm",...p("wsHost")})]}),n(C,{children:[e(D,{children:i("path")}),e(De,{size:"sm",...p("wsPath")})]})]}),P==="grpc"&&n(C,{children:[e(D,{children:i("serviceName")}),e(De,{size:"sm",...p("grpcServiceName")})]})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.security")}),n(M,{children:[n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:"0",children:"TLS"}),e(gt,{size:"sm",isChecked:W,onChange:N=>{const Z=N.target.checked;y("tlsEnabled",Z),Z&&y("realityEnabled",!1)}})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:"0",children:"Reality"}),e(gt,{size:"sm",isChecked:A,onChange:N=>{const Z=N.target.checked;y("realityEnabled",Z),Z&&y("tlsEnabled",!1)}})]})]}),W&&n(C,{mt:3,children:[e(D,{children:"SNI"}),e(De,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),A&&n(he,{spacing:3,align:"stretch",mt:3,children:[n(C,{children:[e(D,{children:"SNI"}),e(De,{size:"sm",...p("tlsServerName")})]}),n(C,{children:[e(D,{children:i("pages.outbound.publicKey")}),e(De,{size:"sm",...p("realityPublicKey")})]}),n(C,{children:[e(D,{children:i("pages.outbound.shortId")}),e(De,{size:"sm",...p("realityShortId")})]})]})]}),n(z,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.mux")}),n(C,{display:"flex",alignItems:"center",children:[e(D,{mb:"0",children:i("pages.outbound.enableMux")}),e(gt,{size:"sm",...p("muxEnabled")})]}),q&&n(C,{mt:3,children:[e(D,{children:i("pages.outbound.concurrency")}),e(De,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(Qt,{children:n(he,{align:"stretch",spacing:3,children:[n(C,{children:[e(D,{children:i("pages.outbound.configToJson","Config to JSON")}),n(M,{align:"start",spacing:3,children:[e(Pr,{value:U,onChange:N=>j(N.target.value),placeholder:i("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(O,{size:"sm",colorScheme:"primary",onClick:$,children:i("pages.outbound.convertConfig","Convert")})]})]}),e(z,{height:"420px",children:e(Da,{json:V,onChange:R})}),ve&&e(h,{fontSize:"sm",color:"red.500",children:ve})]})})]})]})}),n(Ut,{gap:3,children:[e(O,{variant:"outline",onClick:Se,children:i("cancel")}),e(O,{colorScheme:"primary",type:"submit",isDisabled:!v,children:i(r==="edit"?"save":"add")})]})]})]})},Rm=["tcp","udp","http","quic","grpc"],Mm=["http","tls","bittorrent","quic"],Um=["field","chained"],Lm=["","hybrid","linear"],ac={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},bs=t=>Array.isArray(t)?t.join(", "):"",ys=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean),Om=t=>{var r,l,a,i;if(!t)return{...ac};const s=t.attrs?Object.entries(t.attrs).map(([o,c])=>({key:o,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(a=t.outboundTag)!=null?a:"",balancerTag:(i=t.balancerTag)!=null?i:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:bs(t.source),sourcePort:bs(t.sourcePort),domain:bs(t.domain),ip:bs(t.ip),user:bs(t.user),port:bs(t.port),attrs:s}},Wm=t=>{const s={};t.type&&(s.type=t.type),t.domainMatcher&&(s.domainMatcher=t.domainMatcher),t.outboundTag&&(s.outboundTag=t.outboundTag),t.balancerTag&&(s.balancerTag=t.balancerTag),t.inboundTags.length&&(s.inboundTag=t.inboundTags),t.networks.length&&(s.network=t.networks),t.protocols.length&&(s.protocol=t.protocols);const r=ys(t.sourceIps);r.length&&(s.source=r);const l=ys(t.sourcePort);l.length&&(s.sourcePort=l);const a=ys(t.domain);a.length&&(s.domain=a);const i=ys(t.ip);i.length&&(s.ip=i);const o=ys(t.user);o.length&&(s.user=o);const c=ys(t.port);if(c.length&&(s.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:p,value:m})=>{!p.trim()||(u[p.trim()]=m)}),Object.keys(u).length&&(s.attrs=u)}return s.type||(s.type="field"),s},Fm=({isOpen:t,mode:s,initialRule:r,availableInboundTags:l,availableOutboundTags:a,availableBalancerTags:i,onSubmit:o,onClose:c})=>{const{t:u}=qe(),p=We("white","gray.900"),{control:m,register:g,handleSubmit:x,reset:S,formState:{isSubmitting:y}}=jr({defaultValues:ac}),{fields:v,append:E,remove:T}=xs({control:m,name:"attrs"});d.exports.useEffect(()=>{t&&S(Om(r))},[t,r,S]);const L=()=>E({key:"",value:""}),ce=()=>{c()},P=x(A=>{const X=Wm(A);o(X),ce()}),W=d.exports.useMemo(()=>s==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[s,u]);return n(Wt,{isOpen:t,onClose:ce,size:"xl",scrollBehavior:"inside",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{as:"form",onSubmit:P,bg:p,children:[e(It,{children:W}),e(Ht,{}),e(Dt,{children:n(fe,{spacing:5,children:[n(C,{children:[e(D,{children:u("pages.xray.rules.type","Rule Type")}),e(rt,{...g("type"),size:"sm",children:Um.map(A=>e("option",{value:A,children:A||u("core.none","None")},A))})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(rt,{...g("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:a.map(A=>e("option",{value:A,children:A},A))})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(rt,{...g("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:i.map(A=>e("option",{value:A,children:A},A))})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(St,{control:m,name:"inboundTags",render:({field:A})=>e(Ei,{...A,children:e(vs,{spacing:3,children:l.map(X=>e(Zn,{children:e(Er,{value:X,children:X})},X))})})})]}),e(On,{}),n(C,{children:[e(D,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(rt,{...g("domainMatcher"),size:"sm",children:Lm.map(A=>e("option",{value:A,children:A||u("core.default","Default")},A||"empty"))})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.network","Network")}),e(St,{control:m,name:"networks",render:({field:A})=>e(Ei,{...A,children:e(vs,{spacing:3,children:Rm.map(X=>e(Zn,{children:e(Er,{value:X,children:X})},X))})})})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.protocol","Protocol")}),e(St,{control:m,name:"protocols",render:({field:A})=>e(Ei,{...A,children:e(vs,{spacing:3,children:Mm.map(X=>e(Zn,{children:e(Er,{value:X,children:X})},X))})})})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.source","Source IPs")}),e(Pr,{...g("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(Pr,{...g("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.ip","Destination IPs")}),e(Pr,{...g("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.domain","Domains")}),e(Pr,{...g("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.user","Users")}),e(Pr,{...g("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(C,{children:[e(D,{children:u("pages.xray.rules.port","Ports")}),e(Pr,{...g("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(On,{}),n(z,{children:[n(C,{children:[e(D,{children:u("pages.xray.rules.attrs","Attributes")}),e(O,{onClick:L,size:"xs",leftIcon:e(Pn,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),n(fe,{spacing:2,mt:3,children:[v.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),v.map((A,X)=>n(M,{spacing:2,align:"flex-start",children:[e(De,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...g(`attrs.${X}.key`)}),e(De,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...g(`attrs.${X}.value`)}),e(He,{"aria-label":"Remove attribute",icon:e(Ta,{width:16}),size:"sm",variant:"ghost",onClick:()=>T(X)})]},A.id))]})]})]})}),n(Ut,{gap:3,children:[e(O,{variant:"outline",onClick:ce,children:u("cancel")}),e(O,{colorScheme:"primary",type:"submit",isLoading:y,children:s==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},Hm=({isOpen:t,onClose:s,form:r,setBalancersData:l,balancerIndex:a})=>{const{t:i}=qe(),o=jr({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=o.handleSubmit(u=>{const p={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},m=r.getValues("config.routing.balancers")||[];a!==void 0?m[a]=p:m.push(p),r.setValue("config.routing.balancers",m,{shouldDirty:!0}),l(m.map((g,x)=>{var S;return{key:x,tag:g.tag||"",strategy:((S=g.strategy)==null?void 0:S.type)||"random",selector:g.selector||[],fallbackTag:g.fallbackTag||""}})),s()});return n(Wt,{isOpen:t,onClose:s,size:"sm",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",children:[e(It,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(a!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Ht,{mt:3}),e(Dt,{children:e("form",{onSubmit:c,children:n(he,{spacing:4,children:[n(C,{children:[e(D,{children:i("pages.xray.balancer.tag")}),e(De,{...o.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),n(C,{children:[e(D,{children:i("pages.xray.balancer.balancerStrategy")}),e(rt,{...o.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),n(C,{children:[e(D,{children:i("pages.xray.balancer.balancerSelectors")}),e(De,{...o.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),n(C,{children:[e(D,{children:i("pages.xray.balancer.fallbackTag")}),e(De,{...o.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(O,{type:"submit",colorScheme:"primary",size:"sm",children:i(a!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},Bm=({isOpen:t,onClose:s,form:r,setDnsServers:l,dnsIndex:a})=>{const{t:i}=qe(),o=jr({defaultValues:{address:"",domains:"",expectIPs:""}}),c=o.handleSubmit(u=>{const p={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},m=r.getValues("config.dns.servers")||[];a!==void 0?m[a]=p:m.push(p),r.setValue("config.dns.servers",m,{shouldDirty:!0}),l(m),s()});return n(Wt,{isOpen:t,onClose:s,size:"sm",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",children:[e(It,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(a!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Ht,{mt:3}),e(Dt,{children:e("form",{onSubmit:c,children:n(he,{spacing:4,children:[n(C,{children:[e(D,{children:i("pages.xray.dns.address")}),e(De,{...o.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),n(C,{children:[e(D,{children:i("pages.xray.dns.domains")}),e(De,{...o.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),n(C,{children:[e(D,{children:i("pages.xray.dns.expectIPs")}),e(De,{...o.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(O,{type:"submit",colorScheme:"primary",size:"sm",children:i(a!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},Vm=({isOpen:t,onClose:s,form:r,setFakeDns:l,fakeDnsIndex:a})=>{const{t:i}=qe(),o=jr({defaultValues:{ipPool:"",poolSize:""}}),c=o.handleSubmit(u=>{const p={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},m=r.getValues("config.fakedns")||[];a!==void 0?m[a]=p:m.push(p),r.setValue("config.fakedns",m.length>0?m:null,{shouldDirty:!0}),l(m),s()});return n(Wt,{isOpen:t,onClose:s,size:"sm",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Ft,{mx:"3",children:[e(It,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(a!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Ht,{mt:3}),e(Dt,{children:e("form",{onSubmit:c,children:n(he,{spacing:4,children:[n(C,{children:[e(D,{children:i("pages.xray.fakedns.ipPool")}),e(De,{...o.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),n(C,{children:[e(D,{children:i("pages.xray.fakedns.poolSize")}),e(De,{...o.register("poolSize"),size:"sm",placeholder:"100"})]}),e(O,{type:"submit",colorScheme:"primary",size:"sm",children:i(a!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},Aa={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},Fo=t=>{var u,p,m,g,x,S,y,v,E,T,L,ce,P;if(!t)return{...Aa};const s=(u=t.settings)!=null?u:{},l=(p=(Array.isArray(s.peers)?s.peers:[])[0])!=null?p:{},a=Array.isArray(s.address)?s.address:[],i=(g=(m=a.find(W=>typeof W=="string"&&W.endsWith("/32")))==null?void 0:m.replace("/32",""))!=null?g:"",o=(S=(x=a.find(W=>typeof W=="string"&&W.endsWith("/128")))==null?void 0:x.replace("/128",""))!=null?S:"",c=Array.isArray(s.reserved)?s.reserved.filter(W=>Number.isFinite(Number(W))).join(","):"";return{tag:(y=t.tag)!=null?y:"warp",privateKey:(E=(v=s.secretKey)!=null?v:s.privateKey)!=null?E:"",publicKey:(T=l.publicKey)!=null?T:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:i,addressV6:o,reserved:c,mtu:(L=s.mtu)!=null?L:1420,domainStrategy:(ce=s.domainStrategy)!=null?ce:"ForceIP",notes:typeof t.notes=="string"?t.notes:(P=s.notes)!=null?P:""}},$m=t=>{const s=[];t.addressV4.trim()&&s.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&s.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(i=>Number(i.trim())).filter(i=>Number.isFinite(i)),a=sr.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:s,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?a.notes=t.notes.trim():delete a.notes,a},Km=t=>{if(!t)return[];try{const s=atob(t);return Array.from(s).map(r=>r.charCodeAt(0))}catch{return[]}},Jm=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const s=t;return s.host?s.port?`${s.host}:${s.port}`:s.host:""}return""},qm=(t,s)=>{var p,m,g,x,S,y,v,E,T,L,ce;if(!t||!(s!=null&&s.config))return null;const r=s.config,l=[],a=(m=(p=r.interface)==null?void 0:p.addresses)!=null?m:{};a.v4&&l.push(`${a.v4}/32`),a.v6&&l.push(`${a.v6}/128`);const o=(g=(Array.isArray(r.peers)?r.peers:[])[0])!=null?g:{},c=(S=(x=o.allowed_ips)!=null?x:o.allowedIPs)!=null?S:["0.0.0.0/0","::/0"];return sr.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(v=(y=r.interface)==null?void 0:y.mtu)!=null?v:1420,secretKey:t.private_key,address:l,reserved:Km(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(T=(E=o.public_key)!=null?E:t.public_key)!=null?T:"",endpoint:Jm(o.endpoint),allowedIPs:c,keepAlive:(ce=(L=o.keep_alive)!=null?L:o.keepAlive)!=null?ce:0}]}})},Ho=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},ua=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":Qn.sizeFormat(t),yr=({label:t,value:s})=>{const r=We("gray.500","gray.400");return n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:s||"-"})]})},Ym=({isOpen:t,onClose:s,initialOutbound:r,onSave:l,onDelete:a})=>{var U,j,de,k,I;const{t:i}=qe(),o=er(),[c,u]=d.exports.useState({...Aa}),[p,m]=d.exports.useState(null),[g,x]=d.exports.useState(null),[S,y]=d.exports.useState(null),[v,E]=d.exports.useState(""),[T,L]=d.exports.useState(!1),[ce,P]=d.exports.useState(!1),[W,A]=d.exports.useState(!1),[X,q]=d.exports.useState(!1),[ge,H]=d.exports.useState(!1);d.exports.useEffect(()=>{Xp()},[]);const oe=d.exports.useCallback(async()=>{var R,$;L(!0);try{const Ae=await ze("/core/warp",{method:"GET"});m((R=Ae.account)!=null?R:null),x(null),y(null)}catch(Ae){o({title:i("pages.xray.warp.loadFailed","Failed to load WARP account."),description:(($=Ae==null?void 0:Ae.data)==null?void 0:$.detail)||(Ae==null?void 0:Ae.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{L(!1)}},[o,i]);d.exports.useEffect(()=>{t&&oe().catch(()=>{})},[t,oe]),d.exports.useEffect(()=>{t&&u(Fo(r))},[r,t]),d.exports.useEffect(()=>{var R;E((R=p==null?void 0:p.license_key)!=null?R:"")},[p]);const _=(R,$)=>{u(Ae=>({...Ae,[R]:$}))},ye=We("gray.600","gray.300"),f=We("gray.200","whiteAlpha.200"),ae=()=>{const R=Oi();_("privateKey",R.privateKey),_("publicKey",R.publicKey),o({title:i("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},K=()=>{const R=Array.from({length:3},()=>Math.floor(Math.random()*256));_("reserved",R.join(","))},xe=d.exports.useCallback((R,$)=>{if(!R||!$){y(null);return}const Ae=qm(R,$);Ae&&(y(Ae),u(Fo(Ae.toJson())))},[]),Re=async()=>{var R;P(!0);try{const $=Oi(),Ae=await ze("/core/warp/register",{method:"POST",body:{private_key:$.privateKey,public_key:$.publicKey}});m(Ae.account),x(Ae.config),xe(Ae.account,Ae.config),o({title:i("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch($){o({title:i("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((R=$==null?void 0:$.data)==null?void 0:R.detail)||($==null?void 0:$.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{P(!1)}},Oe=async()=>{var R;if(!p){o({title:i("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}q(!0);try{const $=await ze("/core/warp/config",{method:"GET"});x($.config),xe(p,$.config),o({title:i("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch($){o({title:i("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((R=$==null?void 0:$.data)==null?void 0:R.detail)||($==null?void 0:$.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{q(!1)}},V=async()=>{var R;if(!!v.trim()){A(!0);try{const $=await ze("/core/warp/license",{method:"POST",body:{license_key:v.trim()}});m($.account),o({title:i("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch($){o({title:i("pages.xray.warp.licenseFailed","Failed to update license."),description:((R=$==null?void 0:$.data)==null?void 0:R.detail)||($==null?void 0:$.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{A(!1)}}},be=async()=>{var R;H(!0);try{await ze("/core/warp",{method:"DELETE"}),m(null),x(null),y(null),a(),o({title:i("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch($){o({title:i("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((R=$==null?void 0:$.data)==null?void 0:R.detail)||($==null?void 0:$.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{H(!1)}},Ce=()=>{if(!S)return;const R=S.toJson();l(R),o({title:i("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},Ee=()=>{a(),u({...Aa}),o({title:i("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},ve=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){o({title:i("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const R=$m(c);l(R),s()},B=d.exports.useMemo(()=>Boolean(r),[r]);return n(Wt,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),n(Ft,{children:[e(It,{children:i("pages.xray.warp.manage","Manage WARP")}),e(Ht,{}),e(Dt,{children:n(he,{spacing:5,align:"stretch",children:[n(Wr,{status:"info",borderRadius:"md",children:[e(Fr,{}),e(Wn,{children:i("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:p?n(he,{spacing:4,align:"stretch",children:[n(Fe,{columns:{base:1,md:2},spacing:4,children:[e(yr,{label:i("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(yr,{label:i("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(yr,{label:i("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(yr,{label:i("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(yr,{label:i("pages.xray.warp.registeredAt","Registered at"),value:Ho(p.created_at)}),e(yr,{label:i("pages.xray.warp.updatedAt","Updated at"),value:Ho(p.updated_at)})]}),n(M,{spacing:3,flexWrap:"wrap",children:[e(O,{variant:"outline",onClick:Oe,isLoading:X,children:i("pages.xray.warp.fetchInfo","Refresh info")}),e(O,{variant:"ghost",colorScheme:"red",onClick:be,isLoading:ge,children:i("pages.xray.warp.removeAccount","Remove account")})]})]}):n(he,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:ye,children:i("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(O,{colorScheme:"primary",onClick:Re,isLoading:ce||T,children:i("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&n(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.licenseSection","WARP+/License key")}),n(M,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(De,{value:v,onChange:R=>E(R.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(O,{colorScheme:"primary",onClick:V,isLoading:W,isDisabled:!v.trim(),children:i("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:ye,mt:2,children:i("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),n(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:[n(M,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:i("pages.xray.warp.remoteConfig","Remote configuration")}),g?e(Br,{colorScheme:g.enabled?"green":"yellow",children:g.enabled?i("core.active","Active"):i("core.pending","Pending")}):e(Br,{colorScheme:"gray",children:i("core.empty","Empty")})]}),g?n(fe,{spacing:4,children:[n(Fe,{columns:{base:1,md:2},spacing:4,children:[e(yr,{label:i("core.name","Name"),value:(U=g.name)!=null?U:"-"}),e(yr,{label:i("core.model","Model"),value:(j=g.model)!=null?j:"-"}),e(yr,{label:i("core.status","Status"),value:g.enabled?i("core.enabled","Enabled"):i("core.disabled","Disabled")}),e(yr,{label:i("core.id","ID"),value:(de=g.id)!=null?de:"-"})]}),g.account&&n(Bt,{children:[e(On,{}),n(Fe,{columns:{base:1,md:3},spacing:4,children:[e(yr,{label:i("core.type","Type"),value:(k=g.account.account_type)!=null?k:"-"}),e(yr,{label:i("core.role","Role"),value:(I=g.account.role)!=null?I:"-"}),e(yr,{label:i("pages.xray.warp.premiumData","WARP+ data"),value:ua(g.account.premium_data)}),e(yr,{label:i("core.quota","Quota"),value:ua(g.account.quota)}),e(yr,{label:i("core.usage","Usage"),value:ua(g.account.usage)})]})]}),n(M,{spacing:3,flexWrap:"wrap",children:[e(O,{colorScheme:"primary",onClick:Ce,isDisabled:!S,children:i("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(O,{variant:"ghost",onClick:()=>x(null),children:i("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:ye,children:i("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),n(z,{borderWidth:"1px",borderColor:f,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.manualTitle","Manual outbound")}),n(fe,{spacing:4,children:[n(C,{isRequired:!0,children:[e(D,{children:i("pages.xray.outbound.tag","Tag")}),e(De,{size:"sm",value:c.tag,onChange:R=>_("tag",R.target.value),placeholder:"warp"})]}),n(C,{isRequired:!0,children:[e(D,{children:i("pages.xray.warp.privateKey")}),e(Pr,{size:"sm",value:c.privateKey,onChange:R=>_("privateKey",R.target.value),rows:2})]}),n(C,{isRequired:!0,children:[e(D,{children:i("pages.xray.warp.publicKey")}),e(Pr,{size:"sm",value:c.publicKey,onChange:R=>_("publicKey",R.target.value),rows:2})]}),n(C,{children:[e(O,{size:"sm",colorScheme:"primary",onClick:ae,children:i("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:ye,mt:1,children:i("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),n(C,{isRequired:!0,children:[e(D,{children:i("pages.xray.warp.endpoint")}),e(De,{size:"sm",value:c.endpoint,onChange:R=>_("endpoint",R.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),n(C,{children:[e(D,{children:i("pages.xray.warp.addressV4","Client IPv4")}),e(De,{size:"sm",value:c.addressV4,onChange:R=>_("addressV4",R.target.value),placeholder:"172.16.0.2"}),e(ur,{children:i("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),n(C,{children:[e(D,{children:i("pages.xray.warp.addressV6","Client IPv6")}),e(De,{size:"sm",value:c.addressV6,onChange:R=>_("addressV6",R.target.value),placeholder:"2606:4700:****:****::****"})]}),n(C,{children:[e(D,{children:i("pages.xray.warp.reserved")}),e(De,{size:"sm",value:c.reserved,onChange:R=>_("reserved",R.target.value),placeholder:"0,0,0"}),e(ur,{children:i("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(O,{size:"xs",mt:2,variant:"ghost",onClick:K,children:i("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),n(C,{children:[e(D,{children:i("pages.xray.warp.mtu","MTU")}),e(rs,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(R,$)=>_("mtu",$||1420),children:e(ts,{})})]}),n(C,{children:[e(D,{children:i("pages.xray.warp.notes","Notes (optional)")}),e(Pr,{size:"sm",rows:2,value:c.notes,onChange:R=>_("notes",R.target.value)})]})]})]})]})}),n(Ut,{display:"flex",justifyContent:"space-between",children:[B?e(O,{colorScheme:"red",variant:"outline",onClick:Ee,children:i("delete")}):e("span",{}),n(M,{spacing:3,children:[e(O,{variant:"ghost",onClick:s,children:i("cancel")}),e(O,{colorScheme:"primary",onClick:ve,children:i(B?"save":"add")})]})]})]})]})},Bs=ie(Pn,{baseStyle:{w:3.5,h:3.5}}),Vs=ie(Sn,{baseStyle:{w:4,h:4}}),$s=ie(Fn,{baseStyle:{w:4,h:4}}),Bo=ie(El,{baseStyle:{w:4,h:4}}),Vo=ie(Nl,{baseStyle:{w:4,h:4}}),$o=ie(on,{baseStyle:{w:4,h:4}}),Gm=ie(kd,{baseStyle:{w:4,h:4}}),Xm=ie(Cd,{baseStyle:{w:4,h:4}}),Qm=ie(Al,{baseStyle:{w:4,h:4}}),Zm=ie(_d,{baseStyle:{w:4,h:4}}),jm=ie(Na,{baseStyle:{w:4,h:4}}),eg=ie(Dd,{baseStyle:{w:4,h:4}}),tg=ie(Ad,{baseStyle:{w:4,h:4}}),rg=ie(Id,{baseStyle:{w:4,h:4}}),ng=ie(Pd,{baseStyle:{w:4,h:4}}),Ko=ie(Td,{baseStyle:{w:4,h:4}}),Ks={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},Ci=t=>JSON.stringify(t!=null?t:{}),Jo=t=>Array.isArray(t)?t.join(","):t!=null?t:"",sg=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],ha=({title:t,children:s})=>{const r=We("gray.50","whiteAlpha.100"),l=We("gray.200","whiteAlpha.300");return n(z,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(z,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(z,{overflowX:"auto",children:e(ns,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e(sn,{children:s})})})]})},tn=({label:t,controlId:s,children:r})=>{const l=We("gray.700","whiteAlpha.800");return n(zt,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Ue,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(D,{htmlFor:s,mb:{base:2,md:0},color:l,children:t})}),e(Ue,{py:3,display:{base:"block",md:"table-cell"},children:e(C,{id:s,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(s)})})]})},Js=({children:t})=>{const s=We("gray.200","whiteAlpha.200"),r=We("white","blackAlpha.400"),l=We("sm","none");return e(z,{borderWidth:"1px",borderColor:s,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(z,{overflowX:"auto",children:t})})},qs=({children:t,...s})=>{const r=We("gray.50","whiteAlpha.100"),l=We("gray.200","whiteAlpha.300"),a=We("gray.300","whiteAlpha.300"),i=We("gray.100","whiteAlpha.200"),o=We("gray.50","whiteAlpha.100");return e(ns,{size:"sm",w:"full",...s,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:a,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:i,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:o}},children:t})},ig=()=>{var xi,Ms,Us,Ls,Os;const{t}=qe(),{fetchCoreSettings:s,updateConfig:r,isLoading:l,config:a,isPostLoading:i,restartCore:o}=_m(),{userData:c,getUserIsSuccess:u}=hr();if(!(u&&Boolean((xi=c.permissions)==null?void 0:xi.sections.xray)))return n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.xraySettings","Xray settings")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("xraySettings.noPermission","You do not have permission to manage Xray settings.")})]});const{onEditingCore:m}=Tt(),g=er(),{isOpen:x,onOpen:S,onClose:y}=Zt(),{isOpen:v,onOpen:E,onClose:T}=Zt(),{isOpen:L,onOpen:ce,onClose:P}=Zt(),{isOpen:W,onOpen:A,onClose:X}=Zt(),{isOpen:q,onOpen:ge,onClose:H}=Zt(),{isOpen:oe,onOpen:_,onClose:ye}=Zt(),f=jr({defaultValues:{config:a||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),ae=d.exports.useRef(Ci(f.getValues("config"))),K=tr({control:f.control,name:"config"}),xe=d.exports.useMemo(()=>Ci(K)!==ae.current,[K]),[Re,Oe]=d.exports.useState([]),[V,be]=d.exports.useState([]),[Ce,Ee]=d.exports.useState([]),[ve,B]=d.exports.useState([]),[U,j]=d.exports.useState([]),[de,k]=d.exports.useState([]),[I,R]=d.exports.useState(null),[$,Ae]=d.exports.useState(null),[Se,Je]=d.exports.useState(!1),[N,Z]=d.exports.useState("xraySetting"),[F,pe]=d.exports.useState(""),Q=Tr({base:!0,md:!1}),[Pe,Te]=d.exports.useState(0),[le,Le]=d.exports.useState(""),[Ke,ne]=d.exports.useState(""),Ye=d.exports.useCallback(b=>b.map((w,se)=>{var Ze,it;return{key:`${se}-${(it=(Ze=w.tag)!=null?Ze:w.protocol)!=null?it:"outbound"}`,...w}}),[]),te=d.exports.useCallback(b=>{Oe(Ye(b))},[Ye]),ee=d.exports.useCallback(()=>{const b=f.getValues("config.outbounds");return Array.isArray(b)?JSON.parse(JSON.stringify(b)):[]},[f]),Ne=d.exports.useCallback(b=>{f.setValue("config.outbounds",b,{shouldDirty:!0}),te(b),Te(w=>w+1)},[f,te]),at=d.exports.useCallback(b=>b.map((w,se)=>{var Ze,it,je,Ct,Cr,Kn,zn,ue,ft,st,vt,Mt,en,pn,mn;return{key:`${se}-${(it=(Ze=w.outboundTag)!=null?Ze:w.balancerTag)!=null?it:"rule"}`,source:(je=w.source)!=null?je:[],sourcePort:(Ct=w.sourcePort)!=null?Ct:[],network:(Cr=w.network)!=null?Cr:[],protocol:(Kn=w.protocol)!=null?Kn:[],attrs:w.attrs?JSON.stringify(w.attrs,null,2):"",ip:(zn=w.ip)!=null?zn:[],domain:(ue=w.domain)!=null?ue:[],port:(ft=w.port)!=null?ft:[],inboundTag:(st=w.inboundTag)!=null?st:[],user:(vt=w.user)!=null?vt:[],outboundTag:(Mt=w.outboundTag)!=null?Mt:"",balancerTag:(en=w.balancerTag)!=null?en:"",type:(pn=w.type)!=null?pn:"field",domainMatcher:(mn=w.domainMatcher)!=null?mn:""}}),[]),ot=d.exports.useCallback(b=>{be(at(b))},[at]),yt=d.exports.useCallback(b=>{f.setValue("config.routing.rules",b,{shouldDirty:!0}),ot(b),Te(w=>w+1)},[f,ot]),et=d.exports.useCallback(()=>{const b=f.getValues("config.routing.rules");return Array.isArray(b)?JSON.parse(JSON.stringify(b)):[]},[f]);d.exports.useEffect(()=>{const b=()=>{Je(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",b),()=>{document.removeEventListener("fullscreenchange",b)}},[]),d.exports.useEffect(()=>(m(!0),s().then(()=>{console.log("Core settings fetched successfully")}).catch(b=>{g({title:t("core.errorFetchingConfig"),description:b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>m(!1)),[s,m,g,t]),d.exports.useEffect(()=>{var b,w,se,Ze;a&&(f.reset({config:a}),ae.current=Ci(a),te((a==null?void 0:a.outbounds)||[]),ot(((b=a==null?void 0:a.routing)==null?void 0:b.rules)||[]),Ee(((se=(w=a==null?void 0:a.routing)==null?void 0:w.balancers)==null?void 0:se.map((it,je)=>{var Ct;return{key:je,tag:it.tag||"",strategy:((Ct=it.strategy)==null?void 0:Ct.type)||"random",selector:it.selector||[],fallbackTag:it.fallbackTag||""}}))||[]),B(((Ze=a==null?void 0:a.dns)==null?void 0:Ze.servers)||[]),j((a==null?void 0:a.fakedns)||[]),pe(a!=null&&a.observatory?"observatory":a!=null&&a.burstObservatory?"burstObservatory":""),Te(it=>it+1))},[a,f,te,ot]);const{mutate:Jt,isLoading:qt}=Lr(o,{onSuccess:()=>{g({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:b=>{var w,se;g({title:t("core.generalErrorMessage"),description:((se=(w=b.response)==null?void 0:w.data)==null?void 0:se.detail)||b.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),wt=f.handleSubmit(({config:b})=>{r(b).then(()=>{f.reset({config:b}),ae.current=Ci(b),g({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(w=>{let se=t("core.generalErrorMessage");typeof w.response._data.detail=="object"&&(se=w.response._data.detail[Object.keys(w.response._data.detail)[0]]),typeof w.response._data.detail=="string"&&(se=w.response._data.detail),g({title:se,status:"error",isClosable:!0,position:"top",duration:3e3})})}),dt=async()=>{const b=await ze("/panel/xray/getOutboundsTraffic");b!=null&&b.success&&k(b.obj)},lr=()=>{Ae(null),y()},Sr=()=>{Ae(null),S()},pr=b=>{Ae(b),S()},xr=b=>{const w=ee();b<0||b>=w.length||(w.splice(b,1),Ne(w))},cr=(b,w)=>{const se=ee();if(b<0||b>=se.length||w<0||w>=se.length)return;const[Ze]=se.splice(b,1);se.splice(w,0,Ze),Ne(se)},mr=b=>{cr(b,b-1)},gr=b=>{cr(b,b+1)},re=()=>{R(null),E()},_e=b=>{R(b),E()},Y=b=>{const w=et();w.splice(b,1),yt(w)},Ge=(b,w)=>{const se=et();if(b<0||b>=se.length||w<0||w>=se.length)return;const[Ze]=se.splice(b,1);se.splice(w,0,Ze),yt(se)},kt=b=>{const w=et();I!==null&&I>=0&&I<w.length?w[I]=b:w.push(b),yt(w),R(null)},Vt=()=>{R(null),T()},Et=()=>{ce()},Nt=b=>{ce()},ut=b=>{const w=[...Ce],se=w.splice(b,1)[0];f.setValue("config.routing.balancers",w,{shouldDirty:!0}),Ee(w);const Ze={...f.getValues("config")};Ze.observatory&&(Ze.observatory.subjectSelector=Ze.observatory.subjectSelector.filter(it=>it!==se.tag)),Ze.burstObservatory&&(Ze.burstObservatory.subjectSelector=Ze.burstObservatory.subjectSelector.filter(it=>it!==se.tag)),f.setValue("config",Ze,{shouldDirty:!0})},ht=()=>{A()},At=b=>{A()},rr=b=>{const w=[...ve];w.splice(b,1),f.setValue("config.dns.servers",w,{shouldDirty:!0}),B(w)},vr=()=>{ge()},Vr=b=>{ge()},G=b=>{const w=[...U];w.splice(b,1),f.setValue("config.fakedns",w.length>0?w:null,{shouldDirty:!0}),j(w)},Ie=b=>{var w,se,Ze,it,je;switch(b.protocol){case"vmess":case"vless":return((w=b.settings.vnext)==null?void 0:w.map(Ct=>`${Ct.address}:${Ct.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((se=b.settings.servers)==null?void 0:se.map(Ct=>`${Ct.address}:${Ct.port}`))||[];case"dns":return[`${(Ze=b.settings)==null?void 0:Ze.address}:${(it=b.settings)==null?void 0:it.port}`];case"wireguard":return((je=b.settings.peers)==null?void 0:je.map(Ct=>Ct.endpoint))||[];default:return[]}},Ve=b=>{const w=de.find(se=>se.tag===b.tag);return w?`${Qn.sizeFormat(w.up)} / ${Qn.sizeFormat(w.down)}`:`${Qn.sizeFormat(0)} / ${Qn.sizeFormat(0)}`},Qe=d.exports.useMemo(()=>Array.isArray(K==null?void 0:K.outbounds)?K.outbounds:[],[K]),xt=d.exports.useMemo(()=>{var b;return Array.isArray((b=K==null?void 0:K.routing)==null?void 0:b.rules)?K.routing.rules:[]},[K]),Gt=d.exports.useMemo(()=>{var b;return Array.from(new Set(((b=K==null?void 0:K.inbounds)!=null?b:[]).map(w=>w==null?void 0:w.tag).filter(w=>Boolean(w))))},[K]),fr=d.exports.useMemo(()=>Array.from(new Set(Qe.map(b=>b==null?void 0:b.tag).filter(b=>Boolean(b)))),[Qe]),Mr=d.exports.useMemo(()=>{var b,w;return Array.from(new Set(((w=(b=K==null?void 0:K.routing)==null?void 0:b.balancers)!=null?w:[]).map(se=>se==null?void 0:se.tag).filter(se=>Boolean(se))))},[K]),dr=d.exports.useMemo(()=>Qe.length===0?-1:Qe.findIndex(b=>(b==null?void 0:b.protocol)==="freedom"),[Qe]),wr=d.exports.useMemo(()=>{var w,se;if(dr<0)return"";const b=Qe[dr];return(se=(w=b==null?void 0:b.settings)==null?void 0:w.domainStrategy)!=null?se:""},[dr,Qe]),$r=b=>{const w=f.getValues("config")||{},se=Array.isArray(w.outbounds)?JSON.parse(JSON.stringify(w.outbounds)):[],Ze=se.findIndex(Ct=>(Ct==null?void 0:Ct.protocol)==="freedom");if(Ze===-1)return;const it={...se[Ze]},je={...it.settings||{}};b?je.domainStrategy=b:delete je.domainStrategy,it.settings=je,se[Ze]=it,f.setValue("config.outbounds",se,{shouldDirty:!0}),Oe(se.map((Ct,Cr)=>({key:Cr,...Ct}))),Te(Ct=>Ct+1)},vn=d.exports.useMemo(()=>{var b;return(b=Qe.find(w=>(w==null?void 0:w.tag)==="warp"))!=null?b:null},[Qe]),Kr=d.exports.useMemo(()=>Qe.findIndex(b=>(b==null?void 0:b.tag)==="warp"),[Qe])!==-1,Jr=d.exports.useMemo(()=>{const b=xt.find(w=>w.outboundTag==="warp");return Array.isArray(b==null?void 0:b.domain)?b.domain:[]},[xt]),we=b=>{const w=b.map(je=>je.trim()).filter((je,Ct,Cr)=>je.length>0&&Cr.indexOf(je)===Ct),se=et(),Ze=se.findIndex(je=>je.outboundTag==="warp");if(w.length===0){Ze!==-1&&(se.splice(Ze,1),yt(se));return}const it={type:"field",outboundTag:"warp",domain:w};Ze!==-1?se[Ze]={...se[Ze],...it}:se.push(it),yt(se)},qr=b=>{const w=b.trim();!w||Jr.includes(w)||we([...Jr,w])},Yr=b=>{we(Jr.filter(w=>w!==b))},kr=We("white","blackAlpha.400"),ln=We("gray.200","whiteAlpha.200"),Gr=We("gray.600","gray.300"),Lt=b=>{var it;const w=ee(),se=(it=b.tag)!=null?it:"warp",Ze=w.findIndex(je=>(je==null?void 0:je.tag)===se);Ze>=0?w[Ze]=b:w.push(b),Ne(w)},wn=()=>{const b=ee(),w=b.findIndex(se=>(se==null?void 0:se.tag)==="warp");w!==-1&&(b.splice(w,1),Ne(b),we([]),Le(""),ne(""))},$t=b=>{const w=ee();$!==null&&$>=0&&$<w.length?w[$]=b:w.push(b),Ne(w),Ae(null)},cn=()=>{ye()},dn=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{Je(!1)}).catch(b=>{console.error("Error exiting fullscreen:",b)}):document.documentElement.requestFullscreen().then(()=>{Je(!0)}).catch(b=>{console.error("Error entering fullscreen:",b)})},un=()=>{var w,se,Ze,it;const b=f.getValues("config")||{};switch(N){case"inboundSettings":return JSON.stringify((w=b.inbounds)!=null?w:[],null,2);case"outboundSettings":return JSON.stringify((se=b.outbounds)!=null?se:[],null,2);case"routingRuleSettings":return JSON.stringify((it=(Ze=b.routing)==null?void 0:Ze.rules)!=null?it:[],null,2);case"xraySetting":default:return JSON.stringify(b!=null?b:{},null,2)}},hn=b=>{var w,se,Ze,it;try{const je=JSON.parse(b),Ct={...f.getValues("config")||{}};switch(N){case"inboundSettings":Ct.inbounds=je;break;case"outboundSettings":Ct.outbounds=je,te(je);break;case"routingRuleSettings":Ct.routing||(Ct.routing={}),Ct.routing.rules=je,ot(je);break;case"xraySetting":default:f.setValue("config",je,{shouldDirty:!0}),te((je==null?void 0:je.outbounds)||[]),ot(((w=je==null?void 0:je.routing)==null?void 0:w.rules)||[]),Ee(((Ze=(se=je==null?void 0:je.routing)==null?void 0:se.balancers)==null?void 0:Ze.map((Cr,Kn)=>{var zn;return{key:Kn,tag:Cr.tag||"",strategy:((zn=Cr.strategy)==null?void 0:zn.type)||"random",selector:Cr.selector||[],fallbackTag:Cr.fallbackTag||""}}))||[]),B(((it=je==null?void 0:je.dns)==null?void 0:it.servers)||[]),j((je==null?void 0:je.fakedns)||[]);return}f.setValue("config",Ct,{shouldDirty:!0})}catch{}},Nn=()=>{var w,se;const b=f.getValues("config")||{};return F==="observatory"?JSON.stringify((w=b.observatory)!=null?w:{},null,2):F==="burstObservatory"?JSON.stringify((se=b.burstObservatory)!=null?se:{},null,2):""},kn=b=>{try{const w=JSON.parse(b),se={...f.getValues("config")||{}};F==="observatory"&&(se.observatory=w),F==="burstObservatory"&&(se.burstObservatory=w),f.setValue("config",se,{shouldDirty:!0})}catch{}},Ki=b=>!b&&b!==0?[]:Array.isArray(b)?b.map(w=>typeof w=="string"?w.trim():String(w)).filter(Boolean):typeof b=="string"?b.split(",").map(w=>w.trim()).filter(Boolean):[String(b)],Cn=(b,w="blue")=>{const se=Ki(b);return se.length?e(Im,{chips:se,color:w}):e(h,{color:"gray.400",children:"-"})},hs=b=>{if(b==null||b===""||typeof b=="string"&&!b.trim())return e(h,{color:"gray.400",children:"-"});const w=typeof b=="string"?b:String(b);return w.length>30?e(Pm,{text:w,label:t("details")}):e(h,{children:w})},Ji=b=>{if(!b)return e(h,{color:"gray.400",children:"-"});try{const w=JSON.parse(b);if(w&&typeof w=="object"&&!Array.isArray(w)){const se=Object.entries(w);return se.length?e(z,{display:"flex",flexWrap:"wrap",gap:"1",children:se.map(([Ze,it])=>e(lt,{colorScheme:"purple",size:"sm",children:`${Ze}: ${String(it)}`},Ze))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:b})},qi=Nn(),Yi=un();return n(he,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(fe,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:n(fe,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(O,{size:"sm",colorScheme:"primary",isLoading:i,isDisabled:!xe||i,onClick:wt,w:{base:"full",sm:"auto"},children:t("core.save")}),e(O,{size:"sm",leftIcon:e($o,{}),isLoading:qt,onClick:()=>Jt(),variant:"outline",w:{base:"full",sm:"auto"},children:t(qt?"core.restarting":"core.restartCore")})]})}),n(cs,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[n(ds,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e(Xt,{children:n(M,{spacing:2,align:"center",children:[e(Qm,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e(Xt,{children:n(M,{spacing:2,align:"center",children:[e(Zm,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e(Xt,{children:n(M,{spacing:2,align:"center",children:[e(jm,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e(Xt,{children:n(M,{spacing:2,align:"center",children:[e(eg,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e(Xt,{children:n(M,{spacing:2,align:"center",children:[e(tg,{}),e(h,{as:"span",children:t("DNS")})]})}),e(Xt,{children:n(M,{spacing:2,align:"center",children:[e(rg,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e(Xt,{children:n(M,{spacing:2,align:"center",children:[e(ng,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),n(us,{children:[e(Qt,{children:n(he,{spacing:4,align:"stretch",children:[n(ha,{title:t("pages.xray.generalConfigs"),children:[e(tn,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:b=>n(rt,{id:b,size:"sm",maxW:"220px",value:wr,onChange:w=>$r(w.target.value),isDisabled:dr===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(w=>e("option",{value:w,children:w},w))]})}),e(tn,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:b=>e(St,{name:"config.routing.domainStrategy",control:f.control,render:({field:w})=>e(rt,{...w,id:b,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(se=>e("option",{value:se,children:se},se))})})})]}),e(z,{borderWidth:"1px",borderColor:ln,borderRadius:"lg",bg:kr,p:{base:3,md:4},children:n(he,{align:"stretch",spacing:3,children:[n(M,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(O,{variant:"outline",size:"sm",leftIcon:e(Ko,{}),onClick:_,children:Kr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:Gr,children:t("pages.xray.warpRoutingDesc")}),n(vs,{children:[Jr.length===0&&e(Zn,{children:e(lt,{colorScheme:"gray",variant:"subtle",children:e(ei,{children:t("core.empty","Empty")})})}),Jr.map(b=>e(Zn,{children:n(lt,{colorScheme:"primary",borderRadius:"full",children:[e(ei,{children:b}),e(Ti,{"aria-label":t("core.remove"),onClick:()=>Yr(b)})]})},b))]}),n(M,{spacing:3,flexWrap:"wrap",children:[e(rt,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:le,onChange:b=>{const{value:w}=b.target;w&&qr(w),Le("")},children:sg.map(b=>e("option",{value:b.value,children:b.label},b.value))}),n(M,{spacing:2,maxW:"320px",flex:"1",children:[e(De,{size:"sm",value:Ke,onChange:b=>ne(b.target.value),placeholder:"geosite:google"}),e(O,{size:"sm",colorScheme:"primary",onClick:()=>{qr(Ke),ne("")},isDisabled:!Ke.trim(),children:t("core.add")})]})]})]})}),n(ha,{title:t("pages.xray.statistics"),children:[e(tn,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:b=>e(St,{name:"config.policy.system.statsInboundUplink",control:f.control,render:({field:w})=>e(gt,{id:b,isChecked:!!w.value,onChange:se=>w.onChange(se.target.checked)})})}),e(tn,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:b=>e(St,{name:"config.policy.system.statsInboundDownlink",control:f.control,render:({field:w})=>e(gt,{id:b,isChecked:!!w.value,onChange:se=>w.onChange(se.target.checked)})})}),e(tn,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:b=>e(St,{name:"config.policy.system.statsOutboundUplink",control:f.control,render:({field:w})=>e(gt,{id:b,isChecked:!!w.value,onChange:se=>w.onChange(se.target.checked)})})}),e(tn,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:b=>e(St,{name:"config.policy.system.statsOutboundDownlink",control:f.control,render:({field:w})=>e(gt,{id:b,isChecked:!!w.value,onChange:se=>w.onChange(se.target.checked)})})})]}),n(ha,{title:t("pages.xray.logConfigs"),children:[e(tn,{label:t("pages.xray.logLevel"),controlId:"log-level",children:b=>e(St,{name:"config.log.loglevel",control:f.control,render:({field:w})=>e(rt,{...w,id:b,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(se=>e("option",{value:se,children:se},se))})})}),e(tn,{label:t("pages.xray.accessLog"),controlId:"access-log",children:b=>e(St,{name:"config.log.access",control:f.control,render:({field:w})=>n(rt,{...w,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(se=>e("option",{value:se,children:se},se))]})})}),e(tn,{label:t("pages.xray.errorLog"),controlId:"error-log",children:b=>e(St,{name:"config.log.error",control:f.control,render:({field:w})=>n(rt,{...w,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(se=>e("option",{value:se,children:se},se))]})})}),e(tn,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:b=>e(St,{name:"config.log.maskAddress",control:f.control,render:({field:w})=>n(rt,{...w,id:b,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(se=>e("option",{value:se,children:se},se))]})})}),e(tn,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:b=>e(St,{name:"config.log.dnsLog",control:f.control,render:({field:w})=>e(gt,{id:b,isChecked:!!w.value,onChange:se=>w.onChange(se.target.checked)})})})]})]})}),e(Qt,{children:n(he,{spacing:4,align:"stretch",children:[e(O,{leftIcon:e(Bs,{}),...Ks,onClick:re,children:t("pages.xray.rules.add")}),e(Js,{children:n(qs,{minW:"1100px",children:[n(fn,{children:[n(zt,{children:[e($e,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e($e,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e($e,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e($e,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e($e,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e($e,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e($e,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e($e,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),n(zt,{children:[e($e,{children:t("IP",{defaultValue:"IP"})}),e($e,{children:t("port",{defaultValue:"Port"})}),e($e,{children:t("network",{defaultValue:"Network"})}),e($e,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e($e,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e($e,{children:t("IP",{defaultValue:"IP"})}),e($e,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e($e,{children:t("port",{defaultValue:"Port"})}),e($e,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e($e,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),n(sn,{children:[V.length===0&&e(zt,{children:e(Ue,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),V.map((b,w)=>n(zt,{children:[e(Ue,{children:n(he,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:w+1}),n(M,{spacing:1,children:[e(He,{"aria-label":"move up",icon:e(Bo,{}),size:"xs",variant:"ghost",isDisabled:w===0,onClick:()=>Ge(w,w-1)}),e(He,{"aria-label":"move down",icon:e(Vo,{}),size:"xs",variant:"ghost",isDisabled:w===V.length-1,onClick:()=>Ge(w,w+1)})]})]})}),e(Ue,{children:Cn(b.source,"blue")}),e(Ue,{children:hs(b.sourcePort)}),e(Ue,{children:Cn(b.network,"purple")}),e(Ue,{children:Cn(b.protocol,"green")}),e(Ue,{children:Ji(b.attrs)}),e(Ue,{children:Cn(b.ip,"blue")}),e(Ue,{children:Cn(b.domain,"blue")}),e(Ue,{children:hs(b.port)}),e(Ue,{children:Cn(b.inboundTag,"teal")}),e(Ue,{children:Cn(b.user,"cyan")}),e(Ue,{children:hs(b.outboundTag)}),e(Ue,{children:hs(b.balancerTag)}),e(Ue,{children:n(M,{spacing:1,children:[e(He,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>_e(w)}),e(He,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Y(w)})]})})]},b.key))]})]})})]})}),e(Qt,{children:n(he,{spacing:4,align:"stretch",children:[n(M,{children:[e(O,{leftIcon:e(Bs,{}),...Ks,onClick:Sr,children:t("pages.xray.outbound.addOutbound")}),e(O,{leftIcon:e(Ko,{}),size:"xs",variant:"ghost",onClick:_,children:Kr?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(O,{leftIcon:e($o,{}),size:"xs",variant:"ghost",onClick:dt,children:t("refresh")})]}),e(Js,{children:n(qs,{minW:"880px",children:[e(fn,{children:n(zt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.outbound.tag")}),e($e,{children:t("protocol")}),e($e,{children:t("pages.xray.outbound.address")}),e($e,{children:t("pages.inbounds.traffic")})]})}),e(sn,{children:Re.map((b,w)=>{var se,Ze,it;return n(zt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(He,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(Bo,{}),size:"xs",variant:"ghost",isDisabled:w===0,onClick:()=>mr(w)}),e(He,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(Vo,{}),size:"xs",variant:"ghost",isDisabled:w===Re.length-1,onClick:()=>gr(w)}),e(He,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>pr(w)}),e(He,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>xr(w)})]})}),e(Ue,{children:b.tag}),n(Ue,{children:[e(lt,{colorScheme:"purple",children:b.protocol}),["vmess","vless","trojan","shadowsocks"].includes(b.protocol)&&n(Bt,{children:[e(lt,{colorScheme:"blue",children:(se=b.streamSettings)==null?void 0:se.network}),((Ze=b.streamSettings)==null?void 0:Ze.security)==="tls"&&e(lt,{colorScheme:"green",children:"tls"}),((it=b.streamSettings)==null?void 0:it.security)==="reality"&&e(lt,{colorScheme:"green",children:"reality"})]})]}),e(Ue,{children:Ie(b).map(je=>e(h,{children:je},je))}),e(Ue,{children:e(lt,{colorScheme:"green",children:Ve(b)})})]},b.key)})})]})})]})}),e(Qt,{children:n(he,{spacing:4,align:"stretch",children:[e(O,{leftIcon:e(Bs,{}),...Ks,onClick:Et,children:t("pages.xray.balancer.addBalancer")}),e(Js,{children:n(qs,{minW:"680px",children:[e(fn,{children:n(zt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.balancer.tag")}),e($e,{children:t("pages.xray.balancer.balancerStrategy")}),e($e,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e(sn,{children:Ce.map((b,w)=>n(zt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(He,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>Nt()}),e(He,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ut(w)})]})}),e(Ue,{children:b.tag}),e(Ue,{children:e(lt,{colorScheme:b.strategy==="random"?"purple":"green",children:b.strategy==="random"?"Random":b.strategy==="roundRobin"?"Round Robin":b.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Ue,{children:b.selector.map(se=>e(lt,{colorScheme:"blue",m:1,children:se},se))})]},b.key))})]})}),(((Ms=f.getValues("config"))==null?void 0:Ms.observatory)||((Us=f.getValues("config"))==null?void 0:Us.burstObservatory))&&n(he,{spacing:3,align:"stretch",children:[e(oi,{onChange:b=>{pe(b),Te(w=>w+1)},value:F,children:n(M,{spacing:3,children:[((Ls=f.getValues("config"))==null?void 0:Ls.observatory)&&e(Or,{value:"observatory",children:"Observatory"}),((Os=f.getValues("config"))==null?void 0:Os.burstObservatory)&&e(Or,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(z,{h:"300px",children:e(Da,{json:qi,onChange:b=>kn(b)},`obs-${F}-${Pe}`)})]})]})}),e(Qt,{children:n(he,{spacing:4,align:"stretch",children:[n(C,{display:"flex",alignItems:"center",children:[e(D,{children:t("pages.xray.dns.enable")}),e(St,{name:"config.dns",control:f.control,render:({field:b})=>e(gt,{isChecked:!!b.value,onChange:w=>{const se={...f.getValues("config")};w.target.checked?se.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete se.dns,delete se.fakedns),f.setValue("config",se,{shouldDirty:!0}),B([]),j([])}})})]}),ve.length>0&&n(Bt,{children:[e(O,{leftIcon:e(Bs,{}),...Ks,onClick:ht,children:t("pages.xray.dns.add")}),e(Js,{children:n(qs,{minW:"720px",children:[e(fn,{children:n(zt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.outbound.address")}),e($e,{children:t("pages.xray.dns.domains")}),e($e,{children:t("pages.xray.dns.expectIPs")})]})}),e(sn,{children:ve.map((b,w)=>n(zt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(He,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>At()}),e(He,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>rr(w)})]})}),e(Ue,{children:typeof b=="object"?b.address:b}),e(Ue,{children:typeof b=="object"?Jo(b.domains):""}),e(Ue,{children:typeof b=="object"?Jo(b.expectIPs):""})]},w))})]})})]}),U.length>0&&n(Bt,{children:[e(O,{leftIcon:e(Bs,{}),...Ks,onClick:vr,children:t("pages.xray.fakedns.add")}),e(Js,{children:n(qs,{minW:"520px",children:[e(fn,{children:n(zt,{children:[e($e,{children:"#"}),e($e,{children:t("pages.xray.fakedns.ipPool")}),e($e,{children:t("pages.xray.fakedns.poolSize")})]})}),e(sn,{children:U.map((b,w)=>n(zt,{children:[e(Ue,{children:n(M,{children:[e(h,{children:w+1}),e(He,{"aria-label":"edit",icon:e($s,{}),size:"xs",variant:"ghost",onClick:()=>Vr()}),e(He,{"aria-label":"delete",icon:e(Vs,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>G(w)})]})}),e(Ue,{children:b.ipPool}),e(Ue,{children:b.poolSize})]},w))})]})})]})]})}),e(Qt,{children:n(he,{spacing:4,align:"stretch",children:[n(z,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(z,{px:2,children:e(oi,{onChange:b=>{Z(b),Te(w=>w+1)},value:N,children:n(M,{spacing:3,wrap:"wrap",children:[e(Or,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Or,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Or,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Or,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),n(z,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(He,{position:Se?"fixed":"absolute",top:2,right:2,"aria-label":Se?"Exit Full Screen":"Full Screen",icon:Se?e(Xm,{}):e(Gm,{}),onClick:dn,zIndex:Se?1101:10}),e(z,{w:Se?"100vw":"100%",h:Se?"100vh":"100%",position:Se?"fixed":"relative",top:Se?0:"auto",left:Se?0:"auto",zIndex:Se?1e3:"auto",children:e(Da,{json:Yi,onChange:b=>{hn(b)}},`advanced-${N}-${Pe}`)}),Se&&Q&&e(O,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:dn,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(Qt,{children:e(z,{children:e(ic,{showTitle:!1})})})]})]}),e(zm,{isOpen:x,onClose:lr,mode:$!==null?"edit":"create",initialOutbound:$!==null?Qe[$]:null,onSubmitOutbound:$t}),e(Fm,{isOpen:v,mode:I!==null?"edit":"create",initialRule:I!==null&&xt[I]||null,availableInboundTags:Gt,availableOutboundTags:fr,availableBalancerTags:Mr,onSubmit:kt,onClose:Vt}),e(Ym,{isOpen:oe,onClose:cn,initialOutbound:vn,onSave:Lt,onDelete:wn}),e(Hm,{isOpen:L,onClose:P,form:f,setBalancersData:Ee}),e(Bm,{isOpen:W,onClose:X,form:f,setDnsServers:B}),e(Vm,{isOpen:q,onClose:H,form:f,setFakeDns:j})]})},ag=({isOpen:t,onClose:s,onSubmit:r,isSaving:l,allHosts:a,allAdmins:i,initialService:o})=>{var K,xe,Re,Oe;const{t:c}=qe(),[u,p]=d.exports.useState((K=o==null?void 0:o.name)!=null?K:""),[m,g]=d.exports.useState((xe=o==null?void 0:o.description)!=null?xe:""),[x,S]=d.exports.useState((Re=o==null?void 0:o.admin_ids)!=null?Re:[]),[y,v]=d.exports.useState((Oe=o==null?void 0:o.hosts.map(V=>V.id))!=null?Oe:[]),[E,T]=d.exports.useState(""),[L,ce]=d.exports.useState(""),[P,W]=d.exports.useState(null),A=er();d.exports.useEffect(()=>{var V,be,Ce,Ee;t&&(p((V=o==null?void 0:o.name)!=null?V:""),g((be=o==null?void 0:o.description)!=null?be:""),S((Ce=o==null?void 0:o.admin_ids)!=null?Ce:[]),v((Ee=o==null?void 0:o.hosts.map(ve=>ve.id))!=null?Ee:[]),T(""),ce(""))},[t,o]);const X=d.exports.useMemo(()=>new Map(a.map(V=>[V.id,V])),[a]),q=d.exports.useMemo(()=>a.filter(V=>!y.includes(V.id)&&!V.isDisabled),[a,y]),ge=d.exports.useMemo(()=>{const V=L.trim().toLowerCase();return V?q.filter(be=>{const Ce=be.label.toLowerCase(),Ee=be.inboundTag.toLowerCase(),ve=be.protocol.toLowerCase();return Ce.includes(V)||Ee.includes(V)||ve.includes(V)}):q},[q,L]),H=d.exports.useMemo(()=>{const V=E.trim().toLowerCase();return V?i.filter(be=>be.username.toLowerCase().includes(V)):i},[E,i]),oe=d.exports.useMemo(()=>new Set(x),[x]),_=V=>{S(be=>be.includes(V)?be.filter(Ce=>Ce!==V):[...be,V])},ye=V=>{v(be=>be.includes(V)?be.filter(Ce=>Ce!==V):[...be,V])},f=(V,be)=>{v(Ce=>{const Ee=Ce.indexOf(V);if(Ee===-1)return Ce;const ve=be==="up"?Ee-1:Ee+1;if(ve<0||ve>=Ce.length)return Ce;const B=[...Ce];return[B[Ee],B[ve]]=[B[ve],B[Ee]],B})},ae=async()=>{if(!u.trim()){A({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!y.length){A({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const V=y.map((be,Ce)=>({host_id:be,sort:Ce}));await r({name:u.trim(),description:(m==null?void 0:m.trim())||null,admin_ids:x,hosts:V},o==null?void 0:o.id)};return n(Wt,{isOpen:t,onClose:s,size:"5xl",children:[e(_t,{}),n(Ft,{children:[e(It,{children:o?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Ht,{}),e(Dt,{children:n(fe,{spacing:6,children:[n(M,{spacing:4,children:[e(or,{label:c("services.fields.name","Name"),value:u,onChange:V=>p(V.target.value),maxLength:128,isRequired:!0}),e(or,{label:c("services.fields.description","Description"),value:m!=null?m:"",onChange:V=>g(V.target.value),maxLength:256})]}),n(z,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),n(fe,{spacing:3,children:[e(or,{value:E,onChange:V=>T(V.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(he,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:i.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):H.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):H.map(V=>{const be=oe.has(V.id);return e(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:be?"primary.400":"gray.200",bg:be?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:be?"primary.300":"gray.600",bg:be?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>_(V.id),onKeyDown:Ce=>{(Ce.key==="Enter"||Ce.key===" ")&&(Ce.preventDefault(),_(V.id))},role:"button",tabIndex:0,children:n(pt,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:V.username}),be&&e(Br,{colorScheme:"primary",children:c("services.selected","Selected")})]})},V.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),n(ai,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(yn,{children:n(zr,{variant:"outline",h:"full",children:[e(ws,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(An,{children:n(fe,{spacing:3,children:[e(or,{value:L,onChange:V=>ce(V.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(he,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:q.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):ge.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):ge.map(V=>n(z,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:P===V.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>W(V.id),onMouseLeave:()=>W(null),onClick:()=>ye(V.id),children:[e(h,{fontWeight:"medium",children:V.label}),n(h,{fontSize:"sm",color:"gray.500",children:[V.protocol.toUpperCase()," - ",V.inboundTag]})]},V.id))})]})})]})}),e(yn,{children:n(zr,{variant:"outline",h:"full",children:[e(ws,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(An,{children:n(he,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[y.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),y.map((V,be)=>{const Ce=X.get(V);return Ce?e(Ed.div,{layout:!0,children:n(pt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[n(z,{children:[n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:Ce.label}),Ce.isDisabled&&e(Br,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),n(h,{fontSize:"sm",color:"gray.500",children:[Ce.protocol.toUpperCase()," - ",Ce.inboundTag]})]}),n(M,{spacing:1,children:[e(mt,{label:c("services.moveUp","Move up"),children:e(He,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(El,{width:16}),onClick:()=>f(V,"up"),isDisabled:be===0})}),e(mt,{label:c("services.moveDown","Move down"),children:e(He,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(Nl,{width:16}),onClick:()=>f(V,"down"),isDisabled:be===y.length-1})}),e(mt,{label:c("services.removeHost","Remove host"),children:e(He,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(Sn,{width:16}),onClick:()=>ye(V)})})]})]})},V):null})]})})]})})]})]})}),e(Ut,{children:n(M,{justify:"flex-end",w:"full",children:[e(O,{onClick:s,children:c("cancel")}),e(O,{colorScheme:"primary",onClick:ae,isLoading:l,children:c(o?"saveChanges":"create")})]})})]})]})},og=()=>{var Se,Je;const{t}=qe(),s=er(),{userData:r,getUserIsSuccess:l}=hr(),a=l&&Boolean((Se=r.permissions)==null?void 0:Se.sections.services),i=jn(),o=xn(),c=Kl(),{inbounds:u,refetchUsers:p}=Tt(),m=Zt(),[g,x]=d.exports.useState(null);d.exports.useEffect(()=>{!l||!a||(i.fetchServices(),o.fetchAdmins({limit:500,offset:0}),ci(),c.fetchHosts())},[l,a]);const S=d.exports.useMemo(()=>o.admins.slice().sort((N,Z)=>N.username.localeCompare(Z.username)).map(N=>({id:N.id,username:N.username})),[o.admins]),y=d.exports.useMemo(()=>{var Z,F;const N=[];for(const[pe,Q]of Object.entries(c.hosts)){const Pe=(Z=Array.from(u.values()).flat().find(le=>le.tag===pe))!=null?Z:null,Te=(F=Pe==null?void 0:Pe.protocol)!=null?F:"unknown";Q.forEach(le=>{le.id!=null&&N.push({id:le.id,label:le.remark,inboundTag:pe,protocol:Te,isDisabled:Boolean(le.is_disabled)})})}return N},[c.hosts,u]),v=()=>{x(null),m.onOpen()},E=async N=>{try{const Z=await i.fetchServiceDetail(N);x(Z),m.onOpen()}catch{s({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},T=async(N,Z)=>{var F,pe;try{Z?(await i.updateService(Z,N),s({status:"success",title:t("services.updated","Service updated")})):(await i.createService(N),s({status:"success",title:t("services.created","Service created")})),p(!0),m.onClose()}catch(Q){s({status:"error",title:(pe=(F=Q==null?void 0:Q.data)==null?void 0:F.detail)!=null?pe:t("services.saveFailed","Failed to save service")})}},L=async N=>{var Z,F;try{const pe=await i.fetchServiceDetail(N);Re(pe),de()}catch(pe){s({status:"error",title:(F=(Z=pe==null?void 0:pe.data)==null?void 0:Z.detail)!=null?F:t("services.deleteFailed","Unable to delete service")})}},ce=async N=>{var Z,F;try{await i.resetServiceUsage(N),s({status:"success",title:t("services.resetSuccess","Usage reset")})}catch(pe){s({status:"error",title:(F=(Z=pe==null?void 0:pe.data)==null?void 0:Z.detail)!=null?F:t("services.resetFailed","Failed to reset usage")})}},[P,W]=d.exports.useState(null),[A,X]=d.exports.useState(!1),{isOpen:q,onOpen:ge,onClose:H}=Zt(),oe=d.exports.useRef(null),_=N=>{W(N),ge()},ye=async()=>{if(P!=null){X(!0);try{await ce(P)}finally{X(!1),H()}}},f=P!=null?(Je=i.services.find(N=>N.id===P))==null?void 0:Je.name:void 0,ae=()=>{Re(null),k()},K=async()=>{var Z,F;if(!xe)return;const N={mode:xe.user_count?Oe:"delete_users",unlink_admins:be};if(N.mode==="transfer_users"){if(!Ee){s({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}N.target_service_id=Ee}U(!0);try{await i.deleteService(xe.id,N),s({status:"success",title:t("services.deleted","Service removed")}),p(!0),ae()}catch(pe){s({status:"error",title:(F=(Z=pe==null?void 0:pe.data)==null?void 0:Z.detail)!=null?F:t("services.deleteFailed","Unable to delete service")})}finally{U(!1)}},[xe,Re]=d.exports.useState(null),[Oe,V]=d.exports.useState("delete_users"),[be,Ce]=d.exports.useState(!1),[Ee,ve]=d.exports.useState(null),[B,U]=d.exports.useState(!1),{isOpen:j,onOpen:de,onClose:k}=Zt(),I=d.exports.useMemo(()=>xe?i.services.filter(N=>N.id!==xe.id):i.services,[xe,i.services]);d.exports.useEffect(()=>{xe&&(V("delete_users"),Ce(xe.admin_ids.length>0),ve(null))},[xe]),d.exports.useEffect(()=>{Oe==="delete_users"&&ve(null)},[Oe]);const R=N=>e(Cl,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:Z})=>n(Bt,{children:[n(_l,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[n(z,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:N.name}),N.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:Z?3:1,mt:1,children:N.description})]}),n(he,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[n(M,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:N.host_count})]}),n(M,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:N.user_count})]})]}),e(Nd,{})]}),e(Dl,{pt:0,pb:4,children:n(fe,{spacing:4,children:[n(Fe,{columns:2,spacing:3,children:[n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:Be(N.used_traffic)})]}),n(z,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:Be(N.lifetime_used_traffic)})]})]}),n(fe,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),n(M,{spacing:2,flexWrap:"wrap",children:[e(mt,{label:t("services.view","View"),children:e(He,{"aria-label":"View",icon:e(ii,{width:18}),size:"sm",variant:"outline",onClick:F=>{F.stopPropagation(),i.fetchServiceDetail(N.id)}})}),e(mt,{label:t("services.edit","Edit"),children:e(He,{"aria-label":"Edit",icon:e(ya,{width:18}),size:"sm",variant:"outline",onClick:F=>{F.stopPropagation(),E(N.id)},isDisabled:!a})}),e(mt,{label:t("services.resetUsage","Reset usage"),children:e(He,{"aria-label":"Reset usage",icon:e(on,{width:18}),size:"sm",variant:"outline",onClick:F=>{F.stopPropagation(),_(N.id)},isDisabled:!a})}),e(mt,{label:t("services.delete","Delete"),children:e(He,{"aria-label":"Delete",icon:e(Sn,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:F=>{F.stopPropagation(),L(N.id)},isDisabled:!a})})]})]})]})})]})},`service-accordion-${N.id}`),$=N=>n(zt,{children:[e(Ue,{children:n(he,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:N.name}),N.description&&e(h,{fontSize:"sm",color:"gray.500",children:N.description})]})}),e(Ue,{children:N.host_count}),e(Ue,{children:N.user_count}),e(Ue,{children:Be(N.used_traffic)}),e(Ue,{children:Be(N.lifetime_used_traffic)}),e(Ue,{children:n(M,{spacing:2,children:[e(mt,{label:t("services.view","View"),children:e(He,{"aria-label":"View",icon:e(ii,{width:18}),size:"sm",variant:"ghost",onClick:()=>i.fetchServiceDetail(N.id)})}),a&&n(Bt,{children:[e(mt,{label:t("services.edit","Edit"),children:e(He,{"aria-label":"Edit",icon:e(ya,{width:18}),size:"sm",variant:"ghost",onClick:()=>E(N.id)})}),e(mt,{label:t("services.resetUsage","Reset usage"),children:e(He,{"aria-label":"Reset usage",icon:e(on,{width:18}),size:"sm",variant:"ghost",onClick:()=>_(N.id)})}),e(mt,{label:t("services.delete","Delete"),children:e(He,{"aria-label":"Delete",icon:e(Sn,{width:18}),size:"sm",variant:"ghost",onClick:()=>L(N.id)})})]})]})})]},N.id),Ae=i.serviceDetail;return l?a?n(he,{spacing:4,align:"stretch",children:[n(pt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[n(z,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),a&&e(O,{leftIcon:e(Pn,{width:18}),colorScheme:"primary",onClick:v,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(zr,{variant:"outline",children:e(An,{children:i.isLoading?e(pt,{justify:"center",py:10,children:e(Rt,{})}):n(Bt,{children:[e(kl,{allowToggle:!0,display:{base:"block",md:"none"},children:i.services.map(R)}),e(z,{display:{base:"none",md:"block"},overflowX:"auto",children:n(ns,{variant:"simple",children:[e(fn,{children:n(zt,{children:[e($e,{children:t("services.columns.name","Name")}),e($e,{children:t("services.columns.hosts","Hosts")}),e($e,{children:t("services.columns.users","Users")}),e($e,{children:t("services.columns.usage","Usage")}),e($e,{children:t("services.columns.lifetime","Lifetime")}),e($e,{children:t("services.columns.actions","Actions")})]})}),e(sn,{children:i.services.map($)})]})})]})})}),Ae&&n(zr,{variant:"outline",children:[e(ws,{children:n(pt,{justify:"space-between",align:"center",children:[n(z,{children:[e(h,{fontWeight:"semibold",children:Ae.name}),Ae.description&&e(h,{fontSize:"sm",color:"gray.500",children:Ae.description})]}),e(Br,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:Ae.user_count})})]})}),e(An,{children:n(Fe,{columns:{base:1,md:2},spacing:6,children:[n(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(fe,{spacing:2,children:Ae.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):Ae.admins.map(N=>n(pt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:N.username}),n(h,{fontSize:"sm",color:"gray.500",children:[Be(N.used_traffic)," /"," ",Be(N.lifetime_used_traffic)]})]},N.id))})]}),n(z,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(fe,{spacing:2,children:Ae.hosts.map(N=>n(pt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[n(z,{children:[e(h,{fontWeight:"medium",children:N.remark}),n(h,{fontSize:"sm",color:"gray.500",children:[N.inbound_protocol.toUpperCase()," - ",N.inbound_tag]})]}),n(Br,{colorScheme:"gray",children:["#",N.sort+1]})]},N.id))})]})]})})]}),e(Ds,{isOpen:q,leastDestructiveRef:oe,onClose:H,isCentered:!0,motionPreset:"slideInBottom",children:e(_t,{children:n(As,{mx:{base:4,sm:0},children:[e(It,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(Dt,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:f!=null?f:t("services.thisService","this service")})}),n(Ut,{children:[e(O,{ref:oe,onClick:H,children:t("cancel","Cancel")}),e(O,{colorScheme:"primary",ml:3,onClick:ye,isLoading:A,children:t("services.resetUsage","Reset usage")})]})]})})}),n(Wt,{isOpen:j,onClose:ae,size:"lg",children:[e(_t,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Ft,{children:[n(It,{children:[t("services.deleteDialogTitle","Delete Service"),xe?` \u2013 ${xe.name}`:""]}),e(Ht,{}),e(Dt,{children:xe?n(he,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:xe.name})}),xe.admin_ids.length>0?e(Er,{isChecked:be,onChange:N=>Ce(N.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),xe.user_count>0?n(he,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:xe.user_count})}),e(oi,{value:Oe,onChange:N=>V(N),children:n(fe,{align:"flex-start",spacing:2,children:[e(Or,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Or,{value:"transfer_users",isDisabled:I.length===0,children:I.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),Oe==="transfer_users"&&I.length>0&&n(C,{isRequired:!0,children:[e(D,{children:t("services.selectTargetService","Target service")}),e(rt,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:Ee!=null?Ee:"",onChange:N=>ve(N.target.value?Number(N.target.value):null),children:I.map(N=>e("option",{value:N.id,children:N.name},N.id))}),e(ur,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):n(Wr,{status:"info",borderRadius:"md",children:[e(Fr,{}),e(Wn,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),n(Ut,{gap:3,children:[e(O,{variant:"ghost",onClick:ae,children:t("cancel","Cancel")}),e(O,{colorScheme:"red",onClick:K,isLoading:B,isDisabled:Boolean((xe==null?void 0:xe.user_count)&&Oe==="transfer_users"&&I.length>0&&!Ee),children:t("services.delete","Delete")})]})]})]}),e(ag,{isOpen:m.isOpen,onClose:m.onClose,onSubmit:T,isSaving:i.isSaving,allHosts:y,allAdmins:S,initialService:g!=null?g:void 0})]}):n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(pt,{justify:"center",align:"center",h:"full",py:10,children:e(Rt,{})})};Me.extend(mi);const qo=ie(pi,{baseStyle:{w:4,h:4}}),lg=ie(Wa,{baseStyle:{w:4,h:4}}),cg={key:"30d",label:"30d",amount:30,unit:"day"},dg=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=Me.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},Yo=t=>Me(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Go=t=>Me(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",_i=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return Me.utc(r).valueOf()},Xo=t=>{const s=t.unit==="hour"?"hour":"day",r=Me().utc().endOf(s),l=Math.max(t.amount-1,0),a=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:a.toDate(),end:r.toDate(),unit:t.unit}},ug=(t,s)=>{const r=Me(t),l=Me(s),[a,i]=r.isBefore(l)?[r,l]:[l,r],o=a.startOf("day"),c=i.endOf("day"),u=o.isSame(c,"day");return{key:"custom",start:o.toDate(),end:c.toDate(),unit:u?"hour":"day"}},hg=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Be(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Be(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},pg=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Be(Number(r)||0,2),title:{formatter:(r,l)=>{var a,i,o,c;return(c=(o=(i=(a=l==null?void 0:l.w)==null?void 0:a.globals)==null?void 0:i.labels)==null?void 0:o[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),mg=()=>{var B,U,j,de;const{t}=qe(),{colorMode:s}=Zr(),{admins:r}=xn(),l="auto-end",a=(B=Tr({base:"bottom",md:"auto-end"}))!=null?B:l,[i,o]=d.exports.useState([]),[c,u]=d.exports.useState([]),[p,m]=d.exports.useState(null),[g,x]=d.exports.useState([]),[S,y]=d.exports.useState(!1),v=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),E=(U=v.find(k=>k.key==="30d"))!=null?U:cg,[T,L]=d.exports.useState(()=>Xo(E)),[ce,P]=d.exports.useState(E.key),[W,A]=d.exports.useState(null),[X,q]=d.exports.useState([]),[ge,H]=d.exports.useState(!1),[oe,_]=d.exports.useState(!1),[ye,f]=d.exports.useState([T.start,T.end]);d.exports.useMemo(()=>{var k;return(k=c.find(I=>I.id===p))!=null?k:null},[c,p]);const ae=d.exports.useMemo(()=>{if(!p)return i;const k=new Set(g.map(R=>R.username).filter(R=>Boolean(R))),I=i.filter(R=>k.has(R.username));return I.length?I:i},[i,p,g]),K=d.exports.useMemo(()=>g.reduce((k,I)=>k+(I.used_traffic||0),0),[g]),xe=d.exports.useMemo(()=>g.map(k=>k.used_traffic||0),[g]),Re=d.exports.useMemo(()=>g.map(k=>k.username||t("services.unassignedAdmin","Unassigned")),[g,t]),Oe=d.exports.useMemo(()=>pg(s,Re),[s,Re]);d.exports.useEffect(()=>{oe||f([T.start,T.end])},[oe,T.start,T.end]),d.exports.useEffect(()=>{let k=!1;return(async()=>{var R;try{const $=await ze("/v2/services",{query:{limit:500}});if(k||!$)return;const Ae=(R=$.services)!=null?R:[];u(Ae),m(Se=>Se!==null?Se:Ae.length?Ae[0].id:null)}catch{k||u([])}})(),()=>{k=!0}},[]),d.exports.useEffect(()=>{if(!p){x([]);return}let k=!1;return y(!0),ze(`/v2/services/${p}/usage/admins`,{query:{start:Yo(T.start),end:Go(T.end)}}).then(I=>{var R;k||!I||x((R=I.admins)!=null?R:[])}).catch(()=>{k||x([])}).finally(()=>{k||y(!1)}),()=>{k=!0}},[p,T.start,T.end,T.unit]),d.exports.useEffect(()=>{let k=!1;return(async()=>{try{const R=await ze("/admins");if(k)return;Array.isArray(R)?o(R):o(R.admins||[])}catch(R){console.error("Failed to load all admins:",R),o(r||[])}})(),()=>{k=!0}},[r]),d.exports.useEffect(()=>{if(!W)return;let k=!1;H(!0);const I=T.unit==="hour",R={start:Yo(T.start),end:Go(T.end)};I&&(R.granularity="hour");const $=I?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:W,endpoint:$,query:R}),ze(`/admin/${encodeURIComponent(W)}/usage/${$}`,{query:R}).then(Ae=>{if(k)return;const Se=Array.isArray(Ae==null?void 0:Ae.usages)?Ae.usages:[];console.debug("AdminsUsage: response usages",{length:Se.length,endpoint:$});let Je;if(I){const N=new Map;Se.forEach(F=>{var Pe,Te;const pe=typeof(F==null?void 0:F.date)=="string"?F.date:"";if(!pe)return;const Q=(Pe=N.get(pe))!=null?Pe:0;N.set(pe,Q+Number((Te=F==null?void 0:F.used_traffic)!=null?Te:0))});const Z=Array.from(N.entries());Z.sort((F,pe)=>{const[Q]=F,[Pe]=pe;return _i(Q)-_i(Pe)}),Je=Z.map(([F,pe])=>({date:F,used_traffic:pe}))}else{const N=Se.map(Z=>{var F,pe;return{date:(F=Z==null?void 0:Z.date)!=null?F:"",used_traffic:Number((pe=Z==null?void 0:Z.used_traffic)!=null?pe:0)}});N.sort((Z,F)=>_i(Z.date)-_i(F.date)),Je=N}q(Je)}).catch(Ae=>{k||(console.error("Error fetching admin usage:",Ae),q([]))}).finally(()=>{k||H(!1)}),()=>{k=!0}},[W,T]),d.exports.useEffect(()=>{if(!ae||ae.length===0)return;ae.some(I=>I.username===W)||A(ae[0].username)},[ae,W]),d.exports.useEffect(()=>{const k=v.find(I=>I.key===T.key);P(k?k.key:"custom")},[T,v]);const V=d.exports.useMemo(()=>X.map(k=>dg(k.date)),[X]),be=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:X.map(k=>k.used_traffic)}],[X,t]),Ce=d.exports.useMemo(()=>({options:hg(s,V),series:be}),[s,V,be]),Ee=d.exports.useMemo(()=>X.reduce((k,I)=>k+Number(I.used_traffic||0),0),[X]),ve=d.exports.useMemo(()=>{const k=Me(T.start).format("YYYY-MM-DD"),I=Me(T.end).format("YYYY-MM-DD");return k===I?k:`${k} - ${I}`},[T.start,T.end]);return n(he,{spacing:4,align:"stretch",children:[n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(fe,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[n(he,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),n(fe,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(rt,{value:p!=null?p:"",onChange:k=>{const I=Number(k.target.value);m(Number.isNaN(I)?null:I)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(k=>e("option",{value:k.id,children:k.name},k.id))}),n(M,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(qo,{}),n(h,{children:[t("services.totalUsage","Total"),":"," ",e(ie.span,{fontWeight:"medium",children:Be(K,2)})]})]})]})]}),n(fe,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:S?n(he,{spacing:3,py:8,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):g.length&&K>0?e(an,{type:"donut",height:320,options:Oe,series:xe}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(he,{flex:"1",align:"stretch",spacing:2,children:g.length?g.map(k=>{var Ae;const I=k.username||t("services.unassignedAdmin","Unassigned"),R=Boolean(k.username),$=W===k.username&&R;return e(O,{size:"sm",variant:$?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{R&&k.username&&A(k.username)},isDisabled:!R,children:n(M,{justify:"space-between",w:"full",children:[e(h,{children:I}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:Be(k.used_traffic||0,2)})]})},`${(Ae=k.admin_id)!=null?Ae:"na"}-${I}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(fe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(he,{align:"start",spacing:1,children:[n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(mt,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(qo,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(ie.span,{fontWeight:"medium",children:W!=null?W:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(ie.span,{fontWeight:"medium",children:Be(Ee||0,2)})]})]}),n(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(fe,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:v.map(k=>e(O,{size:"sm",onClick:()=>{P(k.key),L(Xo(k))},variant:ce===k.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:k.label},k.key))}),n(fe,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[n(Hn,{placement:a,isOpen:oe,onClose:()=>{_(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Bn,{children:e(O,{size:"sm",variant:"outline",leftIcon:e(lg,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(oe){_(!1);return}f([T.start,T.end]),_(!0)},children:ve})}),n(Vn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(ls,{}),n($n,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(yi,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(j=ye[0])!=null?j:void 0,endDate:(de=ye[1])!=null?de:void 0,calendarClassName:"usage-range-datepicker",onChange:k=>{const[I,R]=k!=null?k:[null,null];if(f([I,R]),I&&R){const $=ug(I,R);P("custom"),L($),_(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(rt,{value:W!=null?W:"",onChange:k=>A(k.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!ae.length,children:ae.map(k=>e("option",{value:k.username,children:k.username},k.username))})]})]})]}),e(z,{mt:6,children:ge?n(he,{spacing:3,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Ce.series&&Ce.series.length?e(an,{options:Ce.options,series:Ce.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};Me.extend(mi);const gg=ie(Wa,{baseStyle:{w:4,h:4}}),pa=ie(pi,{baseStyle:{w:4,h:4}}),ma=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],Qo=t=>{const s=t.unit==="hour"?"hour":"day",r=Me().utc().endOf(s),l=Math.max(t.amount-1,0),a=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:a.toDate(),end:r.toDate(),unit:t.unit}},fg=(t,s)=>{const r=Me(t),l=Me(s),[a,i]=r.isBefore(l)?[r,l]:[l,r],o=a.startOf("day"),c=i.endOf("day"),u=o.isSame(c,"day");return{key:"custom",start:o.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Zo=t=>Me(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),jo=t=>Me(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),el=(t,s)=>{if(!t)return t;const r=Me.utc(t);return r.isValid()?s==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},tl=(t,s,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:a=>Be(Number(a)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:a=>Be(Number(a)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},bg=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Be(Number(r)||0,2),title:{formatter:(r,l)=>{var a,i,o,c;return(c=(o=(i=(a=l==null?void 0:l.w)==null?void 0:a.globals)==null?void 0:i.labels)==null?void 0:o[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),yg=({services:t,selectedServiceId:s})=>{var Z,F,pe,Q,Pe,Te;const{t:r}=qe(),{colorMode:l}=Zr(),a="auto-end",i=(Z=Tr({base:"bottom",md:"auto-end"}))!=null?Z:a,o=d.exports.useMemo(()=>t.map(le=>({id:le.id,name:le.name})),[t]),c=d.exports.useMemo(()=>s||(o.length?o[0].id:null),[s,o]),u=(F=ma.find(le=>le.key==="30d"))!=null?F:ma[0],[p,m]=d.exports.useState(c),[g,x]=d.exports.useState(()=>Qo(u)),[S,y]=d.exports.useState(u.key),[v,E]=d.exports.useState([null,null]),[T,L]=d.exports.useState(!1),[ce,P]=d.exports.useState([]),[W,A]=d.exports.useState("day"),[X,q]=d.exports.useState([]),[ge,H]=d.exports.useState(!1),[oe,_]=d.exports.useState(!1),[ye,f]=d.exports.useState(null),[ae,K]=d.exports.useState([]),[xe,Re]=d.exports.useState("day"),[Oe,V]=d.exports.useState(""),[be,Ce]=d.exports.useState(!1);d.exports.useEffect(()=>{m(c)},[c]),d.exports.useEffect(()=>{if(!p){P([]),q([]),K([]),f(null),V("");return}const le={start:Zo(g.start),end:jo(g.end)},Le=g.unit==="hour"?"hour":"day";let Ke=!1;return H(!0),ze(`/v2/services/${p}/usage/timeseries`,{query:{...le,granularity:Le}}).then(ne=>{var Ye,te;Ke||!ne||(P((Ye=ne.points)!=null?Ye:[]),A((te=ne.granularity)!=null?te:Le))}).catch(()=>{Ke||(P([]),A(Le))}).finally(()=>{Ke||H(!1)}),_(!0),ze(`/v2/services/${p}/usage/admins`,{query:le}).then(ne=>{var Ye;Ke||!ne||q((Ye=ne.admins)!=null?Ye:[])}).catch(()=>{Ke||q([])}).finally(()=>{Ke||_(!1)}),()=>{Ke=!0}},[p,g.start,g.end,g.unit]),d.exports.useEffect(()=>{if(!p){f(null),K([]),V("");return}if(!X.length){f(null);return}f(le=>{var Ye,te;const Le=X.map(ee=>ee.admin_id);if(le===null){if(Le.includes(null))return le}else if(Le.includes(le))return le;const Ke=X.find(ee=>(ee.used_traffic||0)>0);if(Ke)return(Ye=Ke.admin_id)!=null?Ye:null;const ne=X[0];return(te=ne==null?void 0:ne.admin_id)!=null?te:null})},[X,p]),d.exports.useEffect(()=>{if(!p){K([]),V(""),Re("day");return}if(ye===void 0)return;if(!X.length&&ye===null){K([]),V("");return}const le=g.unit==="hour"?"hour":"day",Le=ye===null?"null":Number.isFinite(ye)?String(ye):"null";let Ke=!1;return Ce(!0),ze(`/v2/services/${p}/usage/admin-timeseries`,{query:{start:Zo(g.start),end:jo(g.end),granularity:le,admin_id:Le}}).then(ne=>{var Ye,te,ee;Ke||!ne||(K((Ye=ne.points)!=null?Ye:[]),Re((te=ne.granularity)!=null?te:le),V((ee=ne.username)!=null?ee:""))}).catch(()=>{Ke||(K([]),V(""),Re(le))}).finally(()=>{Ke||Ce(!1)}),()=>{Ke=!0}},[X,g.end,g.start,g.unit,ye,p]);const Ee=d.exports.useMemo(()=>{const le=Me(g.start).format("YYYY-MM-DD"),Le=Me(g.end).format("YYYY-MM-DD");return`${le} \u2013 ${Le}`},[g.start,g.end]),ve=d.exports.useMemo(()=>ce.map(le=>el(le.timestamp,W)),[ce,W]),B=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ce.map(le=>le.used_traffic)}],[ce,r]),U=d.exports.useMemo(()=>tl(l,ve,r("services.usageYAxis","Usage")),[ve,l,r]),j=d.exports.useMemo(()=>X.map(le=>({value:le.admin_id===null?"null":String(le.admin_id),label:le.username||r("services.unassignedAdmin","Unassigned")})),[X,r]),de=d.exports.useMemo(()=>{var Le,Ke;const le=ye===null?"null":String(ye);return(Ke=(Le=j.find(ne=>ne.value===le))==null?void 0:Le.label)!=null?Ke:ye===null?r("services.unassignedAdmin","Unassigned"):""},[j,ye,r]),k=d.exports.useMemo(()=>ae.map(le=>el(le.timestamp,xe)),[ae,xe]),I=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ae.map(le=>le.used_traffic)}],[ae,r]),R=d.exports.useMemo(()=>tl(l,k,r("services.usageYAxis","Usage")),[k,l,r]),$=d.exports.useMemo(()=>ae.reduce((le,Le)=>le+(Le.used_traffic||0),0),[ae]),Ae=d.exports.useMemo(()=>X.map(le=>le.used_traffic),[X]),Se=d.exports.useMemo(()=>X.map(le=>le.username||r("services.unassignedAdmin","Unassigned")),[X,r]),Je=d.exports.useMemo(()=>bg(l,Se),[l,Se]),N=d.exports.useMemo(()=>X.reduce((le,Le)=>le+(Le.used_traffic||0),0),[X]);return o.length===0?n(he,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(z,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):n(he,{spacing:4,align:"stretch",children:[n(M,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),n(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(rt,{value:p!=null?p:"",onChange:le=>m(Number(le.target.value)||null),minW:{md:"220px"},children:o.map(le=>e("option",{value:le.id,children:le.name},le.id))}),e(fe,{direction:{base:"column",sm:"row"},spacing:2,children:ma.map(le=>e(O,{size:"sm",variant:S===le.key?"solid":"outline",colorScheme:"primary",onClick:()=>{y(le.key),x(Qo(le))},children:le.label},le.key))}),n(Hn,{placement:i,isOpen:T,onClose:()=>L(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Bn,{children:e(O,{size:"sm",variant:"outline",leftIcon:e(gg,{}),onClick:()=>{E([g.start,g.end]),L(le=>!le)},children:Ee})}),n(Vn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(ls,{}),n($n,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(yi,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(pe=v[0])!=null?pe:void 0,endDate:(Q=v[1])!=null?Q:void 0,calendarClassName:"usage-range-datepicker",onChange:le=>{const[Le,Ke]=le!=null?le:[null,null];if(E([Le,Ke]),Le&&Ke){const ne=fg(Le,Ke);y("custom"),x(ne),L(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(M,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),n(M,{fontSize:"sm",color:"gray.500",children:[e(pa,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(ie.span,{fontWeight:"medium",children:Be(ce.reduce((le,Le)=>le+(Le.used_traffic||0),0),2)})]})]})]}),e(z,{mt:4,children:ge?n(he,{spacing:3,py:10,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):ce.length?e(an,{type:"area",height:360,options:U,series:B}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(fe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(he,{align:"start",spacing:1,children:[e(mt,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(pa,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(ie.span,{fontWeight:"medium",children:de||Oe||"-"})," ",r("services.totalUsage","Total"),":"," ",e(ie.span,{fontWeight:"medium",children:Be($||0,2)})]})]}),e(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(rt,{size:"sm",minW:{md:"200px"},value:ye===null?"null":String(ye),onChange:le=>{const Le=le.target.value;if(Le==="null"){f(null);return}const Ke=Number(Le);f(Number.isNaN(Ke)?null:Ke)},isDisabled:j.length===0,children:j.map(le=>e("option",{value:le.value,children:le.label},le.value))})})]}),e(z,{mt:4,children:be?n(he,{spacing:3,py:10,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(Te=(Pe=I[0])==null?void 0:Pe.data)!=null&&Te.length?e(an,{type:"area",height:360,options:R,series:I}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(M,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),n(M,{fontSize:"sm",color:"gray.500",children:[e(pa,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(ie.span,{fontWeight:"medium",children:Be(N,2)})]})]})]}),n(fe,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(z,{flex:"1",children:oe?n(he,{spacing:3,py:8,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):X.length&&N>0?e(an,{type:"donut",height:320,options:Je,series:Ae}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(he,{flex:"1",align:"stretch",spacing:2,children:X.length?X.map(le=>{var Le;return n(M,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:le.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:Be(le.used_traffic||0,2)})]},`${(Le=le.admin_id)!=null?Le:"na"}-${le.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};Me.extend(mi);const Sg=ie(Wa,{baseStyle:{w:4,h:4}}),Di=ie(pi,{baseStyle:{w:4,h:4}}),Ys={key:"30d",label:"30d",amount:30,unit:"day"},rl=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=Me.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},Gs=t=>Me(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Xs=t=>Me(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Mn=t=>{const s=t.unit==="hour"?"hour":"day",r=Me().utc().endOf(s),l=Math.max(t.amount-1,0),a=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:a.toDate(),end:r.toDate(),unit:t.unit}},Ai=(t,s)=>{const r=Me(t),l=Me(s),[a,i]=r.isBefore(l)?[r,l]:[l,r],o=a.startOf("day"),c=i.endOf("day"),u=o.isSame(c,"day");return{key:"custom",start:o.toDate(),end:c.toDate(),unit:u?"hour":"day"}},nl=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Be(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Be(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},Ii=({presets:t,range:s,onPresetChange:r,onCustomChange:l})=>{var y,v,E;const{t:a}=qe(),i="auto-end",o=(y=Tr({base:"bottom",md:"auto-end"}))!=null?y:i,c=Me(s.start).format("YYYY-MM-DD"),u=Me(s.end).format("YYYY-MM-DD"),p=c===u?c:`${c} - ${u}`,[m,g]=d.exports.useState(!1),[x,S]=d.exports.useState([s.start,s.end]);return d.exports.useEffect(()=>{m||S([s.start,s.end])},[m,s.start,s.end]),n(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(fe,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(T=>e(O,{size:"sm",onClick:()=>r(T.key),colorScheme:"primary",variant:s.key===T.key?"solid":"outline",w:{base:"full",sm:"auto"},children:T.label},T.key))}),n(Hn,{placement:o,isOpen:m,onClose:()=>{g(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(Bn,{children:e(O,{size:"sm",variant:"outline",leftIcon:e(Sg,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(m){g(!1);return}S([s.start,s.end]),g(!0)},children:p})}),n(Vn,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(ls,{}),n($n,{px:3,py:3,children:[e(z,{overflowX:"auto",maxW:"full",children:e(yi,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(v=x[0])!=null?v:void 0,endDate:(E=x[1])!=null?E:void 0,calendarClassName:"usage-range-datepicker",onChange:T=>{const[L,ce]=T!=null?T:[null,null];S([L,ce]),L&&ce&&(l(L,ce),g(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:a("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},xg=()=>{var wt,dt,lr,Sr,pr,xr,cr,mr,gr;const{t}=qe(),s=er(),{colorMode:r}=Zr(),{data:l}=Ba(),{fetchNodesUsage:a}=Si(),{userData:i}=hr(),o=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(dt=(wt=o.find(re=>re.key==="30d"))!=null?wt:o[0])!=null?dt:Ys,[u,p]=d.exports.useState(()=>Mn(c)),[m,g]=d.exports.useState([]),[x,S]=d.exports.useState(!1),[y,v]=d.exports.useState(()=>Mn(c)),[E,T]=d.exports.useState(null),[L,ce]=d.exports.useState(!1),[P,W]=d.exports.useState([]),[A,X]=d.exports.useState(null),[q,ge]=d.exports.useState(()=>Mn(c)),[H,oe]=d.exports.useState(()=>Mn(c)),[_,ye]=d.exports.useState([]),[f,ae]=d.exports.useState(null),[K,xe]=d.exports.useState(null),[Re,Oe]=d.exports.useState([]),[V,be]=d.exports.useState([]),[Ce,Ee]=d.exports.useState(!1),[ve,B]=d.exports.useState(null),[U,j]=d.exports.useState(!1),[de,k]=d.exports.useState([]),[I,R]=d.exports.useState(null),$=d.exports.useCallback(re=>re?(Array.isArray(re)?re:Object.values(re)).map(Y=>{var Ge,kt,Vt,Et;return{nodeId:Number((Ge=Y==null?void 0:Y.node_id)!=null?Ge:0),nodeName:(kt=Y==null?void 0:Y.node_name)!=null?kt:t("nodes.unknownNode","Unknown"),total:Number((Vt=Y==null?void 0:Y.uplink)!=null?Vt:0)+Number((Et=Y==null?void 0:Y.downlink)!=null?Et:0)}}):[],[t]),Ae=d.exports.useCallback(re=>{var Y;const _e=(Y=o.find(Ge=>Ge.key===re))!=null?Y:Ys;p(Mn(_e))},[o]),Se=d.exports.useCallback((re,_e)=>{const Y=Ai(re,_e);p(Y)},[]),Je=d.exports.useCallback(re=>{var Y;const _e=(Y=o.find(Ge=>Ge.key===re))!=null?Y:Ys;v(Mn(_e))},[o]),N=d.exports.useCallback((re,_e)=>{const Y=Ai(re,_e);v(Y)},[]),Z=d.exports.useCallback(re=>{var Y;const _e=(Y=o.find(Ge=>Ge.key===re))!=null?Y:Ys;oe(Mn(_e))},[o]),F=d.exports.useCallback((re,_e)=>{const Y=Ai(re,_e);oe(Y)},[]),pe=d.exports.useCallback(re=>{var Y;const _e=(Y=o.find(Ge=>Ge.key===re))!=null?Y:Ys;ge(Mn(_e))},[o]),Q=d.exports.useCallback((re,_e)=>{const Y=Ai(re,_e);ge(Y)},[]),Pe=d.exports.useMemo(()=>m.reduce((re,_e)=>re+_e.total,0),[m]),Te=d.exports.useMemo(()=>{const re=m.map(Y=>Y.total),_e=m.map(Y=>Y.nodeName);return Li(r,`${t("userDialog.total")} ${Be(Pe||0,2)}`,re,_e)},[r,m,t,Pe]),le=d.exports.useMemo(()=>P.map(re=>rl(re.date)),[P]),Le=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:P.map(re=>re.used_traffic)}],[P,t]),Ke=d.exports.useMemo(()=>P.reduce((re,_e)=>re+_e.used_traffic,0),[P]),ne=d.exports.useMemo(()=>({options:nl(r,le),series:Le}),[r,le,Le]),Ye=d.exports.useMemo(()=>V.reduce((re,_e)=>re+_e.total,0),[V]),te=d.exports.useMemo(()=>{const re=V.map(Y=>Y.total),_e=V.map(Y=>Y.nodeName);return Li(r,`${t("userDialog.total")} ${Be(Ye||0,2)}`,re,_e)},[V,r,t,Ye]),ee=d.exports.useMemo(()=>de.map(re=>rl(re.date)),[de]),Ne=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:de.map(re=>re.used_traffic)}],[de,t]),at=d.exports.useMemo(()=>de.reduce((re,_e)=>re+_e.used_traffic,0),[de]),ot=d.exports.useMemo(()=>({options:nl(r,ee),series:Ne}),[r,ee,Ne]),yt=d.exports.useMemo(()=>{const re=[],_e=new Set;return m.forEach(Y=>{Y.nodeId>0&&!_e.has(Y.nodeId)&&(_e.add(Y.nodeId),re.push({value:Y.nodeId,label:Y.nodeName}))}),Array.isArray(l)&&l.forEach(Y=>{(Y==null?void 0:Y.id)&&!_e.has(Y.id)&&(_e.add(Y.id),re.push({value:Y.id,label:Y.name}))}),re.sort((Y,Ge)=>Y.label.localeCompare(Ge.label))},[m,l]),et=d.exports.useMemo(()=>{const re=[],_e=new Set;return Re.forEach(Y=>{_e.has(Y.nodeId)||(_e.add(Y.nodeId),re.push({value:Y.nodeId,label:Y.nodeName}))}),_e.has(0)||re.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(Y=>{(Y==null?void 0:Y.id)&&!_e.has(Y.id)&&(_e.add(Y.id),re.push({value:Y.id,label:Y.name}))}),re.sort((Y,Ge)=>Y.label.localeCompare(Ge.label))},[Re,l,t]),Jt=d.exports.useMemo(()=>_.map(re=>({value:re,label:re})),[_]),qt=d.exports.useMemo(()=>{const re=new Map;return Array.isArray(l)&&l.forEach(_e=>{(_e==null?void 0:_e.id)!=null&&re.set(_e.id,_e.name)}),re},[l]);return d.exports.useEffect(()=>{let re=!1;return S(!0),a({start:Gs(u.start),end:Xs(u.end)}).then(_e=>{if(re)return;const Y=$(_e==null?void 0:_e.usages);g(Y)}).catch(_e=>{re||(console.error("Error fetching usage data:",_e),g([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||S(!1)}),()=>{re=!0}},[a,u,$,s,t]),d.exports.useEffect(()=>{var _e,Y;const re=Boolean((Y=(_e=i.permissions)==null?void 0:_e.admin_management)==null?void 0:Y[ar.View])||i.role===Xe.FullAccess;!(i!=null&&i.username)||(ae(Ge=>Ge!=null?Ge:i.username),xe(Ge=>Ge!=null?Ge:i.username),re||ye([i.username]))},[i]),d.exports.useEffect(()=>{var Y,Ge;const re=Boolean((Ge=(Y=i==null?void 0:i.permissions)==null?void 0:Y.admin_management)==null?void 0:Ge[ar.View])||(i==null?void 0:i.role)===Xe.FullAccess;if(!(i!=null&&i.username)||!re)return;let _e=!1;return ze("/admins").then(kt=>{if(_e)return;const Et=(Array.isArray(kt)?kt:Array.isArray(kt==null?void 0:kt.admins)?kt.admins:[]).map(ut=>ut==null?void 0:ut.username).filter(ut=>typeof ut=="string"),Nt=Array.from(new Set(Et)).sort((ut,ht)=>ut.localeCompare(ht));if(!Nt.length&&(i==null?void 0:i.username)){ye([i.username]);return}ye(Nt),ae(ut=>{var ht,At;return ut&&Nt.includes(ut)?ut:(At=(ht=Nt[0])!=null?ht:ut)!=null?At:null}),xe(ut=>{var ht,At;return ut&&Nt.includes(ut)?ut:(At=(ht=Nt[0])!=null?ht:ut)!=null?At:null})}).catch(kt=>{console.error("Error fetching admins:",kt)}),()=>{_e=!0}},[(lr=i==null?void 0:i.permissions)==null?void 0:lr.admin_management,i==null?void 0:i.role,i==null?void 0:i.username]),d.exports.useEffect(()=>{var _e,Y;if(E!==null)return;const re=(_e=m.filter(Ge=>Ge.nodeId>0).sort((Ge,kt)=>kt.total-Ge.total)[0])==null?void 0:_e.nodeId;if(re&&re>0){T(re);return}if(Array.isArray(l)&&l.length){const Ge=(Y=l[0])==null?void 0:Y.id;Ge&&T(Ge)}},[E,m,l]),d.exports.useEffect(()=>{B(null)},[f]),d.exports.useEffect(()=>{if(!f){Oe([]),B(null);return}let re=!1;const _e={start:Gs(H.start),end:Xs(H.end)};return ze(`/admin/${encodeURIComponent(f)}/usage/nodes`,{query:_e}).then(Y=>{if(re)return;const Ge=$(Y==null?void 0:Y.usages);Oe(Ge),B(kt=>{var Et,Nt,ut;if(kt!==null)return kt;const Vt=(Et=Ge.filter(ht=>ht.nodeId!==0).sort((ht,At)=>At.total-ht.total)[0])==null?void 0:Et.nodeId;return typeof Vt=="number"?Vt:(ut=(Nt=Ge[0])==null?void 0:Nt.nodeId)!=null?ut:0})}).catch(Y=>{re||(console.error("Error fetching daily admin nodes:",Y),Oe([]),B(null),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{re=!0}},[f,H,$,s,t]),d.exports.useEffect(()=>{if(!K){be([]),Ee(!1);return}let re=!1;return Ee(!0),ze(`/admin/${encodeURIComponent(K)}/usage/nodes`,{query:{start:Gs(q.start),end:Xs(q.end)}}).then(_e=>{if(re)return;const Y=$(_e==null?void 0:_e.usages);be(Y)}).catch(_e=>{re||(console.error("Error fetching admin totals nodes:",_e),be([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||Ee(!1)}),()=>{re=!0}},[K,q,$,s,t]),d.exports.useEffect(()=>{if(E===null){W([]),X(null);return}let re=!1;ce(!0);const _e={start:Gs(y.start),end:Xs(y.end)};return y.unit==="hour"&&(_e.granularity="hour"),ze(`/node/${E}/usage/daily`,{query:_e}).then(Y=>{var Et,Nt,ut;if(re)return;const kt=(Array.isArray(Y==null?void 0:Y.usages)?Y.usages:[]).map(ht=>{var At,rr;return{date:(At=ht==null?void 0:ht.date)!=null?At:"",used_traffic:Number((rr=ht==null?void 0:ht.used_traffic)!=null?rr:0)}});W(kt);const Vt=(Nt=(Et=Y==null?void 0:Y.node_name)!=null?Et:qt.get(E))!=null?Nt:t("nodes.unknownNode","Unknown");X({nodeName:Vt,nodeId:(ut=Y==null?void 0:Y.node_id)!=null?ut:E})}).catch(Y=>{re||(console.error("Error fetching node daily usage:",Y),W([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||ce(!1)}),()=>{re=!0}},[E,y,qt,s,t]),d.exports.useEffect(()=>{if(!f){k([]),R(null);return}if(ve===null){k([]),R(null);return}let re=!1;j(!0);const _e={start:Gs(H.start),end:Xs(H.end)};return ve!=null&&(_e.node_id=ve),H.unit==="hour"&&(_e.granularity="hour"),ze(`/admin/${encodeURIComponent(f)}/usage/chart`,{query:_e}).then(Y=>{var Vt,Et,Nt,ut;if(re)return;const kt=(Array.isArray(Y==null?void 0:Y.usages)?Y.usages:[]).map(ht=>{var At,rr;return{date:(At=ht==null?void 0:ht.date)!=null?At:"",used_traffic:Number((rr=ht==null?void 0:ht.used_traffic)!=null?rr:0)}});k(kt),R({nodeName:(Nt=(Et=Y==null?void 0:Y.node_name)!=null?Et:(Vt=et.find(ht=>ht.value===ve))==null?void 0:Vt.label)!=null?Nt:null,nodeId:(ut=Y==null?void 0:Y.node_id)!=null?ut:ve})}).catch(Y=>{re||(console.error("Error fetching admin usage chart:",Y),k([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{re||j(!1)}),()=>{re=!0}},[f,ve,H,et,t,s]),n(he,{spacing:6,align:"stretch",children:[n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(fe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(he,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(Di,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:Be(Pe||0,2)})]})]}),e(Ii,{presets:o,range:u,onPresetChange:Ae,onCustomChange:Se})]}),e(z,{mt:6,children:x?n(he,{spacing:3,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Te.series.length?e(an,{options:Te.options,series:Te.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(fe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(he,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(Di,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(ie.span,{fontWeight:"medium",children:(Sr=A==null?void 0:A.nodeName)!=null?Sr:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:Be(Ke||0,2)})]})]}),n(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(rt,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:E!=null?E:"",onChange:re=>{const _e=re.target.value;if(!_e){T(null);return}const Y=Number(_e);T(Number.isFinite(Y)&&Y>0?Y:null)},placeholder:t("nodes.selectNode","Select node"),children:yt.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(Ii,{presets:o,range:y,onPresetChange:Je,onCustomChange:N})]})]}),e(z,{mt:6,children:L?n(he,{spacing:3,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(xr=(pr=Le[0])==null?void 0:pr.data)!=null&&xr.length?e(an,{options:ne.options,series:ne.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(fe,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(he,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(Di,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ie.span,{fontWeight:"medium",children:f!=null?f:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(ie.span,{fontWeight:"medium",children:(cr=I==null?void 0:I.nodeName)!=null?cr:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:Be(at||0,2)})]})]}),n(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(rt,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:f!=null?f:"",onChange:re=>ae(re.target.value||null),isDisabled:Jt.length===0,children:Jt.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(rt,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:ve!=null?ve:"",onChange:re=>{const _e=re.target.value;if(_e===""){B(null);return}const Y=Number(_e);B(Number.isNaN(Y)?null:Y)},placeholder:t("nodes.selectNode","Select node"),children:et.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(Ii,{presets:o,range:H,onPresetChange:Z,onCustomChange:F})]})]}),e(z,{mt:6,children:U?n(he,{spacing:3,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(gr=(mr=Ne[0])==null?void 0:mr.data)!=null&&gr.length?e(an,{options:ot.options,series:ot.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(fe,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[n(he,{align:"start",spacing:1,children:[e(mt,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:n(M,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(Di,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ie.span,{fontWeight:"medium",children:K!=null?K:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(ie.span,{fontWeight:"medium",children:Be(Ye||0,2)})]})]}),n(fe,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(rt,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:K!=null?K:"",onChange:re=>xe(re.target.value||null),isDisabled:Jt.length===0,children:Jt.map(re=>e("option",{value:re.value,children:re.label},re.value))}),e(Ii,{presets:o,range:q,onPresetChange:pe,onCustomChange:Q})]})]}),e(z,{mt:6,children:Ce?n(he,{spacing:3,children:[e(Rt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):te.series.length?e(an,{options:te.options,series:te.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},vg=()=>{var o;const{t}=qe(),{userData:s,getUserIsSuccess:r}=hr(),l=Boolean(r&&((o=s.permissions)==null?void 0:o.sections.usage)),a=jn(c=>c.services),i=jn(c=>c.fetchServices);return d.exports.useEffect(()=>{l&&i({limit:500})},[i,l]),r?l?n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),n(cs,{variant:"enclosed",colorScheme:"primary",children:[n(ds,{children:[e(Xt,{children:t("usage.tabs.services","Services")}),e(Xt,{children:t("usage.tabs.admins","Admins")}),e(Xt,{children:t("usage.tabs.nodes","Nodes")})]}),n(us,{children:[e(Qt,{px:0,children:e(yg,{services:a})}),e(Qt,{px:0,children:e(mg,{})}),e(Qt,{px:0,children:e(xg,{})})]})]})]}):n(he,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(pt,{justify:"center",align:"center",py:10,children:e(Rt,{})})},oc="__dot__",Ia=t=>t.replace(/\./g,oc),Ss=t=>t.replace(new RegExp(oc,"g"),"."),wg=t=>{const s={},r=(l,a)=>{if(a!==void 0){if(typeof a=="boolean"){s[Ss(l)]=a;return}if(typeof a=="string"){if(a==="")return;a==="true"||a==="false"?s[Ss(l)]=a==="true":s[Ss(l)]=Boolean(a);return}if(typeof a=="number"){s[Ss(l)]=a!==0;return}if(Array.isArray(a)){s[Ss(l)]=a.length>0;return}if(a&&typeof a=="object"){Object.entries(a).forEach(([i,o])=>{const c=l?`${l}.${i}`:i;r(c,o)});return}s[Ss(l)]=Boolean(a)}};return Object.entries(t).forEach(([l,a])=>{r(l,a)}),s},lc=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],kg=lc.flatMap(t=>t.events.map(s=>s.key)),sl=ie(on,{baseStyle:{w:4,h:4}}),il=ie(zd,{baseStyle:{w:4,h:4}}),ga=t=>{var l,a,i,o;const s={};Object.entries(t.forum_topics||{}).forEach(([c,u])=>{var p;s[c]={title:(p=u.title)!=null?p:"",topic_id:u.topic_id!=null?String(u.topic_id):""}});const r={};return kg.forEach(c=>{var m;const u=Ia(c),p=(m=t.event_toggles)==null?void 0:m[c];r[u]=p===void 0?!0:Boolean(p)}),Object.entries(t.event_toggles||{}).forEach(([c,u])=>{const p=Ia(c);p in r||(r[p]=Boolean(u))}),{api_token:(l=t.api_token)!=null?l:"",use_telegram:(a=t.use_telegram)!=null?a:!0,proxy_url:(i=t.proxy_url)!=null?i:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(o=t.default_vless_flow)!=null?o:"",forum_topics:s,event_toggles:r}},fa=({disabled:t,message:s,children:r})=>n(z,{position:"relative",children:[e(z,{pointerEvents:t?"none":"auto",filter:t?"blur(1.2px)":"none",opacity:t?.55:1,transition:"all 0.2s ease",children:r}),t&&e(pt,{position:"absolute",inset:0,align:"center",justify:"center",textAlign:"center",fontWeight:"semibold",color:"white",px:6,borderRadius:"inherit",bg:"blackAlpha.400",backdropFilter:"blur(2px)",children:e(h,{children:s})})]}),Cg=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(s=>s.length>0).map(s=>Number(s)).filter(s=>Number.isFinite(s)),_g=()=>{var V,be,Ce,Ee,ve;const{t}=qe(),s=er(),{userData:r,getUserIsSuccess:l}=hr();if(!(l&&Boolean((V=r.permissions)==null?void 0:V.sections.integrations)))return n(he,{spacing:4,align:"stretch",children:[e(Rn,{size:"lg",children:t("header.integrationSettings","Integration settings")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("integrations.noPermission","You do not have permission to manage integration settings.")})]});const i=Oa(),{data:o,isLoading:c,refetch:u}=Rr("telegram-settings",Nh,{refetchOnWindowFocus:!1}),{data:p,isLoading:m,refetch:g}=Rr("panel-settings",Fa,{refetchOnWindowFocus:!1}),x=Rr("maintenance-info",()=>ze("/maintenance/info"),{refetchOnWindowFocus:!1}),[S,y]=d.exports.useState((be=p==null?void 0:p.use_nobetci)!=null?be:!1),[v,E]=d.exports.useState(!1),[T,L]=d.exports.useState(!1),ce=d.exports.useRef(null);d.exports.useEffect(()=>{p&&y(p.use_nobetci)},[p]);const{register:P,control:W,handleSubmit:A,reset:X,watch:q,formState:{isDirty:ge}}=jr({defaultValues:ga(o!=null?o:{api_token:null,use_telegram:!0,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{o&&X(ga(o))},[o,X]);const H=Lr(zh,{onSuccess:B=>{X(ga(B)),i.setQueryData("telegram-settings",B),s({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),oe=Lr(Rh,{onSuccess:B=>{y(B.use_nobetci),i.setQueryData("panel-settings",B),s({title:t("settings.panel.saved","Panel settings saved"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),_=B=>{const U=wg(B.event_toggles||{}),j={api_token:B.api_token.trim()||null,use_telegram:B.use_telegram,proxy_url:B.proxy_url.trim()||null,admin_chat_ids:Cg(B.admin_chat_ids),logs_chat_id:B.logs_chat_id.trim()?Number(B.logs_chat_id.trim()):null,logs_chat_is_forum:B.logs_chat_is_forum,default_vless_flow:B.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(B.forum_topics||{}).map(([de,k])=>[de,{title:k.title,topic_id:k.topic_id.trim()?Number(k.topic_id.trim()):void 0}])),event_toggles:U};H.mutate(j)},ye=B=>{if(!B)return`rebecca-backup-${Date.now()}.zip`;const U=B.split(";");for(const j of U){const de=j.trim();if(de.toLowerCase().startsWith("filename="))return de.split("=",1)[1].trim().replace(/(^\"|\"$)/g,"")||`rebecca-backup-${Date.now()}.zip`}return`rebecca-backup-${Date.now()}.zip`},f=async()=>{E(!0);try{const B=Is(),U=await fetch("/api/maintenance/backup/export",{method:"GET",headers:B?{Authorization:`Bearer ${B}`}:void 0});if(!U.ok)throw new Error(await U.text());const j=await U.blob(),de=ye(U.headers.get("content-disposition")),k=window.URL.createObjectURL(j),I=document.createElement("a");I.href=k,I.download=de,document.body.appendChild(I),I.click(),document.body.removeChild(I),window.URL.revokeObjectURL(k),Yt(t("settings.panel.backupDownloadSuccess"),s)}catch(B){Kt(B,s)}finally{E(!1)}},ae=async B=>{var j;const U=(j=B.target.files)==null?void 0:j[0];if(!!U){L(!0);try{const de=Is(),k=new FormData;k.append("file",U);const I=await fetch("/api/maintenance/backup/import",{method:"POST",headers:de?{Authorization:`Bearer ${de}`}:void 0,body:k});if(!I.ok)throw new Error(await I.text());Yt(t("settings.panel.backupUploadSuccess"),s)}catch(de){Kt(de,s)}finally{L(!1),B.target.value=""}}},K=q("forum_topics"),xe=q("use_telegram"),Re=t("settings.telegram.disabledOverlay","Telegram bot is disabled. Enable it to edit these settings."),Oe=()=>{var B;(B=ce.current)==null||B.click()};return n(z,{px:{base:4,md:8},py:{base:6,md:8},children:[e(Rn,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),n(cs,{colorScheme:"primary",children:[n(ds,{children:[e(Xt,{children:t("settings.panel.tabTitle","Panel")}),e(Xt,{children:t("settings.telegram","Telegram")}),e(Xt,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),n(us,{children:[e(Qt,{px:{base:0,md:2},children:m&&p===void 0?e(pt,{align:"center",justify:"center",py:12,children:e(Rt,{size:"lg"})}):n(fe,{spacing:6,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.description","Control dashboard-specific behaviors that affect all admins.")}),e(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Rn,{size:"sm",mb:1,children:t("settings.panel.useNobetciTitle","Enable Nobetci integration")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.useNobetciDescription","Show Nobetci options when creating or editing nodes.")})]}),e(gt,{isChecked:S,onChange:B=>y(B.target.checked),isDisabled:oe.isLoading||m})]})}),n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Rn,{size:"sm",mb:1,children:t("settings.panel.maintenanceTitle","Maintenance status")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceDescription","Inspect which container images are currently used by the panel and node.")})]}),e(O,{variant:"outline",size:"sm",leftIcon:e(on,{width:16,height:16}),onClick:()=>x.refetch(),isLoading:x.isFetching,children:t("actions.refresh","Refresh")})]}),e(fe,{spacing:2,mt:4,children:x.isLoading&&!x.data?e(pt,{align:"center",justify:"center",py:4,children:e(Rt,{size:"sm"})}):n(Bt,{children:[n(z,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.panelVersion","Panel image")}),e(h,{fontSize:"sm",color:"gray.500",children:(Ee=(Ce=x.data)==null?void 0:Ce.panel)!=null&&Ee.image?`${x.data.panel.image}${x.data.panel.tag?` (${x.data.panel.tag})`:""}`:t("settings.panel.versionUnknown","Unknown")})]}),n(z,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.nodeVersion","Node image")}),e(h,{fontSize:"sm",color:"gray.500",children:(ve=x.data)!=null&&ve.node?x.data.node.image?`${x.data.node.image}${x.data.node.tag?` (${x.data.node.tag})`:""}`:t("settings.panel.versionUnknown","Unknown"):t("settings.panel.nodeVersionUnavailable","Node deployment not detected")})]})]})})]}),n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Rn,{size:"sm",mb:1,children:t("settings.panel.backupTitle","Backup & Restore")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.backupDescription","Create or restore backups directly through the maintenance service.")})]}),n(fe,{spacing:3,direction:{base:"column",md:"row"},children:[e(O,{leftIcon:e(za,{width:16,height:16}),onClick:f,isLoading:v,children:t("settings.panel.backupDownload","Download backup")}),e(O,{leftIcon:e(Na,{width:16,height:16}),onClick:Oe,isLoading:T,children:t("settings.panel.backupUpload","Restore backup")})]})]}),e("input",{ref:ce,type:"file",accept:".zip,.tar.gz",style:{display:"none"},onChange:ae})]}),n(pt,{gap:3,justify:"flex-end",children:[e(O,{variant:"outline",leftIcon:e(sl,{}),onClick:()=>g(),isDisabled:oe.isLoading,children:t("actions.refresh","Refresh")}),e(O,{colorScheme:"primary",leftIcon:e(il,{}),onClick:()=>oe.mutate({use_nobetci:S}),isLoading:oe.isLoading,isDisabled:oe.isLoading||p===void 0||S===p.use_nobetci,children:t("settings.save","Save Settings")})]})]})}),e(Qt,{px:{base:0,md:2},children:c&&!o?e(pt,{align:"center",justify:"center",py:12,children:e(Rt,{size:"lg"})}):e("form",{onSubmit:A(_),children:n(he,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),n(pt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(z,{children:[e(Rn,{size:"sm",mb:1,children:t("settings.telegram.enableBot","Enable Telegram bot")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.enableBotDescription","Turn the bot on or off without clearing the API token.")})]}),e(St,{control:W,name:"use_telegram",render:({field:B})=>e(gt,{isChecked:B.value,onChange:U=>B.onChange(U.target.checked)})})]}),e(fa,{disabled:!xe,message:Re,children:e(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(Fe,{columns:{base:1,md:2},spacing:6,children:[n(C,{children:[e(D,{children:t("settings.telegram.apiToken","Bot API Token")}),e(De,{placeholder:"123456:ABC",...P("api_token")})]}),n(C,{children:[e(D,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(De,{placeholder:"socks5://user:pass@host:port",...P("proxy_url")})]}),n(C,{children:[e(D,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(De,{placeholder:"12345, 67890",...P("admin_chat_ids")}),e(ur,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),n(C,{children:[e(D,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(De,{placeholder:"-100123456789",...P("logs_chat_id")}),e(ur,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),n(C,{display:"flex",alignItems:"center",children:[e(D,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(St,{control:W,name:"logs_chat_is_forum",render:({field:B})=>e(gt,{id:"logs_chat_is_forum",isChecked:B.value,onChange:B.onChange})})]}),n(C,{children:[e(D,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(De,{placeholder:"xtls-rprx-vision",...P("default_vless_flow")})]})]})})}),e(fa,{disabled:!xe,message:Re,children:n(z,{children:[e(Rn,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),K&&Object.keys(K).length>0?e(fe,{spacing:4,children:Object.entries(K).map(([B])=>n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",B]}),n(Fe,{columns:{base:1,md:2},spacing:4,children:[n(C,{children:[e(D,{children:t("settings.telegram.topicTitle","Topic Title")}),e(De,{...P(`forum_topics.${B}.title`)})]}),n(C,{children:[e(D,{children:t("settings.telegram.topicId","Topic ID")}),e(De,{type:"number",...P(`forum_topics.${B}.topic_id`)}),e(ur,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},B))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]})}),e(fa,{disabled:!xe,message:Re,children:n(z,{children:[e(Rn,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(fe,{spacing:4,children:lc.map(B=>n(z,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(B.titleKey,B.defaultTitle)}),e(Fe,{columns:{base:1,md:2},spacing:4,children:B.events.map(U=>n(C,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[n(z,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(U.labelKey,U.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(U.hintKey,U.defaultHint)})]}),e(St,{control:W,name:`event_toggles.${Ia(U.key)}`,render:({field:j})=>e(gt,{isChecked:Boolean(j.value),onChange:de=>j.onChange(de.target.checked)})})]},U.key))})]},B.key))})]})}),n(pt,{gap:3,justify:"flex-end",children:[e(O,{variant:"outline",leftIcon:e(sl,{}),onClick:()=>u(),isDisabled:H.isLoading,children:t("actions.refresh","Refresh")}),e(O,{colorScheme:"primary",leftIcon:e(il,{}),type:"submit",isLoading:H.isLoading,isDisabled:!ge&&!H.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(Qt,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},Dg=async()=>{try{const t=Is();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const s=await ze("/admin",{headers:{Authorization:`Bearer ${t}`}});if(s&&typeof s=="object"&&"error"in s)throw new Error(`API error: ${s.error||"Unknown error"}`);return s}catch(t){throw console.error("Loader error:",t),t}},Ag=Rd([{path:"/",element:e(Vu,{}),errorElement:e(ao,{}),loader:Dg,children:[{index:!0,element:e(ch,{})},{path:"users",element:e(ap,{})},{path:"admins",element:e(bp,{})},{path:"usage",element:e(vg,{})},{path:"services",element:e(og,{})},{path:"hosts",element:e(im,{})},{path:"node-settings",element:e(Cm,{})},{path:"integrations",element:e(_g,{})},{path:"xray-settings",element:e(ig,{})},{path:"xray-logs",element:e(ic,{})}]},{path:"/login/",element:e(ao,{})}]);function Ig(){return e(Md,{router:Ag})}Me.extend(Ud);Me.extend(Ld);Me.extend(mi);Me.extend(Od);Me.extend(Wd);zi(Fd.get()||"light");Hd.createRoot(document.getElementById("root")).render(e(ba.StrictMode,{children:e(Bd,{theme:$d,children:e(Vd,{client:Ni,children:e(Ig,{})})})}));
