var Fl=Object.defineProperty;var Hl=(t,s,r)=>s in t?Fl(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var K=(t,s,r)=>(Hl(t,typeof s!="symbol"?s+"":s,r),r);import{i as si,B as Bl,a as Vl,b as $l,j as Lo,d as Pe,U as la,z as Kl,r as Jl,f as ql,Q as Yl,e as Gl,m as Et,$ as Ql,c as ee,X as ca,R as Qi,N as In,I as we,g as Tn,h as n,F as k,k as e,l as _,n as wr,o as Xl,p as da,q as Ot,s as Zl,t as jl,u as ec,v as tc,w as Er,x as Xr,L as rc,C as Si,y as $e,A as st,M as ui,D as hi,E as Ue,G as pi,H as nr,J as R,K as nc,T as h,S as sc,P as ic,O as Xi,V as nn,W as mi,Y as ua,Z as ha,_ as ac,a0 as Bt,a1 as Jr,a2 as Yt,a3 as d,a4 as Da,a5 as N,a6 as gi,a7 as Ut,a8 as wt,a9 as Lt,aa as At,ab as Rt,ac as kt,ad as de,ae as Ve,af as ke,ag as Lr,ah as F,ai as zt,aj as Ar,ak as Ae,al as oc,am as zs,an as pa,ao as lc,ap as ma,aq as Or,ar as tn,as as cn,at as Ir,au as Tr,av as yn,aw as xi,ax as Nr,ay as cc,az as Oo,aA as dc,aB as uc,aC as hc,aD as pc,aE as wi,aF as Wo,aG as Fo,aH as ct,aI as Xn,aJ as Aa,aK as mc,aL as gc,aM as fc,aN as Ho,aO as xr,aP as lt,aQ as bc,aR as yc,aS as Bo,aT as Vo,aU as ns,aV as Sc,aW as xc,aX as ki,aY as Dt,aZ as $o,a_ as Kr,a$ as un,b0 as wc,b1 as Rs,b2 as rn,b3 as Ko,b4 as kc,b5 as vc,b6 as je,b7 as Jo,b8 as Cc,b9 as _c,ba as ga,bb as qo,bc as Yo,bd as Dc,be as Ac,bf as Ic,bg as Go,bh as ss,bi as is,bj as Qo,bk as as,bl as os,bm as Tc,bn as Pc,bo as Ec,bp as Es,bq as Ia,br as ls,bs as cs,bt as $t,bu as ds,bv as Kt,bw as Nc,bx as zc,by as Sn,bz as Rc,bA as Ht,bB as Mc,bC as pt,bD as ht,bE as Xo,bF as en,bG as sn,bH as Zo,bI as jo,bJ as el,bK as Pn,bL as Zr,bM as _t,bN as He,bO as $r,bP as Ne,bQ as Xs,bR as Wn,bS as tl,bT as rl,bU as nl,bV as Ta,bW as on,bX as Uc,bY as Lc,bZ as Oc,b_ as Wc,b$ as Fc,c0 as Hc,c1 as Ms,c2 as Us,c3 as Fs,c4 as sl,c5 as bt,c6 as Bc,c7 as qn,c8 as Pr,c9 as Hs,ca as il,cb as Jn,cc as ii,cd as Vc,ce as al,cf as fa,cg as Dr,ch as ol,ci as fi,cj as Qr,ck as Bs,cl as Yn,cm as $c,cn as Kc,co as Jc,cp as qc,cq as ai,cr as Ns,cs as ll,ct as cl,cu as Yc,cv as Gc,cw as Qc,cx as Xc,cy as Zc,cz as jc,cA as ed,cB as td,cC as rd,cD as Pa,cE as nd,cF as sd,cG as id,cH as ba,cI as ad,cJ as kn,cK as od,cL as ld,cM as cd,cN as dd,cO as ud,cP as hd,cQ as pd,cR as md,cS as gd,cT as fd}from"./vendor.e8ebbe25.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();si.use(Bl).use(Vl).use($l).init({debug:{}.NODE_ENV==="development",returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:Lo(["/","statics/locales/{{lng}}.json"])}},function(t,s){t?console.error("i18next initialization error:",t):console.log("i18next initialized successfully with language:",si.language),Pe.locale(si.language)});si.on("languageChanged",t=>{console.log("Language changed to:",t),Pe.locale(t)});la("zh-cn",Kl);la("ru",Jl);la("fa",ql);const oi=new Yl,li=(t,s)=>{const r=document.querySelector('meta[name="theme-color"]'),l={dark:"#0f172a",light:"#f6f8ff",default:"#f6f8ff","ultra-dark":"#091212",moontone:"#0f1930",purple:"#1a1031",green:"#071c10",custom:s||"#f6f8ff"},o=s||l[t]||l.default;r==null||r.setAttribute("content",o)},bd=Gl({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",bg:{light:"var(--bg-light)",dark:"var(--bg-dark)"},surface:{light:"var(--surface-light)",dark:"var(--surface-dark)"},primary:{50:"var(--primary-50)",100:"var(--primary-100)",200:"var(--primary-200)",300:"var(--primary-300)",400:"var(--primary-400)",500:"var(--primary-500)",600:"var(--primary-600)",700:"var(--primary-700)",800:"var(--primary-800)",900:"var(--primary-900)"},gray:{750:"#222C3B"}},styles:{global:{":root":{"--primary-50":"#9cb7f2","--primary-100":"#88a9ef","--primary-200":"#749aec","--primary-300":"#618ce9","--primary-400":"#4d7de7","--primary-500":"#396fe4","--primary-600":"#3364cd","--primary-700":"#2e59b6","--primary-800":"#284ea0","--primary-900":"#224389","--bg-light":"#f6f8ff","--bg-dark":"#0f172a","--surface-light":"#ffffff","--surface-dark":"#141f35"},".rb-theme-dark":{"--primary-50":"#1a202c","--primary-100":"#2d3748","--primary-200":"#4a5568","--primary-300":"#718096","--primary-400":"#a0aec0","--primary-500":"#cbd5e0","--primary-600":"#e2e8f0","--primary-700":"#f7fafc","--primary-800":"#ffffff","--primary-900":"#ffffff","--bg-light":"#1a202c","--bg-dark":"#0b1524","--surface-light":"#232c3d","--surface-dark":"#121c2c"},body:{backgroundColor:"var(--bg-light)"},"[data-theme='dark'] body, .chakra-ui-dark body":{backgroundColor:"var(--bg-dark)"},".rb-theme-ultra-dark":{"--primary-50":"#e6fffa","--primary-100":"#b2f5ea","--primary-200":"#81e6d9","--primary-300":"#4fd1c5","--primary-400":"#38b2ac","--primary-500":"#319795","--primary-600":"#2c7a7b","--primary-700":"#285e61","--primary-800":"#234e52","--primary-900":"#1b4046","--bg-light":"#edfafa","--bg-dark":"#091212","--surface-light":"#ffffff","--surface-dark":"#0f1f1f"},".rb-theme-moontone":{"--primary-50":"#ebf8ff","--primary-100":"#dbeafe","--primary-200":"#bfdbfe","--primary-300":"#93c5fd","--primary-400":"#60a5fa","--primary-500":"#3b82f6","--primary-600":"#2563eb","--primary-700":"#1d4ed8","--primary-800":"#1e40af","--primary-900":"#172554","--bg-light":"#f5f7ff","--bg-dark":"#0f1930","--surface-light":"#ffffff","--surface-dark":"#172544"},".rb-theme-purple":{"--primary-50":"#f5f3ff","--primary-100":"#ede9fe","--primary-200":"#ddd6fe","--primary-300":"#c4b5fd","--primary-400":"#a78bfa","--primary-500":"#7c3aed","--primary-600":"#6d28d9","--primary-700":"#5b21b6","--primary-800":"#4c1d95","--primary-900":"#3b0f73","--bg-light":"#f8f2ff","--bg-dark":"#1a1031","--surface-light":"#ffffff","--surface-dark":"#261547"},".rb-theme-green":{"--primary-50":"#ecfdf5","--primary-100":"#d1fae5","--primary-200":"#a7f3d0","--primary-300":"#6ee7b7","--primary-400":"#34d399","--primary-500":"#10b981","--primary-600":"#059669","--primary-700":"#047857","--primary-800":"#065f46","--primary-900":"#064e3b","--bg-light":"#eefdf4","--bg-dark":"#071c10","--surface-light":"#ffffff","--surface-dark":"#0f2a18"}}},components:{Card:{baseStyle:t=>({container:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),boxShadow:"none"}})},Modal:{baseStyle:t=>({dialog:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),borderRadius:"lg",boxShadow:Et("xl","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)}})},Drawer:{baseStyle:t=>({dialog:{bg:Et("surface.light","surface.dark")(t),borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),borderWidth:"0"}})},Menu:{baseStyle:t=>({list:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Et("lg","dark-lg")(t)},item:{_hover:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)},_focus:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)}}})},Popover:{baseStyle:t=>({content:{bg:Et("surface.light","surface.dark")(t),borderWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),boxShadow:Et("lg","dark-lg")(t)},header:{borderBottomWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)},footer:{borderTopWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t)}})},Accordion:{baseStyle:t=>({container:{borderTopWidth:"0",borderBottomWidth:"1px",borderColor:Et("blackAlpha.100","whiteAlpha.200")(t),_last:{borderBottomWidth:"1px"}},button:{bg:"transparent",_hover:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)},_expanded:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)}},panel:{bg:Et("surface.light","surface.dark")(t)}})},Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600",borderRadius:"6px"},_light:{borderRadius:"6px"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_disabled:{color:"gray.400",borderColor:"gray.500"},_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}},Button:{variants:{outline:t=>({borderColor:Et("blackAlpha.300","whiteAlpha.300")(t),_hover:{bg:Et("blackAlpha.50","whiteAlpha.100")(t)},_active:{bg:Et("blackAlpha.100","whiteAlpha.200")(t)}})}}}});const Zn=()=>localStorage.getItem("token"),yd=t=>{localStorage.setItem("token",t)},Sd=()=>{localStorage.removeItem("token")},xd=Ql.create({baseURL:"https://bot.mazholl.com:8585/api"}),wd=(t,s={})=>(Zn()&&(s.headers={...(s==null?void 0:s.headers)||{},Authorization:`Bearer ${Zn()}`}),xd(t,s)),_e=wd,kd=ee(ca,{baseStyle:{w:4,h:4}}),Zt=Qi.forwardRef(({disabled:t,step:s,label:r,className:l,startAdornment:o,endAdornment:i,type:a="text",placeholder:c,onChange:u,onBlur:p,name:m,value:g,onClick:I,error:D,clearable:w=!1,...x},v)=>{const C=()=>{u&&u({target:{value:"",name:m}})},{size:z="md"}=x,ne=a=="number"?In:we,b=a=="number"?Tn:Qi.Fragment,U=a=="number"?{keepWithinRange:!0,precision:5,format:T=>isNaN(parseFloat(String(T)))||Number(parseFloat(String(T)).toFixed(5))===0?T:Number(parseFloat(String(T)).toFixed(5)),min:typeof x.min=="number"?x.min:x.min!==void 0?Number(x.min):0,step:s,name:m,type:a,placeholder:c,onBlur:p,onClick:I,disabled:t,flexGrow:1,size:z,onChange:(T,O)=>{!u||u({target:{value:T,valueAsNumber:O,name:m}})}}:{};return n(k,{isInvalid:!!D,children:[r&&e(_,{children:r}),n(wr,{size:z,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[o&&e(Xl,{children:o}),n(b,{...U,children:[e(ne,{name:m,ref:v,step:s,className:da(l),type:a,placeholder:c,onChange:a==="number"?void 0:u,onBlur:p,value:a==="number"?void 0:g,onClick:I,disabled:t,flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...x,roundedLeft:o?"0":"md",roundedRight:i?"0":"md"}),a=="number"&&e(Ot,{children:n(Zl,{children:[e(jl,{}),e(ec,{})]})})]}),i&&e(tc,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",children:i}),w&&g&&g.length&&e(Er,{borderLeftRadius:0,borderRightRadius:"6px",bg:"transparent",onClick:C,cursor:"pointer",children:e(kd,{})})]}),!!D&&e(Xr,{children:D})]})}),Zi="/statics/logo.e8dba2f4.svg",vd=ee(rc,{baseStyle:{w:4,h:4}}),Cd=ee(Si,{baseStyle:{w:4,h:4}}),dl=({actions:t})=>{const{i18n:s}=$e(),r=st("surface.light","surface.dark"),l=st("blackAlpha.50","whiteAlpha.100"),o=st("blackAlpha.200","whiteAlpha.200"),i=st("gray.800","gray.100"),a=u=>{s.changeLanguage(u)};return n(ui,{placement:"bottom-end",children:[e(hi,{as:Ue,size:"sm",variant:"outline",icon:e(vd,{}),position:"relative"}),e(pi,{minW:"160px",zIndex:9999,bg:r,borderColor:o,color:i,children:[{code:"en",label:"English",flag:"US"},{code:"fa",label:"\u0641\u0627\u0631\u0633\u06CC",flag:"IR"},{code:"zh-cn",label:"\u4E2D\u6587",flag:"CN"},{code:"ru",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",flag:"RU"}].map(({code:u,label:p,flag:m})=>e(nr,{fontSize:"sm",onClick:()=>a(u),_hover:{bg:l},children:n(R,{justify:"space-between",w:"full",children:[n(R,{spacing:2,children:[e(nc,{countryCode:m,svg:!0,style:{width:"16px",height:"12px"}}),e(h,{children:p})]}),s.language===u&&e(Cd,{})]})},u))})]})},Ea="rb-theme",Na="rb-custom-themes",_d=["--primary-50","--primary-100","--primary-200","--primary-300","--primary-400","--primary-500","--primary-600","--primary-700","--primary-800","--primary-900"],za=[{key:"light",accent:"#f7fafc",colorModeTarget:"light"},{key:"dark",accent:"#1a202c",colorModeTarget:"dark",className:"rb-theme-dark"},{key:"default",accent:"#396fe4"},{key:"ultra-dark",accent:"#319795",className:"rb-theme-ultra-dark"},{key:"moontone",accent:"#3b82f6",className:"rb-theme-moontone"},{key:"purple",accent:"#7c3aed",className:"rb-theme-purple"},{key:"green",accent:"#10b981",className:"rb-theme-green"}],Ra=[{key:"sunset",light:{primary:"#f97316",bg:"#fdf5ef",surface:"#fff2e5"},dark:{primary:"#fb923c",bg:"#1f130c",surface:"#2d1a12"}},{key:"ocean",light:{primary:"#0284c7",bg:"#f3f9ff",surface:"#e7f3ff"},dark:{primary:"#38bdf8",bg:"#0b1620",surface:"#132233"}},{key:"forest",light:{primary:"#16a34a",bg:"#f3faf4",surface:"#e8f7ea"},dark:{primary:"#22c55e",bg:"#0b1610",surface:"#14251a"}}],fr={primary:"#396fe4",bg:"#f6f8ff",surface:"#ffffff"},br={primary:"#4f46e5",bg:"#0f172a",surface:"#141f35"},Ei=.14,Ni=.22,Ma=ee(Si,{baseStyle:{w:4,h:4}}),Dd=ee(sc,{baseStyle:{w:4,h:4}}),Ad=ee(ic,{baseStyle:{w:4,h:4}}),Id=ee(Xi,{baseStyle:{w:4,h:4}}),Td=ee(nn,{baseStyle:{w:4,h:4}}),Ua=ee(mi,{baseStyle:{w:4,h:4}}),Pd=ee(ua,{baseStyle:{w:4,h:4}}),Ed=ee(ha,{baseStyle:{w:4,h:4}}),Nd=ee(ac,{baseStyle:{w:4,h:4}}),ul=(t,s=0,r=1)=>Math.min(r,Math.max(s,t)),ji=t=>{const s=t.replace("#",""),r=parseInt(s,16);if(s.length===3){const l=r>>8&15,o=r>>4&15,i=r&15;return{r:l<<4|l,g:o<<4|o,b:i<<4|i}}return{r:r>>16&255,g:r>>8&255,b:r&255}},hl=(t,s,r)=>{const l=o=>o.toString(16).padStart(2,"0");return`#${l(t)}${l(s)}${l(r)}`},zd=(t,s,r)=>{t/=255,s/=255,r/=255;const l=Math.max(t,s,r),o=Math.min(t,s,r);let i=0,a=0;const c=(l+o)/2;if(l!==o){const u=l-o;switch(a=c>.5?u/(2-l-o):u/(l+o),l){case t:i=(s-r)/u+(s<r?6:0);break;case s:i=(r-t)/u+2;break;default:i=(t-s)/u+4}i/=6}return{h:i,s:a,l:c}},Rd=(t,s,r)=>{let l,o,i;if(s===0)l=o=i=r;else{const a=(p,m,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?p+(m-p)*6*g:g<.5?m:g<.6666666666666666?p+(m-p)*(.6666666666666666-g)*6:p),c=r<.5?r*(1+s):r+s-r*s,u=2*r-c;l=a(u,c,t+1/3),o=a(u,c,t),i=a(u,c,t-1/3)}return{r:Math.round(l*255),g:Math.round(o*255),b:Math.round(i*255)}},zi=t=>{try{const{r:s,g:r,b:l}=ji(t),{h:o,s:i,l:a}=zd(s,r,l);return[["50",.4],["100",.28],["200",.18],["300",.08],["400",.04],["500",0],["600",-.06],["700",-.12],["800",-.18],["900",-.26]].reduce((u,[p,m])=>{const{r:g,g:I,b:D}=Rd(o,i,ul(a+m));return u[`--primary-${p}`]=hl(g,I,D),u},{})}catch{return{}}},Md=(t,s,r)=>{const l=ul(r,0,1),o=ji(t),i=ji(s),a=(c,u)=>Math.round(c*(1-l)+u*l);return hl(a(o.r,i.r),a(o.g,i.g),a(o.b,i.b))},Fn=(t,s,r,l)=>{try{return Md(t,s,r)}catch{return l}},Ud=()=>{const t=document.documentElement;_d.forEach(s=>t.style.removeProperty(s)),t.style.removeProperty("--bg-light"),t.style.removeProperty("--bg-dark"),t.style.removeProperty("--surface-light"),t.style.removeProperty("--surface-dark")},Ld=(t,s)=>{const r=document.documentElement;Object.entries(t).forEach(([l,o])=>r.style.setProperty(l,o)),r.style.setProperty("--bg-light",s.bgLight),r.style.setProperty("--bg-dark",s.bgDark),r.style.setProperty("--surface-light",s.surfaceLight),r.style.setProperty("--surface-dark",s.surfaceDark)},Ri=()=>{try{return crypto.randomUUID()}catch{return Math.random().toString(36).slice(2,10)}},La=()=>({name:"",light:{...fr},dark:{...br}}),Jt=(t,s)=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)?t:s,pl=({minimal:t=!1})=>{const{t:s}=$e(),r=Bt(),{colorMode:l,toggleColorMode:o}=Jr(),i=Yt(),a=Yt(),c=st("surface.light","surface.dark"),u=st("blackAlpha.50","whiteAlpha.100"),p=st("blackAlpha.200","whiteAlpha.200"),m=st("gray.800","gray.100"),g=st("gray.600","gray.300"),I=st("blackAlpha.400","blackAlpha.700"),D=d.exports.useMemo(()=>({".chakra-menu__group__title":{fontSize:"xs",textTransform:"uppercase",letterSpacing:"wider",fontWeight:"semibold",color:g}}),[g]),[w,x]=d.exports.useState(()=>{try{return localStorage.getItem(Ea)||"default"}catch{return"default"}}),[v,C]=d.exports.useState(()=>{try{const y=localStorage.getItem(Na);if(!y)return[];const P=JSON.parse(y);return Array.isArray(P)?P.map(ie=>{var he,ze,at,pe,oe,le;const te=Jt(((he=ie.light)==null?void 0:he.primary)||fr.primary,fr.primary),Ce=Jt(((ze=ie.light)==null?void 0:ze.bg)||fr.bg,fr.bg),Te=Fn(Ce,te,Ei,fr.surface),Re=Jt(((at=ie.light)==null?void 0:at.surface)||Te,Te),Oe=Jt(((pe=ie.dark)==null?void 0:pe.primary)||br.primary,br.primary),B=Jt(((oe=ie.dark)==null?void 0:oe.bg)||br.bg,br.bg),V=Fn(B,Oe,Ni,br.surface),L=Jt(((le=ie.dark)==null?void 0:le.surface)||V,V);return{id:ie.id||Ri(),name:ie.name||"Custom",light:{primary:te,bg:Ce,surface:Re},dark:{primary:Oe,bg:B,surface:L}}}):[]}catch{return[]}}),[z,ne]=d.exports.useState(La),[b,U]=d.exports.useState(null),[T,O]=d.exports.useState("");d.exports.useEffect(()=>{try{localStorage.setItem(Na,JSON.stringify(v))}catch{}},[v]),d.exports.useEffect(()=>{try{localStorage.setItem(Ea,w)}catch{}},[w]),d.exports.useEffect(()=>{w.startsWith("custom:")&&(v.some(P=>`custom:${P.id}`===w)||x("default"))},[w,v]),d.exports.useEffect(()=>{const y=document.documentElement;Array.from(y.classList).filter(ie=>ie.startsWith("rb-theme-")).forEach(ie=>y.classList.remove(ie)),Ud();const P=za.find(ie=>ie.key===w);if(P){P.className&&y.classList.add(P.className),li(P.key);return}if(w.startsWith("custom:")){const ie=v.find(Te=>`custom:${Te.id}`===w);if(!ie)return;const te=l==="dark"?ie.dark:ie.light,Ce=zi(te.primary);Ld(Ce,{bgLight:ie.light.bg,bgDark:ie.dark.bg,surfaceLight:ie.light.surface,surfaceDark:ie.dark.surface}),li("custom",l==="dark"?ie.dark.bg:ie.light.bg)}else li("default")},[w,v,l]);const ve=d.exports.useCallback(y=>{y.colorModeTarget&&l!==y.colorModeTarget&&o(),x(y.key)},[l,o]),Z=y=>{x(`custom:${y}`)},J=y=>{U(null),ne(y?{name:s(`theme.presets.${y.key}.name`),light:{...y.light},dark:{...y.dark}}:La()),i.onOpen()},E=y=>{U(y.id),ne({name:y.name,light:{...y.light},dark:{...y.dark}}),i.onOpen()},q=()=>{const y=z.name.trim()||s("theme.untitled"),P=Jt(z.light.primary,fr.primary),ie=Jt(z.light.bg,fr.bg),te=Fn(ie,P,Ei,fr.surface),Ce=Jt(z.light.surface,te),Te=Jt(z.dark.primary,br.primary),Re=Jt(z.dark.bg,br.bg),Oe=Fn(Re,Te,Ni,br.surface),B=Jt(z.dark.surface,Oe),V={id:b||Ri(),name:y,light:{primary:P,bg:ie,surface:Ce},dark:{primary:Te,bg:Re,surface:B}};C(L=>b?L.map(he=>he.id===b?V:he):[...L,V]),x(`custom:${V.id}`),i.onClose(),U(null),r({status:"success",title:s("theme.customSaved")})},ue=y=>{C(P=>P.filter(ie=>ie.id!==y)),w===`custom:${y}`&&x("default"),r({status:"info",title:s("theme.customDeleted")})},Y=()=>{x("default"),r({status:"info",title:s("theme.resetSuccess")})},re=async()=>{if(!v.length){r({status:"warning",title:s("theme.exportEmpty")});return}const y=v.map(({id:ie,...te})=>te),P=JSON.stringify(y,null,2);try{await navigator.clipboard.writeText(P),r({status:"success",title:s("theme.exportSuccess")})}catch{try{const ie=new Blob([P],{type:"application/json"}),te=URL.createObjectURL(ie),Ce=document.createElement("a");Ce.href=te,Ce.download="rebecca-themes.json",Ce.click(),URL.revokeObjectURL(te),r({status:"success",title:s("theme.exportSuccessDownload")})}catch{r({status:"error",title:s("theme.exportError")})}}},A=()=>{try{const y=JSON.parse(T),ie=(Array.isArray(y)?y:[y]).map(te=>{var ze,at,pe,oe,le,$;const Ce=Jt(((ze=te==null?void 0:te.light)==null?void 0:ze.primary)||fr.primary,fr.primary),Te=Jt(((at=te==null?void 0:te.light)==null?void 0:at.bg)||fr.bg,fr.bg),Re=Fn(Te,Ce,Ei,fr.surface),Oe=Jt(((pe=te==null?void 0:te.light)==null?void 0:pe.surface)||Re,Re),B=Jt(((oe=te==null?void 0:te.dark)==null?void 0:oe.primary)||br.primary,br.primary),V=Jt(((le=te==null?void 0:te.dark)==null?void 0:le.bg)||br.bg,br.bg),L=Fn(V,B,Ni,br.surface),he=Jt((($=te==null?void 0:te.dark)==null?void 0:$.surface)||L,L);return{id:Ri(),name:(te==null?void 0:te.name)||"Custom",light:{primary:Ce,bg:Te,surface:Oe},dark:{primary:B,bg:V,surface:he}}}).filter(te=>te.name);if(!ie.length){r({status:"warning",title:s("theme.importError")});return}C(te=>[...te,...ie]),a.onClose(),O(""),r({status:"success",title:s("theme.importSuccess")})}catch{r({status:"error",title:s("theme.importError")})}},me=d.exports.useCallback((y,P)=>{y.preventDefault(),y.stopPropagation(),P()},[]),De=d.exports.useMemo(()=>zi(z.light.primary),[z.light.primary]),Ee=d.exports.useMemo(()=>zi(z.dark.primary),[z.dark.primary]),W=y=>{const P=z[y],ie=y==="dark"?Ee:De,te=ie["--primary-500"]||P.primary,Ce=ie["--primary-300"]||ie["--primary-400"]||te,Te=y==="dark"?"whiteAlpha.900":"gray.800",Re=y==="dark"?"whiteAlpha.700":"gray.600",Oe=y==="dark"?"whiteAlpha.200":"blackAlpha.200",B=y==="dark"?"whiteAlpha.300":"blackAlpha.100";return e(N,{borderWidth:"1px",borderRadius:"md",bg:P.bg,p:4,borderColor:Oe,children:n(ke,{spacing:3,children:[e(h,{fontWeight:"semibold",color:Te,children:s(y==="dark"?"theme.customPreviewDark":"theme.customPreviewLight")}),e(N,{borderRadius:"lg",bg:P.surface,p:4,borderWidth:"1px",borderColor:Oe,children:n(ke,{spacing:2,children:[e(h,{fontSize:"lg",fontWeight:"bold",color:Te,children:s("theme.previewSampleTitle")}),e(h,{fontSize:"sm",color:Re,children:s("theme.previewSampleBody")}),e(F,{size:"sm",bg:te,color:"white",_hover:{opacity:.9},alignSelf:"flex-start",children:s("theme.previewSampleAction")}),n(R,{spacing:2,pt:2,children:[e(N,{flex:"1",h:"2",borderRadius:"full",bg:Ce,opacity:.8}),e(N,{flex:"1",h:"2",borderRadius:"full",bg:te,opacity:.9})]})]})}),n(R,{spacing:1,pt:1,flexWrap:"wrap",children:[e(N,{w:6,h:6,borderRadius:"sm",bg:P.bg,borderWidth:"1px",borderColor:B}),e(N,{w:6,h:6,borderRadius:"sm",bg:P.surface,borderWidth:"1px",borderColor:B}),Object.entries(ie).map(([V,L])=>e(N,{w:6,h:6,borderRadius:"sm",bg:L,borderWidth:"1px",borderColor:B,title:V},V))]})]})})};return n(Ot,{children:[n(ui,{placement:"bottom-end",children:[e(hi,{as:Ue,size:"sm",variant:"outline",icon:e(Dd,{}),position:"relative"}),n(pi,{minW:"260px",zIndex:9999,bg:c,color:m,borderColor:p,children:[e(Da,{title:s("theme.builtIn"),sx:D,children:za.map(y=>{const P=w===y.key;return e(nr,{onClick:()=>ve(y),_hover:{bg:u},children:n(R,{justify:"space-between",w:"full",children:[n(R,{children:[e(N,{w:"4",h:"3",bg:y.accent,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:s(`theme.${y.key}`)})]}),P&&e(Ma,{})]})},y.key)})}),!t&&n(Ot,{children:[e(gi,{borderColor:p}),n(Da,{title:s("theme.customGroup"),sx:D,children:[v.length?v.map(y=>{const P=w===`custom:${y.id}`;return e(nr,{onClick:()=>Z(y.id),_hover:{bg:u},children:n(R,{justify:"space-between",w:"full",children:[n(R,{children:[e(N,{w:"4",h:"3",bg:"transparent",bgGradient:`linear(to-r, ${y.light.surface}, ${y.light.primary})`,borderRadius:"xs",borderWidth:"1px",borderColor:p}),e(h,{children:y.name})]}),n(R,{spacing:1,children:[P&&e(Ma,{}),[{icon:e(Id,{}),label:s("theme.edit"),onClick:()=>E(y)},{icon:e(Td,{}),label:s("theme.delete"),onClick:()=>ue(y.id)}].map(({icon:ie,label:te,onClick:Ce})=>e(N,{as:"span",role:"button",tabIndex:0,"aria-label":te,onClick:Te=>me(Te,Ce),onKeyDown:Te=>{(Te.key==="Enter"||Te.key===" ")&&me(Te,Ce)},cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",w:6,h:6,borderRadius:"md",transition:"background-color 0.2s ease",_hover:{bg:u},_focusVisible:{outline:"2px solid",outlineColor:"primary.400",outlineOffset:"2px"},children:ie},te))]})]})},y.id)}):e(nr,{isDisabled:!0,children:s("theme.noCustom")}),e(nr,{icon:e(Ad,{}),onClick:()=>J(),_hover:{bg:u},children:s("theme.createCustom")})]}),e(gi,{borderColor:p}),e(nr,{icon:e(Ua,{}),onClick:()=>J(Ra[0]),_hover:{bg:u},children:s("theme.quickPreset")}),e(nr,{icon:e(Pd,{}),onClick:re,_hover:{bg:u},children:s("theme.export")}),e(nr,{icon:e(Ed,{}),onClick:()=>a.onOpen(),_hover:{bg:u},children:s("theme.import")}),e(nr,{icon:e(Nd,{}),onClick:Y,_hover:{bg:u},children:s("theme.reset")})]})]})]}),n(Ut,{isOpen:i.isOpen,onClose:i.onClose,isCentered:!0,size:"xl",children:[e(wt,{bg:I,backdropFilter:"blur(4px)"}),n(Lt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:m,children:[e(At,{color:m,children:s(b?"theme.editThemeTitle":"theme.customTitle")}),e(Rt,{}),e(kt,{children:n(de,{spacing:6,align:"stretch",children:[n(k,{children:[e(_,{color:g,children:s("theme.customName")}),e(we,{placeholder:s("theme.customNamePlaceholder")||"",value:z.name,onChange:y=>ne(P=>({...P,name:y.target.value}))})]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[W("light"),W("dark")]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(ke,{spacing:4,children:[n(k,{children:[e(_,{color:g,children:s("theme.lightPrimary")}),e(we,{type:"color",value:z.light.primary,onChange:y=>ne(P=>({...P,light:{...P.light,primary:y.target.value}}))}),e(Lr,{color:g,children:s("theme.lightPrimaryHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.lightSurface")}),e(we,{type:"color",value:z.light.surface,onChange:y=>ne(P=>({...P,light:{...P.light,surface:y.target.value}}))}),e(Lr,{color:g,children:s("theme.lightSurfaceHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.lightBackground")}),e(we,{type:"color",value:z.light.bg,onChange:y=>ne(P=>({...P,light:{...P.light,bg:y.target.value}}))})]})]}),n(ke,{spacing:4,children:[n(k,{children:[e(_,{color:g,children:s("theme.darkPrimary")}),e(we,{type:"color",value:z.dark.primary,onChange:y=>ne(P=>({...P,dark:{...P.dark,primary:y.target.value}}))}),e(Lr,{color:g,children:s("theme.darkPrimaryHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.darkSurface")}),e(we,{type:"color",value:z.dark.surface,onChange:y=>ne(P=>({...P,dark:{...P.dark,surface:y.target.value}}))}),e(Lr,{color:g,children:s("theme.darkSurfaceHint")})]}),n(k,{children:[e(_,{color:g,children:s("theme.darkBackground")}),e(we,{type:"color",value:z.dark.bg,onChange:y=>ne(P=>({...P,dark:{...P.dark,bg:y.target.value}}))})]})]})]}),n(N,{children:[n(R,{mb:2,children:[e(Ua,{}),e(h,{fontWeight:"semibold",children:s("theme.presets")})]}),e(Ve,{columns:{base:1,md:3},spacing:3,children:Ra.map(y=>e(F,{size:"sm",variant:"outline",onClick:()=>ne({name:s(`theme.presets.${y.key}.name`),light:{...y.light},dark:{...y.dark}}),children:s(`theme.presets.${y.key}.name`)},y.key))})]})]})}),n(zt,{children:[e(F,{variant:"ghost",mr:3,onClick:i.onClose,children:s("cancel")}),e(F,{colorScheme:"primary",onClick:q,children:s(b?"theme.customUpdate":"theme.customSave")})]})]})]}),n(Ut,{isOpen:a.isOpen,onClose:a.onClose,size:"lg",isCentered:!0,children:[e(wt,{bg:I,backdropFilter:"blur(4px)"}),n(Lt,{mx:4,bg:c,borderColor:p,borderWidth:"1px",color:m,children:[e(At,{color:m,children:s("theme.importTitle")}),e(Rt,{}),e(kt,{children:n(de,{spacing:4,align:"stretch",children:[e(h,{fontSize:"sm",color:g,children:s("theme.importDescription")}),e(Ar,{rows:8,placeholder:s("theme.importPlaceholder")||"",value:T,onChange:y=>O(y.target.value),bg:"transparent",borderColor:p,color:m})]})}),n(zt,{children:[e(F,{variant:"ghost",mr:3,onClick:a.onClose,children:s("cancel")}),e(F,{colorScheme:"primary",onClick:A,children:s("theme.importAction")})]})]})]})]})},Od=Ae.object({username:Ae.string().min(1,"login.fieldRequired"),password:Ae.string().min(1,"login.fieldRequired")}),Wd=ee("img",{baseStyle:{w:12,h:12}}),Fd=ee(oc,{baseStyle:{w:5,h:5,strokeWidth:"2px"}}),Hd=ee(zs,{baseStyle:{w:4,h:4}}),Bd=ee(pa,{baseStyle:{w:4,h:4}}),Oa=()=>{var w,x;const[t,s]=d.exports.useState(""),[r,l]=d.exports.useState(!1),[o,i]=d.exports.useState(!1),a=lc(),{t:c}=$e(),{colorMode:u}=Jr();let p=ma();const{register:m,formState:{errors:g},handleSubmit:I}=Or({resolver:xi(Od)});d.exports.useEffect(()=>{Sd(),p.pathname!=="/login"&&a("/login",{replace:!0})},[]);const D=v=>{s("");const C=new FormData;C.append("username",v.username),C.append("password",v.password),C.append("grant_type","password"),l(!0),_e("/admin/token",{method:"post",body:C}).then(({access_token:z})=>{console.log("Token received:",z),yd(z),a("/")}).catch(z=>{var ne,b;s(((b=(ne=z.response)==null?void 0:ne._data)==null?void 0:b.detail)||"Login failed")}).finally(()=>l(!1))};return e(de,{justifyContent:"center",minH:"100vh",p:"6",w:"full",children:e(tn,{maxW:"500px",w:"full",bg:"surface.light",_dark:{bg:"surface.dark",borderColor:"whiteAlpha.200"},borderWidth:"1px",borderColor:"light-border",boxShadow:"md",children:n(cn,{children:[n(R,{justifyContent:"end",spacing:2,mb:6,children:[e(dl,{}),e(pl,{minimal:!0})]}),n(de,{alignItems:"center",w:"full",spacing:4,children:[e(Wd,{src:Zi,alt:c("appName")||"Rebecca",filter:u==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"2xl",fontWeight:"semibold",children:c("login.loginYourAccount")}),e(h,{color:"gray.600",_dark:{color:"gray.400"},children:c("login.welcomeBack")})]}),e(N,{w:"full",pt:"4",children:e("form",{onSubmit:I(D),children:n(de,{spacing:4,children:[e(k,{children:e(Zt,{w:"full",placeholder:c("username"),...m("username"),error:c((w=g==null?void 0:g.username)==null?void 0:w.message)})}),n(k,{isInvalid:!!g.password,children:[n(wr,{children:[e(we,{w:"full",type:o?"text":"password",placeholder:c("password"),...m("password")}),e(Er,{children:e(Ue,{"aria-label":o?c("admins.hidePassword","Hide"):c("admins.showPassword","Show"),size:"sm",variant:"ghost",onClick:()=>i(!o),icon:o?e(Bd,{}):e(Hd,{})})})]}),e(Xr,{children:(x=g.password)==null?void 0:x.message})]}),t&&n(Ir,{status:"error",rounded:"md",children:[e(Tr,{}),e(yn,{children:t})]}),n(F,{isLoading:r,type:"submit",w:"full",colorScheme:"primary",children:[e(Fd,{marginRight:1}),c("login")]})]})})})]})})})},Vd=async()=>await _e("/admin"),Mn=()=>{const{data:t,isError:s,isLoading:r,isSuccess:l,error:o}=Nr({queryFn:()=>Vd()});return{userData:t||{is_sudo:!1,telegram_id:"",username:"",users_usage:0},getUserIsPending:r,getUserIsSuccess:l,getUserIsError:s,getUserError:o}},hn={baseStyle:{w:5,h:5}},$d=ee(cc,hn),Kd=ee(Oo,hn),Jd=ee(dc,hn),Mi=ee(uc,hn),qd=ee(hc,hn),Yd=ee(pc,hn),Gd=ee(wi,hn),Qd=ee(Wo,hn),Xd=ee(Fo,hn),Wa=ee("img",{baseStyle:{w:8,h:8}}),Fa=({collapsed:t,inDrawer:s=!1,onRequestExpand:r})=>{const{t:l}=$e(),o=ma(),{colorMode:i}=Jr(),{userData:a,getUserIsSuccess:c}=Mn(),u=c&&a.is_sudo,m=[...[{title:l("header.hostSettings"),url:"/hosts",icon:Jd},{title:l("header.nodeSettings"),url:"/node-settings",icon:qd},{title:l("header.integrationSettings","Master Settings"),url:"/integrations",icon:Mi},{title:l("header.xraySettings"),url:"/xray-settings",icon:Mi}]];u&&m.unshift({title:l("services.menu","Services"),url:"/services",icon:Qd});const g=m.some(x=>o.pathname===x.url),[I,D]=d.exports.useState(g);d.exports.useEffect(()=>{g&&D(!0)},[g]);const w=[{title:l("dashboard"),url:"/",icon:$d},{title:l("users"),url:"/users",icon:Kd}];return u&&(w.push({title:l("usage.menu","Usage"),url:"/usage",icon:Xd}),w.push({title:l("admins","Admins"),url:"/admins",icon:Yd}),w.push({title:l("header.settings"),icon:Mi,subItems:m})),e(N,{w:s?"full":t?"16":"60",h:s?"100%":"100vh",maxH:s?"100%":"100vh",bg:"surface.light",borderRight:s?void 0:"1px",borderColor:s?void 0:"light-border",_dark:{bg:"surface.dark",borderColor:s?void 0:"whiteAlpha.200"},transition:"width 0.3s",position:s?"relative":"fixed",top:s?void 0:"0",left:s?void 0:"0",overflowY:"auto",overflowX:"hidden",flexShrink:0,children:n(de,{spacing:2,p:t?2:4,align:"stretch",h:"100%",justify:"space-between",children:[n(N,{flex:"1",overflowY:"auto",children:[t?e(R,{justify:"center",mb:6,children:e(ct,{label:"Rebecca",placement:"right",hasArrow:!0,children:e(Wa,{src:Zi,alt:"Rebecca",filter:i==="dark"?"brightness(0) invert(1)":"none"})})}):n(R,{spacing:3,align:"center",mb:6,px:2,children:[e(Wa,{src:Zi,alt:"Rebecca",filter:i==="dark"?"brightness(0) invert(1)":"none"}),e(h,{fontSize:"lg",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},children:l("menu")})]}),w.map(x=>{const v=x.url,C=typeof v=="string"&&o.pathname===v||typeof v=="string"&&v!=="/"&&o.pathname.startsWith(v)||x.subItems&&x.subItems.some(ne=>o.pathname===ne.url),z=x.icon;return e(N,{children:x.subItems?n(Ot,{children:[e(ct,{label:t?x.title:"",placement:"right",hasArrow:!0,children:n(R,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:C?"primary.50":"transparent",color:C?"primary.600":"gray.700",_dark:{bg:C?"primary.900":"transparent",color:C?"primary.200":"gray.300"},_hover:{bg:C?"primary.50":"gray.50",_dark:{bg:C?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"space-between",onClick:()=>{t?(r&&r(),D(!0)):D(!I)},children:[n(R,{spacing:3,children:[e(z,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:C?"semibold":"normal",children:x.title})]}),!t&&e(Gd,{transform:I?"rotate(180deg)":"rotate(0deg)"})]})}),!t&&e(Xn,{in:I,animateOpacity:!0,children:e(de,{align:"stretch",pl:6,spacing:1,mt:2,children:x.subItems.map(ne=>{const b=o.pathname===ne.url,U=ne.icon;return e(Aa,{to:ne.url,children:n(R,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:b?"primary.50":"transparent",color:b?"primary.600":"gray.700",_dark:{bg:b?"primary.900":"transparent",color:b?"primary.200":"gray.300"},_hover:{bg:b?"primary.50":"gray.50",_dark:{bg:b?"primary.900":"gray.700"}},transition:"all 0.2s",children:[e(U,{w:t?5:void 0,h:t?5:void 0}),e(h,{fontSize:"sm",fontWeight:b?"semibold":"normal",children:ne.title})]})},ne.url)})})})]}):x.url?e(Aa,{to:x.url,children:e(ct,{label:t?x.title:"",placement:"right",hasArrow:!0,children:n(R,{spacing:3,px:3,py:2,borderRadius:"md",cursor:"pointer",bg:C?"primary.50":"transparent",color:C?"primary.600":"gray.700",_dark:{bg:C?"primary.900":"transparent",color:C?"primary.200":"gray.300"},_hover:{bg:C?"primary.50":"gray.50",_dark:{bg:C?"primary.900":"gray.700"}},transition:"all 0.2s",justifyContent:t?"center":"flex-start",children:[e(z,{w:t?5:void 0,h:t?5:void 0}),!t&&e(h,{fontSize:"sm",fontWeight:C?"semibold":"normal",children:x.title})]})})}):null},x.title)})]}),c&&a.username&&e(N,{px:t?2:3,py:2,borderTop:"1px",borderColor:"light-border",_dark:{borderColor:"whiteAlpha.200"},mt:4,children:t?e(ct,{label:a.username,placement:"right",hasArrow:!0,children:e(N,{w:"8",h:"8",borderRadius:"full",bg:"primary.100",_dark:{bg:"primary.800"},display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",flexShrink:0,children:e(h,{fontSize:"sm",fontWeight:"bold",color:"primary.600",_dark:{color:"primary.300"},textAlign:"center",children:a.username.charAt(0).toUpperCase()})})}):n(de,{align:"flex-start",spacing:0,children:[e(h,{fontSize:"xs",fontWeight:"semibold",color:"gray.500",_dark:{color:"gray.500"},children:"username:"}),e(h,{fontSize:"sm",fontWeight:"medium",color:"gray.700",_dark:{color:"gray.300"},noOfLines:1,children:a.username})]})})]})})},Zd=()=>{const[t,s]=d.exports.useState(null);return Jr(),d.exports.useEffect(()=>{fetch("https://api.github.com/repos/rebeccapanel/Rebecca").then(l=>l.json()).then(l=>{l.stargazers_count&&s(l.stargazers_count)}).catch(()=>{})},[]),e(N,{as:"button",onClick:()=>{window.open("https://github.com/rebeccapanel/Rebecca","_blank","noopener,noreferrer")},px:3,py:1.5,borderRadius:"md",borderWidth:"1px",borderColor:"gray.300",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},_hover:{bg:"gray.50",borderColor:"gray.400",transform:"translateY(-1px)",boxShadow:"sm",_dark:{bg:"gray.700",borderColor:"gray.500"}},transition:"all 0.2s",cursor:"pointer","aria-label":"GitHub Stars",children:n(R,{spacing:2,align:"center",children:[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"})}),n(R,{spacing:1,px:1.5,py:.5,borderRadius:"full",bg:"gray.100",_dark:{bg:"gray.700"},children:[e(mc,{style:{width:"14px",height:"14px",color:"#fbbf24"}}),t!==null?e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.700",_dark:{color:"gray.200"},lineHeight:"1",children:t>1e3?`${(t/1e3).toFixed(1)}k`:t}):e(h,{fontSize:"xs",fontWeight:"bold",color:"gray.500",_dark:{color:"gray.400"},lineHeight:"1",children:"..."})]})]})})},ci=gc,jd="https://cdn.jsdelivr.net/npm/emoji-datasource-apple@15.0.1/img/",ml={base:jd,folder:"apple/64",ext:".png",className:"apple-emoji"},Ui=t=>{var s,r;return typeof t=="string"&&((r=(s=ci.test)==null?void 0:s.call(ci,t))!=null?r:!1)},eu=t=>t.some(s=>{var r;return s.type==="characterData"?Ui((r=s.target)==null?void 0:r.data):s.type==="childList"?Array.from(s.addedNodes).some(l=>{if(l.nodeType===Node.TEXT_NODE)return Ui(l.textContent);if(l.nodeType===Node.ELEMENT_NODE){const o=l;return o.tagName==="IMG"&&o.classList.contains(ml.className)?!1:Ui(o.textContent)}return!1}):!1}),tu=()=>{const t=ma();d.exports.useEffect(()=>{const s=document.getElementById("root");if(!s)return;const r=()=>{ci.parse(s,ml)};r();const l=new MutationObserver(o=>{eu(o)&&requestAnimationFrame(r)});return l.observe(s,{childList:!0,subtree:!0,characterData:!0}),()=>l.disconnect()},[t])},gl={baseStyle:{w:4,h:4}},ru=ee(fc,gl),nu=ee(Ho,gl);function su(){const[t,s]=d.exports.useState(!1),r=xr({base:!0,md:!1}),l=Yt();return tu(),n(lt,{minH:"100vh",maxH:"100vh",overflow:"hidden",children:[r?null:e(Fa,{collapsed:t,onRequestExpand:()=>s(!1)}),n(lt,{flex:"1",direction:"column",minW:"0",overflow:"hidden",ml:r?"0":t?"16":"60",transition:"margin-left 0.3s",children:[n(N,{as:"header",h:"16",minH:"16",borderBottom:"1px",borderColor:"light-border",bg:"surface.light",_dark:{borderColor:"whiteAlpha.200",bg:"surface.dark"},display:"flex",alignItems:"center",px:"6",justifyContent:"space-between",flexShrink:0,children:[e(Ue,{size:"sm",variant:"ghost","aria-label":"toggle sidebar",onClick:()=>{r?l.onOpen():s(!t)},icon:e(nu,{})}),n(R,{spacing:2,children:[e(Zd,{}),e(dl,{}),e(pl,{}),e(bc,{to:"/login",children:e(Ue,{size:"sm",variant:"outline","aria-label":"logout",icon:e(ru,{})})})]})]}),e(N,{as:"main",flex:"1",p:"6",overflow:"auto",minH:"0",children:e(yc,{})})]}),r&&n(Bo,{isOpen:l.isOpen,placement:"left",onClose:l.onClose,size:"xs",children:[e(wt,{}),e(Vo,{bg:"surface.light",_dark:{bg:"surface.dark"},children:e(kt,{p:0,children:e(Fa,{collapsed:!1,inDrawer:!0})})})]})]})}const fl="rebecca-num-users-per-page",Ha=10,iu=()=>{const t=localStorage.getItem(fl)||Ha.toString();return parseInt(t)||Ha},au=t=>localStorage.setItem(fl,t),bl="-created_at",ou=60*60*1e3,lu=t=>{const s={sort:t.sort||bl};return Object.keys(t).forEach(r=>{if(r==="sort")return;const l=t[r];l==null||l===""||(s[r]=l)}),s},cu=t=>JSON.stringify(Object.keys(t).sort().map(s=>[s,t[s]])),du=(t,s={})=>{const r=lu(t),l=cu(r),{lastUsersFetchAt:o,usersCacheKey:i,users:a}=xt.getState(),c=Date.now();return!s.force&&o&&i===l&&c-o<ou?Promise.resolve(a):(xt.setState({loading:!0}),_e("/users",{query:r}).then(u=>{var I,D;const p=(I=u.users_limit)!=null?I:null,m=(D=u.active_total)!=null?D:null,g=p!=null&&p>0&&m!==null?m>=p:!1;return xt.setState({users:u,isUserLimitReached:g,lastUsersFetchAt:Date.now(),usersCacheKey:l}),u}).finally(()=>{xt.setState({loading:!1})}))},Ls=()=>_e("/inbounds").then(t=>{xt.setState({inbounds:new Map(Object.entries(t))})}).finally(()=>{xt.setState({loading:!1})}),xt=ns(Sc((t,s)=>({version:null,editingUser:null,deletingUser:null,isCreatingNewUser:!1,QRcodeLinks:null,subscribeUrl:null,users:{users:[],total:0,active_total:0,users_limit:null},loading:!0,isUserLimitReached:!1,isResetingAllUsage:!1,lastUsersFetchAt:null,usersCacheKey:null,isEditingNodes:!1,resetUsageUser:null,revokeSubscriptionUser:null,filters:{username:"",limit:iu(),sort:bl},inbounds:new Map,isEditingCore:!1,refetchUsers:(r=!1)=>{du(s().filters,{force:r})},resetAllUsage:()=>_e("/users/reset",{method:"POST"}).then(()=>{s().onResetAllUsage(!1),s().refetchUsers(!0)}),onResetAllUsage:r=>t({isResetingAllUsage:r}),onCreateUser:r=>t({isCreatingNewUser:r}),onEditingUser:r=>{t({editingUser:r})},onDeletingUser:r=>{t({deletingUser:r})},onFilterChange:r=>{t({filters:{...s().filters,...r}}),s().refetchUsers()},setQRCode:r=>{t({QRcodeLinks:r})},deleteUser:r=>(t({editingUser:null}),_e(`/user/${r.username}`,{method:"DELETE"}).then(()=>{t({deletingUser:null}),s().refetchUsers(!0),oi.invalidateQueries(di)})),createUser:r=>_e("/user",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),oi.invalidateQueries(di)}),createUserWithService:r=>_e("/v2/users",{method:"POST",body:r}).then(()=>{t({editingUser:null}),s().refetchUsers(!0),oi.invalidateQueries(di)}),editUser:(r,l)=>_e(`/v2/users/${r}`,{method:"PUT",body:l}).then(()=>{s().onEditingUser(null),s().refetchUsers(!0)}),fetchUserUsage:(r,l)=>{for(const o in l)l[o]||delete l[o];return _e(`/user/${r.username}/usage`,{method:"GET",query:l})},onEditingNodes:r=>{t({isEditingNodes:r})},setSubLink:r=>{t({subscribeUrl:r})},resetDataUsage:r=>_e(`/user/${r.username}/reset`,{method:"POST"}).then(()=>{t({resetUsageUser:null}),s().refetchUsers(!0)}),revokeSubscription:r=>_e(`/user/${r.username}/revoke_sub`,{method:"POST"}).then(l=>{t({revokeSubscriptionUser:null,editingUser:l}),s().refetchUsers(!0)}),onEditingCore:r=>t({isEditingCore:r})})));function Xe(t,s=2,r=!1){if(!+t){const u=[0,"B"];return r?u:`${u[0]} ${u[1]}`}const l=1024,o=s<0?0:s,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(l)),c=parseFloat((t/Math.pow(l,a)).toFixed(o));return r?[c,i[a]]:`${c} ${i[a]}`}const Ba=t=>{if(t!==null)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},uu=ee(Oo,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),hu=ee(xc,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),Va=({title:t,content:s,icon:r})=>n(tn,{p:6,borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[n(R,{alignItems:"center",columnGap:"4",children:[e(N,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:r}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(N,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:s})]}),di="statistics-query-key",pu=t=>{var i;const{version:s}=xt(),{userData:r}=Mn(),{data:l}=Nr({queryKey:di,queryFn:()=>_e("/system"),refetchInterval:6e5,onSuccess:({version:a})=>{s!==a&&xt.setState({version:a})}}),{t:o}=$e();return n(R,{justifyContent:"space-between",gap:0,columnGap:{lg:4,md:0},rowGap:{lg:0,base:4},display:"flex",flexDirection:{lg:"row",base:"column"},...t,children:[e(Va,{title:o("activeUsers"),content:l&&n(R,{alignItems:"flex-end",children:[e(h,{children:Ba(l.users_active)}),n(h,{fontWeight:"normal",fontSize:"lg",as:"span",display:"inline-block",pb:"5px",children:["/ ",Ba(l.total_user)]})]}),icon:e(uu,{})}),e(Va,{title:o("UsersUsage"),content:Xe((i=r.users_usage)!=null?i:0),icon:e(hu,{})})]})},mu=()=>{const{t}=$e();return e(de,{spacing:6,align:"stretch",children:n(N,{children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",mb:4,children:t("dashboard")}),e(pu,{})]})})},En=({children:t,color:s})=>e(N,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${s}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${s}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${s}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${s}.400`}},children:e(h,{color:`${s}.500`,_dark:{color:`${s}.900`},position:"relative",zIndex:"2",children:t})}),Vs=ee(nn,{baseStyle:{w:5,h:5}}),gu=()=>{const[t,s]=d.exports.useState(!1),{deletingUser:r,onDeletingUser:l,deleteUser:o}=xt(),{t:i}=$e(),a=Bt(),c=()=>{l(null)},u=()=>{r&&(s(!0),o(r).then(()=>{a({title:i("deleteUser.deleteSuccess",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).then(c).finally(s.bind(null,!1)))};return n(Ut,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"red",children:e(Vs,{})})}),e(Rt,{mt:3}),n(kt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:i("deleteUser.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:i("deleteUser.prompt",{username:r.username})})})]}),n(zt,{display:"flex",children:[e(F,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:i("cancel")}),e(F,{size:"sm",w:"full",colorScheme:"red",onClick:u,leftIcon:t?e(Dt,{size:"xs"}):void 0,children:i("delete")})]})]})]})},fu={search:"",limit:10,offset:0,sort:"username"},pn=ns((t,s)=>({admins:[],total:0,loading:!1,filters:fu,isAdminDialogOpen:!1,adminInDialog:null,isAdminDetailsOpen:!1,adminInDetails:null,async fetchAdmins(r){const{filters:l}=s(),o={...l,...r},i={};o.search&&(i.username=o.search),o.offset!==void 0&&(i.offset=o.offset),o.limit!==void 0&&(i.limit=o.limit),o.sort&&(o.sort==="data_usage"?i.sort="users_usage":o.sort==="data_limit"?i.sort="data_limit":i.sort=o.sort),t({loading:!0});try{const a=await _e("/admins",{query:i}),{admins:c,total:u}=Array.isArray(a)?{admins:a,total:a.length}:{admins:a.admins||[],total:a.total||0};t(p=>{const m=p.adminInDetails?c.find(g=>{var I;return g.username===((I=p.adminInDetails)==null?void 0:I.username)})||p.adminInDetails:null;return{admins:c,total:u,adminInDetails:m}})}catch(a){console.error("Failed to fetch admins:",a),t({admins:[],total:0,adminInDetails:null})}finally{t({loading:!1})}},setFilters(r){t(l=>({filters:{...l.filters,...r}}))},onFilterChange(r){t(l=>({filters:{...l.filters,...r}})),s().fetchAdmins()},async createAdmin(r){await _e("/admin",{method:"POST",body:r}),await s().fetchAdmins()},async updateAdmin(r,l){await _e(`/admin/${encodeURIComponent(r)}`,{method:"PUT",body:l}),await s().fetchAdmins()},async deleteAdmin(r){await _e(`/admin/${encodeURIComponent(r)}`,{method:"DELETE"}),await s().fetchAdmins()},async resetUsage(r){await _e(`/admin/usage/reset/${encodeURIComponent(r)}`,{method:"POST"}),await s().fetchAdmins()},async disableUsers(r){await _e(`/admin/${encodeURIComponent(r)}/users/disable`,{method:"POST"})},async activateUsers(r){await _e(`/admin/${encodeURIComponent(r)}/users/activate`,{method:"POST"})},openAdminDialog(r){t({isAdminDialogOpen:!0,adminInDialog:r||null})},closeAdminDialog(){t({isAdminDialogOpen:!1,adminInDialog:null})},openAdminDetails(r){t({isAdminDetailsOpen:!0,adminInDetails:r})},closeAdminDetails(){t({isAdminDetailsOpen:!1,adminInDetails:null})}})),vi={baseStyle:{w:4,h:4}},bu=ee($o,vi),yu=ee(ca,vi),Su=ee(Kr,vi),xu=ee(un,vi),wu=wc((t,s)=>{s==="users"?xt.getState().onFilterChange({...xt.getState().filters,offset:0,search:t}):pn.getState().onFilterChange({search:t,offset:0})},300),yl=({for:t="users",...s})=>{var T;const{loading:r,filters:l,onFilterChange:o,refetchUsers:i,onCreateUser:a}=xt(),{loading:c,filters:u,onFilterChange:p,fetchAdmins:m,openAdminDialog:g}=pn(),{t:I}=$e(),[D,w]=d.exports.useState(""),x=t==="users"?r:c,v=t==="users"?l:u,C=O=>{w(O.target.value),wu(O.target.value,t)},z=()=>{w(""),t==="users"?o({...v,offset:0,search:""}):p({search:"",offset:0})},ne=()=>{t==="users"?i(!0):m()},b=()=>{t==="users"?a(!0):g()},U=(T=xr({base:!0,sm:!1}))!=null?T:!1;return n(Rs,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},mx:"0",rowGap:4,gap:{lg:4,base:0},py:4,...s,children:[e(rn,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:n(R,{spacing:2,align:"center",w:"full",children:[n(wr,{flex:"1",children:[e(Ko,{pointerEvents:"none",children:e(bu,{})}),e(we,{placeholder:t==="users"?I("search"):I("admins.searchPlaceholder","Search admins..."),value:D,borderColor:"light-border",w:"full",onChange:C}),n(Er,{children:[x&&e(Dt,{size:"xs"}),v.search&&v.search.length>0&&e(Ue,{onClick:z,"aria-label":"clear",size:"xs",variant:"ghost",children:e(yu,{})})]})]}),e(Ue,{"aria-label":"refresh",disabled:x,onClick:ne,size:U?"sm":"md",variant:U?"ghost":"outline",borderRadius:"full",minW:U?"36px":"40px",h:U?"36px":void 0,children:e(Su,{className:da({"animate-spin":x})})})]})}),e(rn,{colSpan:{base:1,md:2,lg:2},order:{base:1,md:2},children:e(ke,{direction:{base:"row",sm:"row"},spacing:{base:2,sm:3},justifyContent:{base:"flex-start",md:"flex-end"},alignItems:"center",w:"full",flexWrap:"wrap",children:e(F,{colorScheme:"primary",size:U?"sm":"md",onClick:b,px:U?3:5,leftIcon:U?void 0:e(xu,{}),w:"auto",h:U?"36px":void 0,minW:U?"auto":"8.5rem",fontSize:U?"sm":"md",fontWeight:"semibold",whiteSpace:"nowrap",children:t==="users"?I("createUser"):I("admins.addAdmin","Add admin")})})})]})},ku=ee(kc,{baseStyle:{w:4,h:4}}),vu=ee(vc,{baseStyle:{w:4,h:4}}),$a=5;function Cu(t,s,r){if(r<$a)throw new Error(`Must allow at least ${$a} page items`);if(r%2===0)throw new Error("Must allow odd number of page items");if(t<r)return[...new Array(t).keys()];const l=Math.max(0,Math.min(t-r,s-Math.floor(r/2))),o=new Array(r);for(let i=0;i<r;i+=1)o[i]=i+l;return typeof o[0]=="number"&&o[0]>0&&(o[0]=0,o[1]="prev-more"),o[o.length-1]<t-1&&(o[o.length-1]=t-1,o[o.length-2]="next-more"),o}const Sl=({for:t="users"})=>{const{filters:s,onFilterChange:r,users:{total:l}}=xt(),{filters:o,onFilterChange:i,total:a}=pn(),{t:c}=$e(),{filters:u,total:p,onFilterChange:m}=d.exports.useMemo(()=>t==="admins"?{filters:o,total:a,onFilterChange:i}:{filters:s,total:l,onFilterChange:r},[t,o,a,i,s,l,r]),{limit:g,offset:I}=u,D=Number(g||10),w=Number(I||0),x=Math.floor(w/D),v=Math.ceil(p/D),C=Cu(v,x,7),z=T=>{m({...u,offset:T*D})},ne=T=>{const O=parseInt(T.target.value,10);m({...u,limit:O,offset:0}),t==="users"&&au(T.target.value)},b=d.exports.useMemo(()=>x>0&&v>0,[x,v]),U=d.exports.useMemo(()=>x+1<v&&v>0,[x,v]);return p<=D&&x===0?null:n(R,{justifyContent:"space-between",mt:4,w:"full",display:"flex",columnGap:{lg:4,md:0},rowGap:{md:0,base:4},flexDirection:{md:"row",base:"column"},children:[e(N,{order:{base:2,md:1},children:n(R,{children:[n(je,{minW:"60px",value:String(D),onChange:ne,size:"sm",rounded:"md",children:[e("option",{value:"10",children:"10"}),e("option",{value:"20",children:"20"}),e("option",{value:"30",children:"30"})]}),e(h,{whiteSpace:"nowrap",fontSize:"sm",children:c("itemsPerPage")})]})}),n(Jo,{size:"sm",isAttached:!0,variant:"outline",order:{base:1,md:2},children:[e(F,{leftIcon:e(ku,{}),onClick:()=>z(x-1),isDisabled:!b,children:c("previous")}),C.map(T=>typeof T=="string"?e(F,{children:"..."},T):e(F,{variant:T===x?"solid":"outline",onClick:()=>z(T),children:T+1},T)),e(F,{rightIcon:e(vu,{}),onClick:()=>z(x+1),isDisabled:!U,children:c("next")})]})]})},_u=Cc;const Ka=ee(_c),Du=ee(ga,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Au=ee(qo,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Iu=ee(Yo,{baseStyle:{w:5,h:5}}),Tu=()=>{const{QRcodeLinks:t,setQRCode:s,setSubLink:r,subscribeUrl:l}=xt(),o=t!==null,[i,a]=d.exports.useState(0),{t:c}=$e(),u=()=>{s(null),r(null)},p=String(l).startsWith("/")?window.location.origin+l:String(l);return n(Ut,{isOpen:o,onClose:u,children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(At,{pt:6,children:e(En,{color:"primary",children:e(Iu,{color:"white"})})}),e(Rt,{mt:3}),t&&n(kt,{gap:{base:"20px",lg:"50px"},pr:{lg:"60px"},px:{base:"50px"},display:"flex",justifyContent:"center",flexDirection:{base:"column",lg:"row"},children:[l&&n(de,{children:[e(Ka,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p,bg:"white"}),e(h,{display:"block",textAlign:"center",pb:3,mt:1,children:c("qrcodeDialog.sublink")})]}),n(N,{w:"300px",children:[e(_u,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:a,onInit:()=>a(0),nextArrow:e(Ue,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",mr:"-4",children:e(Du,{})}),prevArrow:e(Ue,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",ml:"-4",children:e(Au,{})}),children:t.map((m,g)=>e(R,{children:e(Ka,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:m,bg:"white"})},g))}),n(h,{display:"block",textAlign:"center",pb:3,mt:1,children:[i+1," / ",t.length]})]})]})]})]})},Pu=ee(Kr,{baseStyle:{w:5,h:5}}),Eu=()=>{const[t,s]=d.exports.useState(!1),{resetUsageUser:r,resetDataUsage:l}=xt(),{t:o}=$e(),i=Bt(),a=()=>{xt.setState({resetUsageUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{i({title:o("resetUserUsage.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("resetUserUsage.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Ut,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"blue",children:e(Pu,{})})}),e(Rt,{mt:3}),n(kt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("resetUserUsage.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:o("resetUserUsage.prompt",{username:r.username})})})]}),n(zt,{display:"flex",children:[e(F,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(F,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Dt,{size:"xs"}):void 0,children:o("reset")})]})]})]})},Nu=ee(Kr,{baseStyle:{w:5,h:5}}),zu=()=>{const[t,s]=d.exports.useState(!1),{revokeSubscriptionUser:r,revokeSubscription:l}=xt(),{t:o}=$e(),i=Bt(),a=()=>{xt.setState({revokeSubscriptionUser:null})},c=()=>{r&&(s(!0),l(r).then(()=>{i({title:o("revokeUserSub.success",{username:r.username}),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(()=>{i({title:o("revokeUserSub.error"),status:"error",isClosable:!0,position:"top",duration:3e3})}).finally(()=>{s(!1)}))};return n(Ut,{isCentered:!0,isOpen:!!r,onClose:a,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"blue",children:e(Nu,{})})}),e(Rt,{mt:3}),n(kt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("revokeUserSub.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:o("revokeUserSub.prompt",{username:r.username})})})]}),n(zt,{display:"flex",children:[e(F,{size:"sm",onClick:a,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(F,{size:"sm",w:"full",colorScheme:"blue",onClick:c,leftIcon:t?e(Dt,{size:"xs"}):void 0,children:o("revoke")})]})]})]})},$s={baseStyle:{strokeWidth:"2px",w:4,h:4}},Ja=ee(Dc,$s),Ru=ee(Ac,$s),qa=ee(Ic,$s),Ya=ee(Go,$s),Mu=ee(Go,$s),ea=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],An={active:{statusColor:"green",bandWidthColor:"primary",icon:Ja},connected:{statusColor:"green",bandWidthColor:"primary",icon:Ja},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:Ru},expired:{statusColor:"orange",bandWidthColor:"orange",icon:Ya},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:Mu},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:Ya},limited:{statusColor:"red",bandWidthColor:"red",icon:qa},error:{statusColor:"red",bandWidthColor:"red",icon:qa}},Gn=ns((t,s)=>({services:[],total:0,isLoading:!1,isSaving:!1,serviceDetail:null,async fetchServices(r){t({isLoading:!0});try{const l=await _e("/v2/services",{query:r});t({services:l.services,total:l.total})}finally{t({isLoading:!1})}},async fetchServiceDetail(r){t({isLoading:!0});try{const l=await _e(`/v2/services/${r}`);return t({serviceDetail:l}),l}finally{t({isLoading:!1})}},async createService(r){t({isSaving:!0});try{const l=await _e("/v2/services",{method:"POST",body:r});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},async updateService(r,l){t({isSaving:!0});try{const o=await _e(`/v2/services/${r}`,{method:"PUT",body:l});return t({serviceDetail:o}),await s().fetchServices(),o}finally{t({isSaving:!1})}},async deleteService(r,l){t({isSaving:!0});try{await _e(`/v2/services/${r}`,{method:"DELETE",body:l}),t({serviceDetail:null}),await s().fetchServices()}finally{t({isSaving:!1})}},async resetServiceUsage(r){t({isSaving:!0});try{const l=await _e(`/v2/services/${r}/reset-usage`,{method:"POST"});return t({serviceDetail:l}),await s().fetchServices(),l}finally{t({isSaving:!1})}},setServiceDetail(r){t({serviceDetail:r})}})),Uu=async()=>_e("/settings/telegram"),Lu=async t=>_e("/settings/telegram",{method:"PUT",body:JSON.stringify(t)}),ya=async()=>_e("/settings/panel"),Ou=async t=>_e("/settings/panel",{method:"PUT",body:JSON.stringify(t)}),Ci=t=>{let s={status:"",time:""};if(t){Pe(t*1e3).utc().isAfter(Pe().utc())?s.status="expires":s.status="expired";const r=[],l=Pe.duration(Pe(t*1e3).utc().diff(Pe()));l.years()!=0&&r.push(Math.abs(l.years())+" year"+(Math.abs(l.years())!=1?"s":"")),l.months()!=0&&r.push(Math.abs(l.months())+" month"+(Math.abs(l.months())!=1?"s":"")),l.days()!=0&&r.push(Math.abs(l.days())+" day"+(Math.abs(l.days())!=1?"s":"")),r.length===0&&(l.hours()!=0&&r.push(Math.abs(l.hours())+" hour"+(Math.abs(l.hours())!=1?"s":"")),l.minutes()!=0&&r.push(Math.abs(l.minutes())+" min"+(Math.abs(l.minutes())!=1?"s":""))),s.time=r.join(", ")}return s},Wu=({value:t,onChange:s,placeholder:r="Select date",disabled:l=!1,minDate:o,quickSelects:i=[]})=>{const{isOpen:a,onOpen:c,onClose:u}=Yt(),[p,m]=d.exports.useState(()=>t?Pe(t):Pe()),[g,I]=d.exports.useState({hour:t?Pe(t).hour():12,minute:t?Pe(t).minute():0});d.exports.useEffect(()=>{t&&(m(Pe(t)),I({hour:Pe(t).hour(),minute:Pe(t).minute()}))},[t]);const D=()=>{t||(m(Pe()),I({hour:12,minute:0})),u()},w=p.daysInMonth(),x=p.startOf("month").day(),v=Pe(),C=t?Pe(t):null,z=J=>{const E=p.date(J).hour(g.hour).minute(g.minute).second(0).millisecond(0);o&&E.isBefore(Pe(o),"day")||s(E.toDate())},ne=(J,E)=>{if(I({hour:J,minute:E}),t){const q=Pe(t).hour(J).minute(E);s(q.toDate())}},b=()=>{s(null),m(Pe()),I({hour:12,minute:0}),u()},U=()=>m(p.subtract(1,"month")),T=()=>m(p.add(1,"month")),O=J=>{const q=(t?Pe(t):Pe()).add(J,"day");s(q.toDate())},ve=()=>{const J=[],E=o?Pe(o):null;for(let q=0;q<x;q++)J.push(e(rn,{},`empty-${q}`));for(let q=1;q<=w;q++){const ue=p.date(q),Y=ue.isSame(v,"day"),re=C==null?void 0:C.isSame(ue,"day"),A=E&&ue.isBefore(E,"day");J.push(e(rn,{children:e(F,{size:"xs",variant:"ghost",w:"full",h:"28px",minW:"28px",fontSize:"xs",fontWeight:Y?"bold":"normal",bg:re?"primary.500":"transparent",color:re?"white":A?"gray.500":"inherit",border:Y?"1px solid":"none",borderColor:"primary.400",_hover:{bg:A?"transparent":re?"primary.600":"gray.700"},onClick:()=>!A&&z(q),isDisabled:!!A,cursor:A?"not-allowed":"pointer",children:q})},q))}return J},Z=t?Pe(t).format("YYYY/MM/DD HH:mm"):"";return n(ss,{isOpen:a,onOpen:c,onClose:D,placement:"bottom-start",isLazy:!0,children:[e(is,{children:e(we,{value:Z,placeholder:r,size:"sm",isReadOnly:!0,cursor:"pointer",isDisabled:l,onClick:c,bg:"transparent",_dark:{bg:"transparent"}})}),e(Qo,{children:e(as,{w:"auto",maxW:"min(90vw, 420px)",bg:"gray.900",borderColor:"gray.700",color:"white",_focus:{boxShadow:"none"},children:e(os,{p:0,children:n(lt,{children:[n(de,{spacing:1,align:"stretch",px:2,py:2,bg:"gray.800",minW:"100px",maxW:"110px",borderRight:"1px solid",borderColor:"gray.700",flexShrink:0,children:[e(F,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>O(1),_hover:{bg:"gray.700"},children:"+1 Day"}),e(F,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>O(30),_hover:{bg:"gray.700"},children:"+1 Month"}),e(F,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>O(90),_hover:{bg:"gray.700"},children:"+3 Months"}),e(F,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>O(180),_hover:{bg:"gray.700"},children:"+6 Months"}),e(F,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>O(365),_hover:{bg:"gray.700"},children:"+1 Year"}),e(F,{variant:"ghost",justifyContent:"flex-start",size:"sm",fontSize:"xs",whiteSpace:"nowrap",onClick:()=>O(1095),_hover:{bg:"gray.700"},children:"+3 Years"})]}),n(N,{flex:"1",p:2,children:[n(lt,{justify:"space-between",align:"center",mb:2,children:[n(R,{spacing:1,children:[e(Ue,{"aria-label":"Previous month",size:"xs",variant:"ghost",icon:e(qo,{width:14,height:14}),onClick:U,_hover:{bg:"gray.700"}}),e(Ue,{"aria-label":"Next month",size:"xs",variant:"ghost",icon:e(ga,{width:14,height:14}),onClick:T,_hover:{bg:"gray.700"}})]}),e(h,{fontSize:"xs",fontWeight:"semibold",children:p.format("MMMM YYYY")})]}),e(Rs,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:1,children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(J=>e(rn,{children:e(h,{fontSize:"2xs",textAlign:"center",color:"gray.400",fontWeight:"semibold",children:J})},J))}),e(Rs,{templateColumns:"repeat(7, 1fr)",gap:.5,mb:2,children:ve()}),n(R,{spacing:2,justify:"center",pt:2,borderTop:"1px solid",borderColor:"gray.700",children:[e(h,{fontSize:"2xs",color:"gray.400",children:"Time:"}),e(we,{type:"number",size:"xs",w:"45px",min:0,max:23,value:g.hour,onChange:J=>{const E=Math.max(0,Math.min(23,parseInt(J.target.value)||0));ne(E,g.minute)},textAlign:"center",fontSize:"xs"}),e(h,{fontSize:"xs",children:":"}),e(we,{type:"number",size:"xs",w:"45px",min:0,max:59,value:g.minute,onChange:J=>{const E=Math.max(0,Math.min(59,parseInt(J.target.value)||0));ne(g.hour,E)},textAlign:"center",fontSize:"xs"})]}),n(R,{spacing:2,justify:"flex-end",mt:2,children:[e(F,{size:"xs",variant:"ghost",onClick:b,children:"Clear"}),e(F,{size:"xs",colorScheme:"primary",onClick:D,children:"Done"})]})]})]})})})})]})},Ks=d.exports.forwardRef((t,s)=>e(Tc,{...t,ref:s}));Ks.displayName="DatePicker";function Fu(t){const s=360/t,r=90,l=47,o=[];for(let i=0;i<t;i++){const a=i*s%360+140,c=Hu(a,r,l);o.push(c)}return o}function Hu(t,s,r){t/=360,s/=100,r/=100;let l,o,i;if(s===0)l=o=i=r;else{const c=(m,g,I)=>(I<0&&(I+=1),I>1&&(I-=1),I<.16666666666666666?m+(g-m)*6*I:I<.5?g:I<.6666666666666666?m+(g-m)*(.6666666666666666-I)*6:m),u=r<.5?r*(1+s):r+s-r*s,p=2*r-u;l=Math.round(c(p,u,t+1/3)*255),o=Math.round(c(p,u,t)*255),i=Math.round(c(p,u,t-1/3)*255)}const a=c=>{const u=c.toString(16);return u.length===1?"0"+u:u};return`#${a(l)}${a(o)}${a(i)}`}const Ga=({border:t,...s})=>{const{getInputProps:r,getRadioProps:l}=Nc(s),o=xr({base:"xs",md:"sm"});return n(N,{as:"label",children:[e("input",{...r()}),e(N,{...l(),minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:o,borderWidth:t?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,children:s.children})]})},Bu=({onChange:t,defaultValue:s,...r})=>{const{t:l,i18n:o}=$e();Jr();const i=xr({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),a={h:"hour",d:"day",w:"week",m:"month",y:"year"},c=xr({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),{getRootProps:u,getRadioProps:p,setValue:m}=Pc({name:"filter",defaultValue:s,onChange:q=>{if(q==="custom")return;D(),i.indexOf(q)>=0?(v(l("userDialog.custom")),z(!1)):(v(l("userDialog.custom")+` (${q})`),z(!0));const ue=Number(q.substring(0,q.length-1)),Y=a[q[q.length-1]];t(q,{start:Pe().utc().subtract(ue,Y).format("YYYY-MM-DDTHH:00:00")})}}),{isOpen:g,onOpen:I,onClose:D}=Yt(),w=d.exports.useRef(null);Ec({ref:w,handler:D});const[x,v]=d.exports.useState(l("userDialog.custom")),[C,z]=d.exports.useState(!1),[ne,b]=d.exports.useState(0),U=xr({base:1,md:2}),T=xr({base:"xs",md:"sm"}),[O,ve]=d.exports.useState(null),[Z,J]=d.exports.useState(null),E=q=>{const[ue,Y]=q;Z&&!Y?(ve(null),J(null)):(ve(ue),J(Y),ue&&Y&&(D(),t("custom",{start:Pe(ue).format("YYYY-MM-DDT00:00:00"),end:Pe(Y).format("YYYY-MM-DDT23:59:59")})))};return n(de,{...r,children:[ne==0&&n(Ve,{...u(),gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[i.map(q=>e(Ga,{...p({value:q}),children:q},q)),e(N,{onClick:()=>{ve(null),J(null),I()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:T,px:3,py:1,bg:C?"primary.500":"unset",color:C?"white":"unset",borderColor:C?"primary.500":"unset",children:n(R,{children:[e(h,{children:x}),e(Es,{as:Ia,boxSize:"18px"})]})})]}),ne==1&&n(R,{onClick:I,cursor:"pointer",fontSize:T,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e(h,{w:"full",color:O?"unset":"gray.500",children:O?Pe(O).format("YYYY-MM-DD (00:00)"):l("userDialog.startDate")}),e(Es,{as:ga,boxSize:"18px"}),e(h,{w:"full",color:Z?"unset":"gray.500",children:Z?Pe(Z).format("YYYY-MM-DD (23:59)"):l("userDialog.endDate")}),e(Es,{as:Ia,boxSize:"18px"})]}),e(de,{ref:w,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:n(ls,{onChange:q=>b(q),children:[n(cs,{children:[e($t,{fontSize:T,children:l("userDialog.relative")}),e($t,{fontSize:T,children:l("userDialog.absolute")})]}),n(ds,{children:[e(Kt,{children:c.map(q=>e(de,{alignItems:"start",pl:2,pr:2,children:n(R,{justifyItems:"flex-start",mb:4,children:[e(h,{fontSize:T,minW:"60px",children:l("userDialog."+q.title)}),q.options.map(ue=>e(Ga,{border:!0,...p({value:ue}),children:ue},ue+".custom"))]})},q.title))}),e(Kt,{className:"datepicker-panel",children:e(de,{children:e(Ks,{locale:o.language.toLocaleLowerCase(),selected:O,onChange:E,startDate:O,endDate:Z,selectsRange:!0,maxDate:new Date,monthsShown:U,peekNextMonth:!1,inline:!0})})})]})]})})]})};function bi(t,s,r=[],l=[]){const o=Xe(r.reduce((i,a)=>i+=a,0));return{series:r,options:{labels:l,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${o}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:t==="dark"?"var(--chakra-colors-gray-300)":void 0}},legend:{position:"bottom",labels:{colors:t==="dark"?"#CBD5E0":void 0,useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(i,{seriesIndex:a,w:c})=>Xe(c.config.series[a],1)},tooltip:{custom:({series:i,seriesIndex:a,dataPointIndex:c,w:u})=>{const p=Xe(i[a],1),m=Math.max(i.reduce((I,D)=>I+=D),1),g=Math.round(i[a]/m*1e3)/10+"%";return`
            <div style="
                    background-color: ${u.globals.colors[a]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${u.config.labels[a]}: <b>${g}, ${p}</b>
            </div>
          `}},colors:Fu(r.length)}}}const Vu=ee(zc,{baseStyle:{w:5,h:5}}),$u=ee(Sn,{baseStyle:{w:5,h:5}}),Ku=ee(Fo,{baseStyle:{w:5,h:5}}),Ju=ee(Rc,{baseStyle:{w:{base:16,md:20},h:{base:16,md:20}}});ee(Si,{baseStyle:{w:4,h:4}});const qu=t=>{var r,l,o,i,a;const s=(r=t.next_plan)!=null?r:null;return{...t,data_limit:t.data_limit?Number((t.data_limit/1073741824).toFixed(5)):t.data_limit,ip_limit:t.ip_limit&&t.ip_limit>0?t.ip_limit:null,on_hold_expire_duration:t.on_hold_expire_duration?Number(t.on_hold_expire_duration/(24*60*60)):t.on_hold_expire_duration,service_id:(l=t.service_id)!=null?l:null,next_plan_enabled:Boolean(s),next_plan_data_limit:s!=null&&s.data_limit?Number((s.data_limit/1073741824).toFixed(5)):null,next_plan_expire:(o=s==null?void 0:s.expire)!=null?o:null,next_plan_add_remaining_traffic:(i=s==null?void 0:s.add_remaining_traffic)!=null?i:!1,next_plan_fire_on_either:(a=s==null?void 0:s.fire_on_either)!=null?a:!0}},Li=()=>({data_limit:null,ip_limit:null,expire:null,username:"",data_limit_reset_strategy:"no_reset",status:"active",on_hold_expire_duration:null,note:"",inbounds:{},proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}},service_id:null,next_plan_enabled:!1,next_plan_data_limit:null,next_plan_expire:null,next_plan_add_remaining_traffic:!1,next_plan_fire_on_either:!0}),bs={username:Ae.string().min(1,{message:"Required"}),note:Ae.string().nullable(),service_id:Ae.union([Ae.string(),Ae.number()]).nullable().transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),proxies:Ae.record(Ae.string(),Ae.record(Ae.string(),Ae.any())).transform(t=>{const s=(r,l)=>{r&&r[l]===""&&delete r[l]};return s(t.vmess,"id"),s(t.vless,"id"),s(t.trojan,"password"),s(t.shadowsocks,"password"),s(t.shadowsocks,"method"),t}),data_limit:Ae.string().min(0).or(Ae.number()).nullable().transform(t=>t?Number((parseFloat(String(t))*1073741824).toFixed(5)):0),expire:Ae.number().nullable(),data_limit_reset_strategy:Ae.string(),inbounds:Ae.record(Ae.string(),Ae.array(Ae.string())).transform(t=>(Object.keys(t).forEach(s=>{var r;Array.isArray(t[s])&&!((r=t[s])!=null&&r.length)&&delete t[s]}),t)),next_plan_enabled:Ae.boolean().default(!1),next_plan_data_limit:Ae.union([Ae.string(),Ae.number(),Ae.null()]).transform(t=>{if(t===null||t===""||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:Math.max(0,s)}),next_plan_expire:Ae.union([Ae.number(),Ae.string(),Ae.null()]).transform(t=>{if(t===""||t===null||typeof t>"u")return null;const s=Number(t);return Number.isNaN(s)?null:s}),next_plan_add_remaining_traffic:Ae.boolean().default(!1),next_plan_fire_on_either:Ae.boolean().default(!0),ip_limit:Ae.union([Ae.number().min(0),Ae.null()]).optional().transform(t=>typeof t!="number"?null:Number.isFinite(t)?t:null)},Yu=Ae.discriminatedUnion("status",[Ae.object({status:Ae.literal("active"),...bs}),Ae.object({status:Ae.literal("disabled"),...bs}),Ae.object({status:Ae.literal("limited"),...bs}),Ae.object({status:Ae.literal("expired"),...bs}),Ae.object({status:Ae.literal("on_hold"),on_hold_expire_duration:Ae.coerce.number().min(.1,"Required").transform(t=>t*(24*60*60)),...bs})]),Gu=()=>{var er,ir,ar,tr,or,G,be,X,rt;const{editingUser:t,isCreatingNewUser:s,onCreateUser:r,editUser:l,fetchUserUsage:o,onEditingUser:i,createUserWithService:a,onDeletingUser:c,users:u,isUserLimitReached:p}=xt(),m=!!t,g=s||m,I=(er=u.users_limit)!=null?er:null,D=(ir=u.active_total)!=null?ir:null,w=p&&!m,[x,v]=d.exports.useState(!1),[C,z]=d.exports.useState(""),ne=Bt(),{t:b}=$e(),{colorMode:U}=Jr(),T=Or({defaultValues:Li(),resolver:xi(Yu)}),O=T.getValues("expire"),ve=T.getValues("next_plan_expire");function Z(M){if(typeof M!="number"||M<=0)return null;const xe=Pe.unix(M).utc().local(),Le=Pe(),Ke=xe.diff(Le,"day",!0);return Number.isFinite(Ke)?Math.max(0,Math.round(Ke)):null}function J(M){return Pe().add(M,"day").endOf("day").utc().unix()}const[E,q]=d.exports.useState(()=>Z(O)),[ue,Y]=d.exports.useState(()=>Z(ve)),re=[{label:b("userDialog.quickSelectOneMonth","+1 month"),amount:1,unit:"month"},{label:b("userDialog.quickSelectThreeMonths","+3 months"),amount:3,unit:"month"},{label:b("userDialog.quickSelectOneYear","+1 year"),amount:1,unit:"year"}],A=Gn(M=>M.services),me=Gn(M=>M.isLoading),{userData:De,getUserIsSuccess:Ee}=Mn(),W=Boolean(Ee&&De.is_sudo),[y,P]=d.exports.useState(null),ie=A.length>0,te=y&&(ar=A.find(M=>M.id===y))!=null?ar:null,Ce=Boolean(t==null?void 0:t.service_id),Te=!W&&A.length===1,Re=W||A.length!==1,Oe=Re&&A.length>0,B=!Oe,V=!W&&A.length===0,{data:L}=Nr("panel-settings",ya,{enabled:g,staleTime:5*60*1e3,refetchOnWindowFocus:!1}),he=Boolean(L==null?void 0:L.use_nobetci),[ze,at]=d.exports.useState(!1),pe=()=>{at(M=>!M)};d.exports.useEffect(()=>{g&&Gn.getState().fetchServices()},[g]),d.exports.useEffect(()=>{var M,xe;m?t!=null&&t.service_id?P(t.service_id):W?P(null):A.length?P((xe=(M=A[0])==null?void 0:M.id)!=null?xe:null):P(null):g||P(null)},[m,t,g,W,A]),d.exports.useEffect(()=>{!m&&g&&ie&&P(M=>{var xe,Le;return(Le=M!=null?M:(xe=A[0])==null?void 0:xe.id)!=null?Le:null})},[A,m,g,ie]),d.exports.useEffect(()=>{!m&&g&&!ie&&P(null)},[ie,m,g]),d.exports.useEffect(()=>{Te&&A[0]&&P(M=>M!=null?M:A[0].id)},[Te,A]);const[oe,le]=Ht({control:T.control,name:["data_limit","status"]}),$=Ht({control:T.control,name:"next_plan_enabled"}),ye=Ht({control:T.control,name:"expire"}),ut=Ht({control:T.control,name:"next_plan_data_limit"}),mt=Ht({control:T.control,name:"next_plan_expire"}),Q=Ht({control:T.control,name:"next_plan_add_remaining_traffic"}),H=Ht({control:T.control,name:"next_plan_fire_on_either"});d.exports.useEffect(()=>{const M=Z(ye);q(xe=>xe===M?xe:M)},[ye]),d.exports.useEffect(()=>{const M=Z(mt);Y(xe=>xe===M?xe:M)},[mt]);const Se=M=>{T.setValue("next_plan_enabled",M,{shouldDirty:!0}),M?(T.getValues("next_plan_data_limit")===null&&T.setValue("next_plan_data_limit",0,{shouldDirty:!1}),T.getValues("next_plan_add_remaining_traffic")===void 0&&T.setValue("next_plan_add_remaining_traffic",!1,{shouldDirty:!1}),T.getValues("next_plan_fire_on_either")===void 0&&T.setValue("next_plan_fire_on_either",!0,{shouldDirty:!1})):(T.setValue("next_plan_data_limit",null,{shouldDirty:!0}),T.setValue("next_plan_expire",null,{shouldDirty:!0}),Y(null))},Me=b("userDialog.total"),[Fe,Be]=d.exports.useState(bi(U,Me)),[ce,ge]=d.exports.useState("1m"),We=M=>{o(t,M).then(xe=>{const Le=[],Ke=[];for(const Ge in xe.usages)Ke.push(xe.usages[Ge].used_traffic),Le.push(xe.usages[Ge].node_name);Be(bi(U,Me,Ke,Le))})};d.exports.useEffect(()=>{if(t){const M=qu(t);T.reset(M),q(Z(M.expire)),Y(Z(M.next_plan_expire)),We({start:Pe().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})}else{const M=Li();T.reset(M),q(Z(M.expire)),Y(Z(M.next_plan_expire))}},[t,m,g]);const Ie=M=>{var zr,mn;if(w)return;v(!0),z(null);const{service_id:xe,next_plan_enabled:Le,next_plan_data_limit:Ke,next_plan_expire:Ge,next_plan_add_remaining_traffic:it,next_plan_fire_on_either:Nt,proxies:Vt,inbounds:kr,status:Gt,data_limit:lr,data_limit_reset_strategy:Pt,on_hold_expire_duration:nt,ip_limit:vt,...Wr}=M,Fr=Le&&Ke&&Ke>0?Number((Number(Ke)*1073741824).toFixed(5)):0,Qt=Le?{data_limit:Fr,expire:Ge!=null?Ge:0,add_remaining_traffic:it,fire_on_either:Nt}:null,vr=typeof vt=="number"&&Number.isFinite(vt)&&vt>0?Math.floor(vt):0;if(!m){const It=y!=null?y:Te&&(mn=(zr=A[0])==null?void 0:zr.id)!=null?mn:null;if(!It){z(b("userDialog.selectService","Please choose a service")),v(!1);return}const rr={username:M.username,service_id:It,note:M.note,status:M.status==="active"||M.status==="disabled"||M.status==="on_hold"?M.status:"active",expire:M.expire,data_limit:M.data_limit,ip_limit:vr,data_limit_reset_strategy:lr&&lr>0?Pt:"no_reset",on_hold_expire_duration:Gt==="on_hold"?nt:null};Qt&&(rr.next_plan=Qt),a(rr).then(()=>{ne({title:b("userDialog.userCreated",{username:M.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),ot()}).catch(Ct=>{var Cr,Rr,fe,mr,cr;(((Cr=Ct==null?void 0:Ct.response)==null?void 0:Cr.status)===409||((Rr=Ct==null?void 0:Ct.response)==null?void 0:Rr.status)===400)&&z((mr=(fe=Ct==null?void 0:Ct.response)==null?void 0:fe._data)==null?void 0:mr.detail),((cr=Ct==null?void 0:Ct.response)==null?void 0:cr.status)===422&&Object.keys(Ct.response._data.detail).forEach(Mr=>{z(Ct==null?void 0:Ct.response._data.detail[Mr]),T.setError(Mr,{type:"custom",message:Ct.response._data.detail[Mr]})})}).finally(()=>{v(!1)});return}const Xt={...Wr,data_limit:lr,ip_limit:vr,data_limit_reset_strategy:lr&&lr>0?Pt:"no_reset",status:Gt==="active"||Gt==="disabled"||Gt==="on_hold"?Gt:"active",on_hold_expire_duration:Gt==="on_hold"?nt:null};Qt?Xt.next_plan=Qt:!Le&&(t==null?void 0:t.next_plan)&&(Xt.next_plan=null),t!=null&&t.service_id||(Vt&&Object.keys(Vt).length>0&&(Xt.proxies=Vt),kr&&Object.keys(kr).length>0&&(Xt.inbounds=kr)),typeof y<"u"&&(y===null?W&&(Xt.service_id=null):y!==(t==null?void 0:t.service_id)&&(Xt.service_id=y)),l(t.username,Xt).then(()=>{ne({title:b("userDialog.userEdited",{username:M.username}),status:"success",isClosable:!0,position:"top",duration:3e3}),ot()}).catch(It=>{var rr,Ct,Cr,Rr,fe;(((rr=It==null?void 0:It.response)==null?void 0:rr.status)===409||((Ct=It==null?void 0:It.response)==null?void 0:Ct.status)===400)&&z((Rr=(Cr=It==null?void 0:It.response)==null?void 0:Cr._data)==null?void 0:Rr.detail),((fe=It==null?void 0:It.response)==null?void 0:fe.status)===422&&Object.keys(It.response._data.detail).forEach(mr=>{z(It==null?void 0:It.response._data.detail[mr]),T.setError(mr,{type:"custom",message:It.response._data.detail[mr]})})}).finally(()=>{v(!1)})},ot=()=>{T.reset(Li()),q(null),Y(null),r(!1),i(null),z(null),at(!1),ge("1m"),P(null)},gt=()=>{xt.setState({resetUsageUser:t})},Mt=()=>{xt.setState({revokeSubscriptionUser:t})},et=x||w,jt=le==="on_hold",[hr,sr]=d.exports.useState(!1),pr=()=>{sr(!0);let M="";const xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Le=xe.length;let Ke=0;for(;Ke<6;)M+=xe.charAt(Math.floor(Math.random()*Le)),Ke+=1;return M};return n(Ut,{isOpen:g,onClose:ot,size:V?"lg":"2xl",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(Mc,{...T,children:n(Lt,{mx:"3",position:"relative",overflow:"hidden",children:[e(Rt,{mt:3,disabled:x}),e(N,{pointerEvents:w?"none":"auto",filter:w?"blur(6px)":"none",transition:"filter 0.2s ease",children:n("form",{onSubmit:T.handleSubmit(Ie),children:[e(At,{pt:6,children:n(R,{gap:2,children:[e(En,{color:"primary",children:m?e($u,{color:"white"}):e(Vu,{color:"white"})}),e(h,{fontWeight:"semibold",fontSize:"lg",children:b(m?"userDialog.editUserTitle":"createNewUser")})]})}),n(kt,{children:[m&&Ce&&n(Ir,{status:"info",mb:4,borderRadius:"md",children:[e(Tr,{}),b("userDialog.serviceManagedNotice","This user is tied to service {{service}}. Update the service to change shared settings.",{service:(tr=t==null?void 0:t.service_name)!=null?tr:""})]}),n(Rs,{templateColumns:{base:"repeat(1, 1fr)",md:Oe?"repeat(2, 1fr)":"minmax(0, 1fr)"},gap:3,...B?{maxW:"720px",mx:"auto",w:"full"}:{},children:[e(rn,{children:n(de,{justifyContent:"space-between",children:[n(lt,{flexDirection:"column",gridAutoRows:"min-content",w:"full",children:[e(lt,{flexDirection:"row",w:"full",gap:2,children:n(k,{mb:"10px",isInvalid:!!((or=T.formState.errors.username)!=null&&or.message),children:[e(_,{children:b("username")}),n(R,{align:"flex-end",children:[e(N,{flex:"1",minW:"0",children:n(wr,{size:"sm",children:[e(we,{type:"text",borderRadius:"6px",placeholder:b("username"),isDisabled:et||m,...T.register("username")}),!m&&e(Er,{width:"auto",pr:1,children:e(Ue,{"aria-label":b("userDialog.generateUsername","Generate random username"),size:"sm",variant:"ghost",icon:e(mi,{width:18}),onClick:()=>{const M=pr();T.setValue("username",M,{shouldDirty:!0}),setTimeout(()=>{sr(!1)},350)},isLoading:hr,isDisabled:et})})]})}),m&&e(R,{px:1,children:e(pt,{name:"status",control:T.control,render:({field:M})=>e(ct,{placement:"top",label:"status: "+b(`status.${M.value}`),textTransform:"capitalize",children:e(N,{children:e(ht,{colorScheme:"primary",isChecked:M.value==="active",onChange:xe=>{xe.target.checked?M.onChange("active"):M.onChange("disabled")}})})})})})]}),e(Xr,{children:(G=T.formState.errors.username)==null?void 0:G.message})]})}),n(ke,{direction:{base:"column",md:"row"},spacing:4,mb:"10px",children:[n(k,{flex:"1",children:[e(_,{children:b("userDialog.dataLimit")}),e(pt,{control:T.control,name:"data_limit",render:({field:M})=>{var xe;return e(Zt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:M.onChange,disabled:et,error:(xe=T.formState.errors.data_limit)==null?void 0:xe.message,value:M.value?String(M.value):""})}})]}),he&&n(k,{flex:"1",children:[n(_,{display:"flex",alignItems:"center",gap:2,children:[b("userDialog.ipLimitLabel","IP limit"),e(ct,{hasArrow:!0,placement:"top",label:b("userDialog.ipLimitHint","Maximum number of unique IPs allowed. Leave empty or '-' for unlimited."),children:e(ee.span,{display:"inline-flex",color:"gray.400",cursor:"help",children:e(Xo,{width:16,height:16})})})]}),e(pt,{control:T.control,name:"ip_limit",rules:{validate:M=>M==null?!0:typeof M!="number"||Number.isNaN(M)?b("userDialog.ipLimitValidation","Enter a valid non-negative number"):M>=0?!0:b("userDialog.ipLimitValidation","Enter a valid non-negative number")},render:({field:M})=>{var xe;return e(Zt,{size:"sm",borderRadius:"6px",placeholder:b("userDialog.ipLimitPlaceholder","Leave empty or '-' for unlimited"),value:typeof M.value=="number"&&M.value>0?String(M.value):"",onChange:Le=>{const Ke=Le.target.value;if(!Ke.trim()||Ke.trim()==="-"){M.onChange(null);return}const Ge=Number(Ke);Number.isNaN(Ge)||M.onChange(Ge<0?0:Math.floor(Ge))},disabled:et,error:(xe=T.formState.errors.ip_limit)==null?void 0:xe.message})}})]})]}),e(Xn,{in:!!(oe&&oe>0),animateOpacity:!0,style:{width:"100%"},children:n(k,{height:"66px",children:[e(_,{children:b("userDialog.periodicUsageReset")}),e(pt,{control:T.control,name:"data_limit_reset_strategy",render:({field:M})=>e(je,{size:"sm",...M,disabled:et,bg:et?"gray.100":"transparent",_dark:{bg:et?"gray.600":"transparent"},sx:{option:{backgroundColor:U==="dark"?"#222C3B":"white"}},children:ea.map(xe=>e("option",{value:xe.value,children:b("userDialog.resetStrategy"+xe.title)},xe.value))})})]})}),n(k,{mb:"10px",isInvalid:!jt&&Boolean(T.formState.errors.expire),children:[n(lt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:2,md:4},flexDirection:{base:"column",md:"row"},children:[e(_,{mb:0,children:jt?b("userDialog.onHoldExpireDuration"):b("userDialog.expiryDaysLabel","Expires in (days)")}),!m&&e(pt,{name:"status",control:T.control,render:({field:M})=>{const xe=M.value==="on_hold";return n(R,{spacing:2,align:"center",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.onHold")}),e(ht,{colorScheme:"primary",isChecked:xe,onChange:Le=>{Le.target.checked?M.onChange("on_hold"):(M.onChange("active"),T.setValue("on_hold_expire_duration",null,{shouldDirty:!0}))},isDisabled:et})]})}})]}),jt?e(pt,{control:T.control,name:"on_hold_expire_duration",render:({field:M})=>{var xe;return e(Zt,{endAdornment:"Days",type:"number",size:"sm",borderRadius:"6px",onChange:Le=>{T.setValue("expire",null);const Ke=Le.target.value;if(!Ke){M.onChange(null);return}const Ge=Number(Ke);Number.isNaN(Ge)||Ge<0||M.onChange(Math.round(Ge))},disabled:et,error:(xe=T.formState.errors.on_hold_expire_duration)==null?void 0:xe.message,value:M.value?String(M.value):""})}}):n(Ot,{children:[e(pt,{name:"expire",control:T.control,render:({field:M})=>{const{status:xe,time:Le}=Ci(M.value),Ke=M.value?Pe.unix(M.value).toDate():null,Ge=it=>{if(!it){M.onChange(null),T.setValue("on_hold_expire_duration",null,{shouldDirty:!1});return}const Nt=Pe(it).utc().unix();T.setValue("on_hold_expire_duration",null,{shouldDirty:!1}),M.onChange(Nt)};return n(N,{children:[e(Wu,{value:Ke,onChange:Ge,placeholder:b("userDialog.selectExpiryDate","Select expiration date"),disabled:et,minDate:new Date,quickSelects:re.map(it=>({label:it.label,onClick:()=>{const Nt=Pe().add(it.amount,it.unit).endOf("day");Ge(Nt.toDate())}}))}),M.value?e(Lr,{children:b(xe,{time:Le})}):null]})}}),e(Xr,{children:(be=T.formState.errors.expire)==null?void 0:be.message})]})]}),n(N,{mb:"10px",children:[n(R,{justify:"space-between",align:"center",children:[e(_,{mb:0,children:b("userDialog.nextPlanTitle","Next plan")}),e(ht,{colorScheme:"primary",isChecked:$,onChange:M=>Se(M.target.checked),isDisabled:et})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:b("userDialog.nextPlanDescription","Configure automatic renewal details for this user.")}),e(Xn,{in:$,animateOpacity:!0,style:{width:"100%"},children:n(de,{align:"stretch",spacing:3,mt:3,children:[n(k,{children:[e(_,{fontSize:"sm",children:b("userDialog.nextPlanDataLimit","Next plan data limit")}),e(Zt,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",disabled:et,value:ut!==null&&typeof ut<"u"?String(ut):"",onChange:M=>{const xe=M.target.value;if(!xe){T.setValue("next_plan_data_limit",null,{shouldDirty:!0});return}const Le=Number(xe);Number.isNaN(Le)||T.setValue("next_plan_data_limit",Math.max(0,Le),{shouldDirty:!0})}})]}),n(k,{children:[e(_,{fontSize:"sm",children:b("userDialog.nextPlanExpireDays","Next plan in (days)")}),e(pt,{control:T.control,name:"next_plan_expire",render:({field:M})=>{const xe=Le=>{if(!Le){Y(null),M.onChange(null);return}const Ke=Number(Le);if(Number.isNaN(Ke)||Ke<0)return;const Ge=Math.min(Math.round(Ke),3650);Y(Ge);const it=J(Ge);M.onChange(it)};return e(Zt,{endAdornment:b("userDialog.days","Days"),type:"number",size:"sm",borderRadius:"6px",value:typeof ue=="number"?String(ue):"",onChange:Le=>xe(Le.target.value),disabled:et})}})]}),n(R,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.nextPlanAddRemainingTraffic","Carry over remaining traffic")}),e(ht,{size:"sm",colorScheme:"primary",isChecked:Boolean(Q),onChange:M=>T.setValue("next_plan_add_remaining_traffic",M.target.checked,{shouldDirty:!0}),isDisabled:et})]}),n(R,{justify:"space-between",children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.400"},children:b("userDialog.nextPlanFireOnEither","Trigger on data or expiry")}),e(ht,{size:"sm",colorScheme:"primary",isChecked:Boolean(H),onChange:M=>T.setValue("next_plan_fire_on_either",M.target.checked,{shouldDirty:!0}),isDisabled:et})]})]})})]}),n(k,{mb:"10px",isInvalid:!!T.formState.errors.note,children:[e(_,{children:b("userDialog.note")}),e(Ar,{...T.register("note")}),e(Xr,{children:(rt=(X=T.formState.errors)==null?void 0:X.note)==null?void 0:rt.message})]})]}),C&&n(Ir,{status:"error",display:{base:"none",md:"flex"},children:[e(Tr,{}),C]})]})}),Re&&e(rn,{mt:Oe?0:4,children:n(k,{isRequired:!m,children:[e(_,{children:b("userDialog.selectServiceLabel","Service")}),me?n(R,{spacing:2,py:4,children:[e(Dt,{size:"sm"}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:b("loading")})]}):ie?n(de,{align:"stretch",spacing:3,children:[m&&W&&n(N,{role:"button",tabIndex:et?-1:0,"aria-pressed":y===null,onKeyDown:M=>{et||(M.key==="Enter"||M.key===" ")&&(M.preventDefault(),P(null))},onClick:()=>{et||P(null)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:y===null?"primary.500":"gray.200",bg:y===null?"primary.50":"transparent",cursor:et?"not-allowed":"pointer",pointerEvents:et?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:et?{}:{borderColor:y===null?"primary.500":"gray.300"},_dark:{borderColor:y===null?"primary.400":"gray.700",bg:y===null?"primary.900":"transparent"},children:[e(h,{fontWeight:"semibold",children:b("userDialog.noServiceOption","No service")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:b("userDialog.noServiceHelper","Keep this user detached from shared service settings.")})]}),A.map(M=>{const xe=y===M.id;return e(N,{role:"button",tabIndex:et?-1:0,"aria-pressed":xe,onKeyDown:Le=>{et||(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),P(M.id))},onClick:()=>{et||P(M.id)},borderWidth:"1px",borderRadius:"md",p:4,borderColor:xe?"primary.500":"gray.200",bg:xe?"primary.50":"transparent",cursor:et?"not-allowed":"pointer",pointerEvents:et?"none":"auto",transition:"border-color 0.2s ease, background-color 0.2s ease",_hover:et?{}:{borderColor:xe?"primary.500":"gray.300"},_dark:{borderColor:xe?"primary.400":"gray.700",bg:xe?"primary.900":"transparent"},children:n(R,{justify:"space-between",align:"flex-start",children:[n(de,{align:"flex-start",spacing:0,children:[e(h,{fontWeight:"semibold",children:M.name}),M.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:M.description})]}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:b("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:M.host_count,users:M.user_count})})]})},M.id)})]}):n(Ir,{status:"warning",borderRadius:"md",children:[e(Tr,{}),b("userDialog.noServicesAvailable","No services are available yet. Create a service to manage users.")]}),te&&e(Lr,{mt:2,children:b("userDialog.serviceSummary","{{hosts}} hosts, {{users}} users",{hosts:te.host_count,users:te.user_count})})]})}),m&&ze&&e(rn,{pt:6,colSpan:{base:1,md:Re?2:1},children:n(de,{gap:4,children:[e(Bu,{defaultValue:ce,onChange:(M,xe)=>{ge(M),We(xe)}}),e(N,{width:{base:"100%",md:"70%"},justifySelf:"center",children:e(en,{options:Fe.options,series:Fe.series,type:"donut"})})]})})]}),C&&n(Ir,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(Tr,{}),C]})]}),e(zt,{mt:"3",children:n(R,{justifyContent:"space-between",w:"full",gap:3,flexDirection:{base:"column",sm:"row"},children:[e(R,{justifyContent:"flex-start",w:{base:"full",sm:"unset"},children:m&&n(Ot,{children:[e(ct,{label:b("delete"),placement:"top",children:e(Ue,{"aria-label":"Delete",size:"sm",onClick:()=>{c(t),ot()},children:e(Vs,{})})}),e(ct,{label:b("userDialog.usage"),placement:"top",children:e(Ue,{"aria-label":"usage",size:"sm",onClick:pe,children:e(Ku,{})})}),e(F,{onClick:gt,size:"sm",children:b("userDialog.resetUsage")}),e(F,{onClick:Mt,size:"sm",children:b("userDialog.revokeSubscription")})]})}),e(R,{w:"full",maxW:{md:"50%",base:"full"},justify:"end",children:e(F,{type:"submit",size:"sm",px:"8",colorScheme:"primary",leftIcon:x?e(Dt,{size:"xs"}):void 0,disabled:et,children:b(m?"userDialog.editUser":"createUser")})})]})})]})}),w&&n(lt,{position:"absolute",inset:0,align:"center",justify:"center",direction:"column",gap:4,bg:"blackAlpha.600",color:"white",textAlign:"center",p:6,pointerEvents:"none",children:[e(En,{color:"primary",children:e(Ju,{})}),e(h,{fontSize:"xl",fontWeight:"semibold",children:b("userDialog.limitReachedTitle")}),e(h,{fontSize:"md",maxW:"sm",children:I&&I>0?b("userDialog.limitReachedBody",{limit:I,active:D!=null?D:I}):b("userDialog.limitReachedContent")})]})]})})]})},Qu=t=>d.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},d.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),d.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),d.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),d.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),d.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),d.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Xu=t=>{if(!t)return null;const s=new Date(`${t}Z`);return Math.floor(s.getTime()/1e3)},Qa=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=Xu(t);return!t||r===null?e(N,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):s-r<=60?e(N,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e(N,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},Zu=t=>{if(!t)return null;const s=new Date(t+"Z");return Math.floor(s.getTime()/1e3)},Xa=({lastOnline:t})=>{const s=Math.floor(Date.now()/1e3),r=Zu(t),l=r?s-r:null,o=r?Ci(r):{status:"",time:"Not Connected Yet"};return e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:l&&l<=60?"Online":l?`${o.time} ago`:o.time})},Oi=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=$e(),a=Ci(t),c=An[s].icon;return n(Ot,{children:[n(sn,{colorScheme:An[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",children:[e(c,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[s&&i(`status.${s}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},ju=ee(Qu),us={baseStyle:{w:{base:4,md:5},h:{base:4,md:5}}},eh=ee(Zo,us),th=ee(wi,us),Za=ee(Si,us),rh=ee(jo,us),nh=ee(Yo,us),sh=ee(Sn,us),ih=ee(wi,{baseStyle:{width:"15px",height:"15px"}}),ah=t=>{for(var s=0;s<ea.length;s++){const r=ea[s];if(r.value==t)return r.title}return"No"},oh=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o}=t,i=r===0||r===null;return e(R,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:n(h,{children:[Xe(s)," /"," ",i?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Xe(r)]})})},ja=t=>{const{used:s,total:r,dataLimitResetStrategy:l,totalUsedTraffic:o,...i}=t,a=r===0||r===null,c=!a&&s/r*100>=100;return n(Ot,{children:[e(Uc,{orientation:"horizontal",value:a?100:Math.min(s/r*100,100),colorScheme:c?"red":"primary",...i,children:e(Lc,{h:"6px",borderRadius:"full",children:e(Oc,{borderRadius:"full"})})}),n(R,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[n(h,{children:[Xe(s)," /"," ",a?e(h,{as:"span",fontFamily:"system-ui",children:"\u221E"}):Xe(r)+(l&&l!=="no_reset"?" "+on("userDialog.resetStrategy"+ah(l)):"")]}),n(h,{children:[on("usersTable.total"),": ",Xe(o)]})]})]})},ys=({sort:t,column:s})=>t.includes(s)?e(ih,{transform:t.startsWith("-")?void 0:"rotate(180deg)"}):null,lh=t=>{const{filters:s,users:{users:r,total:l},onEditingUser:o,onFilterChange:i,loading:a}=xt(),{t:c}=$e(),[u,p]=d.exports.useState(void 0),m=xr({base:!1,md:!0}),g=r.length!==l,I=s.limit||10,D=v=>{let C=s.sort;C.includes(v)?C.startsWith("-")?C="-created_at":C="-"+v:C=v,i({sort:C})},w=v=>{i({status:v.target.value.length>0?v.target.value:void 0})},x=v=>{p(v===u?void 0:v)};return n(N,{id:"users-table",overflowX:{base:"unset",md:"unset"},children:[e(el,{allowMultiple:!0,display:{base:"block",md:"none"},index:u,children:n(Pn,{orientation:"vertical",zIndex:"docked",...t,children:[e(Zr,{zIndex:"docked",position:"relative",children:n(_t,{children:[e(He,{minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:D.bind(null,"username"),children:n(R,{children:[e("span",{children:c("users")}),e(ys,{sort:s.sort,column:"username"})]})}),e(He,{minW:"50px",pl:0,pr:0,w:"140px",cursor:"pointer",children:n(R,{spacing:0,position:"relative",children:[n(h,{position:"absolute",_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,w:"100%",children:[c("usersTable.status"),s.status?": "+s.status:""]}),n(je,{value:s.sort,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",p:0,border:0,h:"auto",w:"auto",icon:e(Ot,{}),_focusVisible:{border:"0 !important"},onChange:w,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(He,{minW:"100px",cursor:"pointer",pr:0,onClick:D.bind(null,"used_traffic"),children:n(R,{children:[e("span",{children:c("usersTable.dataUsage")}),e(ys,{sort:s.sort,column:"used_traffic"})]})}),e(He,{minW:"32px",w:"32px",p:0,cursor:"pointer"})]})}),n($r,{children:[!m&&(a?Array.from({length:I}).map((v,C)=>n(d.exports.Fragment,{children:[n(_t,{children:[e(Ne,{borderBottom:0,minW:"100px",pl:4,pr:4,children:e(Xs,{noOfLines:1,width:"40%"})}),e(Ne,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Wn,{height:"16px",width:"64px"})}),e(Ne,{borderBottom:0,minW:"100px",pr:0,children:e(Wn,{height:"16px",width:"120px"})}),e(Ne,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(Wn,{height:"16px",width:"16px"})})]}),e(_t,{className:"collapsible",children:e(Ne,{p:0,colSpan:4,children:e(N,{px:6,py:3,children:e(Xs,{noOfLines:3})})})})]},"skeleton-"+C)):r==null?void 0:r.map((v,C)=>{var z;return n(d.exports.Fragment,{children:[n(_t,{onClick:x.bind(null,C),cursor:"pointer",children:[e(Ne,{borderBottom:0,minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 50px - 32px - 100px - 48px)",children:n("div",{className:"flex-status",children:[e(Qa,{lastOnline:v.online_at}),e(h,{isTruncated:!0,children:v.username})]})}),e(Ne,{borderBottom:0,minW:"50px",pl:0,pr:0,children:e(Oi,{compact:!0,showDetail:!1,expiryDate:v.expire,status:v.status})}),e(Ne,{borderBottom:0,minW:"100px",pr:0,children:e(oh,{totalUsedTraffic:v.lifetime_used_traffic,dataLimitResetStrategy:v.data_limit_reset_strategy,used:v.used_traffic,total:v.data_limit,colorScheme:An[v.status].bandWidthColor})}),e(Ne,{p:0,borderBottom:0,w:"32px",minW:"32px",children:e(th,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:u===C?"rotate(180deg)":"0deg"})})]}),e(_t,{className:"collapsible",onClick:x.bind(null,C),children:e(Ne,{p:0,colSpan:4,children:n(tl,{border:0,children:[e(rl,{display:"none"}),e(nl,{border:0,cursor:"pointer",px:6,py:3,children:n(de,{justifyContent:"space-between",spacing:"4",children:[n(de,{alignItems:"flex-start",w:"full",spacing:-1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.dataUsage")}),e(N,{width:"full",minW:"230px",children:e(ja,{totalUsedTraffic:v.lifetime_used_traffic,dataLimitResetStrategy:v.data_limit_reset_strategy,used:v.used_traffic,total:v.data_limit,colorScheme:An[v.status].bandWidthColor})})]}),n(de,{alignItems:"flex-start",w:"full",spacing:1,children:[e(h,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:c("usersTable.service","Service")}),e(h,{fontSize:"sm",color:v.service_name?"gray.700":"gray.500",_dark:{color:v.service_name?"gray.200":"gray.500"},children:(z=v.service_name)!=null?z:c("usersTable.defaultService","Default")})]}),n(R,{w:"full",justifyContent:"space-between",children:[n(N,{width:"full",children:[e(Oi,{compact:!0,expiryDate:v.expire,status:v.status}),e(Xa,{lastOnline:v.online_at})]}),n(R,{children:[e(eo,{user:v}),e(ct,{label:c("userDialog.editUser"),placement:"top",children:e(Ue,{p:"0 !important","aria-label":"Edit user",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:ne=>{ne.stopPropagation(),o(v)},children:e(sh,{})})})]})]})]})})]})})})]},v.username)})),!a&&!m&&r.length===0&&e(_t,{children:e(Ne,{colSpan:4,border:0,children:e(to,{isFiltered:g})})})]})]})}),n(Pn,{orientation:"vertical",display:{base:"none",md:"table"},...t,children:[e(Zr,{position:"relative",zIndex:"docked",children:n(_t,{children:[e(He,{minW:"140px",cursor:"pointer",onClick:D.bind(null,"username"),children:n(R,{children:[e("span",{children:c("username")}),e(ys,{sort:s.sort,column:"username"})]})}),e(He,{width:"400px",minW:"150px",cursor:"pointer",children:n(R,{position:"relative",gap:"5px",children:[n(h,{_dark:{bg:"gray.750"},_light:{bg:"#F9FAFB"},userSelect:"none",pointerEvents:"none",zIndex:1,children:[c("usersTable.status"),s.status?": "+s.status:""]}),e(h,{children:"/"}),e(ys,{sort:s.sort,column:"expire"}),e(R,{onClick:D.bind(null,"expire"),children:e(h,{children:"Sort by expire"})}),n(je,{fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",cursor:"pointer",position:"absolute",p:0,left:"-40px",border:0,h:"auto",w:"auto",icon:e(Ot,{}),_focusVisible:{border:"0 !important"},value:s.sort,onChange:w,children:[e("option",{}),e("option",{children:"active"}),e("option",{children:"on_hold"}),e("option",{children:"disabled"}),e("option",{children:"limited"}),e("option",{children:"expired"})]})]})}),e(He,{minW:"150px",children:e("span",{children:c("usersTable.service","Service")})}),e(He,{width:"350px",minW:"230px",cursor:"pointer",onClick:D.bind(null,"used_traffic"),children:n(R,{children:[e("span",{children:c("usersTable.dataUsage")}),e(ys,{sort:s.sort,column:"used_traffic"})]})}),e(He,{width:"200px",minW:"180px"})]})}),n($r,{children:[m&&(a?Array.from({length:I}).map((v,C)=>n(_t,{children:[e(Ne,{minW:"140px",children:e(Xs,{noOfLines:1,width:"40%"})}),e(Ne,{width:"400px",minW:"150px",children:e(Wn,{height:"16px",width:"120px"})}),e(Ne,{minW:"150px",children:e(Xs,{noOfLines:1,width:"60%"})}),e(Ne,{width:"350px",minW:"230px",children:e(Wn,{height:"16px",width:"200px"})}),e(Ne,{width:"200px",minW:"180px",children:e(Wn,{height:"16px",width:"64px"})})]},"skeleton-desktop-"+C)):r==null?void 0:r.map((v,C)=>{var z;return n(_t,{className:da("interactive",{"last-row":C===r.length-1}),onClick:()=>o(v),children:[e(Ne,{minW:"140px",children:n("div",{className:"flex-status",children:[e(Qa,{lastOnline:v.online_at}),v.username,e(Xa,{lastOnline:v.online_at})]})}),e(Ne,{width:"400px",minW:"150px",children:e(Oi,{expiryDate:v.expire,status:v.status})}),e(Ne,{minW:"150px",children:e(h,{fontSize:"sm",color:v.service_name?"gray.700":"gray.500",_dark:{color:v.service_name?"gray.200":"gray.500"},isTruncated:!0,children:(z=v.service_name)!=null?z:c("usersTable.defaultService","Default")})}),e(Ne,{width:"350px",minW:"230px",children:e(ja,{totalUsedTraffic:v.lifetime_used_traffic,dataLimitResetStrategy:v.data_limit_reset_strategy,used:v.used_traffic,total:v.data_limit,colorScheme:An[v.status].bandWidthColor})}),e(Ne,{width:"200px",minW:"180px",children:e(eo,{user:v})})]},v.username)})),!a&&r.length==0&&e(_t,{children:e(Ne,{colSpan:5,children:e(to,{isFiltered:g})})})]})]})]})},eo=({user:t})=>{const{setQRCode:s,setSubLink:r}=xt(),l=t.links.join(`\r
`),i=(u=>u?u.startsWith("/")?window.location.origin+u:u:"")(t.subscription_url),[a,c]=d.exports.useState([-1,!1]);return d.exports.useEffect(()=>{a[1]&&setTimeout(()=>{c([-1,!1])},1e3)},[a]),n(R,{justifyContent:"flex-end",onClick:u=>{u.preventDefault(),u.stopPropagation()},children:[e(Ta,{text:i,onCopy:()=>{c([0,!0])},children:e("div",{children:e(ct,{label:a[0]==0&&a[1]?on("usersTable.copied"):on("usersTable.copyLink"),placement:"top",children:e(Ue,{p:"0 !important","aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:a[0]==0&&a[1]?e(Za,{}):e(rh,{})})})})}),e(Ta,{text:l,onCopy:()=>{c([1,!0])},children:e("div",{children:e(ct,{label:a[0]==1&&a[1]?on("usersTable.copied"):on("usersTable.copyConfigs"),placement:"top",children:e(Ue,{p:"0 !important","aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},children:a[0]==1&&a[1]?e(Za,{}):e(eh,{})})})})}),e(ct,{label:"QR Code",placement:"top",children:e(Ue,{p:"0 !important","aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},size:{base:"sm",md:"md"},onClick:()=>{s(t.links),r(i)},children:e(nh,{})})})]})},to=({isFiltered:t})=>{const{onCreateUser:s}=xt();return n(N,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e(ju,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(h,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?on("usersTable.noUserMatched"):on("usersTable.noUser")}),!t&&e(F,{size:"sm",colorScheme:"primary",onClick:()=>s(!0),children:on("createUser")})]})},ch=()=>{const{t}=$e();return d.exports.useEffect(()=>{xt.getState().refetchUsers(),Ls()},[]),n(de,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("users")}),e(yl,{}),e(lh,{}),e(Sl,{}),e(Gu,{}),e(gu,{}),e(Tu,{}),e(Eu,{}),e(zu,{})]})},Ft=(t,s,r)=>{if(t.response&&t.response._data){if(typeof t.response._data.detail=="string")return s({title:t.response._data.detail,status:"error",isClosable:!0,position:"top",duration:3e3});if(typeof t.response._data.detail=="object"&&r){Object.keys(t.response._data.detail).forEach(l=>r.setError(l,{message:t.response._data.detail[l]}));return}}return s({title:"Something went wrong!",status:"error",isClosable:!0,position:"top",duration:3e3})},Wt=(t,s)=>s({title:t,status:"success",isClosable:!0,position:"top",duration:3e3}),dh=()=>{var J,E,q,ue,Y;const{t}=$e(),s=Bt(),{adminInDialog:r,isAdminDialogOpen:l,closeAdminDialog:o,createAdmin:i,updateAdmin:a}=pn(),c=d.exports.useMemo(()=>r?"edit":"create",[r]),u=d.exports.useMemo(()=>Ae.object({username:c==="create"?Ae.string().trim().min(3,{message:t("admins.validation.usernameMin")}):Ae.string().optional(),password:Ae.string().trim().optional().transform(A=>A===""?void 0:A).refine(A=>!A||A.length>=6,t("admins.validation.passwordMin")),telegram_id:Ae.string().trim().optional().transform(A=>A===""?void 0:A).refine(A=>A===void 0||/^\d+$/.test(A),t("admins.validation.telegramNumeric")),is_sudo:Ae.boolean().optional(),data_limit:Ae.string().trim().optional().transform(A=>A===""?void 0:A).refine(A=>A===void 0||/^\d+$/.test(A),t("admins.validation.dataLimitNumeric","Data limit must be a number")),users_limit:Ae.string().trim().optional().transform(A=>A===""?void 0:A).refine(A=>A===void 0||/^\d+$/.test(A),t("admins.validation.usersLimitNumeric","Users limit must be a number"))}).superRefine((A,me)=>{c==="create"&&!A.password&&me.addIssue({code:Ae.ZodIssueCode.custom,path:["password"],message:t("admins.validation.passwordRequired")})}),[c,t]),p=Or({resolver:xi(u),defaultValues:{username:"",password:"",telegram_id:"",is_sudo:!1,data_limit:"",users_limit:""}}),{register:m,handleSubmit:g,reset:I,formState:D,setValue:w,watch:x,setError:v}=p,C=m("is_sudo"),[z,ne]=d.exports.useState(!1),b=d.exports.useCallback(re=>{var De;const A="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",me=A.length;if(typeof window<"u"&&((De=window.crypto)==null?void 0:De.getRandomValues)){const Ee=new Uint32Array(re);return window.crypto.getRandomValues(Ee),Array.from(Ee,W=>A[W%me]).join("")}return Array.from({length:re},()=>{const Ee=Math.floor(Math.random()*me);return A[Ee]}).join("")},[]),U=d.exports.useCallback(()=>{if(c==="edit")return;const re=b(8);w("username",re,{shouldDirty:!0,shouldValidate:!0})},[b,c,w]),T=d.exports.useCallback(()=>{const re=b(12);w("password",re,{shouldDirty:!0,shouldValidate:!0})},[b,w]),{errors:O,isSubmitting:ve}=D;d.exports.useEffect(()=>{var re,A;l&&I({username:(re=r==null?void 0:r.username)!=null?re:"",password:"",telegram_id:(r==null?void 0:r.telegram_id)!==void 0&&(r==null?void 0:r.telegram_id)!==null?String(r.telegram_id):"",is_sudo:(A=r==null?void 0:r.is_sudo)!=null?A:!1,data_limit:(r==null?void 0:r.data_limit)!==void 0&&(r==null?void 0:r.data_limit)!==null?String(Math.floor(r.data_limit/(1024*1024*1024))):"",users_limit:(r==null?void 0:r.users_limit)!==void 0&&(r==null?void 0:r.users_limit)!==null?String(r.users_limit):""})},[r,l,I]);const Z=g(async re=>{var A,me,De,Ee;if(c==="edit"&&r){const W=(A=r.active_users)!=null?A:0;if(re.users_limit){const y=Number(re.users_limit);if(!Number.isNaN(y)&&y>0&&y<W){v("users_limit",{type:"manual",message:t("admins.validation.usersLimitTooLow",{active:W})});return}}}try{if(c==="create"){const W={username:re.username.trim(),password:(me=re.password)!=null?me:"",is_sudo:(De=re.is_sudo)!=null?De:!1,telegram_id:re.telegram_id?Number(re.telegram_id):void 0,data_limit:re.data_limit?Number(re.data_limit)*1024*1024*1024:void 0,users_limit:re.users_limit?Number(re.users_limit):void 0};await i(W),Wt(t("admins.createSuccess","Admin created"),s)}else if(r){const W={is_sudo:(Ee=re.is_sudo)!=null?Ee:!1,telegram_id:re.telegram_id?Number(re.telegram_id):void 0,data_limit:re.data_limit?Number(re.data_limit)*1024*1024*1024:void 0,users_limit:re.users_limit?Number(re.users_limit):void 0};re.password&&(W.password=re.password),await a(r.username,W),Wt(t("admins.updateSuccess","Admin updated"),s)}o()}catch(W){Ft(W,s,p)}});return n(Ut,{isOpen:l,onClose:o,size:"lg",children:[e(wt,{}),n(Lt,{children:[e(At,{children:c==="create"?t("admins.addAdminTitle","Add admin"):t("admins.editAdminTitle","Edit admin")}),e(Rt,{}),e(kt,{children:n(de,{spacing:4,align:"stretch",children:[n(k,{isInvalid:!!O.username,children:[e(_,{children:t("username")}),n(wr,{children:[e(we,{placeholder:t("admins.usernamePlaceholder","Admin username"),...m("username"),isDisabled:c==="edit"}),c==="create"&&e(Er,{children:e(Ue,{"aria-label":t("admins.generateUsername","Random"),size:"sm",variant:"ghost",icon:e(mi,{width:20}),onClick:U})})]}),e(Xr,{children:(J=O.username)==null?void 0:J.message})]}),n(k,{isInvalid:!!O.password,children:[e(_,{children:t("password")}),n(R,{spacing:2,children:[n(wr,{children:[e(we,{placeholder:t("admins.passwordPlaceholder","Password"),type:z?"text":"password",...m("password")}),e(Er,{children:e(Ue,{"aria-label":z?t("admins.hidePassword","Hide"):t("admins.showPassword","Show"),size:"sm",variant:"ghost",icon:z?e(pa,{width:16}):e(zs,{width:16}),onClick:()=>ne(!z)})})]}),e(Ue,{"aria-label":t("admins.generatePassword","Random"),size:"md",variant:"outline",icon:e(mi,{width:20}),onClick:T})]}),e(Xr,{children:(E=O.password)==null?void 0:E.message}),c==="edit"&&e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.passwordOptionalHint","Leave empty to keep current password.")})]}),e(k,{display:"flex",alignItems:"center",children:n(de,{align:"start",spacing:1,w:"full",children:[n(R,{justify:"space-between",w:"full",children:[e(_,{htmlFor:"is_sudo",mb:"0",children:t("admins.sudoAccess","Sudo access")}),e(ht,{id:"is_sudo",isChecked:x("is_sudo"),onChange:re=>w("is_sudo",re.target.checked,{shouldDirty:!0}),onBlur:C.onBlur,ref:C.ref})]}),e(h,{fontSize:"xs",color:"gray.500",children:t("admins.sudoDescription","Sudo admins can manage other admins.")})]})}),n(k,{isInvalid:!!O.telegram_id,children:[e(_,{children:t("admins.telegramId","Telegram ID")}),e(we,{placeholder:t("admins.telegramPlaceholder","Optional numeric Telegram ID"),inputMode:"numeric",...m("telegram_id")}),e(Xr,{children:(q=O.telegram_id)==null?void 0:q.message})]}),n(k,{isInvalid:!!O.data_limit,children:[e(_,{children:t("admins.dataLimit","Data Limit (GB)")}),e(we,{placeholder:t("admins.dataLimitPlaceholder","e.g., 100 for 100GB (empty = unlimited)"),inputMode:"numeric",...m("data_limit")}),e(Xr,{children:(ue=O.data_limit)==null?void 0:ue.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.dataLimitHint","Leave empty for unlimited data")})]}),n(k,{isInvalid:!!O.users_limit,children:[e(_,{children:t("admins.usersLimit","Users Limit")}),e(we,{placeholder:t("admins.usersLimitPlaceholder","e.g., 100 (empty = unlimited)"),inputMode:"numeric",...m("users_limit")}),e(Xr,{children:(Y=O.users_limit)==null?void 0:Y.message}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:t("admins.usersLimitHint","Leave empty for unlimited users")})]})]})}),e(zt,{children:n(R,{spacing:3,children:[e(F,{variant:"ghost",onClick:o,children:t("cancel")}),e(F,{colorScheme:"primary",onClick:Z,isLoading:ve,children:c==="create"?t("admins.addAdmin","Create"):t("save","Save")})]})})]})]})},uh=()=>{var re;const{t}=$e(),s=Bt(),r=st("gray.50","whiteAlpha.100"),l=st("primary.50","primary.900"),{admins:o,loading:i,total:a,filters:c,onFilterChange:u,fetchAdmins:p,deleteAdmin:m,resetUsage:g,disableUsers:I,activateUsers:D,openAdminDialog:w,openAdminDetails:x,adminInDetails:v}=pn(),C=d.exports.useRef(null),{isOpen:z,onOpen:ne,onClose:b}=Yt(),[U,T]=d.exports.useState(null),[O,ve]=d.exports.useState(null),Z=A=>{if(A==="data_usage"||A==="data_limit"){const me=c.sort===A?`-${A}`:A;u({sort:me,offset:0})}else{const me=c.sort===A?`-${A}`:c.sort===`-${A}`?void 0:A;u({sort:me,offset:0})}},J=A=>{T(A),ne()},E=async()=>{if(!!U)try{await m(U.username),Wt(t("admins.deleteSuccess","Admin removed"),s),b(),T(null)}catch(A){Ft(A,s)}},q=async(A,me)=>{ve({type:A,username:me.username});try{A==="reset"?(await g(me.username),Wt(t("admins.resetUsageSuccess","Usage reset"),s)):A==="disable"?(await I(me.username),Wt(t("admins.disableUsersSuccess","Users disabled"),s)):A==="activate"&&(await D(me.username),Wt(t("admins.activateUsersSuccess","Users activated"),s)),p()}catch(De){Ft(De,s)}finally{ve(null)}},ue=({column:A})=>{var Ee,W,y,P,ie;let me=!1,De=!1;return A==="data"?(me=((Ee=c.sort)==null?void 0:Ee.includes("data_usage"))||((W=c.sort)==null?void 0:W.includes("data_limit")),De=me&&((y=c.sort)==null?void 0:y.startsWith("-"))):(me=(P=c.sort)==null?void 0:P.includes(A),De=me&&((ie=c.sort)==null?void 0:ie.startsWith("-"))),e(wi,{style:{width:"1rem",height:"1rem",opacity:me?1:0,transform:me&&!De?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})},Y=d.exports.useMemo(()=>[{key:"username",label:t("username")},{key:"data",label:t("dataUsage")+" / "+t("dataLimit")},{key:"users_count",label:t("users")},{key:"actions",label:""}],[t]);return i&&!o.length?e(N,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(Dt,{})}):a?n(Ot,{children:[e(N,{borderWidth:"1px",borderRadius:"md",overflowX:"auto",children:n(Pn,{variant:"simple",size:"sm",minW:"640px",children:[e(Zr,{children:e(_t,{children:Y.map(A=>e(He,{onClick:()=>A.key==="username"||A.key==="users_count"||A.key==="data"?Z(A.key):void 0,cursor:A.key==="username"||A.key==="users_count"||A.key==="data"?"pointer":"default",textAlign:A.key==="actions"?"right":"left",children:n(R,{justify:A.key==="actions"?"flex-end":"flex-start",children:[e(h,{children:A.label}),A.key==="data"?n(ui,{children:[e(hi,{as:Ue,size:"xs",variant:"ghost",icon:e(ue,{column:"data"})}),n(pi,{children:[e(nr,{onClick:()=>Z("data_usage"),children:t("admins.sortByUsage")}),e(nr,{onClick:()=>Z("data_limit"),children:t("admins.sortByLimit")})]})]}):A.key==="username"||A.key==="users_count"?e(ue,{column:A.key}):null]})},A.key))})}),e($r,{children:o.map(A=>{var W,y;const me=(v==null?void 0:v.username)===A.username,De=A.users_limit&&A.users_limit>0?String(A.users_limit):"\u221E",Ee=`${(W=A.active_users)!=null?W:0}/${De}`;return n(_t,{onClick:()=>x(A),cursor:"pointer",bg:me?l:void 0,_hover:{bg:r},transition:"background-color 0.15s ease-in-out",children:[n(Ne,{children:[e(h,{fontWeight:"medium",children:A.username}),A.is_sudo&&e(sn,{colorScheme:"purple",fontSize:"xs",mt:1,children:t("sudo")})]}),e(Ne,{children:n(h,{whiteSpace:"nowrap",children:[Xe((y=A.users_usage)!=null?y:0,2)," /"," ",A.data_limit?Xe(A.data_limit,2):"-"]})}),e(Ne,{children:n(ke,{spacing:0,children:[e(h,{fontSize:"xs",color:"gray.500",children:t("users")}),e(h,{fontWeight:"semibold",children:Ee})]})}),e(Ne,{textAlign:"right",children:n(ui,{children:[e(hi,{as:Ue,icon:e(Wc,{width:20}),variant:"ghost",onClick:P=>P.stopPropagation()}),n(pi,{onClick:P=>P.stopPropagation(),children:[e(nr,{icon:e(Sn,{width:20}),onClick:P=>{P.stopPropagation(),w(A)},children:t("edit")}),e(nr,{icon:e(Kr,{width:20}),onClick:P=>{P.stopPropagation(),q("reset",A)},isDisabled:(O==null?void 0:O.username)===A.username,children:t("admins.resetUsage")}),e(gi,{}),e(nr,{icon:e(Fc,{width:20}),onClick:P=>{P.stopPropagation(),q("activate",A)},isDisabled:(O==null?void 0:O.username)===A.username,children:t("admins.activateUsers")}),e(nr,{icon:e(Hc,{width:20}),onClick:P=>{P.stopPropagation(),q("disable",A)},isDisabled:(O==null?void 0:O.username)===A.username,children:t("admins.disableUsers")}),e(gi,{}),e(nr,{color:"red.500",icon:e(nn,{width:20}),onClick:P=>{P.stopPropagation(),J(A)},children:t("delete")})]})]})})]},A.username)})})]})}),e(Ms,{isOpen:z,leastDestructiveRef:C,onClose:b,children:e(wt,{children:n(Us,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("admins.confirmDeleteTitle","Delete admin")}),e(kt,{children:t("admins.confirmDeleteMessage","Are you sure you want to delete {{username}}?",{username:(re=U==null?void 0:U.username)!=null?re:""})}),n(zt,{children:[e(F,{ref:C,onClick:b,children:t("cancel")}),e(F,{colorScheme:"red",onClick:E,ml:3,children:t("delete")})]})]})})})]}):e(N,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:e(h,{children:t("admins.noAdmins")})})},hh=(t,s)=>!t||t<=0?s!=null?s:"\u221E":`${t}`,Wi=(t,s)=>!t||t<=0?s!=null?s:"\u221E":Xe(t,2),ph=()=>{var C,z,ne,b,U,T,O,ve,Z,J;const{t}=$e(),{isAdminDetailsOpen:s,adminInDetails:r,closeAdminDetails:l}=pn(E=>({isAdminDetailsOpen:E.isAdminDetailsOpen,adminInDetails:E.adminInDetails,closeAdminDetails:E.closeAdminDetails})),o=st("gray.50","whiteAlpha.50"),i=(C=r==null?void 0:r.active_users)!=null?C:0,a=(z=r==null?void 0:r.users_limit)!=null?z:null,c=t("admins.details.unlimited","Unlimited"),u=a&&a>0?String(a):c,p=(ne=r==null?void 0:r.users_count)!=null?ne:0,m=(b=r==null?void 0:r.limited_users)!=null?b:0,g=(U=r==null?void 0:r.expired_users)!=null?U:0,I=(T=r==null?void 0:r.online_users)!=null?T:0,D=(O=r==null?void 0:r.users_usage)!=null?O:0,w=(ve=r==null?void 0:r.data_limit)!=null?ve:null,x=w&&w>0?Math.max(w-D,0):null,v=(Z=r==null?void 0:r.lifetime_usage)!=null?Z:null;return n(Bo,{isOpen:s,placement:"right",size:"md",onClose:l,children:[e(wt,{}),n(Vo,{children:[e(Rt,{}),e(At,{bg:o,children:n(ke,{spacing:1,children:[n(R,{spacing:2,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:(J=r==null?void 0:r.username)!=null?J:t("admins.details.title","Admin details")}),(r==null?void 0:r.is_sudo)&&e(N,{as:"span",fontSize:"xs",px:2,py:.5,borderRadius:"full",bg:"purple.500",color:"white",children:t("admins.sudoBadge","Sudo")})]}),r&&e(h,{fontSize:"sm",color:"gray.500",children:t("admins.details.summary",{active:i,limit:u})})]})}),e(kt,{children:r?n(ke,{spacing:8,children:[n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.usersSection","Users")}),n(Ve,{columns:{base:2,md:3},spacing:4,children:[e(Gr,{label:t("admins.details.activeLabel","Active"),value:String(i)}),e(Gr,{label:t("admins.details.onlineLabel","Online"),value:String(I)}),e(Gr,{label:t("admins.details.limitedLabel","Limited"),value:String(m)}),e(Gr,{label:t("admins.details.expiredLabel","Expired"),value:String(g)}),e(Gr,{label:t("admins.details.totalUsers","Total users"),value:String(p)}),e(Gr,{label:t("admins.details.usersLimit","Users limit"),value:hh(a,c)})]})]}),n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:t("admins.details.dataSection","Data usage")}),n(Ve,{columns:{base:2,md:4},spacing:4,children:[e(Gr,{label:t("admins.details.used","Used"),value:Xe(D,2)}),e(Gr,{label:t("admins.details.limit","Limit"),value:Wi(w,c)}),e(Gr,{label:t("admins.details.remaining","Remaining"),value:Wi(x,c)}),e(Gr,{label:t("admins.details.lifetime","Lifetime usage"),value:Wi(v,void 0)})]})]})]}):e(N,{py:8,children:e(h,{color:"gray.500",children:t("admins.details.empty","Select an admin to view details.")})})}),e(zt,{children:e(F,{variant:"outline",mr:3,onClick:l,children:t("close","Close")})})]})]})},Gr=({label:t,value:s})=>n(N,{borderWidth:"1px",borderRadius:"md",px:3,py:2,minH:"64px",display:"flex",flexDirection:"column",justifyContent:"center",children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t}),e(h,{fontWeight:"semibold",children:s})]}),mh=()=>{const{t}=$e(),s=pn(i=>i.fetchAdmins),{userData:r,getUserIsSuccess:l}=Mn(),o=l&&r.is_sudo;return d.exports.useEffect(()=>{o&&s()},[s,o]),o?n(de,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(yl,{for:"admins"}),e(uh,{}),e(Sl,{for:"admins"}),e(dh,{}),e(ph,{})]}):n(de,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("admins.manageTab","Admins")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.pageDescription","View and manage admin accounts. Use this page to create, edit and review admin permissions and recent usage.")}),e(h,{children:t("admins.noPermission","You don't have permission to manage admins.")})]})},xl=ns(t=>({isLoading:!1,isPostLoading:!1,hosts:{},fetchHosts:()=>{t({isLoading:!0}),_e("/hosts").then(s=>t({hosts:s})).finally(()=>t({isLoading:!1}))},setHosts:s=>(t({isPostLoading:!0}),_e("/hosts",{method:"PUT",body:s}).finally(()=>{t({isPostLoading:!1})}))})),gh=[{title:"Inbound's default",value:"inbound_default"},{title:"TLS",value:"tls"},{title:"None",value:"none"}],fh=[{title:"",value:""},{title:"h3",value:"h3"},{title:"h2",value:"h2"},{title:"http/1.1",value:"http/1.1"},{title:"h3,h2,http/1.1",value:"h3,h2,http/1.1"},{title:"h3,h2",value:"h3,h2"},{title:"h2,http/1.1",value:"h2,http/1.1"}],bh=[{title:"",value:""},...["chrome","firefox","safari","ios","android","edge","360","qq","random","randomized"].map(t=>({title:t,value:t}))],yh=ee(Sn,{baseStyle:{w:4,h:4}}),wl=ee(un,{baseStyle:{w:4,h:4}}),kl=ee(Ho,{baseStyle:{w:4,h:4}}),Sh=ee(Fs,{baseStyle:{w:4,h:4,color:"gray.400",cursor:"pointer"}}),xh=[{token:"{SERVER_IP}",labelKey:"hostsDialog.currentServer"},{token:"{SERVER_IPV6}",labelKey:"hostsDialog.currentServerv6"},{token:"{USERNAME}",labelKey:"hostsDialog.username"},{token:"{DATA_USAGE}",labelKey:"hostsDialog.dataUsage"},{token:"{DATA_LEFT}",labelKey:"hostsDialog.remainingData"},{token:"{DATA_LIMIT}",labelKey:"hostsDialog.dataLimit"},{token:"{DAYS_LEFT}",labelKey:"hostsDialog.remainingDays"},{token:"{EXPIRE_DATE}",labelKey:"hostsDialog.expireDate"},{token:"{JALALI_EXPIRE_DATE}",labelKey:"hostsDialog.jalaliExpireDate"},{token:"{TIME_LEFT}",labelKey:"hostsDialog.remainingTime"},{token:"{STATUS_TEXT}",labelKey:"hostsDialog.statusText"},{token:"{STATUS_EMOJI}",labelKey:"hostsDialog.statusEmoji"},{token:"{PROTOCOL}",labelKey:"hostsDialog.proxyProtocol"},{token:"{TRANSPORT}",labelKey:"hostsDialog.proxyMethod"}],Qn=()=>{const{t}=$e();return n(ss,{isLazy:!0,placement:"right",children:[e(is,{children:e(N,{mt:"-1",children:e(Sh,{})})}),e(Qo,{children:n(as,{maxW:"xs",fontSize:"xs",children:[e(Hs,{}),e(il,{}),e(os,{children:n(N,{pr:5,lineHeight:"1.4",children:[e(h,{mb:2,children:t("hostsDialog.desc")}),xh.map(({token:s,labelKey:r})=>n(h,{mt:1,children:[e(sn,{mr:2,children:s}),t(r)]},s))]})})]})})]})},vl=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Ur=t=>typeof t=="number"&&!Number.isNaN(t)?t:Number.MAX_SAFE_INTEGER,jr=t=>(t!=null?t:"").trim(),Ss=(t,s=!1)=>typeof t=="boolean"?t:s,wh=(t,s)=>{var r,l,o,i,a,c,u,p;return{id:(r=t.id)!=null?r:null,remark:(l=t.remark)!=null?l:"",address:(o=t.address)!=null?o:"",sort:(i=t.sort)!=null?i:s,port:(a=t.port)!=null?a:null,path:jr(t.path),sni:jr(t.sni),host:jr(t.host),mux_enable:Ss(t.mux_enable),allowinsecure:Ss(t.allowinsecure),is_disabled:Ss(t.is_disabled,!1),fragment_setting:jr(t.fragment_setting),noise_setting:jr(t.noise_setting),random_user_agent:Ss(t.random_user_agent),security:(c=t.security)!=null?c:"inbound_default",alpn:(u=t.alpn)!=null?u:"",fingerprint:(p=t.fingerprint)!=null?p:"",use_sni_as_host:Ss(t.use_sni_as_host)}},ta=t=>{var s,r;return{id:(s=t.id)!=null?s:null,remark:t.remark,address:t.address,sort:t.sort,port:(r=t.port)!=null?r:null,path:t.path,sni:t.sni,host:t.host,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting,noise_setting:t.noise_setting,random_user_agent:t.random_user_agent,security:t.security,alpn:t.alpn,fingerprint:t.fingerprint,use_sni_as_host:t.use_sni_as_host}},ro=t=>{var s,r;return{...t,id:(s=t.id)!=null?s:null,port:(r=t.port)!=null?r:null,path:jr(t.path),sni:jr(t.sni),host:jr(t.host),fragment_setting:jr(t.fragment_setting),noise_setting:jr(t.noise_setting)}},Cl=t=>{const s=ro(t.data),r=ro(t.original);return t.inboundTag!==t.initialInboundTag?!0:JSON.stringify(s)!==JSON.stringify(r)},kh=t=>{var s;return{id:(s=t.id)!=null?s:null,remark:t.remark.trim(),address:t.address.trim(),sort:t.sort,port:t.port,path:t.path.trim()?t.path.trim():null,sni:t.sni.trim()?t.sni.trim():null,host:t.host.trim()?t.host.trim():null,mux_enable:t.mux_enable,allowinsecure:t.allowinsecure,is_disabled:t.is_disabled,fragment_setting:t.fragment_setting.trim()?t.fragment_setting.trim():null,noise_setting:t.noise_setting.trim()?t.noise_setting.trim():null,random_user_agent:t.random_user_agent,security:t.security||"inbound_default",alpn:t.alpn||"",fingerprint:t.fingerprint||"",use_sni_as_host:t.use_sni_as_host}},Ts=t=>[...t].sort((s,r)=>{const l=Ur(s.data.sort)-Ur(r.data.sort);return l!==0?l:s.data.remark.localeCompare(r.data.remark)}),vh=t=>{const s=[];return Object.entries(t).forEach(([r,l])=>{l.forEach((o,i)=>{const a=wh(o,i),c=a.id!=null?`host-${a.id}`:vl();s.push({uid:c,inboundTag:r,initialInboundTag:r,data:ta(a),original:ta(a)})})}),Ts(s)},_l=t=>{const s=new Map;t.forEach(l=>{var i;const o=(i=s.get(l.inboundTag))!=null?i:[];o.push(l.data),s.set(l.inboundTag,o)});const r={};return s.forEach((l,o)=>{r[o]=l.map(i=>kh(i)).sort((i,a)=>Ur(i.sort)-Ur(a.sort))}),r},Fi=(t,s)=>{const r=_l(t),l=Array.from(new Set(s)),o={};return l.forEach(i=>{var a;o[i]=(a=r[i])!=null?a:[]}),o},Ch=({host:t,inboundOptions:s,orderIndex:r,onToggleActive:l,onEdit:o,onDelete:i,saving:a,deleting:c})=>{const{t:u}=$e(),p=s.find(D=>D.value===t.inboundTag),m=!t.data.is_disabled,g=Cl(t),I=t.data.remark||u("hostsPage.untitledHost");return e(tn,{borderWidth:"1px",borderColor:g?"primary.400":"gray.200",_dark:{borderColor:g?"primary.300":"gray.700",bg:g?"gray.800":"gray.900"},cursor:"pointer",onClick:()=>o(t.uid),transition:"border-color 0.2s ease",_hover:{borderColor:"primary.400"},children:n(cn,{as:ke,spacing:4,children:[n(R,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(de,{align:"flex-start",spacing:1,flex:"1",children:[e(ct,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"semibold",noOfLines:1,maxW:"full",children:I})}),n(R,{spacing:2,flexWrap:"wrap",children:[e(bt,{colorScheme:"gray",size:"sm",children:u("hostsPage.orderIndex",{value:r+1})}),p&&e(bt,{colorScheme:"purple",size:"sm",children:`${p.value} (${p.protocol.toUpperCase()} - ${p.network})`}),typeof t.data.port=="number"&&e(bt,{colorScheme:"blue",size:"sm",children:u("hostsPage.portTag",{value:t.data.port})}),g&&e(bt,{colorScheme:"orange",size:"sm",children:u("hostsPage.unsaved")})]})]}),n(R,{spacing:2,children:[e(ht,{size:"sm",colorScheme:"primary",isChecked:m,onChange:D=>{D.stopPropagation(),l(t.uid,D.target.checked)},"aria-label":u("hostsPage.toggleActive")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:u(m?"hostsPage.enabled":"hostsPage.disabled")})]})]}),n(de,{align:"stretch",spacing:2,color:"gray.600",_dark:{color:"gray.300"},children:[e(h,{fontSize:"sm",children:t.data.address||u("hostsPage.noAddress")}),t.data.path&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.path"),": ",t.data.path]}),t.data.sni&&n(h,{fontSize:"sm",noOfLines:1,children:[u("hostsDialog.sni"),": ",t.data.sni]})]}),n(R,{justify:"space-between",children:[e(F,{size:"sm",variant:"outline",leftIcon:e(yh,{}),onClick:D=>{D.stopPropagation(),o(t.uid)},isLoading:a,children:u("hostsPage.edit")}),e(Ue,{"aria-label":u("hostsPage.delete"),size:"sm",colorScheme:"red",variant:"ghost",onClick:D=>{D.stopPropagation(),i(t.uid)},icon:e(Vs,{}),isLoading:c})]})]})})},_h=({host:t,index:s})=>{const{t:r}=$e(),l=Bc(),o=t.data.remark||r("hostsPage.untitledHost"),i=d.exports.useCallback(a=>{a.pointerType==="mouse"&&a.button!==0||(a.preventDefault(),l.start(a))},[l]);return e(sl.Item,{value:t,id:t.uid,dragListener:!1,dragControls:l,drag:!0,dragMomentum:!1,whileDrag:{zIndex:10,scale:1.01},dragTransition:{bounceStiffness:600,bounceDamping:40},style:{listStyle:"none",touchAction:"none"},children:n(R,{borderWidth:"1px",borderRadius:"md",borderColor:"gray.200",_dark:{borderColor:"gray.600",bg:"gray.800"},px:4,py:3,spacing:4,align:"center",children:[e(ct,{label:r("hostsPage.dragHandle"),hasArrow:!0,children:e(Ue,{"aria-label":r("hostsPage.dragHandle"),size:"sm",variant:"ghost",icon:e(kl,{}),cursor:"grab",onPointerDown:i,style:{touchAction:"none"}})}),e(bt,{colorScheme:"gray",size:"sm",children:r("hostsPage.orderIndex",{value:s+1})}),n(de,{align:"flex-start",spacing:0,flex:"1",children:[e(ct,{label:t.data.remark,isDisabled:!t.data.remark,children:e(h,{fontWeight:"medium",noOfLines:1,maxW:"full",children:o})}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:1,children:t.data.address||t.inboundTag})]})]})})},Dh=({host:t,inboundOptions:s,isOpen:r,onClose:l,onChange:o,onChangeInbound:i,onSave:a,onReset:c,onDelete:u,saving:p,deleting:m})=>{var w;const{t:g}=$e();if(!t)return null;const I=s.find(x=>x.value===t.inboundTag),D=Cl(t);return n(Ut,{isOpen:r,onClose:l,size:"4xl",scrollBehavior:"inside",isCentered:!0,children:[e(wt,{}),n(Lt,{children:[e(Rt,{}),e(At,{pb:1,children:n(de,{align:"stretch",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t.data.remark||g("hostsPage.untitledHost")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t.data.address||g("hostsPage.noAddress")}),I&&e(bt,{colorScheme:"purple",size:"sm",alignSelf:"flex-start",children:`${I.value} (${I.protocol.toUpperCase()} - ${I.network})`})]})}),e(kt,{children:n(de,{align:"stretch",spacing:5,children:[n(tn,{variant:"outline",children:[e(qn,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.general")})}),e(cn,{pt:0,children:n(de,{align:"stretch",spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.remark")}),n(wr,{children:[e(we,{value:t.data.remark,onChange:x=>o(t.uid,"remark",x.target.value)}),e(Er,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsPage.inboundLabel")}),e(je,{value:t.inboundTag,onChange:x=>i(t.uid,x.target.value),children:s.map(x=>e("option",{value:x.value,children:x.label},x.value))})]}),n(k,{children:[e(_,{children:g("hostsDialog.sort")}),e(Tn,{value:t.data.sort,allowMouseWheel:!0,onChange:(x,v)=>o(t.uid,"sort",Number.isNaN(v)?t.data.sort:v),children:e(In,{})})]})]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.address")}),n(wr,{children:[e(we,{value:t.data.address,onChange:x=>o(t.uid,"address",x.target.value)}),e(Er,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(k,{children:[e(_,{children:g("hostsDialog.port")}),e(Tn,{value:(w=t.data.port)!=null?w:"",allowMouseWheel:!0,onChange:(x,v)=>o(t.uid,"port",Number.isNaN(v)?null:v),children:e(In,{})})]})]}),n(k,{children:[e(_,{children:g("hostsDialog.path")}),e(we,{value:t.data.path,onChange:x=>o(t.uid,"path",x.target.value),placeholder:"/"})]})]})})]}),n(tn,{variant:"outline",children:[e(qn,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.security")})}),e(cn,{pt:0,children:n(de,{align:"stretch",spacing:4,children:[n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.sni")}),e(we,{value:t.data.sni,onChange:x=>o(t.uid,"sni",x.target.value)})]}),n(k,{children:[e(_,{children:g("hostsDialog.host")}),n(wr,{children:[e(we,{value:t.data.host,onChange:x=>o(t.uid,"host",x.target.value)}),e(Er,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]})]}),n(Ve,{columns:{base:1,md:3},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.security")}),e(je,{value:t.data.security,onChange:x=>o(t.uid,"security",x.target.value),children:gh.map(x=>e("option",{value:x.value,children:x.title},x.value))})]}),n(k,{children:[e(_,{children:g("hostsDialog.alpn")}),e(je,{value:t.data.alpn,onChange:x=>o(t.uid,"alpn",x.target.value),children:fh.map(x=>e("option",{value:x.value,children:x.title},x.value))})]}),n(k,{children:[e(_,{children:g("hostsDialog.fingerprint")}),e(je,{value:t.data.fingerprint,onChange:x=>o(t.uid,"fingerprint",x.target.value),children:bh.map(x=>e("option",{value:x.value,children:x.title},x.value))})]})]})]})})]}),n(tn,{variant:"outline",children:[e(qn,{pb:2,children:e(h,{fontWeight:"semibold",children:g("hostsPage.section.advanced")})}),e(cn,{pt:0,children:n(de,{align:"stretch",spacing:4,children:[n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:g("hostsDialog.fragment")}),e(we,{value:t.data.fragment_setting,onChange:x=>o(t.uid,"fragment_setting",x.target.value)})]}),n(k,{children:[e(_,{children:g("hostsDialog.noise")}),e(we,{value:t.data.noise_setting,onChange:x=>o(t.uid,"noise_setting",x.target.value)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:4,children:[e(Pr,{isChecked:t.data.allowinsecure,onChange:x=>o(t.uid,"allowinsecure",x.target.checked),children:g("hostsDialog.allowinsecure")}),e(Pr,{isChecked:t.data.mux_enable,onChange:x=>o(t.uid,"mux_enable",x.target.checked),children:g("hostsDialog.muxEnable")}),e(Pr,{isChecked:t.data.random_user_agent,onChange:x=>o(t.uid,"random_user_agent",x.target.checked),children:g("hostsDialog.randomUserAgent")}),e(Pr,{isChecked:t.data.use_sni_as_host,onChange:x=>o(t.uid,"use_sni_as_host",x.target.checked),children:g("hostsDialog.useSniAsHost")})]})]})})]})]})}),n(zt,{justifyContent:"space-between",children:[e(F,{size:"sm",variant:"ghost",colorScheme:"red",leftIcon:e(Vs,{}),onClick:()=>u(t.uid),isLoading:m,children:g("hostsPage.delete")}),n(R,{spacing:3,children:[e(F,{size:"sm",variant:"outline",onClick:()=>c(t.uid),isDisabled:!D||p,children:g("hostsPage.reset")}),e(F,{size:"sm",colorScheme:"primary",onClick:()=>a(t.uid),isDisabled:!D,isLoading:p,children:g("hostsPage.save")})]})]})]})]})},Ah=({isOpen:t,onClose:s,inboundOptions:r,onSubmit:l,isSubmitting:o,defaultSort:i})=>{var g,I,D,w;const{t:a}=$e(),c=d.exports.useRef(null),[u,p]=d.exports.useState({inboundTag:(I=(g=r[0])==null?void 0:g.value)!=null?I:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""});d.exports.useEffect(()=>{var x,v;t&&(p({inboundTag:(v=(x=r[0])==null?void 0:x.value)!=null?v:"",remark:"",address:"",sort:i!=null?i:0,port:null,path:"",sni:"",host:""}),setTimeout(()=>{var C;return(C=c.current)==null?void 0:C.focus()},150))},[i,r,t]);const m=()=>{!u.inboundTag||!u.remark.trim()||!u.address.trim()||l(u)};return n(Ut,{isOpen:t,onClose:s,size:"lg",initialFocusRef:c,children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Lt,{children:[e(At,{children:n(R,{spacing:3,children:[e(wl,{}),e(h,{fontWeight:"semibold",children:a("hostsPage.create.title")})]})}),e(Rt,{mt:2}),n(kt,{as:de,align:"stretch",spacing:4,pt:2,children:[e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:a("hostsPage.create.description")}),n(k,{children:[e(_,{children:a("hostsPage.inboundLabel")}),e(je,{value:u.inboundTag,onChange:x=>p(v=>({...v,inboundTag:x.target.value})),children:r.map(x=>e("option",{value:x.value,children:x.label},x.value))})]}),n(k,{isRequired:!0,children:[e(_,{children:a("hostsDialog.remark")}),n(wr,{children:[e(we,{ref:c,value:u.remark,onChange:x=>p(v=>({...v,remark:x.target.value}))}),e(Er,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{isRequired:!0,children:[e(_,{children:a("hostsDialog.address")}),n(wr,{children:[e(we,{value:u.address,onChange:x=>p(v=>({...v,address:x.target.value}))}),e(Er,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(k,{children:[e(_,{children:a("hostsDialog.port")}),e(Tn,{value:(D=u.port)!=null?D:"",onChange:(x,v)=>p(C=>({...C,port:Number.isNaN(v)?null:v})),children:e(In,{})})]})]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("hostsDialog.path")}),e(we,{value:u.path,onChange:x=>p(v=>({...v,path:x.target.value}))})]}),n(k,{children:[e(_,{children:a("hostsDialog.sni")}),e(we,{value:u.sni,onChange:x=>p(v=>({...v,sni:x.target.value}))})]})]}),n(k,{children:[e(_,{children:a("hostsDialog.host")}),n(wr,{children:[e(we,{value:u.host,onChange:x=>p(v=>({...v,host:x.target.value}))}),e(Er,{width:"auto",pr:2,pointerEvents:"auto",children:e(Qn,{})})]})]}),n(k,{children:[e(_,{children:a("hostsDialog.sort")}),e(Tn,{value:Number.isFinite(u.sort)?u.sort:"",onChange:(x,v)=>p(C=>({...C,sort:Number.isNaN(v)?C.sort:v})),children:e(In,{})})]}),e(N,{borderRadius:"md",bg:"gray.50",color:"gray.600",fontSize:"sm",px:4,py:3,_dark:{bg:"gray.800",color:"gray.300"},children:a("hostsPage.create.sortHint",{value:(w=u.sort)!=null?w:i})})]}),n(zt,{gap:2,children:[e(F,{variant:"ghost",onClick:s,children:a("hostsPage.cancel")}),e(F,{colorScheme:"primary",onClick:m,isLoading:o,children:a("hostsPage.create.submit")})]})]})]})},Ih=()=>{var mt;const{t}=$e(),s=Bt(),{hosts:r,fetchHosts:l,isLoading:o,isPostLoading:i,setHosts:a}=xl(),{inbounds:c}=xt(),[u,p]=d.exports.useState([]),m=d.exports.useRef([]),g=d.exports.useCallback(Q=>{typeof Q=="function"?p(H=>{const Se=Q(H);return m.current=Se,Se}):(m.current=Q,p(Q))},[]),[I,D]=d.exports.useState(null),[w,x]=d.exports.useState(!1),[v,C]=d.exports.useState(!1),[z,ne]=d.exports.useState(null),[b,U]=d.exports.useState(null),[T,O]=d.exports.useState(null),[ve,Z]=d.exports.useState(null),J=d.exports.useRef(null),[E,q]=d.exports.useState(!1),ue=d.exports.useRef(!1),[Y,re]=d.exports.useState(!1),[A,me]=d.exports.useState(!1),[De,Ee]=d.exports.useState(null);d.exports.useEffect(()=>{l()},[l]),d.exports.useEffect(()=>{c.size||Ls()},[c]),d.exports.useEffect(()=>{const Q=vh(r);g(Q)},[r,g]),d.exports.useEffect(()=>{if(ve){const Q=m.current.find(H=>H.inboundTag===ve.inboundTag&&H.data.remark.trim()===ve.remark&&H.data.address.trim()===ve.address);Q&&(D(Q.uid),Z(null))}},[u,ve]),d.exports.useEffect(()=>{I&&!m.current.some(Q=>Q.uid===I)&&!ve&&D(null)},[u,I,ve]);const W=d.exports.useCallback(Q=>{ue.current=Q,q(Q)},[]);d.exports.useEffect(()=>{A||(Ee(null),W(!1))},[w,A,W]),d.exports.useEffect(()=>{if(!A||!De)return;const Q=new Set(m.current.map(Se=>Se.uid));De.every(Se=>Q.has(Se.uid))||(Ee(null),W(!1))},[u,A,W,De]);const y=d.exports.useMemo(()=>{const Q=[];return c.forEach(H=>{H.forEach(Se=>{Q.push({label:`${Se.tag} (${Se.protocol.toUpperCase()} - ${Se.network})`,value:Se.tag,protocol:Se.protocol,network:Se.network})})}),Q.sort((H,Se)=>H.label.localeCompare(Se.label))},[c]),P=d.exports.useMemo(()=>m.current.filter(Q=>!Q.data.is_disabled).sort((Q,H)=>Ur(Q.data.sort)-Ur(H.data.sort)),[u]),ie=d.exports.useMemo(()=>[...m.current].sort((Q,H)=>Ur(Q.data.sort)-Ur(H.data.sort)),[u]),te=d.exports.useMemo(()=>w?ie:P,[P,ie,w]);d.exports.useEffect(()=>{A&&Ee(Q=>Q!=null?Q:[...P])},[P,A]);const Ce=A?De!=null?De:P:te,Te=d.exports.useMemo(()=>{const Q=new Map;return Ce.forEach((H,Se)=>Q.set(H.uid,Se)),Q},[Ce]),Re=I&&(mt=m.current.find(Q=>Q.uid===I))!=null?mt:null,Oe=(Q,H,Se)=>{g(Me=>Ts(Me.map(Fe=>Fe.uid===Q?{...Fe,data:{...Fe.data,[H]:Se}}:Fe)))},B=(Q,H)=>{g(Se=>Ts(Se.map(Me=>Me.uid===Q?{...Me,inboundTag:H}:Me)))},V=d.exports.useCallback(async()=>{if(!A||Y)return!1;const Q=P,H=De!=null?De:Q;if(!(H.length!==Q.length||H.some((Ie,ot)=>{var gt;return Ie.uid!==((gt=Q[ot])==null?void 0:gt.uid)}))||!De||H.length===0)return me(!1),Ee(null),W(!1),!0;const Me=H.map(Ie=>Ie.uid),Fe=new Map;Me.forEach((Ie,ot)=>Fe.set(Ie,ot));const Be=m.current,ce=m.current.filter(Ie=>Fe.has(Ie.uid)).sort((Ie,ot)=>{var gt,Mt;return((gt=Fe.get(Ie.uid))!=null?gt:Number.MAX_SAFE_INTEGER)-((Mt=Fe.get(ot.uid))!=null?Mt:Number.MAX_SAFE_INTEGER)}),ge=m.current.filter(Ie=>!Fe.has(Ie.uid)).sort((Ie,ot)=>Ur(Ie.data.sort)-Ur(ot.data.sort)),We=[...ce,...ge].map((Ie,ot)=>({...Ie,data:{...Ie.data,sort:ot},original:{...Ie.original,sort:ot}}));g(We),Ee(We.filter(Ie=>!Ie.data.is_disabled)),re(!0);try{const Ie=_l(We);return await a(Ie),await l(),W(!1),me(!1),Ee(null),s({title:t("hostsPage.reorderSaved"),status:"success",isClosable:!0,position:"top"}),!0}catch{g(Be);const ot=Be.filter(gt=>!gt.data.is_disabled).sort((gt,Mt)=>Ur(gt.data.sort)-Ur(Mt.data.sort));return Ee(ot),W(!0),s({title:t("hostsPage.reorderFailed"),status:"error",isClosable:!0,position:"top"}),!1}finally{re(!1)}},[g,P,l,A,Y,a,W,t,s,De]),L=d.exports.useCallback(Q=>{if(!A||!Q.length)return;const H=De!=null?De:P;!(Q.length!==H.length||Q.some((Me,Fe)=>{var Be;return Me.uid!==((Be=H[Fe])==null?void 0:Be.uid)}))||(Ee(Q),ue.current||W(!0))},[P,A,W,De]),he=d.exports.useCallback(()=>{Ee([...P]),W(!1),me(!0)},[P,W]),ze=d.exports.useCallback(()=>{me(!1),Ee(null),W(!1)},[W]),at=d.exports.useCallback(()=>{V()},[V]),pe=async Q=>{const H=m.current.find(Se=>Se.uid===Q);if(!!H){ne(Q),Z({inboundTag:H.inboundTag,remark:H.data.remark.trim(),address:H.data.address.trim()});try{const Se=Fi(m.current,[H.inboundTag,H.initialInboundTag]);await a(Se),await l(),s({title:t("hostsPage.saved"),status:"success",isClosable:!0,position:"top"})}catch{s({title:t("hostsPage.error.save"),status:"error",isClosable:!0,position:"top"})}finally{ne(null)}}},oe=Q=>{g(H=>Ts(H.map(Se=>Se.uid===Q?{...Se,inboundTag:Se.initialInboundTag,data:ta(Se.original)}:Se)))},le=(Q,H)=>{Oe(Q,"is_disabled",!H),H||x(!0)},$=Q=>{O(Q)},ye=async()=>{if(!T)return;const Q=m.current.find(H=>H.uid===T);if(!!Q){U(T);try{const H=m.current.filter(Me=>Me.uid!==T);g(H);const Se=Fi(H,[Q.inboundTag,Q.initialInboundTag]);await a(Se),await l(),s({title:t("hostsPage.deleted"),status:"success",isClosable:!0,position:"top"}),I===T&&D(null)}catch{s({title:t("hostsPage.error.delete"),status:"error",isClosable:!0,position:"top"})}finally{U(null),O(null)}}},ut=async Q=>{const H=m.current.length?Math.max(...m.current.map(Se=>Se.data.sort))+1:0;ne("create"),Z({inboundTag:Q.inboundTag,remark:Q.remark.trim(),address:Q.address.trim()});try{const Se={uid:vl(),inboundTag:Q.inboundTag,initialInboundTag:Q.inboundTag,data:{id:null,remark:Q.remark,address:Q.address,sort:Number.isFinite(Q.sort)?Q.sort:H,port:Q.port,path:Q.path,sni:Q.sni,host:Q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1},original:{id:null,remark:Q.remark,address:Q.address,sort:Number.isFinite(Q.sort)?Q.sort:H,port:Q.port,path:Q.path,sni:Q.sni,host:Q.host,mux_enable:!1,allowinsecure:!1,is_disabled:!1,fragment_setting:"",noise_setting:"",random_user_agent:!1,security:"inbound_default",alpn:"",fingerprint:"",use_sni_as_host:!1}},Me=Ts([...m.current,Se]);g(Me);const Fe=Fi(Me,[Q.inboundTag]);await a(Fe),await l(),s({title:t("hostsPage.created"),status:"success",isClosable:!0,position:"top"}),C(!1)}catch{s({title:t("hostsPage.error.create"),status:"error",isClosable:!0,position:"top"})}finally{ne(null)}};return n(de,{align:"stretch",spacing:4,children:[A?n(de,{align:"stretch",spacing:2,children:[n(R,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[e(h,{fontWeight:"semibold",children:t("hostsPage.sortingTitle")}),n(R,{spacing:2,children:[e(F,{variant:"ghost",onClick:ze,isDisabled:Y,children:t("hostsPage.cancel")}),e(F,{colorScheme:"primary",onClick:at,isLoading:Y,isDisabled:!E&&!Y,children:t("hostsPage.saveOrder")})]})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.sortingInstructions")}),Y?n(R,{spacing:2,fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:[e(Dt,{size:"xs"}),e(h,{children:t("hostsPage.orderSaving")})]}):E?e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:t("hostsPage.orderDirty")}):null]}):n(R,{justify:"space-between",align:"center",wrap:"wrap",rowGap:2,children:[n(R,{spacing:3,children:[e(F,{colorScheme:"primary",size:"sm",onClick:()=>C(!0),leftIcon:e(wl,{}),isDisabled:!y.length,children:t("hostsPage.addHost")}),e(ht,{isChecked:w,onChange:Q=>x(Q.target.checked),children:t("hostsPage.showDisabled")})]}),e(F,{size:"sm",variant:"outline",leftIcon:e(kl,{}),onClick:he,isDisabled:o||!P.length,children:t("hostsPage.enterSort")})]}),o?e(R,{justify:"center",py:10,children:e(Dt,{})}):Ce.length===0?e(N,{border:"1px dashed",borderRadius:"md",px:6,py:10,textAlign:"center",borderColor:"gray.300",_dark:{borderColor:"gray.600"},children:e(h,{children:t("hostsPage.emptyState")})}):A?e(sl.Group,{axis:"y",values:Ce,onReorder:L,layoutScroll:!0,style:{display:"flex",flexDirection:"column",gap:"0.75rem",listStyle:"none",padding:0,margin:0},children:Ce.map((Q,H)=>e(_h,{host:Q,index:H},Q.uid))}):e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:te.map((Q,H)=>{var Se;return e(Ch,{host:Q,inboundOptions:y,orderIndex:(Se=Te.get(Q.uid))!=null?Se:H,onToggleActive:le,onEdit:D,onDelete:$,saving:z===Q.uid&&i,deleting:b===Q.uid&&i},Q.uid)})}),e(Ah,{isOpen:v,onClose:()=>C(!1),inboundOptions:y,onSubmit:ut,isSubmitting:z==="create"&&i,defaultSort:m.current.length?Math.max(...m.current.map(Q=>Q.data.sort))+1:0}),e(Dh,{host:Re,inboundOptions:y,isOpen:Boolean(Re),onClose:()=>D(null),onChange:Oe,onChangeInbound:B,onSave:pe,onReset:oe,onDelete:$,saving:!!Re&&z===Re.uid&&i,deleting:!!Re&&b===Re.uid&&i}),e(Ms,{isOpen:Boolean(T),leastDestructiveRef:J,onClose:()=>O(null),children:e(wt,{children:n(Us,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("hostsPage.deleteTitle")}),e(kt,{children:t("hostsPage.deleteConfirmation")}),n(zt,{children:[e(F,{ref:J,onClick:()=>O(null),children:t("hostsPage.cancel")}),e(F,{colorScheme:"red",onClick:ye,ml:3,isLoading:Boolean(b),children:t("hostsPage.delete")})]})]})})})]})},Th=t=>t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,""),no=t=>{if(typeof t!="string"||t.length===0)return"";try{if(typeof atob=="function")return atob(Th(t))}catch{}return""},Ph=t=>{if(typeof t!="string"||t.length===0)return"";const s=globalThis.Wireguard;if(s!=null&&s.generateKeypair)try{const r=s.generateKeypair(t);if(r&&typeof r.publicKey=="string")return r.publicKey}catch{}return""};class _r{static isEmpty(s){return s==null?!0:typeof s=="string"?s.trim().length===0:Array.isArray(s)?s.length===0:typeof s=="object"?Object.keys(s).length===0:!1}static isArrEmpty(s){return!Array.isArray(s)||s.length===0}}const ae=Object.freeze({Freedom:"freedom",Blackhole:"blackhole",DNS:"dns",VMess:"vmess",VLESS:"vless",Trojan:"trojan",Shadowsocks:"shadowsocks",Socks:"socks",HTTP:"http",Wireguard:"wireguard"}),Dl=Object.freeze({AES_256_GCM:"aes-256-gcm",AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",CHACHA20_IETF_POLY1305:"chacha20-ietf-poly1305",XCHACHA20_POLY1305:"xchacha20-poly1305",XCHACHA20_IETF_POLY1305:"xchacha20-ietf-poly1305",BLAKE3_AES_128_GCM:"2022-blake3-aes-128-gcm",BLAKE3_AES_256_GCM:"2022-blake3-aes-256-gcm",BLAKE3_CHACHA20_POLY1305:"2022-blake3-chacha20-poly1305"});Object.freeze({VISION:"xtls-rprx-vision",VISION_UDP443:"xtls-rprx-vision-udp443"});const Eh=Object.freeze({UTLS_CHROME:"chrome",UTLS_FIREFOX:"firefox",UTLS_SAFARI:"safari",UTLS_IOS:"ios",UTLS_android:"android",UTLS_EDGE:"edge",UTLS_360:"360",UTLS_QQ:"qq",UTLS_RANDOM:"random",UTLS_RANDOMIZED:"randomized",UTLS_RONDOMIZEDNOALPN:"randomizednoalpn",UTLS_UNSAFE:"unsafe"}),Nh=Object.freeze({H3:"h3",H2:"h2",HTTP1:"http/1.1"});Object.freeze(["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"]);const zh=Object.freeze(["ForceIP","ForceIPv4","ForceIPv4v6","ForceIPv6","ForceIPv6v4"]);Object.freeze({AES_128_GCM:"aes-128-gcm",CHACHA20_POLY1305:"chacha20-poly1305",AUTO:"auto",NONE:"none",ZERO:"zero"});Object.freeze({AUTO:"auto",PACKET_UP:"packet-up",STREAM_UP:"stream-up",STREAM_ONE:"stream-one"});const Hi=Object.freeze({NONE:"none",SrvPortOnly:"srvportonly",SrvAddressOnly:"srvaddressonly",SrvPortAndAddress:"srvportandaddress",TxtPortOnly:"txtportonly",TxtAddressOnly:"txtaddressonly",TxtPortAndAddress:"txtportandaddress"});class St{static toJsonArray(s){return s.map(r=>r.toJson())}static fromJson(s){return new St}toJson(){return{}}toString(s=!0){const r=this.toJson();return s?JSON.stringify(r,null,2):JSON.stringify(r)}}class dn extends St{constructor(r="none",l="",o=""){super();K(this,"type");K(this,"host");K(this,"path");this.type=r,this.host=l,this.path=o}static fromJson(r={}){var o,i,a,c,u,p,m,g,I,D;const l=r==null?void 0:r.header;if(!l)return new dn;if(l.type==="http"&&l.request){const w=((i=(o=l.request)==null?void 0:o.headers)==null?void 0:i.Host)&&Array.isArray(l.request.headers.Host)?l.request.headers.Host.join(","):(u=(c=(a=l.request)==null?void 0:a.headers)==null?void 0:c.Host)!=null?u:"",x=((p=l.request)==null?void 0:p.path)&&Array.isArray(l.request.path)?l.request.path.join(","):(g=(m=l.request)==null?void 0:m.path)!=null?g:"";return new dn((I=l.type)!=null?I:"http",w,x)}return new dn((D=l.type)!=null?D:"none","","")}toJson(){return{header:{type:this.type,request:this.type==="http"?{headers:{Host:_r.isEmpty(this.host)?[]:this.host.split(",")},path:_r.isEmpty(this.path)?["/"]:this.path.split(",")}:void 0}}}}class jn extends St{constructor(r=1350,l=50,o=5,i=20,a=!1,c=2,u=2,p="none",m=""){super();K(this,"mtu");K(this,"tti");K(this,"upCap");K(this,"downCap");K(this,"congestion");K(this,"readBuffer");K(this,"writeBuffer");K(this,"type");K(this,"seed");this.mtu=r!=null?r:1350,this.tti=l!=null?l:50,this.upCap=o!=null?o:5,this.downCap=i!=null?i:20,this.congestion=Boolean(a),this.readBuffer=c!=null?c:2,this.writeBuffer=u!=null?u:2,this.type=p!=null?p:"none",this.seed=m!=null?m:""}static fromJson(r={}){var l,o,i;return new jn(r==null?void 0:r.mtu,r==null?void 0:r.tti,r==null?void 0:r.uplinkCapacity,r==null?void 0:r.downlinkCapacity,r==null?void 0:r.congestion,r==null?void 0:r.readBufferSize,r==null?void 0:r.writeBufferSize,(o=(l=r==null?void 0:r.header)==null?void 0:l.type)!=null?o:"none",(i=r==null?void 0:r.seed)!=null?i:"")}toJson(){return{mtu:this.mtu,tti:this.tti,uplinkCapacity:this.upCap,downlinkCapacity:this.downCap,congestion:this.congestion,readBufferSize:this.readBuffer,writeBufferSize:this.writeBuffer,header:{type:this.type},seed:this.seed}}}class Nn extends St{constructor(r="/",l="",o=0){super();K(this,"path");K(this,"host");K(this,"heartbeatPeriod");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.heartbeatPeriod=o!=null?o:0}static fromJson(r={}){var l,o,i;return new Nn((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.heartbeatPeriod)!=null?i:0)}toJson(){return{path:this.path,host:this.host,heartbeatPeriod:this.heartbeatPeriod}}}class zn extends St{constructor(r="",l="",o=!1){super();K(this,"serviceName");K(this,"authority");K(this,"multiMode");this.serviceName=r!=null?r:"",this.authority=l!=null?l:"",this.multiMode=Boolean(o)}static fromJson(r={}){var l,o;return new zn((l=r==null?void 0:r.serviceName)!=null?l:"",(o=r==null?void 0:r.authority)!=null?o:"",Boolean(r==null?void 0:r.multiMode))}toJson(){return{serviceName:this.serviceName,authority:this.authority,multiMode:this.multiMode}}}class es extends St{constructor(r="/",l=""){super();K(this,"path");K(this,"host");this.path=r!=null?r:"/",this.host=l!=null?l:""}static fromJson(r={}){var l,o;return new es((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"")}toJson(){return{path:this.path,host:this.host}}}class ts extends St{constructor(r="/",l="",o="",i=!1,a="30",c={maxConcurrency:"16-32",maxConnections:0,cMaxReuseTimes:0,hMaxRequestTimes:"600-900",hMaxReusableSecs:"1800-3000",hKeepAlivePeriod:0}){var u,p,m,g,I,D;super();K(this,"path");K(this,"host");K(this,"mode");K(this,"noGRPCHeader");K(this,"scMinPostsIntervalMs");K(this,"xmux");this.path=r!=null?r:"/",this.host=l!=null?l:"",this.mode=o!=null?o:"",this.noGRPCHeader=Boolean(i),this.scMinPostsIntervalMs=a!=null?a:"30",this.xmux={maxConcurrency:(u=c==null?void 0:c.maxConcurrency)!=null?u:"16-32",maxConnections:(p=c==null?void 0:c.maxConnections)!=null?p:0,cMaxReuseTimes:(m=c==null?void 0:c.cMaxReuseTimes)!=null?m:0,hMaxRequestTimes:(g=c==null?void 0:c.hMaxRequestTimes)!=null?g:"600-900",hMaxReusableSecs:(I=c==null?void 0:c.hMaxReusableSecs)!=null?I:"1800-3000",hKeepAlivePeriod:(D=c==null?void 0:c.hKeepAlivePeriod)!=null?D:0}}static fromJson(r={}){var l,o,i,a;return new ts((l=r==null?void 0:r.path)!=null?l:"/",(o=r==null?void 0:r.host)!=null?o:"",(i=r==null?void 0:r.mode)!=null?i:"",Boolean(r==null?void 0:r.noGRPCHeader),(a=r==null?void 0:r.scMinPostsIntervalMs)!=null?a:"30",r==null?void 0:r.xmux)}toJson(){return{path:this.path,host:this.host,mode:this.mode,noGRPCHeader:this.noGRPCHeader,scMinPostsIntervalMs:this.scMinPostsIntervalMs,xmux:{maxConcurrency:this.xmux.maxConcurrency,maxConnections:this.xmux.maxConnections,cMaxReuseTimes:this.xmux.cMaxReuseTimes,hMaxRequestTimes:this.xmux.hMaxRequestTimes,hMaxReusableSecs:this.xmux.hMaxReusableSecs,hKeepAlivePeriod:this.xmux.hKeepAlivePeriod}}}}class Rn extends St{constructor(r="",l=[],o="",i=!1,a=""){super();K(this,"serverName");K(this,"alpn");K(this,"fingerprint");K(this,"allowInsecure");K(this,"echConfigList");this.serverName=r!=null?r:"",this.alpn=l!=null?l:[],this.fingerprint=o!=null?o:"",this.allowInsecure=Boolean(i),this.echConfigList=a!=null?a:""}static fromJson(r={}){var l,o,i;return new Rn((l=r==null?void 0:r.serverName)!=null?l:"",Array.isArray(r==null?void 0:r.alpn)?r.alpn:[],(o=r==null?void 0:r.fingerprint)!=null?o:"",Boolean(r==null?void 0:r.allowInsecure),(i=r==null?void 0:r.echConfigList)!=null?i:"")}toJson(){var r;return{serverName:this.serverName||void 0,alpn:(r=this.alpn)!=null&&r.length?this.alpn:void 0,fingerprint:this.fingerprint||void 0,allowInsecure:this.allowInsecure,echConfigList:this.echConfigList||void 0}}}class rs extends St{constructor(r="",l="",o="",i="",a="",c=""){super();K(this,"publicKey");K(this,"fingerprint");K(this,"serverName");K(this,"shortId");K(this,"spiderX");K(this,"mldsa65Verify");this.publicKey=r!=null?r:"",this.fingerprint=l!=null?l:"",this.serverName=o!=null?o:"",this.shortId=i!=null?i:"",this.spiderX=a!=null?a:"",this.mldsa65Verify=c!=null?c:""}static fromJson(r={}){var l,o,i,a,c,u;return new rs((l=r==null?void 0:r.publicKey)!=null?l:"",(o=r==null?void 0:r.fingerprint)!=null?o:"",(i=r==null?void 0:r.serverName)!=null?i:"",(a=r==null?void 0:r.shortId)!=null?a:"",(c=r==null?void 0:r.spiderX)!=null?c:"",(u=r==null?void 0:r.mldsa65Verify)!=null?u:"")}toJson(){return{publicKey:this.publicKey||void 0,fingerprint:this.fingerprint||void 0,serverName:this.serverName||void 0,shortId:this.shortId||void 0,spiderX:this.spiderX||void 0,mldsa65Verify:this.mldsa65Verify||void 0}}}class Os extends St{constructor(r="",l=!1,o=0,i=!1,a=!1,c=Hi.NONE){super();K(this,"dialerProxy");K(this,"tcpFastOpen");K(this,"tcpKeepAliveInterval");K(this,"tcpMptcp");K(this,"penetrate");K(this,"addressPortStrategy");this.dialerProxy=r!=null?r:"",this.tcpFastOpen=Boolean(l),this.tcpKeepAliveInterval=o!=null?o:0,this.tcpMptcp=Boolean(i),this.penetrate=Boolean(a),this.addressPortStrategy=c!=null?c:Hi.NONE}static fromJson(r={}){var l,o,i;return!r||Object.keys(r).length===0?new Os:new Os((l=r==null?void 0:r.dialerProxy)!=null?l:"",Boolean(r==null?void 0:r.tcpFastOpen),(o=r==null?void 0:r.tcpKeepAliveInterval)!=null?o:0,Boolean(r==null?void 0:r.tcpMptcp),Boolean(r==null?void 0:r.penetrate),(i=r==null?void 0:r.addressPortStrategy)!=null?i:Hi.NONE)}toJson(){return{dialerProxy:this.dialerProxy||void 0,tcpFastOpen:this.tcpFastOpen,tcpKeepAliveInterval:this.tcpKeepAliveInterval||void 0,tcpMptcp:this.tcpMptcp,penetrate:this.penetrate,addressPortStrategy:this.addressPortStrategy}}}class bn extends St{constructor(r="tcp",l="none",o=new Rn,i=new rs,a=new dn,c=new jn,u=new Nn,p=new zn,m=new es,g=new ts,I){super();K(this,"network");K(this,"security");K(this,"tls");K(this,"reality");K(this,"tcp");K(this,"kcp");K(this,"ws");K(this,"grpc");K(this,"httpupgrade");K(this,"xhttp");K(this,"sockopt");this.network=r!=null?r:"tcp",this.security=l!=null?l:"none",this.tls=o,this.reality=i,this.tcp=a,this.kcp=c,this.ws=u,this.grpc=p,this.httpupgrade=m,this.xhttp=g,this.sockopt=I}get isTls(){return this.security==="tls"}get isReality(){return this.security==="reality"}get sockoptSwitch(){return this.sockopt!==void 0}set sockoptSwitch(r){this.sockopt=r?new Os:void 0}static fromJson(r={}){var l,o;return new bn((l=r==null?void 0:r.network)!=null?l:"tcp",(o=r==null?void 0:r.security)!=null?o:"none",Rn.fromJson(r==null?void 0:r.tlsSettings),rs.fromJson(r==null?void 0:r.realitySettings),dn.fromJson(r==null?void 0:r.tcpSettings),jn.fromJson(r==null?void 0:r.kcpSettings),Nn.fromJson(r==null?void 0:r.wsSettings),zn.fromJson(r==null?void 0:r.grpcSettings),es.fromJson(r==null?void 0:r.httpupgradeSettings),ts.fromJson(r==null?void 0:r.xhttpSettings),Os.fromJson(r==null?void 0:r.sockopt))}toJson(){const r=this.network;return{network:r,security:this.security,tlsSettings:this.security==="tls"?this.tls.toJson():void 0,realitySettings:this.security==="reality"?this.reality.toJson():void 0,tcpSettings:r==="tcp"?this.tcp.toJson():void 0,kcpSettings:r==="kcp"?this.kcp.toJson():void 0,wsSettings:r==="ws"?this.ws.toJson():void 0,grpcSettings:r==="grpc"?this.grpc.toJson():void 0,httpupgradeSettings:r==="httpupgrade"?this.httpupgrade.toJson():void 0,xhttpSettings:r==="xhttp"?this.xhttp.toJson():void 0,sockopt:this.sockopt?this.sockopt.toJson():void 0}}}class Ws extends St{constructor(r=!1,l=8,o=16,i="reject"){super();K(this,"enabled");K(this,"concurrency");K(this,"xudpConcurrency");K(this,"xudpProxyUDP443");this.enabled=Boolean(r),this.concurrency=l!=null?l:8,this.xudpConcurrency=o!=null?o:16,this.xudpProxyUDP443=i!=null?i:"reject"}static fromJson(r={}){return!r||Object.keys(r).length===0?new Ws:new Ws(r==null?void 0:r.enabled,r==null?void 0:r.concurrency,r==null?void 0:r.xudpConcurrency,r==null?void 0:r.xudpProxyUDP443)}toJson(){return{enabled:this.enabled,concurrency:this.concurrency,xudpConcurrency:this.xudpConcurrency,xudpProxyUDP443:this.xudpProxyUDP443}}}var ln,Vr;const Ye=class extends St{constructor(r="",l=ae.VLESS,o=Ye.Settings.getSettings(ae.VLESS),i=new bn,a,c=new Ws){super();K(this,"tag");K(this,"_protocol");K(this,"settings");K(this,"stream");K(this,"sendThrough");K(this,"mux");this.tag=r!=null?r:"",this._protocol=l!=null?l:ae.VLESS,this.settings=o!=null?o:Ye.Settings.getSettings(this._protocol),this.stream=i,this.sendThrough=a,this.mux=c}get protocol(){return this._protocol}set protocol(r){this._protocol=r,this.settings=Ye.Settings.getSettings(r),this.stream=new bn}canEnableTls(){return[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks].includes(this.protocol)?["tcp","ws","http","grpc","httpupgrade","xhttp"].includes(this.stream.network):!1}canEnableTlsFlow(){return this.stream.security!=="none"&&this.stream.network==="tcp"?this.protocol===ae.VLESS:!1}canEnableReality(){return[ae.VLESS,ae.Trojan].includes(this.protocol)?["tcp","http","grpc","xhttp"].includes(this.stream.network):!1}canEnableStream(){return[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks].includes(this.protocol)}canEnableMux(){if(this.settings&&typeof this.settings=="object"&&"flow"in this.settings){const r=this.settings.flow;if(r&&r.length>0)return this.mux&&(this.mux.enabled=!1),!1}return this.stream.network==="xhttp"?(this.mux&&(this.mux.enabled=!1),!1):[ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks,ae.HTTP,ae.Socks].includes(this.protocol)}hasVnext(){return[ae.VMess,ae.VLESS].includes(this.protocol)}hasServers(){return[ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP].includes(this.protocol)}hasAddressPort(){return[ae.DNS,ae.VMess,ae.VLESS,ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP].includes(this.protocol)}hasUsername(){return[ae.Socks,ae.HTTP].includes(this.protocol)}static fromJson(r={}){var l,o,i,a;return new Ye((l=r==null?void 0:r.tag)!=null?l:"",(o=r==null?void 0:r.protocol)!=null?o:ae.VLESS,Ye.Settings.fromProtocol((i=r==null?void 0:r.protocol)!=null?i:ae.VLESS,r==null?void 0:r.settings),bn.fromJson(r==null?void 0:r.streamSettings),(a=r==null?void 0:r.sendThrough)!=null?a:"",Ws.fromJson(r==null?void 0:r.mux))}toJson(){var l,o;let r;return this.canEnableStream()?r=this.stream.toJson():(l=this.stream)!=null&&l.sockopt&&(r={sockopt:this.stream.sockopt.toJson()}),{tag:this.tag||void 0,protocol:this.protocol,settings:this.settings instanceof St?this.settings.toJson():this.settings,streamSettings:r,sendThrough:this.sendThrough||void 0,mux:(o=this.mux)!=null&&o.enabled?this.mux.toJson():void 0}}static fromLink(r){if(!r||typeof r!="string")return null;const l=r.split("://");if(l.length!==2)return null;const o=l[0].toLowerCase();try{switch(o){case ae.VMess:return Ye.fromVmessLink(JSON.parse(no(l[1])));case ae.VLESS:case ae.Trojan:case"ss":return Ye.fromParamLink(r);default:return null}}catch{return null}}static fromVmessLink(r={}){var a,c,u,p,m,g,I,D,w,x,v,C,z,ne,b,U,T,O,ve,Z,J,E,q;if(!r)return null;const l=new bn((a=r==null?void 0:r.net)!=null?a:"tcp",(c=r==null?void 0:r.tls)!=null?c:"none"),o=r==null?void 0:r.net;o==="tcp"?l.tcp=new dn((u=r==null?void 0:r.type)!=null?u:"none",(p=r==null?void 0:r.host)!=null?p:"",(m=r==null?void 0:r.path)!=null?m:""):o==="kcp"?(l.kcp=new jn,l.kcp.type=(g=r==null?void 0:r.type)!=null?g:"none",l.kcp.seed=(I=r==null?void 0:r.path)!=null?I:""):o==="ws"?l.ws=new Nn((D=r==null?void 0:r.path)!=null?D:"/",(w=r==null?void 0:r.host)!=null?w:""):o==="grpc"?l.grpc=new zn((x=r==null?void 0:r.path)!=null?x:"",(v=r==null?void 0:r.authority)!=null?v:"",(r==null?void 0:r.type)==="multi"):o==="httpupgrade"?l.httpupgrade=new es((C=r==null?void 0:r.path)!=null?C:"/",(z=r==null?void 0:r.host)!=null?z:""):o==="xhttp"&&(l.xhttp=new ts((ne=r==null?void 0:r.path)!=null?ne:"/",(b=r==null?void 0:r.host)!=null?b:"",(U=r==null?void 0:r.mode)!=null?U:"")),(r==null?void 0:r.tls)==="tls"&&(l.security="tls",l.tls=new Rn((T=r==null?void 0:r.sni)!=null?T:"",r!=null&&r.alpn?String(r.alpn).split(","):[],(O=r==null?void 0:r.fp)!=null?O:"",Boolean(r==null?void 0:r.allowInsecure)));const i=Number((ve=r==null?void 0:r.port)!=null?ve:0);return Number.isNaN(i)?null:new Ye((Z=r==null?void 0:r.ps)!=null?Z:"",ae.VMess,new Ye.VmessSettings((J=r==null?void 0:r.add)!=null?J:"",i,(E=r==null?void 0:r.id)!=null?E:"",(q=r==null?void 0:r.scy)!=null?q:""),l)}static fromParamLink(r){var U,T,O,ve,Z,J,E,q,ue,Y,re,A,me,De,Ee,W,y,P,ie,te,Ce;let l;try{l=new URL(r)}catch{return null}const o=(U=l.searchParams.get("type"))!=null?U:"tcp",i=(T=l.searchParams.get("security"))!=null?T:"none",a=new bn(o,i),c=(O=l.searchParams.get("headerType"))!=null?O:void 0,u=(ve=l.searchParams.get("host"))!=null?ve:void 0,p=(Z=l.searchParams.get("path"))!=null?Z:void 0,m=(J=l.searchParams.get("mode"))!=null?J:void 0;if(o==="tcp"||o==="none"?a.tcp=new dn(c!=null?c:"none",u!=null?u:"",p!=null?p:""):o==="kcp"?(a.kcp=new jn,a.kcp.type=c!=null?c:"none",a.kcp.seed=p!=null?p:""):o==="ws"?a.ws=new Nn(p!=null?p:"/",u!=null?u:""):o==="grpc"?a.grpc=new zn((E=l.searchParams.get("serviceName"))!=null?E:"",(q=l.searchParams.get("authority"))!=null?q:"",l.searchParams.get("mode")==="multi"):o==="httpupgrade"?a.httpupgrade=new es(p!=null?p:"/",u!=null?u:""):o==="xhttp"&&(a.xhttp=new ts(p!=null?p:"/",u!=null?u:"",m!=null?m:"")),i==="tls"){const Te=(ue=l.searchParams.get("fp"))!=null?ue:"none",Re=l.searchParams.get("alpn"),Oe=l.searchParams.get("allowInsecure"),B=(Y=l.searchParams.get("sni"))!=null?Y:"",V=(re=l.searchParams.get("ech"))!=null?re:"";a.tls=new Rn(B,Re?Re.split(","):[],Te,Oe==="1",V)}if(i==="reality"){const Te=(A=l.searchParams.get("pbk"))!=null?A:"",Re=(me=l.searchParams.get("fp"))!=null?me:"",Oe=(De=l.searchParams.get("sni"))!=null?De:"",B=(Ee=l.searchParams.get("sid"))!=null?Ee:"",V=(W=l.searchParams.get("spx"))!=null?W:"",L=(y=l.searchParams.get("pqv"))!=null?y:"";a.reality=new rs(Te,Re,Oe,B,V,L)}const g=/([^@]+):\/\/([^@]+)@(.+):(\d+)(.*)$/,I=r.match(g);if(!I)return null;let[,D,w,x,v]=I,C=Number(v);Number.isNaN(C)&&(C=0),D==="ss"&&(D=ae.Shadowsocks,w=no(w));let z=null;switch(D){case ae.VLESS:{const Te=(P=l.searchParams.get("encryption"))!=null?P:"none";z=new Ye.VLESSSettings(x,C,w,(ie=l.searchParams.get("flow"))!=null?ie:"",Te);break}case ae.Trojan:z=new Ye.TrojanSettings(x,C,w);break;case ae.Shadowsocks:{const Te=w.split(":"),Re=(te=Te.shift())!=null?te:"";z=new Ye.ShadowsocksSettings(x,C,Te.join(":"),Re,!0);break}default:return null}const ne=decodeURIComponent((Ce=l.hash)!=null?Ce:""),b=ne.length>1?ne.substring(1):`out-${D}-${C}`;return new Ye(b,D,z,a)}};let qt=Ye;K(qt,"Settings",class extends St{constructor(o){super();K(this,"protocol");this.protocol=o}static getSettings(o){switch(o){case ae.Freedom:return new Ye.FreedomSettings;case ae.Blackhole:return new Ye.BlackholeSettings;case ae.DNS:return new Ye.DNSSettings;case ae.VMess:return new Ye.VmessSettings;case ae.VLESS:return new Ye.VLESSSettings;case ae.Trojan:return new Ye.TrojanSettings;case ae.Shadowsocks:return new Ye.ShadowsocksSettings;case ae.Socks:return new Ye.SocksSettings;case ae.HTTP:return new Ye.HttpSettings;case ae.Wireguard:return new Ye.WireguardSettings;default:return null}}static fromProtocol(o,i){switch(o){case ae.Freedom:return Ye.FreedomSettings.fromJson(i);case ae.Blackhole:return Ye.BlackholeSettings.fromJson(i);case ae.DNS:return Ye.DNSSettings.fromJson(i);case ae.VMess:return Ye.VmessSettings.fromJson(i);case ae.VLESS:return Ye.VLESSSettings.fromJson(i);case ae.Trojan:return Ye.TrojanSettings.fromJson(i);case ae.Shadowsocks:return Ye.ShadowsocksSettings.fromJson(i);case ae.Socks:return Ye.SocksSettings.fromJson(i);case ae.HTTP:return Ye.HttpSettings.fromJson(i);case ae.Wireguard:return Ye.WireguardSettings.fromJson(i);default:return null}}toJson(){return{}}}),K(qt,"FreedomSettings",(ln=class extends St{constructor(o="",i="",a={},c=[]){super();K(this,"domainStrategy");K(this,"redirect");K(this,"fragment");K(this,"noises");this.domainStrategy=o!=null?o:"",this.redirect=i!=null?i:"",this.fragment=a!=null?a:{},this.noises=c!=null?c:[]}addNoise(){this.noises.push(new Ye.FreedomSettings.Noise)}delNoise(o){this.noises.splice(o,1)}static fromJson(o={}){var i,a;return new ln((i=o==null?void 0:o.domainStrategy)!=null?i:"",(a=o==null?void 0:o.redirect)!=null?a:"",o!=null&&o.fragment?ln.Fragment.fromJson(o.fragment):{},Array.isArray(o==null?void 0:o.noises)?o.noises.map(c=>ln.Noise.fromJson(c)):[])}toJson(){return{domainStrategy:_r.isEmpty(this.domainStrategy)?void 0:this.domainStrategy,redirect:_r.isEmpty(this.redirect)?void 0:this.redirect,fragment:Object.keys(this.fragment).length===0?void 0:this.fragment,noises:this.noises.length===0?void 0:St.toJsonArray(this.noises)}}},K(ln,"Fragment",class Al extends St{constructor(a="1-3",c="",u="",p=""){super();K(this,"packets");K(this,"length");K(this,"interval");K(this,"maxSplit");this.packets=a!=null?a:"1-3",this.length=c!=null?c:"",this.interval=u!=null?u:"",this.maxSplit=p!=null?p:""}static fromJson(a={}){var c,u,p,m;return new Al((c=a==null?void 0:a.packets)!=null?c:"1-3",(u=a==null?void 0:a.length)!=null?u:"",(p=a==null?void 0:a.interval)!=null?p:"",(m=a==null?void 0:a.maxSplit)!=null?m:"")}}),K(ln,"Noise",class Il extends St{constructor(a="rand",c="10-20",u="10-16",p="ip"){super();K(this,"type");K(this,"packet");K(this,"delay");K(this,"applyTo");this.type=a!=null?a:"rand",this.packet=c!=null?c:"10-20",this.delay=u!=null?u:"10-16",this.applyTo=p!=null?p:"ip"}static fromJson(a={}){var c,u,p,m;return new Il((c=a==null?void 0:a.type)!=null?c:"rand",(u=a==null?void 0:a.packet)!=null?u:"10-20",(p=a==null?void 0:a.delay)!=null?p:"10-16",(m=a==null?void 0:a.applyTo)!=null?m:"ip")}toJson(){return{type:this.type,packet:this.packet,delay:this.delay,applyTo:this.applyTo}}}),ln)),K(qt,"BlackholeSettings",class Tl extends St{constructor(o){super();K(this,"type");this.type=o}static fromJson(o={}){var i;return new Tl((i=o==null?void 0:o.response)==null?void 0:i.type)}toJson(){return{response:_r.isEmpty(this.type)?void 0:{type:this.type}}}}),K(qt,"DNSSettings",class Pl extends St{constructor(o="udp",i="",a=53,c="reject",u=[]){super();K(this,"network");K(this,"address");K(this,"port");K(this,"nonIPQuery");K(this,"blockTypes");this.network=o!=null?o:"udp",this.address=i!=null?i:"",this.port=a!=null?a:53,this.nonIPQuery=c!=null?c:"reject",this.blockTypes=u!=null?u:[]}static fromJson(o={}){var i,a,c,u;return new Pl((i=o==null?void 0:o.network)!=null?i:"udp",(a=o==null?void 0:o.address)!=null?a:"",(c=o==null?void 0:o.port)!=null?c:53,(u=o==null?void 0:o.nonIPQuery)!=null?u:"reject",Array.isArray(o==null?void 0:o.blockTypes)?o.blockTypes:[])}}),K(qt,"VmessSettings",class extends St{constructor(o="",i=0,a="",c=""){super();K(this,"address");K(this,"port");K(this,"id");K(this,"security");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.security=c!=null?c:""}static fromJson(o={}){var c,u,p,m;if(_r.isArrEmpty(o==null?void 0:o.vnext))return new Ye.VmessSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Ye.VmessSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=a==null?void 0:a.id)!=null?p:"",(m=a==null?void 0:a.security)!=null?m:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,security:this.security}]}]}}}),K(qt,"VLESSSettings",class extends St{constructor(o="",i=0,a="",c="",u=""){super();K(this,"address");K(this,"port");K(this,"id");K(this,"flow");K(this,"encryption");this.address=o!=null?o:"",this.port=i!=null?i:0,this.id=a!=null?a:"",this.flow=c!=null?c:"",this.encryption=u!=null?u:""}static fromJson(o={}){var c,u,p,m,g;if(_r.isArrEmpty(o==null?void 0:o.vnext))return new Ye.VLESSSettings;const i=o.vnext[0],a=Array.isArray(i==null?void 0:i.users)&&i.users[0]?i.users[0]:{};return new Ye.VLESSSettings((c=i==null?void 0:i.address)!=null?c:"",(u=i==null?void 0:i.port)!=null?u:0,(p=a==null?void 0:a.id)!=null?p:"",(m=a==null?void 0:a.flow)!=null?m:"",(g=a==null?void 0:a.encryption)!=null?g:"")}toJson(){return{vnext:[{address:this.address,port:this.port,users:[{id:this.id,flow:this.flow,encryption:this.encryption}]}]}}}),K(qt,"TrojanSettings",class extends St{constructor(o="",i=0,a=""){super();K(this,"address");K(this,"port");K(this,"password");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:""}static fromJson(o={}){var a,c,u;if(_r.isArrEmpty(o==null?void 0:o.servers))return new Ye.TrojanSettings;const i=o.servers[0];return new Ye.TrojanSettings((a=i==null?void 0:i.address)!=null?a:"",(c=i==null?void 0:i.port)!=null?c:0,(u=i==null?void 0:i.password)!=null?u:"")}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password}]}}}),K(qt,"ShadowsocksSettings",class extends St{constructor(o="",i=0,a="",c="",u,p){super();K(this,"address");K(this,"port");K(this,"password");K(this,"method");K(this,"uot");K(this,"UoTVersion");this.address=o!=null?o:"",this.port=i!=null?i:0,this.password=a!=null?a:"",this.method=c!=null?c:"",this.uot=u,this.UoTVersion=p}static fromJson(o={}){var c,u,p,m;let i=o==null?void 0:o.servers;_r.isArrEmpty(i)&&(i=[{}]);const a=i[0];return new Ye.ShadowsocksSettings((c=a==null?void 0:a.address)!=null?c:"",(u=a==null?void 0:a.port)!=null?u:0,(p=a==null?void 0:a.password)!=null?p:"",(m=a==null?void 0:a.method)!=null?m:"",a==null?void 0:a.uot,a==null?void 0:a.UoTVersion)}toJson(){return{servers:[{address:this.address,port:this.port,password:this.password,method:this.method,uot:this.uot,UoTVersion:this.UoTVersion}]}}}),K(qt,"SocksSettings",class extends St{constructor(o="",i=0,a="",c=""){super();K(this,"address");K(this,"port");K(this,"user");K(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,m,g;let i=o==null?void 0:o.servers;_r.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Ye.SocksSettings((u=a==null?void 0:a.address)!=null?u:"",(p=a==null?void 0:a.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:_r.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),K(qt,"HttpSettings",class extends St{constructor(o="",i=0,a="",c=""){super();K(this,"address");K(this,"port");K(this,"user");K(this,"pass");this.address=o!=null?o:"",this.port=i!=null?i:0,this.user=a!=null?a:"",this.pass=c!=null?c:""}static fromJson(o={}){var u,p,m,g;let i=o==null?void 0:o.servers;_r.isArrEmpty(i)&&(i=[{users:[{}]}]);const a=i[0],c=Array.isArray(a==null?void 0:a.users)&&a.users[0]?a.users[0]:{};return new Ye.HttpSettings((u=a==null?void 0:a.address)!=null?u:"",(p=a==null?void 0:a.port)!=null?p:0,(m=c==null?void 0:c.user)!=null?m:"",(g=c==null?void 0:c.pass)!=null?g:"")}toJson(){return{servers:[{address:this.address,port:this.port,users:_r.isEmpty(this.user)?[]:[{user:this.user,pass:this.pass}]}]}}}),K(qt,"WireguardSettings",(Vr=class extends St{constructor(o=1420,i="",a=[""],c=2,u="",p="",m=[new Vr.Peer],g=!1){super();K(this,"mtu");K(this,"secretKey");K(this,"pubKey");K(this,"address");K(this,"workers");K(this,"domainStrategy");K(this,"reserved");K(this,"peers");K(this,"noKernelTun");this.mtu=o!=null?o:1420,this.secretKey=i!=null?i:"",this.pubKey=this.secretKey.length>0?Ph(this.secretKey):"",this.address=Array.isArray(a)?a.join(","):a!=null?a:"",this.workers=c!=null?c:2,this.domainStrategy=u!=null?u:"",this.reserved=Array.isArray(p)?p.join(","):p!=null?p:"",this.peers=m!=null?m:[new Vr.Peer],this.noKernelTun=Boolean(g)}addPeer(){this.peers.push(new Vr.Peer)}delPeer(o){this.peers.splice(o,1)}static fromJson(o={}){var i,a,c,u,p,m,g;return new Vr((i=o==null?void 0:o.mtu)!=null?i:1420,(a=o==null?void 0:o.secretKey)!=null?a:"",(c=o==null?void 0:o.address)!=null?c:[""],(u=o==null?void 0:o.workers)!=null?u:2,(p=o==null?void 0:o.domainStrategy)!=null?p:"",(m=o==null?void 0:o.reserved)!=null?m:"",Array.isArray(o==null?void 0:o.peers)?o.peers.map(I=>Vr.Peer.fromJson(I)):[new Vr.Peer],(g=o==null?void 0:o.noKernelTun)!=null?g:!1)}toJson(){return{mtu:this.mtu||void 0,secretKey:this.secretKey,address:this.address?this.address.split(","):[],workers:this.workers||void 0,domainStrategy:zh.includes(this.domainStrategy)?this.domainStrategy:void 0,reserved:this.reserved?this.reserved.split(",").map(o=>Number(o)).filter(o=>!Number.isNaN(o)):void 0,peers:St.toJsonArray(this.peers),noKernelTun:this.noKernelTun}}},K(Vr,"Peer",class extends St{constructor(a="",c="",u=["0.0.0.0/0","::/0"],p="",m=0){super();K(this,"publicKey");K(this,"psk");K(this,"allowedIPs");K(this,"endpoint");K(this,"keepAlive");this.publicKey=a!=null?a:"",this.psk=c!=null?c:"",this.allowedIPs=u!=null?u:["0.0.0.0/0","::/0"],this.endpoint=p!=null?p:"",this.keepAlive=m!=null?m:0}static fromJson(a={}){var c,u,p,m;return new Ye.WireguardSettings.Peer((c=a==null?void 0:a.publicKey)!=null?c:"",(u=a==null?void 0:a.preSharedKey)!=null?u:"",Array.isArray(a==null?void 0:a.allowedIPs)?a.allowedIPs:["0.0.0.0/0","::/0"],(p=a==null?void 0:a.endpoint)!=null?p:"",(m=a==null?void 0:a.keepAlive)!=null?m:0)}toJson(){var a;return{publicKey:this.publicKey,preSharedKey:this.psk.length>0?this.psk:void 0,allowedIPs:(a=this.allowedIPs)!=null&&a.length?this.allowedIPs:void 0,endpoint:this.endpoint,keepAlive:this.keepAlive||void 0}}}),Vr));class Dn{static sizeFormat(s){if(s<=0||Number.isNaN(s))return"0 B";const r=["B","KB","MB","GB","TB","PB"];let l=0,o=s;for(;o>=1024&&l<r.length-1;)o/=1024,l++;return`${o.toFixed(2)} ${r[l]}`}}const Rh=[{value:"http",label:"HTTP"},{value:"tls",label:"TLS"},{value:"quic",label:"QUIC"},{value:"fakedns",label:"FakeDNS"}];Object.values(Nh);const Mh=Object.values(Eh),Sa=["vmess","vless","trojan","shadowsocks","http","socks"],Uh=["tcp","ws","grpc","kcp","quic","httpupgrade","splithttp","xhttp"],Lh=["none","tls","reality"],Bi=t=>t.split(/[\n,]/).map(s=>s.trim()).filter(Boolean),Vi=t=>t&&t.length?t.join(`
`):"",Hn=t=>typeof t=="number"&&Number.isFinite(t)?String(t):typeof t=="string"?t:"",El=()=>({acceptProxyProtocol:!1,tcpFastOpen:!1,mark:"",tproxy:"off",tcpMptcp:!1,penetrate:!1,domainStrategy:"",tcpMaxSeg:"",dialerProxy:"",tcpKeepAliveInterval:"",tcpKeepAliveIdle:"",tcpUserTimeout:"",tcpcongestion:"",V6Only:!1,tcpWindowClamp:"",interfaceName:""}),Oh=t=>{if(!t)return 0;const s=Number(t);return!Number.isNaN(s)&&s>0?s:t.trim()},Sr=t=>(Object.keys(t).forEach(s=>{const r=t[s];(r==null||typeof r=="string"&&r.trim()===""||Array.isArray(r)&&r.length===0)&&delete t[s]}),t),so=()=>({user:"",pass:""}),ra=()=>({name:"",value:""}),io=t=>{var s,r;return{user:(s=t==null?void 0:t.user)!=null?s:"",pass:(r=t==null?void 0:t.pass)!=null?r:""}},ao=t=>{var s,r;return Sr({user:(s=t.user)==null?void 0:s.trim(),pass:(r=t.pass)==null?void 0:r.trim()})},Cn=t=>{if(t===""||t===null||typeof t>"u")return;const s=Number(t);return Number.isFinite(s)?s:void 0},Wh=t=>{if(!t.sockoptEnabled)return;const s=t.sockopt,r={acceptProxyProtocol:s.acceptProxyProtocol,tcpFastOpen:s.tcpFastOpen,mark:Cn(s.mark),tproxy:s.tproxy||void 0,tcpMptcp:s.tcpMptcp,penetrate:s.penetrate,domainStrategy:s.domainStrategy||void 0,tcpMaxSeg:Cn(s.tcpMaxSeg),dialerProxy:s.dialerProxy||void 0,tcpKeepAliveInterval:Cn(s.tcpKeepAliveInterval),tcpKeepAliveIdle:Cn(s.tcpKeepAliveIdle),tcpUserTimeout:Cn(s.tcpUserTimeout),tcpcongestion:s.tcpcongestion||void 0,V6Only:s.V6Only,tcpWindowClamp:Cn(s.tcpWindowClamp),interface:s.interfaceName||void 0};return Sr(r)},na=(t="vless")=>({tag:"",listen:"",port:"",protocol:t,disableInsecureEncryption:!0,vlessDecryption:"none",vlessEncryption:"",fallbacks:[],shadowsocksNetwork:"tcp,udp",sniffingEnabled:!0,sniffingDestinations:["http","tls"],sniffingRouteOnly:!1,sniffingMetadataOnly:!1,streamNetwork:"tcp",streamSecurity:"tls",tlsServerName:"",tlsAlpn:[],tlsAllowInsecure:!1,tlsFingerprint:"",tlsRawSettings:{},realityPrivateKey:"",realityServerNames:"",realityShortIds:"",realityDest:"",realitySpiderX:"",realityXver:"0",wsPath:"/",wsHost:"",tcpHeaderType:"none",tcpHttpHosts:"",tcpHttpPath:"/",grpcServiceName:"",grpcAuthority:"",grpcMultiMode:!1,kcpHeaderType:"none",kcpSeed:"",quicSecurity:"",quicKey:"",quicHeaderType:"none",httpupgradePath:"/",httpupgradeHost:"",splithttpPath:"/",splithttpHost:"",xhttpHost:"",xhttpPath:"/",xhttpHeaders:[ra()],xhttpMode:"auto",xhttpScMaxBufferedPosts:"30",xhttpScMaxEachPostBytes:"1000000",xhttpScStreamUpServerSecs:"20-80",xhttpPaddingBytes:"100-1000",xhttpNoSSEHeader:!1,vlessSelectedAuth:"",sockoptEnabled:!1,sockopt:El(),httpAccounts:[so()],httpAllowTransparent:!1,socksAuth:"noauth",socksAccounts:[so()],socksUdpEnabled:!1,socksUdpIp:""}),Fh=t=>{var s,r,l,o,i,a,c;return{dest:(r=(s=t==null?void 0:t.dest)==null?void 0:s.toString())!=null?r:"",path:(l=t==null?void 0:t.path)!=null?l:"",type:(o=t==null?void 0:t.type)!=null?o:"",alpn:Array.isArray(t==null?void 0:t.alpn)?t.alpn.join(","):(i=t==null?void 0:t.alpn)!=null?i:"",xver:(c=(a=t==null?void 0:t.xver)==null?void 0:a.toString())!=null?c:""}},oo=t=>{var r,l,o;const s={dest:(r=t.dest)==null?void 0:r.trim(),path:(l=t.path)==null?void 0:l.trim(),type:(o=t.type)==null?void 0:o.trim(),xver:t.xver?Number(t.xver):void 0};return t.alpn&&(s.alpn=t.alpn.split(",").map(i=>i.trim()).filter(Boolean)),Sr(s)},Hh=t=>{var p,m,g,I,D,w,x,v,C,z,ne,b,U,T,O,ve,Z,J,E,q,ue,Y,re,A,me,De,Ee,W,y,P,ie,te,Ce,Te,Re,Oe,B,V,L,he,ze,at,pe,oe,le,$,ye,ut,mt,Q,H,Se,Me,Fe,Be,ce,ge,We,Ie,ot,gt,Mt,et,jt,hr,sr,pr,er,ir,ar,tr,or,G,be,X,rt,M,xe,Le,Ke,Ge,it,Nt,Vt,kr,Gt,lr,Pt;const s=Sa.includes(t.protocol)?t.protocol:"vless",r=na(s),l=(p=t.settings)!=null?p:{},o=(m=t.sniffing)!=null?m:{},i=(g=t.streamSettings)!=null?g:{},a=(I=i.tlsSettings)!=null?I:{},c=i.tlsSettings!==void 0&&i.tlsSettings!==null?JSON.parse(JSON.stringify(i.tlsSettings)):{},u=(D=i.realitySettings)!=null?D:{};return{...r,tag:(w=t.tag)!=null?w:"",listen:(x=t.listen)!=null?x:"",port:(C=(v=t.port)==null?void 0:v.toString())!=null?C:"",disableInsecureEncryption:Boolean((z=l.disableInsecureEncryption)!=null?z:r.disableInsecureEncryption),vlessDecryption:(ne=l.decryption)!=null?ne:r.vlessDecryption,vlessEncryption:(b=l.encryption)!=null?b:r.vlessEncryption,fallbacks:Array.isArray(l.fallbacks)?l.fallbacks.map(nt=>Fh(nt)):r.fallbacks,shadowsocksNetwork:(U=l.network)!=null?U:r.shadowsocksNetwork,sniffingEnabled:Boolean((T=o.enabled)!=null?T:r.sniffingEnabled),sniffingDestinations:Array.isArray(o.destOverride)&&o.destOverride.length?o.destOverride:r.sniffingDestinations,sniffingRouteOnly:Boolean((O=o.routeOnly)!=null?O:r.sniffingRouteOnly),sniffingMetadataOnly:Boolean((ve=o.metadataOnly)!=null?ve:r.sniffingMetadataOnly),streamNetwork:(Z=i.network)!=null?Z:r.streamNetwork,streamSecurity:(J=i.security)!=null?J:r.streamSecurity,tlsServerName:(E=a.serverName)!=null?E:r.tlsServerName,tlsAlpn:Array.isArray(a.alpn)?a.alpn:r.tlsAlpn,tlsAllowInsecure:Boolean((q=a.allowInsecure)!=null?q:r.tlsAllowInsecure),tlsFingerprint:(ue=a.fingerprint)!=null?ue:r.tlsFingerprint,tlsRawSettings:c,realityPrivateKey:(Y=u.privateKey)!=null?Y:r.realityPrivateKey,realityServerNames:Vi(u.serverNames),realityShortIds:Vi(u.shortIds),realityDest:(re=u.dest)!=null?re:r.realityDest,realitySpiderX:(A=u.spiderX)!=null?A:r.realitySpiderX,realityXver:(De=(me=u.xver)==null?void 0:me.toString())!=null?De:r.realityXver,wsPath:(W=(Ee=i==null?void 0:i.wsSettings)==null?void 0:Ee.path)!=null?W:r.wsPath,wsHost:(ie=(P=(y=i==null?void 0:i.wsSettings)==null?void 0:y.headers)==null?void 0:P.Host)!=null?ie:r.wsHost,tcpHeaderType:(Te=(Ce=(te=i==null?void 0:i.tcpSettings)==null?void 0:te.header)==null?void 0:Ce.type)!=null?Te:r.tcpHeaderType,tcpHttpHosts:Vi((V=(B=(Oe=(Re=i==null?void 0:i.tcpSettings)==null?void 0:Re.header)==null?void 0:Oe.request)==null?void 0:B.headers)==null?void 0:V.Host),tcpHttpPath:Array.isArray((ze=(he=(L=i==null?void 0:i.tcpSettings)==null?void 0:L.header)==null?void 0:he.request)==null?void 0:ze.path)?i.tcpSettings.header.request.path[0]:r.tcpHttpPath,grpcServiceName:(pe=(at=i==null?void 0:i.grpcSettings)==null?void 0:at.serviceName)!=null?pe:r.grpcServiceName,grpcAuthority:(le=(oe=i==null?void 0:i.grpcSettings)==null?void 0:oe.authority)!=null?le:r.grpcAuthority,grpcMultiMode:Boolean((ye=($=i==null?void 0:i.grpcSettings)==null?void 0:$.multiMode)!=null?ye:r.grpcMultiMode),kcpHeaderType:(Q=(mt=(ut=i==null?void 0:i.kcpSettings)==null?void 0:ut.header)==null?void 0:mt.type)!=null?Q:r.kcpHeaderType,kcpSeed:(Se=(H=i==null?void 0:i.kcpSettings)==null?void 0:H.seed)!=null?Se:r.kcpSeed,quicSecurity:(Fe=(Me=i==null?void 0:i.quicSettings)==null?void 0:Me.security)!=null?Fe:r.quicSecurity,quicKey:(ce=(Be=i==null?void 0:i.quicSettings)==null?void 0:Be.key)!=null?ce:r.quicKey,quicHeaderType:(Ie=(We=(ge=i==null?void 0:i.quicSettings)==null?void 0:ge.header)==null?void 0:We.type)!=null?Ie:r.quicHeaderType,httpupgradePath:(gt=(ot=i==null?void 0:i.httpupgradeSettings)==null?void 0:ot.path)!=null?gt:r.httpupgradePath,httpupgradeHost:(et=(Mt=i==null?void 0:i.httpupgradeSettings)==null?void 0:Mt.host)!=null?et:r.httpupgradeHost,splithttpPath:(hr=(jt=i==null?void 0:i.splithttpSettings)==null?void 0:jt.path)!=null?hr:r.splithttpPath,splithttpHost:(pr=(sr=i==null?void 0:i.splithttpSettings)==null?void 0:sr.host)!=null?pr:r.splithttpHost,xhttpHost:(ir=(er=i==null?void 0:i.xhttpSettings)==null?void 0:er.host)!=null?ir:r.xhttpHost,xhttpPath:(tr=(ar=i==null?void 0:i.xhttpSettings)==null?void 0:ar.path)!=null?tr:r.xhttpPath,xhttpHeaders:(or=i==null?void 0:i.xhttpSettings)!=null&&or.headers?Kh(i.xhttpSettings.headers):r.xhttpHeaders,xhttpMode:(be=(G=i==null?void 0:i.xhttpSettings)==null?void 0:G.mode)!=null?be:r.xhttpMode,xhttpScMaxBufferedPosts:(M=(rt=(X=i==null?void 0:i.xhttpSettings)==null?void 0:X.scMaxBufferedPosts)==null?void 0:rt.toString())!=null?M:r.xhttpScMaxBufferedPosts,xhttpScMaxEachPostBytes:(Ke=(Le=(xe=i==null?void 0:i.xhttpSettings)==null?void 0:xe.scMaxEachPostBytes)==null?void 0:Le.toString())!=null?Ke:r.xhttpScMaxEachPostBytes,xhttpScStreamUpServerSecs:(Nt=(it=(Ge=i==null?void 0:i.xhttpSettings)==null?void 0:Ge.scStreamUpServerSecs)==null?void 0:it.toString())!=null?Nt:r.xhttpScStreamUpServerSecs,xhttpPaddingBytes:(kr=(Vt=i==null?void 0:i.xhttpSettings)==null?void 0:Vt.xPaddingBytes)!=null?kr:r.xhttpPaddingBytes,xhttpNoSSEHeader:Boolean((lr=(Gt=i==null?void 0:i.xhttpSettings)==null?void 0:Gt.noSSEHeader)!=null?lr:r.xhttpNoSSEHeader),vlessSelectedAuth:(Pt=l.selectedAuth)!=null?Pt:r.vlessSelectedAuth,sockoptEnabled:Boolean(i==null?void 0:i.sockopt),sockopt:(()=>{var Wr,Fr,Qt,vr,Xt,zr;const nt=El(),vt=(Wr=i==null?void 0:i.sockopt)!=null?Wr:{};return nt.acceptProxyProtocol=Boolean(vt.acceptProxyProtocol),nt.tcpFastOpen=Boolean(vt.tcpFastOpen),nt.mark=Hn(vt.mark),nt.tproxy=(Fr=vt.tproxy)!=null?Fr:nt.tproxy,nt.tcpMptcp=Boolean(vt.tcpMptcp),nt.penetrate=Boolean(vt.penetrate),nt.domainStrategy=(Qt=vt.domainStrategy)!=null?Qt:nt.domainStrategy,nt.tcpMaxSeg=Hn(vt.tcpMaxSeg),nt.dialerProxy=(vr=vt.dialerProxy)!=null?vr:nt.dialerProxy,nt.tcpKeepAliveInterval=Hn(vt.tcpKeepAliveInterval),nt.tcpKeepAliveIdle=Hn(vt.tcpKeepAliveIdle),nt.tcpUserTimeout=Hn(vt.tcpUserTimeout),nt.tcpcongestion=(Xt=vt.tcpcongestion)!=null?Xt:nt.tcpcongestion,nt.V6Only=Boolean(vt.V6Only),nt.tcpWindowClamp=Hn(vt.tcpWindowClamp),nt.interfaceName=(zr=vt.interface)!=null?zr:nt.interfaceName,nt})(),httpAccounts:s==="http"&&Array.isArray(l.accounts)?l.accounts.map(nt=>io(nt)):r.httpAccounts,httpAllowTransparent:s==="http"&&typeof l.allowTransparent=="boolean"?l.allowTransparent:r.httpAllowTransparent,socksAuth:s==="socks"&&l.auth==="password"?"password":r.socksAuth,socksAccounts:s==="socks"&&Array.isArray(l.accounts)?l.accounts.map(nt=>io(nt)):r.socksAccounts,socksUdpEnabled:s==="socks"&&typeof l.udp=="boolean"?l.udp:r.socksUdpEnabled,socksUdpIp:s==="socks"&&l.ip!==void 0&&l.ip!==null?String(l.ip):r.socksUdpIp}},Bh=t=>{var l,o,i,a;const s={network:t.streamNetwork,security:t.streamSecurity};if(t.streamNetwork==="ws"&&(s.wsSettings=Sr({path:t.wsPath||void 0,headers:t.wsHost?{Host:t.wsHost}:void 0})),t.streamNetwork==="tcp"&&(t.tcpHeaderType==="http"?s.tcpSettings={header:{type:"http",request:{path:t.tcpHttpPath?[t.tcpHttpPath]:[],headers:t.tcpHttpHosts?{Host:Bi(t.tcpHttpHosts)}:{}}}}:s.tcpSettings={header:{type:"none"}}),t.streamNetwork==="grpc"&&(s.grpcSettings=Sr({serviceName:t.grpcServiceName,authority:t.grpcAuthority,multiMode:t.grpcMultiMode})),t.streamNetwork==="kcp"&&(s.kcpSettings=Sr({header:{type:t.kcpHeaderType},seed:t.kcpSeed})),t.streamNetwork==="quic"&&(s.quicSettings=Sr({security:t.quicSecurity,key:t.quicKey,header:{type:t.quicHeaderType}})),t.streamNetwork==="httpupgrade"&&(s.httpupgradeSettings=Sr({path:t.httpupgradePath,host:t.httpupgradeHost})),t.streamNetwork==="splithttp"&&(s.splithttpSettings=Sr({path:t.splithttpPath,host:t.splithttpHost})),t.streamNetwork==="xhttp"&&(s.xhttpSettings=Sr({path:t.xhttpPath,host:t.xhttpHost,headers:Jh(t.xhttpHeaders),mode:t.xhttpMode,scMaxBufferedPosts:Cn(t.xhttpScMaxBufferedPosts),scMaxEachPostBytes:((l=t.xhttpScMaxEachPostBytes)==null?void 0:l.trim())||void 0,scStreamUpServerSecs:((o=t.xhttpScStreamUpServerSecs)==null?void 0:o.trim())||void 0,xPaddingBytes:((i=t.xhttpPaddingBytes)==null?void 0:i.trim())||void 0,noSSEHeader:t.xhttpNoSSEHeader||void 0})),t.streamSecurity==="tls"){const c=t.tlsRawSettings&&typeof t.tlsRawSettings=="object"?{...t.tlsRawSettings}:{};c.serverName=t.tlsServerName||void 0,c.alpn=(a=t.tlsAlpn)!=null&&a.length?t.tlsAlpn:void 0,c.allowInsecure=t.tlsAllowInsecure,c.fingerprint=t.tlsFingerprint||void 0,s.tlsSettings=Sr(c)}t.streamSecurity==="reality"&&(s.realitySettings=Sr({privateKey:t.realityPrivateKey||void 0,serverNames:Bi(t.realityServerNames),shortIds:Bi(t.realityShortIds),dest:t.realityDest||void 0,spiderX:t.realitySpiderX||void 0,xver:t.realityXver?Number(t.realityXver):void 0}));const r=Wh(t);return r&&(s.sockopt=r),Sr(s)},Vh=t=>{const s={};switch(["vmess","vless","trojan","shadowsocks"].includes(t.protocol)&&(s.clients=[]),t.protocol){case"vmess":s.disableInsecureEncryption=t.disableInsecureEncryption;break;case"vless":s.decryption=t.vlessDecryption||"none",t.vlessEncryption&&(s.encryption=t.vlessEncryption),t.vlessSelectedAuth&&(s.selectedAuth=t.vlessSelectedAuth),t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(oo).filter(r=>Object.keys(r).length));break;case"trojan":t.fallbacks.length&&(s.fallbacks=t.fallbacks.map(oo).filter(r=>Object.keys(r).length));break;case"shadowsocks":s.network=t.shadowsocksNetwork||"tcp,udp";break;case"http":{const r=t.httpAccounts.map(ao).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r),t.httpAllowTransparent&&(s.allowTransparent=!0);break}case"socks":{if(s.auth=t.socksAuth,t.socksAuth==="password"){const r=t.socksAccounts.map(ao).filter(l=>Object.keys(l).length);r.length&&(s.accounts=r)}s.udp=t.socksUdpEnabled,t.socksUdpEnabled&&t.socksUdpIp.trim()&&(s.ip=t.socksUdpIp.trim());break}}return s},$h=t=>{const r=t.protocol!=="http"&&t.protocol!=="socks"?Bh(t):void 0,l={tag:t.tag.trim(),listen:t.listen.trim()||void 0,port:Oh(t.port),protocol:t.protocol,settings:Vh(t)};return r&&(l.streamSettings=r),t.sniffingEnabled&&(l.sniffing=Sr({enabled:!0,destOverride:t.sniffingDestinations,routeOnly:t.sniffingRouteOnly,metadataOnly:t.sniffingMetadataOnly})),l},Kh=t=>{if(!t)return[ra()];const s=[];return Object.entries(t).forEach(([r,l])=>{var o;Array.isArray(l)?l.forEach(i=>{var a;return s.push({name:r,value:(a=i==null?void 0:i.toString())!=null?a:""})}):s.push({name:r,value:(o=l==null?void 0:l.toString())!=null?o:""})}),s.length?s:[ra()]},Jh=t=>{const s={};return t.forEach(({name:r,value:l})=>{const o=r==null?void 0:r.trim(),i=l==null?void 0:l.trim();!o||!i||(s[o]=i)}),Object.keys(s).length?s:void 0};class sa{static gf(s){const r=new Float64Array(16);if(s)for(let l=0;l<s.length;++l)r[l]=s[l];return r}static pack(s,r){let l;const o=this.gf(),i=this.gf();for(let a=0;a<16;++a)i[a]=r[a];this.carry(i),this.carry(i),this.carry(i);for(let a=0;a<2;++a){o[0]=i[0]-65517;for(let c=1;c<15;++c)o[c]=i[c]-65535-(o[c-1]>>16&1),o[c-1]&=65535;o[15]=i[15]-32767-(o[14]>>16&1),l=o[15]>>16&1,o[14]&=65535,this.cswap(i,o,1-l)}for(let a=0;a<16;++a)s[2*a]=i[a]&255,s[2*a+1]=i[a]>>8}static carry(s){for(let r=0;r<16;++r)s[(r+1)%16]+=(r<15?1:38)*Math.floor(s[r]/65536),s[r]&=65535}static cswap(s,r,l){const o=~(l-1);for(let i=0;i<16;++i){const a=o&(s[i]^r[i]);s[i]^=a,r[i]^=a}}static add(s,r,l){for(let o=0;o<16;++o)s[o]=r[o]+l[o]|0}static subtract(s,r,l){for(let o=0;o<16;++o)s[o]=r[o]-l[o]|0}static multmod(s,r,l){const o=new Float64Array(31);for(let i=0;i<16;++i)for(let a=0;a<16;++a)o[i+a]+=r[i]*l[a];for(let i=0;i<15;++i)o[i]+=38*o[i+16];for(let i=0;i<16;++i)s[i]=o[i];this.carry(s),this.carry(s)}static invert(s,r){const l=this.gf();for(let o=0;o<16;++o)l[o]=r[o];for(let o=253;o>=0;--o)this.multmod(l,l,l),o!==2&&o!==4&&this.multmod(l,l,r);for(let o=0;o<16;++o)s[o]=l[o]}static clamp(s){s[31]=s[31]&127|64,s[0]&=248}static generatePublicKey(s){let r;const l=new Uint8Array(32),o=this.gf([1]),i=this.gf([9]),a=this.gf(),c=this.gf([1]),u=this.gf(),p=this.gf(),m=this.gf([56129,1]),g=this.gf([9]);for(let I=0;I<32;++I)l[I]=s[I];this.clamp(l);for(let I=254;I>=0;--I)r=l[I>>>3]>>>(I&7)&1,this.cswap(o,i,r),this.cswap(a,c,r),this.add(u,o,a),this.subtract(o,o,a),this.add(a,i,c),this.subtract(i,i,c),this.multmod(c,u,u),this.multmod(p,o,o),this.multmod(o,a,o),this.multmod(a,i,u),this.add(u,o,a),this.subtract(o,o,a),this.multmod(i,o,o),this.subtract(a,c,p),this.multmod(o,a,m),this.add(o,o,c),this.multmod(a,a,o),this.multmod(o,c,p),this.multmod(c,i,g),this.multmod(i,u,u),this.cswap(o,i,r),this.cswap(a,c,r);return this.invert(a,a),this.multmod(o,o,a),this.pack(l,o),l}static generatePresharedKey(){const s=new Uint8Array(32),r=globalThis==null?void 0:globalThis.crypto;if(!(r!=null&&r.getRandomValues))throw new Error("Crypto.getRandomValues is not available in this environment.");return r.getRandomValues(s),s}static generatePrivateKey(){const s=this.generatePresharedKey();return this.clamp(s),s}static encodeBase64(s,r){const l=Uint8Array.from([r[0]>>2&63,(r[0]<<4|r[1]>>4)&63,(r[1]<<2|r[2]>>6)&63,r[2]&63]);for(let o=0;o<4;++o)s[o]=l[o]+65+(25-l[o]>>8&6)-(51-l[o]>>8&75)-(61-l[o]>>8&15)+(62-l[o]>>8&3)}static keyToBase64(s){let r;const l=new Uint8Array(44);for(r=0;r<32/3;++r)this.encodeBase64(l.subarray(r*4),s.subarray(r*3));return this.encodeBase64(l.subarray(r*4),Uint8Array.from([s[r*3+0],s[r*3+1],0])),l[43]=61,Array.from(l).map(o=>String.fromCharCode(o)).join("")}static keyFromBase64(s){const r=globalThis.atob(s),l=new Uint8Array(r.length);for(let o=0;o<r.length;o++)l[o]=r.charCodeAt(o);return l}static generateKeypair(s=""){const r=s.length>0?this.keyFromBase64(s):this.generatePrivateKey(),l=this.generatePublicKey(r);return{publicKey:this.keyToBase64(l),privateKey:s.length>0?s:this.keyToBase64(r)}}}const yi=t=>sa.generateKeypair(t!=null?t:""),qh=()=>{const t=globalThis;t.Wireguard||(t.Wireguard={generateKeypair:sa.generateKeypair.bind(sa)})},Yh=async()=>_e("/xray/vlessenc"),Qe=d.exports.forwardRef((t,s)=>e(we,{size:"sm",ref:s,...t}));Qe.displayName="InboundFormInput";const _n=d.exports.forwardRef((t,s)=>e(je,{size:"sm",ref:s,...t}));_n.displayName="InboundFormSelect";const Ps=d.exports.forwardRef((t,s)=>e(Ar,{size:"sm",resize:"vertical",ref:s,...t}));Ps.displayName="InboundFormTextarea";const lo=t=>(t!=null?t:"").replace(/\s+/g,"").replace(/=+$/,""),Gh=t=>{const s=(t!=null?t:"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");if(!s)return"";const r=s.length%4;return r===0?s:`${s}${"=".repeat(4-r)}`},Qh=["AsIs","UseIP","UseIPv6v4","UseIPv6","UseIPv4v6","UseIPv4","ForceIP","ForceIPv6v4","ForceIPv6","ForceIPv4v6","ForceIPv4"],Xh=["bbr","cubic","reno"],Zh=["off","redirect","tproxy"],jh=["auto","packet-up","stream-up","stream-one"],ep=({isOpen:t,mode:s,initialValue:r,isSubmitting:l,onClose:o,onSubmit:i})=>{var Se,Me,Fe,Be;const{t:a}=$e(),c=Bt(),[u,p]=d.exports.useState([]),[m,g]=d.exports.useState(!1),I=Or({defaultValues:na()}),{control:D,register:w,handleSubmit:x,reset:v,watch:C}=I,{fields:z,append:ne,remove:b}=Jn({control:D,name:"fallbacks"}),{fields:U,append:T,remove:O}=Jn({control:D,name:"httpAccounts"}),{fields:ve,append:Z,remove:J}=Jn({control:D,name:"socksAccounts"}),{fields:E,append:q,remove:ue}=Jn({control:D,name:"xhttpHeaders"}),Y=Ht({control:D,name:"protocol"})||C("protocol"),re=Ht({control:D,name:"streamNetwork"})||C("streamNetwork"),A=Ht({control:D,name:"streamSecurity"})||C("streamSecurity"),me=(Se=Ht({control:D,name:"sniffingEnabled"}))!=null?Se:C("sniffingEnabled"),De=Ht({control:D,name:"realityPrivateKey"})||C("realityPrivateKey"),Ee=Ht({control:D,name:"tcpHeaderType"})||C("tcpHeaderType"),W=(Me=Ht({control:D,name:"sockoptEnabled"}))!=null?Me:!1,y=Ht({control:D,name:"vlessSelectedAuth"})||"",P=Ht({control:D,name:"socksAuth"})||C("socksAuth")||"noauth",ie=(Be=(Fe=Ht({control:D,name:"socksUdpEnabled"}))!=null?Fe:C("socksUdpEnabled"))!=null?Be:!1,te=Ht({control:D,name:"xhttpMode"})||C("xhttpMode")||"auto",Ce=Y!=="http"&&Y!=="socks",Te=d.exports.useMemo(()=>["X25519, not Post-Quantum","ML-KEM-768, Post-Quantum"],[]),Re=d.exports.useMemo(()=>{const ce=[...Te,...u.map(We=>We.label)].filter(Boolean);return Array.from(new Set(ce)).map(We=>({label:We,value:We}))},[Te,u]);d.exports.useEffect(()=>{if(t)if(r){const ce=Hh(r);v(ce)}else v(na())},[r,v,t]);const Oe=d.exports.useCallback((ce,ge)=>n(k,{children:[e(_,{children:ge}),e(pt,{control:D,name:`sockopt.${ce}`,render:({field:We})=>{const Ie=typeof We.value=="number"||typeof We.value=="string"?We.value:void 0;return e(Tn,{min:0,value:Ie!=null?Ie:"",onChange:ot=>We.onChange(ot),children:e(In,{})})}})]}),[D]),B=d.exports.useCallback((ce,ge)=>n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:ge}),e(pt,{control:D,name:`sockopt.${ce}`,render:({field:We})=>e(ht,{isChecked:typeof We.value=="boolean"?We.value:Boolean(We.value),onChange:Ie=>We.onChange(Ie.target.checked)})})]}),[D]),V=d.exports.useCallback((ce,ge,We)=>n(k,{children:[e(_,{children:ge}),e(Qe,{...w(`sockopt.${ce}`),placeholder:We})]}),[w]),L=Y==="vless"||Y==="trojan",he=st("gray.200","gray.700"),ze=async ce=>{await i(ce)},at=d.exports.useCallback(()=>{try{const{privateKey:ce}=yi();I.setValue("realityPrivateKey",lo(ce),{shouldDirty:!0})}catch(ce){c({status:"error",title:a("inbounds.reality.generateError","Unable to generate key pair"),description:ce instanceof Error?ce.message:void 0})}},[I,c,a]),pe=d.exports.useCallback(()=>{try{const ce=typeof window>"u"?void 0:window.crypto;if(!(ce!=null&&ce.getRandomValues))throw new Error("Crypto API is not available in this environment.");const ge=new Uint8Array(4);ce.getRandomValues(ge);const We=Array.from(ge).map(gt=>gt.toString(16).padStart(2,"0")).join(""),ot=(I.getValues("realityShortIds")||"").split(/[\s,]+/).map(gt=>gt.trim()).filter(Boolean);ot.push(We),I.setValue("realityShortIds",ot.join(`
`),{shouldDirty:!0})}catch(ce){c({status:"error",title:a("inbounds.reality.shortIdError","Unable to generate short ID"),description:ce instanceof Error?ce.message:void 0})}},[I,c,a]),oe=d.exports.useMemo(()=>{const ce=Gh(De);if(!ce)return"";try{const{publicKey:ge}=yi(ce);return lo(ge)}catch{return""}},[De]),le=()=>ne({dest:"",path:"",type:"",alpn:"",xver:""}),$=d.exports.useCallback(async()=>{var ce;g(!0);try{const ge=await Yh(),We=(ce=ge==null?void 0:ge.auths)!=null?ce:[];return p(We),We}catch(ge){return console.error(ge),c({status:"error",title:a("inbounds.vless.getKeysError","Unable to fetch VLESS keys")}),[]}finally{g(!1)}},[c,a]),ye=d.exports.useCallback(async()=>u.length?u:$(),[$,u]),ut=d.exports.useCallback((ce,ge)=>{var Ie,ot;const We=ge.find(gt=>gt.label===ce);if(!We){c({status:"warning",title:a("inbounds.vless.authNotFound","Authentication block not available")});return}I.setValue("vlessDecryption",(Ie=We.decryption)!=null?Ie:"",{shouldDirty:!0}),I.setValue("vlessEncryption",(ot=We.encryption)!=null?ot:"",{shouldDirty:!0})},[I,a,c]),mt=d.exports.useCallback(async ce=>{if(!ce){I.setValue("vlessDecryption","",{shouldDirty:!0}),I.setValue("vlessEncryption","",{shouldDirty:!0});return}const ge=await ye();ge.length&&ut(ce,ge)},[ut,ye,I]),Q=d.exports.useCallback(async()=>{const ce=I.getValues("vlessSelectedAuth");if(!ce){c({status:"info",title:a("inbounds.vless.selectAuthFirst","Select an authentication option first")});return}const ge=await $();ge.length&&ut(ce,ge)},[ut,$,I,a,c]),H=d.exports.useCallback(()=>{I.setValue("vlessSelectedAuth","",{shouldDirty:!0}),I.setValue("vlessDecryption","",{shouldDirty:!0}),I.setValue("vlessEncryption","",{shouldDirty:!0})},[I]);return d.exports.useEffect(()=>{t&&Y==="vless"&&ye()},[Y,ye,t]),n(Ut,{isOpen:t,onClose:o,size:"5xl",scrollBehavior:"inside",isCentered:!0,children:[e(wt,{}),n(Lt,{maxW:{base:"95vw",md:"4xl"},children:[e(At,{children:s==="create"?a("inbounds.add","Add inbound"):a("inbounds.edit","Edit inbound")}),e(Rt,{}),e(kt,{children:n(de,{align:"stretch",spacing:6,children:[n(ke,{spacing:4,borderWidth:"1px",borderColor:he,borderRadius:"lg",p:4,children:[n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.tag","Tag")}),e(Qe,{...w("tag",{required:!0}),isDisabled:s==="edit"})]}),n(k,{children:[e(_,{children:a("inbounds.listen","Listen address")}),e(Qe,{placeholder:"0.0.0.0",...w("listen")})]})]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.port","Port")}),e(Qe,{placeholder:"443",...w("port",{required:!0})})]}),n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.protocol","Protocol")}),e(_n,{...w("protocol",{required:!0}),isDisabled:s==="edit",children:Sa.map(ce=>e("option",{value:ce,children:ce.toUpperCase()},ce))})]})]}),Y==="vmess"&&n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.vmess.disableInsecure","Disable insecure encryption")}),e(ht,{...w("disableInsecureEncryption")})]}),Y==="shadowsocks"&&n(k,{children:[e(_,{children:a("inbounds.shadowsocks.network","Allowed networks")}),e(Qe,{...w("shadowsocksNetwork")})]}),Y==="vless"&&n(ke,{spacing:3,children:[e(pt,{control:D,name:"vlessSelectedAuth",render:({field:ce})=>n(k,{children:[e(_,{children:a("inbounds.vless.authentication","Authentication")}),n(je,{placeholder:a("inbounds.vless.authPlaceholder","Select authentication"),value:ce.value||"",onChange:async ge=>{const We=ge.target.value;ce.onChange(We),await mt(We)},children:[e("option",{value:"",children:a("common.none","None")}),Re.map(ge=>e("option",{value:ge.value,children:ge.label},ge.value))]})]})}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.vless.decryption","Decryption")}),e(Qe,{...w("vlessDecryption")})]}),n(k,{children:[e(_,{children:a("inbounds.vless.encryption","Encryption")}),e(Qe,{...w("vlessEncryption")})]})]}),n(R,{spacing:3,children:[e(F,{size:"sm",onClick:Q,isLoading:m,isDisabled:!y,children:a("inbounds.vless.getKeys","Get new keys")}),e(F,{size:"sm",variant:"ghost",onClick:H,children:a("inbounds.vless.clearKeys","Clear")})]})]}),Y==="http"&&n(ke,{spacing:3,children:[n(lt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("inbounds.http.accounts","HTTP accounts")}),e(F,{size:"xs",onClick:()=>T({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),n(ke,{spacing:3,children:[U.map((ce,ge)=>n(N,{borderWidth:"1px",borderRadius:"md",borderColor:he,p:3,children:[n(lt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",ge+1]}),e(F,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>O(ge),children:a("hostsPage.delete","Delete")})]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("username","Username")}),e(Qe,{...w(`httpAccounts.${ge}.user`)})]}),n(k,{children:[e(_,{children:a("password","Password")}),e(Qe,{...w(`httpAccounts.${ge}.pass`)})]})]})]},ce.id)),!U.length&&e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.http.noAccountsHint","Add at least one username/password pair.")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.http.allowTransparent","Allow transparent proxy")}),e(ht,{...w("httpAllowTransparent")})]})]}),Y==="socks"&&n(ke,{spacing:3,children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.socks.udp","Enable UDP")}),e(ht,{...w("socksUdpEnabled")})]}),ie&&n(k,{children:[e(_,{children:a("inbounds.socks.udpIp","UDP bind IP")}),e(Qe,{...w("socksUdpIp"),placeholder:"127.0.0.1"})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.socks.auth","Require authentication")}),e(pt,{control:D,name:"socksAuth",render:({field:ce})=>e(ht,{isChecked:ce.value==="password",onChange:ge=>ce.onChange(ge.target.checked?"password":"noauth")})})]}),P==="password"&&n(ke,{spacing:3,children:[n(lt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("inbounds.socks.accounts","SOCKS accounts")}),e(F,{size:"xs",onClick:()=>Z({user:"",pass:""}),children:a("inbounds.accounts.add","Add account")})]}),ve.map((ce,ge)=>n(N,{borderWidth:"1px",borderRadius:"md",borderColor:he,p:3,children:[n(lt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[a("inbounds.accounts.label","Account")," #",ge+1]}),e(F,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>J(ge),children:a("hostsPage.delete","Delete")})]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("username","Username")}),e(Qe,{...w(`socksAccounts.${ge}.user`)})]}),n(k,{children:[e(_,{children:a("password","Password")}),e(Qe,{...w(`socksAccounts.${ge}.pass`)})]})]})]},ce.id)),!ve.length&&e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.socks.noAccountsHint","Add at least one account for password mode.")})]})]})]}),Ce&&n(ke,{spacing:4,borderWidth:"1px",borderColor:he,borderRadius:"lg",p:4,children:[n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.network","Network")}),e(_n,{...w("streamNetwork"),children:Uh.map(ce=>e("option",{value:ce,children:ce},ce))})]}),n(k,{children:[e(_,{children:a("inbounds.security","Security")}),e(_n,{...w("streamSecurity"),children:Lh.map(ce=>e("option",{value:ce,children:ce},ce))})]})]}),re==="ws"&&n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.ws.path","WebSocket path")}),e(Qe,{...w("wsPath"),placeholder:"/ws"})]}),n(k,{children:[e(_,{children:a("inbounds.ws.host","WebSocket host header")}),e(Qe,{...w("wsHost")})]})]}),re==="tcp"&&n(ke,{spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.tcp.headerType","TCP header type")}),n(_n,{...w("tcpHeaderType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),Ee==="http"&&n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.tcp.host","HTTP host list")}),e(Ps,{...w("tcpHttpHosts"),placeholder:"example.com"})]}),n(k,{children:[e(_,{children:a("inbounds.tcp.path","HTTP path")}),e(Qe,{...w("tcpHttpPath")})]})]})]}),re==="grpc"&&n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.grpc.serviceName","Service name")}),e(Qe,{...w("grpcServiceName")})]}),n(k,{children:[e(_,{children:a("inbounds.grpc.authority","Authority")}),e(Qe,{...w("grpcAuthority")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.grpc.multiMode","Multi mode")}),e(ht,{...w("grpcMultiMode")})]})]}),re==="kcp"&&n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.kcp.headerType","mKCP header")}),e(Qe,{...w("kcpHeaderType")})]}),n(k,{children:[e(_,{children:a("inbounds.kcp.seed","mKCP seed")}),e(Qe,{...w("kcpSeed")})]})]}),re==="quic"&&n(Ve,{columns:{base:1,md:3},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.quic.security","QUIC security")}),e(Qe,{...w("quicSecurity")})]}),n(k,{children:[e(_,{children:a("inbounds.quic.key","QUIC key")}),e(Qe,{...w("quicKey")})]}),n(k,{children:[e(_,{children:a("inbounds.quic.headerType","QUIC header type")}),e(Qe,{...w("quicHeaderType")})]})]}),re==="httpupgrade"&&n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.httpUpgrade.path","Path")}),e(Qe,{...w("httpupgradePath")})]}),n(k,{children:[e(_,{children:a("inbounds.httpUpgrade.host","Host")}),e(Qe,{...w("httpupgradeHost")})]})]}),re==="splithttp"&&n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.splitHttp.path","Path")}),e(Qe,{...w("splithttpPath")})]}),n(k,{children:[e(_,{children:a("inbounds.splitHttp.host","Host")}),e(Qe,{...w("splithttpHost")})]})]}),re==="xhttp"&&n(ke,{spacing:3,children:[n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.xhttp.host","Host")}),e(Qe,{...w("xhttpHost"),placeholder:"example.com"})]}),n(k,{children:[e(_,{children:a("inbounds.xhttp.path","Path")}),e(Qe,{...w("xhttpPath"),placeholder:"/"})]})]}),n(ke,{spacing:2,children:[n(lt,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("inbounds.xhttp.headers","Custom headers")}),e(F,{size:"xs",onClick:()=>q({name:"",value:""}),children:a("inbounds.accounts.add","Add")})]}),E.map((ce,ge)=>n(R,{spacing:2,align:"flex-start",children:[e(k,{children:e(Qe,{...w(`xhttpHeaders.${ge}.name`),placeholder:a("inbounds.xhttp.headerName","Header name")})}),e(k,{children:e(Qe,{...w(`xhttpHeaders.${ge}.value`),placeholder:a("inbounds.xhttp.headerValue","Header value")})}),e(F,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>ue(ge),children:a("hostsPage.delete","Delete")})]},ce.id))]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.xhttp.mode","Mode")}),e(_n,{...w("xhttpMode"),children:jh.map(ce=>e("option",{value:ce,children:ce},ce))})]}),n(k,{children:[e(_,{children:a("inbounds.xhttp.paddingBytes","Padding bytes")}),e(Qe,{...w("xhttpPaddingBytes"),placeholder:"100-1000"})]})]}),te==="packet-up"&&n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.xhttp.maxBuffered","Max buffered upload")}),e(Qe,{...w("xhttpScMaxBufferedPosts"),placeholder:"30"})]}),n(k,{children:[e(_,{children:a("inbounds.xhttp.maxUploadBytes","Max upload size (bytes)")}),e(Qe,{...w("xhttpScMaxEachPostBytes"),placeholder:"1000000"})]})]}),te==="stream-up"&&n(k,{children:[e(_,{children:a("inbounds.xhttp.streamUp","Stream-up server seconds")}),e(Qe,{...w("xhttpScStreamUpServerSecs"),placeholder:"20-80"})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.xhttp.noSSE","Disable SSE header")}),e(ht,{...w("xhttpNoSSEHeader")})]})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.sockopt.enable","Enable sockopt")}),e(pt,{control:D,name:"sockoptEnabled",render:({field:ce})=>e(ht,{isChecked:Boolean(ce.value),onChange:ge=>ce.onChange(ge.target.checked)})})]}),e(Xn,{in:Boolean(W),animateOpacity:!0,children:n(ke,{spacing:4,borderWidth:"1px",borderColor:he,borderRadius:"md",p:4,mt:2,children:[n(Ve,{columns:{base:1,md:2},spacing:3,children:[Oe("mark",a("inbounds.sockopt.routeMark","Route mark")),Oe("tcpKeepAliveInterval",a("inbounds.sockopt.tcpKeepAliveInterval","TCP keep alive interval")),Oe("tcpKeepAliveIdle",a("inbounds.sockopt.tcpKeepAliveIdle","TCP keep alive idle")),Oe("tcpMaxSeg",a("inbounds.sockopt.tcpMaxSeg","TCP max segment")),Oe("tcpUserTimeout",a("inbounds.sockopt.tcpUserTimeout","TCP user timeout")),Oe("tcpWindowClamp",a("inbounds.sockopt.tcpWindowClamp","TCP window clamp"))]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[V("dialerProxy",a("inbounds.sockopt.dialerProxy","Dialer proxy"),"proxy"),V("interfaceName",a("inbounds.sockopt.interfaceName","Interface name"))]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.sockopt.domainStrategy","Domain strategy")}),e(pt,{control:D,name:"sockopt.domainStrategy",render:({field:ce})=>n(je,{...ce,children:[e("option",{value:"",children:a("common.none","None")}),Qh.map(ge=>e("option",{value:ge,children:ge},ge))]})})]}),n(k,{children:[e(_,{children:a("inbounds.sockopt.tcpCongestion","TCP congestion")}),e(pt,{control:D,name:"sockopt.tcpcongestion",render:({field:ce})=>n(je,{...ce,children:[e("option",{value:"",children:a("common.none","None")}),Xh.map(ge=>e("option",{value:ge,children:ge},ge))]})})]}),n(k,{children:[e(_,{children:a("inbounds.sockopt.tproxy","TProxy")}),e(pt,{control:D,name:"sockopt.tproxy",render:({field:ce})=>e(je,{...ce,children:Zh.map(ge=>e("option",{value:ge,children:ge},ge))})})]})]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[B("acceptProxyProtocol",a("inbounds.sockopt.acceptProxyProtocol","Accept proxy protocol")),B("tcpFastOpen",a("inbounds.sockopt.tcpFastOpen","TCP fast open")),B("tcpMptcp",a("inbounds.sockopt.tcpMptcp","Multipath TCP")),B("penetrate",a("inbounds.sockopt.penetrate","Penetrate")),B("V6Only",a("inbounds.sockopt.v6Only","IPv6 only"))]})]})})]}),A==="tls"&&n(ke,{spacing:4,borderWidth:"1px",borderColor:he,borderRadius:"lg",p:4,children:[n(k,{children:[e(_,{children:a("inbounds.tls.serverName","Server name (SNI)")}),e(Qe,{...w("tlsServerName"),placeholder:"example.com"})]}),n(k,{children:[e(_,{children:a("inbounds.tls.fingerprint","uTLS fingerprint")}),n(_n,{...w("tlsFingerprint"),children:[e("option",{value:"",children:a("common.none","None")}),Mh.map(ce=>e("option",{value:ce,children:ce},ce))]})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.tls.allowInsecure","Allow insecure")}),e(ht,{...w("tlsAllowInsecure")})]})]}),A==="reality"&&n(ke,{spacing:4,borderWidth:"1px",borderColor:he,borderRadius:"lg",p:4,children:[n(k,{isRequired:!0,children:[e(_,{children:a("inbounds.reality.privateKey","Reality private key")}),e(Ps,{rows:3,...w("realityPrivateKey",{required:!0})}),e(F,{size:"xs",mt:2,variant:"outline",onClick:at,alignSelf:"flex-start",children:a("inbounds.reality.generateKeys","Generate key pair")})]}),n(k,{children:[e(_,{children:a("inbounds.reality.publicKey","Reality public key")}),e(Qe,{value:oe,isReadOnly:!0,placeholder:a("inbounds.reality.publicKeyPlaceholder","Derived automatically")})]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.reality.serverNames","Server names")}),e(Ps,{rows:2,...w("realityServerNames"),placeholder:"domain.com"}),e(N,{fontSize:"sm",color:"gray.500",children:a("inbounds.serverNamesHint","Separate entries with commas or new lines.")})]}),n(k,{children:[e(_,{children:a("inbounds.reality.dest","Destination (host:port)")}),e(Qe,{...w("realityDest"),placeholder:"example.com:443"})]})]}),n(k,{children:[e(_,{children:a("inbounds.reality.shortIds","Short IDs")}),e(Ps,{rows:2,...w("realityShortIds")}),e(F,{size:"xs",mt:2,variant:"outline",onClick:pe,alignSelf:"flex-start",children:a("inbounds.reality.generateShortId","Generate short ID")}),e(N,{fontSize:"sm",color:"gray.500",children:a("inbounds.shortIdsHint","Separate entries with commas or new lines.")})]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:a("inbounds.reality.spiderX","SpiderX")}),e(Qe,{...w("realitySpiderX")})]}),n(k,{children:[e(_,{children:a("inbounds.reality.xver","Xver")}),e(Qe,{...w("realityXver")})]})]})]}),L&&n(ke,{spacing:3,borderWidth:"1px",borderColor:he,borderRadius:"lg",p:4,children:[n(lt,{align:"center",justify:"space-between",children:[e(N,{fontWeight:"medium",children:a("inbounds.fallbacks","Fallbacks")}),e(F,{size:"xs",onClick:le,children:a("inbounds.fallbacks.add","Add fallback")})]}),z.length===0?e(h,{fontSize:"sm",color:"gray.500",children:a("inbounds.fallbacks.empty","No fallbacks configured yet.")}):z.map((ce,ge)=>n(N,{borderWidth:"1px",borderRadius:"md",borderColor:he,p:3,children:[n(lt,{justify:"space-between",align:"center",mb:3,children:[n(h,{fontWeight:"semibold",children:[a("inbounds.fallbacks.type","Fallback")," #",ge+1]}),e(F,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>b(ge),children:a("hostsPage.delete","Delete")})]}),n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.fallbacks.dest","Destination (host:port)")}),e(Qe,{placeholder:"example.com:443",...w(`fallbacks.${ge}.dest`)})]}),n(k,{children:[e(_,{children:a("inbounds.fallbacks.path","Path")}),e(Qe,{...w(`fallbacks.${ge}.path`),placeholder:"/"})]}),n(k,{children:[e(_,{children:a("inbounds.fallbacks.type","Type")}),e(Qe,{...w(`fallbacks.${ge}.type`),placeholder:"none"})]}),n(k,{children:[e(_,{children:a("inbounds.fallbacks.alpn","ALPN")}),e(Qe,{...w(`fallbacks.${ge}.alpn`),placeholder:"h2,http/1.1"})]}),n(k,{children:[e(_,{children:"Xver"}),e(Qe,{...w(`fallbacks.${ge}.xver`),placeholder:"0"})]})]})]},ce.id))]}),n(ke,{spacing:4,borderWidth:"1px",borderColor:he,borderRadius:"lg",p:4,children:[n(lt,{align:"center",justify:"space-between",children:[n(R,{spacing:2,children:[e(N,{fontWeight:"medium",children:a("inbounds.sniffing","Sniffing")}),e(ct,{label:a("inbounds.sniffingHint","It is recommended to keep the default."),children:e(Xo,{width:16,height:16})})]}),e(ht,{...w("sniffingEnabled")})]}),me&&n(ke,{spacing:3,children:[n(k,{children:[e(_,{children:a("inbounds.sniffingDestinations","Protocols to sniff")}),e(pt,{control:D,name:"sniffingDestinations",render:({field:ce})=>{var ge;return e(ii,{value:(ge=ce.value)!=null?ge:[],onChange:ce.onChange,children:e(R,{spacing:4,children:Rh.map(We=>e(Pr,{value:We.value,children:We.label},We.value))})})}})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.sniffingRouteOnly","Route only")}),e(ht,{...w("sniffingRouteOnly")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("inbounds.sniffingMetadataOnly","Metadata only")}),e(ht,{...w("sniffingMetadataOnly")})]})]})]})]})}),n(zt,{children:[e(F,{variant:"ghost",mr:3,onClick:o,children:a("hostsPage.cancel","Cancel")}),e(F,{colorScheme:"primary",isLoading:l,onClick:x(ze),children:s==="create"?a("common.create","Create"):a("common.save","Save")})]})]})]})},tp=()=>{const{t}=$e(),s=Bt(),[r,l]=d.exports.useState([]),[o,i]=d.exports.useState(!0),[a,c]=d.exports.useState(!1),[u,p]=d.exports.useState(null),[m,g]=d.exports.useState({protocol:"all",search:""}),[I,D]=d.exports.useState(null),{isOpen:w,onOpen:x,onClose:v}=Yt(),[C,z]=d.exports.useState("create"),ne=xr({base:!1,md:!0}),b=d.exports.useCallback(()=>{i(!0),p(null),_e("/inbounds/full").then(J=>{l(J||[])}).catch(()=>{p(t("inbounds.error.load","Unable to load inbounds"))}).finally(()=>i(!1))},[t]);d.exports.useEffect(()=>{b()},[b]);const U=d.exports.useMemo(()=>{const J=m.search.trim().toLowerCase();return r.filter(E=>{var q;return m.protocol!=="all"&&E.protocol!==m.protocol?!1:J?E.tag.toLowerCase().includes(J)||((q=E.port)==null?void 0:q.toString().includes(J)):!0})},[r,m]),T=()=>{z("create"),D(null),x()},O=J=>{z("edit"),D(J),x()},ve=async J=>{var E;c(!0);try{const q=$h(J),ue=C==="create"?"/inbounds":`/inbounds/${encodeURIComponent(q.tag)}`;await _e(ue,{method:C==="create"?"POST":"PUT",body:q}),s({status:"success",title:C==="create"?t("inbounds.success.created","Inbound created"):t("inbounds.success.updated","Inbound updated")}),Ls(),await b(),v()}catch(q){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((E=q==null?void 0:q.data)==null?void 0:E.detail)||(q==null?void 0:q.message)})}finally{c(!1)}},Z=async J=>{var q;const E=t("inbounds.confirmDelete",{defaultValue:"Delete inbound {{tag}}?",tag:J.tag});if(!!window.confirm(E)){c(!0);try{await _e(`/inbounds/${encodeURIComponent(J.tag)}`,{method:"DELETE"}),s({status:"success",title:t("inbounds.success.deleted","Inbound deleted")}),Ls(),await b()}catch(ue){s({status:"error",title:t("inbounds.error.submit","Unable to save inbound"),description:((q=ue==null?void 0:ue.data)==null?void 0:q.detail)||(ue==null?void 0:ue.message)})}finally{c(!1)}}};return n(ke,{spacing:4,children:[n(lt,{justify:"space-between",flexWrap:"wrap",gap:4,children:[e(we,{maxW:"300px",placeholder:t("inbounds.searchPlaceholder","Search by tag or port"),value:m.search,onChange:J=>g(E=>({...E,search:J.target.value}))}),n(R,{spacing:3,children:[n(je,{width:"180px",value:m.protocol,onChange:J=>g(E=>({...E,protocol:J.target.value})),children:[e("option",{value:"all",children:t("inbounds.filterProtocol","All protocols")}),Sa.map(J=>e("option",{value:J,children:J.toUpperCase()},J))]}),e(F,{leftIcon:e(un,{width:18,height:18}),onClick:T,colorScheme:"primary",children:t("inbounds.add","Add inbound")})]})]}),u&&n(Ir,{status:"error",children:[e(Tr,{}),u]}),o?e(lt,{justify:"center",py:10,children:e(Dt,{})}):U.length===0?e(N,{border:"1px dashed",borderRadius:"md",p:8,textAlign:"center",color:"gray.500",children:t("inbounds.emptyState","No inbounds configured yet.")}):ne?e(N,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:n(Pn,{variant:"simple",size:"sm",children:[e(Zr,{bg:"gray.50",_dark:{bg:"gray.900"},children:n(_t,{children:[e(He,{children:t("inbounds.tag","Tag")}),e(He,{children:t("inbounds.protocol","Protocol")}),e(He,{children:t("inbounds.portLabel","Port")}),e(He,{children:t("inbounds.network","Network")}),e(He,{children:t("inbounds.security","Security")}),e(He,{children:t("inbounds.sniffing","Sniffing")}),e(He,{width:"120px",children:t("actions","Actions")})]})}),e($r,{children:U.map(J=>{var q;const E=J.streamSettings||{};return n(_t,{children:[n(Ne,{children:[e(h,{fontWeight:"semibold",children:J.tag}),J.listen&&e(h,{fontSize:"sm",color:"gray.500",children:J.listen})]}),e(Ne,{children:e(bt,{colorScheme:"purple",children:J.protocol})}),e(Ne,{children:J.port}),e(Ne,{children:E.network||"\u2014"}),e(Ne,{children:E.security&&E.security!=="none"?e(bt,{colorScheme:"blue",children:E.security}):"\u2014"}),e(Ne,{children:(q=J.sniffing)!=null&&q.enabled?e(bt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(bt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")})}),e(Ne,{children:n(R,{spacing:2,children:[e(Ue,{"aria-label":t("common.edit","Edit"),icon:e(Sn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>O(J)}),e(Ue,{"aria-label":t("common.delete","Delete"),icon:e(nn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>Z(J),isLoading:a})]})})]},J.tag)})})]})}):e(ke,{spacing:3,children:U.map(J=>{var q;const E=J.streamSettings||{};return n(N,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(lt,{justify:"space-between",align:"center",mb:2,children:[n(N,{children:[e(h,{fontWeight:"semibold",children:J.tag}),n(h,{fontSize:"sm",color:"gray.500",children:[t("inbounds.portLabel","Port"),": ",J.port]})]}),n(R,{spacing:2,children:[e(Ue,{"aria-label":t("common.edit","Edit"),icon:e(Sn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>O(J)}),e(Ue,{"aria-label":t("common.delete","Delete"),icon:e(nn,{width:16,height:16}),variant:"ghost",size:"sm",onClick:()=>Z(J),isLoading:a})]})]}),n(ke,{spacing:2,children:[n(R,{spacing:2,wrap:"wrap",children:[e(bt,{colorScheme:"purple",children:J.protocol}),E.network&&e(bt,{children:E.network}),E.security&&E.security!=="none"&&e(bt,{colorScheme:"blue",children:E.security})]}),n(R,{spacing:2,wrap:"wrap",children:[(q=J.sniffing)!=null&&q.enabled?e(bt,{size:"sm",colorScheme:"green",children:t("inbounds.sniffingEnabled","Sniffing enabled")}):e(bt,{size:"sm",colorScheme:"gray",children:t("inbounds.sniffingDisabled","Sniffing disabled")}),J.listen&&e(bt,{size:"sm",colorScheme:"gray",children:J.listen})]})]})]},J.tag)})}),e(ep,{isOpen:w,mode:C,initialValue:I,isSubmitting:a,onClose:v,onSubmit:ve})]})},rp=()=>{const{t}=$e();return n(de,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.hostSettings","Inbounds & Hosts")}),n(ls,{colorScheme:"primary",isLazy:!0,children:[n(cs,{children:[e($t,{children:n(R,{spacing:2,children:[e(Es,{as:jo,w:4,h:4}),e("span",{children:t("hostsPage.tabInbounds","Inbounds")})]})}),e($t,{children:n(R,{spacing:2,children:[e(Es,{as:Wo,w:4,h:4}),e("span",{children:t("hostsPage.tabHosts","Hosts")})]})})]}),n(ds,{children:[e(Kt,{px:0,children:n(de,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabInboundsDescription","Manage and customize Xray inbounds, transport layers, security, and sniffing options.")}),e(tp,{})]})}),e(Kt,{px:0,children:n(de,{spacing:4,align:"stretch",children:[e(h,{color:"gray.500",fontSize:"sm",children:t("hostsPage.tabHostsDescription","Assign hosts to inbounds, adjust ordering, and fine-tune SNI, paths, and transport overrides.")}),e(Ih,{})]})})]})]})]})},np=Ae.object({name:Ae.string().min(1),address:Ae.string().min(1),port:Ae.number().min(1).or(Ae.string().transform(t=>parseFloat(t))),api_port:Ae.number().min(1).or(Ae.string().transform(t=>parseFloat(t))),xray_version:Ae.string().nullable().optional(),node_service_version:Ae.string().nullable().optional(),id:Ae.number().nullable().optional(),status:Ae.enum(["connected","connecting","error","disabled","limited"]).nullable().optional(),message:Ae.string().nullable().optional(),add_as_new_host:Ae.boolean().optional(),usage_coefficient:Ae.number().or(Ae.string().transform(t=>parseFloat(t))),data_limit:Ae.number().nullable().optional(),uplink:Ae.number().nullable().optional(),downlink:Ae.number().nullable().optional(),use_nobetci:Ae.boolean().optional(),nobetci_port:Ae.number().nullable().optional()}),Zs=()=>({name:"",address:"",port:62050,api_port:62051,xray_version:"",node_service_version:"",usage_coefficient:1,data_limit:null,uplink:0,downlink:0,use_nobetci:!1,nobetci_port:null}),yr="fetch-nodes-query-key",xa=()=>{const{isEditingNodes:t}=xt();return Nr({queryKey:yr,queryFn:Js.getState().fetchNodes,refetchInterval:t?3e3:void 0,refetchOnWindowFocus:!1})},Js=ns((t,s)=>({nodes:[],addNode(r){return _e("/node",{method:"POST",body:r})},fetchNodes(){return _e("/nodes")},fetchNodesUsage(r){return _e("/nodes/usage",{query:r})},updateNode(r){return _e(`/node/${r.id}`,{method:"PUT",body:r})},setDeletingNode(r){t({deletingNode:r})},reconnectNode(r){return _e(`/node/${r.id}/reconnect`,{method:"POST"})},restartNodeService(r){return _e(`/node/${r.id}/service/restart`,{method:"POST"})},updateNodeService(r){return _e(`/node/${r.id}/service/update`,{method:"POST"})},resetNodeUsage(r){return _e(`/node/${r.id}/usage/reset`,{method:"POST"})},updateMasterNode(r){return _e("/node/master",{method:"PUT",body:r})},resetMasterUsage(){return _e("/node/master/usage/reset",{method:"POST"})},deleteNode:()=>{var r;return _e(`/node/${(r=s().deletingNode)==null?void 0:r.id}`,{method:"DELETE"})}})),co=({expiryDate:t,status:s,compact:r=!1,showDetail:l=!0,extraText:o})=>{const{t:i}=$e(),a=Ci(t),c=An[s].icon;return n(Ot,{children:[n(sn,{colorScheme:An[s].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:r?1:2,alignItems:"center",flexWrap:"wrap",children:[e(c,{w:r?3:4}),l&&n(h,{textTransform:"capitalize",fontSize:r?".7rem":".875rem",lineHeight:r?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",whiteSpace:"normal",textAlign:"left",maxW:{base:"100%",md:"fit-content"},children:[s&&i(`nodeModal.status.${s}`),o&&`: ${o}`]})]}),l&&t&&e(h,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:i(a.status,{time:a.time})})]})},sp=ee(zs,{baseStyle:{w:4,h:4}}),ip=ee(pa,{baseStyle:{w:4,h:4}}),ap=ee(Vc,{baseStyle:{w:4,h:4}}),op=ee(ha,{baseStyle:{w:4,h:4}}),uo=1024*1024*1024,lp=51031,vn=t=>{if(t&&typeof t=="object"&&"message"in t){const s=t.message;return typeof s=="string"?s:void 0}},ho=({isOpen:t,onClose:s,node:r,mutate:l,isLoading:o,isAddMode:i=!1})=>{var ue,Y,re,A,me,De,Ee,W,y,P,ie,te,Ce,Te,Re,Oe,B;const{t:a}=$e(),c=Bt(),[u,p]=d.exports.useState(i),{fetchNodesUsage:m}=Js(),[g,I]=d.exports.useState(null),{data:D,isLoading:w}=Nr({queryKey:"node-settings",queryFn:()=>_e("/node/settings")}),{data:x}=Nr({queryKey:"panel-settings",queryFn:ya,staleTime:5*60*1e3}),v=(ue=x==null?void 0:x.use_nobetci)!=null?ue:!0,C=V=>{if(V==null)return null;const L=V/uo;return Number.isFinite(L)?Math.round(L*100)/100:null},z=V=>V==null?null:Math.round(V*uo),ne=i?{...Zs(),add_as_new_host:!1}:{...Zs(),...r,add_as_new_host:!1},b=Or({resolver:xi(np),defaultValues:{...ne,data_limit:C((Y=ne.data_limit)!=null?Y:null)}}),U=(re=D==null?void 0:D.certificate)!=null?re:"",{onCopy:T,hasCopied:O}=al(U),ve=b.watch("use_nobetci");d.exports.useEffect(()=>{if(!v||!ve){b.getValues("nobetci_port")!==null&&b.setValue("nobetci_port",null);return}const V=b.getValues("nobetci_port");(V==null||V==="")&&b.setValue("nobetci_port",lp)},[ve,b,v]),d.exports.useEffect(()=>{x&&!x.use_nobetci&&(b.getValues("use_nobetci")&&b.setValue("use_nobetci",!1),b.getValues("nobetci_port")!==null&&b.setValue("nobetci_port",null))},[x,b]),d.exports.useEffect(()=>{var V;if(t){const L=i?{...Zs(),add_as_new_host:!1}:{...Zs(),...r,add_as_new_host:!1};b.reset({...L,data_limit:C((V=L.data_limit)!=null?V:null)}),p(i&&!!U)}},[t,i,r,b,U]),d.exports.useEffect(()=>{!i&&r&&t?m({start:Pe().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")}).then(V=>{const L=V.usages[r.id];L&&I({uplink:L.uplink,downlink:L.downlink})}):I(null)},[r,i,t,m]);const Z=b.handleSubmit(V=>{var he;const L={...V,data_limit:z((he=V.data_limit)!=null?he:null)};l(L)}),J=()=>{!U||(T(),c({title:a("copied"),status:"success",isClosable:!0,position:"top",duration:2e3}))},E=()=>{if(!U)return;const V=new Blob([U],{type:"text/plain"}),L=URL.createObjectURL(V),he=document.createElement("a");he.href=L,he.download="ssl_client_cert.pem",he.click(),URL.revokeObjectURL(L)},q=()=>{p(!1),I(null),s()};return n(Ut,{isOpen:t,onClose:q,size:"lg",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",as:"form",onSubmit:Z,children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:a(i?"nodes.addNewRebeccaNode":"nodes.editNode")})}),e(Rt,{mt:3}),e(kt,{children:n(ke,{spacing:6,children:[!i&&g&&n(ke,{spacing:2,children:[e(h,{fontWeight:"medium",children:a("nodes.usage")}),n(R,{children:[n(bt,{colorScheme:"green",children:[a("nodes.uplink"),": ",Dn.sizeFormat(g.uplink)]}),n(bt,{colorScheme:"blue",children:[a("nodes.downlink"),": ",Dn.sizeFormat(g.downlink)]})]})]}),i&&n(ke,{spacing:3,children:[n(R,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"medium",children:a("nodes.certificate")}),n(R,{spacing:2,children:[e(F,{size:"xs",variant:"outline",leftIcon:e(ap,{}),onClick:J,isDisabled:!U,children:a(O?"copied":"copy")}),e(F,{size:"xs",variant:"outline",leftIcon:e(op,{}),onClick:E,isDisabled:!U,children:a("nodes.download-certificate")}),e(ct,{placement:"top",label:a(u?"nodes.hide-certificate":"nodes.show-certificate"),children:e(Ue,{"aria-label":a(u?"nodes.hide-certificate":"nodes.show-certificate"),onClick:()=>p(V=>!V),size:"xs",variant:"ghost",children:u?e(ip,{}):e(sp,{})})})]})]}),e(Xn,{in:u&&!!U,animateOpacity:!0,children:e(N,{borderWidth:"1px",borderRadius:"md",p:3,fontFamily:"mono",fontSize:"xs",maxH:"220px",overflow:"auto",bg:"gray.50",_dark:{bg:"whiteAlpha.100"},children:U||(w?a("loading"):"")})}),!U&&!w&&e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:a("nodes.certificateUnavailable","Certificate not available.")})]}),n(ke,{spacing:4,children:[n(Ve,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(Zt,{label:a("nodes.nodeName"),size:"sm",placeholder:"Rebecca-S2",...b.register("name"),error:vn((me=(A=b.formState)==null?void 0:A.errors)==null?void 0:me.name)})}),e(k,{children:e(Zt,{label:a("nodes.nodeAddress"),size:"sm",placeholder:"51.20.12.13",...b.register("address"),error:vn((Ee=(De=b.formState)==null?void 0:De.errors)==null?void 0:Ee.address)})})]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[e(k,{children:e(Zt,{label:a("nodes.nodePort"),size:"sm",placeholder:"62050",...b.register("port"),error:vn((y=(W=b.formState)==null?void 0:W.errors)==null?void 0:y.port)})}),e(k,{children:e(Zt,{label:a("nodes.nodeAPIPort"),size:"sm",placeholder:"62051",...b.register("api_port"),error:vn((ie=(P=b.formState)==null?void 0:P.errors)==null?void 0:ie.api_port)})})]}),e(k,{children:e(Zt,{label:a("nodes.usageCoefficient"),size:"sm",placeholder:"1",...b.register("usage_coefficient"),error:vn((Ce=(te=b.formState)==null?void 0:te.errors)==null?void 0:Ce.usage_coefficient)})}),n(k,{children:[e(Zt,{label:a("nodes.dataLimitField","Data Limit (GB)"),size:"sm",type:"number",step:.01,min:0,placeholder:a("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)"),...b.register("data_limit",{setValueAs:V=>{if(V===""||V===null||V===void 0)return null;const L=Number(V);return Number.isFinite(L)?L:Number.NaN},validate:V=>V==null?!0:Number.isNaN(V)?a("nodes.dataLimitValidation","Data limit must be a valid number"):V>=0||a("nodes.dataLimitPositive","Data limit must be zero or greater")}),error:vn((Re=(Te=b.formState)==null?void 0:Te.errors)==null?void 0:Re.data_limit)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:a("nodes.dataLimitHint","Leave empty for unlimited data.")})]}),v&&n(Ot,{children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:0,children:a("nodes.useNobetci","Enable Nobetci integration")}),e(pt,{control:b.control,name:"use_nobetci",render:({field:V})=>e(ht,{isChecked:Boolean(V.value),onChange:L=>V.onChange(L.target.checked)})})]}),e(Xn,{in:Boolean(ve),animateOpacity:!0,children:n(k,{mt:ve?2:0,children:[e(Zt,{label:a("nodes.nobetciPort","Nobetci port"),size:"sm",placeholder:"443",...b.register("nobetci_port",{setValueAs:V=>{if(V===""||V===null||V===void 0)return null;const L=Number(V);return Number.isFinite(L)?L:Number.NaN},validate:V=>ve?V==null?a("nodes.nobetciPortRequired","Port is required when Nobetci is enabled"):Number.isNaN(V)?a("nodes.nobetciPortInvalid","Enter a valid port number"):V>=1&&V<=65535?!0:a("nodes.nobetciPortRange","Port must be between 1 and 65535"):!0}),error:vn((B=(Oe=b.formState)==null?void 0:Oe.errors)==null?void 0:B.nobetci_port)}),e(h,{fontSize:"xs",color:"gray.500",mt:1,children:a("nodes.nobetciHint","Provide the Nobetci listener port. Leave blank to disable.")})]})})]})]}),i&&e(N,{children:e(Pr,{...b.register("add_as_new_host"),children:a("nodes.addHostForEveryInbound")})})]})}),n(zt,{gap:3,children:[e(F,{variant:"outline",onClick:q,children:a("cancel")}),e(F,{type:"submit",colorScheme:"primary",isLoading:o,children:a(i?"nodes.addNode":"nodes.editNode")})]})]})]})},cp=({deleteCallback:t})=>{const{deleteNode:s,deletingNode:r,setDeletingNode:l}=Js(),{t:o}=$e(),i=Bt(),a=fa(),c=()=>{l(null)},{isLoading:u,mutate:p}=Dr(s,{onSuccess:()=>{Wt(o("deleteNode.deleteSuccess",{name:r&&r.name}),i),l(null),a.invalidateQueries(yr),t&&t()},onError:m=>{Ft(m,i)}});return n(Ut,{isCentered:!0,isOpen:!!r,onClose:c,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",children:[e(At,{pt:6,children:e(En,{color:"red",children:e(Vs,{})})}),e(Rt,{mt:3}),n(kt,{children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:o("deleteNode.title")}),r&&e(h,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:e(ki,{components:{b:e("b",{})},children:o("deleteNode.prompt",{name:r.name})})})]}),n(zt,{display:"flex",children:[e(F,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:o("cancel")}),e(F,{size:"sm",w:"full",colorScheme:"red",onClick:()=>p(),leftIcon:u?e(Dt,{size:"xs"}):void 0,children:o("delete")})]})]})]})},dp=10,up=({isOpen:t,title:s,description:r,currentVersion:l,allowPersist:o=!1,isSubmitting:i,onSubmit:a,onClose:c})=>{const{t:u}=$e(),[p,m]=d.exports.useState(""),[g,I]=d.exports.useState(!1),[D,w]=d.exports.useState(null),x=Nr(["core-xray-releases"],()=>_e("/core/xray/releases",{query:{limit:dp}}),{enabled:t,staleTime:5*60*1e3});d.exports.useEffect(()=>{t&&(m(l||""),I(!1),w(null))},[t,l]);const v=d.exports.useMemo(()=>{var U,T;return(T=(U=x.data)==null?void 0:U.tags)!=null?T:[]},[x.data]),C=U=>{m(U.target.value)},z=U=>{m(U.target.value)},ne=async()=>{if(!p){w(u("validation.required"));return}try{w(null),await a({version:p,persist:o?g:void 0})}catch(U){U instanceof Error?w(U.message):w(u("core.generalErrorMessage"))}},b=x.isLoading;return n(Ut,{isOpen:t,onClose:c,isCentered:!0,size:"lg",children:[e(wt,{}),n(Lt,{children:[e(At,{children:s}),e(Rt,{}),e(kt,{children:n(ke,{spacing:4,children:[r&&e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:r}),n(k,{children:[e(_,{children:u("nodes.coreVersionDialog.latestReleases")}),e(je,{placeholder:u(b?"nodes.coreVersionDialog.loadingReleases":"nodes.coreVersionDialog.selectVersionPlaceholder"),value:p&&v.includes(p)?p:"",onChange:C,isDisabled:b||v.length===0,size:"sm",children:v.map(U=>e("option",{value:U,children:U},U))}),b&&n(ke,{direction:"row",align:"center",spacing:2,mt:2,children:[e(Dt,{size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:u("nodes.coreVersionDialog.fetchingFromGithub")})]}),x.isError&&e(h,{fontSize:"xs",color:"red.500",mt:1,children:u("nodes.coreVersionDialog.failedToLoadReleases")})]}),n(k,{isRequired:!0,children:[e(_,{children:u("nodes.coreVersionDialog.customVersionLabel")}),e(we,{value:p,placeholder:u("nodes.coreVersionDialog.customVersionPlaceholder"),onChange:z,size:"sm"}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},mt:1,children:u("nodes.coreVersionDialog.customVersionHelper")})]}),o&&e(Pr,{isChecked:g,onChange:U=>I(U.target.checked),children:u("nodes.coreVersionDialog.persistExecutable")}),D&&n(Ir,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Tr,{}),e(yn,{children:D})]})]})}),n(zt,{children:[e(F,{variant:"ghost",mr:3,onClick:c,children:u("cancel")}),e(F,{colorScheme:"primary",onClick:ne,isLoading:i,children:u("nodes.coreVersionDialog.confirmUpdate")})]})]})]})},po="https://raw.githubusercontent.com/ppouria/geo-templates/main/index.json",hp=ee(ol,{baseStyle:{w:3.5,h:3.5}}),pp=ee(un,{baseStyle:{w:3.5,h:3.5}}),mp=ee(Kr,{baseStyle:{w:4,h:4}}),gp=({isOpen:t,title:s,isSubmitting:r,showMasterOptions:l=!1,defaultTemplateIndexUrl:o,onSubmit:i,onClose:a})=>{const{t:c}=$e(),[u,p]=d.exports.useState("template"),[m,g]=d.exports.useState(po),[I,D]=d.exports.useState(""),[w,x]=d.exports.useState([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),[v,C]=d.exports.useState(!0),[z,ne]=d.exports.useState(!1),[b,U]=d.exports.useState(null);d.exports.useEffect(()=>{t&&(p("template"),g(o||po),D(""),x([{name:"geoip.dat",url:""},{name:"geosite.dat",url:""}]),C(!0),ne(!1),U(null))},[t,o]);const T=Nr(["geo-templates",m],()=>_e("/core/geo/templates",{query:m?{index_url:m}:void 0}),{enabled:t&&u==="template"&&Boolean(m),staleTime:10*60*1e3}),O=d.exports.useMemo(()=>{var Y,re;return(re=(Y=T.data)==null?void 0:Y.templates)!=null?re:[]},[T.data]);d.exports.useEffect(()=>{O.length>0&&D(Y=>Y||O[0].name)},[O]);const ve=st("gray.50","whiteAlpha.50"),Z=()=>{x(Y=>[...Y,{name:"",url:""}])},J=(Y,re,A)=>{x(me=>me.map((De,Ee)=>Ee===Y?{...De,[re]:A}:De))},E=Y=>{x(re=>re.filter((A,me)=>me!==Y))},q=async()=>{const Y=u==="manual"?w.filter(A=>A.name.trim()&&A.url.trim()):[];if(u==="template"){if(!m.trim()){U(c("nodes.geoDialog.errors.missingTemplateUrl"));return}if(!I){U(c("nodes.geoDialog.errors.missingTemplateName"));return}}else{if(Y.length===0){U(c("nodes.geoDialog.errors.missingFiles"));return}if(Y.find(me=>!me.name.trim()||!me.url.trim())){U(c("nodes.geoDialog.errors.invalidFile"));return}}U(null);const re=u==="manual"?Y:[];try{await i({mode:u,templateIndexUrl:m.trim(),templateName:I,files:re,persistEnv:v,applyToNodes:z})}catch(A){const me=A instanceof Error?A.message:c("nodes.geoDialog.genericError");U(me)}},ue=()=>n(ke,{spacing:3,bg:ve,p:4,borderRadius:"md",children:[w.map((Y,re)=>n(N,{borderWidth:"1px",borderRadius:"md",p:3,children:[n(Ve,{columns:{base:1,md:2},spacing:3,children:[n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.fileNameLabel")}),e(we,{size:"sm",value:Y.name,placeholder:"geosite.dat",onChange:A=>J(re,"name",A.target.value)})]}),n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.fileUrlLabel")}),e(we,{size:"sm",value:Y.url,placeholder:"https://example.com/geosite.dat",onChange:A=>J(re,"url",A.target.value)})]})]}),e(R,{justify:"flex-end",mt:3,children:e(ct,{label:c("nodes.geoDialog.removeFile"),children:e(Ue,{"aria-label":"remove file",icon:e(hp,{}),variant:"ghost",size:"sm",onClick:()=>E(re),isDisabled:w.length<=1})})})]},`manual-file-${re}`)),e(F,{onClick:Z,leftIcon:e(pp,{}),size:"sm",alignSelf:"flex-start",variant:"outline",children:c("nodes.geoDialog.addFile")})]});return n(Ut,{isOpen:t,onClose:a,size:"xl",isCentered:!0,children:[e(wt,{}),n(Lt,{children:[e(At,{children:s}),e(Rt,{}),e(kt,{children:n(ke,{spacing:4,children:[n(k,{as:"fieldset",children:[e(_,{as:"legend",fontSize:"sm",children:c("nodes.geoDialog.modeLabel")}),e(fi,{value:u,onChange:Y=>p(Y),children:n(R,{spacing:4,children:[e(Qr,{value:"template",children:c("nodes.geoDialog.modeTemplate")}),e(Qr,{value:"manual",children:c("nodes.geoDialog.modeManual")})]})})]}),u==="template"?n(ke,{spacing:3,children:[n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.templateIndexLabel")}),e(we,{size:"sm",value:m,onChange:Y=>g(Y.target.value)})]}),n(k,{isRequired:!0,children:[e(_,{fontSize:"sm",children:c("nodes.geoDialog.templateNameLabel")}),n(R,{align:"center",spacing:2,children:[e(je,{size:"sm",flex:1,value:I,onChange:Y=>D(Y.target.value),isDisabled:T.isLoading||!O.length,placeholder:T.isLoading?c("nodes.geoDialog.loadingTemplates"):c("nodes.geoDialog.selectTemplatePlaceholder"),children:O.map(Y=>e("option",{value:Y.name,children:Y.name},Y.name))}),e(ct,{label:c("nodes.geoDialog.refreshTemplates"),children:e(Ue,{"aria-label":"refresh templates",icon:e(mp,{}),size:"sm",variant:"outline",onClick:()=>T.refetch(),isLoading:T.isFetching,isDisabled:!m.trim()})})]})]}),T.isError&&n(Ir,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Tr,{}),e(yn,{children:c("nodes.geoDialog.failedToLoadTemplates")})]})]}):ue(),l&&n(ke,{spacing:2,children:[e(Pr,{isChecked:v,onChange:Y=>C(Y.target.checked),children:c("nodes.geoDialog.persistAssets")}),e(Pr,{isChecked:z,onChange:Y=>ne(Y.target.checked),children:c("nodes.geoDialog.applyToNodes")}),e(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:c("nodes.geoDialog.applyToNodesHint")})]}),b&&n(Ir,{status:"error",borderRadius:"md",fontSize:"sm",children:[e(Tr,{}),e(yn,{children:b})]})]})}),n(zt,{children:[e(F,{variant:"ghost",mr:3,onClick:a,children:c("cancel")}),e(F,{colorScheme:"primary",onClick:q,isLoading:r,children:c("nodes.geoDialog.confirmUpdate")})]})]})]})};Pe.extend(Bs);const fp=ee(un,{baseStyle:{w:4,h:4}}),bp=ee(nn,{baseStyle:{w:4,h:4}}),yp=ee(Sn,{baseStyle:{w:4,h:4}}),mo=ee(Kr,{baseStyle:{w:4,h:4}}),Sp=ee($o,{baseStyle:{w:4,h:4}}),Nl=1024**3,xp=t=>{if(t==null)return"";const s=t/Nl;return Number.isFinite(s)?(Math.round(s*100)/100).toString():""},go=t=>{const s=t.trim();if(!s)return null;const r=Number(s);if(!(!Number.isFinite(r)||r<0))return r===0?null:Math.round(r*Nl)},wp=()=>{var ms,gs,fs,f,S,j,Je,tt,qe,yt,gr,xn,gn;const{t}=$e(),{onEditingNodes:s}=xt(),r=xt(se=>se.isEditingNodes),{data:l,isLoading:o,error:i,refetch:a,isFetching:c}=xa(),{addNode:u,updateNode:p,reconnectNode:m,restartNodeService:g,updateNodeService:I,resetNodeUsage:D,updateMasterNode:w,resetMasterUsage:x,setDeletingNode:v}=Js(),C=fa(),z=Bt(),[ne,b]=d.exports.useState(null),[U,T]=d.exports.useState(!1),[O,ve]=d.exports.useState(""),[Z,J]=d.exports.useState(null),[E,q]=d.exports.useState(null),[ue,Y]=d.exports.useState(null),[re,A]=d.exports.useState(null),[me,De]=d.exports.useState(!1),[Ee,W]=d.exports.useState(!1),[y,P]=d.exports.useState(!1),[ie,te]=d.exports.useState(null),[Ce,Te]=d.exports.useState({}),[Re,Oe]=d.exports.useState(null),[B,V]=d.exports.useState(null),[L,he]=d.exports.useState(null),[ze,at]=d.exports.useState(null),{isOpen:pe,onOpen:oe,onClose:le}=Yt(),$=d.exports.useRef(null),[ye,ut]=d.exports.useState(""),[mt,Q]=d.exports.useState(!1),{isOpen:H,onOpen:Se,onClose:Me}=Yt(),Fe=d.exports.useRef(null),{data:Be,isLoading:ce,refetch:ge,error:We}=Nr(["core-stats"],()=>_e("/core"),{refetchOnWindowFocus:!1}),{data:Ie,isLoading:ot,error:gt,refetch:Mt}=Nr(["master-node-state"],()=>_e("/node/master"),{refetchInterval:r?3e3:void 0,refetchOnWindowFocus:!1});d.exports.useEffect(()=>(s(!0),()=>{s(!1)}),[s]),d.exports.useEffect(()=>{var dt,Ze;if(!Ie)return;if(mt){const ft=go(ye),Tt=(dt=Ie.data_limit)!=null?dt:null;if(ft!==Tt)return}const se=xp((Ze=Ie.data_limit)!=null?Ze:null);ut(se),mt&&Q(!1)},[Ie,mt,ye]);const{isLoading:et,mutate:jt}=Dr(u,{onSuccess:()=>{Wt(t("nodes.addNodeSuccess"),z),C.invalidateQueries(yr),T(!1)},onError:se=>{Ft(se,z)}}),{isLoading:hr,mutate:sr}=Dr(p,{onSuccess:()=>{Wt(t("nodes.nodeUpdated"),z),C.invalidateQueries(yr),b(null)},onError:se=>{Ft(se,z)}}),{isLoading:pr,mutate:er}=Dr(m,{onSuccess:()=>{C.invalidateQueries(yr)}}),{mutate:ir,isLoading:ar}=Dr(p,{onSuccess:()=>{C.invalidateQueries(yr)},onError:se=>{Ft(se,z)},onSettled:(se,dt,Ze)=>{(Ze==null?void 0:Ze.id)!=null&&Te(ft=>{const Tt={...ft};return delete Tt[Ze.id],Tt}),te(null)}}),{isLoading:tr,mutate:or}=Dr(D,{onSuccess:()=>{Wt(t("nodes.resetUsageSuccess","Node usage reset"),z),C.invalidateQueries(yr)},onError:se=>{Ft(se,z)},onSettled:()=>{Oe(null),V(null),le()}}),{mutate:G,isLoading:be}=Dr(g,{onMutate:se=>{var dt;he((dt=se.id)!=null?dt:null)},onSuccess:()=>{Wt(t("nodes.restartServiceTriggered","Node restart requested"),z),C.invalidateQueries(yr)},onError:se=>{Ft(se,z)},onSettled:()=>{he(null)}}),{mutate:X,isLoading:rt}=Dr(I,{onMutate:se=>{var dt;at((dt=se.id)!=null?dt:null)},onSuccess:()=>{Wt(t("nodes.updateServiceTriggered","Node update requested"),z),C.invalidateQueries(yr)},onError:se=>{Ft(se,z)},onSettled:()=>{at(null)}}),{isLoading:M,mutate:xe}=Dr(w,{onSuccess:()=>{Wt(t("nodes.masterLimitUpdateSuccess","Master data limit saved"),z),Mt(),Q(!1)},onError:se=>{Ft(se,z)}}),{isLoading:Le,mutate:Ke}=Dr(x,{onSuccess:()=>{Wt(t("nodes.resetMasterUsageSuccess","Master usage reset"),z),Mt(),Me()},onError:se=>{Ft(se,z)}}),Ge=d.exports.useMemo(()=>go(ye),[ye]),it=(ms=Ie==null?void 0:Ie.data_limit)!=null?ms:null,Nt=Ge===void 0,Vt=Ge!==void 0&&Ge!==it,kr=ce||ot,Gt=d.exports.useMemo(()=>{if(We instanceof Error)return We.message;if(typeof We=="string")return We;if(gt instanceof Error)return gt.message;if(typeof gt=="string")return gt},[We,gt]),lr=(gs=Ie==null?void 0:Ie.total_usage)!=null?gs:0,Pt=(fs=Ie==null?void 0:Ie.data_limit)!=null?fs:null,nt=(f=Ie==null?void 0:Ie.remaining_data)!=null?f:null,vt=Ie!=null&&Ie.updated_at?Pe(Ie.updated_at).local().format("YYYY-MM-DD HH:mm"):null,Wr=(S=Ie==null?void 0:Ie.status)!=null?S:"error",Fr=Xe(lr,2),Qt=Pt!==null&&Pt>0?Xe(Pt,2):t("nodes.unlimited","Unlimited"),vr=nt!=null?Xe(nt,2):null,Xt=se=>{Q(!0),ut(se)},zr=()=>{if(Nt||Ge===void 0){Ft(t("nodes.dataLimitValidation","Data limit must be a non-negative number"),z);return}xe({data_limit:Ge!=null?Ge:null})},mn=()=>{Q(!0),ut(""),xe({data_limit:null})},It=()=>{Se()},rr=se=>{if(!(se!=null&&se.id))return;const dt=se.status!=="disabled",Ze=dt?"disabled":"connecting",ft=se.id;te(ft),Te(Tt=>({...Tt,[ft]:!dt})),ir({...se,status:Ze})},Ct=se=>{!(se!=null&&se.id)||(V(se),oe())},Cr=se=>{if(!(se!=null&&se.id))return;const dt=se.name||se.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.restartServiceConfirm","Send a restart request to {{name}}? Services will be interrupted briefly.",{name:dt}))||G(se)},Rr=se=>{if(!(se!=null&&se.id))return;const dt=se.name||se.address||t("nodes.thisNode","this node");!window.confirm(t("nodes.updateServiceConfirm","Send an update request to {{name}}? The node will download updates and restart.",{name:dt}))||X(se)},fe=()=>{!(B!=null&&B.id)||(Oe(B.id),or(B))},mr=()=>{V(null),le()},cr=()=>J(null),Mr=()=>q(null),Un=async({version:se,persist:dt})=>{var Ze;if(!!Z){if(Z.type==="master"){De(!0);try{await _e("/core/xray/update",{method:"POST",body:{version:se,persist_env:Boolean(dt)}}),Wt(t("nodes.coreVersionDialog.masterUpdateSuccess",{version:se}),z),await Promise.all([ge(),C.invalidateQueries(yr)]),cr()}catch(ft){Ft(ft,z)}finally{De(!1)}return}if(Z.type==="bulk"){const ft=(l!=null?l:[]).filter(Tt=>Tt.id!=null&&Tt.status==="connected");if(ft.length===0){z({title:t("nodes.coreVersionDialog.noConnectedNodes","No connected nodes available for update."),status:"warning",isClosable:!0,position:"top"});return}W(!0);try{const Tt=[];for(const wn of ft)try{await _e(`/node/${wn.id}/xray/update`,{method:"POST",body:{version:se}}),Tt.push({status:"fulfilled",node:wn})}catch(Pi){Tt.push({status:"rejected",node:wn}),Ft(Pi,z)}const Hr=Tt.filter(wn=>wn.status==="fulfilled").length,qr=Tt.length-Hr,Yr=Tt.length;Hr>0&&Wt(t("nodes.coreVersionDialog.bulkSuccess",{success:Hr,total:Yr}),z),qr>0&&z({title:t("nodes.coreVersionDialog.bulkPartialError",{failed:qr,total:Yr}),status:"error",isClosable:!0,position:"top",duration:4e3}),C.invalidateQueries(yr),cr()}finally{W(!1)}return}if(Z.type==="node"){const ft=Z.node;if(!(ft!=null&&ft.id))return;Y(ft.id);try{await _e(`/node/${ft.id}/xray/update`,{method:"POST",body:{version:se}}),Wt(t("nodes.coreVersionDialog.nodeUpdateSuccess",{name:(Ze=ft.name)!=null?Ze:t("nodes.unnamedNode","Unnamed node"),version:se}),z),C.invalidateQueries(yr),cr()}catch(Tt){Ft(Tt,z)}finally{Y(null)}}}},Ln=async se=>{var Ze;if(!E)return;const dt={mode:se.mode,template_index_url:se.templateIndexUrl,template_name:se.templateName,files:se.files,persist_env:se.persistEnv};if(E.type==="master"){P(!0);try{await _e("/core/geo/update",{method:"POST",body:dt}),Wt(t("nodes.geoDialog.masterUpdateSuccess"),z),Mr()}catch(ft){Ft(ft,z)}finally{P(!1)}return}if(E.type==="node"){const ft=E.node;if(!(ft!=null&&ft.id))return;A(ft.id);try{await _e(`/node/${ft.id}/geo/update`,{method:"POST",body:dt}),Wt(t("nodes.geoDialog.nodeUpdateSuccess",{name:(Ze=ft.name)!=null?Ze:t("nodes.unnamedNode","Unnamed node")}),z),C.invalidateQueries(yr),Mr()}catch(Tt){Ft(Tt,z)}finally{A(null)}}},qs=d.exports.useMemo(()=>{if(!l)return[];const se=O.trim().toLowerCase();return se?l.filter(dt=>{var Hr,qr,Yr;const Ze=((Hr=dt.name)!=null?Hr:"").toLowerCase(),ft=((qr=dt.address)!=null?qr:"").toLowerCase(),Tt=((Yr=dt.xray_version)!=null?Yr:"").toLowerCase();return Ze.includes(se)||ft.includes(se)||Tt.includes(se)}):l},[l,O]),Ys=d.exports.useMemo(()=>(l!=null?l:[]).some(se=>se.id!=null&&se.status==="connected"),[l]),Gs=d.exports.useMemo(()=>{if(!!i){if(i instanceof Error)return i.message;if(typeof i=="string")return i;if(typeof i=="object"&&"message"in i){const se=i.message;if(typeof se=="string")return se}return t("errorOccurred")}},[i,t]),_i=Boolean(Gs),hs=t("nodes.masterNode","Master"),ps=O.trim().toLowerCase(),Di=!ps||hs.toLowerCase().includes(ps)||((j=Be==null?void 0:Be.version)!=null?j:"").toLowerCase().includes(ps),an=(Z==null?void 0:Z.type)==="master"?me:(Z==null?void 0:Z.type)==="node"?Z.node.id!=null&&ue===Z.node.id:(Z==null?void 0:Z.type)==="bulk"?Ee:!1,On=(E==null?void 0:E.type)==="master"?y:(E==null?void 0:E.type)==="node"?E.node.id!=null&&re===E.node.id:!1,Ai=(Z==null?void 0:Z.type)==="master"?t("nodes.coreVersionDialog.masterTitle"):(Z==null?void 0:Z.type)==="bulk"?t("nodes.coreVersionDialog.bulkTitle"):(Z==null?void 0:Z.type)==="node"?t("nodes.coreVersionDialog.nodeTitle",{name:(Je=Z.node.name)!=null?Je:t("nodes.unnamedNode","Unnamed node")}):"",Ii=(Z==null?void 0:Z.type)==="master"?t("nodes.coreVersionDialog.masterDescription"):(Z==null?void 0:Z.type)==="bulk"?t("nodes.coreVersionDialog.bulkDescription"):(Z==null?void 0:Z.type)==="node"?t("nodes.coreVersionDialog.nodeDescription",{name:(tt=Z.node.name)!=null?tt:t("nodes.unnamedNode","Unnamed node")}):"",Ti=(Z==null?void 0:Z.type)==="master"?(qe=Be==null?void 0:Be.version)!=null?qe:"":(Z==null?void 0:Z.type)==="node"&&(yt=Z.node.xray_version)!=null?yt:"",Qs=(E==null?void 0:E.type)==="master"?t("nodes.geoDialog.masterTitle"):(E==null?void 0:E.type)==="node"?t("nodes.geoDialog.nodeTitle",{name:(gr=E.node.name)!=null?gr:t("nodes.unnamedNode","Unnamed node")}):"";return n(de,{spacing:6,align:"stretch",children:[n(ke,{spacing:1,children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.nodes")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("nodes.pageDescription","Manage your master and satellite nodes. Update core versions, control availability, and edit node settings.")})]}),_i&&n(Ir,{status:"error",borderRadius:"md",children:[e(Tr,{}),e(yn,{children:Gs})]}),n(ke,{direction:{base:"column",lg:"row"},spacing:{base:3,lg:4},alignItems:{base:"stretch",lg:"center"},justifyContent:"space-between",w:"full",children:[e(h,{fontWeight:"semibold",children:t("nodes.manageNodesHeader","Node list")}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:3},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:{base:"full",lg:"auto"},children:[n(R,{spacing:2,alignItems:"center",justifyContent:"flex-end",w:{base:"full",md:"auto"},children:[n(wr,{size:"sm",maxW:{base:"full",md:"260px"},children:[e(Ko,{pointerEvents:"none",children:e(Sp,{color:"gray.400"})}),e(we,{value:O,onChange:se=>ve(se.target.value),placeholder:t("nodes.searchPlaceholder","Search nodes")})]}),e(ct,{label:t("nodes.refreshNodes","Refresh nodes"),children:e(Ue,{"aria-label":t("nodes.refreshNodes","Refresh nodes"),icon:e(mo,{}),variant:"ghost",size:"sm",onClick:()=>a(),isLoading:c})})]}),n(ke,{direction:{base:"column",sm:"row"},spacing:2,justify:"flex-end",alignItems:{base:"flex-end",sm:"center"},children:[e(F,{variant:"outline",size:"sm",onClick:()=>J({type:"bulk"}),isDisabled:!Ys,w:{base:"auto",sm:"auto"},px:{base:4,sm:4},children:t("nodes.updateAllNodesCore")}),e(F,{leftIcon:e(fp,{}),colorScheme:"primary",size:"sm",onClick:()=>T(!0),w:{base:"auto",sm:"auto"},px:{base:4,sm:5},children:t("nodes.addNode")})]})]})]}),o?e(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:Array.from({length:3}).map((se,dt)=>e(N,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:n(de,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]})},`nodes-skeleton-${dt}`))}):n(Ve,{columns:{base:1,md:2,xl:3},spacing:4,children:[Di&&e(N,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:kr?n(de,{spacing:3,align:"center",justify:"center",children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Gt?n(de,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Gt}),e(F,{size:"sm",variant:"outline",onClick:()=>{ge(),Mt()},children:t("refresh","Refresh")})]}):Ie?n(de,{align:"stretch",spacing:4,children:[n(ke,{spacing:2,children:[n(R,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:hs}),e(bt,{colorScheme:"purple",size:"sm",children:Be!=null&&Be.version?`Xray ${Be.version}`:t("nodes.versionUnknown","Version unknown")})]}),n(R,{spacing:2,align:"center",children:[e(co,{status:Wr,compact:!0}),Ie.limit_exceeded&&e(bt,{colorScheme:"red",size:"sm",children:t("nodes.limitReached","Limit reached")})]}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:Be!=null&&Be.started?t("nodes.masterStartedAt",{date:Pe(Be.started).local().format("YYYY-MM-DD HH:mm")}):t("nodes.masterStartedUnknown","Start time unavailable")})]}),Ie.message&&n(Ir,{status:"warning",variant:"left-accent",borderRadius:"md",children:[e(Tr,{}),e(yn,{fontSize:"sm",children:Ie.message})]}),e(Yn,{}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Fr})]}),n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:Qt})]}),vr&&n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.remainingData","Remaining data")}),e(h,{fontWeight:"medium",children:vr})]}),vt&&n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.lastUpdated","Last updated")}),e(h,{fontWeight:"medium",children:vt})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:2,align:{base:"stretch",md:"center"},children:[n(wr,{size:"sm",maxW:{base:"full",md:"240px"},children:[e(we,{type:"number",step:"0.01",min:0,inputMode:"decimal",value:ye,onChange:se=>Xt(se.target.value),placeholder:t("nodes.dataLimitPlaceholder","e.g., 500 (empty = unlimited)")}),e(Er,{pointerEvents:"none",children:e(h,{fontSize:"xs",color:"gray.500",children:"GB"})})]}),e(F,{colorScheme:"primary",size:"sm",onClick:zr,isDisabled:!Vt||Nt||M,isLoading:M,children:t("save","Save")}),e(F,{variant:"ghost",size:"sm",onClick:mn,isDisabled:Pt===null||M,isLoading:M&&Pt===null,children:t("nodes.clearDataLimit","Clear limit")})]}),Nt&&e(h,{fontSize:"xs",color:"red.500",children:t("nodes.dataLimitValidation","Data limit must be a non-negative number")}),n(ke,{direction:{base:"column",sm:"row"},spacing:2,children:[e(F,{size:"sm",variant:"outline",colorScheme:"primary",onClick:()=>J({type:"master"}),isLoading:me,children:t("nodes.coreVersionDialog.updateMasterButton")}),e(F,{size:"sm",variant:"outline",onClick:()=>q({type:"master"}),isLoading:y,children:t("nodes.geoDialog.updateMasterButton")}),e(F,{size:"sm",variant:"outline",colorScheme:"red",onClick:It,isLoading:Le,children:t("nodes.resetUsage","Reset usage")})]})]}):n(de,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.masterLoadFailed","Unable to load master details.")}),e(F,{size:"sm",variant:"outline",onClick:()=>{ge(),Mt()},children:t("refresh","Refresh")})]})},"master-node"),qs.length>0?qs.map(se=>{var ka,va,Ca,_a;const dt=se.status||"error",Ze=se==null?void 0:se.id,ft=dt!=="disabled"&&dt!=="limited",Tt=Ze!=null?Ce[Ze]:void 0,Hr=Tt!=null?Tt:ft,qr=Ze!=null&&ie===Ze&&ar,Yr=Ze!=null&&ue===Ze,wn=Ze!=null&&re===Ze,Pi=be&&Ze!=null&&L===Ze,Ol=rt&&Ze!=null&&ze===Ze,wa=e(co,{status:dt,compact:!0}),Wl=dt==="error"&&se.message?e(ct,{label:se.message,hasArrow:!0,placement:"top",openDelay:300,children:e(N,{as:"span",children:wa})}):wa;return e(N,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",_hover:{boxShadow:"md"},transition:"box-shadow 0.2s ease-in-out",children:n(de,{align:"stretch",spacing:4,children:[n(ke,{spacing:2,children:[n(R,{spacing:3,align:"center",flexWrap:"wrap",children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:se.name||t("nodes.unnamedNode","Unnamed node")}),e(ht,{size:"sm",colorScheme:"primary",isChecked:Hr,onChange:()=>rr(se),isDisabled:qr,"aria-label":t("nodes.toggleAvailability","Toggle node availability")}),se.status==="error"&&e(F,{size:"sm",variant:"outline",leftIcon:e(mo,{}),onClick:()=>er(se),isLoading:pr,children:t("nodes.reconnect")})]}),n(R,{spacing:2,flexWrap:"wrap",children:[Wl,n(R,{spacing:1,align:"center",children:[e(bt,{colorScheme:"blue",size:"sm",children:se.xray_version?`Xray ${se.xray_version}`:t("nodes.versionUnknown","Version unknown")}),e(bt,{colorScheme:"green",size:"sm",children:se.node_service_version?t("nodes.nodeServiceVersionTag",{version:se.node_service_version}):t("nodes.nodeServiceVersionUnknown","Node version unknown")}),e(F,{size:"xs",variant:"ghost",colorScheme:"primary",onClick:()=>Ze&&J({type:"node",node:se}),isLoading:Yr,isDisabled:!Ze,children:t("nodes.updateCoreAction")})]}),e(F,{size:"xs",variant:"ghost",onClick:()=>Ze&&q({type:"node",node:se}),isLoading:wn,isDisabled:!Ze,children:t("nodes.updateGeoAction","Update geo")}),e(F,{size:"xs",variant:"ghost",colorScheme:"orange",onClick:()=>Cr(se),isLoading:Pi,isDisabled:!Ze,children:t("nodes.restartServiceAction","Restart node service")}),e(F,{size:"xs",variant:"ghost",colorScheme:"teal",onClick:()=>Rr(se),isLoading:Ol,isDisabled:!Ze,children:t("nodes.updateServiceAction","Update node service")}),e(F,{size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Ct(se),isLoading:tr&&Ze!=null&&Re===Ze,isDisabled:!Ze,children:t("nodes.resetUsage","Reset usage")})]}),dt==="limited"&&e(h,{fontSize:"sm",color:"red.500",children:t("nodes.limitedStatusDescription","This node is limited because its data limit is exhausted. Increase the limit or reset usage to reconnect it.")})]}),e(Yn,{}),n(Ve,{columns:{base:1,sm:2},spacingY:2,children:[n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAddress")}),e(h,{fontWeight:"medium",children:se.address})]}),n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodePort")}),e(h,{fontWeight:"medium",children:se.port})]}),n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.nodeAPIPort")}),e(h,{fontWeight:"medium",children:se.api_port})]}),n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.usageCoefficient","Usage coefficient")}),e(h,{fontWeight:"medium",children:se.usage_coefficient})]}),n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.totalUsage","Total usage")}),e(h,{fontWeight:"medium",children:Xe(((ka=se.uplink)!=null?ka:0)+((va=se.downlink)!=null?va:0),2)})]}),n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("nodes.dataLimitLabel","Data limit")}),e(h,{fontWeight:"medium",children:se.data_limit!=null&&se.data_limit>0?Xe(se.data_limit,2):t("nodes.unlimited","Unlimited")})]})]}),e(Yn,{}),n(R,{justify:"space-between",align:"center",flexWrap:"wrap",gap:2,children:[n(h,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.id","ID"),": ",(Ca=se.id)!=null?Ca:"-"]}),n(Jo,{size:"sm",variant:"ghost",children:[e(Ue,{"aria-label":t("edit"),icon:e(yp,{}),onClick:()=>b(se)}),e(Ue,{"aria-label":t("delete"),icon:e(bp,{}),colorScheme:"red",onClick:()=>v(se)})]})]})]})},(_a=se.id)!=null?_a:se.name)}):e(N,{borderWidth:"1px",borderRadius:"lg",p:6,boxShadow:"sm",display:"flex",alignItems:"center",justifyContent:"center",children:e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},textAlign:"center",children:t("nodes.noNodesFound","No nodes match the current filters.")})})]}),e(up,{isOpen:Boolean(Z),onClose:cr,onSubmit:Un,currentVersion:Ti,title:Ai,description:Ii,allowPersist:(Z==null?void 0:Z.type)==="master",isSubmitting:an}),e(gp,{isOpen:Boolean(E),onClose:Mr,onSubmit:Ln,title:Qs,showMasterOptions:(E==null?void 0:E.type)==="master",isSubmitting:On}),e(Ms,{isOpen:pe,leastDestructiveRef:$,onClose:mr,children:e(wt,{children:n(Us,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(kt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:(gn=(xn=B==null?void 0:B.name)!=null?xn:B==null?void 0:B.address)!=null?gn:t("nodes.thisNode","this node")})}),n(zt,{children:[e(F,{ref:$,onClick:mr,children:t("cancel","Cancel")}),e(F,{colorScheme:"red",onClick:fe,ml:3,isLoading:tr,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(Ms,{isOpen:H,leastDestructiveRef:Fe,onClose:Me,children:e(wt,{children:n(Us,{children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("nodes.resetUsage","Reset usage")}),e(kt,{children:t("nodes.resetUsageConfirm","Are you sure you want to reset usage for {{name}}?",{name:hs})}),n(zt,{children:[e(F,{ref:Fe,onClick:Me,children:t("cancel","Cancel")}),e(F,{colorScheme:"red",onClick:()=>Ke(),ml:3,isLoading:Le,children:t("nodes.resetUsage","Reset usage")})]})]})})}),e(ho,{isOpen:U,onClose:()=>T(!1),mutate:jt,isLoading:et,isAddMode:!0}),e(ho,{isOpen:!!ne,onClose:()=>b(null),node:ne||void 0,mutate:sr,isLoading:hr}),e(cp,{deleteCallback:()=>C.invalidateQueries(yr)})]})},kp=ns(t=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:null,fetchCoreSettings:async()=>{t({isLoading:!0});try{await Promise.all([_e("/core").then(({version:s,started:r,logs_websocket:l})=>{t({version:s,started:r,logs_websocket:l})}).catch(s=>{throw console.error("Error fetching /core:",s),s}),_e("/core/config").then(s=>{t({config:s})}).catch(s=>{throw console.error("Error fetching /core/config:",s),s})])}finally{t({isLoading:!1})}},updateConfig:s=>(t({isPostLoading:!0}),_e("/core/config",{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(r=>r).catch(r=>{throw console.error("Update error:",r),r}).finally(()=>t({isPostLoading:!1}))),restartCore:()=>_e("/core/restart",{method:"POST"})}));const ia=d.exports.forwardRef(({json:t,onChange:s,mode:r="code"},l)=>{const{colorMode:o}=Jr(),i=d.exports.useRef(null),a=d.exports.useRef(null),c=d.exports.useRef(s),u=d.exports.useRef(null);d.exports.useEffect(()=>{c.current=s},[s]);const p=d.exports.useCallback(D=>{u.current=D,c.current(D)},[]);d.exports.useEffect(()=>{if(!i.current)return;const D=new $c(i.current,{mode:r,onChangeText:p,statusBar:!1,mainMenuBar:!1,theme:o==="dark"?"ace/theme/one_dark":"ace/theme/github"});a.current=D;const w=D.aceEditor;w&&(w.setOptions({enableBasicAutocompletion:!1,enableLiveAutocompletion:!1}),w.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github"));try{typeof t=="string"?D.setText(t):t!==void 0&&D.set(t)}catch{typeof t=="string"&&D.updateText(t)}return()=>{D.destroy(),a.current=null}},[]),d.exports.useEffect(()=>{const D=a.current;if(!D)return;const x=(C=>{if(C==null)return"";if(typeof C=="string")return C;try{return JSON.stringify(C,null,2)}catch{return""}})(t);if(x===null)return;if(u.current!==null){let C=u.current;try{C=JSON.stringify(JSON.parse(u.current),null,2)}catch{}if(u.current=null,C===x)return}let v=null;try{v=D.getText()}catch{v=null}if(v!==x)if(typeof t=="string")try{D.updateText(x)}catch{D.setText(x)}else{const C=t==null?{}:t;try{D.update(C)}catch{D.set(C)}}},[t]),d.exports.useEffect(()=>{const D=a.current;if(!!D)try{D.getMode&&D.getMode()!==r?D.setMode(r):D.getMode||D.setMode(r)}catch{D.setMode(r)}},[r]),d.exports.useEffect(()=>{var w;const D=(w=a.current)==null?void 0:w.aceEditor;!D||D.setTheme(o==="dark"?"ace/theme/one_dark":"ace/theme/github")},[o]);const m=st("gray.300","whiteAlpha.300"),g=st("surface.light","surface.dark"),I=st("sm","none");return e(N,{ref:l,border:"1px solid",borderColor:m,bg:g,borderRadius:"lg",h:"full",boxShadow:I,overflow:"hidden",children:e(N,{height:"full",ref:i})})}),vp=ee(Fs,{baseStyle:{w:4,h:4}}),Cp=ee(Zo,{baseStyle:{w:4,h:4}}),zl=({triggerLabel:t,title:s,children:r})=>{const l=xr({base:!0,md:!1});return n(ss,{placement:l?"bottom":"right",isLazy:!0,children:[e(is,{children:e(F,{size:"xs",variant:"outline",children:t!=null?t:e(vp,{})})}),n(as,{children:[e(Hs,{}),e(il,{}),s&&e(Kc,{fontWeight:"semibold",children:s}),e(os,{children:r})]})]})},_p=({chips:t,color:s="blue"})=>{const r=t[0],l=t.slice(1);return n(R,{spacing:2,align:"center",children:[r?e(bt,{size:"sm",colorScheme:s,children:r}):e(h,{color:"gray.400",children:"-"}),l.length>0&&e(zl,{triggerLabel:n(bt,{size:"sm",children:["+",l.length]}),title:"Details",children:e(de,{align:"stretch",children:t.map((o,i)=>e(R,{justify:"space-between",children:e(h,{children:o})},i))})})]})},Dp=({text:t,label:s})=>{const r=t&&t.length>40?`${t.slice(0,36)}...`:t||"-",{hasCopied:l,onCopy:o}=al(t!=null?t:"");return e(R,{spacing:2,align:"center",children:e(zl,{triggerLabel:r,title:s,children:n(de,{align:"stretch",children:[e(h,{wordBreak:"break-all",children:t}),n(R,{children:[e(Ue,{"aria-label":"copy",size:"sm",icon:e(Cp,{}),onClick:o}),e(h,{fontSize:"sm",children:l?"Copied":"Copy"})]})]})})})},fo=500,Ap=t=>{try{let s=new URL("https://bot.mazholl.com:8585/api".startsWith("/")?window.location.origin+"https://bot.mazholl.com:8585/api":"https://bot.mazholl.com:8585/api");return(s.protocol==="https:"?"wss://":"ws://")+Lo([s.host+s.pathname,t?`/node/${t}/logs`:"/core/logs"])+"?interval=1&token="+Zn()}catch(s){return console.error("Unable to generate websocket url"),console.error(s),null}},Rl=({showTitle:t=!0})=>{const{t:s}=$e(),{data:r}=xa(),[l,o]=d.exports.useState(""),[i,a]=d.exports.useState([]),c=d.exports.useRef(null),[u,p]=d.exports.useState(!0),{colorMode:m}=Jr(),g=b=>{if(b!==l){if(!b){o(""),a([]);return}o(b),a([])}},I=d.exports.useCallback(Jc.exports.debounce(b=>{a(U=>U.length>=fo?[...U.slice(U.length-fo+1),b]:[...U,b])},50),[]);d.exports.useEffect(()=>()=>{I.cancel()},[I]);const{readyState:D}=qc(Ap(l),{onMessage:b=>{var U;I((U=b.data)!=null?U:"")},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});d.exports.useEffect(()=>{const b=c.current;if(!b)return;const U=()=>{const O=b.scrollHeight-b.scrollTop-b.clientHeight<=32;p(O)};return b.addEventListener("scroll",U),U(),()=>{b.removeEventListener("scroll",U)}},[]),d.exports.useEffect(()=>{u&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[i,u]);const w=d.exports.useMemo(()=>{const b=m==="dark";return{error:{bg:b?"rgba(248, 113, 113, 0.16)":"red.50",color:b?"#fed7d7":"#c53030",border:b?"#f87171":"#feb2b2"},warn:{bg:b?"rgba(251, 191, 36, 0.18)":"orange.50",color:b?"#fefcbf":"#975a16",border:b?"#fbbf24":"#f6ad55"},info:{bg:b?"rgba(96, 165, 250, 0.18)":"blue.50",color:b?"#bfdbfe":"#1a56db",border:b?"#60a5fa":"#63b3ed"},debug:{bg:b?"rgba(148, 163, 184, 0.16)":"gray.100",color:b?"#e2e8f0":"#1f2933",border:b?"#94a3b8":"#cbd5e1"},default:{bg:b?"rgba(30, 64, 175, 0.1)":"gray.50",color:b?"#e2e8f0":"#1f2933",border:b?"#475569":"#e2e8f0"}}},[m]),x=st("#f5f7fb","#1f2329"),v=st("gray.200","gray.600"),C=st("gray.500","gray.400"),z=st("white","gray.700"),ne=b=>/error|failed|exception/i.test(b)?"error":/warn/i.test(b)?"warn":/info/i.test(b)?"info":/debug/i.test(b)?"debug":"default";return n(de,{spacing:6,align:"stretch",children:[t&&e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:s("header.xrayLogs")}),n(ke,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},align:{base:"stretch",sm:"center"},justify:"space-between",children:[n(ke,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[(r==null?void 0:r[0])&&n(je,{size:"sm",w:{base:"full",sm:"auto"},bg:z,onChange:b=>g(b.target.value),value:l,children:[e("option",{value:"",children:s("core.master")}),r.map(b=>e("option",{value:String(b.id),children:s(b.name)},b.address))]}),e(h,{fontSize:"sm",color:C,children:s(`core.socket.${D}`)})]}),e(h,{fontSize:"xs",color:C,children:u?s("core.autoScrollOn","Auto-scroll: On"):s("core.autoScrollOff","Auto-scroll: Off")})]}),e(N,{border:"1px solid",borderColor:v,bg:x,borderRadius:"lg",minHeight:"200px",maxHeight:"500px",p:3,overflowY:"auto",ref:c,fontFamily:"mono",fontSize:"sm",children:e(de,{align:"stretch",spacing:2,children:i.map((b,U)=>{var ve;const T=ne(b),O=(ve=w[T])!=null?ve:w.default;return e(N,{bg:O.bg,color:O.color,borderLeftWidth:3,borderLeftColor:O.border,px:3,py:2,borderRadius:"md",boxShadow:"sm",_dark:{boxShadow:"none"},children:e(ee.pre,{m:0,whiteSpace:"pre-wrap",wordBreak:"break-word",children:b})},`${b}-${U}`)})})})]})},Ip=ee(un),Tp=ee(ol),dr={tag:"",protocol:ae.VLESS,sendThrough:"",address:"",port:443,id:"",encryption:"none",flow:"",password:"",user:"",pass:"",method:Dl.AES_128_GCM,tlsEnabled:!1,tlsServerName:"",realityEnabled:!1,realityPublicKey:"",realityShortId:"",network:"tcp",tcpType:"none",tcpHost:"",tcpPath:"",wsHost:"",wsPath:"",grpcServiceName:"",muxEnabled:!1,muxConcurrency:8,vnextEncryption:"auto",dnsNetwork:"udp",dnsAddress:"",dnsPort:53,freedomStrategy:"",blackholeResponse:"",wireguardSecret:"",wireguardAddress:"",wireguardPeers:[{publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0}]},Bn=t=>{const s={},r=t.address||void 0,l=Number(t.port)||void 0;switch(t.protocol){case ae.VMess:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,security:t.vnextEncryption||void 0}]}];break;case ae.VLESS:s.vnext=[{address:r,port:l,users:[{id:t.id||void 0,encryption:t.encryption||void 0,flow:t.flow||void 0}]}];break;case ae.Trojan:s.servers=[{address:r,port:l,password:t.password||void 0}];break;case ae.Shadowsocks:s.servers=[{address:r,port:l,password:t.password||void 0,method:t.method||void 0}];break;case ae.Socks:case ae.HTTP:s.servers=[{address:r,port:l,users:t.user||t.pass?[{user:t.user||void 0,pass:t.pass||void 0}]:[]}];break;case ae.Freedom:s.domainStrategy=t.freedomStrategy||void 0;break;case ae.Blackhole:s.response=t.blackholeResponse?{type:t.blackholeResponse}:void 0;break;case ae.DNS:s.network=t.dnsNetwork,s.address=t.dnsAddress||void 0,s.port=Number(t.dnsPort)||void 0;break;case ae.Wireguard:s.secretKey=t.wireguardSecret||void 0,s.address=t.wireguardAddress?t.wireguardAddress.split(",").map(c=>c.trim()).filter(Boolean):void 0,s.peers=t.wireguardPeers.map(c=>({publicKey:c.publicKey||void 0,allowedIPs:c.allowedIPs?c.allowedIPs.split(",").map(u=>u.trim()).filter(Boolean):void 0,endpoint:c.endpoint||void 0,keepAlive:Number(c.keepAlive)||void 0}));break}const o=new bn;o.network=t.network,o.security=t.tlsEnabled?"tls":t.realityEnabled?"reality":"none",t.network==="tcp"?o.tcp=new dn(t.tcpType,t.tcpHost,t.tcpPath):t.network==="ws"?o.ws=new Nn(t.wsPath,t.wsHost,0):t.network==="grpc"&&(o.grpc=new zn(t.grpcServiceName,"",!1)),t.tlsEnabled&&(o.tls=new Rn(t.tlsServerName,[],"",!1,"")),t.realityEnabled&&(o.reality=new rs(t.realityPublicKey,"",t.tlsServerName,t.realityShortId,"",""));const a=new qt(t.tag,t.protocol,s,o,void 0).toJson();return a.sendThrough=t.sendThrough||void 0,t.muxEnabled&&(a.mux={enabled:!0,concurrency:Number(t.muxConcurrency)||void 0}),a},Pp=({isOpen:t,onClose:s,mode:r,initialOutbound:l,onSubmitOutbound:o})=>{const{t:i}=$e(),a=Bt(),c=st("gray.50","whiteAlpha.100"),{control:u,register:p,reset:m,handleSubmit:g,watch:I,getValues:D,setValue:w,formState:{isValid:x}}=Or({defaultValues:dr,mode:"onChange",reValidateMode:"onChange",criteriaMode:"all"});d.exports.useEffect(()=>{p("tlsEnabled"),p("realityEnabled")},[p]);const{fields:v,append:C,remove:z}=Jn({control:u,name:"wireguardPeers"}),ne=I("protocol"),b=I("network"),U=I("tlsEnabled"),T=I("realityEnabled"),O=I("tcpType"),ve=I("muxEnabled"),Z=i("validation.required",{defaultValue:"Required"}),J=i("validation.invalidPort",{defaultValue:"Invalid port"}),E=ne||ae.VLESS,q=![ae.Freedom,ae.Blackhole,ae.DNS,ae.Wireguard].includes(E),ue=[ae.VMess,ae.VLESS].includes(E),Y=[ae.Trojan,ae.Shadowsocks].includes(E),re=E===ae.Shadowsocks,A=E===ae.DNS,me=Ht({control:u}),[De,Ee]=d.exports.useState(0),[W,y]=d.exports.useState(()=>Bn(dr)),[P,ie]=d.exports.useState(()=>JSON.stringify(Bn(dr),null,2)),[te,Ce]=d.exports.useState(null),[Te,Re]=d.exports.useState(""),Oe=d.exports.useRef(!1);d.exports.useEffect(()=>{if(!t)return;Ee(0),Ce(null),Re("");const oe=l?V(l):dr;Oe.current=!0,m(oe);const le=Bn(oe);y(le),ie(JSON.stringify(le,null,2))},[l,t,m]),d.exports.useEffect(()=>{if(!me)return;if(Oe.current){Oe.current=!1;return}const oe=Bn(me);y(oe);const le=JSON.stringify(oe,null,2);ie($=>$===le?$:le),Ce(null)},[me]);const B=d.exports.useMemo(()=>[ae.VLESS,ae.VMess,ae.Trojan,ae.Shadowsocks,ae.Socks,ae.HTTP,ae.Freedom,ae.Blackhole,ae.DNS,ae.Wireguard],[]),V=oe=>{var ut,mt,Q,H,Se,Me,Fe,Be,ce,ge,We,Ie,ot,gt,Mt,et,jt,hr,sr,pr,er,ir,ar,tr,or,G,be,X,rt,M,xe,Le,Ke,Ge,it,Nt,Vt,kr,Gt,lr,Pt,nt,vt,Wr,Fr,Qt,vr,Xt,zr,mn,It,rr,Ct,Cr,Rr;const le=qt.fromJson(oe),$={...dr,tag:(ut=oe==null?void 0:oe.tag)!=null?ut:"",protocol:(le==null?void 0:le.protocol)||dr.protocol,sendThrough:(mt=oe==null?void 0:oe.sendThrough)!=null?mt:"",muxEnabled:Boolean((Q=oe==null?void 0:oe.mux)==null?void 0:Q.enabled),muxConcurrency:Number((Se=(H=oe==null?void 0:oe.mux)==null?void 0:H.concurrency)!=null?Se:dr.muxConcurrency)},ye=le==null?void 0:le.stream;switch($.network=(Me=ye==null?void 0:ye.network)!=null?Me:dr.network,$.tlsEnabled=(ye==null?void 0:ye.security)==="tls",$.realityEnabled=(ye==null?void 0:ye.security)==="reality",$.tlsServerName=(Be=(Fe=ye==null?void 0:ye.tls)==null?void 0:Fe.serverName)!=null?Be:"",$.realityPublicKey=(ge=(ce=ye==null?void 0:ye.reality)==null?void 0:ce.publicKey)!=null?ge:"",$.realityShortId=(Ie=(We=ye==null?void 0:ye.reality)==null?void 0:We.shortId)!=null?Ie:"",(ye==null?void 0:ye.network)==="tcp"&&ye.tcp&&($.tcpType=ye.tcp.type,$.tcpHost=(ot=ye.tcp.host)!=null?ot:"",$.tcpPath=(gt=ye.tcp.path)!=null?gt:""),(ye==null?void 0:ye.network)==="ws"&&ye.ws&&($.wsHost=(Mt=ye.ws.host)!=null?Mt:"",$.wsPath=(et=ye.ws.path)!=null?et:""),(ye==null?void 0:ye.network)==="grpc"&&ye.grpc&&($.grpcServiceName=(jt=ye.grpc.serviceName)!=null?jt:""),le!=null&&le.hasAddressPort()&&($.address=(er=(pr=(hr=le.settings)==null?void 0:hr.address)!=null?pr:(sr=oe==null?void 0:oe.settings)==null?void 0:sr.address)!=null?er:"",$.port=Number((or=(tr=(ir=le.settings)==null?void 0:ir.port)!=null?tr:(ar=oe==null?void 0:oe.settings)==null?void 0:ar.port)!=null?or:dr.port)),$.protocol){case ae.VMess:{const fe=le.settings;$.id=(G=fe==null?void 0:fe.id)!=null?G:"",$.vnextEncryption=(be=fe==null?void 0:fe.security)!=null?be:dr.vnextEncryption,$.address=(X=fe==null?void 0:fe.address)!=null?X:$.address,$.port=Number((rt=fe==null?void 0:fe.port)!=null?rt:$.port);break}case ae.VLESS:{const fe=le.settings;$.id=(M=fe==null?void 0:fe.id)!=null?M:"",$.flow=(xe=fe==null?void 0:fe.flow)!=null?xe:"",$.encryption=(Le=fe==null?void 0:fe.encryption)!=null?Le:$.encryption,$.address=(Ke=fe==null?void 0:fe.address)!=null?Ke:$.address,$.port=Number((Ge=fe==null?void 0:fe.port)!=null?Ge:$.port);break}case ae.Trojan:{const fe=le.settings;$.password=(it=fe==null?void 0:fe.password)!=null?it:"",$.address=(Nt=fe==null?void 0:fe.address)!=null?Nt:$.address,$.port=Number((Vt=fe==null?void 0:fe.port)!=null?Vt:$.port);break}case ae.Shadowsocks:{const fe=le.settings;$.password=(kr=fe==null?void 0:fe.password)!=null?kr:"",$.method=(Gt=fe==null?void 0:fe.method)!=null?Gt:dr.method,$.address=(lr=fe==null?void 0:fe.address)!=null?lr:$.address,$.port=Number((Pt=fe==null?void 0:fe.port)!=null?Pt:$.port);break}case ae.Socks:case ae.HTTP:{const fe=($.protocol===ae.Socks,le.settings);$.user=(nt=fe==null?void 0:fe.user)!=null?nt:"",$.pass=(vt=fe==null?void 0:fe.pass)!=null?vt:"",$.address=(Wr=fe==null?void 0:fe.address)!=null?Wr:$.address,$.port=Number((Fr=fe==null?void 0:fe.port)!=null?Fr:$.port);break}case ae.DNS:{const fe=le.settings;$.dnsNetwork=(Qt=fe==null?void 0:fe.network)!=null?Qt:dr.dnsNetwork,$.dnsAddress=(vr=fe==null?void 0:fe.address)!=null?vr:"",$.dnsPort=Number((Xt=fe==null?void 0:fe.port)!=null?Xt:dr.dnsPort);break}case ae.Freedom:{const fe=le.settings;$.freedomStrategy=(zr=fe==null?void 0:fe.domainStrategy)!=null?zr:"";break}case ae.Blackhole:{const fe=le.settings;$.blackholeResponse=(mn=fe==null?void 0:fe.type)!=null?mn:"";break}case ae.Wireguard:{const fe=le.settings;$.wireguardSecret=(It=fe==null?void 0:fe.secretKey)!=null?It:"",$.wireguardAddress=(rr=fe==null?void 0:fe.address)!=null?rr:"";const mr=(Cr=(Ct=fe==null?void 0:fe.peers)==null?void 0:Ct.map(cr=>{var Mr,Un,Ln;return{publicKey:(Mr=cr.publicKey)!=null?Mr:"",allowedIPs:Array.isArray(cr.allowedIPs)?cr.allowedIPs.join(","):"",endpoint:(Un=cr.endpoint)!=null?Un:"",keepAlive:Number((Ln=cr.keepAlive)!=null?Ln:0)}}))!=null?Cr:[];$.wireguardPeers=mr.length>0?mr:dr.wireguardPeers;break}}return((Rr=oe==null?void 0:oe.mux)==null?void 0:Rr.concurrency)!=null&&($.muxConcurrency=Number(oe.mux.concurrency)),(!$.wireguardPeers||$.wireguardPeers.length===0)&&($.wireguardPeers=dr.wireguardPeers),$},L=oe=>{ie(oe);try{const le=JSON.parse(oe);Ce(null),y(le),Oe.current=!0;const $=V(le);m($)}catch(le){Ce(le.message)}},he=()=>{const oe=Te.trim();if(!oe){Ce(i("pages.outbound.configEmpty","Please paste a config link"));return}const le=qt.fromLink(oe);if(!le){Ce(i("pages.outbound.invalidConfig","Unsupported or invalid config link")),a({status:"error",duration:2500,position:"top",title:i("pages.outbound.configParseFailedTitle","Conversion failed"),description:i("pages.outbound.configParseFailedDesc","Could not parse the provided config link.")});return}const $=le.toJson(),ye=JSON.stringify($,null,2);Re(""),L(ye),a({status:"success",duration:2e3,position:"top",title:i("pages.outbound.configConvertedTitle","Config converted"),description:i("pages.outbound.configConvertedDesc","Configuration applied to the form.")})},ze=g(async oe=>{var $;const le=Bn(oe);try{await o(le),a({title:r==="edit"?i("pages.xray.outbound.updated","Outbound updated"):i("pages.xray.outbound.addOutbound"),status:"success",duration:2e3,position:"top"}),s()}catch(ye){a({title:(($=ye==null?void 0:ye.data)==null?void 0:$.detail)||(ye==null?void 0:ye.message)||i("pages.xray.outbound.saveFailed","Unable to save outbound"),status:"error",duration:3e3,position:"top"})}}),at=()=>{s()},pe=oe=>{if(Ee(oe),oe===1){const le=Bn(D());y(le);const $=JSON.stringify(le,null,2);ie(ye=>ye===$?ye:$),Ce(null)}};return n(Ut,{size:"4xl",isOpen:t,onClose:at,scrollBehavior:"inside",children:[e(wt,{bg:"blackAlpha.400",backdropFilter:"blur(8px)"}),n(Lt,{as:"form",onSubmit:ze,children:[e(At,{children:r==="edit"?i("pages.xray.outbound.editOutbound","Edit Outbound"):i("pages.xray.outbound.addOutbound")}),e(Rt,{}),e(kt,{children:n(ls,{variant:"enclosed",colorScheme:"primary",index:De,onChange:pe,children:[n(cs,{children:[e($t,{children:i("form")}),e($t,{children:i("json")})]}),n(ds,{children:[e(Kt,{children:n(de,{spacing:6,align:"stretch",children:[n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.basicSettings","Basic settings")}),n(de,{spacing:3,align:"stretch",children:[n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.outbound.tag")}),e(we,{size:"sm",placeholder:"outbound-tag",...p("tag",{required:Z})})]}),n(R,{children:[n(k,{isRequired:!0,children:[e(_,{children:i("protocol")}),e(je,{size:"sm",...p("protocol"),children:B.map(oe=>e("option",{value:oe,children:oe},oe))})]}),n(k,{children:[e(_,{children:i("pages.xray.outbound.sendThrough")}),e(we,{size:"sm",placeholder:"0.0.0.0",...p("sendThrough")})]})]})]})]}),q&&n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.endpoint","Endpoint")}),n(de,{spacing:3,align:"stretch",children:[n(k,{isRequired:q,children:[e(_,{children:i("pages.outbound.address","Address")}),e(we,{size:"sm",placeholder:"example.com",...p("address",{required:q?Z:!1})})]}),n(R,{children:[n(k,{isRequired:q,children:[e(_,{children:i("pages.outbound.port","Port")}),e(we,{size:"sm",type:"number",min:1,max:65535,...p("port",{required:q?Z:!1,valueAsNumber:!0,min:{value:1,message:J},max:{value:65535,message:J}})})]}),ue?n(k,{isRequired:ue,children:[e(_,{children:"ID"}),e(we,{size:"sm",placeholder:"UUID",...p("id",{required:ue?Z:!1})})]}):Y?n(k,{isRequired:Y,children:[e(_,{children:i("password")}),e(we,{size:"sm",placeholder:"password",...p("password",{required:Y?Z:!1})})]}):n(k,{children:[e(_,{children:i("username")}),e(we,{size:"sm",placeholder:"username",...p("user")})]})]}),E===ae.Shadowsocks&&n(k,{isRequired:re,children:[e(_,{children:i("pages.outbound.method","Method")}),e(je,{size:"sm",...p("method",{required:re?Z:!1}),children:Object.values(Dl).map(oe=>e("option",{value:oe,children:oe},oe))})]}),E===ae.VLESS&&n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.encryption","Encryption")}),e(we,{size:"sm",placeholder:"none",...p("encryption")})]}),n(k,{children:[e(_,{children:"Flow"}),e(we,{size:"sm",placeholder:"xtls-rprx-vision",...p("flow")})]})]}),E===ae.VMess&&n(k,{children:[e(_,{children:i("pages.outbound.security","User security")}),e(we,{size:"sm",placeholder:"auto",...p("vnextEncryption")})]})]})]}),E===ae.DNS&&n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.dnsSettings","DNS settings")}),n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.network")}),n(je,{size:"sm",...p("dnsNetwork"),children:[e("option",{value:"udp",children:"udp"}),e("option",{value:"tcp",children:"tcp"})]})]}),n(k,{isRequired:A,children:[e(_,{children:i("pages.outbound.port")}),e(we,{size:"sm",type:"number",min:1,max:65535,...p("dnsPort",{required:A?Z:!1,valueAsNumber:!0,min:{value:1,message:J},max:{value:65535,message:J}})})]})]}),n(k,{mt:3,isRequired:A,children:[e(_,{children:i("pages.outbound.address")}),e(we,{size:"sm",placeholder:"8.8.8.8",...p("dnsAddress",{required:A?Z:!1})})]})]}),E===ae.Freedom&&n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.freedom","Freedom options")}),n(k,{children:[e(_,{children:i("pages.outbound.strategy","Strategy")}),e(we,{size:"sm",placeholder:"UseIP",...p("freedomStrategy")})]})]}),E===ae.Blackhole&&n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.blackhole","Blackhole options")}),n(k,{children:[e(_,{children:i("pages.outbound.response")}),e(we,{size:"sm",placeholder:"none",...p("blackholeResponse")})]})]}),E===ae.Wireguard&&n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.wireguard","Wireguard")}),n(de,{spacing:3,align:"stretch",children:[n(k,{children:[e(_,{children:i("pages.outbound.secretKey","Secret key")}),e(we,{size:"sm",...p("wireguardSecret")})]}),n(k,{children:[e(_,{children:i("pages.outbound.address")}),e(we,{size:"sm",placeholder:"10.0.0.1/32",...p("wireguardAddress")})]}),n(de,{spacing:3,align:"stretch",children:[n(R,{justify:"space-between",children:[e(h,{fontWeight:"semibold",children:i("pages.outbound.peer","Peers")}),e(Ue,{size:"sm","aria-label":i("add"),icon:e(Ip,{boxSize:3}),onClick:()=>C({publicKey:"",allowedIPs:"0.0.0.0/0,::/0",endpoint:"",keepAlive:0})})]}),v.map((oe,le)=>n(N,{borderWidth:"1px",borderRadius:"md",p:3,bg:c,children:[n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.publicKey","Public key")}),e(we,{size:"sm",...p(`wireguardPeers.${le}.publicKey`)})]}),v.length>1&&e(Ue,{mt:6,size:"sm","aria-label":i("delete"),icon:e(Tp,{boxSize:3}),onClick:()=>z(le)})]}),n(R,{mt:2,children:[n(k,{children:[e(_,{children:i("pages.outbound.allowedIPs","Allowed IPs")}),e(we,{size:"sm",...p(`wireguardPeers.${le}.allowedIPs`)})]}),n(k,{children:[e(_,{children:i("pages.outbound.endpoint","Endpoint")}),e(we,{size:"sm",...p(`wireguardPeers.${le}.endpoint`)})]})]}),n(k,{mt:2,children:[e(_,{children:i("pages.outbound.keepAlive","Keep alive")}),e(we,{size:"sm",type:"number",...p(`wireguardPeers.${le}.keepAlive`,{valueAsNumber:!0})})]})]},oe.id))]})]})]}),n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.transport","Transport")}),n(de,{spacing:3,align:"stretch",children:[n(k,{children:[e(_,{children:i("pages.outbound.network")}),n(je,{size:"sm",...p("network"),onChange:oe=>{p("network").onChange(oe)},children:[e("option",{value:"tcp",children:"tcp"}),e("option",{value:"ws",children:"ws"}),e("option",{value:"grpc",children:"grpc"})]})]}),b==="tcp"&&n(R,{children:[n(k,{children:[e(_,{children:i("pages.outbound.tcpHeader","Header")}),n(je,{size:"sm",...p("tcpType"),children:[e("option",{value:"none",children:"none"}),e("option",{value:"http",children:"http"})]})]}),O==="http"&&n(Ot,{children:[n(k,{children:[e(_,{children:i("host")}),e(we,{size:"sm",...p("tcpHost")})]}),n(k,{children:[e(_,{children:i("path")}),e(we,{size:"sm",...p("tcpPath")})]})]})]}),b==="ws"&&n(R,{children:[n(k,{children:[e(_,{children:i("host")}),e(we,{size:"sm",...p("wsHost")})]}),n(k,{children:[e(_,{children:i("path")}),e(we,{size:"sm",...p("wsPath")})]})]}),b==="grpc"&&n(k,{children:[e(_,{children:i("serviceName")}),e(we,{size:"sm",...p("grpcServiceName")})]})]})]}),n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.security")}),n(R,{children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"TLS"}),e(ht,{size:"sm",isChecked:U,onChange:oe=>{const le=oe.target.checked;w("tlsEnabled",le),le&&w("realityEnabled",!1)}})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:"Reality"}),e(ht,{size:"sm",isChecked:T,onChange:oe=>{const le=oe.target.checked;w("realityEnabled",le),le&&w("tlsEnabled",!1)}})]})]}),U&&n(k,{mt:3,children:[e(_,{children:"SNI"}),e(we,{size:"sm",placeholder:"example.com",...p("tlsServerName")})]}),T&&n(de,{spacing:3,align:"stretch",mt:3,children:[n(k,{children:[e(_,{children:"SNI"}),e(we,{size:"sm",...p("tlsServerName")})]}),n(k,{children:[e(_,{children:i("pages.outbound.publicKey")}),e(we,{size:"sm",...p("realityPublicKey")})]}),n(k,{children:[e(_,{children:i("pages.outbound.shortId")}),e(we,{size:"sm",...p("realityShortId")})]})]})]}),n(N,{children:[e(h,{fontWeight:"semibold",mb:3,children:i("pages.outbound.mux")}),n(k,{display:"flex",alignItems:"center",children:[e(_,{mb:"0",children:i("pages.outbound.enableMux")}),e(ht,{size:"sm",...p("muxEnabled")})]}),ve&&n(k,{mt:3,children:[e(_,{children:i("pages.outbound.concurrency")}),e(we,{size:"sm",type:"number",...p("muxConcurrency",{valueAsNumber:!0})})]})]})]})}),e(Kt,{children:n(de,{align:"stretch",spacing:3,children:[n(k,{children:[e(_,{children:i("pages.outbound.configToJson","Config to JSON")}),n(R,{align:"start",spacing:3,children:[e(Ar,{value:Te,onChange:oe=>Re(oe.target.value),placeholder:i("pages.outbound.configPlaceholder","Paste vmess/vless/trojan/ss link here"),rows:3,fontFamily:"mono",fontSize:"sm",spellCheck:!1,flex:"1"}),e(F,{size:"sm",colorScheme:"primary",onClick:he,children:i("pages.outbound.convertConfig","Convert")})]})]}),e(N,{height:"420px",children:e(ia,{json:W,onChange:L})}),te&&e(h,{fontSize:"sm",color:"red.500",children:te})]})})]})]})}),n(zt,{gap:3,children:[e(F,{variant:"outline",onClick:at,children:i("cancel")}),e(F,{colorScheme:"primary",type:"submit",isDisabled:!x,children:i(r==="edit"?"save":"add")})]})]})]})},Ep=["tcp","udp","http","quic","grpc"],Np=["http","tls","bittorrent","quic"],zp=["field","chained"],Rp=["","hybrid","linear"],Ml={type:"field",domainMatcher:"",outboundTag:"",balancerTag:"",inboundTags:[],networks:[],protocols:[],sourceIps:"",sourcePort:"",domain:"",ip:"",user:"",port:"",attrs:[]},Vn=t=>Array.isArray(t)?t.join(", "):"",$n=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean),Mp=t=>{var r,l,o,i;if(!t)return{...Ml};const s=t.attrs?Object.entries(t.attrs).map(([a,c])=>({key:a,value:c==null?"":String(c)})):[];return{type:(r=t.type)!=null?r:"field",domainMatcher:(l=t.domainMatcher)!=null?l:"",outboundTag:(o=t.outboundTag)!=null?o:"",balancerTag:(i=t.balancerTag)!=null?i:"",inboundTags:Array.isArray(t.inboundTag)?t.inboundTag:[],networks:Array.isArray(t.network)?t.network:[],protocols:Array.isArray(t.protocol)?t.protocol:[],sourceIps:Vn(t.source),sourcePort:Vn(t.sourcePort),domain:Vn(t.domain),ip:Vn(t.ip),user:Vn(t.user),port:Vn(t.port),attrs:s}},Up=t=>{const s={};t.type&&(s.type=t.type),t.domainMatcher&&(s.domainMatcher=t.domainMatcher),t.outboundTag&&(s.outboundTag=t.outboundTag),t.balancerTag&&(s.balancerTag=t.balancerTag),t.inboundTags.length&&(s.inboundTag=t.inboundTags),t.networks.length&&(s.network=t.networks),t.protocols.length&&(s.protocol=t.protocols);const r=$n(t.sourceIps);r.length&&(s.source=r);const l=$n(t.sourcePort);l.length&&(s.sourcePort=l);const o=$n(t.domain);o.length&&(s.domain=o);const i=$n(t.ip);i.length&&(s.ip=i);const a=$n(t.user);a.length&&(s.user=a);const c=$n(t.port);if(c.length&&(s.port=c),t.attrs.length){const u={};t.attrs.forEach(({key:p,value:m})=>{!p.trim()||(u[p.trim()]=m)}),Object.keys(u).length&&(s.attrs=u)}return s.type||(s.type="field"),s},Lp=({isOpen:t,mode:s,initialRule:r,availableInboundTags:l,availableOutboundTags:o,availableBalancerTags:i,onSubmit:a,onClose:c})=>{const{t:u}=$e(),p=st("white","gray.900"),{control:m,register:g,handleSubmit:I,reset:D,formState:{isSubmitting:w}}=Or({defaultValues:Ml}),{fields:x,append:v,remove:C}=Jn({control:m,name:"attrs"});d.exports.useEffect(()=>{t&&D(Mp(r))},[t,r,D]);const z=()=>v({key:"",value:""}),ne=()=>{c()},b=I(T=>{const O=Up(T);a(O),ne()}),U=d.exports.useMemo(()=>s==="edit"?u("pages.xray.rules.edit","Edit Rule"):u("pages.xray.rules.add","Add Rule"),[s,u]);return n(Ut,{isOpen:t,onClose:ne,size:"xl",scrollBehavior:"inside",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{as:"form",onSubmit:b,bg:p,children:[e(At,{children:U}),e(Rt,{}),e(kt,{children:n(ke,{spacing:5,children:[n(k,{children:[e(_,{children:u("pages.xray.rules.type","Rule Type")}),e(je,{...g("type"),size:"sm",children:zp.map(T=>e("option",{value:T,children:T||u("core.none","None")},T))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.outboundTag","Outbound Tag")}),e(je,{...g("outboundTag"),size:"sm",placeholder:u("core.none","None"),children:o.map(T=>e("option",{value:T,children:T},T))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.balancer","Balancer Tag")}),e(je,{...g("balancerTag"),size:"sm",placeholder:u("core.none","None"),children:i.map(T=>e("option",{value:T,children:T},T))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.inboundTag","Inbound Tags")}),e(pt,{control:m,name:"inboundTags",render:({field:T})=>e(ii,{...T,children:e(ai,{spacing:3,children:l.map(O=>e(Ns,{children:e(Pr,{value:O,children:O})},O))})})})]}),e(Yn,{}),n(k,{children:[e(_,{children:u("pages.xray.rules.domainMatcher","Domain Matcher")}),e(je,{...g("domainMatcher"),size:"sm",children:Rp.map(T=>e("option",{value:T,children:T||u("core.default","Default")},T||"empty"))})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.network","Network")}),e(pt,{control:m,name:"networks",render:({field:T})=>e(ii,{...T,children:e(ai,{spacing:3,children:Ep.map(O=>e(Ns,{children:e(Pr,{value:O,children:O})},O))})})})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.protocol","Protocol")}),e(pt,{control:m,name:"protocols",render:({field:T})=>e(ii,{...T,children:e(ai,{spacing:3,children:Np.map(O=>e(Ns,{children:e(Pr,{value:O,children:O})},O))})})})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.source","Source IPs")}),e(Ar,{...g("sourceIps"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.sourcePort","Source Ports")}),e(Ar,{...g("sourcePort"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.ip","Destination IPs")}),e(Ar,{...g("ip"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.domain","Domains")}),e(Ar,{...g("domain"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.user","Users")}),e(Ar,{...g("user"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),n(k,{children:[e(_,{children:u("pages.xray.rules.port","Ports")}),e(Ar,{...g("port"),size:"sm",placeholder:u("pages.xray.rules.useComma","Comma or space separated")})]}),e(Yn,{}),n(N,{children:[n(k,{children:[e(_,{children:u("pages.xray.rules.attrs","Attributes")}),e(F,{onClick:z,size:"xs",leftIcon:e(un,{width:16}),variant:"outline",colorScheme:"primary",children:u("core.add","Add")})]}),n(ke,{spacing:2,mt:3,children:[x.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:u("pages.xray.rules.attrsHelper","No custom attributes defined.")}),x.map((T,O)=>n(R,{spacing:2,align:"flex-start",children:[e(we,{size:"sm",placeholder:u("pages.inbounds.stream.general.name","Key"),...g(`attrs.${O}.key`)}),e(we,{size:"sm",placeholder:u("pages.inbounds.stream.general.value","Value"),...g(`attrs.${O}.value`)}),e(Ue,{"aria-label":"Remove attribute",icon:e(ca,{width:16}),size:"sm",variant:"ghost",onClick:()=>C(O)})]},T.id))]})]})]})}),n(zt,{gap:3,children:[e(F,{variant:"outline",onClick:ne,children:u("cancel")}),e(F,{colorScheme:"primary",type:"submit",isLoading:w,children:s==="edit"?u("pages.xray.rules.edit","Save Changes"):u("pages.xray.rules.add","Add Rule")})]})]})]})},Op=({isOpen:t,onClose:s,form:r,setBalancersData:l,balancerIndex:o})=>{const{t:i}=$e(),a=Or({defaultValues:{tag:"",strategy:"random",selector:"",fallbackTag:""}}),c=a.handleSubmit(u=>{const p={tag:u.tag,strategy:{type:u.strategy},selector:u.selector?u.selector.split(","):[],fallbackTag:u.fallbackTag},m=r.getValues("config.routing.balancers")||[];o!==void 0?m[o]=p:m.push(p),r.setValue("config.routing.balancers",m,{shouldDirty:!0}),l(m.map((g,I)=>{var D;return{key:I,tag:g.tag||"",strategy:((D=g.strategy)==null?void 0:D.type)||"random",selector:g.selector||[],fallbackTag:g.fallbackTag||""}})),s()});return n(Ut,{isOpen:t,onClose:s,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})}),e(Rt,{mt:3}),e(kt,{children:e("form",{onSubmit:c,children:n(de,{spacing:4,children:[n(k,{children:[e(_,{children:i("pages.xray.balancer.tag")}),e(we,{...a.register("tag"),size:"sm",placeholder:"balancer-tag"})]}),n(k,{children:[e(_,{children:i("pages.xray.balancer.balancerStrategy")}),e(je,{...a.register("strategy"),size:"sm",children:["random","roundRobin","leastLoad","leastPing"].map(u=>e("option",{value:u,children:u},u))})]}),n(k,{children:[e(_,{children:i("pages.xray.balancer.balancerSelectors")}),e(we,{...a.register("selector"),size:"sm",placeholder:"tag1,tag2"})]}),n(k,{children:[e(_,{children:i("pages.xray.balancer.fallbackTag")}),e(we,{...a.register("fallbackTag"),size:"sm",placeholder:"fallback-tag"})]}),e(F,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.balancer.editBalancer":"pages.xray.balancer.addBalancer")})]})})})]})]})},Wp=({isOpen:t,onClose:s,form:r,setDnsServers:l,dnsIndex:o})=>{const{t:i}=$e(),a=Or({defaultValues:{address:"",domains:"",expectIPs:""}}),c=a.handleSubmit(u=>{const p={address:u.address,domains:u.domains?u.domains.split(","):[],expectIPs:u.expectIPs?u.expectIPs.split(","):[]},m=r.getValues("config.dns.servers")||[];o!==void 0?m[o]=p:m.push(p),r.setValue("config.dns.servers",m,{shouldDirty:!0}),l(m),s()});return n(Ut,{isOpen:t,onClose:s,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})}),e(Rt,{mt:3}),e(kt,{children:e("form",{onSubmit:c,children:n(de,{spacing:4,children:[n(k,{children:[e(_,{children:i("pages.xray.dns.address")}),e(we,{...a.register("address"),size:"sm",placeholder:"8.8.8.8"})]}),n(k,{children:[e(_,{children:i("pages.xray.dns.domains")}),e(we,{...a.register("domains"),size:"sm",placeholder:"example.com,*.example.com"})]}),n(k,{children:[e(_,{children:i("pages.xray.dns.expectIPs")}),e(we,{...a.register("expectIPs"),size:"sm",placeholder:"1.1.1.1,2.2.2.2"})]}),e(F,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.dns.edit":"pages.xray.dns.add")})]})})})]})]})},Fp=({isOpen:t,onClose:s,form:r,setFakeDns:l,fakeDnsIndex:o})=>{const{t:i}=$e(),a=Or({defaultValues:{ipPool:"",poolSize:""}}),c=a.handleSubmit(u=>{const p={ipPool:u.ipPool,poolSize:parseInt(u.poolSize,10)},m=r.getValues("config.fakedns")||[];o!==void 0?m[o]=p:m.push(p),r.setValue("config.fakedns",m.length>0?m:null,{shouldDirty:!0}),l(m),s()});return n(Ut,{isOpen:t,onClose:s,size:"sm",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),n(Lt,{mx:"3",children:[e(At,{pt:6,children:e(h,{fontWeight:"semibold",fontSize:"lg",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})}),e(Rt,{mt:3}),e(kt,{children:e("form",{onSubmit:c,children:n(de,{spacing:4,children:[n(k,{children:[e(_,{children:i("pages.xray.fakedns.ipPool")}),e(we,{...a.register("ipPool"),size:"sm",placeholder:"192.168.0.0/16"})]}),n(k,{children:[e(_,{children:i("pages.xray.fakedns.poolSize")}),e(we,{...a.register("poolSize"),size:"sm",placeholder:"100"})]}),e(F,{type:"submit",colorScheme:"primary",size:"sm",children:i(o!==void 0?"pages.xray.fakedns.edit":"pages.xray.fakedns.add")})]})})})]})]})},aa={tag:"warp",privateKey:"",publicKey:"",endpoint:"engage.cloudflareclient.com:2408",addressV4:"",addressV6:"",reserved:"",mtu:1420,domainStrategy:"ForceIP",notes:""},bo=t=>{var u,p,m,g,I,D,w,x,v,C,z,ne,b;if(!t)return{...aa};const s=(u=t.settings)!=null?u:{},l=(p=(Array.isArray(s.peers)?s.peers:[])[0])!=null?p:{},o=Array.isArray(s.address)?s.address:[],i=(g=(m=o.find(U=>typeof U=="string"&&U.endsWith("/32")))==null?void 0:m.replace("/32",""))!=null?g:"",a=(D=(I=o.find(U=>typeof U=="string"&&U.endsWith("/128")))==null?void 0:I.replace("/128",""))!=null?D:"",c=Array.isArray(s.reserved)?s.reserved.filter(U=>Number.isFinite(Number(U))).join(","):"";return{tag:(w=t.tag)!=null?w:"warp",privateKey:(v=(x=s.secretKey)!=null?x:s.privateKey)!=null?v:"",publicKey:(C=l.publicKey)!=null?C:"",endpoint:typeof l.endpoint=="string"?l.endpoint:"engage.cloudflareclient.com:2408",addressV4:i,addressV6:a,reserved:c,mtu:(z=s.mtu)!=null?z:1420,domainStrategy:(ne=s.domainStrategy)!=null?ne:"ForceIP",notes:typeof t.notes=="string"?t.notes:(b=s.notes)!=null?b:""}},Hp=t=>{const s=[];t.addressV4.trim()&&s.push(`${t.addressV4.trim()}/32`),t.addressV6.trim()&&s.push(`${t.addressV6.trim()}/128`);const r=t.reserved.split(",").map(i=>Number(i.trim())).filter(i=>Number.isFinite(i)),o=qt.fromJson({tag:t.tag.trim()||"warp",protocol:"wireguard",settings:{mtu:t.mtu||1420,secretKey:t.privateKey.trim(),address:s,reserved:r,domainStrategy:t.domainStrategy||"ForceIP",noKernelTun:!1,peers:[{publicKey:t.publicKey.trim(),endpoint:t.endpoint.trim()}]}}).toJson();return t.notes.trim()?o.notes=t.notes.trim():delete o.notes,o},Bp=t=>{if(!t)return[];try{const s=atob(t);return Array.from(s).map(r=>r.charCodeAt(0))}catch{return[]}},Vp=t=>{if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const s=t;return s.host?s.port?`${s.host}:${s.port}`:s.host:""}return""},$p=(t,s)=>{var p,m,g,I,D,w,x,v,C,z,ne;if(!t||!(s!=null&&s.config))return null;const r=s.config,l=[],o=(m=(p=r.interface)==null?void 0:p.addresses)!=null?m:{};o.v4&&l.push(`${o.v4}/32`),o.v6&&l.push(`${o.v6}/128`);const a=(g=(Array.isArray(r.peers)?r.peers:[])[0])!=null?g:{},c=(D=(I=a.allowed_ips)!=null?I:a.allowedIPs)!=null?D:["0.0.0.0/0","::/0"];return qt.fromJson({tag:"warp",protocol:"wireguard",settings:{mtu:(x=(w=r.interface)==null?void 0:w.mtu)!=null?x:1420,secretKey:t.private_key,address:l,reserved:Bp(r.client_id),domainStrategy:"ForceIP",noKernelTun:!1,peers:[{publicKey:(C=(v=a.public_key)!=null?v:t.public_key)!=null?C:"",endpoint:Vp(a.endpoint),allowedIPs:c,keepAlive:(ne=(z=a.keep_alive)!=null?z:a.keepAlive)!=null?ne:0}]}})},yo=t=>{if(!t)return"-";try{return new Date(t).toLocaleString()}catch{return t}},$i=t=>typeof t!="number"||Number.isNaN(t)||t<=0?"-":Dn.sizeFormat(t),ur=({label:t,value:s})=>{const r=st("gray.500","gray.400");return n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:r,letterSpacing:"wide",children:t}),e(h,{fontWeight:"semibold",fontFamily:"mono",overflowWrap:"anywhere",children:s||"-"})]})},Kp=({isOpen:t,onClose:s,initialOutbound:r,onSave:l,onDelete:o})=>{var Te,Re,Oe,B,V;const{t:i}=$e(),a=Bt(),[c,u]=d.exports.useState({...aa}),[p,m]=d.exports.useState(null),[g,I]=d.exports.useState(null),[D,w]=d.exports.useState(null),[x,v]=d.exports.useState(""),[C,z]=d.exports.useState(!1),[ne,b]=d.exports.useState(!1),[U,T]=d.exports.useState(!1),[O,ve]=d.exports.useState(!1),[Z,J]=d.exports.useState(!1);d.exports.useEffect(()=>{qh()},[]);const E=d.exports.useCallback(async()=>{var L,he;z(!0);try{const ze=await _e("/core/warp",{method:"GET"});m((L=ze.account)!=null?L:null),I(null),w(null)}catch(ze){a({title:i("pages.xray.warp.loadFailed","Failed to load WARP account."),description:((he=ze==null?void 0:ze.data)==null?void 0:he.detail)||(ze==null?void 0:ze.message),status:"error",duration:4e3,isClosable:!0,position:"top"})}finally{z(!1)}},[a,i]);d.exports.useEffect(()=>{t&&E().catch(()=>{})},[t,E]),d.exports.useEffect(()=>{t&&u(bo(r))},[r,t]),d.exports.useEffect(()=>{var L;v((L=p==null?void 0:p.license_key)!=null?L:"")},[p]);const q=(L,he)=>{u(ze=>({...ze,[L]:he}))},ue=st("gray.600","gray.300"),Y=st("gray.200","whiteAlpha.200"),re=()=>{const L=yi();q("privateKey",L.privateKey),q("publicKey",L.publicKey),a({title:i("pages.xray.warp.keysGenerated","WireGuard key pair generated."),status:"info",duration:2500,isClosable:!0,position:"top"})},A=()=>{const L=Array.from({length:3},()=>Math.floor(Math.random()*256));q("reserved",L.join(","))},me=d.exports.useCallback((L,he)=>{if(!L||!he){w(null);return}const ze=$p(L,he);ze&&(w(ze),u(bo(ze.toJson())))},[]),De=async()=>{var L;b(!0);try{const he=yi(),ze=await _e("/core/warp/register",{method:"POST",body:{private_key:he.privateKey,public_key:he.publicKey}});m(ze.account),I(ze.config),me(ze.account,ze.config),a({title:i("pages.xray.warp.registerSuccess","WARP device registered."),status:"success",duration:4e3,isClosable:!0,position:"top"})}catch(he){a({title:i("pages.xray.warp.registerFailed","Failed to register WARP device."),description:((L=he==null?void 0:he.data)==null?void 0:L.detail)||(he==null?void 0:he.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{b(!1)}},Ee=async()=>{var L;if(!p){a({title:i("pages.xray.warp.accountMissing","Create a WARP device first."),status:"warning",duration:3e3,isClosable:!0,position:"top"});return}ve(!0);try{const he=await _e("/core/warp/config",{method:"GET"});I(he.config),me(p,he.config),a({title:i("pages.xray.warp.infoFetched","WARP information refreshed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(he){a({title:i("pages.xray.warp.infoFailed","Unable to fetch WARP info."),description:((L=he==null?void 0:he.data)==null?void 0:L.detail)||(he==null?void 0:he.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{ve(!1)}},W=async()=>{var L;if(!!x.trim()){T(!0);try{const he=await _e("/core/warp/license",{method:"POST",body:{license_key:x.trim()}});m(he.account),a({title:i("pages.xray.warp.licenseUpdated","License updated."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(he){a({title:i("pages.xray.warp.licenseFailed","Failed to update license."),description:((L=he==null?void 0:he.data)==null?void 0:L.detail)||(he==null?void 0:he.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{T(!1)}}},y=async()=>{var L;J(!0);try{await _e("/core/warp",{method:"DELETE"}),m(null),I(null),w(null),o(),a({title:i("pages.xray.warp.accountRemoved","WARP account removed."),status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(he){a({title:i("pages.xray.warp.removeFailed","Failed to remove WARP account."),description:((L=he==null?void 0:he.data)==null?void 0:L.detail)||(he==null?void 0:he.message),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{J(!1)}},P=()=>{if(!D)return;const L=D.toJson();l(L),a({title:i("pages.xray.warp.outboundApplied","WARP outbound updated."),status:"success",duration:2500,isClosable:!0,position:"top"})},ie=()=>{o(),u({...aa}),a({title:i("pages.xray.warp.removeOutbound","Outbound removed."),status:"info",duration:2500,isClosable:!0,position:"top"})},te=()=>{if(!c.privateKey.trim()||!c.publicKey.trim()||!c.endpoint.trim()){a({title:i("pages.xray.warp.validationMissing","Private key, public key, and endpoint are required."),status:"error",isClosable:!0,duration:3500,position:"top"});return}const L=Hp(c);l(L),s()},Ce=d.exports.useMemo(()=>Boolean(r),[r]);return n(Ut,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(8px)"}),n(Lt,{children:[e(At,{children:i("pages.xray.warp.manage","Manage WARP")}),e(Rt,{}),e(kt,{children:n(de,{spacing:5,align:"stretch",children:[n(Ir,{status:"info",borderRadius:"md",children:[e(Tr,{}),e(yn,{children:i("pages.xray.warp.manualNote","Provide the credentials exported from Cloudflare WARP (e.g. via warp-cli). You can generate a WireGuard key pair locally, but you still need reserved bytes and endpoints from the official client.")})]}),e(N,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:p?n(de,{spacing:4,align:"stretch",children:[n(Ve,{columns:{base:1,md:2},spacing:4,children:[e(ur,{label:i("pages.xray.warp.accessToken","Access token"),value:p.access_token||"-"}),e(ur,{label:i("pages.xray.warp.deviceId","Device ID"),value:p.device_id||"-"}),e(ur,{label:i("pages.xray.warp.licenseKey","License key"),value:p.license_key||"-"}),e(ur,{label:i("pages.xray.warp.privateKey","Private key"),value:p.private_key||"-"}),e(ur,{label:i("pages.xray.warp.registeredAt","Registered at"),value:yo(p.created_at)}),e(ur,{label:i("pages.xray.warp.updatedAt","Updated at"),value:yo(p.updated_at)})]}),n(R,{spacing:3,flexWrap:"wrap",children:[e(F,{variant:"outline",onClick:Ee,isLoading:O,children:i("pages.xray.warp.fetchInfo","Refresh info")}),e(F,{variant:"ghost",colorScheme:"red",onClick:y,isLoading:Z,children:i("pages.xray.warp.removeAccount","Remove account")})]})]}):n(de,{spacing:3,align:"stretch",children:[e(h,{fontSize:"sm",color:ue,children:i("pages.xray.warp.registerDescription","No Cloudflare WARP device has been registered yet. The dashboard can generate a WireGuard key pair locally and register a new device via Cloudflare's API.")}),e(F,{colorScheme:"primary",onClick:De,isLoading:ne||C,children:i("pages.xray.warp.registerAction","Create WARP device")})]})}),p&&n(N,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.licenseSection","WARP+/License key")}),n(R,{spacing:3,align:"stretch",flexWrap:"wrap",children:[e(we,{value:x,onChange:L=>v(L.target.value),placeholder:"ABCD-1234...",size:"sm"}),e(F,{colorScheme:"primary",onClick:W,isLoading:U,isDisabled:!x.trim(),children:i("pages.xray.warp.updateLicense","Update license")})]}),e(h,{fontSize:"xs",color:ue,mt:2,children:i("pages.xray.warp.licenseHint","Optional Cloudflare WARP+ license. Leave empty if you only need the free tier.")})]}),n(N,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[n(R,{justify:"space-between",align:"center",mb:2,children:[e(h,{fontWeight:"semibold",children:i("pages.xray.warp.remoteConfig","Remote configuration")}),g?e(sn,{colorScheme:g.enabled?"green":"yellow",children:g.enabled?i("core.active","Active"):i("core.pending","Pending")}):e(sn,{colorScheme:"gray",children:i("core.empty","Empty")})]}),g?n(ke,{spacing:4,children:[n(Ve,{columns:{base:1,md:2},spacing:4,children:[e(ur,{label:i("core.name","Name"),value:(Te=g.name)!=null?Te:"-"}),e(ur,{label:i("core.model","Model"),value:(Re=g.model)!=null?Re:"-"}),e(ur,{label:i("core.status","Status"),value:g.enabled?i("core.enabled","Enabled"):i("core.disabled","Disabled")}),e(ur,{label:i("core.id","ID"),value:(Oe=g.id)!=null?Oe:"-"})]}),g.account&&n(Ot,{children:[e(Yn,{}),n(Ve,{columns:{base:1,md:3},spacing:4,children:[e(ur,{label:i("core.type","Type"),value:(B=g.account.account_type)!=null?B:"-"}),e(ur,{label:i("core.role","Role"),value:(V=g.account.role)!=null?V:"-"}),e(ur,{label:i("pages.xray.warp.premiumData","WARP+ data"),value:$i(g.account.premium_data)}),e(ur,{label:i("core.quota","Quota"),value:$i(g.account.quota)}),e(ur,{label:i("core.usage","Usage"),value:$i(g.account.usage)})]})]}),n(R,{spacing:3,flexWrap:"wrap",children:[e(F,{colorScheme:"primary",onClick:P,isDisabled:!D,children:i("pages.xray.warp.applyGenerated","Apply generated outbound")}),e(F,{variant:"ghost",onClick:()=>I(null),children:i("core.reset","Reset")})]})]}):e(h,{fontSize:"sm",color:ue,children:i("pages.xray.warp.remoteEmpty","Fetch the remote configuration to generate an outbound automatically.")})]}),n(N,{borderWidth:"1px",borderColor:Y,borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:2,children:i("pages.xray.warp.manualTitle","Manual outbound")}),n(ke,{spacing:4,children:[n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.outbound.tag","Tag")}),e(we,{size:"sm",value:c.tag,onChange:L=>q("tag",L.target.value),placeholder:"warp"})]}),n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.warp.privateKey")}),e(Ar,{size:"sm",value:c.privateKey,onChange:L=>q("privateKey",L.target.value),rows:2})]}),n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.warp.publicKey")}),e(Ar,{size:"sm",value:c.publicKey,onChange:L=>q("publicKey",L.target.value),rows:2})]}),n(k,{children:[e(F,{size:"sm",colorScheme:"primary",onClick:re,children:i("pages.xray.warp.generateKeys","Generate Keys")}),e(h,{fontSize:"xs",color:ue,mt:1,children:i("pages.xray.warp.generateKeysHint","Overrides the current key pair.")})]}),n(k,{isRequired:!0,children:[e(_,{children:i("pages.xray.warp.endpoint")}),e(we,{size:"sm",value:c.endpoint,onChange:L=>q("endpoint",L.target.value),placeholder:"engage.cloudflareclient.com:2408"})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.addressV4","Client IPv4")}),e(we,{size:"sm",value:c.addressV4,onChange:L=>q("addressV4",L.target.value),placeholder:"172.16.0.2"}),e(Lr,{children:i("pages.xray.warp.addressV4Hint","Optional /32 address from the WARP profile.")})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.addressV6","Client IPv6")}),e(we,{size:"sm",value:c.addressV6,onChange:L=>q("addressV6",L.target.value),placeholder:"2606:4700:****:****::****"})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.reserved")}),e(we,{size:"sm",value:c.reserved,onChange:L=>q("reserved",L.target.value),placeholder:"0,0,0"}),e(Lr,{children:i("pages.xray.warp.reservedHint","Comma separated integers (usually three numbers) derived from the client_id.")}),e(F,{size:"xs",mt:2,variant:"ghost",onClick:A,children:i("pages.xray.warp.randomReserved","Insert random reserved bytes")})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.mtu","MTU")}),e(Tn,{size:"sm",min:576,max:1600,value:c.mtu,onChange:(L,he)=>q("mtu",he||1420),children:e(In,{})})]}),n(k,{children:[e(_,{children:i("pages.xray.warp.notes","Notes (optional)")}),e(Ar,{size:"sm",rows:2,value:c.notes,onChange:L=>q("notes",L.target.value)})]})]})]})]})}),n(zt,{display:"flex",justifyContent:"space-between",children:[Ce?e(F,{colorScheme:"red",variant:"outline",onClick:ie,children:i("delete")}):e("span",{}),n(R,{spacing:3,children:[e(F,{variant:"ghost",onClick:s,children:i("cancel")}),e(F,{colorScheme:"primary",onClick:te,children:i(Ce?"save":"add")})]})]})]})]})},xs=ee(un,{baseStyle:{w:3.5,h:3.5}}),ws=ee(nn,{baseStyle:{w:4,h:4}}),ks=ee(Sn,{baseStyle:{w:4,h:4}}),So=ee(ll,{baseStyle:{w:4,h:4}}),xo=ee(cl,{baseStyle:{w:4,h:4}}),wo=ee(Kr,{baseStyle:{w:4,h:4}}),Jp=ee(Yc,{baseStyle:{w:4,h:4}}),qp=ee(Gc,{baseStyle:{w:4,h:4}}),Yp=ee(Qc,{baseStyle:{w:4,h:4}}),Gp=ee(Xc,{baseStyle:{w:4,h:4}}),Qp=ee(ua,{baseStyle:{w:4,h:4}}),Xp=ee(Zc,{baseStyle:{w:4,h:4}}),Zp=ee(jc,{baseStyle:{w:4,h:4}}),jp=ee(ed,{baseStyle:{w:4,h:4}}),em=ee(td,{baseStyle:{w:4,h:4}}),ko=ee(rd,{baseStyle:{w:4,h:4}}),vs={colorScheme:"primary",size:"xs",variant:"solid",fontSize:"xs",px:3,h:7},js=t=>JSON.stringify(t!=null?t:{}),vo=t=>Array.isArray(t)?t.join(","):t!=null?t:"",tm=[{label:"Apple",value:"geosite:apple"},{label:"Meta",value:"geosite:meta"},{label:"Google",value:"geosite:google"},{label:"OpenAI",value:"geosite:openai"},{label:"Spotify",value:"geosite:spotify"},{label:"Netflix",value:"geosite:netflix"},{label:"Reddit",value:"geosite:reddit"},{label:"Speedtest",value:"geosite:speedtest"}],Ki=({title:t,children:s})=>{const r=st("gray.50","whiteAlpha.100"),l=st("gray.200","whiteAlpha.300");return n(N,{borderWidth:"1px",borderColor:l,borderRadius:"lg",overflow:"hidden",children:[e(N,{bg:r,px:{base:3,md:4},py:2,children:e(h,{fontWeight:"semibold",fontSize:{base:"sm",md:"md"},children:t})}),e(N,{overflowX:"auto",children:e(Pn,{variant:"simple",size:"sm",minW:{base:"100%",md:"unset"},children:e($r,{children:s})})})]})},Br=({label:t,controlId:s,children:r})=>{const l=st("gray.700","whiteAlpha.800");return n(_t,{display:{base:"block",md:"table-row"},_notFirst:{borderTopWidth:{base:"1px",md:"0"},borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200"}},children:[e(Ne,{width:{base:"100%",md:"40%"},py:3,pr:{base:0,md:4},display:{base:"block",md:"table-cell"},children:e(_,{htmlFor:s,mb:{base:2,md:0},color:l,children:t})}),e(Ne,{py:3,display:{base:"block",md:"table-cell"},children:e(k,{id:s,display:"flex",flexDir:{base:"column",md:"row"},alignItems:{base:"flex-start",md:"center"},gap:{base:2,md:4},w:"full",children:r(s)})})]})},Cs=({children:t})=>{const s=st("gray.200","whiteAlpha.200"),r=st("white","blackAlpha.400"),l=st("sm","none");return e(N,{borderWidth:"1px",borderColor:s,borderRadius:"xl",bg:r,boxShadow:l,overflow:"hidden",children:e(N,{overflowX:"auto",children:t})})},_s=({children:t,...s})=>{const r=st("gray.50","whiteAlpha.100"),l=st("gray.200","whiteAlpha.300"),o=st("gray.300","whiteAlpha.300"),i=st("gray.100","whiteAlpha.200"),a=st("gray.50","whiteAlpha.100");return e(Pn,{size:"sm",w:"full",...s,sx:{borderCollapse:"separate",borderSpacing:0,"th, td":{borderRight:"1px solid",borderColor:l},"th:first-of-type, td:first-of-type":{borderLeft:"1px solid",borderColor:l},"thead th":{bg:r,borderBottom:"1px solid",borderBottomColor:o,textTransform:"none",fontWeight:"semibold",fontSize:"sm",letterSpacing:"normal"},"tbody td":{borderBottom:"1px solid",borderBottomColor:i,fontSize:"sm",verticalAlign:"top"},"tbody tr:last-of-type td":{borderBottom:"none"},"tbody tr:hover":{bg:a}},children:t})},rm=()=>{var Qs,ms,gs,fs;const{t}=$e(),{fetchCoreSettings:s,updateConfig:r,isLoading:l,config:o,isPostLoading:i,restartCore:a}=kp(),{onEditingCore:c}=xt(),u=Bt(),{isOpen:p,onOpen:m,onClose:g}=Yt(),{isOpen:I,onOpen:D,onClose:w}=Yt(),{isOpen:x,onOpen:v,onClose:C}=Yt(),{isOpen:z,onOpen:ne,onClose:b}=Yt(),{isOpen:U,onOpen:T,onClose:O}=Yt(),{isOpen:ve,onOpen:Z,onClose:J}=Yt(),E=Or({defaultValues:{config:o||{outbounds:[],routing:{rules:[],balancers:[]},dns:{servers:[]}}}}),q=d.exports.useRef(js(E.getValues("config"))),ue=Ht({control:E.control,name:"config"}),Y=d.exports.useMemo(()=>js(ue)!==q.current,[ue]),[re,A]=d.exports.useState([]),[me,De]=d.exports.useState([]),[Ee,W]=d.exports.useState([]),[y,P]=d.exports.useState([]),[ie,te]=d.exports.useState([]),[Ce,Te]=d.exports.useState([]),[Re,Oe]=d.exports.useState(null),[B,V]=d.exports.useState(null),[L,he]=d.exports.useState(!1),[ze,at]=d.exports.useState("xraySetting"),[pe,oe]=d.exports.useState(""),le=xr({base:!0,md:!1}),[$,ye]=d.exports.useState(0),[ut,mt]=d.exports.useState(""),[Q,H]=d.exports.useState(""),Se=d.exports.useCallback(f=>f.map((S,j)=>{var Je,tt;return{key:`${j}-${(tt=(Je=S.tag)!=null?Je:S.protocol)!=null?tt:"outbound"}`,...S}}),[]),Me=d.exports.useCallback(f=>{A(Se(f))},[Se]),Fe=d.exports.useCallback(()=>{const f=E.getValues("config.outbounds");return Array.isArray(f)?JSON.parse(JSON.stringify(f)):[]},[E]),Be=d.exports.useCallback(f=>{E.setValue("config.outbounds",f,{shouldDirty:!0}),Me(f),ye(S=>S+1)},[E,Me]),ce=d.exports.useCallback(f=>f.map((S,j)=>{var Je,tt,qe,yt,gr,xn,gn,se,dt,Ze,ft,Tt,Hr,qr,Yr;return{key:`${j}-${(tt=(Je=S.outboundTag)!=null?Je:S.balancerTag)!=null?tt:"rule"}`,source:(qe=S.source)!=null?qe:[],sourcePort:(yt=S.sourcePort)!=null?yt:[],network:(gr=S.network)!=null?gr:[],protocol:(xn=S.protocol)!=null?xn:[],attrs:S.attrs?JSON.stringify(S.attrs,null,2):"",ip:(gn=S.ip)!=null?gn:[],domain:(se=S.domain)!=null?se:[],port:(dt=S.port)!=null?dt:[],inboundTag:(Ze=S.inboundTag)!=null?Ze:[],user:(ft=S.user)!=null?ft:[],outboundTag:(Tt=S.outboundTag)!=null?Tt:"",balancerTag:(Hr=S.balancerTag)!=null?Hr:"",type:(qr=S.type)!=null?qr:"field",domainMatcher:(Yr=S.domainMatcher)!=null?Yr:""}}),[]),ge=d.exports.useCallback(f=>{De(ce(f))},[ce]),We=d.exports.useCallback(f=>{E.setValue("config.routing.rules",f,{shouldDirty:!0}),ge(f),ye(S=>S+1)},[E,ge]),Ie=d.exports.useCallback(()=>{const f=E.getValues("config.routing.rules");return Array.isArray(f)?JSON.parse(JSON.stringify(f)):[]},[E]);d.exports.useEffect(()=>{const f=()=>{he(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",f),()=>{document.removeEventListener("fullscreenchange",f)}},[]),d.exports.useEffect(()=>(c(!0),s().then(()=>{console.log("Core settings fetched successfully")}).catch(f=>{u({title:t("core.errorFetchingConfig"),description:f.message,status:"error",isClosable:!0,position:"top",duration:3e3})}),()=>c(!1)),[s,c,u,t]),d.exports.useEffect(()=>{var f,S,j,Je;o&&(E.reset({config:o}),q.current=js(o),Me((o==null?void 0:o.outbounds)||[]),ge(((f=o==null?void 0:o.routing)==null?void 0:f.rules)||[]),W(((j=(S=o==null?void 0:o.routing)==null?void 0:S.balancers)==null?void 0:j.map((tt,qe)=>{var yt;return{key:qe,tag:tt.tag||"",strategy:((yt=tt.strategy)==null?void 0:yt.type)||"random",selector:tt.selector||[],fallbackTag:tt.fallbackTag||""}}))||[]),P(((Je=o==null?void 0:o.dns)==null?void 0:Je.servers)||[]),te((o==null?void 0:o.fakedns)||[]),oe(o!=null&&o.observatory?"observatory":o!=null&&o.burstObservatory?"burstObservatory":""),ye(tt=>tt+1))},[o,E,Me,ge]);const{mutate:ot,isLoading:gt}=Dr(a,{onSuccess:()=>{u({title:t("core.restartSuccess"),status:"success",isClosable:!0,position:"top",duration:3e3})},onError:f=>{var S,j;u({title:t("core.generalErrorMessage"),description:((j=(S=f.response)==null?void 0:S.data)==null?void 0:j.detail)||f.message,status:"error",isClosable:!0,position:"top",duration:3e3})}}),Mt=E.handleSubmit(({config:f})=>{r(f).then(()=>{E.reset({config:f}),q.current=js(f),u({title:t("core.successMessage"),status:"success",isClosable:!0,position:"top",duration:3e3})}).catch(S=>{let j=t("core.generalErrorMessage");typeof S.response._data.detail=="object"&&(j=S.response._data.detail[Object.keys(S.response._data.detail)[0]]),typeof S.response._data.detail=="string"&&(j=S.response._data.detail),u({title:j,status:"error",isClosable:!0,position:"top",duration:3e3})})}),et=async()=>{const f=await _e("/panel/xray/getOutboundsTraffic");f!=null&&f.success&&Te(f.obj)},jt=()=>{V(null),g()},hr=()=>{V(null),m()},sr=f=>{V(f),m()},pr=f=>{const S=Fe();f<0||f>=S.length||(S.splice(f,1),Be(S))},er=(f,S)=>{const j=Fe();if(f<0||f>=j.length||S<0||S>=j.length)return;const[Je]=j.splice(f,1);j.splice(S,0,Je),Be(j)},ir=f=>{er(f,f-1)},ar=f=>{er(f,f+1)},tr=()=>{Oe(null),D()},or=f=>{Oe(f),D()},G=f=>{const S=Ie();S.splice(f,1),We(S)},be=(f,S)=>{const j=Ie();if(f<0||f>=j.length||S<0||S>=j.length)return;const[Je]=j.splice(f,1);j.splice(S,0,Je),We(j)},X=f=>{const S=Ie();Re!==null&&Re>=0&&Re<S.length?S[Re]=f:S.push(f),We(S),Oe(null)},rt=()=>{Oe(null),w()},M=()=>{v()},xe=f=>{v()},Le=f=>{const S=[...Ee],j=S.splice(f,1)[0];E.setValue("config.routing.balancers",S,{shouldDirty:!0}),W(S);const Je={...E.getValues("config")};Je.observatory&&(Je.observatory.subjectSelector=Je.observatory.subjectSelector.filter(tt=>tt!==j.tag)),Je.burstObservatory&&(Je.burstObservatory.subjectSelector=Je.burstObservatory.subjectSelector.filter(tt=>tt!==j.tag)),E.setValue("config",Je,{shouldDirty:!0})},Ke=()=>{ne()},Ge=f=>{ne()},it=f=>{const S=[...y];S.splice(f,1),E.setValue("config.dns.servers",S,{shouldDirty:!0}),P(S)},Nt=()=>{T()},Vt=f=>{T()},kr=f=>{const S=[...ie];S.splice(f,1),E.setValue("config.fakedns",S.length>0?S:null,{shouldDirty:!0}),te(S)},Gt=f=>{var S,j,Je,tt,qe;switch(f.protocol){case"vmess":case"vless":return((S=f.settings.vnext)==null?void 0:S.map(yt=>`${yt.address}:${yt.port}`))||[];case"http":case"socks":case"shadowsocks":case"trojan":return((j=f.settings.servers)==null?void 0:j.map(yt=>`${yt.address}:${yt.port}`))||[];case"dns":return[`${(Je=f.settings)==null?void 0:Je.address}:${(tt=f.settings)==null?void 0:tt.port}`];case"wireguard":return((qe=f.settings.peers)==null?void 0:qe.map(yt=>yt.endpoint))||[];default:return[]}},lr=f=>{const S=Ce.find(j=>j.tag===f.tag);return S?`${Dn.sizeFormat(S.up)} / ${Dn.sizeFormat(S.down)}`:`${Dn.sizeFormat(0)} / ${Dn.sizeFormat(0)}`},Pt=d.exports.useMemo(()=>Array.isArray(ue==null?void 0:ue.outbounds)?ue.outbounds:[],[ue]),nt=d.exports.useMemo(()=>{var f;return Array.isArray((f=ue==null?void 0:ue.routing)==null?void 0:f.rules)?ue.routing.rules:[]},[ue]),vt=d.exports.useMemo(()=>{var f;return Array.from(new Set(((f=ue==null?void 0:ue.inbounds)!=null?f:[]).map(S=>S==null?void 0:S.tag).filter(S=>Boolean(S))))},[ue]),Wr=d.exports.useMemo(()=>Array.from(new Set(Pt.map(f=>f==null?void 0:f.tag).filter(f=>Boolean(f)))),[Pt]),Fr=d.exports.useMemo(()=>{var f,S;return Array.from(new Set(((S=(f=ue==null?void 0:ue.routing)==null?void 0:f.balancers)!=null?S:[]).map(j=>j==null?void 0:j.tag).filter(j=>Boolean(j))))},[ue]),Qt=d.exports.useMemo(()=>Pt.length===0?-1:Pt.findIndex(f=>(f==null?void 0:f.protocol)==="freedom"),[Pt]),vr=d.exports.useMemo(()=>{var S,j;if(Qt<0)return"";const f=Pt[Qt];return(j=(S=f==null?void 0:f.settings)==null?void 0:S.domainStrategy)!=null?j:""},[Qt,Pt]),Xt=f=>{const S=E.getValues("config")||{},j=Array.isArray(S.outbounds)?JSON.parse(JSON.stringify(S.outbounds)):[],Je=j.findIndex(yt=>(yt==null?void 0:yt.protocol)==="freedom");if(Je===-1)return;const tt={...j[Je]},qe={...tt.settings||{}};f?qe.domainStrategy=f:delete qe.domainStrategy,tt.settings=qe,j[Je]=tt,E.setValue("config.outbounds",j,{shouldDirty:!0}),A(j.map((yt,gr)=>({key:gr,...yt}))),ye(yt=>yt+1)},zr=d.exports.useMemo(()=>{var f;return(f=Pt.find(S=>(S==null?void 0:S.tag)==="warp"))!=null?f:null},[Pt]),It=d.exports.useMemo(()=>Pt.findIndex(f=>(f==null?void 0:f.tag)==="warp"),[Pt])!==-1,rr=d.exports.useMemo(()=>{const f=nt.find(S=>S.outboundTag==="warp");return Array.isArray(f==null?void 0:f.domain)?f.domain:[]},[nt]),Ct=f=>{const S=f.map(qe=>qe.trim()).filter((qe,yt,gr)=>qe.length>0&&gr.indexOf(qe)===yt),j=Ie(),Je=j.findIndex(qe=>qe.outboundTag==="warp");if(S.length===0){Je!==-1&&(j.splice(Je,1),We(j));return}const tt={type:"field",outboundTag:"warp",domain:S};Je!==-1?j[Je]={...j[Je],...tt}:j.push(tt),We(j)},Cr=f=>{const S=f.trim();!S||rr.includes(S)||Ct([...rr,S])},Rr=f=>{Ct(rr.filter(S=>S!==f))},fe=st("white","blackAlpha.400"),mr=st("gray.200","whiteAlpha.200"),cr=st("gray.600","gray.300"),Mr=f=>{var tt;const S=Fe(),j=(tt=f.tag)!=null?tt:"warp",Je=S.findIndex(qe=>(qe==null?void 0:qe.tag)===j);Je>=0?S[Je]=f:S.push(f),Be(S)},Un=()=>{const f=Fe(),S=f.findIndex(j=>(j==null?void 0:j.tag)==="warp");S!==-1&&(f.splice(S,1),Be(f),Ct([]),mt(""),H(""))},Ln=f=>{const S=Fe();B!==null&&B>=0&&B<S.length?S[B]=f:S.push(f),Be(S),V(null)},qs=()=>{J()},Ys=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{he(!1)}).catch(f=>{console.error("Error exiting fullscreen:",f)}):document.documentElement.requestFullscreen().then(()=>{he(!0)}).catch(f=>{console.error("Error entering fullscreen:",f)})},Gs=()=>{var S,j,Je,tt;const f=E.getValues("config")||{};switch(ze){case"inboundSettings":return JSON.stringify((S=f.inbounds)!=null?S:[],null,2);case"outboundSettings":return JSON.stringify((j=f.outbounds)!=null?j:[],null,2);case"routingRuleSettings":return JSON.stringify((tt=(Je=f.routing)==null?void 0:Je.rules)!=null?tt:[],null,2);case"xraySetting":default:return JSON.stringify(f!=null?f:{},null,2)}},_i=f=>{var S,j,Je,tt;try{const qe=JSON.parse(f),yt={...E.getValues("config")||{}};switch(ze){case"inboundSettings":yt.inbounds=qe;break;case"outboundSettings":yt.outbounds=qe,Me(qe);break;case"routingRuleSettings":yt.routing||(yt.routing={}),yt.routing.rules=qe,ge(qe);break;case"xraySetting":default:E.setValue("config",qe,{shouldDirty:!0}),Me((qe==null?void 0:qe.outbounds)||[]),ge(((S=qe==null?void 0:qe.routing)==null?void 0:S.rules)||[]),W(((Je=(j=qe==null?void 0:qe.routing)==null?void 0:j.balancers)==null?void 0:Je.map((gr,xn)=>{var gn;return{key:xn,tag:gr.tag||"",strategy:((gn=gr.strategy)==null?void 0:gn.type)||"random",selector:gr.selector||[],fallbackTag:gr.fallbackTag||""}}))||[]),P(((tt=qe==null?void 0:qe.dns)==null?void 0:tt.servers)||[]),te((qe==null?void 0:qe.fakedns)||[]);return}E.setValue("config",yt,{shouldDirty:!0})}catch{}},hs=()=>{var S,j;const f=E.getValues("config")||{};return pe==="observatory"?JSON.stringify((S=f.observatory)!=null?S:{},null,2):pe==="burstObservatory"?JSON.stringify((j=f.burstObservatory)!=null?j:{},null,2):""},ps=f=>{try{const S=JSON.parse(f),j={...E.getValues("config")||{}};pe==="observatory"&&(j.observatory=S),pe==="burstObservatory"&&(j.burstObservatory=S),E.setValue("config",j,{shouldDirty:!0})}catch{}},Di=f=>!f&&f!==0?[]:Array.isArray(f)?f.map(S=>typeof S=="string"?S.trim():String(S)).filter(Boolean):typeof f=="string"?f.split(",").map(S=>S.trim()).filter(Boolean):[String(f)],an=(f,S="blue")=>{const j=Di(f);return j.length?e(_p,{chips:j,color:S}):e(h,{color:"gray.400",children:"-"})},On=f=>{if(f==null||f===""||typeof f=="string"&&!f.trim())return e(h,{color:"gray.400",children:"-"});const S=typeof f=="string"?f:String(f);return S.length>30?e(Dp,{text:S,label:t("details")}):e(h,{children:S})},Ai=f=>{if(!f)return e(h,{color:"gray.400",children:"-"});try{const S=JSON.parse(f);if(S&&typeof S=="object"&&!Array.isArray(S)){const j=Object.entries(S);return j.length?e(N,{display:"flex",flexWrap:"wrap",gap:"1",children:j.map(([Je,tt])=>e(bt,{colorScheme:"purple",size:"sm",children:`${Je}: ${String(tt)}`},Je))}):e(h,{color:"gray.400",children:"-"})}}catch{}return e(h,{fontFamily:"mono",fontSize:"xs",whiteSpace:"pre-wrap",children:f})},Ii=hs(),Ti=Gs();return n(de,{spacing:6,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("header.coreSettings")}),e(h,{color:"gray.600",_dark:{color:"gray.300"},fontSize:"sm",children:t("pages.xray.coreDescription")}),e(ke,{direction:{base:"column",sm:"row"},spacing:{base:3,sm:4},justifyContent:"space-between",alignItems:{base:"stretch",sm:"center"},children:n(ke,{direction:{base:"column",sm:"row"},spacing:3,flexWrap:"wrap",w:"full",children:[e(F,{size:"sm",colorScheme:"primary",isLoading:i,isDisabled:!Y||i,onClick:Mt,w:{base:"full",sm:"auto"},children:t("core.save")}),e(F,{size:"sm",leftIcon:e(wo,{}),isLoading:gt,onClick:()=>ot(),variant:"outline",w:{base:"full",sm:"auto"},children:t(gt?"core.restarting":"core.restartCore")})]})}),n(ls,{variant:"enclosed",colorScheme:"primary",isLazy:!0,isManual:!0,children:[n(cs,{overflowX:"auto",flexWrap:{base:"wrap",md:"nowrap"},gap:{base:2,md:0},pb:{base:1,md:0},sx:{"&::-webkit-scrollbar":{display:"none"},button:{flexShrink:0,fontSize:"sm",minW:"max-content",px:3,py:2,"@media (min-width: 48em)":{fontSize:"md",px:4,py:3}}},children:[e($t,{children:n(R,{spacing:2,align:"center",children:[e(Yp,{}),e(h,{as:"span",children:t("pages.xray.basicTemplate")})]})}),e($t,{children:n(R,{spacing:2,align:"center",children:[e(Gp,{}),e(h,{as:"span",children:t("pages.xray.Routings")})]})}),e($t,{children:n(R,{spacing:2,align:"center",children:[e(Qp,{}),e(h,{as:"span",children:t("pages.xray.Outbounds")})]})}),e($t,{children:n(R,{spacing:2,align:"center",children:[e(Xp,{}),e(h,{as:"span",children:t("pages.xray.Balancers")})]})}),e($t,{children:n(R,{spacing:2,align:"center",children:[e(Zp,{}),e(h,{as:"span",children:t("DNS")})]})}),e($t,{children:n(R,{spacing:2,align:"center",children:[e(jp,{}),e(h,{as:"span",children:t("pages.xray.advancedTemplate")})]})}),e($t,{children:n(R,{spacing:2,align:"center",children:[e(em,{}),e(h,{as:"span",children:t("pages.xray.logs")})]})})]}),n(ds,{children:[e(Kt,{children:n(de,{spacing:4,align:"stretch",children:[n(Ki,{title:t("pages.xray.generalConfigs"),children:[e(Br,{label:t("pages.xray.FreedomStrategy"),controlId:"freedom-domain-strategy",children:f=>n(je,{id:f,size:"sm",maxW:"220px",value:vr,onChange:S=>Xt(S.target.value),isDisabled:Qt===-1,children:[e("option",{value:"",children:t("core.default","Default")}),["AsIs","UseIP","UseIPv4","UseIPv6","UseIPv6v4","UseIPv4v6"].map(S=>e("option",{value:S,children:S},S))]})}),e(Br,{label:t("pages.xray.RoutingStrategy"),controlId:"routing-domain-strategy",children:f=>e(pt,{name:"config.routing.domainStrategy",control:E.control,render:({field:S})=>e(je,{...S,id:f,size:"sm",maxW:"220px",children:["AsIs","IPIfNonMatch","IPOnDemand"].map(j=>e("option",{value:j,children:j},j))})})})]}),e(N,{borderWidth:"1px",borderColor:mr,borderRadius:"lg",bg:fe,p:{base:3,md:4},children:n(de,{align:"stretch",spacing:3,children:[n(R,{justify:"space-between",align:"center",children:[e(h,{fontWeight:"semibold",children:t("pages.xray.warpRouting")}),e(F,{variant:"outline",size:"sm",leftIcon:e(ko,{}),onClick:Z,children:It?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")})]}),e(h,{fontSize:"sm",color:cr,children:t("pages.xray.warpRoutingDesc")}),n(ai,{children:[rr.length===0&&e(Ns,{children:e(bt,{colorScheme:"gray",variant:"subtle",children:e(Pa,{children:t("core.empty","Empty")})})}),rr.map(f=>e(Ns,{children:n(bt,{colorScheme:"primary",borderRadius:"full",children:[e(Pa,{children:f}),e(nd,{"aria-label":t("core.remove"),onClick:()=>Rr(f)})]})},f))]}),n(R,{spacing:3,flexWrap:"wrap",children:[e(je,{placeholder:t("core.select"),size:"sm",maxW:"240px",value:ut,onChange:f=>{const{value:S}=f.target;S&&Cr(S),mt("")},children:tm.map(f=>e("option",{value:f.value,children:f.label},f.value))}),n(R,{spacing:2,maxW:"320px",flex:"1",children:[e(we,{size:"sm",value:Q,onChange:f=>H(f.target.value),placeholder:"geosite:google"}),e(F,{size:"sm",colorScheme:"primary",onClick:()=>{Cr(Q),H("")},isDisabled:!Q.trim(),children:t("core.add")})]})]})]})}),n(Ki,{title:t("pages.xray.statistics"),children:[e(Br,{label:t("pages.xray.statsInboundUplink"),controlId:"stats-inbound-uplink",children:f=>e(pt,{name:"config.policy.system.statsInboundUplink",control:E.control,render:({field:S})=>e(ht,{id:f,isChecked:!!S.value,onChange:j=>S.onChange(j.target.checked)})})}),e(Br,{label:t("pages.xray.statsInboundDownlink"),controlId:"stats-inbound-downlink",children:f=>e(pt,{name:"config.policy.system.statsInboundDownlink",control:E.control,render:({field:S})=>e(ht,{id:f,isChecked:!!S.value,onChange:j=>S.onChange(j.target.checked)})})}),e(Br,{label:t("pages.xray.statsOutboundUplink"),controlId:"stats-outbound-uplink",children:f=>e(pt,{name:"config.policy.system.statsOutboundUplink",control:E.control,render:({field:S})=>e(ht,{id:f,isChecked:!!S.value,onChange:j=>S.onChange(j.target.checked)})})}),e(Br,{label:t("pages.xray.statsOutboundDownlink"),controlId:"stats-outbound-downlink",children:f=>e(pt,{name:"config.policy.system.statsOutboundDownlink",control:E.control,render:({field:S})=>e(ht,{id:f,isChecked:!!S.value,onChange:j=>S.onChange(j.target.checked)})})})]}),n(Ki,{title:t("pages.xray.logConfigs"),children:[e(Br,{label:t("pages.xray.logLevel"),controlId:"log-level",children:f=>e(pt,{name:"config.log.loglevel",control:E.control,render:({field:S})=>e(je,{...S,id:f,size:"sm",maxW:"220px",children:["none","debug","info","warning","error"].map(j=>e("option",{value:j,children:j},j))})})}),e(Br,{label:t("pages.xray.accessLog"),controlId:"access-log",children:f=>e(pt,{name:"config.log.access",control:E.control,render:({field:S})=>n(je,{...S,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./access.log"].map(j=>e("option",{value:j,children:j},j))]})})}),e(Br,{label:t("pages.xray.errorLog"),controlId:"error-log",children:f=>e(pt,{name:"config.log.error",control:E.control,render:({field:S})=>n(je,{...S,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["none","./error.log"].map(j=>e("option",{value:j,children:j},j))]})})}),e(Br,{label:t("pages.xray.maskAddress"),controlId:"mask-address",children:f=>e(pt,{name:"config.log.maskAddress",control:E.control,render:({field:S})=>n(je,{...S,id:f,size:"sm",maxW:"220px",children:[e("option",{value:"",children:"Empty"}),["quarter","half","full"].map(j=>e("option",{value:j,children:j},j))]})})}),e(Br,{label:t("pages.xray.dnsLog"),controlId:"dns-log",children:f=>e(pt,{name:"config.log.dnsLog",control:E.control,render:({field:S})=>e(ht,{id:f,isChecked:!!S.value,onChange:j=>S.onChange(j.target.checked)})})})]})]})}),e(Kt,{children:n(de,{spacing:4,align:"stretch",children:[e(F,{leftIcon:e(xs,{}),...vs,onClick:tr,children:t("pages.xray.rules.add")}),e(Cs,{children:n(_s,{minW:"1100px",children:[n(Zr,{children:[n(_t,{children:[e(He,{rowSpan:2,w:"80px",children:t("common.index",{defaultValue:"#"})}),e(He,{colSpan:2,children:t("pages.xray.rules.sourceGroup",{defaultValue:"Source"})}),e(He,{colSpan:3,children:t("pages.xray.rules.networkGroup",{defaultValue:"Network"})}),e(He,{colSpan:3,children:t("pages.xray.rules.destinationGroup",{defaultValue:"Destination"})}),e(He,{colSpan:2,children:t("pages.xray.rules.inboundGroup",{defaultValue:"Inbound"})}),e(He,{rowSpan:2,children:t("pages.xray.rules.outbound")}),e(He,{rowSpan:2,children:t("pages.xray.rules.balancer",{defaultValue:"Balancer"})}),e(He,{rowSpan:2,children:t("actions",{defaultValue:"Actions"})})]}),n(_t,{children:[e(He,{children:t("IP",{defaultValue:"IP"})}),e(He,{children:t("port",{defaultValue:"Port"})}),e(He,{children:t("network",{defaultValue:"Network"})}),e(He,{children:t("pages.xray.rules.protocol",{defaultValue:"Protocol"})}),e(He,{children:t("pages.xray.rules.attrs",{defaultValue:"Attrs"})}),e(He,{children:t("IP",{defaultValue:"IP"})}),e(He,{children:t("pages.xray.rules.domain",{defaultValue:"Domain"})}),e(He,{children:t("port",{defaultValue:"Port"})}),e(He,{children:t("pages.xray.rules.inboundTag",{defaultValue:"Inbound Tag"})}),e(He,{children:t("pages.xray.rules.user",{defaultValue:"Client"})})]})]}),n($r,{children:[me.length===0&&e(_t,{children:e(Ne,{colSpan:14,children:e(h,{textAlign:"center",color:"gray.500",children:t("pages.xray.rules.empty",{defaultValue:"No routing rules defined yet."})})})}),me.map((f,S)=>n(_t,{children:[e(Ne,{children:n(de,{align:"flex-start",spacing:1,children:[e(h,{fontWeight:"semibold",children:S+1}),n(R,{spacing:1,children:[e(Ue,{"aria-label":"move up",icon:e(So,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>be(S,S-1)}),e(Ue,{"aria-label":"move down",icon:e(xo,{}),size:"xs",variant:"ghost",isDisabled:S===me.length-1,onClick:()=>be(S,S+1)})]})]})}),e(Ne,{children:an(f.source,"blue")}),e(Ne,{children:On(f.sourcePort)}),e(Ne,{children:an(f.network,"purple")}),e(Ne,{children:an(f.protocol,"green")}),e(Ne,{children:Ai(f.attrs)}),e(Ne,{children:an(f.ip,"blue")}),e(Ne,{children:an(f.domain,"blue")}),e(Ne,{children:On(f.port)}),e(Ne,{children:an(f.inboundTag,"teal")}),e(Ne,{children:an(f.user,"cyan")}),e(Ne,{children:On(f.outboundTag)}),e(Ne,{children:On(f.balancerTag)}),e(Ne,{children:n(R,{spacing:1,children:[e(Ue,{"aria-label":"edit",icon:e(ks,{}),size:"xs",variant:"ghost",onClick:()=>or(S)}),e(Ue,{"aria-label":"delete",icon:e(ws,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>G(S)})]})})]},f.key))]})]})})]})}),e(Kt,{children:n(de,{spacing:4,align:"stretch",children:[n(R,{children:[e(F,{leftIcon:e(xs,{}),...vs,onClick:hr,children:t("pages.xray.outbound.addOutbound")}),e(F,{leftIcon:e(ko,{}),size:"xs",variant:"ghost",onClick:Z,children:It?t("pages.xray.warp.manage","Manage WARP"):t("pages.xray.warp.create","Create WARP")}),e(F,{leftIcon:e(wo,{}),size:"xs",variant:"ghost",onClick:et,children:t("refresh")})]}),e(Cs,{children:n(_s,{minW:"880px",children:[e(Zr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.outbound.tag")}),e(He,{children:t("protocol")}),e(He,{children:t("pages.xray.outbound.address")}),e(He,{children:t("pages.inbounds.traffic")})]})}),e($r,{children:re.map((f,S)=>{var j,Je,tt;return n(_t,{children:[e(Ne,{children:n(R,{children:[e(h,{children:S+1}),e(Ue,{"aria-label":t("pages.xray.outbound.moveUp","Move up"),icon:e(So,{}),size:"xs",variant:"ghost",isDisabled:S===0,onClick:()=>ir(S)}),e(Ue,{"aria-label":t("pages.xray.outbound.moveDown","Move down"),icon:e(xo,{}),size:"xs",variant:"ghost",isDisabled:S===re.length-1,onClick:()=>ar(S)}),e(Ue,{"aria-label":"edit",icon:e(ks,{}),size:"xs",variant:"ghost",onClick:()=>sr(S)}),e(Ue,{"aria-label":"delete",icon:e(ws,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>pr(S)})]})}),e(Ne,{children:f.tag}),n(Ne,{children:[e(bt,{colorScheme:"purple",children:f.protocol}),["vmess","vless","trojan","shadowsocks"].includes(f.protocol)&&n(Ot,{children:[e(bt,{colorScheme:"blue",children:(j=f.streamSettings)==null?void 0:j.network}),((Je=f.streamSettings)==null?void 0:Je.security)==="tls"&&e(bt,{colorScheme:"green",children:"tls"}),((tt=f.streamSettings)==null?void 0:tt.security)==="reality"&&e(bt,{colorScheme:"green",children:"reality"})]})]}),e(Ne,{children:Gt(f).map(qe=>e(h,{children:qe},qe))}),e(Ne,{children:e(bt,{colorScheme:"green",children:lr(f)})})]},f.key)})})]})})]})}),e(Kt,{children:n(de,{spacing:4,align:"stretch",children:[e(F,{leftIcon:e(xs,{}),...vs,onClick:M,children:t("pages.xray.balancer.addBalancer")}),e(Cs,{children:n(_s,{minW:"680px",children:[e(Zr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.balancer.tag")}),e(He,{children:t("pages.xray.balancer.balancerStrategy")}),e(He,{children:t("pages.xray.balancer.balancerSelectors")})]})}),e($r,{children:Ee.map((f,S)=>n(_t,{children:[e(Ne,{children:n(R,{children:[e(h,{children:S+1}),e(Ue,{"aria-label":"edit",icon:e(ks,{}),size:"xs",variant:"ghost",onClick:()=>xe()}),e(Ue,{"aria-label":"delete",icon:e(ws,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>Le(S)})]})}),e(Ne,{children:f.tag}),e(Ne,{children:e(bt,{colorScheme:f.strategy==="random"?"purple":"green",children:f.strategy==="random"?"Random":f.strategy==="roundRobin"?"Round Robin":f.strategy==="leastLoad"?"Least Load":"Least Ping"})}),e(Ne,{children:f.selector.map(j=>e(bt,{colorScheme:"blue",m:1,children:j},j))})]},f.key))})]})}),(((Qs=E.getValues("config"))==null?void 0:Qs.observatory)||((ms=E.getValues("config"))==null?void 0:ms.burstObservatory))&&n(de,{spacing:3,align:"stretch",children:[e(fi,{onChange:f=>{oe(f),ye(S=>S+1)},value:pe,children:n(R,{spacing:3,children:[((gs=E.getValues("config"))==null?void 0:gs.observatory)&&e(Qr,{value:"observatory",children:"Observatory"}),((fs=E.getValues("config"))==null?void 0:fs.burstObservatory)&&e(Qr,{value:"burstObservatory",children:"Burst Observatory"})]})}),e(N,{h:"300px",children:e(ia,{json:Ii,onChange:f=>ps(f)},`obs-${pe}-${$}`)})]})]})}),e(Kt,{children:n(de,{spacing:4,align:"stretch",children:[n(k,{display:"flex",alignItems:"center",children:[e(_,{children:t("pages.xray.dns.enable")}),e(pt,{name:"config.dns",control:E.control,render:({field:f})=>e(ht,{isChecked:!!f.value,onChange:S=>{const j={...E.getValues("config")};S.target.checked?j.dns={servers:[],queryStrategy:"UseIP",tag:"dns_inbound"}:(delete j.dns,delete j.fakedns),E.setValue("config",j,{shouldDirty:!0}),P([]),te([])}})})]}),y.length>0&&n(Ot,{children:[e(F,{leftIcon:e(xs,{}),...vs,onClick:Ke,children:t("pages.xray.dns.add")}),e(Cs,{children:n(_s,{minW:"720px",children:[e(Zr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.outbound.address")}),e(He,{children:t("pages.xray.dns.domains")}),e(He,{children:t("pages.xray.dns.expectIPs")})]})}),e($r,{children:y.map((f,S)=>n(_t,{children:[e(Ne,{children:n(R,{children:[e(h,{children:S+1}),e(Ue,{"aria-label":"edit",icon:e(ks,{}),size:"xs",variant:"ghost",onClick:()=>Ge()}),e(Ue,{"aria-label":"delete",icon:e(ws,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>it(S)})]})}),e(Ne,{children:typeof f=="object"?f.address:f}),e(Ne,{children:typeof f=="object"?vo(f.domains):""}),e(Ne,{children:typeof f=="object"?vo(f.expectIPs):""})]},S))})]})})]}),ie.length>0&&n(Ot,{children:[e(F,{leftIcon:e(xs,{}),...vs,onClick:Nt,children:t("pages.xray.fakedns.add")}),e(Cs,{children:n(_s,{minW:"520px",children:[e(Zr,{children:n(_t,{children:[e(He,{children:"#"}),e(He,{children:t("pages.xray.fakedns.ipPool")}),e(He,{children:t("pages.xray.fakedns.poolSize")})]})}),e($r,{children:ie.map((f,S)=>n(_t,{children:[e(Ne,{children:n(R,{children:[e(h,{children:S+1}),e(Ue,{"aria-label":"edit",icon:e(ks,{}),size:"xs",variant:"ghost",onClick:()=>Vt()}),e(Ue,{"aria-label":"delete",icon:e(ws,{}),size:"xs",variant:"ghost",colorScheme:"red",onClick:()=>kr(S)})]})}),e(Ne,{children:f.ipPool}),e(Ne,{children:f.poolSize})]},S))})]})})]})]})}),e(Kt,{children:n(de,{spacing:4,align:"stretch",children:[n(N,{px:2,children:[e(h,{fontWeight:"semibold",children:t("pages.xray.Template")}),e(h,{fontSize:"sm",color:"gray.600",_dark:{color:"gray.300"},children:t("pages.xray.TemplateDesc")})]}),e(N,{px:2,children:e(fi,{onChange:f=>{at(f),ye(S=>S+1)},value:ze,children:n(R,{spacing:3,wrap:"wrap",children:[e(Qr,{value:"xraySetting",children:t("pages.xray.completeTemplate")}),e(Qr,{value:"inboundSettings",children:t("pages.xray.Inbounds")}),e(Qr,{value:"outboundSettings",children:t("pages.xray.Outbounds")}),e(Qr,{value:"routingRuleSettings",children:t("pages.xray.Routings")})]})})}),n(N,{position:"relative",w:"100%",h:"calc(100vh - 350px)",minH:"400px",children:[e(Ue,{position:L?"fixed":"absolute",top:2,right:2,"aria-label":L?"Exit Full Screen":"Full Screen",icon:L?e(qp,{}):e(Jp,{}),onClick:Ys,zIndex:L?1101:10}),e(N,{w:L?"100vw":"100%",h:L?"100vh":"100%",position:L?"fixed":"relative",top:L?0:"auto",left:L?0:"auto",zIndex:L?1e3:"auto",children:e(ia,{json:Ti,onChange:f=>{_i(f)}},`advanced-${ze}-${$}`)}),L&&le&&e(F,{position:"fixed",bottom:4,left:"50%",transform:"translateX(-50%)",zIndex:1102,size:"sm",colorScheme:"primary",onClick:Ys,children:t("pages.xray.exitFullscreen","Exit full screen")})]})]})}),e(Kt,{children:e(N,{children:e(Rl,{showTitle:!1})})})]})]}),e(Pp,{isOpen:p,onClose:jt,mode:B!==null?"edit":"create",initialOutbound:B!==null?Pt[B]:null,onSubmitOutbound:Ln}),e(Lp,{isOpen:I,mode:Re!==null?"edit":"create",initialRule:Re!==null&&nt[Re]||null,availableInboundTags:vt,availableOutboundTags:Wr,availableBalancerTags:Fr,onSubmit:X,onClose:rt}),e(Kp,{isOpen:ve,onClose:qs,initialOutbound:zr,onSave:Mr,onDelete:Un}),e(Op,{isOpen:x,onClose:C,form:E,setBalancersData:W}),e(Wp,{isOpen:z,onClose:b,form:E,setDnsServers:P}),e(Fp,{isOpen:U,onClose:O,form:E,setFakeDns:te})]})},nm=({isOpen:t,onClose:s,onSubmit:r,isSaving:l,allHosts:o,allAdmins:i,initialService:a})=>{var A,me,De,Ee;const{t:c}=$e(),[u,p]=d.exports.useState((A=a==null?void 0:a.name)!=null?A:""),[m,g]=d.exports.useState((me=a==null?void 0:a.description)!=null?me:""),[I,D]=d.exports.useState((De=a==null?void 0:a.admin_ids)!=null?De:[]),[w,x]=d.exports.useState((Ee=a==null?void 0:a.hosts.map(W=>W.id))!=null?Ee:[]),[v,C]=d.exports.useState(""),[z,ne]=d.exports.useState(""),[b,U]=d.exports.useState(null),T=Bt();d.exports.useEffect(()=>{var W,y,P,ie;t&&(p((W=a==null?void 0:a.name)!=null?W:""),g((y=a==null?void 0:a.description)!=null?y:""),D((P=a==null?void 0:a.admin_ids)!=null?P:[]),x((ie=a==null?void 0:a.hosts.map(te=>te.id))!=null?ie:[]),C(""),ne(""))},[t,a]);const O=d.exports.useMemo(()=>new Map(o.map(W=>[W.id,W])),[o]),ve=d.exports.useMemo(()=>o.filter(W=>!w.includes(W.id)&&!W.isDisabled),[o,w]),Z=d.exports.useMemo(()=>{const W=z.trim().toLowerCase();return W?ve.filter(y=>{const P=y.label.toLowerCase(),ie=y.inboundTag.toLowerCase(),te=y.protocol.toLowerCase();return P.includes(W)||ie.includes(W)||te.includes(W)}):ve},[ve,z]),J=d.exports.useMemo(()=>{const W=v.trim().toLowerCase();return W?i.filter(y=>y.username.toLowerCase().includes(W)):i},[v,i]),E=d.exports.useMemo(()=>new Set(I),[I]),q=W=>{D(y=>y.includes(W)?y.filter(P=>P!==W):[...y,W])},ue=W=>{x(y=>y.includes(W)?y.filter(P=>P!==W):[...y,W])},Y=(W,y)=>{x(P=>{const ie=P.indexOf(W);if(ie===-1)return P;const te=y==="up"?ie-1:ie+1;if(te<0||te>=P.length)return P;const Ce=[...P];return[Ce[ie],Ce[te]]=[Ce[te],Ce[ie]],Ce})},re=async()=>{if(!u.trim()){T({status:"warning",title:c("services.validation.nameRequired","Service name is required")});return}if(!w.length){T({status:"warning",title:c("services.validation.hostRequired","Please select at least one host")});return}const W=w.map((y,P)=>({host_id:y,sort:P}));await r({name:u.trim(),description:(m==null?void 0:m.trim())||null,admin_ids:I,hosts:W},a==null?void 0:a.id)};return n(Ut,{isOpen:t,onClose:s,size:"5xl",children:[e(wt,{}),n(Lt,{children:[e(At,{children:a?c("services.editTitle","Edit Service"):c("services.createTitle","Create Service")}),e(Rt,{}),e(kt,{children:n(ke,{spacing:6,children:[n(R,{spacing:4,children:[e(Zt,{label:c("services.fields.name","Name"),value:u,onChange:W=>p(W.target.value),maxLength:128,isRequired:!0}),e(Zt,{label:c("services.fields.description","Description"),value:m!=null?m:"",onChange:W=>g(W.target.value),maxLength:256})]}),n(N,{children:[e(h,{fontWeight:"medium",mb:2,children:c("services.fields.admins","Admins")}),n(ke,{spacing:3,children:[e(Zt,{value:v,onChange:W=>C(W.target.value),placeholder:c("services.searchAdmins","Search admins"),size:"sm",clearable:!0}),e(de,{align:"stretch",spacing:2,maxH:"200px",overflowY:"auto",borderWidth:"1px",borderRadius:"md",p:3,children:i.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsFound","No admins available")}):J.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noAdminsMatching","No admins match your search")}):J.map(W=>{const y=E.has(W.id);return e(N,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:y?"primary.400":"gray.200",bg:y?"primary.50":"transparent",_hover:{borderColor:"primary.300",cursor:"pointer"},_dark:{borderColor:y?"primary.300":"gray.600",bg:y?"gray.700":"transparent"},transition:"all 0.1s ease-in-out",onClick:()=>q(W.id),onKeyDown:P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),q(W.id))},role:"button",tabIndex:0,children:n(lt,{align:"center",justify:"space-between",children:[e(h,{fontWeight:"medium",children:W.username}),y&&e(sn,{colorScheme:"primary",children:c("services.selected","Selected")})]})},W.id)})})]}),e(h,{fontSize:"sm",color:"gray.500",mt:1,children:c("services.adminHint","Selected admins can create users for this service")})]}),n(Rs,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:4,children:[e(rn,{children:n(tn,{variant:"outline",h:"full",children:[e(qn,{children:e(h,{fontWeight:"semibold",children:c("services.availableHosts","Available Hosts")})}),e(cn,{children:n(ke,{spacing:3,children:[e(Zt,{value:z,onChange:W=>ne(W.target.value),placeholder:c("services.searchHosts","Search hosts"),size:"sm",clearable:!0}),e(de,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:ve.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsLeft","All hosts are selected")}):Z.length===0?e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsMatching","No hosts match your search")}):Z.map(W=>n(N,{borderWidth:"1px",borderRadius:"md",px:3,py:2,borderColor:b===W.id?"primary.400":"gray.200",_hover:{borderColor:"primary.300",cursor:"pointer"},onMouseEnter:()=>U(W.id),onMouseLeave:()=>U(null),onClick:()=>ue(W.id),children:[e(h,{fontWeight:"medium",children:W.label}),n(h,{fontSize:"sm",color:"gray.500",children:[W.protocol.toUpperCase()," - ",W.inboundTag]})]},W.id))})]})})]})}),e(rn,{children:n(tn,{variant:"outline",h:"full",children:[e(qn,{children:e(h,{fontWeight:"semibold",children:c("services.selectedHosts","Selected Hosts")})}),e(cn,{children:n(de,{align:"stretch",spacing:2,maxH:"300px",overflowY:"auto",children:[w.length===0&&e(h,{fontSize:"sm",color:"gray.500",children:c("services.noHostsSelected","Choose hosts from the left list")}),w.map((W,y)=>{const P=O.get(W);return P?e(sd.div,{layout:!0,children:n(lt,{align:"center",justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,gap:3,children:[n(N,{children:[n(R,{spacing:2,align:"center",children:[e(h,{fontWeight:"medium",children:P.label}),P.isDisabled&&e(sn,{colorScheme:"red",children:c("services.hostDisabled","Disabled")})]}),n(h,{fontSize:"sm",color:"gray.500",children:[P.protocol.toUpperCase()," - ",P.inboundTag]})]}),n(R,{spacing:1,children:[e(ct,{label:c("services.moveUp","Move up"),children:e(Ue,{"aria-label":"Move up",size:"sm",variant:"ghost",icon:e(ll,{width:16}),onClick:()=>Y(W,"up"),isDisabled:y===0})}),e(ct,{label:c("services.moveDown","Move down"),children:e(Ue,{"aria-label":"Move down",size:"sm",variant:"ghost",icon:e(cl,{width:16}),onClick:()=>Y(W,"down"),isDisabled:y===w.length-1})}),e(ct,{label:c("services.removeHost","Remove host"),children:e(Ue,{"aria-label":"Remove",size:"sm",variant:"ghost",icon:e(nn,{width:16}),onClick:()=>ue(W)})})]})]})},W):null})]})})]})})]})]})}),e(zt,{children:n(R,{justify:"flex-end",w:"full",children:[e(F,{onClick:s,children:c("cancel")}),e(F,{colorScheme:"primary",onClick:re,isLoading:l,children:c(a?"saveChanges":"create")})]})})]})]})},sm=()=>{var at;const{t}=$e(),s=Bt(),{userData:r,getUserIsSuccess:l}=Mn(),o=l&&r.is_sudo,i=Gn(),a=pn(),c=xl(),{inbounds:u,refetchUsers:p}=xt(),m=Yt(),[g,I]=d.exports.useState(null);d.exports.useEffect(()=>{!l||!o||(i.fetchServices(),a.fetchAdmins({limit:500,offset:0}),Ls(),c.fetchHosts())},[l,o]);const D=d.exports.useMemo(()=>a.admins.slice().sort((pe,oe)=>pe.username.localeCompare(oe.username)).map(pe=>({id:pe.id,username:pe.username})),[a.admins]),w=d.exports.useMemo(()=>{var oe,le;const pe=[];for(const[$,ye]of Object.entries(c.hosts)){const ut=(oe=Array.from(u.values()).flat().find(Q=>Q.tag===$))!=null?oe:null,mt=(le=ut==null?void 0:ut.protocol)!=null?le:"unknown";ye.forEach(Q=>{Q.id!=null&&pe.push({id:Q.id,label:Q.remark,inboundTag:$,protocol:mt,isDisabled:Boolean(Q.is_disabled)})})}return pe},[c.hosts,u]),x=()=>{I(null),m.onOpen()},v=async pe=>{try{const oe=await i.fetchServiceDetail(pe);I(oe),m.onOpen()}catch{s({status:"error",title:t("services.fetchFailed","Unable to fetch service details")})}},C=async(pe,oe)=>{var le,$;try{oe?(await i.updateService(oe,pe),s({status:"success",title:t("services.updated","Service updated")})):(await i.createService(pe),s({status:"success",title:t("services.created","Service created")})),p(!0),m.onClose()}catch(ye){s({status:"error",title:($=(le=ye==null?void 0:ye.data)==null?void 0:le.detail)!=null?$:t("services.saveFailed","Failed to save service")})}},z=async pe=>{var oe,le;try{const $=await i.fetchServiceDetail(pe);De($),Oe()}catch($){s({status:"error",title:(le=(oe=$==null?void 0:$.data)==null?void 0:oe.detail)!=null?le:t("services.deleteFailed","Unable to delete service")})}},ne=async pe=>{var oe,le;try{await i.resetServiceUsage(pe),s({status:"success",title:t("services.resetSuccess","Usage reset")})}catch($){s({status:"error",title:(le=(oe=$==null?void 0:$.data)==null?void 0:oe.detail)!=null?le:t("services.resetFailed","Failed to reset usage")})}},[b,U]=d.exports.useState(null),[T,O]=d.exports.useState(!1),{isOpen:ve,onOpen:Z,onClose:J}=Yt(),E=d.exports.useRef(null),q=pe=>{U(pe),Z()},ue=async()=>{if(b!=null){O(!0);try{await ne(b)}finally{O(!1),J()}}},Y=b!=null?(at=i.services.find(pe=>pe.id===b))==null?void 0:at.name:void 0,re=()=>{De(null),B()},A=async()=>{var oe,le;if(!me)return;const pe={mode:me.user_count?Ee:"delete_users",unlink_admins:y};if(pe.mode==="transfer_users"){if(!ie){s({status:"error",title:t("services.selectTransferTarget","Select a target service")});return}pe.target_service_id=ie}Te(!0);try{await i.deleteService(me.id,pe),s({status:"success",title:t("services.deleted","Service removed")}),p(!0),re()}catch($){s({status:"error",title:(le=(oe=$==null?void 0:$.data)==null?void 0:oe.detail)!=null?le:t("services.deleteFailed","Unable to delete service")})}finally{Te(!1)}},[me,De]=d.exports.useState(null),[Ee,W]=d.exports.useState("delete_users"),[y,P]=d.exports.useState(!1),[ie,te]=d.exports.useState(null),[Ce,Te]=d.exports.useState(!1),{isOpen:Re,onOpen:Oe,onClose:B}=Yt(),V=d.exports.useMemo(()=>me?i.services.filter(pe=>pe.id!==me.id):i.services,[me,i.services]);d.exports.useEffect(()=>{me&&(W("delete_users"),P(me.admin_ids.length>0),te(null))},[me]),d.exports.useEffect(()=>{Ee==="delete_users"&&te(null)},[Ee]);const L=pe=>e(tl,{borderWidth:"1px",borderRadius:"lg",borderColor:"gray.200",_dark:{borderColor:"whiteAlpha.200",bg:"gray.800"},mb:2,children:({isExpanded:oe})=>n(Ot,{children:[n(rl,{px:4,py:3,display:"flex",alignItems:"flex-start",gap:3,children:[n(N,{flex:"1",textAlign:"left",children:[e(h,{fontWeight:"semibold",children:pe.name}),pe.description&&e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},noOfLines:oe?3:1,mt:1,children:pe.description})]}),n(de,{spacing:1,align:"flex-end",fontSize:"xs",color:"gray.500",children:[n(R,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.hosts","Hosts"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:pe.host_count})]}),n(R,{spacing:1,children:[n(h,{fontWeight:"medium",children:[t("services.columns.users","Users"),":"]}),e(h,{fontWeight:"semibold",color:"gray.700",_dark:{color:"gray.200"},children:pe.user_count})]})]}),e(id,{})]}),e(nl,{pt:0,pb:4,children:n(ke,{spacing:4,children:[n(Ve,{columns:2,spacing:3,children:[n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.usage","Usage")}),e(h,{fontWeight:"semibold",children:Xe(pe.used_traffic)})]}),n(N,{children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.columns.lifetime","Lifetime")}),e(h,{fontWeight:"semibold",children:Xe(pe.lifetime_used_traffic)})]})]}),n(ke,{spacing:2,children:[e(h,{fontSize:"xs",textTransform:"uppercase",color:"gray.500",children:t("services.actions","Actions")}),n(R,{spacing:2,flexWrap:"wrap",children:[e(ct,{label:t("services.view","View"),children:e(Ue,{"aria-label":"View",icon:e(zs,{width:18}),size:"sm",variant:"outline",onClick:le=>{le.stopPropagation(),i.fetchServiceDetail(pe.id)}})}),e(ct,{label:t("services.edit","Edit"),children:e(Ue,{"aria-label":"Edit",icon:e(Xi,{width:18}),size:"sm",variant:"outline",onClick:le=>{le.stopPropagation(),v(pe.id)},isDisabled:!o})}),e(ct,{label:t("services.resetUsage","Reset usage"),children:e(Ue,{"aria-label":"Reset usage",icon:e(Kr,{width:18}),size:"sm",variant:"outline",onClick:le=>{le.stopPropagation(),q(pe.id)},isDisabled:!o})}),e(ct,{label:t("services.delete","Delete"),children:e(Ue,{"aria-label":"Delete",icon:e(nn,{width:18}),size:"sm",variant:"outline",colorScheme:"red",onClick:le=>{le.stopPropagation(),z(pe.id)},isDisabled:!o})})]})]})]})})]})},`service-accordion-${pe.id}`),he=pe=>n(_t,{children:[e(Ne,{children:n(de,{align:"start",spacing:0,children:[e(h,{fontWeight:"semibold",children:pe.name}),pe.description&&e(h,{fontSize:"sm",color:"gray.500",children:pe.description})]})}),e(Ne,{children:pe.host_count}),e(Ne,{children:pe.user_count}),e(Ne,{children:Xe(pe.used_traffic)}),e(Ne,{children:Xe(pe.lifetime_used_traffic)}),e(Ne,{children:n(R,{spacing:2,children:[e(ct,{label:t("services.view","View"),children:e(Ue,{"aria-label":"View",icon:e(zs,{width:18}),size:"sm",variant:"ghost",onClick:()=>i.fetchServiceDetail(pe.id)})}),o&&n(Ot,{children:[e(ct,{label:t("services.edit","Edit"),children:e(Ue,{"aria-label":"Edit",icon:e(Xi,{width:18}),size:"sm",variant:"ghost",onClick:()=>v(pe.id)})}),e(ct,{label:t("services.resetUsage","Reset usage"),children:e(Ue,{"aria-label":"Reset usage",icon:e(Kr,{width:18}),size:"sm",variant:"ghost",onClick:()=>q(pe.id)})}),e(ct,{label:t("services.delete","Delete"),children:e(Ue,{"aria-label":"Delete",icon:e(nn,{width:18}),size:"sm",variant:"ghost",onClick:()=>z(pe.id)})})]})]})})]},pe.id),ze=i.serviceDetail;return l?o?n(de,{spacing:4,align:"stretch",children:[n(lt,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},gap:{base:3,md:0},children:[n(N,{children:[e(h,{as:"h1",fontSize:"2xl",fontWeight:"semibold",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.subtitle","Group hosts, assign admins, and monitor usage per service.")})]}),o&&e(F,{leftIcon:e(un,{width:18}),colorScheme:"primary",onClick:x,size:"sm",alignSelf:{base:"flex-start",md:"center"},w:{base:"auto",md:"auto"},px:{base:4,md:5},children:t("services.addService","New Service")})]}),e(tn,{variant:"outline",children:e(cn,{children:i.isLoading?e(lt,{justify:"center",py:10,children:e(Dt,{})}):n(Ot,{children:[e(el,{allowToggle:!0,display:{base:"block",md:"none"},children:i.services.map(L)}),e(N,{display:{base:"none",md:"block"},overflowX:"auto",children:n(Pn,{variant:"simple",children:[e(Zr,{children:n(_t,{children:[e(He,{children:t("services.columns.name","Name")}),e(He,{children:t("services.columns.hosts","Hosts")}),e(He,{children:t("services.columns.users","Users")}),e(He,{children:t("services.columns.usage","Usage")}),e(He,{children:t("services.columns.lifetime","Lifetime")}),e(He,{children:t("services.columns.actions","Actions")})]})}),e($r,{children:i.services.map(he)})]})})]})})}),ze&&n(tn,{variant:"outline",children:[e(qn,{children:n(lt,{justify:"space-between",align:"center",children:[n(N,{children:[e(h,{fontWeight:"semibold",children:ze.name}),ze.description&&e(h,{fontSize:"sm",color:"gray.500",children:ze.description})]}),e(sn,{colorScheme:"primary",children:t("services.usersCount","{{count}} users",{count:ze.user_count})})]})}),e(cn,{children:n(Ve,{columns:{base:1,md:2},spacing:6,children:[n(N,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.admins","Admins")}),e(ke,{spacing:2,children:ze.admins.length===0?e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdmins","No admins assigned")}):ze.admins.map(pe=>n(lt,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:pe.username}),n(h,{fontSize:"sm",color:"gray.500",children:[Xe(pe.used_traffic)," /"," ",Xe(pe.lifetime_used_traffic)]})]},pe.id))})]}),n(N,{children:[e(h,{fontWeight:"medium",mb:2,children:t("services.hosts","Hosts")}),e(ke,{spacing:2,children:ze.hosts.map(pe=>n(lt,{borderWidth:"1px",borderRadius:"md",px:3,py:2,justify:"space-between",align:"center",children:[n(N,{children:[e(h,{fontWeight:"medium",children:pe.remark}),n(h,{fontSize:"sm",color:"gray.500",children:[pe.inbound_protocol.toUpperCase()," - ",pe.inbound_tag]})]}),n(sn,{colorScheme:"gray",children:["#",pe.sort+1]})]},pe.id))})]})]})})]}),e(Ms,{isOpen:ve,leastDestructiveRef:E,onClose:J,isCentered:!0,motionPreset:"slideInBottom",children:e(wt,{children:n(Us,{mx:{base:4,sm:0},children:[e(At,{fontSize:"lg",fontWeight:"bold",children:t("services.resetUsage","Reset usage")}),e(kt,{children:t("services.resetUsageConfirm","Reset usage for {{name}}?",{name:Y!=null?Y:t("services.thisService","this service")})}),n(zt,{children:[e(F,{ref:E,onClick:J,children:t("cancel","Cancel")}),e(F,{colorScheme:"primary",ml:3,onClick:ue,isLoading:T,children:t("services.resetUsage","Reset usage")})]})]})})}),n(Ut,{isOpen:Re,onClose:re,size:"lg",children:[e(wt,{bg:"blackAlpha.300",backdropFilter:"blur(6px)"}),n(Lt,{children:[n(At,{children:[t("services.deleteDialogTitle","Delete Service"),me?` \u2013 ${me.name}`:""]}),e(Rt,{}),e(kt,{children:me?n(de,{align:"stretch",spacing:4,children:[e(h,{children:t("services.deleteDialogDescription",{defaultValue:'Deleting the service "{{name}}" cannot be undone. Choose how linked resources should be handled.',name:me.name})}),me.admin_ids.length>0?e(Pr,{isChecked:y,onChange:pe=>P(pe.target.checked),children:t("services.unlinkAdminsOption","Unlink all admins automatically")}):e(h,{fontSize:"sm",color:"gray.500",children:t("services.noAdminsLinked","No admins are currently linked.")}),me.user_count>0?n(de,{align:"stretch",spacing:3,children:[e(h,{fontWeight:"semibold",children:t("services.userDeletePrompt",{defaultValue:"This service has {{count}} linked users. Choose how to handle them.",count:me.user_count})}),e(fi,{value:Ee,onChange:pe=>W(pe),children:n(ke,{align:"flex-start",spacing:2,children:[e(Qr,{value:"delete_users",children:t("services.deleteUsersOption","Delete linked users with the service")}),e(Qr,{value:"transfer_users",isDisabled:V.length===0,children:V.length===0?t("services.transferUsersDisabled","Transfer users (no other services available)"):t("services.transferUsersOption","Transfer users to another service")})]})}),Ee==="transfer_users"&&V.length>0&&n(k,{isRequired:!0,children:[e(_,{children:t("services.selectTargetService","Target service")}),e(je,{placeholder:t("services.selectServicePlaceholder","Select a service"),value:ie!=null?ie:"",onChange:pe=>te(pe.target.value?Number(pe.target.value):null),children:V.map(pe=>e("option",{value:pe.id,children:pe.name},pe.id))}),e(Lr,{children:t("services.transferUsersHint","All users will be moved to the selected service.")})]})]}):n(Ir,{status:"info",borderRadius:"md",children:[e(Tr,{}),e(yn,{children:t("services.noUsersLinked","This service has no linked users.")})]})]}):e(h,{children:t("services.loading","Loading...")})}),n(zt,{gap:3,children:[e(F,{variant:"ghost",onClick:re,children:t("cancel","Cancel")}),e(F,{colorScheme:"red",onClick:A,isLoading:Ce,isDisabled:Boolean((me==null?void 0:me.user_count)&&Ee==="transfer_users"&&V.length>0&&!ie),children:t("services.delete","Delete")})]})]})]}),e(nm,{isOpen:m.isOpen,onClose:m.onClose,onSubmit:C,isSaving:i.isSaving,allHosts:w,allAdmins:D,initialService:g!=null?g:void 0})]}):n(de,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("services.title","Services")}),e(h,{fontSize:"sm",color:"gray.500",children:t("services.noPermission","You do not have permission to view this section.")})]}):e(lt,{justify:"center",align:"center",h:"full",py:10,children:e(Dt,{})})};Pe.extend(Bs);const Co=ee(Fs,{baseStyle:{w:4,h:4}}),im=ee(ba,{baseStyle:{w:4,h:4}}),am={key:"30d",label:"30d",amount:30,unit:"day"},om=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=Pe.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},_o=t=>Pe(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",Do=t=>Pe(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",ei=t=>{if(!t)return 0;const r=t.includes(" ")?t.replace(" ","T"):`${t}T00:00`;return Pe.utc(r).valueOf()},Ao=t=>{const s=t.unit==="hour"?"hour":"day",r=Pe().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},lm=(t,s)=>{const r=Pe(t),l=Pe(s),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},cm=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Xe(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Xe(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},dm=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Xe(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),um=()=>{var Ce,Te,Re,Oe;const{t}=$e(),{colorMode:s}=Jr(),{admins:r}=pn(),l="auto-end",o=(Ce=xr({base:"bottom",md:"auto-end"}))!=null?Ce:l,[i,a]=d.exports.useState([]),[c,u]=d.exports.useState([]),[p,m]=d.exports.useState(null),[g,I]=d.exports.useState([]),[D,w]=d.exports.useState(!1),x=d.exports.useMemo(()=>[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],[]),v=(Te=x.find(B=>B.key==="30d"))!=null?Te:am,[C,z]=d.exports.useState(()=>Ao(v)),[ne,b]=d.exports.useState(v.key),[U,T]=d.exports.useState(null),[O,ve]=d.exports.useState([]),[Z,J]=d.exports.useState(!1),[E,q]=d.exports.useState(!1),[ue,Y]=d.exports.useState([C.start,C.end]);d.exports.useMemo(()=>{var B;return(B=c.find(V=>V.id===p))!=null?B:null},[c,p]);const re=d.exports.useMemo(()=>{if(!p)return i;const B=new Set(g.map(L=>L.username).filter(L=>Boolean(L))),V=i.filter(L=>B.has(L.username));return V.length?V:i},[i,p,g]),A=d.exports.useMemo(()=>g.reduce((B,V)=>B+(V.used_traffic||0),0),[g]),me=d.exports.useMemo(()=>g.map(B=>B.used_traffic||0),[g]),De=d.exports.useMemo(()=>g.map(B=>B.username||t("services.unassignedAdmin","Unassigned")),[g,t]),Ee=d.exports.useMemo(()=>dm(s,De),[s,De]);d.exports.useEffect(()=>{E||Y([C.start,C.end])},[E,C.start,C.end]),d.exports.useEffect(()=>{let B=!1;return(async()=>{var L;try{const he=await _e("/v2/services",{query:{limit:500}});if(B||!he)return;const ze=(L=he.services)!=null?L:[];u(ze),m(at=>at!==null?at:ze.length?ze[0].id:null)}catch{B||u([])}})(),()=>{B=!0}},[]),d.exports.useEffect(()=>{if(!p){I([]);return}let B=!1;return w(!0),_e(`/v2/services/${p}/usage/admins`,{query:{start:_o(C.start),end:Do(C.end)}}).then(V=>{var L;B||!V||I((L=V.admins)!=null?L:[])}).catch(()=>{B||I([])}).finally(()=>{B||w(!1)}),()=>{B=!0}},[p,C.start,C.end,C.unit]),d.exports.useEffect(()=>{let B=!1;return(async()=>{try{const L=await _e("/admins");if(B)return;Array.isArray(L)?a(L):a(L.admins||[])}catch(L){console.error("Failed to load all admins:",L),a(r||[])}})(),()=>{B=!0}},[r]),d.exports.useEffect(()=>{if(!U)return;let B=!1;J(!0);const V=C.unit==="hour",L={start:_o(C.start),end:Do(C.end)};V&&(L.granularity="hour");const he=V?"chart":"daily";return console.debug("AdminsUsage: fetching usage",{selectedAdmin:U,endpoint:he,query:L}),_e(`/admin/${encodeURIComponent(U)}/usage/${he}`,{query:L}).then(ze=>{if(B)return;const at=Array.isArray(ze==null?void 0:ze.usages)?ze.usages:[];console.debug("AdminsUsage: response usages",{length:at.length,endpoint:he});let pe;if(V){const oe=new Map;at.forEach($=>{var mt,Q;const ye=typeof($==null?void 0:$.date)=="string"?$.date:"";if(!ye)return;const ut=(mt=oe.get(ye))!=null?mt:0;oe.set(ye,ut+Number((Q=$==null?void 0:$.used_traffic)!=null?Q:0))});const le=Array.from(oe.entries());le.sort(($,ye)=>{const[ut]=$,[mt]=ye;return ei(ut)-ei(mt)}),pe=le.map(([$,ye])=>({date:$,used_traffic:ye}))}else{const oe=at.map(le=>{var $,ye;return{date:($=le==null?void 0:le.date)!=null?$:"",used_traffic:Number((ye=le==null?void 0:le.used_traffic)!=null?ye:0)}});oe.sort((le,$)=>ei(le.date)-ei($.date)),pe=oe}ve(pe)}).catch(ze=>{B||(console.error("Error fetching admin usage:",ze),ve([]))}).finally(()=>{B||J(!1)}),()=>{B=!0}},[U,C]),d.exports.useEffect(()=>{if(!re||re.length===0)return;re.some(V=>V.username===U)||T(re[0].username)},[re,U]),d.exports.useEffect(()=>{const B=x.find(V=>V.key===C.key);b(B?B.key:"custom")},[C,x]);const W=d.exports.useMemo(()=>O.map(B=>om(B.date)),[O]),y=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:O.map(B=>B.used_traffic)}],[O,t]),P=d.exports.useMemo(()=>({options:cm(s,W),series:y}),[s,W,y]),ie=d.exports.useMemo(()=>O.reduce((B,V)=>B+Number(V.used_traffic||0),0),[O]),te=d.exports.useMemo(()=>{const B=Pe(C.start).format("YYYY-MM-DD"),V=Pe(C.end).format("YYYY-MM-DD");return B===V?B:`${B} - ${V}`},[C.start,C.end]);return n(de,{spacing:4,align:"stretch",children:[n(N,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"center"},children:[n(de,{align:"start",spacing:1,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:t("admins.serviceUsageTitle","Service usage distribution")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("admins.serviceUsageHint","Pick a service to see how its usage is split between admins.")})]}),n(ke,{direction:{base:"column",sm:"row"},spacing:3,align:{base:"stretch",sm:"center"},children:[e(je,{value:p!=null?p:"",onChange:B=>{const V=Number(B.target.value);m(Number.isNaN(V)?null:V)},minW:{sm:"220px"},placeholder:t("admins.selectService","Select service"),isDisabled:!c.length,children:c.map(B=>e("option",{value:B.id,children:B.name},B.id))}),n(R,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[e(Co,{}),n(h,{children:[t("services.totalUsage","Total"),":"," ",e(ee.span,{fontWeight:"medium",children:Xe(A,2)})]})]})]})]}),n(ke,{mt:6,direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},align:{base:"stretch",lg:"center"},children:[e(N,{flex:"1",children:D?n(de,{spacing:3,py:8,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):g.length&&A>0?e(en,{type:"donut",height:320,options:Ee,series:me}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})}),e(de,{flex:"1",align:"stretch",spacing:2,children:g.length?g.map(B=>{var ze;const V=B.username||t("services.unassignedAdmin","Unassigned"),L=Boolean(B.username),he=U===B.username&&L;return e(F,{size:"sm",variant:he?"solid":"outline",colorScheme:"primary",justifyContent:"space-between",onClick:()=>{L&&B.username&&T(B.username)},isDisabled:!L,children:n(R,{justify:"space-between",w:"full",children:[e(h,{children:V}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.300"},children:Xe(B.used_traffic||0,2)})]})},`${(ze=B.admin_id)!=null?ze:"na"}-${V}`)}):e(h,{color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]}),n(N,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(de,{align:"start",spacing:1,children:[n(R,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("admins.dailyUsage","Daily usage")}),e(ct,{label:t("admins.dailyUsageTooltip","Total data usage per day for the selected admin and time range"),children:e(Co,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})})]}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("admins.selectedAdmin","Admin"),":"," ",e(ee.span,{fontWeight:"medium",children:U!=null?U:"-"})," ",t("nodes.totalLabel","Total"),":"," ",e(ee.span,{fontWeight:"medium",children:Xe(ie||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ke,{direction:{base:"column",sm:"row"},spacing:2,flex:"1",justifyContent:{sm:"flex-end"},children:x.map(B=>e(F,{size:"sm",onClick:()=>{b(B.key),z(Ao(B))},variant:ne===B.key?"solid":"outline",colorScheme:"primary",w:{base:"full",sm:"auto"},children:B.label},B.key))}),n(ke,{direction:{base:"column",sm:"row"},spacing:2,alignItems:{base:"stretch",sm:"center"},children:[n(ss,{placement:o,isOpen:E,onClose:()=>{q(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(is,{children:e(F,{size:"sm",variant:"outline",leftIcon:e(im,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(E){q(!1);return}Y([C.start,C.end]),q(!0)},children:te})}),n(as,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Hs,{}),n(os,{px:3,py:3,children:[e(N,{overflowX:"auto",maxW:"full",children:e(Ks,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(Re=ue[0])!=null?Re:void 0,endDate:(Oe=ue[1])!=null?Oe:void 0,calendarClassName:"usage-range-datepicker",onChange:B=>{const[V,L]=B!=null?B:[null,null];if(Y([V,L]),V&&L){const he=lm(V,L);b("custom"),z(he),q(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:t("nodes.customRangeHint","Select a start and end date")})]})]})]}),e(je,{value:U!=null?U:"",onChange:B=>T(B.target.value||null),w:{base:"full",sm:"auto",md:"220px"},minW:{md:"200px"},isDisabled:!re.length,children:re.map(B=>e("option",{value:B.username,children:B.username},B.username))})]})]})]}),e(N,{mt:6,children:Z?n(de,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):P.series&&P.series.length?e(en,{options:P.options,series:P.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})};Pe.extend(Bs);const hm=ee(ba,{baseStyle:{w:4,h:4}}),Ji=ee(Fs,{baseStyle:{w:4,h:4}}),qi=[{key:"24h",label:"24h",amount:24,unit:"hour"},{key:"7d",label:"7d",amount:7,unit:"day"},{key:"30d",label:"30d",amount:30,unit:"day"},{key:"90d",label:"90d",amount:90,unit:"day"}],Io=t=>{const s=t.unit==="hour"?"hour":"day",r=Pe().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},pm=(t,s)=>{const r=Pe(t),l=Pe(s),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},To=t=>Pe(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Po=t=>Pe(t).utc().format("YYYY-MM-DDTHH:mm:ssZ"),Eo=(t,s)=>{if(!t)return t;const r=Pe.utc(t);return r.isValid()?s==="hour"?r.local().format("MM-DD HH:mm"):r.format("YYYY-MM-DD"):t},No=(t,s,r)=>{const l=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>l)},rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:o=>Xe(Number(o)||0,1),style:{colors:[l]}},title:{text:r,style:{color:l}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:o=>Xe(Number(o)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},mm=(t,s)=>({labels:s,legend:{position:"bottom",labels:{colors:t==="dark"?"#d8dee9":"#1a202c"}},tooltip:{y:{formatter:r=>Xe(Number(r)||0,2),title:{formatter:(r,l)=>{var o,i,a,c;return(c=(a=(i=(o=l==null?void 0:l.w)==null?void 0:o.globals)==null?void 0:i.labels)==null?void 0:a[l.seriesIndex])!=null?c:r}}}},colors:["#3182CE","#63B3ED","#ED8936","#38A169","#9F7AEA","#F6AD55","#4299E1","#E53E3E","#D53F8C","#805AD5"]}),gm=({services:t,selectedServiceId:s})=>{var le,$,ye,ut,mt,Q;const{t:r}=$e(),{colorMode:l}=Jr(),o="auto-end",i=(le=xr({base:"bottom",md:"auto-end"}))!=null?le:o,a=d.exports.useMemo(()=>t.map(H=>({id:H.id,name:H.name})),[t]),c=d.exports.useMemo(()=>s||(a.length?a[0].id:null),[s,a]),u=($=qi.find(H=>H.key==="30d"))!=null?$:qi[0],[p,m]=d.exports.useState(c),[g,I]=d.exports.useState(()=>Io(u)),[D,w]=d.exports.useState(u.key),[x,v]=d.exports.useState([null,null]),[C,z]=d.exports.useState(!1),[ne,b]=d.exports.useState([]),[U,T]=d.exports.useState("day"),[O,ve]=d.exports.useState([]),[Z,J]=d.exports.useState(!1),[E,q]=d.exports.useState(!1),[ue,Y]=d.exports.useState(null),[re,A]=d.exports.useState([]),[me,De]=d.exports.useState("day"),[Ee,W]=d.exports.useState(""),[y,P]=d.exports.useState(!1);d.exports.useEffect(()=>{m(c)},[c]),d.exports.useEffect(()=>{if(!p){b([]),ve([]),A([]),Y(null),W("");return}const H={start:To(g.start),end:Po(g.end)},Se=g.unit==="hour"?"hour":"day";let Me=!1;return J(!0),_e(`/v2/services/${p}/usage/timeseries`,{query:{...H,granularity:Se}}).then(Fe=>{var Be,ce;Me||!Fe||(b((Be=Fe.points)!=null?Be:[]),T((ce=Fe.granularity)!=null?ce:Se))}).catch(()=>{Me||(b([]),T(Se))}).finally(()=>{Me||J(!1)}),q(!0),_e(`/v2/services/${p}/usage/admins`,{query:H}).then(Fe=>{var Be;Me||!Fe||ve((Be=Fe.admins)!=null?Be:[])}).catch(()=>{Me||ve([])}).finally(()=>{Me||q(!1)}),()=>{Me=!0}},[p,g.start,g.end,g.unit]),d.exports.useEffect(()=>{if(!p){Y(null),A([]),W("");return}if(!O.length){Y(null);return}Y(H=>{var Be,ce;const Se=O.map(ge=>ge.admin_id);if(H===null){if(Se.includes(null))return H}else if(Se.includes(H))return H;const Me=O.find(ge=>(ge.used_traffic||0)>0);if(Me)return(Be=Me.admin_id)!=null?Be:null;const Fe=O[0];return(ce=Fe==null?void 0:Fe.admin_id)!=null?ce:null})},[O,p]),d.exports.useEffect(()=>{if(!p){A([]),W(""),De("day");return}if(ue===void 0)return;if(!O.length&&ue===null){A([]),W("");return}const H=g.unit==="hour"?"hour":"day",Se=ue===null?"null":Number.isFinite(ue)?String(ue):"null";let Me=!1;return P(!0),_e(`/v2/services/${p}/usage/admin-timeseries`,{query:{start:To(g.start),end:Po(g.end),granularity:H,admin_id:Se}}).then(Fe=>{var Be,ce,ge;Me||!Fe||(A((Be=Fe.points)!=null?Be:[]),De((ce=Fe.granularity)!=null?ce:H),W((ge=Fe.username)!=null?ge:""))}).catch(()=>{Me||(A([]),W(""),De(H))}).finally(()=>{Me||P(!1)}),()=>{Me=!0}},[O,g.end,g.start,g.unit,ue,p]);const ie=d.exports.useMemo(()=>{const H=Pe(g.start).format("YYYY-MM-DD"),Se=Pe(g.end).format("YYYY-MM-DD");return`${H} \u2013 ${Se}`},[g.start,g.end]),te=d.exports.useMemo(()=>ne.map(H=>Eo(H.timestamp,U)),[ne,U]),Ce=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:ne.map(H=>H.used_traffic)}],[ne,r]),Te=d.exports.useMemo(()=>No(l,te,r("services.usageYAxis","Usage")),[te,l,r]),Re=d.exports.useMemo(()=>O.map(H=>({value:H.admin_id===null?"null":String(H.admin_id),label:H.username||r("services.unassignedAdmin","Unassigned")})),[O,r]),Oe=d.exports.useMemo(()=>{var Se,Me;const H=ue===null?"null":String(ue);return(Me=(Se=Re.find(Fe=>Fe.value===H))==null?void 0:Se.label)!=null?Me:ue===null?r("services.unassignedAdmin","Unassigned"):""},[Re,ue,r]),B=d.exports.useMemo(()=>re.map(H=>Eo(H.timestamp,me)),[re,me]),V=d.exports.useMemo(()=>[{name:r("services.usageSeries","Usage"),data:re.map(H=>H.used_traffic)}],[re,r]),L=d.exports.useMemo(()=>No(l,B,r("services.usageYAxis","Usage")),[B,l,r]),he=d.exports.useMemo(()=>re.reduce((H,Se)=>H+(Se.used_traffic||0),0),[re]),ze=d.exports.useMemo(()=>O.map(H=>H.used_traffic),[O]),at=d.exports.useMemo(()=>O.map(H=>H.username||r("services.unassignedAdmin","Unassigned")),[O,r]),pe=d.exports.useMemo(()=>mm(l,at),[l,at]),oe=d.exports.useMemo(()=>O.reduce((H,Se)=>H+(Se.used_traffic||0),0),[O]);return a.length===0?n(de,{spacing:2,align:"stretch",mt:4,children:[e(h,{fontWeight:"semibold",children:r("services.usageAnalyticsTitle","Usage Analytics")}),e(N,{borderWidth:"1px",borderRadius:"md",p:6,children:e(h,{color:"gray.500",children:r("services.noServicesAvailable","No services available")})})]}):n(de,{spacing:4,align:"stretch",children:[n(R,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",fontSize:"lg",children:r("services.usageAnalyticsTitle","Usage Analytics")}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},align:{base:"stretch",md:"center"},children:[e(je,{value:p!=null?p:"",onChange:H=>m(Number(H.target.value)||null),minW:{md:"220px"},children:a.map(H=>e("option",{value:H.id,children:H.name},H.id))}),e(ke,{direction:{base:"column",sm:"row"},spacing:2,children:qi.map(H=>e(F,{size:"sm",variant:D===H.key?"solid":"outline",colorScheme:"primary",onClick:()=>{w(H.key),I(Io(H))},children:H.label},H.key))}),n(ss,{placement:i,isOpen:C,onClose:()=>z(!1),closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(is,{children:e(F,{size:"sm",variant:"outline",leftIcon:e(hm,{}),onClick:()=>{v([g.start,g.end]),z(H=>!H)},children:ie})}),n(as,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Hs,{}),n(os,{px:3,py:3,children:[e(N,{overflowX:"auto",maxW:"full",children:e(Ks,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(ye=x[0])!=null?ye:void 0,endDate:(ut=x[1])!=null?ut:void 0,calendarClassName:"usage-range-datepicker",onChange:H=>{const[Se,Me]=H!=null?H:[null,null];if(v([Se,Me]),Se&&Me){const Fe=pm(Se,Me);w("custom"),I(Fe),z(!1)}}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",children:r("nodes.customRangeHint","Select a start and end date")})]})]})]})]})]}),n(N,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(R,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.usageOverTime","Usage over time")}),n(R,{fontSize:"sm",color:"gray.500",children:[e(Ji,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(ee.span,{fontWeight:"medium",children:Xe(ne.reduce((H,Se)=>H+(Se.used_traffic||0),0),2)})]})]})]}),e(N,{mt:4,children:Z?n(de,{spacing:3,py:10,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):ne.length?e(en,{type:"area",height:360,options:Te,series:Ce}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(N,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(de,{align:"start",spacing:1,children:[e(ct,{label:r("services.adminUsageTrendHint","Daily usage for the selected admin within this service."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageTrend","Admin usage over time")}),e(Ji,{color:"gray.500","aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",children:[r("services.selectedAdmin","Admin"),":"," ",e(ee.span,{fontWeight:"medium",children:Oe||Ee||"-"})," ",r("services.totalUsage","Total"),":"," ",e(ee.span,{fontWeight:"medium",children:Xe(he||0,2)})]})]}),e(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:e(je,{size:"sm",minW:{md:"200px"},value:ue===null?"null":String(ue),onChange:H=>{const Se=H.target.value;if(Se==="null"){Y(null);return}const Me=Number(Se);Y(Number.isNaN(Me)?null:Me)},isDisabled:Re.length===0,children:Re.map(H=>e("option",{value:H.value,children:H.label},H.value))})})]}),e(N,{mt:4,children:y?n(de,{spacing:3,py:10,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):(Q=(mt=V[0])==null?void 0:mt.data)!=null&&Q.length?e(en,{type:"area",height:360,options:L,series:V}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})})]}),n(N,{borderWidth:"1px",borderRadius:"md",p:4,children:[n(R,{justify:"space-between",align:{base:"stretch",md:"center"},flexDir:{base:"column",md:"row"},gap:3,children:[e(h,{fontWeight:"semibold",children:r("services.adminUsageDistribution","Admin usage distribution")}),n(R,{fontSize:"sm",color:"gray.500",children:[e(Ji,{}),n(h,{children:[r("services.totalUsage","Total")," ",e(ee.span,{fontWeight:"medium",children:Xe(oe,2)})]})]})]}),n(ke,{mt:4,direction:{base:"column",lg:"row"},spacing:6,align:{base:"stretch",lg:"center"},children:[e(N,{flex:"1",children:E?n(de,{spacing:3,py:8,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",children:r("loading")})]}):O.length&&oe>0?e(en,{type:"donut",height:320,options:pe,series:ze}):e(h,{textAlign:"center",color:"gray.500",children:r("noData")})}),e(de,{flex:"1",align:"stretch",spacing:2,children:O.length?O.map(H=>{var Se;return n(R,{justify:"space-between",borderWidth:"1px",borderRadius:"md",px:3,py:2,children:[e(h,{fontWeight:"medium",children:H.username||r("services.unassignedAdmin","Unassigned")}),e(h,{fontSize:"sm",color:"gray.500",children:Xe(H.used_traffic||0,2)})]},`${(Se=H.admin_id)!=null?Se:"na"}-${H.username}`)}):e(h,{color:"gray.500",children:r("noData")})})]})]})]})};Pe.extend(Bs);const fm=ee(ba,{baseStyle:{w:4,h:4}}),ti=ee(Fs,{baseStyle:{w:4,h:4}}),Ds={key:"30d",label:"30d",amount:30,unit:"day"},zo=t=>{if(!t)return t;const s=t.includes(" "),r=s?t.replace(" ","T"):t,l=Pe.utc(r);return l.isValid()?s?l.local().format("MM-DD HH:mm"):l.format("YYYY-MM-DD"):t},As=t=>Pe(t).utc().format("YYYY-MM-DDTHH:mm:ss"),Is=t=>Pe(t).utc().format("YYYY-MM-DDTHH:mm:ss"),fn=t=>{const s=t.unit==="hour"?"hour":"day",r=Pe().utc().endOf(s),l=Math.max(t.amount-1,0),o=r.subtract(l,t.unit).startOf(s);return{key:t.key,start:o.toDate(),end:r.toDate(),unit:t.unit}},ri=(t,s)=>{const r=Pe(t),l=Pe(s),[o,i]=r.isBefore(l)?[r,l]:[l,r],a=o.startOf("day"),c=i.endOf("day"),u=a.isSame(c,"day");return{key:"custom",start:a.toDate(),end:c.toDate(),unit:u?"hour":"day"}},Ro=(t,s)=>{const r=t==="dark"?"#d8dee9":"#1a202c";return{chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.35,opacityTo:.05,stops:[0,80,100]}},grid:{borderColor:t==="dark"?"#2D3748":"#E2E8F0"},xaxis:{categories:s,labels:{style:{colors:s.map(()=>r)}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:l=>Xe(Number(l)||0,1),style:{colors:[r]}}},tooltip:{theme:t==="dark"?"dark":"light",shared:!0,fillSeriesColor:!1,y:{formatter:l=>Xe(Number(l)||0,2)}},colors:[t==="dark"?"#63B3ED":"#3182CE"]}},ni=({presets:t,range:s,onPresetChange:r,onCustomChange:l})=>{var w,x,v;const{t:o}=$e(),i="auto-end",a=(w=xr({base:"bottom",md:"auto-end"}))!=null?w:i,c=Pe(s.start).format("YYYY-MM-DD"),u=Pe(s.end).format("YYYY-MM-DD"),p=c===u?c:`${c} - ${u}`,[m,g]=d.exports.useState(!1),[I,D]=d.exports.useState([s.start,s.end]);return d.exports.useEffect(()=>{m||D([s.start,s.end])},[m,s.start,s.end]),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(ke,{direction:{base:"column",sm:"row"},spacing:2,flexWrap:"wrap",justifyContent:{sm:"flex-end"},w:"full",children:t.map(C=>e(F,{size:"sm",onClick:()=>r(C.key),colorScheme:"primary",variant:s.key===C.key?"solid":"outline",w:{base:"full",sm:"auto"},children:C.label},C.key))}),n(ss,{placement:a,isOpen:m,onClose:()=>{g(!1)},closeOnBlur:!1,modifiers:[{name:"preventOverflow",options:{padding:16}},{name:"flip",options:{fallbackPlacements:["top-end","bottom-start","top-start"]}}],children:[e(is,{children:e(F,{size:"sm",variant:"outline",leftIcon:e(fm,{}),w:{base:"full",sm:"auto"},onClick:()=>{if(m){g(!1);return}D([s.start,s.end]),g(!0)},children:p})}),n(as,{w:"fit-content",maxW:"calc(100vw - 2rem)",_focus:{outline:"none"},children:[e(Hs,{}),n(os,{px:3,py:3,children:[e(N,{overflowX:"auto",maxW:"full",children:e(Ks,{selectsRange:!0,inline:!0,maxDate:new Date,startDate:(x=I[0])!=null?x:void 0,endDate:(v=I[1])!=null?v:void 0,calendarClassName:"usage-range-datepicker",onChange:C=>{const[z,ne]=C!=null?C:[null,null];D([z,ne]),z&&ne&&(l(z,ne),g(!1))}})}),e(h,{mt:2,fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:o("nodes.customRangeHint","Select a start and end date")})]})]})]})]})},bm=()=>{var hr,sr,pr,er,ir,ar,tr,or;const{t}=$e(),s=Bt(),{colorMode:r}=Jr(),{data:l}=xa(),{fetchNodesUsage:o}=Js(),{userData:i}=Mn(),a=d.exports.useMemo(()=>[{key:"24h",label:t("nodes.range24h","Last 24 hours"),amount:24,unit:"hour"},{key:"7d",label:t("nodes.range7d","Last 7 days"),amount:7,unit:"day"},{key:"30d",label:t("nodes.range30d","Last 30 days"),amount:30,unit:"day"},{key:"90d",label:t("nodes.range90d","Last 90 days"),amount:90,unit:"day"}],[t]),c=(sr=(hr=a.find(G=>G.key==="30d"))!=null?hr:a[0])!=null?sr:Ds,[u,p]=d.exports.useState(()=>fn(c)),[m,g]=d.exports.useState([]),[I,D]=d.exports.useState(!1),[w,x]=d.exports.useState(()=>fn(c)),[v,C]=d.exports.useState(null),[z,ne]=d.exports.useState(!1),[b,U]=d.exports.useState([]),[T,O]=d.exports.useState(null),[ve,Z]=d.exports.useState(()=>fn(c)),[J,E]=d.exports.useState(()=>fn(c)),[q,ue]=d.exports.useState([]),[Y,re]=d.exports.useState(null),[A,me]=d.exports.useState(null),[De,Ee]=d.exports.useState([]),[W,y]=d.exports.useState([]),[P,ie]=d.exports.useState(!1),[te,Ce]=d.exports.useState(null),[Te,Re]=d.exports.useState(!1),[Oe,B]=d.exports.useState([]),[V,L]=d.exports.useState(null),he=d.exports.useCallback(G=>G?(Array.isArray(G)?G:Object.values(G)).map(X=>{var rt,M,xe,Le;return{nodeId:Number((rt=X==null?void 0:X.node_id)!=null?rt:0),nodeName:(M=X==null?void 0:X.node_name)!=null?M:t("nodes.unknownNode","Unknown"),total:Number((xe=X==null?void 0:X.uplink)!=null?xe:0)+Number((Le=X==null?void 0:X.downlink)!=null?Le:0)}}):[],[t]),ze=d.exports.useCallback(G=>{var X;const be=(X=a.find(rt=>rt.key===G))!=null?X:Ds;p(fn(be))},[a]),at=d.exports.useCallback((G,be)=>{const X=ri(G,be);p(X)},[]),pe=d.exports.useCallback(G=>{var X;const be=(X=a.find(rt=>rt.key===G))!=null?X:Ds;x(fn(be))},[a]),oe=d.exports.useCallback((G,be)=>{const X=ri(G,be);x(X)},[]),le=d.exports.useCallback(G=>{var X;const be=(X=a.find(rt=>rt.key===G))!=null?X:Ds;E(fn(be))},[a]),$=d.exports.useCallback((G,be)=>{const X=ri(G,be);E(X)},[]),ye=d.exports.useCallback(G=>{var X;const be=(X=a.find(rt=>rt.key===G))!=null?X:Ds;Z(fn(be))},[a]),ut=d.exports.useCallback((G,be)=>{const X=ri(G,be);Z(X)},[]),mt=d.exports.useMemo(()=>m.reduce((G,be)=>G+be.total,0),[m]),Q=d.exports.useMemo(()=>{const G=m.map(X=>X.total),be=m.map(X=>X.nodeName);return bi(r,`${t("userDialog.total")} ${Xe(mt||0,2)}`,G,be)},[r,m,t,mt]),H=d.exports.useMemo(()=>b.map(G=>zo(G.date)),[b]),Se=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:b.map(G=>G.used_traffic)}],[b,t]),Me=d.exports.useMemo(()=>b.reduce((G,be)=>G+be.used_traffic,0),[b]),Fe=d.exports.useMemo(()=>({options:Ro(r,H),series:Se}),[r,H,Se]),Be=d.exports.useMemo(()=>W.reduce((G,be)=>G+be.total,0),[W]),ce=d.exports.useMemo(()=>{const G=W.map(X=>X.total),be=W.map(X=>X.nodeName);return bi(r,`${t("userDialog.total")} ${Xe(Be||0,2)}`,G,be)},[W,r,t,Be]),ge=d.exports.useMemo(()=>Oe.map(G=>zo(G.date)),[Oe]),We=d.exports.useMemo(()=>[{name:t("nodes.usedTrafficSeries","Used traffic"),data:Oe.map(G=>G.used_traffic)}],[Oe,t]),Ie=d.exports.useMemo(()=>Oe.reduce((G,be)=>G+be.used_traffic,0),[Oe]),ot=d.exports.useMemo(()=>({options:Ro(r,ge),series:We}),[r,ge,We]),gt=d.exports.useMemo(()=>{const G=[],be=new Set;return m.forEach(X=>{X.nodeId>0&&!be.has(X.nodeId)&&(be.add(X.nodeId),G.push({value:X.nodeId,label:X.nodeName}))}),Array.isArray(l)&&l.forEach(X=>{(X==null?void 0:X.id)&&!be.has(X.id)&&(be.add(X.id),G.push({value:X.id,label:X.name}))}),G.sort((X,rt)=>X.label.localeCompare(rt.label))},[m,l]),Mt=d.exports.useMemo(()=>{const G=[],be=new Set;return De.forEach(X=>{be.has(X.nodeId)||(be.add(X.nodeId),G.push({value:X.nodeId,label:X.nodeName}))}),be.has(0)||G.push({value:0,label:t("nodes.masterNode","Master")}),Array.isArray(l)&&l.forEach(X=>{(X==null?void 0:X.id)&&!be.has(X.id)&&(be.add(X.id),G.push({value:X.id,label:X.name}))}),G.sort((X,rt)=>X.label.localeCompare(rt.label))},[De,l,t]),et=d.exports.useMemo(()=>q.map(G=>({value:G,label:G})),[q]),jt=d.exports.useMemo(()=>{const G=new Map;return Array.isArray(l)&&l.forEach(be=>{(be==null?void 0:be.id)!=null&&G.set(be.id,be.name)}),G},[l]);return d.exports.useEffect(()=>{let G=!1;return D(!0),o({start:As(u.start),end:Is(u.end)}).then(be=>{if(G)return;const X=he(be==null?void 0:be.usages);g(X)}).catch(be=>{G||(console.error("Error fetching usage data:",be),g([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{G||D(!1)}),()=>{G=!0}},[o,u,he,s,t]),d.exports.useEffect(()=>{!(i!=null&&i.username)||(re(G=>G!=null?G:i.username),me(G=>G!=null?G:i.username),i.is_sudo||ue([i.username]))},[i]),d.exports.useEffect(()=>{if(!(i!=null&&i.is_sudo))return;let G=!1;return _e("/admins").then(be=>{if(G)return;const rt=(Array.isArray(be)?be:Array.isArray(be==null?void 0:be.admins)?be.admins:[]).map(xe=>xe==null?void 0:xe.username).filter(xe=>typeof xe=="string"),M=Array.from(new Set(rt)).sort((xe,Le)=>xe.localeCompare(Le));if(!M.length&&(i==null?void 0:i.username)){ue([i.username]);return}ue(M),re(xe=>{var Le,Ke;return xe&&M.includes(xe)?xe:(Ke=(Le=M[0])!=null?Le:xe)!=null?Ke:null}),me(xe=>{var Le,Ke;return xe&&M.includes(xe)?xe:(Ke=(Le=M[0])!=null?Le:xe)!=null?Ke:null})}).catch(be=>{console.error("Error fetching admins:",be)}),()=>{G=!0}},[i==null?void 0:i.is_sudo,i==null?void 0:i.username]),d.exports.useEffect(()=>{var be,X;if(v!==null)return;const G=(be=m.filter(rt=>rt.nodeId>0).sort((rt,M)=>M.total-rt.total)[0])==null?void 0:be.nodeId;if(G&&G>0){C(G);return}if(Array.isArray(l)&&l.length){const rt=(X=l[0])==null?void 0:X.id;rt&&C(rt)}},[v,m,l]),d.exports.useEffect(()=>{Ce(null)},[Y]),d.exports.useEffect(()=>{if(!Y){Ee([]),Ce(null);return}let G=!1;const be={start:As(J.start),end:Is(J.end)};return _e(`/admin/${encodeURIComponent(Y)}/usage/nodes`,{query:be}).then(X=>{if(G)return;const rt=he(X==null?void 0:X.usages);Ee(rt),Ce(M=>{var Le,Ke,Ge;if(M!==null)return M;const xe=(Le=rt.filter(it=>it.nodeId!==0).sort((it,Nt)=>Nt.total-it.total)[0])==null?void 0:Le.nodeId;return typeof xe=="number"?xe:(Ge=(Ke=rt[0])==null?void 0:Ke.nodeId)!=null?Ge:0})}).catch(X=>{G||(console.error("Error fetching daily admin nodes:",X),Ee([]),Ce(null),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}),()=>{G=!0}},[Y,J,he,s,t]),d.exports.useEffect(()=>{if(!A){y([]),ie(!1);return}let G=!1;return ie(!0),_e(`/admin/${encodeURIComponent(A)}/usage/nodes`,{query:{start:As(ve.start),end:Is(ve.end)}}).then(be=>{if(G)return;const X=he(be==null?void 0:be.usages);y(X)}).catch(be=>{G||(console.error("Error fetching admin totals nodes:",be),y([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{G||ie(!1)}),()=>{G=!0}},[A,ve,he,s,t]),d.exports.useEffect(()=>{if(v===null){U([]),O(null);return}let G=!1;ne(!0);const be={start:As(w.start),end:Is(w.end)};return w.unit==="hour"&&(be.granularity="hour"),_e(`/node/${v}/usage/daily`,{query:be}).then(X=>{var Le,Ke,Ge;if(G)return;const M=(Array.isArray(X==null?void 0:X.usages)?X.usages:[]).map(it=>{var Nt,Vt;return{date:(Nt=it==null?void 0:it.date)!=null?Nt:"",used_traffic:Number((Vt=it==null?void 0:it.used_traffic)!=null?Vt:0)}});U(M);const xe=(Ke=(Le=X==null?void 0:X.node_name)!=null?Le:jt.get(v))!=null?Ke:t("nodes.unknownNode","Unknown");O({nodeName:xe,nodeId:(Ge=X==null?void 0:X.node_id)!=null?Ge:v})}).catch(X=>{G||(console.error("Error fetching node daily usage:",X),U([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{G||ne(!1)}),()=>{G=!0}},[v,w,jt,s,t]),d.exports.useEffect(()=>{if(!Y){B([]),L(null);return}if(te===null){B([]),L(null);return}let G=!1;Re(!0);const be={start:As(J.start),end:Is(J.end)};return te!=null&&(be.node_id=te),J.unit==="hour"&&(be.granularity="hour"),_e(`/admin/${encodeURIComponent(Y)}/usage/chart`,{query:be}).then(X=>{var xe,Le,Ke,Ge;if(G)return;const M=(Array.isArray(X==null?void 0:X.usages)?X.usages:[]).map(it=>{var Nt,Vt;return{date:(Nt=it==null?void 0:it.date)!=null?Nt:"",used_traffic:Number((Vt=it==null?void 0:it.used_traffic)!=null?Vt:0)}});B(M),L({nodeName:(Ke=(Le=X==null?void 0:X.node_name)!=null?Le:(xe=Mt.find(it=>it.value===te))==null?void 0:xe.label)!=null?Ke:null,nodeId:(Ge=X==null?void 0:X.node_id)!=null?Ge:te})}).catch(X=>{G||(console.error("Error fetching admin usage chart:",X),B([]),s({title:t("errorFetchingData"),status:"error",isClosable:!0,position:"top",duration:3e3}))}).finally(()=>{G||Re(!1)}),()=>{G=!0}},[Y,te,J,Mt,t,s]),n(de,{spacing:6,align:"stretch",children:[n(N,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(de,{align:"start",spacing:1,children:[e(ct,{label:t("nodes.trafficOverviewTooltip","Total usage per node over the chosen range."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.trafficOverview","Traffic overview")}),e(ti,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:Xe(mt||0,2)})]})]}),e(ni,{presets:a,range:u,onPresetChange:ze,onCustomChange:at})]}),e(N,{mt:6,children:I?n(de,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):Q.series.length?e(en,{options:Q.options,series:Q.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(N,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(de,{align:"start",spacing:1,children:[e(ct,{label:t("nodes.perDayUsageTooltip","Daily traffic aggregated for the selected node within the chosen range."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perDayUsage","Per day usage")}),e(ti,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedNode","Node"),": "," ",e(ee.span,{fontWeight:"medium",children:(pr=T==null?void 0:T.nodeName)!=null?pr:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:Xe(Me||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(je,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:v!=null?v:"",onChange:G=>{const be=G.target.value;if(!be){C(null);return}const X=Number(be);C(Number.isFinite(X)&&X>0?X:null)},placeholder:t("nodes.selectNode","Select node"),children:gt.map(G=>e("option",{value:G.value,children:G.label},G.value))}),e(ni,{presets:a,range:w,onPresetChange:pe,onCustomChange:oe})]})]}),e(N,{mt:6,children:z?n(de,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(ir=(er=Se[0])==null?void 0:er.data)!=null&&ir.length?e(en,{options:Fe.options,series:Fe.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(N,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",lg:"row"},spacing:{base:4,lg:6},justifyContent:"space-between",alignItems:{base:"stretch",lg:"flex-start"},w:"full",children:[n(de,{align:"start",spacing:1,children:[e(ct,{label:t("nodes.adminUsageChartTooltip","Usage trend for the selected admin and node."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.adminUsageChart","Admin usage chart")}),e(ti,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ee.span,{fontWeight:"medium",children:Y!=null?Y:"-"})," ",t("nodes.selectedNode","Node"),": "," ",e(ee.span,{fontWeight:"medium",children:(ar=V==null?void 0:V.nodeName)!=null?ar:t("nodes.unknownNode","Unknown")})," ",t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:Xe(Ie||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(je,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:Y!=null?Y:"",onChange:G=>re(G.target.value||null),isDisabled:et.length===0,children:et.map(G=>e("option",{value:G.value,children:G.label},G.value))}),e(je,{size:"sm",minW:{md:"180px"},w:{base:"full",md:"auto"},value:te!=null?te:"",onChange:G=>{const be=G.target.value;if(be===""){Ce(null);return}const X=Number(be);Ce(Number.isNaN(X)?null:X)},placeholder:t("nodes.selectNode","Select node"),children:Mt.map(G=>e("option",{value:G.value,children:G.label},G.value))}),e(ni,{presets:a,range:J,onPresetChange:le,onCustomChange:$})]})]}),e(N,{mt:6,children:Te?n(de,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):(or=(tr=We[0])==null?void 0:tr.data)!=null&&or.length?e(en,{options:ot.options,series:ot.series,type:"area",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]}),n(N,{borderWidth:"1px",borderRadius:"lg",p:{base:4,md:6},boxShadow:"md",children:[n(ke,{direction:{base:"column",md:"row"},spacing:{base:4,md:6},justifyContent:"space-between",alignItems:{base:"stretch",md:"flex-start"},w:"full",children:[n(de,{align:"start",spacing:1,children:[e(ct,{label:t("nodes.perAdminUsageTooltip","Total usage by node for the selected admin."),placement:"top",fontSize:"sm",children:n(R,{spacing:2,align:"center",children:[e(h,{fontWeight:"semibold",children:t("nodes.perAdminUsage","Per admin usages")}),e(ti,{color:"gray.500",_dark:{color:"gray.400"},"aria-label":"info",cursor:"help"})]})}),n(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:[t("nodes.selectedAdmin","Admin"),": "," ",e(ee.span,{fontWeight:"medium",children:A!=null?A:"-"})," ",t("nodes.totalLabel","Total"),": "," ",e(ee.span,{fontWeight:"medium",children:Xe(Be||0,2)})]})]}),n(ke,{direction:{base:"column",md:"row"},spacing:{base:3,md:4},alignItems:{base:"stretch",md:"center"},justifyContent:"flex-end",w:"full",children:[e(je,{size:"sm",minW:{md:"160px"},w:{base:"full",md:"auto"},value:A!=null?A:"",onChange:G=>me(G.target.value||null),isDisabled:et.length===0,children:et.map(G=>e("option",{value:G.value,children:G.label},G.value))}),e(ni,{presets:a,range:ve,onPresetChange:ye,onCustomChange:ut})]})]}),e(N,{mt:6,children:P?n(de,{spacing:3,children:[e(Dt,{}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("loading")})]}):ce.series.length?e(en,{options:ce.options,series:ce.series,type:"donut",height:360}):e(h,{textAlign:"center",color:"gray.500",_dark:{color:"gray.400"},children:t("noData")})})]})]})},ym=()=>{const{t}=$e(),{userData:s,getUserIsSuccess:r}=Mn(),l=r&&s.is_sudo,o=Gn(a=>a.services),i=Gn(a=>a.fetchServices);return d.exports.useEffect(()=>{l&&i({limit:500})},[i,l]),r?l?n(de,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.description","Track usage trends across services, admins, and nodes from a single place.")}),n(ls,{variant:"enclosed",colorScheme:"primary",children:[n(cs,{children:[e($t,{children:t("usage.tabs.services","Services")}),e($t,{children:t("usage.tabs.admins","Admins")}),e($t,{children:t("usage.tabs.nodes","Nodes")})]}),n(ds,{children:[e(Kt,{px:0,children:e(gm,{services:o})}),e(Kt,{px:0,children:e(um,{})}),e(Kt,{px:0,children:e(bm,{})})]})]})]}):n(de,{spacing:4,align:"stretch",children:[e(h,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:t("usage.title","Usage Analytics")}),e(h,{fontSize:"sm",color:"gray.500",_dark:{color:"gray.400"},children:t("usage.noPermission","You do not have permission to view usage analytics.")})]}):e(lt,{justify:"center",align:"center",py:10,children:e(Dt,{})})},Ul="__dot__",oa=t=>t.replace(/\./g,Ul),Kn=t=>t.replace(new RegExp(Ul,"g"),"."),Sm=t=>{const s={},r=(l,o)=>{if(o!==void 0){if(typeof o=="boolean"){s[Kn(l)]=o;return}if(typeof o=="string"){if(o==="")return;o==="true"||o==="false"?s[Kn(l)]=o==="true":s[Kn(l)]=Boolean(o);return}if(typeof o=="number"){s[Kn(l)]=o!==0;return}if(Array.isArray(o)){s[Kn(l)]=o.length>0;return}if(o&&typeof o=="object"){Object.entries(o).forEach(([i,a])=>{const c=l?`${l}.${i}`:i;r(c,a)});return}s[Kn(l)]=Boolean(o)}};return Object.entries(t).forEach(([l,o])=>{r(l,o)}),s},Ll=[{key:"users",titleKey:"settings.telegram.groups.users",defaultTitle:"User events",events:[{key:"user.created",labelKey:"settings.telegram.events.userCreated",defaultLabel:"User created",hintKey:"settings.telegram.events.userCreatedHint",defaultHint:"Notify when a user is created."},{key:"user.updated",labelKey:"settings.telegram.events.userUpdated",defaultLabel:"User updated",hintKey:"settings.telegram.events.userUpdatedHint",defaultHint:"Notify when a user is updated."},{key:"user.deleted",labelKey:"settings.telegram.events.userDeleted",defaultLabel:"User deleted",hintKey:"settings.telegram.events.userDeletedHint",defaultHint:"Notify when a user is deleted."},{key:"user.status_change",labelKey:"settings.telegram.events.userStatusChange",defaultLabel:"User status change",hintKey:"settings.telegram.events.userStatusChangeHint",defaultHint:"Notify when a user's status changes."},{key:"user.usage_reset",labelKey:"settings.telegram.events.userUsageReset",defaultLabel:"User usage reset",hintKey:"settings.telegram.events.userUsageResetHint",defaultHint:"Notify when a user's usage is reset manually."},{key:"user.auto_reset",labelKey:"settings.telegram.events.userAutoReset",defaultLabel:"User auto reset",hintKey:"settings.telegram.events.userAutoResetHint",defaultHint:"Notify when a user's usage is reset automatically by the next plan."},{key:"user.subscription_revoked",labelKey:"settings.telegram.events.userSubscriptionRevoked",defaultLabel:"Subscription revoked",hintKey:"settings.telegram.events.userSubscriptionRevokedHint",defaultHint:"Notify when a user's subscription is revoked."}]},{key:"admins",titleKey:"settings.telegram.groups.admins",defaultTitle:"Admin events",events:[{key:"admin.created",labelKey:"settings.telegram.events.adminCreated",defaultLabel:"Admin created",hintKey:"settings.telegram.events.adminCreatedHint",defaultHint:"Notify when an admin is created."},{key:"admin.updated",labelKey:"settings.telegram.events.adminUpdated",defaultLabel:"Admin updated",hintKey:"settings.telegram.events.adminUpdatedHint",defaultHint:"Notify when an admin's settings change."},{key:"admin.deleted",labelKey:"settings.telegram.events.adminDeleted",defaultLabel:"Admin deleted",hintKey:"settings.telegram.events.adminDeletedHint",defaultHint:"Notify when an admin is deleted."},{key:"admin.usage_reset",labelKey:"settings.telegram.events.adminUsageReset",defaultLabel:"Admin usage reset",hintKey:"settings.telegram.events.adminUsageResetHint",defaultHint:"Notify when an admin's usage is reset."},{key:"admin.limit.data",labelKey:"settings.telegram.events.adminDataLimit",defaultLabel:"Admin data limit reached",hintKey:"settings.telegram.events.adminDataLimitHint",defaultHint:"Notify when an admin reaches their data limit."},{key:"admin.limit.users",labelKey:"settings.telegram.events.adminUsersLimit",defaultLabel:"Admin users limit reached",hintKey:"settings.telegram.events.adminUsersLimitHint",defaultHint:"Notify when an admin reaches their users limit."}]},{key:"nodes",titleKey:"settings.telegram.groups.nodes",defaultTitle:"Node events",events:[{key:"node.created",labelKey:"settings.telegram.events.nodeCreated",defaultLabel:"Node created",hintKey:"settings.telegram.events.nodeCreatedHint",defaultHint:"Notify when a node is created."},{key:"node.deleted",labelKey:"settings.telegram.events.nodeDeleted",defaultLabel:"Node deleted",hintKey:"settings.telegram.events.nodeDeletedHint",defaultHint:"Notify when a node is deleted."},{key:"node.usage_reset",labelKey:"settings.telegram.events.nodeUsageReset",defaultLabel:"Node usage reset",hintKey:"settings.telegram.events.nodeUsageResetHint",defaultHint:"Notify when a node's usage is reset."},{key:"node.status.connected",labelKey:"settings.telegram.events.nodeStatusConnected",defaultLabel:"Node connected",hintKey:"settings.telegram.events.nodeStatusConnectedHint",defaultHint:"Notify when a node connects."},{key:"node.status.connecting",labelKey:"settings.telegram.events.nodeStatusConnecting",defaultLabel:"Node connecting",hintKey:"settings.telegram.events.nodeStatusConnectingHint",defaultHint:"Notify when a node is connecting."},{key:"node.status.error",labelKey:"settings.telegram.events.nodeStatusError",defaultLabel:"Node error",hintKey:"settings.telegram.events.nodeStatusErrorHint",defaultHint:"Notify when a node reports an error."},{key:"node.status.disabled",labelKey:"settings.telegram.events.nodeStatusDisabled",defaultLabel:"Node disabled",hintKey:"settings.telegram.events.nodeStatusDisabledHint",defaultHint:"Notify when a node is disabled."},{key:"node.status.limited",labelKey:"settings.telegram.events.nodeStatusLimited",defaultLabel:"Node limited",hintKey:"settings.telegram.events.nodeStatusLimitedHint",defaultHint:"Notify when a node is limited."}]},{key:"login",titleKey:"settings.telegram.groups.login",defaultTitle:"Login events",events:[{key:"login",labelKey:"settings.telegram.events.login",defaultLabel:"Login notifications",hintKey:"settings.telegram.events.loginHint",defaultHint:"Notify about administrator login attempts."}]},{key:"errors",titleKey:"settings.telegram.groups.errors",defaultTitle:"Error events",events:[{key:"errors.node",labelKey:"settings.telegram.events.nodeErrors",defaultLabel:"Node error logs",hintKey:"settings.telegram.events.nodeErrorsHint",defaultHint:"Notify about node errors reported by the system."}]}],xm=Ll.flatMap(t=>t.events.map(s=>s.key)),Mo=ee(Kr,{baseStyle:{w:4,h:4}}),Uo=ee(ad,{baseStyle:{w:4,h:4}}),Yi=t=>{var l,o,i,a;const s={};Object.entries(t.forum_topics||{}).forEach(([c,u])=>{var p;s[c]={title:(p=u.title)!=null?p:"",topic_id:u.topic_id!=null?String(u.topic_id):""}});const r={};return xm.forEach(c=>{var m;const u=oa(c),p=(m=t.event_toggles)==null?void 0:m[c];r[u]=p===void 0?!0:Boolean(p)}),Object.entries(t.event_toggles||{}).forEach(([c,u])=>{const p=oa(c);p in r||(r[p]=Boolean(u))}),{api_token:(l=t.api_token)!=null?l:"",use_telegram:(o=t.use_telegram)!=null?o:!0,proxy_url:(i=t.proxy_url)!=null?i:"",admin_chat_ids:(t.admin_chat_ids||[]).join(", "),logs_chat_id:t.logs_chat_id!=null?String(t.logs_chat_id):"",logs_chat_is_forum:t.logs_chat_is_forum,default_vless_flow:(a=t.default_vless_flow)!=null?a:"",forum_topics:s,event_toggles:r}},Gi=({disabled:t,message:s,children:r})=>n(N,{position:"relative",children:[e(N,{pointerEvents:t?"none":"auto",filter:t?"blur(1.2px)":"none",opacity:t?.55:1,transition:"all 0.2s ease",children:r}),t&&e(lt,{position:"absolute",inset:0,align:"center",justify:"center",textAlign:"center",fontWeight:"semibold",color:"white",px:6,borderRadius:"inherit",bg:"blackAlpha.400",backdropFilter:"blur(2px)",children:e(h,{children:s})})]}),wm=t=>t.split(/[\s,]+/).map(s=>s.trim()).filter(s=>s.length>0).map(s=>Number(s)).filter(s=>Number.isFinite(s)),km=()=>{var me,De,Ee,W;const{t}=$e(),s=Bt(),r=fa(),{data:l,isLoading:o,refetch:i}=Nr("telegram-settings",Uu,{refetchOnWindowFocus:!1}),{data:a,isLoading:c,refetch:u}=Nr("panel-settings",ya,{refetchOnWindowFocus:!1}),p=Nr("maintenance-info",()=>_e("/maintenance/info"),{refetchOnWindowFocus:!1}),[m,g]=d.exports.useState((me=a==null?void 0:a.use_nobetci)!=null?me:!1),[I,D]=d.exports.useState(!1),[w,x]=d.exports.useState(!1),v=d.exports.useRef(null);d.exports.useEffect(()=>{a&&g(a.use_nobetci)},[a]);const{register:C,control:z,handleSubmit:ne,reset:b,watch:U,formState:{isDirty:T}}=Or({defaultValues:Yi(l!=null?l:{api_token:null,use_telegram:!0,proxy_url:null,admin_chat_ids:[],logs_chat_id:null,logs_chat_is_forum:!1,default_vless_flow:null,forum_topics:{},event_toggles:{}})});d.exports.useEffect(()=>{l&&b(Yi(l))},[l,b]);const O=Dr(Lu,{onSuccess:y=>{b(Yi(y)),r.setQueryData("telegram-settings",y),s({title:t("settings.savedSuccess"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),ve=Dr(Ou,{onSuccess:y=>{g(y.use_nobetci),r.setQueryData("panel-settings",y),s({title:t("settings.panel.saved","Panel settings saved"),status:"success",duration:3e3})},onError:()=>{s({title:t("errors.generic","Something went wrong"),status:"error"})}}),Z=y=>{const P=Sm(y.event_toggles||{}),ie={api_token:y.api_token.trim()||null,use_telegram:y.use_telegram,proxy_url:y.proxy_url.trim()||null,admin_chat_ids:wm(y.admin_chat_ids),logs_chat_id:y.logs_chat_id.trim()?Number(y.logs_chat_id.trim()):null,logs_chat_is_forum:y.logs_chat_is_forum,default_vless_flow:y.default_vless_flow.trim()||null,forum_topics:Object.fromEntries(Object.entries(y.forum_topics||{}).map(([te,Ce])=>[te,{title:Ce.title,topic_id:Ce.topic_id.trim()?Number(Ce.topic_id.trim()):void 0}])),event_toggles:P};O.mutate(ie)},J=y=>{if(!y)return`rebecca-backup-${Date.now()}.zip`;const P=y.split(";");for(const ie of P){const te=ie.trim();if(te.toLowerCase().startsWith("filename="))return te.split("=",1)[1].trim().replace(/(^\"|\"$)/g,"")||`rebecca-backup-${Date.now()}.zip`}return`rebecca-backup-${Date.now()}.zip`},E=async()=>{D(!0);try{const y=Zn(),P=await fetch("/api/maintenance/backup/export",{method:"GET",headers:y?{Authorization:`Bearer ${y}`}:void 0});if(!P.ok)throw new Error(await P.text());const ie=await P.blob(),te=J(P.headers.get("content-disposition")),Ce=window.URL.createObjectURL(ie),Te=document.createElement("a");Te.href=Ce,Te.download=te,document.body.appendChild(Te),Te.click(),document.body.removeChild(Te),window.URL.revokeObjectURL(Ce),Wt(t("settings.panel.backupDownloadSuccess"),s)}catch(y){Ft(y,s)}finally{D(!1)}},q=async y=>{var ie;const P=(ie=y.target.files)==null?void 0:ie[0];if(!!P){x(!0);try{const te=Zn(),Ce=new FormData;Ce.append("file",P);const Te=await fetch("/api/maintenance/backup/import",{method:"POST",headers:te?{Authorization:`Bearer ${te}`}:void 0,body:Ce});if(!Te.ok)throw new Error(await Te.text());Wt(t("settings.panel.backupUploadSuccess"),s)}catch(te){Ft(te,s)}finally{x(!1),y.target.value=""}}},ue=U("forum_topics"),Y=U("use_telegram"),re=t("settings.telegram.disabledOverlay","Telegram bot is disabled. Enable it to edit these settings."),A=()=>{var y;(y=v.current)==null||y.click()};return n(N,{px:{base:4,md:8},py:{base:6,md:8},children:[e(kn,{size:"lg",mb:4,children:t("settings.integrations","Master Settings")}),n(ls,{colorScheme:"primary",children:[n(cs,{children:[e($t,{children:t("settings.panel.tabTitle","Panel")}),e($t,{children:t("settings.telegram","Telegram")}),e($t,{isDisabled:!0,children:t("settings.tabs.comingSoon","Coming Soon")})]}),n(ds,{children:[e(Kt,{px:{base:0,md:2},children:c&&a===void 0?e(lt,{align:"center",justify:"center",py:12,children:e(Dt,{size:"lg"})}):n(ke,{spacing:6,align:"stretch",children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.description","Control dashboard-specific behaviors that affect all admins.")}),e(N,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(lt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(N,{children:[e(kn,{size:"sm",mb:1,children:t("settings.panel.useNobetciTitle","Enable Nobetci integration")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.useNobetciDescription","Show Nobetci options when creating or editing nodes.")})]}),e(ht,{isChecked:m,onChange:y=>g(y.target.checked),isDisabled:ve.isLoading||c})]})}),n(N,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(lt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(N,{children:[e(kn,{size:"sm",mb:1,children:t("settings.panel.maintenanceTitle","Maintenance status")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.maintenanceDescription","Inspect which container images are currently used by the panel and node.")})]}),e(F,{variant:"outline",size:"sm",leftIcon:e(Kr,{width:16,height:16}),onClick:()=>p.refetch(),isLoading:p.isFetching,children:t("actions.refresh","Refresh")})]}),e(ke,{spacing:2,mt:4,children:p.isLoading&&!p.data?e(lt,{align:"center",justify:"center",py:4,children:e(Dt,{size:"sm"})}):n(Ot,{children:[n(N,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.panelVersion","Panel image")}),e(h,{fontSize:"sm",color:"gray.500",children:(Ee=(De=p.data)==null?void 0:De.panel)!=null&&Ee.image?`${p.data.panel.image}${p.data.panel.tag?` (${p.data.panel.tag})`:""}`:t("settings.panel.versionUnknown","Unknown")})]}),n(N,{children:[e(h,{fontWeight:"semibold",children:t("settings.panel.nodeVersion","Node image")}),e(h,{fontSize:"sm",color:"gray.500",children:(W=p.data)!=null&&W.node?p.data.node.image?`${p.data.node.image}${p.data.node.tag?` (${p.data.node.tag})`:""}`:t("settings.panel.versionUnknown","Unknown"):t("settings.panel.nodeVersionUnavailable","Node deployment not detected")})]})]})})]}),n(N,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(lt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(N,{children:[e(kn,{size:"sm",mb:1,children:t("settings.panel.backupTitle","Backup & Restore")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.panel.backupDescription","Create or restore backups directly through the maintenance service.")})]}),n(ke,{spacing:3,direction:{base:"column",md:"row"},children:[e(F,{leftIcon:e(ha,{width:16,height:16}),onClick:E,isLoading:I,children:t("settings.panel.backupDownload","Download backup")}),e(F,{leftIcon:e(ua,{width:16,height:16}),onClick:A,isLoading:w,children:t("settings.panel.backupUpload","Restore backup")})]})]}),e("input",{ref:v,type:"file",accept:".zip,.tar.gz",style:{display:"none"},onChange:q})]}),n(lt,{gap:3,justify:"flex-end",children:[e(F,{variant:"outline",leftIcon:e(Mo,{}),onClick:()=>u(),isDisabled:ve.isLoading,children:t("actions.refresh","Refresh")}),e(F,{colorScheme:"primary",leftIcon:e(Uo,{}),onClick:()=>ve.mutate({use_nobetci:m}),isLoading:ve.isLoading,isDisabled:ve.isLoading||a===void 0||m===a.use_nobetci,children:t("settings.save","Save Settings")})]})]})}),e(Kt,{px:{base:0,md:2},children:o&&!l?e(lt,{align:"center",justify:"center",py:12,children:e(Dt,{size:"lg"})}):e("form",{onSubmit:ne(Z),children:n(de,{align:"stretch",spacing:6,children:[e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.description","Manage Telegram bot integration settings and notification preferences.")}),n(lt,{justify:"space-between",align:{base:"flex-start",md:"center"},gap:4,flexDirection:{base:"column",md:"row"},children:[n(N,{children:[e(kn,{size:"sm",mb:1,children:t("settings.telegram.enableBot","Enable Telegram bot")}),e(h,{fontSize:"sm",color:"gray.500",children:t("settings.telegram.enableBotDescription","Turn the bot on or off without clearing the API token.")})]}),e(pt,{control:z,name:"use_telegram",render:({field:y})=>e(ht,{isChecked:y.value,onChange:P=>y.onChange(P.target.checked)})})]}),e(Gi,{disabled:!Y,message:re,children:e(N,{borderWidth:"1px",borderRadius:"lg",p:4,children:n(Ve,{columns:{base:1,md:2},spacing:6,children:[n(k,{children:[e(_,{children:t("settings.telegram.apiToken","Bot API Token")}),e(we,{placeholder:"123456:ABC",...C("api_token")})]}),n(k,{children:[e(_,{children:t("settings.telegram.proxyUrl","Proxy URL")}),e(we,{placeholder:"socks5://user:pass@host:port",...C("proxy_url")})]}),n(k,{children:[e(_,{children:t("settings.telegram.adminChatIds","Admin Chat IDs")}),e(we,{placeholder:"12345, 67890",...C("admin_chat_ids")}),e(Lr,{children:t("settings.telegram.adminChatIdsHint","Comma-separated numeric IDs.")})]}),n(k,{children:[e(_,{children:t("settings.telegram.logsChatId","Logs Chat ID")}),e(we,{placeholder:"-100123456789",...C("logs_chat_id")}),e(Lr,{children:t("settings.telegram.logsChatIdHint","Use the numeric id of the target group or channel.")})]}),n(k,{display:"flex",alignItems:"center",children:[e(_,{htmlFor:"logs_chat_is_forum",mb:"0",children:t("settings.telegram.logsChatIsForum","Logs chat is a forum")}),e(pt,{control:z,name:"logs_chat_is_forum",render:({field:y})=>e(ht,{id:"logs_chat_is_forum",isChecked:y.value,onChange:y.onChange})})]}),n(k,{children:[e(_,{children:t("settings.telegram.defaultVlessFlow","Default VLESS Flow")}),e(we,{placeholder:"xtls-rprx-vision",...C("default_vless_flow")})]})]})})}),e(Gi,{disabled:!Y,message:re,children:n(N,{children:[e(kn,{size:"sm",mb:4,children:t("settings.telegram.forumTopics","Forum Topics")}),ue&&Object.keys(ue).length>0?e(ke,{spacing:4,children:Object.entries(ue).map(([y])=>n(N,{borderWidth:"1px",borderRadius:"lg",p:4,children:[n(h,{fontWeight:"medium",mb:3,children:[t("settings.telegram.topicKey","Topic"),": ",y]}),n(Ve,{columns:{base:1,md:2},spacing:4,children:[n(k,{children:[e(_,{children:t("settings.telegram.topicTitle","Topic Title")}),e(we,{...C(`forum_topics.${y}.title`)})]}),n(k,{children:[e(_,{children:t("settings.telegram.topicId","Topic ID")}),e(we,{type:"number",...C(`forum_topics.${y}.topic_id`)}),e(Lr,{children:t("settings.telegram.topicIdHint","Leave empty to let the bot (re)create it.")})]})]})]},y))}):e(h,{color:"gray.500",children:t("settings.telegram.emptyTopics","No topics available.")})]})}),e(Gi,{disabled:!Y,message:re,children:n(N,{children:[e(kn,{size:"sm",mb:2,children:t("settings.telegram.notificationsTitle","Notifications")}),e(h,{fontSize:"sm",color:"gray.500",mb:4,children:t("settings.telegram.notificationsDescription","Choose which events should trigger Telegram notifications.")}),e(ke,{spacing:4,children:Ll.map(y=>n(N,{borderWidth:"1px",borderRadius:"lg",p:4,children:[e(h,{fontWeight:"semibold",mb:3,children:t(y.titleKey,y.defaultTitle)}),e(Ve,{columns:{base:1,md:2},spacing:4,children:y.events.map(P=>n(k,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4,children:[n(N,{flex:"1",children:[e(h,{fontWeight:"medium",children:t(P.labelKey,P.defaultLabel)}),e(h,{fontSize:"sm",color:"gray.500",children:t(P.hintKey,P.defaultHint)})]}),e(pt,{control:z,name:`event_toggles.${oa(P.key)}`,render:({field:ie})=>e(ht,{isChecked:Boolean(ie.value),onChange:te=>ie.onChange(te.target.checked)})})]},P.key))})]},y.key))})]})}),n(lt,{gap:3,justify:"flex-end",children:[e(F,{variant:"outline",leftIcon:e(Mo,{}),onClick:()=>i(),isDisabled:O.isLoading,children:t("actions.refresh","Refresh")}),e(F,{colorScheme:"primary",leftIcon:e(Uo,{}),type:"submit",isLoading:O.isLoading,isDisabled:!T&&!O.isLoading,children:t("settings.save","Save Settings")})]})]})})}),e(Kt,{children:e(h,{color:"gray.500",children:t("settings.tabs.comingSoon","Coming Soon")})})]})]})]})},vm=async()=>{try{const t=Zn();if(!t)throw console.warn("No authentication token found"),new Error("No token available");const s=await _e("/admin",{headers:{Authorization:`Bearer ${t}`}});if(s&&typeof s=="object"&&"error"in s)throw new Error(`API error: ${s.error||"Unknown error"}`);return s}catch(t){throw console.error("Loader error:",t),t}},Cm=od([{path:"/",element:e(su,{}),errorElement:e(Oa,{}),loader:vm,children:[{index:!0,element:e(mu,{})},{path:"users",element:e(ch,{})},{path:"admins",element:e(mh,{})},{path:"usage",element:e(ym,{})},{path:"services",element:e(sm,{})},{path:"hosts",element:e(rp,{})},{path:"node-settings",element:e(wp,{})},{path:"integrations",element:e(km,{})},{path:"xray-settings",element:e(rm,{})},{path:"xray-logs",element:e(Rl,{})}]},{path:"/login/",element:e(Oa,{})}]);function _m(){return e(ld,{router:Cm})}Pe.extend(cd);Pe.extend(dd);Pe.extend(Bs);Pe.extend(ud);Pe.extend(hd);li(pd.get()||"light");md.createRoot(document.getElementById("root")).render(e(Qi.StrictMode,{children:e(gd,{theme:bd,children:e(fd,{client:oi,children:e(_m,{})})})}));
